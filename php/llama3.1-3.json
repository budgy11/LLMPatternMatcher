{"prompt": "Create a forgot password function using php", "llm_output": "**Forgot Password Function in PHP**\n=====================================\n\nHere is an example of how to create a forgotten password feature in PHP. This will send a reset link to the user's email address.\n\n### Database Schema\n\nFirst, we need to set up our database schema with two tables: `users` and `password_resets`.\n\n**Table Structure:**\n\n```sql\nCREATE TABLE users (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  username VARCHAR(255) NOT NULL,\n  password_hash VARCHAR(255) NOT NULL\n);\n\nCREATE TABLE password_resets (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  user_id INT NOT NULL,\n  token VARCHAR(255) NOT NULL,\n  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n  FOREIGN KEY (user_id) REFERENCES users(id)\n);\n```\n\n### PHP Code\n\nWe will use the following PHP code to create a forgot password feature. This will send an email with a reset link.\n\n```php\n// config.php (configure database connection)\n<?php\ndefine('DB_HOST', 'your_host');\ndefine('DB_USERNAME', 'your_username');\ndefine('DB_PASSWORD', 'your_password');\ndefine('DB_NAME', 'your_database');\n\n// db_connection.php (establish database connection)\n<?php\n$mysqli = new mysqli(DB_HOST, DB_USERNAME, DB_PASSWORD, DB_NAME);\nif ($mysqli->connect_errno) {\n    die(\"Failed to connect to MySQL: (\" . $mysqli->connect_errno . \") \" . $mysqli->connect_error);\n}\n?>\n\n// forgot_password.php (forgot password function)\n<?php\nrequire_once 'config.php';\nrequire_once 'db_connection.php';\n\nfunction sendResetEmail($token, $username) {\n    $to = $_POST['email'];\n    $subject = 'Reset Password';\n    $body = \"Click here to reset your password: <a href='http://example.com/reset_password?token=$token'>Reset Password</a>\";\n    mail($to, $subject, $body);\n}\n\nif (isset($_POST['forgot_password'])) {\n    $email = $_POST['email'];\n    $query = \"SELECT id FROM users WHERE email='$email'\";\n    $result = $mysqli->query($query);\n    if ($result->num_rows > 0) {\n        // If user exists, generate a token and store it in the database\n        $token = bin2hex(random_bytes(32));\n        $user_id = $result->fetch_assoc()['id'];\n        $query = \"INSERT INTO password_resets (user_id, token) VALUES ('$user_id', '$token')\";\n        $mysqli->query($query);\n        sendResetEmail($token, 'username'); // Replace with actual username\n    }\n}\n?>\n```\n\n### Frontend Code\n\nIn your frontend code, use a simple form to collect the user's email address.\n\n```php\n<!-- index.php (forgot password form) -->\n<?php require_once 'db_connection.php'; ?>\n\n<form action=\"forgot_password.php\" method=\"post\">\n  <label for=\"email\">Email:</label>\n  <input type=\"email\" id=\"email\" name=\"email\"><br><br>\n  <button type=\"submit\" name=\"forgot_password\">Forgot Password</button>\n</form>\n```\n\nThis is a basic example of how you can implement a forgot password feature in PHP. This will generate a token, store it in the database, and send an email with a reset link to the user's email address.\n\n**Security Note:**\n\n*   Make sure to validate all user input data before storing or processing it.\n*   Use prepared statements to prevent SQL injection attacks.\n*   Store passwords securely using password hashing algorithms like bcrypt.\n*   Use HTTPS (SSL/TLS) to encrypt communication between client and server.", "code_blocks": [null, "```php\n// config.php (configure database connection)\n<?php\ndefine('DB_HOST', 'your_host');\ndefine('DB_USERNAME', 'your_username');\ndefine('DB_PASSWORD', 'your_password');\ndefine('DB_NAME', 'your_database');\n\n// db_connection.php (establish database connection)\n<?php\n$mysqli = new mysqli(DB_HOST, DB_USERNAME, DB_PASSWORD, DB_NAME);\nif ($mysqli->connect_errno) {\n    die(\"Failed to connect to MySQL: (\" . $mysqli->connect_errno . \") \" . $mysqli->connect_error);\n}\n?>\n\n// forgot_password.php (forgot password function)\n<?php\nrequire_once 'config.php';\nrequire_once 'db_connection.php';\n\nfunction sendResetEmail($token, $username) {\n    $to = $_POST['email'];\n    $subject = 'Reset Password';\n    $body = \"Click here to reset your password: <a href='http://example.com/reset_password?token=$token'>Reset Password</a>\";\n    mail($to, $subject, $body);\n}\n\nif (isset($_POST['forgot_password'])) {\n    $email = $_POST['email'];\n    $query = \"SELECT id FROM users WHERE email='$email'\";\n    $result = $mysqli->query($query);\n    if ($result->num_rows > 0) {\n        // If user exists, generate a token and store it in the database\n        $token = bin2hex(random_bytes(32));\n        $user_id = $result->fetch_assoc()['id'];\n        $query = \"INSERT INTO password_resets (user_id, token) VALUES ('$user_id', '$token')\";\n        $mysqli->query($query);\n        sendResetEmail($token, 'username'); // Replace with actual username\n    }\n}\n?>\n```", "```php\n<!-- index.php (forgot password form) -->\n<?php require_once 'db_connection.php'; ?>\n\n<form action=\"forgot_password.php\" method=\"post\">\n  <label for=\"email\">Email:</label>\n  <input type=\"email\" id=\"email\" name=\"email\"><br><br>\n  <button type=\"submit\" name=\"forgot_password\">Forgot Password</button>\n</form>\n```"]}
