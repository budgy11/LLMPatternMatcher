{"prompt": "Create a user review function using php", "llm_output": "<think>\nOkay, the user wants me to create a user review function using PHP. Let me think about how to approach this.\n\nFirst, I need to understand what the function should do. It's supposed to allow users to submit reviews with ratings and comments. So, I'll probably need an HTML form where they can select a rating from 1 to 5 stars and enter their comment.\n\nNext, I need to handle the submission. That means setting up a PHP script that processes the form data when it's submitted. The function should validate the input to make sure the rating is between 1 and 5 and that the comment isn't empty or too long.\n\nThen, storing the reviews in a database makes sense so they can be displayed later. I'll use MySQL for this example. So, I'll need to create a table called reviews with columns like id, user_name, rating, comment, and review_date.\n\nAfter inserting the new review into the database, it would be helpful to display all existing reviews so users can see previous ones. That means writing a SQL query to fetch all reviews from the table and loop through them in PHP to display each one on the page.\n\nI should also include error handling in case something goes wrong, like if the database connection fails or if there's an issue inserting the data. But for simplicity, I'll just use die() to handle those errors this time.\n\nPutting it all together, I'll structure the HTML with a form that posts to itself. The PHP script will check if the form has been submitted and then process the review. Then, whether submitting or not, it will display all existing reviews below the form.\n\nI should also format the rating stars nicely. Using CSS classes like 'star-rating' can help style them as filled or empty stars based on the rating value.\n\nFinally, I'll provide some notes on how to customize the script further, like adding validation with JavaScript, sanitizing input, allowing user logins, and displaying real-time updates without refreshing.\n</think>\n\nHere's an example of a user review function in PHP that allows users to submit and display reviews:\n\n```php\n<?php\n// Function to handle and display reviews\nfunction user_review() {\n    // Database connection parameters\n    $host = \"localhost\";\n    $username = \"root\";\n    $password = \"\";\n    $database = \"reviews_db\";\n\n    // Create database connection\n    $conn = new mysqli($host, $username, $password, $database);\n\n    // Check connection\n    if ($conn->connect_error) {\n        die(\"Connection failed: \" . $conn->connect_error);\n    }\n\n    // Process form submission\n    if ($_SERVER[\"REQUEST_METHOD\"] == \"POST\") {\n        // Get and sanitize user input\n        $user_name = htmlspecialchars($_POST['name']);\n        $rating = intval($_POST['rating']);\n        $comment = htmlspecialchars($_POST['comment']);\n\n        // Validate input\n        if ($rating < 1 || $rating > 5) {\n            die(\"Invalid rating! Rating must be between 1 and 5.\");\n        }\n\n        if (strlen($comment) == 0) {\n            die(\"Comment cannot be empty!\");\n        }\n\n        // Insert review into database\n        $sql = \"INSERT INTO reviews (user_name, rating, comment, review_date)\n                VALUES ('$user_name', '$rating', '$comment', NOW())\";\n\n        if ($conn->query($sql) === TRUE) {\n            echo \"<p>Review submitted successfully!</p>\";\n        } else {\n            die(\"Error submitting review: \" . $conn->error);\n        }\n    }\n\n    // Display existing reviews\n    $sql = \"SELECT * FROM reviews ORDER BY review_date DESC\";\n    $result = $conn->query($sql);\n\n    if ($result->num_rows > 0) {\n        while ($row = $result->fetch_assoc()) {\n            echo \"<div class='review'>\";\n            echo \"<h4>Rating: \" . str_repeat(\"\u2605\", $row['rating']) . \"</h4>\";\n            echo \"<p><strong>\" . $row['user_name'] . \"</strong></p>\";\n            echo \"<p>\" . $row['comment'] . \"</p>\";\n            echo \"<small>\" . $row['review_date'] . \"</small>\";\n            echo \"</div>\";\n        }\n    } else {\n        echo \"<p>No reviews yet. Be the first to review!</p>\";\n    }\n\n    // Close database connection\n    $conn->close();\n}\n?>\n```\n\nThis function includes:\n\n1. A database connection setup\n\n2. Form submission handling:\n   - Sanitization of user input\n   - Input validation (rating must be between 1-5, comment cannot be empty)\n   - Inserting reviews into the database\n\n3. Displaying existing reviews from the database in descending order\n\nTo use this function, you'll need to:\n\n1. Create a database table named `reviews` with the following columns:\n```sql\nCREATE TABLE reviews (\n    id INT AUTO_INCREMENT PRIMARY KEY,\n    user_name VARCHAR(255),\n    rating INT NOT NULL,\n    comment TEXT NOT NULL,\n    review_date DATETIME\n);\n```\n\n2. Include this function in your PHP script and call it appropriately\n\n3. Create an HTML form to submit reviews:\n\n```html\n<form method=\"post\" action=\"<?php echo $_SERVER['PHP_SELF']; ?>\">\n    <div class=\"rating\">\n        <input type=\"radio\" id=\"5-star\" name=\"rating\" value=\"5\">\n        <label for=\"5-star\">\u2605</label>\n        <input type=\"radio\" id=\"4-star\" name=\"rating\" value=\"4\">\n        <label for=\"4-star\">\u2605</label>\n        <input type=\"radio\" id=\"3-star\" name=\"rating\" value=\"3\">\n        <label for=\"3-star\">\u2605</label>\n        <input type=\"radio\" id=\"2-star\" name=\"rating\" value=\"2\">\n        <label for=\"2-star\">\u2605</label>\n        <input type=\"radio\" id=\"1-star\" name=\"rating\" value=\"1\">\n        <label for=\"1-star\">\u2605</label>\n    </div>\n\n    <input type=\"text\" name=\"name\" placeholder=\"Your Name\">\n    <textarea name=\"comment\" placeholder=\"Write your review here...\"></textarea>\n    <button type=\"submit\">Submit Review</button>\n</form>\n```\n\nYou can customize the rating display by adding CSS:\n\n```css\n.rating {\n    display: flex;\n    gap: 5px;\n}\n\n.star-rating {\n    color: #gold;\n}\n```\n\nRemember to:\n- Add proper validation and sanitization for production use\n- Use prepared statements to prevent SQL injection\n- Add error handling\n- Secure your database connection\n\nYou can extend this function by adding features like:\n- User authentication\n- Review editing/deletion\n- Reply to reviews\n- Rating averages display\n- Review filtering/sorting\n- Report inappropriate reviews", "code_blocks": ["```php\n<?php\n// Function to handle and display reviews\nfunction user_review() {\n    // Database connection parameters\n    $host = \"localhost\";\n    $username = \"root\";\n    $password = \"\";\n    $database = \"reviews_db\";\n\n    // Create database connection\n    $conn = new mysqli($host, $username, $password, $database);\n\n    // Check connection\n    if ($conn->connect_error) {\n        die(\"Connection failed: \" . $conn->connect_error);\n    }\n\n    // Process form submission\n    if ($_SERVER[\"REQUEST_METHOD\"] == \"POST\") {\n        // Get and sanitize user input\n        $user_name = htmlspecialchars($_POST['name']);\n        $rating = intval($_POST['rating']);\n        $comment = htmlspecialchars($_POST['comment']);\n\n        // Validate input\n        if ($rating < 1 || $rating > 5) {\n            die(\"Invalid rating! Rating must be between 1 and 5.\");\n        }\n\n        if (strlen($comment) == 0) {\n            die(\"Comment cannot be empty!\");\n        }\n\n        // Insert review into database\n        $sql = \"INSERT INTO reviews (user_name, rating, comment, review_date)\n                VALUES ('$user_name', '$rating', '$comment', NOW())\";\n\n        if ($conn->query($sql) === TRUE) {\n            echo \"<p>Review submitted successfully!</p>\";\n        } else {\n            die(\"Error submitting review: \" . $conn->error);\n        }\n    }\n\n    // Display existing reviews\n    $sql = \"SELECT * FROM reviews ORDER BY review_date DESC\";\n    $result = $conn->query($sql);\n\n    if ($result->num_rows > 0) {\n        while ($row = $result->fetch_assoc()) {\n            echo \"<div class='review'>\";\n            echo \"<h4>Rating: \" . str_repeat(\"\u2605\", $row['rating']) . \"</h4>\";\n            echo \"<p><strong>\" . $row['user_name'] . \"</strong></p>\";\n            echo \"<p>\" . $row['comment'] . \"</p>\";\n            echo \"<small>\" . $row['review_date'] . \"</small>\";\n            echo \"</div>\";\n        }\n    } else {\n        echo \"<p>No reviews yet. Be the first to review!</p>\";\n    }\n\n    // Close database connection\n    $conn->close();\n}\n?>\n```", null, null, null]}
