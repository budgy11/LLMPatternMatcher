{"prompt": "Create a user review function using php", "llm_output": "Here's an example of a user review system in PHP, including the creation of reviews, retrieval of existing reviews, and calculation of average ratings.\n\n**Database Schema**\n\nFor this example, we'll use MySQL as our database. We need two tables: `products` and `reviews`.\n\n```sql\nCREATE TABLE products (\n  id INT AUTO_INCREMENT,\n  name VARCHAR(255) NOT NULL,\n  description TEXT,\n  PRIMARY KEY (id)\n);\n\nCREATE TABLE reviews (\n  id INT AUTO_INCREMENT,\n  product_id INT NOT NULL,\n  user_name VARCHAR(255) NOT NULL,\n  review TEXT NOT NULL,\n  rating TINYINT NOT NULL CHECK (rating >= 1 AND rating <= 5),\n  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n  PRIMARY KEY (id),\n  FOREIGN KEY (product_id) REFERENCES products(id)\n);\n```\n\n**PHP Code**\n\n```php\n<?php\n\n// Configuration\ndefine('DB_HOST', 'localhost');\ndefine('DB_USER', 'username');\ndefine('DB_PASSWORD', 'password');\ndefine('DB_NAME', 'database_name');\n\n// Connect to database\n$conn = new mysqli(DB_HOST, DB_USER, DB_PASSWORD, DB_NAME);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\nfunction createUserReview($product_id, $user_name, $review_text, $rating) {\n    global $conn;\n    \n    // Prepare and execute query\n    $sql = \"INSERT INTO reviews (product_id, user_name, review, rating)\n            VALUES (?, ?, ?, ?)\";\n    \n    $stmt = $conn->prepare($sql);\n    $stmt->bind_param(\"iiss\", $product_id, $user_name, $review_text, $rating);\n    \n    if ($stmt->execute()) {\n        echo \"Review created successfully.\";\n    } else {\n        echo \"Error creating review: \" . $stmt->error;\n    }\n    \n    $stmt->close();\n}\n\nfunction getReviews($product_id) {\n    global $conn;\n    \n    // Prepare and execute query\n    $sql = \"SELECT * FROM reviews WHERE product_id = ?\";\n    \n    $stmt = $conn->prepare($sql);\n    $stmt->bind_param(\"i\", $product_id);\n    \n    if ($stmt->execute()) {\n        $reviews = array();\n        \n        $result = $stmt->get_result();\n        \n        while ($row = $result->fetch_assoc()) {\n            $reviews[] = $row;\n        }\n        \n        return $reviews;\n    } else {\n        echo \"Error retrieving reviews: \" . $stmt->error;\n    }\n    \n    $stmt->close();\n}\n\nfunction calculateAverageRating($product_id) {\n    global $conn;\n    \n    // Prepare and execute query\n    $sql = \"SELECT AVG(rating) AS average_rating FROM reviews WHERE product_id = ?\";\n    \n    $stmt = $conn->prepare($sql);\n    $stmt->bind_param(\"i\", $product_id);\n    \n    if ($stmt->execute()) {\n        $result = $stmt->get_result();\n        \n        $row = $result->fetch_assoc();\n        \n        return $row['average_rating'];\n    } else {\n        echo \"Error calculating average rating: \" . $stmt->error;\n    }\n    \n    $stmt->close();\n}\n\n// Example usage\ncreateUserReview(1, 'John Doe', 'Great product!', 5);\n$reviews = getReviews(1);\nforeach ($reviews as $review) {\n    echo $review['user_name'] . ': ' . $review['review'];\n}\necho 'Average rating: ' . calculateAverageRating(1);\n\n?>\n```\n\nThis code provides three functions:\n\n*   `createUserReview`: Creates a new review for the specified product.\n*   `getReviews`: Retrieves all reviews for the specified product.\n*   `calculateAverageRating`: Calculates and returns the average rating for the specified product.\n\n**Note**: Remember to replace placeholders in the database configuration with your actual MySQL credentials.", "code_blocks": [null, "```php\n<?php\n\n// Configuration\ndefine('DB_HOST', 'localhost');\ndefine('DB_USER', 'username');\ndefine('DB_PASSWORD', 'password');\ndefine('DB_NAME', 'database_name');\n\n// Connect to database\n$conn = new mysqli(DB_HOST, DB_USER, DB_PASSWORD, DB_NAME);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\nfunction createUserReview($product_id, $user_name, $review_text, $rating) {\n    global $conn;\n    \n    // Prepare and execute query\n    $sql = \"INSERT INTO reviews (product_id, user_name, review, rating)\n            VALUES (?, ?, ?, ?)\";\n    \n    $stmt = $conn->prepare($sql);\n    $stmt->bind_param(\"iiss\", $product_id, $user_name, $review_text, $rating);\n    \n    if ($stmt->execute()) {\n        echo \"Review created successfully.\";\n    } else {\n        echo \"Error creating review: \" . $stmt->error;\n    }\n    \n    $stmt->close();\n}\n\nfunction getReviews($product_id) {\n    global $conn;\n    \n    // Prepare and execute query\n    $sql = \"SELECT * FROM reviews WHERE product_id = ?\";\n    \n    $stmt = $conn->prepare($sql);\n    $stmt->bind_param(\"i\", $product_id);\n    \n    if ($stmt->execute()) {\n        $reviews = array();\n        \n        $result = $stmt->get_result();\n        \n        while ($row = $result->fetch_assoc()) {\n            $reviews[] = $row;\n        }\n        \n        return $reviews;\n    } else {\n        echo \"Error retrieving reviews: \" . $stmt->error;\n    }\n    \n    $stmt->close();\n}\n\nfunction calculateAverageRating($product_id) {\n    global $conn;\n    \n    // Prepare and execute query\n    $sql = \"SELECT AVG(rating) AS average_rating FROM reviews WHERE product_id = ?\";\n    \n    $stmt = $conn->prepare($sql);\n    $stmt->bind_param(\"i\", $product_id);\n    \n    if ($stmt->execute()) {\n        $result = $stmt->get_result();\n        \n        $row = $result->fetch_assoc();\n        \n        return $row['average_rating'];\n    } else {\n        echo \"Error calculating average rating: \" . $stmt->error;\n    }\n    \n    $stmt->close();\n}\n\n// Example usage\ncreateUserReview(1, 'John Doe', 'Great product!', 5);\n$reviews = getReviews(1);\nforeach ($reviews as $review) {\n    echo $review['user_name'] . ': ' . $review['review'];\n}\necho 'Average rating: ' . calculateAverageRating(1);\n\n?>\n```"]}
