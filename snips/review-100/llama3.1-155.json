{"prompt": "Create a user review function using php", "llm_output": "Here's an example of a simple user review system implemented in PHP:\n\n**User Review Function**\n\nWe'll create three tables in the database: `users`, `reviews`, and `products`.\n\n### Database Schema\n```sql\nCREATE TABLE users (\n  id INT PRIMARY KEY,\n  username VARCHAR(255) NOT NULL,\n  email VARCHAR(255) NOT NULL\n);\n\nCREATE TABLE products (\n  id INT PRIMARY KEY,\n  name VARCHAR(255) NOT NULL,\n  description TEXT\n);\n\nCREATE TABLE reviews (\n  id INT PRIMARY KEY,\n  user_id INT NOT NULL,\n  product_id INT NOT NULL,\n  rating TINYINT NOT NULL,\n  comment TEXT,\n  FOREIGN KEY (user_id) REFERENCES users(id),\n  FOREIGN KEY (product_id) REFERENCES products(id)\n);\n```\n\n### PHP Code\n```php\n// Configuration\n$dbHost = 'localhost';\n$dbUsername = 'root';\n$dbPassword = '';\n$dbName = 'reviews';\n\n// Connect to the database\n$conn = new mysqli($dbHost, $dbUsername, $dbPassword, $dbName);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\nfunction createUserReview($data) {\n  global $conn;\n  \n  // Sanitize input data\n  $username = trim($data['username']);\n  $email = trim($data['email']);\n  $productId = (int)$data['product_id'];\n  $rating = (int)$data['rating'];\n  $comment = trim($data['comment']);\n\n  // Insert new review into the database\n  $sql = \"INSERT INTO reviews (user_id, product_id, rating, comment) \n          VALUES (NULL, ?, ?, ?)\";\n  $stmt = $conn->prepare($sql);\n  $stmt->bind_param(\"iis\", $productId, $rating, $comment);\n\n  if ($stmt->execute()) {\n    // Get the last inserted review ID\n    $reviewId = $conn->insert_id;\n\n    // Update product rating and count\n    $sql = \"UPDATE products SET \n            rating = (SELECT AVG(rating) FROM reviews WHERE product_id = ?), \n            review_count = (SELECT COUNT(*) FROM reviews WHERE product_id = ?)\n            WHERE id = ?\";\n    $stmt = $conn->prepare($sql);\n    $stmt->bind_param(\"iis\", $productId, $productId, $productId);\n\n    if ($stmt->execute()) {\n      return true;\n    } else {\n      echo \"Error updating product rating and count: \" . $stmt->error;\n      return false;\n    }\n  } else {\n    echo \"Error inserting review: \" . $stmt->error;\n    return false;\n  }\n\n  // Close the prepared statement\n  $stmt->close();\n}\n\nfunction getUserReviews($userId) {\n  global $conn;\n\n  // Select all reviews for the given user ID\n  $sql = \"SELECT * FROM reviews WHERE user_id = ?\";\n  $stmt = $conn->prepare($sql);\n  $stmt->bind_param(\"i\", $userId);\n\n  if ($stmt->execute()) {\n    return $stmt->get_result()->fetch_all(MYSQLI_ASSOC);\n  } else {\n    echo \"Error retrieving reviews: \" . $stmt->error;\n    return false;\n  }\n\n  // Close the prepared statement\n  $stmt->close();\n}\n\nfunction getProductReviews($productId) {\n  global $conn;\n\n  // Select all reviews for the given product ID\n  $sql = \"SELECT * FROM reviews WHERE product_id = ?\";\n  $stmt = $conn->prepare($sql);\n  $stmt->bind_param(\"i\", $productId);\n\n  if ($stmt->execute()) {\n    return $stmt->get_result()->fetch_all(MYSQLI_ASSOC);\n  } else {\n    echo \"Error retrieving reviews: \" . $stmt->error;\n    return false;\n  }\n\n  // Close the prepared statement\n  $stmt->close();\n}\n```\n\n### Example Use Cases\n\n```php\n// Create a new user review\n$data = array(\n  'username' => 'JohnDoe',\n  'email' => 'johndoe@example.com',\n  'product_id' => 1,\n  'rating' => 5,\n  'comment' => 'Great product!'\n);\ncreateUserReview($data);\n\n// Get all reviews for a user\n$userId = 1;\n$userReviews = getUserReviews($userId);\nprint_r($userReviews);\n\n// Get all reviews for a product\n$productId = 1;\n$productReviews = getProductReviews($productId);\nprint_r($productReviews);\n```\n\nNote that this is a basic example and you should adapt it to your specific use case. Additionally, make sure to sanitize user input data properly to prevent SQL injection attacks.\n\nThis code uses the `mysqli` extension for database interactions. If you prefer to use PDO (PHP Data Objects), you can modify the code accordingly.", "code_blocks": [null, "```php\n// Configuration\n$dbHost = 'localhost';\n$dbUsername = 'root';\n$dbPassword = '';\n$dbName = 'reviews';\n\n// Connect to the database\n$conn = new mysqli($dbHost, $dbUsername, $dbPassword, $dbName);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\nfunction createUserReview($data) {\n  global $conn;\n  \n  // Sanitize input data\n  $username = trim($data['username']);\n  $email = trim($data['email']);\n  $productId = (int)$data['product_id'];\n  $rating = (int)$data['rating'];\n  $comment = trim($data['comment']);\n\n  // Insert new review into the database\n  $sql = \"INSERT INTO reviews (user_id, product_id, rating, comment) \n          VALUES (NULL, ?, ?, ?)\";\n  $stmt = $conn->prepare($sql);\n  $stmt->bind_param(\"iis\", $productId, $rating, $comment);\n\n  if ($stmt->execute()) {\n    // Get the last inserted review ID\n    $reviewId = $conn->insert_id;\n\n    // Update product rating and count\n    $sql = \"UPDATE products SET \n            rating = (SELECT AVG(rating) FROM reviews WHERE product_id = ?), \n            review_count = (SELECT COUNT(*) FROM reviews WHERE product_id = ?)\n            WHERE id = ?\";\n    $stmt = $conn->prepare($sql);\n    $stmt->bind_param(\"iis\", $productId, $productId, $productId);\n\n    if ($stmt->execute()) {\n      return true;\n    } else {\n      echo \"Error updating product rating and count: \" . $stmt->error;\n      return false;\n    }\n  } else {\n    echo \"Error inserting review: \" . $stmt->error;\n    return false;\n  }\n\n  // Close the prepared statement\n  $stmt->close();\n}\n\nfunction getUserReviews($userId) {\n  global $conn;\n\n  // Select all reviews for the given user ID\n  $sql = \"SELECT * FROM reviews WHERE user_id = ?\";\n  $stmt = $conn->prepare($sql);\n  $stmt->bind_param(\"i\", $userId);\n\n  if ($stmt->execute()) {\n    return $stmt->get_result()->fetch_all(MYSQLI_ASSOC);\n  } else {\n    echo \"Error retrieving reviews: \" . $stmt->error;\n    return false;\n  }\n\n  // Close the prepared statement\n  $stmt->close();\n}\n\nfunction getProductReviews($productId) {\n  global $conn;\n\n  // Select all reviews for the given product ID\n  $sql = \"SELECT * FROM reviews WHERE product_id = ?\";\n  $stmt = $conn->prepare($sql);\n  $stmt->bind_param(\"i\", $productId);\n\n  if ($stmt->execute()) {\n    return $stmt->get_result()->fetch_all(MYSQLI_ASSOC);\n  } else {\n    echo \"Error retrieving reviews: \" . $stmt->error;\n    return false;\n  }\n\n  // Close the prepared statement\n  $stmt->close();\n}\n```", "```php\n// Create a new user review\n$data = array(\n  'username' => 'JohnDoe',\n  'email' => 'johndoe@example.com',\n  'product_id' => 1,\n  'rating' => 5,\n  'comment' => 'Great product!'\n);\ncreateUserReview($data);\n\n// Get all reviews for a user\n$userId = 1;\n$userReviews = getUserReviews($userId);\nprint_r($userReviews);\n\n// Get all reviews for a product\n$productId = 1;\n$productReviews = getProductReviews($productId);\nprint_r($productReviews);\n```"]}
