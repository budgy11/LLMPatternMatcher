{"prompt": "Create a user review function using php", "llm_output": "**User Review Function in PHP**\n====================================\n\nThis is an example of a simple user review system using PHP. It includes functions for adding, retrieving, updating and deleting reviews.\n\n**Database Schema**\n--------------------\n\nFor this example, we'll assume you have the following database schema:\n\n```sql\nCREATE TABLE users (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  name VARCHAR(255),\n  email VARCHAR(255)\n);\n\nCREATE TABLE products (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  name VARCHAR(255)\n);\n\nCREATE TABLE reviews (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  user_id INT,\n  product_id INT,\n  rating TINYINT,\n  review TEXT,\n  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n  FOREIGN KEY (user_id) REFERENCES users(id),\n  FOREIGN KEY (product_id) REFERENCES products(id)\n);\n```\n\n**PHP Code**\n------------\n\n```php\n<?php\n\n// Include database connection file\nrequire_once 'db.php';\n\n// Function to add a review\nfunction add_review($data) {\n  $stmt = $pdo->prepare(\"INSERT INTO reviews (user_id, product_id, rating, review) VALUES (:user_id, :product_id, :rating, :review)\");\n  $stmt->execute([\n    ':user_id' => $data['user_id'],\n    ':product_id' => $data['product_id'],\n    ':rating' => $data['rating'],\n    ':review' => $data['review']\n  ]);\n  return $pdo->lastInsertId();\n}\n\n// Function to get all reviews for a product\nfunction get_reviews($product_id) {\n  $stmt = $pdo->prepare(\"SELECT * FROM reviews WHERE product_id = :product_id\");\n  $stmt->execute([':product_id' => $product_id]);\n  return $stmt->fetchAll(PDO::FETCH_ASSOC);\n}\n\n// Function to update a review\nfunction update_review($review_id, $data) {\n  $stmt = $pdo->prepare(\"UPDATE reviews SET rating = :rating, review = :review WHERE id = :id\");\n  $stmt->execute([\n    ':rating' => $data['rating'],\n    ':review' => $data['review'],\n    ':id' => $review_id\n  ]);\n}\n\n// Function to delete a review\nfunction delete_review($review_id) {\n  $pdo->exec(\"DELETE FROM reviews WHERE id = :id\", ['id' => $review_id]);\n}\n\n// Example usage:\n$data = [\n  'user_id' => 1,\n  'product_id' => 1,\n  'rating' => 5,\n  'review' => 'Great product!'\n];\n$review_id = add_review($data);\nprint(\"Review added with ID: \" . $review_id);\n\n// Get all reviews for a product\n$product_id = 1;\n$reviews = get_reviews($product_id);\nprint_r($reviews);\n\n// Update a review\n$data['rating'] = 4;\nupdate_review(1, $data);\n\n// Delete a review\ndelete_review(1);\n\n?>\n```\n\n**Explanation**\n---------------\n\nThis code includes the following functions:\n\n*   `add_review`: Adds a new review to the database.\n*   `get_reviews`: Retrieves all reviews for a specific product.\n*   `update_review`: Updates an existing review in the database.\n*   `delete_review`: Deletes a review from the database.\n\nThese functions use prepared statements to prevent SQL injection and ensure data security. You can modify this code to fit your specific requirements and database schema.\n\nRemember to replace the placeholder values with actual database connection credentials and adjust the code according to your project's needs.", "code_blocks": [null, "```php\n<?php\n\n// Include database connection file\nrequire_once 'db.php';\n\n// Function to add a review\nfunction add_review($data) {\n  $stmt = $pdo->prepare(\"INSERT INTO reviews (user_id, product_id, rating, review) VALUES (:user_id, :product_id, :rating, :review)\");\n  $stmt->execute([\n    ':user_id' => $data['user_id'],\n    ':product_id' => $data['product_id'],\n    ':rating' => $data['rating'],\n    ':review' => $data['review']\n  ]);\n  return $pdo->lastInsertId();\n}\n\n// Function to get all reviews for a product\nfunction get_reviews($product_id) {\n  $stmt = $pdo->prepare(\"SELECT * FROM reviews WHERE product_id = :product_id\");\n  $stmt->execute([':product_id' => $product_id]);\n  return $stmt->fetchAll(PDO::FETCH_ASSOC);\n}\n\n// Function to update a review\nfunction update_review($review_id, $data) {\n  $stmt = $pdo->prepare(\"UPDATE reviews SET rating = :rating, review = :review WHERE id = :id\");\n  $stmt->execute([\n    ':rating' => $data['rating'],\n    ':review' => $data['review'],\n    ':id' => $review_id\n  ]);\n}\n\n// Function to delete a review\nfunction delete_review($review_id) {\n  $pdo->exec(\"DELETE FROM reviews WHERE id = :id\", ['id' => $review_id]);\n}\n\n// Example usage:\n$data = [\n  'user_id' => 1,\n  'product_id' => 1,\n  'rating' => 5,\n  'review' => 'Great product!'\n];\n$review_id = add_review($data);\nprint(\"Review added with ID: \" . $review_id);\n\n// Get all reviews for a product\n$product_id = 1;\n$reviews = get_reviews($product_id);\nprint_r($reviews);\n\n// Update a review\n$data['rating'] = 4;\nupdate_review(1, $data);\n\n// Delete a review\ndelete_review(1);\n\n?>\n```"]}
