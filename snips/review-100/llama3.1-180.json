{"prompt": "Create a user review function using php", "llm_output": "**User Review Function in PHP**\n=====================================\n\nBelow is an example of how you can create a simple user review function in PHP. This example includes the basic features such as creating reviews, displaying reviews, and calculating ratings.\n\n**Database Setup**\n-----------------\n\nFirst, we'll assume you have a database set up with the following tables:\n\n*   `users`: contains information about users\n*   `products`: contains information about products\n*   `reviews`: contains user reviews for products\n\n```sql\nCREATE TABLE users (\n    id INT PRIMARY KEY AUTO_INCREMENT,\n    name VARCHAR(255) NOT NULL,\n    email VARCHAR(255) UNIQUE NOT NULL\n);\n\nCREATE TABLE products (\n    id INT PRIMARY KEY AUTO_INCREMENT,\n    title VARCHAR(255) NOT NULL,\n    description TEXT\n);\n\nCREATE TABLE reviews (\n    id INT PRIMARY KEY AUTO_INCREMENT,\n    user_id INT NOT NULL,\n    product_id INT NOT NULL,\n    review_text TEXT NOT NULL,\n    rating TINYINT NOT NULL,\n    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n    FOREIGN KEY (user_id) REFERENCES users(id),\n    FOREIGN KEY (product_id) REFERENCES products(id)\n);\n```\n\n**PHP Code**\n-------------\n\n```php\n<?php\n\n// Include the database connection file\nrequire_once 'db.php';\n\nclass Review {\n    public function createReview($data) {\n        // Sanitize input data\n        $user_id = mysqli_real_escape_string($GLOBALS['conn'], $data['user_id']);\n        $product_id = mysqli_real_escape_string($GLOBALS['conn'], $data['product_id']);\n        $review_text = mysqli_real_escape_string($GLOBALS['conn'], $data['review_text']);\n        $rating = mysqli_real_escape_string($GLOBALS['conn'], $data['rating']);\n\n        // Query to insert review into database\n        $query = \"INSERT INTO reviews (user_id, product_id, review_text, rating) VALUES ('$user_id', '$product_id', '$review_text', '$rating')\";\n        if (mysqli_query($GLOBALS['conn'], $query)) {\n            return true; // Review created successfully\n        } else {\n            return false; // Error creating review\n        }\n    }\n\n    public function getReviewsByProduct($productId) {\n        // Query to retrieve reviews for a specific product\n        $query = \"SELECT * FROM reviews WHERE product_id = '$productId' ORDER BY id DESC\";\n        $result = mysqli_query($GLOBALS['conn'], $query);\n        if ($result && mysqli_num_rows($result) > 0) {\n            return $result; // Reviews retrieved successfully\n        } else {\n            return false; // Error retrieving reviews\n        }\n    }\n\n    public function calculateRating($productId) {\n        // Query to retrieve rating for a specific product\n        $query = \"SELECT AVG(rating) AS average_rating FROM reviews WHERE product_id = '$productId'\";\n        $result = mysqli_query($GLOBALS['conn'], $query);\n        if ($result && mysqli_num_rows($result) > 0) {\n            return mysqli_fetch_assoc($result)['average_rating']; // Rating retrieved successfully\n        } else {\n            return false; // Error retrieving rating\n        }\n    }\n}\n\n// Example usage:\n$review = new Review();\n\n$data = array(\n    'user_id' => 1,\n    'product_id' => 1,\n    'review_text' => 'This product is great!',\n    'rating' => 5\n);\n\nif ($review->createReview($data)) {\n    echo \"Review created successfully!\";\n} else {\n    echo \"Error creating review.\";\n}\n\n$reviews = $review->getReviewsByProduct(1);\nif ($reviews) {\n    while ($row = mysqli_fetch_assoc($reviews)) {\n        echo \"User ID: \" . $row['user_id'] . \", Review Text: \" . $row['review_text'] . \", Rating: \" . $row['rating'] . \"\\n\";\n    }\n} else {\n    echo \"Error retrieving reviews.\";\n}\n\n$rating = $review->calculateRating(1);\nif ($rating) {\n    echo \"Average rating for product 1 is: \" . $rating;\n} else {\n    echo \"Error retrieving rating.\";\n}\n```\n\nThis example demonstrates how to create a review, retrieve reviews for a specific product, and calculate the average rating for a product. You can modify it according to your requirements and database schema.\n\n**Please note**: This code uses `mysqli` extension for interacting with the database. It's recommended to use prepared statements to prevent SQL injection attacks.", "code_blocks": [null, "```php\n<?php\n\n// Include the database connection file\nrequire_once 'db.php';\n\nclass Review {\n    public function createReview($data) {\n        // Sanitize input data\n        $user_id = mysqli_real_escape_string($GLOBALS['conn'], $data['user_id']);\n        $product_id = mysqli_real_escape_string($GLOBALS['conn'], $data['product_id']);\n        $review_text = mysqli_real_escape_string($GLOBALS['conn'], $data['review_text']);\n        $rating = mysqli_real_escape_string($GLOBALS['conn'], $data['rating']);\n\n        // Query to insert review into database\n        $query = \"INSERT INTO reviews (user_id, product_id, review_text, rating) VALUES ('$user_id', '$product_id', '$review_text', '$rating')\";\n        if (mysqli_query($GLOBALS['conn'], $query)) {\n            return true; // Review created successfully\n        } else {\n            return false; // Error creating review\n        }\n    }\n\n    public function getReviewsByProduct($productId) {\n        // Query to retrieve reviews for a specific product\n        $query = \"SELECT * FROM reviews WHERE product_id = '$productId' ORDER BY id DESC\";\n        $result = mysqli_query($GLOBALS['conn'], $query);\n        if ($result && mysqli_num_rows($result) > 0) {\n            return $result; // Reviews retrieved successfully\n        } else {\n            return false; // Error retrieving reviews\n        }\n    }\n\n    public function calculateRating($productId) {\n        // Query to retrieve rating for a specific product\n        $query = \"SELECT AVG(rating) AS average_rating FROM reviews WHERE product_id = '$productId'\";\n        $result = mysqli_query($GLOBALS['conn'], $query);\n        if ($result && mysqli_num_rows($result) > 0) {\n            return mysqli_fetch_assoc($result)['average_rating']; // Rating retrieved successfully\n        } else {\n            return false; // Error retrieving rating\n        }\n    }\n}\n\n// Example usage:\n$review = new Review();\n\n$data = array(\n    'user_id' => 1,\n    'product_id' => 1,\n    'review_text' => 'This product is great!',\n    'rating' => 5\n);\n\nif ($review->createReview($data)) {\n    echo \"Review created successfully!\";\n} else {\n    echo \"Error creating review.\";\n}\n\n$reviews = $review->getReviewsByProduct(1);\nif ($reviews) {\n    while ($row = mysqli_fetch_assoc($reviews)) {\n        echo \"User ID: \" . $row['user_id'] . \", Review Text: \" . $row['review_text'] . \", Rating: \" . $row['rating'] . \"\\n\";\n    }\n} else {\n    echo \"Error retrieving reviews.\";\n}\n\n$rating = $review->calculateRating(1);\nif ($rating) {\n    echo \"Average rating for product 1 is: \" . $rating;\n} else {\n    echo \"Error retrieving rating.\";\n}\n```"]}
