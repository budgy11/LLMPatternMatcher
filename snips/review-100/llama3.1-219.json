{"prompt": "Create a user review function using php", "llm_output": "**User Review Function in PHP**\n=====================================\n\nBelow is an example of a user review function written in PHP. This function will allow users to submit reviews, view all reviews, and also rate products based on their experience.\n\n### Database Schema\n------------------\n\nFor this example, we'll assume you have the following database schema:\n\n```sql\nCREATE TABLE products (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  name VARCHAR(255) NOT NULL\n);\n\nCREATE TABLE reviews (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  product_id INT NOT NULL,\n  user_name VARCHAR(255),\n  review TEXT NOT NULL,\n  rating TINYINT NOT NULL,\n  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n  FOREIGN KEY (product_id) REFERENCES products(id)\n);\n```\n\n### PHP Function\n----------------\n\n```php\nfunction getReviews($productId = null, $rating = null, $limit = 10, $offset = 0) {\n  global $db;\n\n  if ($productId !== null && !$db->query(\"SELECT * FROM reviews WHERE product_id = '$productId'\")->num_rows) {\n    return array();\n  }\n\n  $query = \"SELECT * FROM reviews\";\n  if ($rating !== null) {\n    $query .= \" WHERE rating = '$rating'\";\n  }\n  if ($productId !== null) {\n    $query .= \" AND product_id = '$productId'\";\n  }\n\n  $results = $db->query($query . \" LIMIT $limit OFFSET $offset\")->fetchAll();\n\n  return $results;\n}\n\nfunction addReview($data) {\n  global $db;\n\n  try {\n    $product_id = intval($data['product_id']);\n    $user_name = trim($data['name']);\n    $review = trim($data['review']);\n    $rating = intval($data['rating']);\n\n    if (empty($user_name)) {\n      throw new Exception(\"Please enter your name.\");\n    }\n    if (empty($review)) {\n      throw new Exception(\"Please enter a review.\");\n    }\n    if (!in_array($rating, array(1, 2, 3, 4, 5))) {\n      throw new Exception(\"Rating must be between 1 and 5.\");\n    }\n\n    $db->query(\"INSERT INTO reviews (product_id, user_name, review, rating) VALUES ('$product_id', '$user_name', '$review', '$rating')\");\n  } catch (Exception $e) {\n    return array('error' => $e->getMessage());\n  }\n}\n```\n\n### Usage\n--------\n\nTo use the above functions, you'll need to include them in your PHP script. You can do this by calling `include 'reviews.php';`.\n\n**Submit a Review:**\n\n```php\n$data = array(\n  'name' => $_POST['username'],\n  'review' => $_POST['review'],\n  'rating' => intval($_POST['rating']),\n  'product_id' => intval($_POST['product_id'])\n);\n\n$results = addReview($data);\nif (isset($results['error'])) {\n  // error handling\n}\n```\n\n**View All Reviews:**\n\n```php\n$reviews = getReviews();\nprint_r($reviews);\n```\n\nYou can also filter reviews by product ID or rating.", "code_blocks": [null, "```php\nfunction getReviews($productId = null, $rating = null, $limit = 10, $offset = 0) {\n  global $db;\n\n  if ($productId !== null && !$db->query(\"SELECT * FROM reviews WHERE product_id = '$productId'\")->num_rows) {\n    return array();\n  }\n\n  $query = \"SELECT * FROM reviews\";\n  if ($rating !== null) {\n    $query .= \" WHERE rating = '$rating'\";\n  }\n  if ($productId !== null) {\n    $query .= \" AND product_id = '$productId'\";\n  }\n\n  $results = $db->query($query . \" LIMIT $limit OFFSET $offset\")->fetchAll();\n\n  return $results;\n}\n\nfunction addReview($data) {\n  global $db;\n\n  try {\n    $product_id = intval($data['product_id']);\n    $user_name = trim($data['name']);\n    $review = trim($data['review']);\n    $rating = intval($data['rating']);\n\n    if (empty($user_name)) {\n      throw new Exception(\"Please enter your name.\");\n    }\n    if (empty($review)) {\n      throw new Exception(\"Please enter a review.\");\n    }\n    if (!in_array($rating, array(1, 2, 3, 4, 5))) {\n      throw new Exception(\"Rating must be between 1 and 5.\");\n    }\n\n    $db->query(\"INSERT INTO reviews (product_id, user_name, review, rating) VALUES ('$product_id', '$user_name', '$review', '$rating')\");\n  } catch (Exception $e) {\n    return array('error' => $e->getMessage());\n  }\n}\n```", "```php\n$data = array(\n  'name' => $_POST['username'],\n  'review' => $_POST['review'],\n  'rating' => intval($_POST['rating']),\n  'product_id' => intval($_POST['product_id'])\n);\n\n$results = addReview($data);\nif (isset($results['error'])) {\n  // error handling\n}\n```", "```php\n$reviews = getReviews();\nprint_r($reviews);\n```"]}
