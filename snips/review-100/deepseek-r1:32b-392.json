{"prompt": "Create a user review function using php", "llm_output": "<think>\nOkay, I need to create a user review function using PHP. Let me think about how to approach this.\n\nFirst, the function should allow users to leave reviews and ratings for products or services. So, I'll need a form where users can input their name, email, rating from 1 to 5, and their comment.\n\nI should start by setting up an HTML structure with a form. The form will have fields for name, email, rating as radio buttons, and a textarea for the review. Also, I'll include a submit button.\n\nNext, I need to handle form submission in PHP. So, when the user submits the form, the data should be processed. I'll check if the form is submitted using isset($_POST['submit']).\n\nI should validate all inputs to ensure they're not empty and meet certain criteria. For example, name should be at least 3 characters, email should be a valid format, rating must be selected, and comment should be at least 5 characters.\n\nIf validation passes, I'll insert the data into a MySQL database. I'll need to sanitize inputs to prevent SQL injection using mysqli_real_escape_string. Also, I'll check if the insertion was successful and display appropriate messages.\n\nIf there are errors in validation or submission, I'll display error messages to the user so they can correct their input.\n\nAdditionally, I should retrieve and display existing reviews from the database. This will show all previous reviews along with each user's name, rating stars, comment, and the date submitted.\n\nI should also format the ratings as stars for better readability. For example, a rating of 4 would display four filled star icons and one empty.\n\nSecurity is important, so I'll make sure to use prepared statements or parameterized queries in the future to prevent SQL injection, but for now, using mysqli_real_escape_string is a basic step.\n\nTesting each part as I go will help catch any issues early. For example, checking if the form correctly submits data and displays it on the page after submission.\n\nFinally, I'll structure the code with proper HTML, PHP, and CSS to make sure everything looks clean and functions smoothly.\n</think>\n\nHere's an example of a user review system in PHP that allows users to submit reviews and ratings for products or services:\n\n```php\n<?php\n// Connect to the database\n$host = 'localhost';\n$username = 'username';\n$password = 'password';\n$dbname = 'reviews_db';\n\n$conn = mysqli_connect($host, $username, $password, $dbname);\n\nif (!$conn) {\n    die(\"Connection failed: \" . mysqli_connect_error());\n}\n\n// Handle form submission\nif (isset($_POST['submit'])) {\n    // Sanitize and validate input data\n    $name = mysqli_real_escape_string($conn, $_POST['name']);\n    $email = mysqli_real_escape_string($conn, $_POST['email']);\n    $rating = isset($_POST['rating']) ? intval($_POST['rating']) : 0;\n    $comment = mysqli_real_escape_string($conn, $_POST['comment']);\n\n    // Input validation\n    $errors = array();\n    if (empty($name) || strlen($name) < 3) {\n        $errors[] = \"Please enter a valid name (minimum 3 characters)\";\n    }\n    if (!filter_var($email, FILTER_VALIDATE_EMAIL)) {\n        $errors[] = \"Please enter a valid email address\";\n    }\n    if ($rating == 0) {\n        $errors[] = \"Please select a rating\";\n    }\n    if (empty($comment) || strlen($comment) < 5) {\n        $errors[] = \"Please write a comment (minimum 5 characters)\";\n    }\n\n    // If no errors, insert into database\n    if (count($errors) == 0) {\n        $sql = \"INSERT INTO reviews (name, email, rating, comment, created_at)\n                VALUES ('$name', '$email', $rating, '$comment', NOW())\";\n\n        if (mysqli_query($conn, $sql)) {\n            echo \"<p class='success'>Thank you for your review!</p>\";\n        } else {\n            echo \"Error: \" . mysqli_error($conn);\n        }\n    } else {\n        foreach ($errors as $error) {\n            echo \"<p class='error'>$error</p>\";\n        }\n    }\n}\n\n// Retrieve and display all reviews\n$sql = \"SELECT * FROM reviews ORDER BY created_at DESC\";\n$result = mysqli_query($conn, $sql);\n\nif (mysqli_num_rows($result) > 0) {\n    while ($row = mysqli_fetch_assoc($result)) {\n        $rating_stars = str_repeat(\"\u2605\", $row['rating']) . str_repeat(\"\u2606\", 5 - $row['rating']);\n        echo \"\n            <div class='review'>\n                <h3>{$row['name']}</h3>\n                <p class='rating'>$rating_stars</p>\n                <p class='comment'>{$row['comment']}</p>\n                <small>Submitted on: \" . date('F j, Y', strtotime($row['created_at'])) . \"</small>\n            </div>\n        \";\n    }\n} else {\n    echo \"<p>No reviews found. Be the first to review!</p>\";\n}\n\n// Close database connection\nmysqli_close($conn);\n?>\n\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <title>Product Reviews</title>\n    <style>\n        .review {\n            border: 1px solid #ddd;\n            padding: 15px;\n            margin-bottom: 10px;\n        }\n        .rating {\n            color: #ff6b35;\n            font-size: 24px;\n        }\n        .error { color: red; }\n        .success { color: green; }\n    </style>\n</head>\n<body>\n    <h1>Product Reviews</h1>\n\n    <!-- Review Form -->\n    <div class='review-form'>\n        <h2>Submit Your Review</h2>\n        <form action='<?php echo $_SERVER['PHP_SELF']; ?>' method='post'>\n            <label for='name'>Name:</label>\n            <input type='text' id='name' name='name' required><br>\n\n            <label for='email'>Email:</label>\n            <input type='email' id='email' name='email' required><br>\n\n            <label>Rating:</label>\n            <div class='rating-stars'>\n                <input type='radio' name='rating' value='5'> \u2605\u2605\u2605\u2605\u2605<br>\n                <input type='radio' name='rating' value='4'> \u2605\u2605\u2605\u2605\u2606<br>\n                <input type='radio' name='rating' value='3'> \u2605\u2605\u2605\u2606\u2606<br>\n                <input type='radio' name='rating' value='2'> \u2605\u2605\u2606\u2606\u2606<br>\n                <input type='radio' name='rating' value='1'> \u2605\u2606\u2606\u2606\u2606\n            </div><br>\n\n            <label for='comment'>Comment:</label>\n            <textarea id='comment' name='comment' rows='4' required></textarea><br>\n\n            <input type='submit' name='submit' value='Submit Review'>\n        </form>\n    </div>\n</body>\n</html>\n```\n\nThis code includes:\n\n1. A form for users to submit reviews with:\n   - Name field\n   - Email field\n   - Rating system (1-5 stars)\n   - Comment textarea\n\n2. Input validation and sanitization:\n   - Checks for minimum lengths for name and comment\n   - Validates email format\n   - Ensures rating is selected\n   - Sanitizes input data to prevent SQL injection\n\n3. Database operations:\n   - Connects to a MySQL database\n   - Inserts new reviews into the database\n   - Retrieves and displays existing reviews\n\n4. Error handling:\n   - Displays error messages for invalid input\n   - Shows success message when review is submitted\n\n5. Review display:\n   - Shows all reviews with user name, rating stars, comment, and submission date\n   - Formats ratings as stars (e.g., \u2605\u2605\u2605\u2606\u2606)\n\nTo use this code:\n\n1. Create a MySQL database named `reviews_db`\n2. Create a table named `reviews` with columns:\n   - id (INT AUTO_INCREMENT PRIMARY KEY)\n   - name (VARCHAR(100))\n   - email (VARCHAR(100))\n   - rating (TINYINT)\n   - comment (TEXT)\n   - created_at (DATETIME)\n3. Update the database connection details in the code\n4. Save the file with a .php extension and run it on a web server\n\nFeatures:\n- Users can submit reviews with ratings\n- Reviews are stored in a database\n- All reviews are displayed below the submission form\n- Input validation is performed\n- Error messages are shown for invalid submissions\n- Ratings are displayed as stars\n- Reviews show the submission date\n\nYou can customize this further by:\n- Adding user authentication\n- Implementing review editing/deletion\n- Adding product selection functionality\n- Improving the styling with CSS\n- Adding more validation checks\n- Implementing a rating average system", "code_blocks": ["```php\n<?php\n// Connect to the database\n$host = 'localhost';\n$username = 'username';\n$password = 'password';\n$dbname = 'reviews_db';\n\n$conn = mysqli_connect($host, $username, $password, $dbname);\n\nif (!$conn) {\n    die(\"Connection failed: \" . mysqli_connect_error());\n}\n\n// Handle form submission\nif (isset($_POST['submit'])) {\n    // Sanitize and validate input data\n    $name = mysqli_real_escape_string($conn, $_POST['name']);\n    $email = mysqli_real_escape_string($conn, $_POST['email']);\n    $rating = isset($_POST['rating']) ? intval($_POST['rating']) : 0;\n    $comment = mysqli_real_escape_string($conn, $_POST['comment']);\n\n    // Input validation\n    $errors = array();\n    if (empty($name) || strlen($name) < 3) {\n        $errors[] = \"Please enter a valid name (minimum 3 characters)\";\n    }\n    if (!filter_var($email, FILTER_VALIDATE_EMAIL)) {\n        $errors[] = \"Please enter a valid email address\";\n    }\n    if ($rating == 0) {\n        $errors[] = \"Please select a rating\";\n    }\n    if (empty($comment) || strlen($comment) < 5) {\n        $errors[] = \"Please write a comment (minimum 5 characters)\";\n    }\n\n    // If no errors, insert into database\n    if (count($errors) == 0) {\n        $sql = \"INSERT INTO reviews (name, email, rating, comment, created_at)\n                VALUES ('$name', '$email', $rating, '$comment', NOW())\";\n\n        if (mysqli_query($conn, $sql)) {\n            echo \"<p class='success'>Thank you for your review!</p>\";\n        } else {\n            echo \"Error: \" . mysqli_error($conn);\n        }\n    } else {\n        foreach ($errors as $error) {\n            echo \"<p class='error'>$error</p>\";\n        }\n    }\n}\n\n// Retrieve and display all reviews\n$sql = \"SELECT * FROM reviews ORDER BY created_at DESC\";\n$result = mysqli_query($conn, $sql);\n\nif (mysqli_num_rows($result) > 0) {\n    while ($row = mysqli_fetch_assoc($result)) {\n        $rating_stars = str_repeat(\"\u2605\", $row['rating']) . str_repeat(\"\u2606\", 5 - $row['rating']);\n        echo \"\n            <div class='review'>\n                <h3>{$row['name']}</h3>\n                <p class='rating'>$rating_stars</p>\n                <p class='comment'>{$row['comment']}</p>\n                <small>Submitted on: \" . date('F j, Y', strtotime($row['created_at'])) . \"</small>\n            </div>\n        \";\n    }\n} else {\n    echo \"<p>No reviews found. Be the first to review!</p>\";\n}\n\n// Close database connection\nmysqli_close($conn);\n?>\n\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <title>Product Reviews</title>\n    <style>\n        .review {\n            border: 1px solid #ddd;\n            padding: 15px;\n            margin-bottom: 10px;\n        }\n        .rating {\n            color: #ff6b35;\n            font-size: 24px;\n        }\n        .error { color: red; }\n        .success { color: green; }\n    </style>\n</head>\n<body>\n    <h1>Product Reviews</h1>\n\n    <!-- Review Form -->\n    <div class='review-form'>\n        <h2>Submit Your Review</h2>\n        <form action='<?php echo $_SERVER['PHP_SELF']; ?>' method='post'>\n            <label for='name'>Name:</label>\n            <input type='text' id='name' name='name' required><br>\n\n            <label for='email'>Email:</label>\n            <input type='email' id='email' name='email' required><br>\n\n            <label>Rating:</label>\n            <div class='rating-stars'>\n                <input type='radio' name='rating' value='5'> \u2605\u2605\u2605\u2605\u2605<br>\n                <input type='radio' name='rating' value='4'> \u2605\u2605\u2605\u2605\u2606<br>\n                <input type='radio' name='rating' value='3'> \u2605\u2605\u2605\u2606\u2606<br>\n                <input type='radio' name='rating' value='2'> \u2605\u2605\u2606\u2606\u2606<br>\n                <input type='radio' name='rating' value='1'> \u2605\u2606\u2606\u2606\u2606\n            </div><br>\n\n            <label for='comment'>Comment:</label>\n            <textarea id='comment' name='comment' rows='4' required></textarea><br>\n\n            <input type='submit' name='submit' value='Submit Review'>\n        </form>\n    </div>\n</body>\n</html>\n```"]}
