{"prompt": "Create a user review function using php", "llm_output": "<think>\nOkay, I need to create a user review function using PHP. Let me think about how to approach this.\n\nFirst, the function should allow users to submit their reviews. So, I'll probably use an HTML form for that. The form needs fields like name, email, rating, and comments. That makes sense because those are common fields in review systems.\n\nNext, the data from the form needs to be processed on the server side using PHP. I remember that forms send data via POST or GET methods. So, I'll use POST for security reasons. Then, I should validate the input to make sure all required fields are filled and that the email is valid. Validation is crucial to prevent errors and spam.\n\nAfter validation, I need to store the review somewhere. A database seems appropriate here because it can handle storing multiple reviews and allow easy retrieval later. I'll probably use MySQL or MariaDB since they're commonly used with PHP. So, I'll set up a database connection using mysqli_connect and create a table to hold the reviews.\n\nOnce the data is validated and connected to the database, I can insert the review into the table using an INSERT query. But wait, I should be careful about SQL injection. Maybe I should use prepared statements or at least escape the inputs properly. Hmm, in this example, maybe it's okay without prepared statements for simplicity, but I should note that it's important to sanitize inputs in a real-world scenario.\n\nThen, after submitting, the user should see a confirmation message and all the reviews displayed. So, I need to fetch the reviews from the database and display them on the same page or another one. For each review, I'll show the name, email, rating as stars, and comments. Using emojis for stars could be a quick way without CSS.\n\nPutting it all together, the PHP script will handle form submission, validation, database operations, and displaying the reviews. The HTML part includes the form and dynamic content to show the reviews.\n\nWait, I should also consider error handling. What if the database connection fails? Or the INSERT doesn't work? Adding some error messages would be good for debugging. Also, checking if the submission was successful before redirecting or showing a message.\n\nOh, and the user might want to see all reviews after submitting one. So, in the PHP script, I'll fetch all entries from the reviews table and loop through them to display each as a list item with their details.\n\nI think that covers the main points. Now, putting it into code: first the HTML form, then the PHP logic for handling submission, validation, database interaction, and displaying results. I should structure the code so that if the form is submitted (i.e., POST data exists), it processes the submission; otherwise, it just displays the form and existing reviews.\n\nAlso, I'll include some basic styling in the HTML to make it look presentable without external CSS files. Using inline styles for simplicity.\n\nIn summary, the steps are:\n1. Create an HTML form with necessary fields.\n2. Use PHP to handle form submission.\n3. Validate input data.\n4. Connect to a MySQL database and insert the review.\n5. Fetch and display all reviews from the database.\n6. Provide feedback on submission success or errors.\n\nI think that's a solid plan. Now, time to write the code accordingly, making sure each part works as intended.\n</think>\n\nHere\u2019s an example of a user review function using PHP:\n\n```php\n<?php\n// Database connection details\n$host = 'localhost';\n$username = 'root';\n$password = '';\n$dbname = 'reviews';\n\n// Connect to database\n$conn = mysqli_connect($host, $username, $password, $dbname);\n\nif (!$conn) {\n    die(\"Connection failed: \" . mysqli_connect_error());\n}\n\n// Handle form submission\nif ($_SERVER[\"REQUEST_METHOD\"] == \"POST\") {\n    // Sanitize and validate input data\n    $name = htmlspecialchars(trim($_POST['name']));\n    $email = htmlspecialchars(trim($_POST['email']));\n    $rating = intval($_POST['rating']);\n    $comment = htmlspecialchars(trim($_POST['comment']));\n\n    if (empty($name) || empty($email) || empty($rating) || empty($comment)) {\n        die(\"Please fill in all required fields.\");\n    }\n\n    // Validate email format\n    if (!filter_var($email, FILTER_VALIDATE_EMAIL)) {\n        die(\"Invalid email format.\");\n    }\n\n    // Insert review into database\n    $sql = \"INSERT INTO reviews (name, email, rating, comment) VALUES (?, ?, ?, ?)\";\n    \n    if ($stmt = mysqli_prepare($conn, $sql)) {\n        // Bind parameters\n        mysqli_stmt_bind_param($stmt, \"ssis\", $name, $email, $rating, $comment);\n        \n        // Execute statement\n        if (!mysqli_stmt_execute($stmt)) {\n            die(\"Error submitting review: \" . mysqli_error($conn));\n        }\n        \n        // Close statement\n        mysqli_stmt_close($stmt);\n    }\n\n    // Redirect back to the same page after submission\n    header(\"Location: \" . $_SERVER[\"PHP_SELF\"]);\n    exit();\n}\n\n// Retrieve reviews from database\n$sql = \"SELECT * FROM reviews ORDER BY id DESC\";\n$result = mysqli_query($conn, $sql);\n\nif (!$result) {\n    die(\"Error fetching reviews: \" . mysqli_error($conn));\n}\n?>\n\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Product Reviews</title>\n    <style>\n        body {\n            font-family: Arial, sans-serif;\n            max-width: 800px;\n            margin: 0 auto;\n            padding: 20px;\n        }\n        .review-form {\n            border: 1px solid #ddd;\n            padding: 20px;\n            margin-bottom: 20px;\n        }\n        .review-item {\n            background-color: #f9f9f9;\n            padding: 15px;\n            margin-bottom: 15px;\n            border-radius: 5px;\n        }\n        .stars {\n            color: gold;\n        }\n    </style>\n</head>\n<body>\n    <h1>Product Reviews</h1>\n\n    <!-- Review Form -->\n    <div class=\"review-form\">\n        <form action=\"<?php echo htmlspecialchars($_SERVER[\"PHP_SELF\"]); ?>\" method=\"POST\">\n            <div>\n                <label for=\"name\">Name:</label><br>\n                <input type=\"text\" id=\"name\" name=\"name\" required>\n            </div>\n            \n            <div>\n                <label for=\"email\">Email:</label><br>\n                <input type=\"email\" id=\"email\" name=\"email\" required>\n            </div>\n            \n            <div>\n                <label for=\"rating\">Rating:</label><br>\n                <select id=\"rating\" name=\"rating\" required>\n                    <option value=\"\">Select Rating</option>\n                    <option value=\"5\">\u2b50\u2b50\u2b50\u2b50\u2b50</option>\n                    <option value=\"4\">\u2b50\u2b50\u2b50\u2b50</option>\n                    <option value=\"3\">\u2b50\u2b50\u2b50</option>\n                    <option value=\"2\">\u2b50\u2b50</option>\n                    <option value=\"1\">\u2b50</option>\n                </select>\n            </div>\n\n            <div>\n                <label for=\"comment\">Comment:</label><br>\n                <textarea id=\"comment\" name=\"comment\" rows=\"4\" required></textarea>\n            </div>\n            \n            <button type=\"submit\">Submit Review</button>\n        </form>\n    </div>\n\n    <!-- Display Reviews -->\n    <?php if (mysqli_num_rows($result) > 0): ?>\n        <h2>Customer Reviews</h2>\n        <?php while ($row = mysqli_fetch_assoc($result)): ?>\n            <div class=\"review-item\">\n                <strong><?php echo $row['name']; ?></strong><br>\n                <span class=\"stars\"><?php echo str_repeat(\"\u2b50\", $row['rating']); ?></span><br>\n                <em><?php echo $row['email']; ?></em><br><br>\n                <?php echo $row['comment']; ?>\n            </div>\n        <?php endwhile; ?>\n    <?php else: ?>\n        <p>No reviews available yet.</p>\n    <?php endif; ?>\n\n    <!-- Close database connection -->\n    <?php mysqli_close($conn); ?>\n</body>\n</html>\n```\n\nThis code creates a complete review system with the following features:\n\n1. A form for users to submit their reviews, including:\n   - Name field\n   - Email field\n   - Rating selection (1-5 stars)\n   - Comment textarea\n\n2. Input validation and sanitization:\n   - Required fields check\n   - Email format validation\n   - Proper escaping of input data\n\n3. Database integration:\n   - Connects to a MySQL/MariaDB database\n   - Stores reviews in a table\n   - Retrieves and displays stored reviews\n\n4. Display of existing reviews:\n   - Shows all submitted reviews\n   - formats ratings as stars\n   - displays name, email, rating, and comment for each review\n\nTo use this code:\n\n1. Make sure you have a database set up with the following details:\n   - Host: localhost (or your database host)\n   - Username: root (or your database username)\n   - Password:  (leave empty if no password)\n   - Database name: reviews (create this database first)\n\n2. Create a table in your database named `reviews` with these columns:\n   ```sql\n   CREATE TABLE reviews (\n       id INT AUTO_INCREMENT PRIMARY KEY,\n       name VARCHAR(100) NOT NULL,\n       email VARCHAR(100) NOT NULL,\n       rating TINYINT NOT NULL,\n       comment TEXT NOT NULL,\n       timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n   );\n   ```\n\n3. Save this code as an HTML file (e.g., `reviews.php`)\n\n4. Access it through your web browser\n\nThe system will allow users to submit reviews and display all previously submitted reviews in a user-friendly format.\n\nNote: In a production environment, you should:\n- Use prepared statements with parameterized queries\n- Implement CSRF protection\n- Add more comprehensive error handling\n- Protect against brute force attacks\n- Use HTTPS for secure data transmission", "code_blocks": ["```php\n<?php\n// Database connection details\n$host = 'localhost';\n$username = 'root';\n$password = '';\n$dbname = 'reviews';\n\n// Connect to database\n$conn = mysqli_connect($host, $username, $password, $dbname);\n\nif (!$conn) {\n    die(\"Connection failed: \" . mysqli_connect_error());\n}\n\n// Handle form submission\nif ($_SERVER[\"REQUEST_METHOD\"] == \"POST\") {\n    // Sanitize and validate input data\n    $name = htmlspecialchars(trim($_POST['name']));\n    $email = htmlspecialchars(trim($_POST['email']));\n    $rating = intval($_POST['rating']);\n    $comment = htmlspecialchars(trim($_POST['comment']));\n\n    if (empty($name) || empty($email) || empty($rating) || empty($comment)) {\n        die(\"Please fill in all required fields.\");\n    }\n\n    // Validate email format\n    if (!filter_var($email, FILTER_VALIDATE_EMAIL)) {\n        die(\"Invalid email format.\");\n    }\n\n    // Insert review into database\n    $sql = \"INSERT INTO reviews (name, email, rating, comment) VALUES (?, ?, ?, ?)\";\n    \n    if ($stmt = mysqli_prepare($conn, $sql)) {\n        // Bind parameters\n        mysqli_stmt_bind_param($stmt, \"ssis\", $name, $email, $rating, $comment);\n        \n        // Execute statement\n        if (!mysqli_stmt_execute($stmt)) {\n            die(\"Error submitting review: \" . mysqli_error($conn));\n        }\n        \n        // Close statement\n        mysqli_stmt_close($stmt);\n    }\n\n    // Redirect back to the same page after submission\n    header(\"Location: \" . $_SERVER[\"PHP_SELF\"]);\n    exit();\n}\n\n// Retrieve reviews from database\n$sql = \"SELECT * FROM reviews ORDER BY id DESC\";\n$result = mysqli_query($conn, $sql);\n\nif (!$result) {\n    die(\"Error fetching reviews: \" . mysqli_error($conn));\n}\n?>\n\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Product Reviews</title>\n    <style>\n        body {\n            font-family: Arial, sans-serif;\n            max-width: 800px;\n            margin: 0 auto;\n            padding: 20px;\n        }\n        .review-form {\n            border: 1px solid #ddd;\n            padding: 20px;\n            margin-bottom: 20px;\n        }\n        .review-item {\n            background-color: #f9f9f9;\n            padding: 15px;\n            margin-bottom: 15px;\n            border-radius: 5px;\n        }\n        .stars {\n            color: gold;\n        }\n    </style>\n</head>\n<body>\n    <h1>Product Reviews</h1>\n\n    <!-- Review Form -->\n    <div class=\"review-form\">\n        <form action=\"<?php echo htmlspecialchars($_SERVER[\"PHP_SELF\"]); ?>\" method=\"POST\">\n            <div>\n                <label for=\"name\">Name:</label><br>\n                <input type=\"text\" id=\"name\" name=\"name\" required>\n            </div>\n            \n            <div>\n                <label for=\"email\">Email:</label><br>\n                <input type=\"email\" id=\"email\" name=\"email\" required>\n            </div>\n            \n            <div>\n                <label for=\"rating\">Rating:</label><br>\n                <select id=\"rating\" name=\"rating\" required>\n                    <option value=\"\">Select Rating</option>\n                    <option value=\"5\">\u2b50\u2b50\u2b50\u2b50\u2b50</option>\n                    <option value=\"4\">\u2b50\u2b50\u2b50\u2b50</option>\n                    <option value=\"3\">\u2b50\u2b50\u2b50</option>\n                    <option value=\"2\">\u2b50\u2b50</option>\n                    <option value=\"1\">\u2b50</option>\n                </select>\n            </div>\n\n            <div>\n                <label for=\"comment\">Comment:</label><br>\n                <textarea id=\"comment\" name=\"comment\" rows=\"4\" required></textarea>\n            </div>\n            \n            <button type=\"submit\">Submit Review</button>\n        </form>\n    </div>\n\n    <!-- Display Reviews -->\n    <?php if (mysqli_num_rows($result) > 0): ?>\n        <h2>Customer Reviews</h2>\n        <?php while ($row = mysqli_fetch_assoc($result)): ?>\n            <div class=\"review-item\">\n                <strong><?php echo $row['name']; ?></strong><br>\n                <span class=\"stars\"><?php echo str_repeat(\"\u2b50\", $row['rating']); ?></span><br>\n                <em><?php echo $row['email']; ?></em><br><br>\n                <?php echo $row['comment']; ?>\n            </div>\n        <?php endwhile; ?>\n    <?php else: ?>\n        <p>No reviews available yet.</p>\n    <?php endif; ?>\n\n    <!-- Close database connection -->\n    <?php mysqli_close($conn); ?>\n</body>\n</html>\n```"]}
