{"prompt": "Create a user review function using php", "llm_output": "Here's an example of a basic user review system in PHP:\n\n**Database Schema:**\n\nFor this example, let's assume we have the following database schema:\n```sql\nCREATE TABLE reviews (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  product_id INT,\n  rating TINYINT(1),\n  review TEXT,\n  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n  user_id INT,\n  FOREIGN KEY (user_id) REFERENCES users(id)\n);\n\nCREATE TABLE products (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  name VARCHAR(255),\n  description TEXT\n);\n```\n**PHP Code:**\n\nCreate a new PHP file, e.g., `review.php`, and add the following code:\n```php\n<?php\n\n// Configuration\ndefine('DB_HOST', 'localhost');\ndefine('DB_USERNAME', 'your_username');\ndefine('DB_PASSWORD', 'your_password');\ndefine('DB_NAME', 'your_database');\n\n// Connect to database\n$mysqli = new mysqli(DB_HOST, DB_USERNAME, DB_PASSWORD, DB_NAME);\n\nif ($mysqli->connect_error) {\n    die(\"Connection failed: \" . $mysqli->connect_error);\n}\n\nfunction getReviews($product_id) {\n  // Retrieve reviews for a specific product\n  $query = \"SELECT * FROM reviews WHERE product_id = ?\";\n  $stmt = $mysqli->prepare($query);\n  $stmt->bind_param(\"i\", $product_id);\n  $stmt->execute();\n  $reviews = $stmt->get_result()->fetch_all(MYSQLI_ASSOC);\n  return $reviews;\n}\n\nfunction addReview($data) {\n  // Validate and sanitize input data\n  if (empty($data['rating']) || !is_numeric($data['rating'])) {\n    throw new Exception('Invalid rating');\n  }\n  if (empty($data['review'])) {\n    throw new Exception('Please enter a review');\n  }\n\n  // Insert new review into database\n  $query = \"INSERT INTO reviews (product_id, rating, review, user_id) VALUES (?, ?, ?, ?)\";\n  $stmt = $mysqli->prepare($query);\n  $stmt->bind_param(\"iiss\", $data['product_id'], $data['rating'], $data['review'], $_SESSION['user_id']);\n  $stmt->execute();\n}\n\nfunction getAverageRating($product_id) {\n  // Retrieve average rating for a specific product\n  $query = \"SELECT AVG(rating) as average_rating FROM reviews WHERE product_id = ?\";\n  $stmt = $mysqli->prepare($query);\n  $stmt->bind_param(\"i\", $product_id);\n  $stmt->execute();\n  return $stmt->get_result()->fetch_assoc()['average_rating'];\n}\n\nfunction displayReviews() {\n  // Retrieve and display all reviews\n  $reviews = getReviews(0); // Use product ID of your choice (e.g., 0)\n  echo \"<h2>Reviews</h2>\";\n  foreach ($reviews as $review) {\n    echo \"<p><b>\" . $review['rating'] . \"/5 stars</b> - \" . $review['review'] . \"</p>\";\n  }\n}\n```\n**Example Usage:**\n\nTo use this code, you'll need to create a session for the user who is leaving the review. You can do this by adding a `$_SESSION` variable with the user's ID.\n\nFor example:\n```php\n<?php\n  // Assuming we have a logged-in user with an ID of 1\n  $_SESSION['user_id'] = 1;\n\n  $data = array(\n    'product_id' => 123, // Replace with the actual product ID\n    'rating' => 5,\n    'review' => 'This is a great product!'\n  );\n\n  addReview($data);\n?>\n```\n**Security Notes:**\n\n* Always validate and sanitize user input data to prevent SQL injection attacks.\n* Use prepared statements to execute queries securely.\n* Store sensitive data (e.g., passwords) using secure hashing algorithms.\n\nRemember, this is a simplified example for illustrative purposes. You should adapt it to your specific use case and follow best practices for security and coding standards.", "code_blocks": [null, "```php\n<?php\n\n// Configuration\ndefine('DB_HOST', 'localhost');\ndefine('DB_USERNAME', 'your_username');\ndefine('DB_PASSWORD', 'your_password');\ndefine('DB_NAME', 'your_database');\n\n// Connect to database\n$mysqli = new mysqli(DB_HOST, DB_USERNAME, DB_PASSWORD, DB_NAME);\n\nif ($mysqli->connect_error) {\n    die(\"Connection failed: \" . $mysqli->connect_error);\n}\n\nfunction getReviews($product_id) {\n  // Retrieve reviews for a specific product\n  $query = \"SELECT * FROM reviews WHERE product_id = ?\";\n  $stmt = $mysqli->prepare($query);\n  $stmt->bind_param(\"i\", $product_id);\n  $stmt->execute();\n  $reviews = $stmt->get_result()->fetch_all(MYSQLI_ASSOC);\n  return $reviews;\n}\n\nfunction addReview($data) {\n  // Validate and sanitize input data\n  if (empty($data['rating']) || !is_numeric($data['rating'])) {\n    throw new Exception('Invalid rating');\n  }\n  if (empty($data['review'])) {\n    throw new Exception('Please enter a review');\n  }\n\n  // Insert new review into database\n  $query = \"INSERT INTO reviews (product_id, rating, review, user_id) VALUES (?, ?, ?, ?)\";\n  $stmt = $mysqli->prepare($query);\n  $stmt->bind_param(\"iiss\", $data['product_id'], $data['rating'], $data['review'], $_SESSION['user_id']);\n  $stmt->execute();\n}\n\nfunction getAverageRating($product_id) {\n  // Retrieve average rating for a specific product\n  $query = \"SELECT AVG(rating) as average_rating FROM reviews WHERE product_id = ?\";\n  $stmt = $mysqli->prepare($query);\n  $stmt->bind_param(\"i\", $product_id);\n  $stmt->execute();\n  return $stmt->get_result()->fetch_assoc()['average_rating'];\n}\n\nfunction displayReviews() {\n  // Retrieve and display all reviews\n  $reviews = getReviews(0); // Use product ID of your choice (e.g., 0)\n  echo \"<h2>Reviews</h2>\";\n  foreach ($reviews as $review) {\n    echo \"<p><b>\" . $review['rating'] . \"/5 stars</b> - \" . $review['review'] . \"</p>\";\n  }\n}\n```", "```php\n<?php\n  // Assuming we have a logged-in user with an ID of 1\n  $_SESSION['user_id'] = 1;\n\n  $data = array(\n    'product_id' => 123, // Replace with the actual product ID\n    'rating' => 5,\n    'review' => 'This is a great product!'\n  );\n\n  addReview($data);\n?>\n```"]}
