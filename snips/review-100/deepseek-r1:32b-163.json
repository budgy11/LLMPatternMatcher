{"prompt": "Create a user review function using php", "llm_output": "<think>\nOkay, I need to create a user review function using PHP. Let me think about how to approach this.\n\nFirst, the main goal is to allow users to submit reviews and display them on a webpage. So, I'll need both a submission form and a way to show all submitted reviews.\n\nI should start by setting up a database connection because storing reviews requires a backend. Using MySQL makes sense since it's widely used and integrates well with PHP. I'll need a table for the reviews, probably named 'reviews', which includes fields like id, user_name, review_text, rating, and submission date.\n\nNext, creating the HTML form is essential. The form should have fields for the user's name, their review text, and a rating selection. Using a dropdown or radio buttons for ratings would work. I'll set up the form to post to a PHP script that handles the submission.\n\nNow, handling the form submission in PHP involves checking if the form has been submitted. If it has, I need to sanitize the input data to prevent SQL injection and XSS attacks. Functions like htmlspecialchars can help with that. Then, I'll insert the sanitized data into the database using an INSERT query.\n\nDisplaying the reviews requires fetching them from the database. I'll use a SELECT query ordered by submission date in descending order so the newest reviews appear first. For each review, I'll display the user's name, the review text, and the rating along with the submission date.\n\nCalculating the average rating is a nice touch to give an overall sense of user satisfaction. I'll run another SQL query that calculates the average rating from all entries in the reviews table. If there are no ratings yet, I'll handle that case gracefully by displaying zero or a message like \"No ratings yet.\"\n\nI should also consider security aspects. Using mysqli_real_escape_string is important to prevent SQL injection. Additionally, sanitizing user inputs ensures that any potentially harmful scripts or tags don't get displayed on the page.\n\nPutting it all together, I'll structure my PHP script with sections for handling submission and displaying reviews. At the top, I'll include a form when the user wants to submit a review. Below that, I'll fetch and display existing reviews along with the average rating.\n\nTesting each part as I go is crucial. I'll make sure the form correctly inserts data into the database and that fetching works without errors. Handling edge cases, like empty fields or non-numeric ratings, should be addressed to prevent issues.\n\nFinally, I'll provide instructions on how to use the code, including setting up the database table and ensuring the script has proper permissions. This way, anyone using my function can easily integrate it into their project.\n</think>\n\nHere's an example of a user review system in PHP. This script allows users to submit reviews and displays all reviews:\n\n```php\n<?php\n// Database configuration\n$host = 'localhost';\n$username = 'username';\n$password = 'password';\n$dbname = 'reviews_db';\n\n// Create database connection\n$conn = mysqli_connect($host, $username, $password, $dbname);\n\n// Check connection\nif (!$conn) {\n    die(\"Connection failed: \" . mysqli_connect_error());\n}\n\n// Handle review submission\nif ($_SERVER['REQUEST_METHOD'] == 'POST' && isset($_POST['submit_review'])) {\n    // Sanitize input data\n    $user_name = htmlspecialchars(mysqli_real_escape_string($conn, $_POST['user_name']));\n    $review_text = htmlspecialchars(mysqli_real_escape_string($conn, $_POST['review_text']));\n    $rating = intval($_POST['rating']);\n\n    // Insert review into database\n    $sql = \"INSERT INTO reviews (user_name, review_text, rating) \n            VALUES ('$user_name', '$review_text', $rating)\";\n\n    if (mysqli_query($conn, $sql)) {\n        echo \"<div class='success'>Review submitted successfully!</div>\";\n    } else {\n        echo \"<div class='error'>Error: \" . mysqli_error($conn) . \"</div>\";\n    }\n}\n\n// Fetch all reviews\n$sql = \"SELECT * FROM reviews ORDER BY submission_date DESC\";\n$result = mysqli_query($conn, $sql);\n?>\n\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <title>Review System</title>\n    <style>\n        .review-form { margin-bottom: 30px; }\n        .review { border: 1px solid #ddd; padding: 15px; margin-bottom: 15px; }\n        .rating { font-weight: bold; color: #ff6600; }\n    </style>\n</head>\n<body>\n\n<h2>Submit a Review</h2>\n<form class=\"review-form\" action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"POST\">\n    <input type=\"text\" name=\"user_name\" placeholder=\"Your Name\" required><br><br>\n    <textarea name=\"review_text\" placeholder=\"Write your review here...\" required></textarea><br><br>\n    <select name=\"rating\" required>\n        <option value=\"\">Select Rating</option>\n        <option value=\"5\">5 Stars</option>\n        <option value=\"4\">4 Stars</option>\n        <option value=\"3\">3 Stars</option>\n        <option value=\"2\">2 Stars</option>\n        <option value=\"1\">1 Star</option>\n    </select><br><br>\n    <input type=\"submit\" name=\"submit_review\" value=\"Submit Review\">\n</form>\n\n<h2>Reviews</h2>\n<?php\nif (mysqli_num_rows($result) > 0) {\n    while ($row = mysqli_fetch_assoc($result)) {\n        echo \"<div class='review'>\";\n        echo \"<p><strong>\" . $row['user_name'] . \"</strong></p>\";\n        echo \"<p>\" . $row['review_text'] . \"</p>\";\n        echo \"<p class='rating'>Rating: \" . $row['rating'] . \" stars</p>\";\n        echo \"<p>Submitted on: \" . $row['submission_date'] . \"</p>\";\n        echo \"</div>\";\n    }\n} else {\n    echo \"<p>No reviews yet.</p>\";\n}\n?>\n\n<?php\n// Calculate average rating\n$avg_query = \"SELECT AVG(rating) as average FROM reviews\";\n$avg_result = mysqli_query($conn, $avg_query);\nif ($row = mysqli_fetch_assoc($avg_result)) {\n    $average_rating = round($row['average'], 1);\n} else {\n    $average_rating = 0;\n}\n?>\n\n<h3>Average Rating: <?php echo $average_rating; ?> /5</h3>\n\n<?php\n// Close database connection\nmysqli_close($conn);\n?>\n```\n\nThis script includes:\n\n1. A form for submitting reviews with:\n   - User name field\n   - Review text area\n   - Rating dropdown (1-5 stars)\n\n2. Database operations:\n   - Insert new reviews into the database\n   - Retrieve and display existing reviews\n   - Calculate and display average rating\n\n3. Features:\n   - Input sanitization\n   - Error handling\n   - Display of review details including submission date\n   - Average rating calculation\n\nTo use this script:\n\n1. Create a MySQL database named 'reviews_db'\n2. Create a table named 'reviews' with the following columns:\n   - id (INT, AUTO_INCREMENT, PRIMARY KEY)\n   - user_name (VARCHAR(255))\n   - review_text (TEXT)\n   - rating (INT)\n   - submission_date (DATETIME)\n\n3. Modify the database configuration at the top of the script to match your MySQL credentials\n\n4. Save the file with a .php extension and run it on a web server that supports PHP and MySQL\n\nTo improve this basic implementation, you could add:\n\n1. User authentication\n2. Review editing and deletion capabilities\n3. More sophisticated rating display (e.g., using stars)\n4. Sorting options for reviews (e.g., by date or rating)\n5. Validation for the review form\n6. Pagination for long lists of reviews\n7. Moderation features for reviews\n\nRemember to implement proper security measures like:\n- Input validation and sanitization\n- SQL injection prevention\n- XSS protection\n- Proper error handling", "code_blocks": ["```php\n<?php\n// Database configuration\n$host = 'localhost';\n$username = 'username';\n$password = 'password';\n$dbname = 'reviews_db';\n\n// Create database connection\n$conn = mysqli_connect($host, $username, $password, $dbname);\n\n// Check connection\nif (!$conn) {\n    die(\"Connection failed: \" . mysqli_connect_error());\n}\n\n// Handle review submission\nif ($_SERVER['REQUEST_METHOD'] == 'POST' && isset($_POST['submit_review'])) {\n    // Sanitize input data\n    $user_name = htmlspecialchars(mysqli_real_escape_string($conn, $_POST['user_name']));\n    $review_text = htmlspecialchars(mysqli_real_escape_string($conn, $_POST['review_text']));\n    $rating = intval($_POST['rating']);\n\n    // Insert review into database\n    $sql = \"INSERT INTO reviews (user_name, review_text, rating) \n            VALUES ('$user_name', '$review_text', $rating)\";\n\n    if (mysqli_query($conn, $sql)) {\n        echo \"<div class='success'>Review submitted successfully!</div>\";\n    } else {\n        echo \"<div class='error'>Error: \" . mysqli_error($conn) . \"</div>\";\n    }\n}\n\n// Fetch all reviews\n$sql = \"SELECT * FROM reviews ORDER BY submission_date DESC\";\n$result = mysqli_query($conn, $sql);\n?>\n\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <title>Review System</title>\n    <style>\n        .review-form { margin-bottom: 30px; }\n        .review { border: 1px solid #ddd; padding: 15px; margin-bottom: 15px; }\n        .rating { font-weight: bold; color: #ff6600; }\n    </style>\n</head>\n<body>\n\n<h2>Submit a Review</h2>\n<form class=\"review-form\" action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"POST\">\n    <input type=\"text\" name=\"user_name\" placeholder=\"Your Name\" required><br><br>\n    <textarea name=\"review_text\" placeholder=\"Write your review here...\" required></textarea><br><br>\n    <select name=\"rating\" required>\n        <option value=\"\">Select Rating</option>\n        <option value=\"5\">5 Stars</option>\n        <option value=\"4\">4 Stars</option>\n        <option value=\"3\">3 Stars</option>\n        <option value=\"2\">2 Stars</option>\n        <option value=\"1\">1 Star</option>\n    </select><br><br>\n    <input type=\"submit\" name=\"submit_review\" value=\"Submit Review\">\n</form>\n\n<h2>Reviews</h2>\n<?php\nif (mysqli_num_rows($result) > 0) {\n    while ($row = mysqli_fetch_assoc($result)) {\n        echo \"<div class='review'>\";\n        echo \"<p><strong>\" . $row['user_name'] . \"</strong></p>\";\n        echo \"<p>\" . $row['review_text'] . \"</p>\";\n        echo \"<p class='rating'>Rating: \" . $row['rating'] . \" stars</p>\";\n        echo \"<p>Submitted on: \" . $row['submission_date'] . \"</p>\";\n        echo \"</div>\";\n    }\n} else {\n    echo \"<p>No reviews yet.</p>\";\n}\n?>\n\n<?php\n// Calculate average rating\n$avg_query = \"SELECT AVG(rating) as average FROM reviews\";\n$avg_result = mysqli_query($conn, $avg_query);\nif ($row = mysqli_fetch_assoc($avg_result)) {\n    $average_rating = round($row['average'], 1);\n} else {\n    $average_rating = 0;\n}\n?>\n\n<h3>Average Rating: <?php echo $average_rating; ?> /5</h3>\n\n<?php\n// Close database connection\nmysqli_close($conn);\n?>\n```"]}
