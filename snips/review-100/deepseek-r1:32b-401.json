{"prompt": "Create a user review function using php", "llm_output": "<think>\nOkay, so the user wants to create a user review function using PHP. I need to figure out what that entails. From the question, it seems like they might be looking for a way to allow users to leave reviews on a website, maybe for products or services.\n\nFirst, I should consider the structure of such a system. It probably needs a form where users can input their name, review text, and rating. Then, that data needs to be stored somewhere, likely in a database. After storing, the reviews should be displayed back on the webpage so others can see them.\n\nI'll start by outlining the necessary components: an HTML form for input, PHP scripts to handle saving the review, and another script to retrieve and display the reviews. Also, connecting to a MySQL database is essential for persisting the data.\n\nNext, I need to think about security. Sanitizing inputs is crucial to prevent SQL injection attacks. Using prepared statements with mysqli can help with that. Additionally, validating user inputs ensures that only appropriate data is stored.\n\nFor displaying the reviews, fetching them from the database and looping through each one to display on the page makes sense. Calculating an average rating would add a nice touch, so including that in the display would be helpful.\n\nI should also consider error handling\u2014what if there's an issue saving or retrieving the reviews? Providing feedback to the user is important for a good experience.\n\nPutting it all together, I'll structure the code into three parts: the form, the save_review.php script, and the show_reviews.php script. Each part needs clear comments and explanations so the user can understand how everything works.\n\nI should also mention additional considerations like CSS styling, pagination, andModeration features in case the user wants to expand the functionality later on.\n\nOverall, the goal is to provide a comprehensive yet straightforward solution that covers all necessary aspects of implementing a review system using PHP.\n</think>\n\nHere's an example of a user review function using PHP. This will include creating a form for users to submit reviews, storing them in a MySQL database, and displaying the reviews:\n\n```php\n<?php\n// Database connection details\n$host = 'localhost';\n$username = 'root';\n$password = '';\n$dbname = 'reviews_db';\n\n// Connect to database\n$conn = mysqli_connect($host, $username, $password, $dbname);\n\n// Create table if it doesn't exist\n$sql = \"CREATE TABLE IF NOT EXISTS reviews (\n    id INT AUTO_INCREMENT PRIMARY KEY,\n    user_name VARCHAR(100),\n    review_text TEXT,\n    rating INT,\n    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n)\";\n\nmysqli_query($conn, $sql);\n\n// Function to save a new review\nfunction saveReview($user_name, $review_text, $rating) {\n    global $conn;\n    \n    // Sanitize input data\n    $user_name = mysqli_real_escape_string($conn, htmlspecialchars($user_name));\n    $review_text = mysqli_real_escape_string($conn, htmlspecialchars($review_text));\n    $rating = intval($rating);\n    \n    // Check if rating is between 1 and 5\n    if ($rating < 1 || $rating > 5) {\n        return false;\n    }\n    \n    // Insert review into database\n    $sql = \"INSERT INTO reviews (user_name, review_text, rating) \n            VALUES ('$user_name', '$review_text', '$rating')\";\n            \n    mysqli_query($conn, $sql);\n    return true;\n}\n\n// Function to get all reviews\nfunction getAllReviews() {\n    global $conn;\n    \n    $sql = \"SELECT * FROM reviews ORDER BY created_at DESC\";\n    $result = mysqli_query($conn, $sql);\n    \n    $reviews = array();\n    while ($row = mysqli_fetch_assoc($result)) {\n        $reviews[] = $row;\n    }\n    \n    return $reviews;\n}\n\n// Check if review was submitted\nif (isset($_POST['submit_review'])) {\n    // Get form data\n    $user_name = $_POST['user_name'];\n    $review_text = $_POST['review_text'];\n    $rating = $_POST['rating'];\n    \n    // Validate input\n    if (empty($user_name) || empty($review_text)) {\n        echo \"Please fill in all required fields!\";\n    } else {\n        if (saveReview($user_name, $review_text, $rating)) {\n            echo \"Thank you for your review!\";\n        } else {\n            echo \"There was an error saving your review. Please try again.\";\n        }\n    }\n}\n\n// Display review form\n?>\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Product Review System</title>\n    <style>\n        .review-form { margin: 20px; padding: 15px; border: 1px solid #ddd; }\n        .review-list { margin: 20px; }\n        .single-review { margin-bottom: 15px; padding: 10px; border: 1px solid #eee; }\n    </style>\n</head>\n<body>\n\n<div class=\"review-form\">\n    <h2>Write a Review</h2>\n    <form method=\"post\" action=\"\">\n        <input type=\"text\" name=\"user_name\" placeholder=\"Your Name\" required><br><br>\n        <textarea name=\"review_text\" placeholder=\"Write your review here...\" rows=\"4\" required></textarea><br><br>\n        <label>Rating:</label>\n        <select name=\"rating\">\n            <option value=\"5\">5 Stars</option>\n            <option value=\"4\">4 Stars</option>\n            <option value=\"3\">3 Stars</option>\n            <option value=\"2\">2 Stars</option>\n            <option value=\"1\">1 Star</option>\n        </select><br><br>\n        <input type=\"submit\" name=\"submit_review\" value=\"Submit Review\">\n    </form>\n</div>\n\n<div class=\"review-list\">\n    <h2>Customer Reviews</h2>\n    <?php\n    $reviews = getAllReviews();\n    \n    if (empty($reviews)) {\n        echo \"No reviews yet. Be the first to review!\";\n    } else {\n        foreach ($reviews as $review) {\n            echo \"<div class='single-review'>\";\n            echo \"<strong>\" . htmlspecialchars_decode($review['user_name']) . \"</strong><br>\";\n            echo \"<span style='color: #ff8f00;'>\u2605 \" . $review['rating'] . \"/5</span><br>\";\n            echo \"<p>\" . htmlspecialchars_decode($review['review_text']) . \"</p>\";\n            echo \"<small>Posted on \" . $review['created_at'] . \"</small>\";\n            echo \"</div>\";\n        }\n    }\n    \n    // Calculate and display average rating\n    $sql_avg = \"SELECT AVG(rating) as avg_rating FROM reviews\";\n    $result_avg = mysqli_query($conn, $sql_avg);\n    $row_avg = mysqli_fetch_assoc($result_avg);\n    \n    if ($row_avg['avg_rating'] > 0) {\n        echo \"<div style='margin-top: 20px; font-size: 1.2em;'>\";\n        echo \"Average Rating: <span style='color: #ff8f00;'>\u2605 \" . round($row_avg['avg_rating'], 1) . \"/5</span>\";\n        echo \"</div>\";\n    }\n    \n    mysqli_close($conn);\n    ?>\n</div>\n\n</body>\n</html>\n```\n\nThis code provides:\n\n1. A review submission form with:\n   - User name field\n   - Review text area\n   - Rating selection (1-5 stars)\n\n2. Database functionality to:\n   - Store reviews in a MySQL database\n   - Retrieve and display all reviews\n   - Calculate and display average rating\n\n3. Basic validation for:\n   - Required fields\n   - Rating range (1-5)\n   - SQL injection prevention\n\n4. Display features including:\n   - Timestamps for each review\n   - Average rating calculation\n   - Clean, formatted output\n\nTo use this code:\n\n1. Make sure you have a MySQL database set up\n2. Adjust the database connection details at the top of the file\n3. Create the reviews table by running the SQL query in your database\n4. Save this as an HTML/PHP file and upload it to your web server\n\nAdditional features you might want to add:\n\n1. User authentication system\n2. Review editing/deletion capabilities\n3. Rating distribution visualization\n4. Sorting options (newest, highest rated, etc.)\n5. Pagination for long lists of reviews\n6. Moderation system for reviews\n7. CSS styling and theming\n\nRemember to always sanitize user input and use prepared statements or parameterized queries to prevent SQL injection attacks when implementing this in a production environment.", "code_blocks": ["```php\n<?php\n// Database connection details\n$host = 'localhost';\n$username = 'root';\n$password = '';\n$dbname = 'reviews_db';\n\n// Connect to database\n$conn = mysqli_connect($host, $username, $password, $dbname);\n\n// Create table if it doesn't exist\n$sql = \"CREATE TABLE IF NOT EXISTS reviews (\n    id INT AUTO_INCREMENT PRIMARY KEY,\n    user_name VARCHAR(100),\n    review_text TEXT,\n    rating INT,\n    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n)\";\n\nmysqli_query($conn, $sql);\n\n// Function to save a new review\nfunction saveReview($user_name, $review_text, $rating) {\n    global $conn;\n    \n    // Sanitize input data\n    $user_name = mysqli_real_escape_string($conn, htmlspecialchars($user_name));\n    $review_text = mysqli_real_escape_string($conn, htmlspecialchars($review_text));\n    $rating = intval($rating);\n    \n    // Check if rating is between 1 and 5\n    if ($rating < 1 || $rating > 5) {\n        return false;\n    }\n    \n    // Insert review into database\n    $sql = \"INSERT INTO reviews (user_name, review_text, rating) \n            VALUES ('$user_name', '$review_text', '$rating')\";\n            \n    mysqli_query($conn, $sql);\n    return true;\n}\n\n// Function to get all reviews\nfunction getAllReviews() {\n    global $conn;\n    \n    $sql = \"SELECT * FROM reviews ORDER BY created_at DESC\";\n    $result = mysqli_query($conn, $sql);\n    \n    $reviews = array();\n    while ($row = mysqli_fetch_assoc($result)) {\n        $reviews[] = $row;\n    }\n    \n    return $reviews;\n}\n\n// Check if review was submitted\nif (isset($_POST['submit_review'])) {\n    // Get form data\n    $user_name = $_POST['user_name'];\n    $review_text = $_POST['review_text'];\n    $rating = $_POST['rating'];\n    \n    // Validate input\n    if (empty($user_name) || empty($review_text)) {\n        echo \"Please fill in all required fields!\";\n    } else {\n        if (saveReview($user_name, $review_text, $rating)) {\n            echo \"Thank you for your review!\";\n        } else {\n            echo \"There was an error saving your review. Please try again.\";\n        }\n    }\n}\n\n// Display review form\n?>\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Product Review System</title>\n    <style>\n        .review-form { margin: 20px; padding: 15px; border: 1px solid #ddd; }\n        .review-list { margin: 20px; }\n        .single-review { margin-bottom: 15px; padding: 10px; border: 1px solid #eee; }\n    </style>\n</head>\n<body>\n\n<div class=\"review-form\">\n    <h2>Write a Review</h2>\n    <form method=\"post\" action=\"\">\n        <input type=\"text\" name=\"user_name\" placeholder=\"Your Name\" required><br><br>\n        <textarea name=\"review_text\" placeholder=\"Write your review here...\" rows=\"4\" required></textarea><br><br>\n        <label>Rating:</label>\n        <select name=\"rating\">\n            <option value=\"5\">5 Stars</option>\n            <option value=\"4\">4 Stars</option>\n            <option value=\"3\">3 Stars</option>\n            <option value=\"2\">2 Stars</option>\n            <option value=\"1\">1 Star</option>\n        </select><br><br>\n        <input type=\"submit\" name=\"submit_review\" value=\"Submit Review\">\n    </form>\n</div>\n\n<div class=\"review-list\">\n    <h2>Customer Reviews</h2>\n    <?php\n    $reviews = getAllReviews();\n    \n    if (empty($reviews)) {\n        echo \"No reviews yet. Be the first to review!\";\n    } else {\n        foreach ($reviews as $review) {\n            echo \"<div class='single-review'>\";\n            echo \"<strong>\" . htmlspecialchars_decode($review['user_name']) . \"</strong><br>\";\n            echo \"<span style='color: #ff8f00;'>\u2605 \" . $review['rating'] . \"/5</span><br>\";\n            echo \"<p>\" . htmlspecialchars_decode($review['review_text']) . \"</p>\";\n            echo \"<small>Posted on \" . $review['created_at'] . \"</small>\";\n            echo \"</div>\";\n        }\n    }\n    \n    // Calculate and display average rating\n    $sql_avg = \"SELECT AVG(rating) as avg_rating FROM reviews\";\n    $result_avg = mysqli_query($conn, $sql_avg);\n    $row_avg = mysqli_fetch_assoc($result_avg);\n    \n    if ($row_avg['avg_rating'] > 0) {\n        echo \"<div style='margin-top: 20px; font-size: 1.2em;'>\";\n        echo \"Average Rating: <span style='color: #ff8f00;'>\u2605 \" . round($row_avg['avg_rating'], 1) . \"/5</span>\";\n        echo \"</div>\";\n    }\n    \n    mysqli_close($conn);\n    ?>\n</div>\n\n</body>\n</html>\n```"]}
