{"prompt": "Create a user review function using php", "llm_output": "**User Review Function in PHP**\n=====================================\n\nThis example demonstrates how to create a simple user review system using PHP. We'll cover the following components:\n\n1. Creating a `Review` class\n2. Writing the database query to store reviews\n3. Handling form submissions and storing reviews\n4. Displaying reviews on a product page\n\n**Database Schema**\n--------------------\n\nAssuming you have a MySQL database with a table called `products`, we'll add two new tables: `reviews` and `users`. The schema will look like this:\n```sql\nCREATE TABLE users (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  username VARCHAR(255) NOT NULL,\n  email VARCHAR(255) NOT NULL\n);\n\nCREATE TABLE reviews (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  product_id INT NOT NULL,\n  user_id INT NOT NULL,\n  rating TINYINT(1) NOT NULL,\n  comment TEXT NOT NULL,\n  FOREIGN KEY (product_id) REFERENCES products(id),\n  FOREIGN KEY (user_id) REFERENCES users(id)\n);\n```\n**Review Class**\n-----------------\n\nCreate a `Review` class in your PHP codebase to handle review-related logic:\n```php\nclass Review {\n  private $db;\n\n  public function __construct() {\n    require_once 'db.php'; // assuming db.php has the database connection credentials\n    $this->db = new mysqli(DB_HOST, DB_USER, DB_PASSWORD, DB_NAME);\n  }\n\n  public function storeReview($productId, $userId, $rating, $comment) {\n    if ($this->db->connect_error) {\n      throw new Exception('Database connection error');\n    }\n    $stmt = $this->db->prepare(\"INSERT INTO reviews (product_id, user_id, rating, comment) VALUES (?, ?, ?, ?)\");\n    $stmt->bind_param(\"iis\", $productId, $userId, $rating, $comment);\n    if (!$stmt->execute()) {\n      throw new Exception('Failed to store review');\n    }\n  }\n\n  public function getReviews($productId) {\n    $reviews = array();\n    $stmt = $this->db->prepare(\"SELECT * FROM reviews WHERE product_id = ?\");\n    $stmt->bind_param(\"i\", $productId);\n    if ($stmt->execute()) {\n      $result = $stmt->get_result();\n      while ($review = $result->fetch_assoc()) {\n        $reviews[] = (object)array(\n          'id' => $review['id'],\n          'rating' => $review['rating'],\n          'comment' => $review['comment']\n        );\n      }\n    }\n    return $reviews;\n  }\n\n  public function destroyReview($reviewId) {\n    if ($this->db->connect_error) {\n      throw new Exception('Database connection error');\n    }\n    $stmt = $this->db->prepare(\"DELETE FROM reviews WHERE id = ?\");\n    $stmt->bind_param(\"i\", $reviewId);\n    if (!$stmt->execute()) {\n      throw new Exception('Failed to delete review');\n    }\n  }\n}\n```\n**User Review Function**\n-------------------------\n\nCreate a function to handle user reviews:\n```php\nfunction userReview() {\n  require_once 'Review.php'; // assuming the Review class is in this file\n\n  $review = new Review();\n  if (isset($_POST['reviewForm'])) {\n    try {\n      $productId = $_POST['product_id'];\n      $userId = $_SESSION['user_id']; // assuming user ID is stored in session\n      $rating = intval($_POST['rating']);\n      $comment = $_POST['comment'];\n      $review->storeReview($productId, $userId, $rating, $comment);\n    } catch (Exception $e) {\n      echo 'Error: ' . $e->getMessage();\n    }\n  }\n\n  // Display reviews on product page\n  if (isset($_GET['product_id'])) {\n    $productId = intval($_GET['product_id']);\n    $reviews = $review->getReviews($productId);\n    foreach ($reviews as $review) {\n      echo '<p>Rating: ' . $review->rating . ', Comment: ' . $review->comment . '</p>';\n    }\n  }\n}\n```\n**Example Usage**\n------------------\n\nTo use this function, include the `userReview()` file in your PHP script and call it when the user visits the product page. You'll need to replace the database credentials with your own and modify the code as needed.\n\nRemember to sanitize user input and handle errors properly to prevent SQL injection and other security vulnerabilities.\n\nThis is a basic example to get you started. Feel free to enhance and customize it according to your requirements.", "code_blocks": [null, "```php\nclass Review {\n  private $db;\n\n  public function __construct() {\n    require_once 'db.php'; // assuming db.php has the database connection credentials\n    $this->db = new mysqli(DB_HOST, DB_USER, DB_PASSWORD, DB_NAME);\n  }\n\n  public function storeReview($productId, $userId, $rating, $comment) {\n    if ($this->db->connect_error) {\n      throw new Exception('Database connection error');\n    }\n    $stmt = $this->db->prepare(\"INSERT INTO reviews (product_id, user_id, rating, comment) VALUES (?, ?, ?, ?)\");\n    $stmt->bind_param(\"iis\", $productId, $userId, $rating, $comment);\n    if (!$stmt->execute()) {\n      throw new Exception('Failed to store review');\n    }\n  }\n\n  public function getReviews($productId) {\n    $reviews = array();\n    $stmt = $this->db->prepare(\"SELECT * FROM reviews WHERE product_id = ?\");\n    $stmt->bind_param(\"i\", $productId);\n    if ($stmt->execute()) {\n      $result = $stmt->get_result();\n      while ($review = $result->fetch_assoc()) {\n        $reviews[] = (object)array(\n          'id' => $review['id'],\n          'rating' => $review['rating'],\n          'comment' => $review['comment']\n        );\n      }\n    }\n    return $reviews;\n  }\n\n  public function destroyReview($reviewId) {\n    if ($this->db->connect_error) {\n      throw new Exception('Database connection error');\n    }\n    $stmt = $this->db->prepare(\"DELETE FROM reviews WHERE id = ?\");\n    $stmt->bind_param(\"i\", $reviewId);\n    if (!$stmt->execute()) {\n      throw new Exception('Failed to delete review');\n    }\n  }\n}\n```", "```php\nfunction userReview() {\n  require_once 'Review.php'; // assuming the Review class is in this file\n\n  $review = new Review();\n  if (isset($_POST['reviewForm'])) {\n    try {\n      $productId = $_POST['product_id'];\n      $userId = $_SESSION['user_id']; // assuming user ID is stored in session\n      $rating = intval($_POST['rating']);\n      $comment = $_POST['comment'];\n      $review->storeReview($productId, $userId, $rating, $comment);\n    } catch (Exception $e) {\n      echo 'Error: ' . $e->getMessage();\n    }\n  }\n\n  // Display reviews on product page\n  if (isset($_GET['product_id'])) {\n    $productId = intval($_GET['product_id']);\n    $reviews = $review->getReviews($productId);\n    foreach ($reviews as $review) {\n      echo '<p>Rating: ' . $review->rating . ', Comment: ' . $review->comment . '</p>';\n    }\n  }\n}\n```"]}
