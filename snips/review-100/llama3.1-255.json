{"prompt": "Create a user review function using php", "llm_output": "**User Review Function in PHP**\n=====================================\n\nBelow is an example implementation of a user review function in PHP. This code includes the following features:\n\n*   Users can submit reviews for products\n*   Reviews are associated with specific products and users\n*   Each product has its own page to display all submitted reviews\n*   Admins have the ability to delete reviews\n\n**Database Schema**\n\nBefore we dive into the code, let's define a basic database schema for this functionality. We'll be using MySQL.\n\n```sql\nCREATE TABLE users (\n    id INT PRIMARY KEY AUTO_INCREMENT,\n    username VARCHAR(255) NOT NULL,\n    email VARCHAR(255) NOT NULL\n);\n\nCREATE TABLE products (\n    id INT PRIMARY KEY AUTO_INCREMENT,\n    name VARCHAR(255) NOT NULL,\n    description TEXT\n);\n\nCREATE TABLE reviews (\n    id INT PRIMARY KEY AUTO_INCREMENT,\n    product_id INT NOT NULL,\n    user_id INT NOT NULL,\n    rating TINYINT NOT NULL,\n    review TEXT NOT NULL,\n    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n    FOREIGN KEY (product_id) REFERENCES products(id),\n    FOREIGN KEY (user_id) REFERENCES users(id)\n);\n```\n\n**User Review Function Code**\n\nHere's the PHP code for the user review function:\n\n```php\n<?php\n\n// Configuration file for database connection\nrequire_once 'config.php';\n\n// Function to submit a new review\nfunction submitReview($productId, $userId, $rating, $review) {\n    global $conn;\n\n    // Query to insert new review into reviews table\n    $query = \"INSERT INTO reviews (product_id, user_id, rating, review)\n              VALUES (:productId, :userId, :rating, :review)\";\n\n    try {\n        // Prepare and execute query with prepared statement\n        $stmt = $conn->prepare($query);\n        $stmt->bindParam(':productId', $productId);\n        $stmt->bindParam(':userId', $userId);\n        $stmt->bindParam(':rating', $rating);\n        $stmt->bindParam(':review', $review);\n\n        if ($stmt->execute()) {\n            return true; // Review submitted successfully\n        } else {\n            throw new Exception('Error submitting review');\n        }\n    } catch (Exception $e) {\n        echo 'Error: ' . $e->getMessage();\n        return false;\n    }\n}\n\n// Function to display all reviews for a product\nfunction displayReviews($productId) {\n    global $conn;\n\n    // Query to retrieve reviews from database\n    $query = \"SELECT r.id, u.username, r.rating, r.review, r.created_at\n              FROM reviews r\n              JOIN users u ON r.user_id = u.id\n              WHERE r.product_id = :productId\";\n\n    try {\n        // Prepare and execute query with prepared statement\n        $stmt = $conn->prepare($query);\n        $stmt->bindParam(':productId', $productId);\n\n        if ($stmt->execute()) {\n            $reviews = $stmt->fetchAll(PDO::FETCH_ASSOC);\n\n            foreach ($reviews as &$review) {\n                // Display review details on product page\n                echo '<p>Username: ' . $review['username'] . '</p>';\n                echo '<p>Rating: ' . $review['rating'] . '/5</p>';\n                echo '<p>Review: ' . $review['review'] . '</p>';\n                echo '<p>Created at: ' . $review['created_at'] . '</p>';\n            }\n\n            return true;\n        } else {\n            throw new Exception('Error displaying reviews');\n        }\n    } catch (Exception $e) {\n        echo 'Error: ' . $e->getMessage();\n        return false;\n    }\n}\n\n// Function to delete a review\nfunction deleteReview($reviewId, $adminId) {\n    global $conn;\n\n    // Query to delete review from database\n    $query = \"DELETE FROM reviews WHERE id = :reviewId AND user_id != :adminId\";\n\n    try {\n        // Prepare and execute query with prepared statement\n        $stmt = $conn->prepare($query);\n        $stmt->bindParam(':reviewId', $reviewId);\n        $stmt->bindParam(':adminId', $adminId);\n\n        if ($stmt->execute()) {\n            return true; // Review deleted successfully\n        } else {\n            throw new Exception('Error deleting review');\n        }\n    } catch (Exception $e) {\n        echo 'Error: ' . $e->getMessage();\n        return false;\n    }\n}\n?>\n```\n\n**Example Use Cases**\n\n```php\n// Example 1: Submitting a new review\n$productId = 1; // ID of product being reviewed\n$userId = 1; // ID of user submitting the review\n$rating = 4; // Rating given to the product (out of 5)\n$review = 'Great product, highly recommended!'; // User's review\n\nif (submitReview($productId, $userId, $rating, $review)) {\n    echo 'Review submitted successfully!';\n} else {\n    echo 'Error submitting review';\n}\n\n// Example 2: Displaying all reviews for a product\n$productId = 1; // ID of product being reviewed\n\ndisplayReviews($productId);\n\n// Example 3: Deleting a review (admin only)\n$reviewId = 1; // ID of review to be deleted\n$adminId = 1; // ID of admin attempting to delete the review\n\nif (deleteReview($reviewId, $adminId)) {\n    echo 'Review deleted successfully!';\n} else {\n    echo 'Error deleting review';\n}\n```", "code_blocks": [null, "```php\n<?php\n\n// Configuration file for database connection\nrequire_once 'config.php';\n\n// Function to submit a new review\nfunction submitReview($productId, $userId, $rating, $review) {\n    global $conn;\n\n    // Query to insert new review into reviews table\n    $query = \"INSERT INTO reviews (product_id, user_id, rating, review)\n              VALUES (:productId, :userId, :rating, :review)\";\n\n    try {\n        // Prepare and execute query with prepared statement\n        $stmt = $conn->prepare($query);\n        $stmt->bindParam(':productId', $productId);\n        $stmt->bindParam(':userId', $userId);\n        $stmt->bindParam(':rating', $rating);\n        $stmt->bindParam(':review', $review);\n\n        if ($stmt->execute()) {\n            return true; // Review submitted successfully\n        } else {\n            throw new Exception('Error submitting review');\n        }\n    } catch (Exception $e) {\n        echo 'Error: ' . $e->getMessage();\n        return false;\n    }\n}\n\n// Function to display all reviews for a product\nfunction displayReviews($productId) {\n    global $conn;\n\n    // Query to retrieve reviews from database\n    $query = \"SELECT r.id, u.username, r.rating, r.review, r.created_at\n              FROM reviews r\n              JOIN users u ON r.user_id = u.id\n              WHERE r.product_id = :productId\";\n\n    try {\n        // Prepare and execute query with prepared statement\n        $stmt = $conn->prepare($query);\n        $stmt->bindParam(':productId', $productId);\n\n        if ($stmt->execute()) {\n            $reviews = $stmt->fetchAll(PDO::FETCH_ASSOC);\n\n            foreach ($reviews as &$review) {\n                // Display review details on product page\n                echo '<p>Username: ' . $review['username'] . '</p>';\n                echo '<p>Rating: ' . $review['rating'] . '/5</p>';\n                echo '<p>Review: ' . $review['review'] . '</p>';\n                echo '<p>Created at: ' . $review['created_at'] . '</p>';\n            }\n\n            return true;\n        } else {\n            throw new Exception('Error displaying reviews');\n        }\n    } catch (Exception $e) {\n        echo 'Error: ' . $e->getMessage();\n        return false;\n    }\n}\n\n// Function to delete a review\nfunction deleteReview($reviewId, $adminId) {\n    global $conn;\n\n    // Query to delete review from database\n    $query = \"DELETE FROM reviews WHERE id = :reviewId AND user_id != :adminId\";\n\n    try {\n        // Prepare and execute query with prepared statement\n        $stmt = $conn->prepare($query);\n        $stmt->bindParam(':reviewId', $reviewId);\n        $stmt->bindParam(':adminId', $adminId);\n\n        if ($stmt->execute()) {\n            return true; // Review deleted successfully\n        } else {\n            throw new Exception('Error deleting review');\n        }\n    } catch (Exception $e) {\n        echo 'Error: ' . $e->getMessage();\n        return false;\n    }\n}\n?>\n```", "```php\n// Example 1: Submitting a new review\n$productId = 1; // ID of product being reviewed\n$userId = 1; // ID of user submitting the review\n$rating = 4; // Rating given to the product (out of 5)\n$review = 'Great product, highly recommended!'; // User's review\n\nif (submitReview($productId, $userId, $rating, $review)) {\n    echo 'Review submitted successfully!';\n} else {\n    echo 'Error submitting review';\n}\n\n// Example 2: Displaying all reviews for a product\n$productId = 1; // ID of product being reviewed\n\ndisplayReviews($productId);\n\n// Example 3: Deleting a review (admin only)\n$reviewId = 1; // ID of review to be deleted\n$adminId = 1; // ID of admin attempting to delete the review\n\nif (deleteReview($reviewId, $adminId)) {\n    echo 'Review deleted successfully!';\n} else {\n    echo 'Error deleting review';\n}\n```"]}
