{"prompt": "Create a user review function using php", "llm_output": "Here's an example of a simple user review system in PHP, which allows users to submit reviews for products and view all reviews.\n\n**Database Setup:**\nFor this example, we'll use MySQL database. Create two tables:\n\n```sql\nCREATE TABLE products (\n    id INT PRIMARY KEY AUTO_INCREMENT,\n    name VARCHAR(255),\n    description TEXT\n);\n\nCREATE TABLE reviews (\n    id INT PRIMARY KEY AUTO_INCREMENT,\n    product_id INT,\n    user_id INT,\n    rating TINYINT,\n    review TEXT,\n    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n    FOREIGN KEY (product_id) REFERENCES products(id)\n);\n```\n\n**PHP Code:**\n```php\n// configuration file\nrequire 'config.php';\n\n// function to get all reviews for a product\nfunction getReviews($productId) {\n    global $db;\n    $query = \"SELECT * FROM reviews WHERE product_id = '$productId'\";\n    return $db->query($query)->fetch_all(MYSQLI_ASSOC);\n}\n\n// function to add new review\nfunction addReview($data) {\n    global $db;\n    extract($data);\n\n    // sanitize inputs\n    $rating = (int)$rating;\n    $review = mysqli_real_escape_string($db, $review);\n\n    // insert into database\n    $query = \"INSERT INTO reviews (product_id, user_id, rating, review)\n              VALUES ('$productId', '$userId', '$rating', '$review')\";\n    return $db->query($query);\n}\n\n// function to display average rating for a product\nfunction getAverageRating($productId) {\n    global $db;\n    $query = \"SELECT AVG(rating) as average FROM reviews WHERE product_id = '$productId'\";\n    $result = $db->query($query)->fetch_assoc();\n    return isset($result['average']) ? (float)$result['average'] : 0;\n}\n\n// example usage:\n$productId = 1; // replace with actual product ID\n\n// get all reviews for this product\n$reviews = getReviews($productId);\necho \"Reviews for Product $productId:<br>\";\n\nforeach ($reviews as $review) {\n    echo \"Rating: $review[rating] - Review: $review[review]<br>\";\n}\n\n// add new review\n$data = array(\n    'product_id' => 1,\n    'user_id' => 1,\n    'rating' => 5,\n    'review' => 'This is a great product!'\n);\naddReview($data);\n\n// display average rating for this product\necho \"Average Rating: \".getAverageRating(1).\"<br>\";\n\n```\n\n**Note:** This example assumes you have already set up your database and connected to it using the `$db` variable. You'll need to modify the code according to your specific configuration.\n\nAlso, please remember to always use prepared statements or parameterized queries with MySQLi to prevent SQL injection attacks!", "code_blocks": [null, "```php\n// configuration file\nrequire 'config.php';\n\n// function to get all reviews for a product\nfunction getReviews($productId) {\n    global $db;\n    $query = \"SELECT * FROM reviews WHERE product_id = '$productId'\";\n    return $db->query($query)->fetch_all(MYSQLI_ASSOC);\n}\n\n// function to add new review\nfunction addReview($data) {\n    global $db;\n    extract($data);\n\n    // sanitize inputs\n    $rating = (int)$rating;\n    $review = mysqli_real_escape_string($db, $review);\n\n    // insert into database\n    $query = \"INSERT INTO reviews (product_id, user_id, rating, review)\n              VALUES ('$productId', '$userId', '$rating', '$review')\";\n    return $db->query($query);\n}\n\n// function to display average rating for a product\nfunction getAverageRating($productId) {\n    global $db;\n    $query = \"SELECT AVG(rating) as average FROM reviews WHERE product_id = '$productId'\";\n    $result = $db->query($query)->fetch_assoc();\n    return isset($result['average']) ? (float)$result['average'] : 0;\n}\n\n// example usage:\n$productId = 1; // replace with actual product ID\n\n// get all reviews for this product\n$reviews = getReviews($productId);\necho \"Reviews for Product $productId:<br>\";\n\nforeach ($reviews as $review) {\n    echo \"Rating: $review[rating] - Review: $review[review]<br>\";\n}\n\n// add new review\n$data = array(\n    'product_id' => 1,\n    'user_id' => 1,\n    'rating' => 5,\n    'review' => 'This is a great product!'\n);\naddReview($data);\n\n// display average rating for this product\necho \"Average Rating: \".getAverageRating(1).\"<br>\";\n\n```"]}
