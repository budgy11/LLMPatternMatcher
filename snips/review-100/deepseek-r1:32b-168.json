{"prompt": "Create a user review function using php", "llm_output": "<think>\nAlright, I need to create a user review function using PHP. Let me think about how to approach this.\n\nFirst, the function should take user input for a review and save it to a database. So, I'll need a form with fields like name, email, rating, and comment. \n\nI should include validation to make sure all required fields are filled out. If someone leaves something empty, they should get an error message.\n\nNext, the reviews need to be stored somewhere. Using MySQL seems straightforward. I'll create a table in my database to hold the review data: id, product_id, user_name, email, rating, comment, and timestamp.\n\nAfter submitting the form, the data should be inserted into this table. I'll use PHP to handle the form submission and execute an INSERT query.\n\nThen, I want to display these reviews on a webpage. So, I'll write another function that fetches all reviews from the database for a specific product. This will involve a SELECT query ordered by the timestamp so they show up in order.\n\nI should also format the rating as stars for better readability. A helper function can convert the numeric rating into HTML star emojis.\n\nPutting it all together, I'll structure the code with proper error handling and security measures like prepared statements to prevent SQL injection. Also, I'll make sure to sanitize user inputs to avoid any script injections.\n\nFinally, I'll test the functions by simulating form submissions and checking if the reviews are correctly stored and displayed.\n</think>\n\nHere's an example of a user review function using PHP:\n\nThis code includes:\n\n1. A form for users to submit their reviews\n2. Validation and sanitization of input data\n3. Storing reviews in a MySQL database\n4. Displaying reviews on a webpage\n\n```php\n<?php\n// Database configuration\n$host = 'localhost';\n$username = 'root';\n$password = '';\n$db_name = 'reviews_db';\n\n// Connect to the database\n$conn = new mysqli($host, $username, $password, $db_name);\n\n// Check connection\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Create reviews table if not exists\n$sql = \"CREATE TABLE IF NOT EXISTS reviews (\n    id INT AUTO_INCREMENT PRIMARY KEY,\n    product_id INT,\n    user_name VARCHAR(100),\n    email VARCHAR(100),\n    rating INT,\n    comment TEXT,\n    timestamp DATETIME\n)\";\n\n$conn->query($sql);\n\n// Function to add a new review\nfunction addReview($product_id, $user_name, $email, $rating, $comment) {\n    global $conn;\n    \n    // Sanitize input data\n    $user_name = htmlspecialchars(strip_tags($user_name));\n    $email = htmlspecialchars(strip_tags($email));\n    $comment = htmlspecialchars(strip_tags($comment));\n    \n    // Prepare and bind\n    $stmt = $conn->prepare(\"INSERT INTO reviews (product_id, user_name, email, rating, comment, timestamp) VALUES (?, ?, ?, ?, ?, NOW())\");\n    $stmt->bind_param(\"isiii\", $product_id, $user_name, $email, $rating, $comment);\n    \n    // Execute the query\n    if ($stmt->execute()) {\n        return true;\n    } else {\n        return false;\n    }\n}\n\n// Function to display reviews\nfunction displayReviews($product_id) {\n    global $conn;\n    \n    $sql = \"SELECT * FROM reviews WHERE product_id = ? ORDER BY timestamp DESC\";\n    $stmt = $conn->prepare($sql);\n    $stmt->bind_param(\"i\", $product_id);\n    $stmt->execute();\n    \n    $result = $stmt->get_result();\n    \n    while ($row = $result->fetch_assoc()) {\n        echo \"<div class='review'>\";\n        echo \"<h4>\" . $row['user_name'] . \"</h4>\";\n        echo \"<p>Rating: \" . getStars($row['rating']) . \"</p>\";\n        echo \"<p>Email: \" . $row['email'] . \"</p>\";\n        echo \"<p>Comment: \" . $row['comment'] . \"</p>\";\n        echo \"<small>\" . date('F j, Y', strtotime($row['timestamp'])) . \"</small>\";\n        echo \"</div>\";\n    }\n}\n\n// Helper function to display stars for rating\nfunction getStars($rating) {\n    $stars = \"\";\n    for ($i = 1; $i <= 5; $i++) {\n        if ($i <= $rating) {\n            $stars .= \"\u2605\";\n        } else {\n            $stars .= \"\u2606\";\n        }\n    }\n    return $stars;\n}\n\n// Close database connection\n$conn->close();\n?>\n\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Product Reviews</title>\n    <style>\n        .review {\n            border: 1px solid #ddd;\n            padding: 15px;\n            margin: 10px 0;\n            background-color: #f9f9f9;\n        }\n        h4 { color: #333; }\n        p { line-height: 1.6; }\n    </style>\n</head>\n<body>\n\n<?php\n// Handle form submission\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n    $product_id = 1; // Example product ID\n    \n    if (!empty($_POST['name']) && !empty($_POST['email']) && isset($_POST['rating']) && !empty($_POST['comment'])) {\n        $success = addReview($product_id, $_POST['name'], $_POST['email'], $_POST['rating'], $_POST['comment']);\n        \n        if ($success) {\n            echo \"<p>Thank you for your review!</p>\";\n        } else {\n            echo \"<p>Error submitting review. Please try again.</p>\";\n        }\n    } else {\n        echo \"<p>Please fill in all required fields.</p>\";\n    }\n}\n\n// Display review form\n?>\n\n<h2>Submit a Review</h2>\n<form method=\"post\" action=\"<?php echo $_SERVER['PHP_SELF']; ?>\">\n    <div>\n        <label for=\"name\">Name:</label><br>\n        <input type=\"text\" id=\"name\" name=\"name\">\n    </div>\n    \n    <div>\n        <label for=\"email\">Email:</label><br>\n        <input type=\"email\" id=\"email\" name=\"email\">\n    </div>\n    \n    <div>\n        <label>Rating:</label><br>\n        <select name=\"rating\">\n            <option value=\"\">Select rating</option>\n            <option value=\"5\">5 Stars</option>\n            <option value=\"4\">4 Stars</option>\n            <option value=\"3\">3 Stars</option>\n            <option value=\"2\">2 Stars</option>\n            <option value=\"1\">1 Star</option>\n        </select>\n    </div>\n    \n    <div>\n        <label for=\"comment\">Comment:</label><br>\n        <textarea id=\"comment\" name=\"comment\" rows=\"5\"></textarea>\n    </div>\n    \n    <input type=\"submit\" value=\"Submit Review\">\n</form>\n\n<h2>Reviews</h2>\n<?php\ndisplayReviews(1); // Display reviews for product ID 1\n?>\n</body>\n</html>\n```\n\nThis code provides:\n\n1. A review submission form with fields for name, email, rating (1-5 stars), and comment\n2. Input validation and sanitization\n3. Database storage of reviews with timestamps\n4. Display of reviews in chronological order\n5. Basic styling for the review display\n\nFeatures:\n- Users can submit their ratings and comments\n- Reviews are stored in a MySQL database\n- Reviews include user name, email, rating (displayed as stars), comment, and submission date\n- The review form includes basic validation to ensure all required fields are filled out\n- Input data is sanitized to prevent SQL injection and XSS attacks\n\nTo use this code:\n\n1. Create a MySQL database named `reviews_db`\n2. Run the SQL query in your database to create the reviews table if it doesn't exist\n3. Update the database connection details (username, password, etc.) as needed for your environment\n4. Include this PHP file in your web application\n\nNote: This is a basic example and should be customized according to your specific needs. For production use, you might want to add:\n- More comprehensive error handling\n- User authentication\n- Review moderation capabilities\n- CAPTCHA or other anti-spam measures\n- More sophisticated validation\n- Improved security measures", "code_blocks": ["```php\n<?php\n// Database configuration\n$host = 'localhost';\n$username = 'root';\n$password = '';\n$db_name = 'reviews_db';\n\n// Connect to the database\n$conn = new mysqli($host, $username, $password, $db_name);\n\n// Check connection\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Create reviews table if not exists\n$sql = \"CREATE TABLE IF NOT EXISTS reviews (\n    id INT AUTO_INCREMENT PRIMARY KEY,\n    product_id INT,\n    user_name VARCHAR(100),\n    email VARCHAR(100),\n    rating INT,\n    comment TEXT,\n    timestamp DATETIME\n)\";\n\n$conn->query($sql);\n\n// Function to add a new review\nfunction addReview($product_id, $user_name, $email, $rating, $comment) {\n    global $conn;\n    \n    // Sanitize input data\n    $user_name = htmlspecialchars(strip_tags($user_name));\n    $email = htmlspecialchars(strip_tags($email));\n    $comment = htmlspecialchars(strip_tags($comment));\n    \n    // Prepare and bind\n    $stmt = $conn->prepare(\"INSERT INTO reviews (product_id, user_name, email, rating, comment, timestamp) VALUES (?, ?, ?, ?, ?, NOW())\");\n    $stmt->bind_param(\"isiii\", $product_id, $user_name, $email, $rating, $comment);\n    \n    // Execute the query\n    if ($stmt->execute()) {\n        return true;\n    } else {\n        return false;\n    }\n}\n\n// Function to display reviews\nfunction displayReviews($product_id) {\n    global $conn;\n    \n    $sql = \"SELECT * FROM reviews WHERE product_id = ? ORDER BY timestamp DESC\";\n    $stmt = $conn->prepare($sql);\n    $stmt->bind_param(\"i\", $product_id);\n    $stmt->execute();\n    \n    $result = $stmt->get_result();\n    \n    while ($row = $result->fetch_assoc()) {\n        echo \"<div class='review'>\";\n        echo \"<h4>\" . $row['user_name'] . \"</h4>\";\n        echo \"<p>Rating: \" . getStars($row['rating']) . \"</p>\";\n        echo \"<p>Email: \" . $row['email'] . \"</p>\";\n        echo \"<p>Comment: \" . $row['comment'] . \"</p>\";\n        echo \"<small>\" . date('F j, Y', strtotime($row['timestamp'])) . \"</small>\";\n        echo \"</div>\";\n    }\n}\n\n// Helper function to display stars for rating\nfunction getStars($rating) {\n    $stars = \"\";\n    for ($i = 1; $i <= 5; $i++) {\n        if ($i <= $rating) {\n            $stars .= \"\u2605\";\n        } else {\n            $stars .= \"\u2606\";\n        }\n    }\n    return $stars;\n}\n\n// Close database connection\n$conn->close();\n?>\n\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Product Reviews</title>\n    <style>\n        .review {\n            border: 1px solid #ddd;\n            padding: 15px;\n            margin: 10px 0;\n            background-color: #f9f9f9;\n        }\n        h4 { color: #333; }\n        p { line-height: 1.6; }\n    </style>\n</head>\n<body>\n\n<?php\n// Handle form submission\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n    $product_id = 1; // Example product ID\n    \n    if (!empty($_POST['name']) && !empty($_POST['email']) && isset($_POST['rating']) && !empty($_POST['comment'])) {\n        $success = addReview($product_id, $_POST['name'], $_POST['email'], $_POST['rating'], $_POST['comment']);\n        \n        if ($success) {\n            echo \"<p>Thank you for your review!</p>\";\n        } else {\n            echo \"<p>Error submitting review. Please try again.</p>\";\n        }\n    } else {\n        echo \"<p>Please fill in all required fields.</p>\";\n    }\n}\n\n// Display review form\n?>\n\n<h2>Submit a Review</h2>\n<form method=\"post\" action=\"<?php echo $_SERVER['PHP_SELF']; ?>\">\n    <div>\n        <label for=\"name\">Name:</label><br>\n        <input type=\"text\" id=\"name\" name=\"name\">\n    </div>\n    \n    <div>\n        <label for=\"email\">Email:</label><br>\n        <input type=\"email\" id=\"email\" name=\"email\">\n    </div>\n    \n    <div>\n        <label>Rating:</label><br>\n        <select name=\"rating\">\n            <option value=\"\">Select rating</option>\n            <option value=\"5\">5 Stars</option>\n            <option value=\"4\">4 Stars</option>\n            <option value=\"3\">3 Stars</option>\n            <option value=\"2\">2 Stars</option>\n            <option value=\"1\">1 Star</option>\n        </select>\n    </div>\n    \n    <div>\n        <label for=\"comment\">Comment:</label><br>\n        <textarea id=\"comment\" name=\"comment\" rows=\"5\"></textarea>\n    </div>\n    \n    <input type=\"submit\" value=\"Submit Review\">\n</form>\n\n<h2>Reviews</h2>\n<?php\ndisplayReviews(1); // Display reviews for product ID 1\n?>\n</body>\n</html>\n```"]}
