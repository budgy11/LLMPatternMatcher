{"prompt": "Create a user review function using php", "llm_output": "Here's an example of a basic user review system using PHP, HTML, and MySQL. This example includes functions for adding, editing, deleting, and displaying reviews.\n\n**Database Schema:**\n\nFirst, let's create the database schema:\n```sql\nCREATE TABLE users (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  name VARCHAR(255),\n  email VARCHAR(255)\n);\n\nCREATE TABLE products (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  name VARCHAR(255),\n  description TEXT\n);\n\nCREATE TABLE reviews (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  user_id INT,\n  product_id INT,\n  rating TINYINT,\n  review TEXT,\n  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n  FOREIGN KEY (user_id) REFERENCES users(id),\n  FOREIGN KEY (product_id) REFERENCES products(id)\n);\n```\n**PHP Functions:**\n\nNext, let's create the PHP functions for interacting with the database:\n```php\n// db.php\n\n<?php\n$host = 'localhost';\n$username = 'root';\n$password = '';\n$dbname = 'reviews';\n\ntry {\n  $conn = new PDO(\"mysql:host=$host;dbname=$dbname\", $username, $password);\n} catch (PDOException $e) {\n  echo \"Connection failed: \" . $e->getMessage();\n}\n\nfunction addReview($data) {\n  global $conn;\n  \n  $query = \"INSERT INTO reviews (user_id, product_id, rating, review)\n            VALUES (:user_id, :product_id, :rating, :review)\";\n  \n  $stmt = $conn->prepare($query);\n  $stmt->bindParam(':user_id', $data['user_id']);\n  $stmt->bindParam(':product_id', $data['product_id']);\n  $stmt->bindParam(':rating', $data['rating']);\n  $stmt->bindParam(':review', $data['review']);\n  \n  if ($stmt->execute()) {\n    return true;\n  } else {\n    return false;\n  }\n}\n\nfunction getReviews($productId) {\n  global $conn;\n  \n  $query = \"SELECT r.id, u.name, p.name AS product_name, r.rating, r.review\n            FROM reviews r\n            JOIN users u ON r.user_id = u.id\n            JOIN products p ON r.product_id = p.id\n            WHERE r.product_id = :product_id\";\n  \n  $stmt = $conn->prepare($query);\n  $stmt->bindParam(':product_id', $productId);\n  \n  $stmt->execute();\n  \n  return $stmt->fetchAll(PDO::FETCH_ASSOC);\n}\n\nfunction editReview($data) {\n  global $conn;\n  \n  $query = \"UPDATE reviews\n            SET rating = :rating, review = :review\n            WHERE id = :id\";\n  \n  $stmt = $conn->prepare($query);\n  $stmt->bindParam(':rating', $data['rating']);\n  $stmt->bindParam(':review', $data['review']);\n  $stmt->bindParam(':id', $data['id']);\n  \n  if ($stmt->execute()) {\n    return true;\n  } else {\n    return false;\n  }\n}\n\nfunction deleteReview($id) {\n  global $conn;\n  \n  $query = \"DELETE FROM reviews\n            WHERE id = :id\";\n  \n  $stmt = $conn->prepare($query);\n  $stmt->bindParam(':id', $id);\n  \n  if ($stmt->execute()) {\n    return true;\n  } else {\n    return false;\n  }\n}\n?>\n```\n**User Review Function:**\n\nNow, let's create the user review function:\n```php\n// reviews.php\n\n<?php\nrequire_once 'db.php';\n\nif (isset($_POST['submit'])) {\n  $data = array(\n    'user_id' => $_SESSION['user']['id'],\n    'product_id' => $_GET['id'],\n    'rating' => $_POST['rating'],\n    'review' => $_POST['review']\n  );\n  \n  if (addReview($data)) {\n    echo \"Review added successfully!\";\n  } else {\n    echo \"Failed to add review.\";\n  }\n}\n\nif (isset($_GET['edit'])) {\n  $id = $_GET['edit'];\n  \n  $review = getReviews($id);\n  foreach ($review as $row) {\n    $rating = $row['rating'];\n    $reviewText = $row['review'];\n  }\n}\n\nif (isset($_POST['update'])) {\n  $data = array(\n    'id' => $_GET['edit'],\n    'rating' => $_POST['rating'],\n    'review' => $_POST['review']\n  );\n  \n  if (editReview($data)) {\n    echo \"Review updated successfully!\";\n  } else {\n    echo \"Failed to update review.\";\n  }\n}\n\nif (isset($_GET['delete'])) {\n  $id = $_GET['delete'];\n  \n  if (deleteReview($id)) {\n    echo \"Review deleted successfully!\";\n  } else {\n    echo \"Failed to delete review.\";\n  }\n}\n?>\n```\n**HTML:**\n\nFinally, let's create the HTML form for adding reviews:\n```html\n<!-- reviews.php -->\n\n<form action=\"\" method=\"post\">\n  <label for=\"rating\">Rating:</label>\n  <select name=\"rating\" id=\"rating\">\n    <option value=\"1\">1</option>\n    <option value=\"2\">2</option>\n    <option value=\"3\">3</option>\n    <option value=\"4\">4</option>\n    <option value=\"5\">5</option>\n  </select>\n  \n  <label for=\"review\">Review:</label>\n  <textarea name=\"review\" id=\"review\"></textarea>\n  \n  <input type=\"submit\" name=\"submit\" value=\"Add Review\">\n</form>\n\n<?php if (isset($_GET['edit'])) { ?>\n  <h2>Edit Review</h2>\n  <form action=\"\" method=\"post\">\n    <label for=\"rating\">Rating:</label>\n    <select name=\"rating\" id=\"rating\">\n      <option value=\"1\">1</option>\n      <option value=\"2\">2</option>\n      <option value=\"3\">3</option>\n      <option value=\"4\">4</option>\n      <option value=\"5\">5</option>\n    </select>\n    \n    <label for=\"review\">Review:</label>\n    <textarea name=\"review\" id=\"review\"><?php echo $reviewText; ?></textarea>\n    \n    <input type=\"hidden\" name=\"id\" value=\"<?php echo $id; ?>\">\n    \n    <input type=\"submit\" name=\"update\" value=\"Update Review\">\n  </form>\n<?php } ?>\n\n<?php if (isset($_GET['delete'])) { ?>\n  <h2>Delete Review</h2>\n  <p>Are you sure you want to delete this review?</p>\n  \n  <form action=\"\" method=\"post\">\n    <input type=\"hidden\" name=\"id\" value=\"<?php echo $id; ?>\">\n    \n    <input type=\"submit\" name=\"delete\" value=\"Delete Review\">\n  </form>\n<?php } ?>\n```\nNote that this is a basic example and you may want to add more functionality, such as validation and security measures.", "code_blocks": [null, "```php\n// db.php\n\n<?php\n$host = 'localhost';\n$username = 'root';\n$password = '';\n$dbname = 'reviews';\n\ntry {\n  $conn = new PDO(\"mysql:host=$host;dbname=$dbname\", $username, $password);\n} catch (PDOException $e) {\n  echo \"Connection failed: \" . $e->getMessage();\n}\n\nfunction addReview($data) {\n  global $conn;\n  \n  $query = \"INSERT INTO reviews (user_id, product_id, rating, review)\n            VALUES (:user_id, :product_id, :rating, :review)\";\n  \n  $stmt = $conn->prepare($query);\n  $stmt->bindParam(':user_id', $data['user_id']);\n  $stmt->bindParam(':product_id', $data['product_id']);\n  $stmt->bindParam(':rating', $data['rating']);\n  $stmt->bindParam(':review', $data['review']);\n  \n  if ($stmt->execute()) {\n    return true;\n  } else {\n    return false;\n  }\n}\n\nfunction getReviews($productId) {\n  global $conn;\n  \n  $query = \"SELECT r.id, u.name, p.name AS product_name, r.rating, r.review\n            FROM reviews r\n            JOIN users u ON r.user_id = u.id\n            JOIN products p ON r.product_id = p.id\n            WHERE r.product_id = :product_id\";\n  \n  $stmt = $conn->prepare($query);\n  $stmt->bindParam(':product_id', $productId);\n  \n  $stmt->execute();\n  \n  return $stmt->fetchAll(PDO::FETCH_ASSOC);\n}\n\nfunction editReview($data) {\n  global $conn;\n  \n  $query = \"UPDATE reviews\n            SET rating = :rating, review = :review\n            WHERE id = :id\";\n  \n  $stmt = $conn->prepare($query);\n  $stmt->bindParam(':rating', $data['rating']);\n  $stmt->bindParam(':review', $data['review']);\n  $stmt->bindParam(':id', $data['id']);\n  \n  if ($stmt->execute()) {\n    return true;\n  } else {\n    return false;\n  }\n}\n\nfunction deleteReview($id) {\n  global $conn;\n  \n  $query = \"DELETE FROM reviews\n            WHERE id = :id\";\n  \n  $stmt = $conn->prepare($query);\n  $stmt->bindParam(':id', $id);\n  \n  if ($stmt->execute()) {\n    return true;\n  } else {\n    return false;\n  }\n}\n?>\n```", "```php\n// reviews.php\n\n<?php\nrequire_once 'db.php';\n\nif (isset($_POST['submit'])) {\n  $data = array(\n    'user_id' => $_SESSION['user']['id'],\n    'product_id' => $_GET['id'],\n    'rating' => $_POST['rating'],\n    'review' => $_POST['review']\n  );\n  \n  if (addReview($data)) {\n    echo \"Review added successfully!\";\n  } else {\n    echo \"Failed to add review.\";\n  }\n}\n\nif (isset($_GET['edit'])) {\n  $id = $_GET['edit'];\n  \n  $review = getReviews($id);\n  foreach ($review as $row) {\n    $rating = $row['rating'];\n    $reviewText = $row['review'];\n  }\n}\n\nif (isset($_POST['update'])) {\n  $data = array(\n    'id' => $_GET['edit'],\n    'rating' => $_POST['rating'],\n    'review' => $_POST['review']\n  );\n  \n  if (editReview($data)) {\n    echo \"Review updated successfully!\";\n  } else {\n    echo \"Failed to update review.\";\n  }\n}\n\nif (isset($_GET['delete'])) {\n  $id = $_GET['delete'];\n  \n  if (deleteReview($id)) {\n    echo \"Review deleted successfully!\";\n  } else {\n    echo \"Failed to delete review.\";\n  }\n}\n?>\n```", null]}
