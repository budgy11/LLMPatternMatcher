{"prompt": "Create a user review function using php", "llm_output": "**User Review Function in PHP**\n====================================\n\nThis is an example of a basic user review system implemented in PHP. The system allows users to submit reviews, display existing reviews, and calculate the average rating.\n\n**Database Schema**\n--------------------\n\nWe will use a simple database schema with two tables: `users` and `reviews`. The `reviews` table has foreign key references to the `users` table.\n\n```sql\nCREATE TABLE users (\n    id INT PRIMARY KEY,\n    name VARCHAR(255),\n    email VARCHAR(255)\n);\n\nCREATE TABLE reviews (\n    id INT PRIMARY KEY,\n    user_id INT,\n    product_name VARCHAR(255),\n    rating INT,\n    review TEXT,\n    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n    FOREIGN KEY (user_id) REFERENCES users(id)\n);\n```\n\n**PHP Code**\n-------------\n\nCreate a file named `review.php` and add the following code:\n\n```php\n<?php\n\n// Connect to database\nrequire_once 'db.php';\n\nfunction getReviews() {\n    $query = \"SELECT * FROM reviews\";\n    return executeQuery($query);\n}\n\nfunction createUserReview($user_id, $product_name, $rating, $review) {\n    $query = \"INSERT INTO reviews (user_id, product_name, rating, review) VALUES (:user_id, :product_name, :rating, :review)\";\n    $params = [\n        ':user_id' => $user_id,\n        ':product_name' => $product_name,\n        ':rating' => $rating,\n        ':review' => $review\n    ];\n    return executeQuery($query, $params);\n}\n\nfunction getAverageRating() {\n    $query = \"SELECT AVG(rating) as average_rating FROM reviews\";\n    $result = executeQuery($query);\n    return ($result[0]['average_rating'] ?? 0);\n}\n\nfunction displayReviews() {\n    $reviews = getReviews();\n    foreach ($reviews as $review) {\n        echo \"<h2>\" . $review['product_name'] . \"</h2>\";\n        echo \"<p>Rating: \" . $review['rating'] . \"/5</p>\";\n        echo \"<p>Review: \" . $review['review'] . \"</p>\";\n    }\n}\n\nfunction executeQuery($query, $params = []) {\n    global $db;\n    try {\n        $stmt = $db->prepare($query);\n        if (!empty($params)) {\n            foreach ($params as $key => $value) {\n                $stmt->bindValue(\":$key\", $value);\n            }\n        }\n        $stmt->execute();\n        return $stmt->fetchAll();\n    } catch (PDOException $e) {\n        echo \"Error: \" . $e->getMessage();\n        exit;\n    }\n}\n\n// Initialize database connection\n$db = new PDO('mysql:host=localhost;dbname=review_system', 'username', 'password');\n\n// Display reviews\ndisplayReviews();\n\n// Get average rating\necho \"<h2>Average Rating:</h2>\";\necho getAverageRating() . \"/5\";\n\n?>\n```\n\n**Usage**\n---------\n\n1. Replace the database credentials in `db.php` with your own.\n2. Create a new user by inserting data into the `users` table.\n3. Users can submit reviews using the `createUserReview()` function.\n4. Display all existing reviews using the `displayReviews()` function.\n5. Calculate the average rating using the `getAverageRating()` function.\n\n**Example Use Cases**\n--------------------\n\n* User submits a review for a product with a rating of 4/5 and a review text.\n* The system displays all existing reviews on the page.\n* The system calculates and displays the average rating on the page.", "code_blocks": [null, "```php\n<?php\n\n// Connect to database\nrequire_once 'db.php';\n\nfunction getReviews() {\n    $query = \"SELECT * FROM reviews\";\n    return executeQuery($query);\n}\n\nfunction createUserReview($user_id, $product_name, $rating, $review) {\n    $query = \"INSERT INTO reviews (user_id, product_name, rating, review) VALUES (:user_id, :product_name, :rating, :review)\";\n    $params = [\n        ':user_id' => $user_id,\n        ':product_name' => $product_name,\n        ':rating' => $rating,\n        ':review' => $review\n    ];\n    return executeQuery($query, $params);\n}\n\nfunction getAverageRating() {\n    $query = \"SELECT AVG(rating) as average_rating FROM reviews\";\n    $result = executeQuery($query);\n    return ($result[0]['average_rating'] ?? 0);\n}\n\nfunction displayReviews() {\n    $reviews = getReviews();\n    foreach ($reviews as $review) {\n        echo \"<h2>\" . $review['product_name'] . \"</h2>\";\n        echo \"<p>Rating: \" . $review['rating'] . \"/5</p>\";\n        echo \"<p>Review: \" . $review['review'] . \"</p>\";\n    }\n}\n\nfunction executeQuery($query, $params = []) {\n    global $db;\n    try {\n        $stmt = $db->prepare($query);\n        if (!empty($params)) {\n            foreach ($params as $key => $value) {\n                $stmt->bindValue(\":$key\", $value);\n            }\n        }\n        $stmt->execute();\n        return $stmt->fetchAll();\n    } catch (PDOException $e) {\n        echo \"Error: \" . $e->getMessage();\n        exit;\n    }\n}\n\n// Initialize database connection\n$db = new PDO('mysql:host=localhost;dbname=review_system', 'username', 'password');\n\n// Display reviews\ndisplayReviews();\n\n// Get average rating\necho \"<h2>Average Rating:</h2>\";\necho getAverageRating() . \"/5\";\n\n?>\n```"]}
