{"prompt": "Create a user review function using php", "llm_output": "Here is an example of a basic user review system in PHP:\n\n**Database Schema:**\n\nWe'll need to create the following database tables for this system:\n```sql\nCREATE TABLE users (\n  id INT PRIMARY KEY,\n  username VARCHAR(255),\n  email VARCHAR(255)\n);\n\nCREATE TABLE products (\n  id INT PRIMARY KEY,\n  name VARCHAR(255),\n  description TEXT\n);\n\nCREATE TABLE reviews (\n  id INT PRIMARY KEY,\n  user_id INT,\n  product_id INT,\n  rating TINYINT(1),\n  review TEXT,\n  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n);\n```\n**PHP Code:**\n\n```php\n<?php\n\n// Configuration\ndefine('DB_HOST', 'your_host');\ndefine('DB_USER', 'your_user');\ndefine('DB_PASSWORD', 'your_password');\ndefine('DB_NAME', 'your_database');\n\n// Connect to database\n$mysqli = new mysqli(DB_HOST, DB_USER, DB_PASSWORD, DB_NAME);\n\nif ($mysqli->connect_errno) {\n    echo \"Failed to connect to MySQL: (\" . $mysqli->connect_errno . \") \" . $mysqli->connect_error;\n}\n\nfunction createUserReview($product_id, $rating, $review) {\n  global $mysqli;\n\n  // Insert new review\n  $query = \"\n    INSERT INTO reviews (user_id, product_id, rating, review)\n    VALUES (1, ?, ?, ?)\";\n  $stmt = $mysqli->prepare($query);\n  $stmt->bind_param('iii', $product_id, $rating, $review);\n  if (!$stmt->execute()) {\n      echo \"Error: \" . $mysqli->error;\n  }\n\n  // Update product rating\n  $query = \"\n    UPDATE products\n    SET rating = (SELECT AVG(rating) FROM reviews WHERE product_id = ?)\";\n  $stmt = $mysqli->prepare($query);\n  $stmt->bind_param('i', $product_id);\n  if (!$stmt->execute()) {\n      echo \"Error: \" . $mysqli->error;\n  }\n\n  // Return new review ID\n  return $mysqli->insert_id;\n}\n\nfunction getUserReviews($user_id) {\n  global $mysqli;\n\n  // Retrieve reviews for user\n  $query = \"\n    SELECT r.id, p.name, r.rating, r.review\n    FROM reviews r\n    JOIN products p ON r.product_id = p.id\n    WHERE r.user_id = ?\";\n  $stmt = $mysqli->prepare($query);\n  $stmt->bind_param('i', $user_id);\n  if (!$stmt->execute()) {\n      echo \"Error: \" . $mysqli->error;\n  }\n\n  // Return reviews as array\n  $reviews = array();\n  while ($row = $stmt->fetch_assoc()) {\n      $reviews[] = array(\n          'id' => $row['id'],\n          'product_name' => $row['name'],\n          'rating' => $row['rating'],\n          'review' => $row['review']\n      );\n  }\n  return $reviews;\n}\n\nfunction getProductReviews($product_id) {\n  global $mysqli;\n\n  // Retrieve reviews for product\n  $query = \"\n    SELECT r.id, u.username, r.rating, r.review\n    FROM reviews r\n    JOIN users u ON r.user_id = u.id\n    WHERE r.product_id = ?\";\n  $stmt = $mysqli->prepare($query);\n  $stmt->bind_param('i', $product_id);\n  if (!$stmt->execute()) {\n      echo \"Error: \" . $mysqli->error;\n  }\n\n  // Return reviews as array\n  $reviews = array();\n  while ($row = $stmt->fetch_assoc()) {\n      $reviews[] = array(\n          'id' => $row['id'],\n          'username' => $row['username'],\n          'rating' => $row['rating'],\n          'review' => $row['review']\n      );\n  }\n  return $reviews;\n}\n\n?>\n```\n**Example Use Cases:**\n\n1. User reviews a product:\n```php\n$product_id = 123;\n$rating = 5;\n$review = \"Great product!\";\n\n$review_id = createUserReview($product_id, $rating, $review);\necho \"New review created with ID: $review_id\";\n```\n2. Retrieve user's reviews:\n```php\n$user_id = 1;\n\n$reviews = getUserReviews($user_id);\nforeach ($reviews as $review) {\n    echo \"Product: $review['product_name'], Rating: $review['rating'], Review: $review['review']\";\n}\n```\n3. Retrieve product's reviews:\n```php\n$product_id = 123;\n\n$reviews = getProductReviews($product_id);\nforeach ($reviews as $review) {\n    echo \"Username: $review['username'], Rating: $review['rating'], Review: $review['review']\";\n}\n```\nNote that this is a basic implementation and you may want to add additional functionality, such as user authentication, validation, and error handling.", "code_blocks": [null, "```php\n<?php\n\n// Configuration\ndefine('DB_HOST', 'your_host');\ndefine('DB_USER', 'your_user');\ndefine('DB_PASSWORD', 'your_password');\ndefine('DB_NAME', 'your_database');\n\n// Connect to database\n$mysqli = new mysqli(DB_HOST, DB_USER, DB_PASSWORD, DB_NAME);\n\nif ($mysqli->connect_errno) {\n    echo \"Failed to connect to MySQL: (\" . $mysqli->connect_errno . \") \" . $mysqli->connect_error;\n}\n\nfunction createUserReview($product_id, $rating, $review) {\n  global $mysqli;\n\n  // Insert new review\n  $query = \"\n    INSERT INTO reviews (user_id, product_id, rating, review)\n    VALUES (1, ?, ?, ?)\";\n  $stmt = $mysqli->prepare($query);\n  $stmt->bind_param('iii', $product_id, $rating, $review);\n  if (!$stmt->execute()) {\n      echo \"Error: \" . $mysqli->error;\n  }\n\n  // Update product rating\n  $query = \"\n    UPDATE products\n    SET rating = (SELECT AVG(rating) FROM reviews WHERE product_id = ?)\";\n  $stmt = $mysqli->prepare($query);\n  $stmt->bind_param('i', $product_id);\n  if (!$stmt->execute()) {\n      echo \"Error: \" . $mysqli->error;\n  }\n\n  // Return new review ID\n  return $mysqli->insert_id;\n}\n\nfunction getUserReviews($user_id) {\n  global $mysqli;\n\n  // Retrieve reviews for user\n  $query = \"\n    SELECT r.id, p.name, r.rating, r.review\n    FROM reviews r\n    JOIN products p ON r.product_id = p.id\n    WHERE r.user_id = ?\";\n  $stmt = $mysqli->prepare($query);\n  $stmt->bind_param('i', $user_id);\n  if (!$stmt->execute()) {\n      echo \"Error: \" . $mysqli->error;\n  }\n\n  // Return reviews as array\n  $reviews = array();\n  while ($row = $stmt->fetch_assoc()) {\n      $reviews[] = array(\n          'id' => $row['id'],\n          'product_name' => $row['name'],\n          'rating' => $row['rating'],\n          'review' => $row['review']\n      );\n  }\n  return $reviews;\n}\n\nfunction getProductReviews($product_id) {\n  global $mysqli;\n\n  // Retrieve reviews for product\n  $query = \"\n    SELECT r.id, u.username, r.rating, r.review\n    FROM reviews r\n    JOIN users u ON r.user_id = u.id\n    WHERE r.product_id = ?\";\n  $stmt = $mysqli->prepare($query);\n  $stmt->bind_param('i', $product_id);\n  if (!$stmt->execute()) {\n      echo \"Error: \" . $mysqli->error;\n  }\n\n  // Return reviews as array\n  $reviews = array();\n  while ($row = $stmt->fetch_assoc()) {\n      $reviews[] = array(\n          'id' => $row['id'],\n          'username' => $row['username'],\n          'rating' => $row['rating'],\n          'review' => $row['review']\n      );\n  }\n  return $reviews;\n}\n\n?>\n```", "```php\n$product_id = 123;\n$rating = 5;\n$review = \"Great product!\";\n\n$review_id = createUserReview($product_id, $rating, $review);\necho \"New review created with ID: $review_id\";\n```", "```php\n$user_id = 1;\n\n$reviews = getUserReviews($user_id);\nforeach ($reviews as $review) {\n    echo \"Product: $review['product_name'], Rating: $review['rating'], Review: $review['review']\";\n}\n```", "```php\n$product_id = 123;\n\n$reviews = getProductReviews($product_id);\nforeach ($reviews as $review) {\n    echo \"Username: $review['username'], Rating: $review['rating'], Review: $review['review']\";\n}\n```"]}
