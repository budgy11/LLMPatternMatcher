{"prompt": "Create a purchase functionality using php", "llm_output": "Here is an example of a basic purchase functionality using PHP, including form validation and database interaction. This example assumes you have already set up a MySQL database with the necessary tables to store orders and products.\n\n**Database Schema:**\n\nFor this example, we'll need two tables:\n\n1. `orders`:\n\t* `id` (primary key)\n\t* `user_id` (foreign key referencing the user who made the order)\n\t* `order_date`\n\t* `total_cost`\n2. `products`:\n\t* `id` (primary key)\n\t* `name`\n\t* `price`\n\n**PHP Code:**\n\nCreate a new PHP file named `purchase.php`. Add the following code:\n\n```php\n<?php\n\n// Configuration\ndefine('DB_HOST', 'localhost');\ndefine('DB_USER', 'your_username');\ndefine('DB_PASSWORD', 'your_password');\ndefine('DB_NAME', 'your_database');\n\n// Establish database connection\n$conn = new mysqli(DB_HOST, DB_USER, DB_PASSWORD, DB_NAME);\n\n// Check connection\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Function to display products for purchase\nfunction displayProducts() {\n    $query = \"SELECT * FROM products\";\n    $result = $conn->query($query);\n\n    echo \"<h2>Available Products</h2>\";\n    echo \"<table border='1'>\";\n    echo \"<tr><th>Name</th><th>Price</th></tr>\";\n\n    while ($row = $result->fetch_assoc()) {\n        echo \"<tr><td>\" . $row['name'] . \"</td><td>$\" . $row['price'] . \"</td></tr>\";\n    }\n\n    echo \"</table>\";\n}\n\n// Function to process purchase\nfunction processPurchase() {\n    if (isset($_POST['submit'])) {\n        // Get product IDs from form data\n        $productIds = $_POST['products'];\n\n        // Validate product IDs\n        foreach ($productIds as $productId) {\n            if (!ctype_digit($productId)) {\n                echo \"Invalid product ID\";\n                return;\n            }\n        }\n\n        // Calculate total cost\n        $totalCost = 0;\n        foreach ($productIds as $productId) {\n            $query = \"SELECT price FROM products WHERE id = '$productId'\";\n            $result = $conn->query($query);\n            if ($result->num_rows > 0) {\n                while ($row = $result->fetch_assoc()) {\n                    $totalCost += $row['price'];\n                }\n            } else {\n                echo \"Product not found\";\n                return;\n            }\n        }\n\n        // Create new order\n        $userId = $_SESSION['user_id'];\n        $orderDate = date('Y-m-d H:i:s');\n        $query = \"INSERT INTO orders (user_id, total_cost) VALUES ('$userId', '$totalCost')\";\n        if ($conn->query($query)) {\n            echo \"Order placed successfully\";\n        } else {\n            echo \"Error placing order: \" . $conn->error;\n        }\n\n        // Add products to order\n        foreach ($productIds as $productId) {\n            $query = \"INSERT INTO order_products (order_id, product_id) VALUES ((SELECT MAX(id) FROM orders), '$productId')\";\n            if (!$conn->query($query)) {\n                echo \"Error adding product to order: \" . $conn->error;\n                return;\n            }\n        }\n\n        header('Location: view_order.php');\n        exit();\n    }\n}\n\n?>\n\n<!-- HTML Form -->\n<form action=\"<?php $_SERVER['PHP_SELF'] ?>\" method=\"post\">\n    <?php displayProducts(); ?>\n    <br>\n    <input type=\"checkbox\" name=\"products[]\" value=\"1\">Product 1\n    <br>\n    <input type=\"checkbox\" name=\"products[]\" value=\"2\">Product 2\n    <br>\n    <button type=\"submit\" name=\"submit\">Place Order</button>\n</form>\n\n<?php processPurchase(); ?>\n```\n\n**Explanation:**\n\n*   We first define the database connection settings at the top of the file.\n*   The `displayProducts` function retrieves all products from the database and displays them as a table in the HTML form.\n*   The `processPurchase` function handles the purchase logic. It checks if the form has been submitted, validates the product IDs, calculates the total cost, creates a new order, adds products to the order, and redirects the user to the view order page.\n*   Finally, we create an HTML form that displays the available products and allows users to select products for purchase.\n\nNote: This is a simplified example. You may want to add additional features such as user authentication, payment processing, and error handling depending on your specific requirements.\n\n**Example Use Case:**\n\n1.  A user visits the `purchase.php` page.\n2.  The user selects one or more products from the list of available products.\n3.  The user clicks the \"Place Order\" button to submit their purchase request.\n4.  The `processPurchase` function is executed, and it creates a new order with the selected products.\n5.  The user is redirected to the view order page (`view_order.php`) where they can view details about their order.\n\nRemember to replace placeholders like `'your_username'`, `'your_password'`, and `'your_database'` with your actual database credentials.", "code_blocks": ["```php\n<?php\n\n// Configuration\ndefine('DB_HOST', 'localhost');\ndefine('DB_USER', 'your_username');\ndefine('DB_PASSWORD', 'your_password');\ndefine('DB_NAME', 'your_database');\n\n// Establish database connection\n$conn = new mysqli(DB_HOST, DB_USER, DB_PASSWORD, DB_NAME);\n\n// Check connection\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Function to display products for purchase\nfunction displayProducts() {\n    $query = \"SELECT * FROM products\";\n    $result = $conn->query($query);\n\n    echo \"<h2>Available Products</h2>\";\n    echo \"<table border='1'>\";\n    echo \"<tr><th>Name</th><th>Price</th></tr>\";\n\n    while ($row = $result->fetch_assoc()) {\n        echo \"<tr><td>\" . $row['name'] . \"</td><td>$\" . $row['price'] . \"</td></tr>\";\n    }\n\n    echo \"</table>\";\n}\n\n// Function to process purchase\nfunction processPurchase() {\n    if (isset($_POST['submit'])) {\n        // Get product IDs from form data\n        $productIds = $_POST['products'];\n\n        // Validate product IDs\n        foreach ($productIds as $productId) {\n            if (!ctype_digit($productId)) {\n                echo \"Invalid product ID\";\n                return;\n            }\n        }\n\n        // Calculate total cost\n        $totalCost = 0;\n        foreach ($productIds as $productId) {\n            $query = \"SELECT price FROM products WHERE id = '$productId'\";\n            $result = $conn->query($query);\n            if ($result->num_rows > 0) {\n                while ($row = $result->fetch_assoc()) {\n                    $totalCost += $row['price'];\n                }\n            } else {\n                echo \"Product not found\";\n                return;\n            }\n        }\n\n        // Create new order\n        $userId = $_SESSION['user_id'];\n        $orderDate = date('Y-m-d H:i:s');\n        $query = \"INSERT INTO orders (user_id, total_cost) VALUES ('$userId', '$totalCost')\";\n        if ($conn->query($query)) {\n            echo \"Order placed successfully\";\n        } else {\n            echo \"Error placing order: \" . $conn->error;\n        }\n\n        // Add products to order\n        foreach ($productIds as $productId) {\n            $query = \"INSERT INTO order_products (order_id, product_id) VALUES ((SELECT MAX(id) FROM orders), '$productId')\";\n            if (!$conn->query($query)) {\n                echo \"Error adding product to order: \" . $conn->error;\n                return;\n            }\n        }\n\n        header('Location: view_order.php');\n        exit();\n    }\n}\n\n?>\n\n<!-- HTML Form -->\n<form action=\"<?php $_SERVER['PHP_SELF'] ?>\" method=\"post\">\n    <?php displayProducts(); ?>\n    <br>\n    <input type=\"checkbox\" name=\"products[]\" value=\"1\">Product 1\n    <br>\n    <input type=\"checkbox\" name=\"products[]\" value=\"2\">Product 2\n    <br>\n    <button type=\"submit\" name=\"submit\">Place Order</button>\n</form>\n\n<?php processPurchase(); ?>\n```"]}
