{"prompt": "Create a purchase functionality using php", "llm_output": "<think>\nOkay, I need to create a purchase functionality using PHP. Let me think about how to approach this.\n\nFirst, I should outline the main components involved in a purchase process. There's the product listing, adding items to the cart, viewing the cart, and then making the purchase. So, I'll start by setting up a basic HTML structure for displaying products.\n\nI'll need a database to store product information. Using MySQL makes sense here. I'll create a table called 'products' with columns like id, name, description, price, and quantity. That way, I can fetch products from the database to display on the page.\n\nNext, I'll use PHP to connect to the database and retrieve the product data. I'll loop through each product and display them in a grid layout using Bootstrap for styling. Each product will have an 'Add to Cart' button that sends the product ID to a script when clicked.\n\nFor the cart functionality, since this is a basic example, I'll use PHP sessions to store the cart data. When the user clicks 'Add to Cart,' the add_to_cart.php script will check if the product is already in the session. If it is, it increments the quantity; otherwise, it adds the product with a quantity of 1.\n\nAfter setting up the product display and cart addition, I'll create a view_cart.php page that displays the contents of the user's cart. This will show each item's name, price, quantity, and total cost, along with options to remove items or update quantities.\n\nThe checkout process is next. On the checkout.php page, users will enter their payment details. I'll include fields for card number, CVV, and expiration date. For simplicity, I won't implement actual payment processing but will simulate a successful transaction. After checkout, the cart should be cleared to complete the purchase.\n\nI also need to handle cases where there aren't enough products in stock or when the cart is empty. Adding error messages for these scenarios will improve user experience.\n\nFinally, I'll make sure all pages are properly linked and styled using Bootstrap for a clean look. Testing each part step by step\u2014like adding items, updating quantities, removing items, and checking out\u2014will ensure everything works smoothly.\n</think>\n\nHere's an example of a purchase functionality in PHP. This will include basic product listing, cart addition, and checkout processes:\n\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <title>Product Purchase</title>\n    <!-- Include Bootstrap CSS -->\n    <link href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css\" rel=\"stylesheet\">\n</head>\n<body>\n    <div class=\"container mt-4\">\n        <?php\n        // Database configuration\n        $host = 'localhost';\n        $username = 'root';\n        $password = '';\n        $database = 'purchase_db';\n\n        // Connect to database\n        $conn = new mysqli($host, $username, $password, $database);\n\n        if ($conn->connect_error) {\n            die(\"Connection failed: \" . $conn->connect_error);\n        }\n\n        // Get products from database\n        $sql = \"SELECT * FROM products\";\n        $result = $conn->query($sql);\n\n        if ($result->num_rows > 0) {\n            echo '<h2 class=\"mb-4\">Available Products</h2>';\n            echo '<div class=\"row\">';\n            \n            while ($row = $result->fetch_assoc()) {\n                echo '<div class=\"col-md-4 mb-3\">';\n                echo '<div class=\"card h-100\">';\n                echo '<img src=\"product-image.jpg\" class=\"card-img-top\" alt=\"Product Image\">';\n                echo '<div class=\"card-body\">';\n                echo '<h5 class=\"card-title\">' . $row['name'] . '</h5>';\n                echo '<p class=\"card-text\">' . $row['description'] . '</p>';\n                echo '<p class=\"card-text\">Price: $' . number_format($row['price'], 2) . '</p>';\n                echo '<form action=\"add_to_cart.php\" method=\"post\">';\n                echo '<input type=\"hidden\" name=\"product_id\" value=\"' . $row['id'] . '\">';\n                echo '<button type=\"submit\" class=\"btn btn-primary\">Add to Cart</button>';\n                echo '</form>';\n                echo '</div>';\n                echo '</div>';\n                echo '</div>';\n            }\n\n            echo '</div>';\n        } else {\n            echo \"No products found in the database.\";\n        }\n\n        $conn->close();\n        ?>\n    </div>\n\n    <!-- Include Bootstrap JS and dependencies -->\n    <script src=\"https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js\"></script>\n    <script src=\"https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js\"></script>\n</body>\n</html>\n```\n\nCreate a `add_to_cart.php` file:\n\n```php\n<?php\nsession_start();\n\n// Initialize cart if not exists\nif (!isset($_SESSION['cart'])) {\n    $_SESSION['cart'] = array();\n}\n\n$product_id = isset($_POST['product_id']) ? intval($_POST['product_id']) : 0;\n\n// Check if product already in cart\nif (array_key_exists($product_id, $_SESSION['cart'])) {\n    // Increment quantity\n    $_SESSION['cart'][$product_id]['quantity']++;\n} else {\n    // Add new product to cart\n    $conn = new mysqli('localhost', 'root', '', 'purchase_db');\n    \n    if ($stmt = $conn->prepare(\"SELECT name, price FROM products WHERE id = ?\")) {\n        $stmt->bind_param(\"i\", $product_id);\n        $stmt->execute();\n        $result = $stmt->get_result();\n        \n        if ($row = $result->fetch_assoc()) {\n            $_SESSION['cart'][$product_id] = array(\n                'name' => $row['name'],\n                'price' => $row['price'],\n                'quantity' => 1\n            );\n        }\n    }\n\n    $conn->close();\n}\n\n// Redirect back to the products page\nheader('Location: index.php');\nexit();\n?>\n```\n\nCreate a `view_cart.php` file:\n\n```php\n<?php\nsession_start();\n\nif (isset($_GET['remove'])) {\n    unset($_SESSION['cart'][$_GET['remove']]);\n    header('Location: view_cart.php');\n    exit();\n}\n\n$total = 0;\n?>\n\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <title>Shopping Cart</title>\n    <!-- Include Bootstrap CSS -->\n    <link href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css\" rel=\"stylesheet\">\n</head>\n<body>\n    <div class=\"container mt-4\">\n        <?php if (!empty($_SESSION['cart'])): ?>\n            <h2>Your Cart</h2>\n            <table class=\"table table-striped\">\n                <thead>\n                    <tr>\n                        <th>Product Name</th>\n                        <th>Price</th>\n                        <th>Quantity</th>\n                        <th>Total</th>\n                        <th>Action</th>\n                    </tr>\n                </thead>\n                <tbody>\n                    <?php foreach ($_SESSION['cart'] as $id => $item): ?>\n                        <tr>\n                            <td><?php echo $item['name']; ?></td>\n                            <td>$<?php echo number_format($item['price'], 2); ?></td>\n                            <td>\n                                <form action=\"update_cart.php\" method=\"post\">\n                                    <input type=\"hidden\" name=\"product_id\" value=\"<?php echo $id; ?>\">\n                                    <input type=\"number\" name=\"quantity\" min=\"1\" value=\"<?php echo $item['quantity']; ?>\" style=\"width: 60px;\">\n                                    <button type=\"submit\" class=\"btn btn-sm btn-primary\">Update</button>\n                                </form>\n                            </td>\n                            <td>$<?php echo number_format($item['price'] * $item['quantity'], 2); ?></td>\n                            <td><a href=\"view_cart.php?remove=<?php echo $id; ?>\" class=\"btn btn-sm btn-danger\">Remove</a></td>\n                        </tr>\n                        <?php $total += $item['price'] * $item['quantity']; ?>\n                    <?php endforeach; ?>\n                </tbody>\n            </table>\n            <h4>Total: $<?php echo number_format($total, 2); ?></h4>\n            <a href=\"checkout.php\" class=\"btn btn-primary\">Checkout</a>\n        <?php else: ?>\n            <p>Your cart is empty.</p>\n            <a href=\"index.php\" class=\"btn btn-secondary\">Continue Shopping</a>\n        <?php endif; ?>\n    </div>\n\n    <!-- Include Bootstrap JS and dependencies -->\n    <script src=\"https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js\"></script>\n    <script src=\"https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js\"></script>\n</body>\n</html>\n```\n\nCreate a `checkout.php` file:\n\n```php\n<?php\nsession_start();\n\nif (isset($_SESSION['cart']) && count($_SESSION['cart']) > 0) {\n    // Process payment here\n    // For this example, we'll just display a success message\n    \n    foreach ($_SESSION['cart'] as $item) {\n        echo \"Purchased: \" . $item['name'] . \"<br>\";\n    }\n    \n    unset($_SESSION['cart']); // Clear cart after purchase\n    \n    echo '<h2>Thank you for your purchase!</h2>';\n} else {\n    header('Location: index.php');\n}\n?>\n```\n\nCreate a `update_cart.php` file:\n\n```php\n<?php\nsession_start();\n\nif (isset($_POST['product_id']) && isset($_POST['quantity'])) {\n    $product_id = intval($_POST['product_id']);\n    $quantity = max(1, intval($_POST['quantity']));\n    \n    if (isset($_SESSION['cart'][$product_id])) {\n        $_SESSION['cart'][$product_id]['quantity'] = $quantity;\n    }\n}\n\nheader('Location: view_cart.php');\nexit();\n?>\n```\n\nTo use this code:\n\n1. Create a database named `purchase_db`\n2. Create a table named `products` with the following columns:\n   - id (INT, AUTO_INCREMENT, PRIMARY KEY)\n   - name (VARCHAR(255))\n   - description (TEXT)\n   - price (DECIMAL(10, 2))\n   - quantity (INT)\n3. Insert some sample products into the database\n4. Save all these files in your web server's document root\n\nThis code provides:\n- Product listing page\n- Add to cart functionality\n- Cart viewing and updating quantities\n- Product removal from cart\n- Checkout functionality\n- Basic error handling\n\nNote: This is a basic implementation and should be modified according to your specific needs. You might want to add:\n\n1. User authentication\n2. More robust error checking\n3. Actual payment processing (e.g., using Stripe or PayPal)\n4. Order confirmation emails\n5. Inventory management\n6. Address validation\n7. Coupon codes and discounts\n8. Order tracking\n\nMake sure to secure your application by:\n- Sanitizing all user inputs\n- Using prepared statements for database queries\n- Implementing CSRF protection\n- Properly handling session security\n- Encrypting sensitive data", "code_blocks": [null, "```php\n<?php\nsession_start();\n\n// Initialize cart if not exists\nif (!isset($_SESSION['cart'])) {\n    $_SESSION['cart'] = array();\n}\n\n$product_id = isset($_POST['product_id']) ? intval($_POST['product_id']) : 0;\n\n// Check if product already in cart\nif (array_key_exists($product_id, $_SESSION['cart'])) {\n    // Increment quantity\n    $_SESSION['cart'][$product_id]['quantity']++;\n} else {\n    // Add new product to cart\n    $conn = new mysqli('localhost', 'root', '', 'purchase_db');\n    \n    if ($stmt = $conn->prepare(\"SELECT name, price FROM products WHERE id = ?\")) {\n        $stmt->bind_param(\"i\", $product_id);\n        $stmt->execute();\n        $result = $stmt->get_result();\n        \n        if ($row = $result->fetch_assoc()) {\n            $_SESSION['cart'][$product_id] = array(\n                'name' => $row['name'],\n                'price' => $row['price'],\n                'quantity' => 1\n            );\n        }\n    }\n\n    $conn->close();\n}\n\n// Redirect back to the products page\nheader('Location: index.php');\nexit();\n?>\n```", "```php\n<?php\nsession_start();\n\nif (isset($_GET['remove'])) {\n    unset($_SESSION['cart'][$_GET['remove']]);\n    header('Location: view_cart.php');\n    exit();\n}\n\n$total = 0;\n?>\n\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <title>Shopping Cart</title>\n    <!-- Include Bootstrap CSS -->\n    <link href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css\" rel=\"stylesheet\">\n</head>\n<body>\n    <div class=\"container mt-4\">\n        <?php if (!empty($_SESSION['cart'])): ?>\n            <h2>Your Cart</h2>\n            <table class=\"table table-striped\">\n                <thead>\n                    <tr>\n                        <th>Product Name</th>\n                        <th>Price</th>\n                        <th>Quantity</th>\n                        <th>Total</th>\n                        <th>Action</th>\n                    </tr>\n                </thead>\n                <tbody>\n                    <?php foreach ($_SESSION['cart'] as $id => $item): ?>\n                        <tr>\n                            <td><?php echo $item['name']; ?></td>\n                            <td>$<?php echo number_format($item['price'], 2); ?></td>\n                            <td>\n                                <form action=\"update_cart.php\" method=\"post\">\n                                    <input type=\"hidden\" name=\"product_id\" value=\"<?php echo $id; ?>\">\n                                    <input type=\"number\" name=\"quantity\" min=\"1\" value=\"<?php echo $item['quantity']; ?>\" style=\"width: 60px;\">\n                                    <button type=\"submit\" class=\"btn btn-sm btn-primary\">Update</button>\n                                </form>\n                            </td>\n                            <td>$<?php echo number_format($item['price'] * $item['quantity'], 2); ?></td>\n                            <td><a href=\"view_cart.php?remove=<?php echo $id; ?>\" class=\"btn btn-sm btn-danger\">Remove</a></td>\n                        </tr>\n                        <?php $total += $item['price'] * $item['quantity']; ?>\n                    <?php endforeach; ?>\n                </tbody>\n            </table>\n            <h4>Total: $<?php echo number_format($total, 2); ?></h4>\n            <a href=\"checkout.php\" class=\"btn btn-primary\">Checkout</a>\n        <?php else: ?>\n            <p>Your cart is empty.</p>\n            <a href=\"index.php\" class=\"btn btn-secondary\">Continue Shopping</a>\n        <?php endif; ?>\n    </div>\n\n    <!-- Include Bootstrap JS and dependencies -->\n    <script src=\"https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js\"></script>\n    <script src=\"https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js\"></script>\n</body>\n</html>\n```", "```php\n<?php\nsession_start();\n\nif (isset($_SESSION['cart']) && count($_SESSION['cart']) > 0) {\n    // Process payment here\n    // For this example, we'll just display a success message\n    \n    foreach ($_SESSION['cart'] as $item) {\n        echo \"Purchased: \" . $item['name'] . \"<br>\";\n    }\n    \n    unset($_SESSION['cart']); // Clear cart after purchase\n    \n    echo '<h2>Thank you for your purchase!</h2>';\n} else {\n    header('Location: index.php');\n}\n?>\n```", "```php\n<?php\nsession_start();\n\nif (isset($_POST['product_id']) && isset($_POST['quantity'])) {\n    $product_id = intval($_POST['product_id']);\n    $quantity = max(1, intval($_POST['quantity']));\n    \n    if (isset($_SESSION['cart'][$product_id])) {\n        $_SESSION['cart'][$product_id]['quantity'] = $quantity;\n    }\n}\n\nheader('Location: view_cart.php');\nexit();\n?>\n```"]}
