{"prompt": "Create a purchase functionality using php", "llm_output": "Here is an example of a simple purchase functionality in PHP. This example assumes that you have already set up a database to store your products and customers.\n\n**Files:**\n\n* `cart.php`: Handles cart functionality, including adding and removing items.\n* `purchase.php`: Handles the actual purchase process, including processing payment and updating inventory.\n* `database.php`: Connects to your database.\n* `config.php`: Contains configuration settings for your application.\n\n**Database Schema:**\n\nFor this example, we'll assume a simple database schema with two tables:\n\n```sql\nCREATE TABLE products (\n  id INT PRIMARY KEY,\n  name VARCHAR(255),\n  price DECIMAL(10,2)\n);\n\nCREATE TABLE customers (\n  id INT PRIMARY KEY,\n  name VARCHAR(255),\n  email VARCHAR(255)\n);\n\nCREATE TABLE orders (\n  id INT PRIMARY KEY,\n  customer_id INT,\n  total DECIMAL(10,2),\n  date DATETIME\n);\n\nCREATE TABLE order_items (\n  id INT PRIMARY KEY,\n  order_id INT,\n  product_id INT,\n  quantity INT\n);\n```\n\n**cart.php**\n```php\n<?php\nrequire_once 'database.php';\nrequire_once 'config.php';\n\n// Display cart contents\nfunction displayCart() {\n  global $db;\n  $query = \"SELECT * FROM cart WHERE customer_id = \".$_SESSION['customer']['id'].\"\";\n  $result = mysqli_query($db, $query);\n  while ($row = mysqli_fetch_assoc($result)) {\n    echo $row['product_name'] . ' x ' . $row['quantity'];\n  }\n}\n\n// Add item to cart\nfunction addCartItem($product_id, $quantity) {\n  global $db;\n  $query = \"INSERT INTO cart (customer_id, product_id, quantity) VALUES (\".$_SESSION['customer']['id'].\", $product_id, $quantity)\";\n  mysqli_query($db, $query);\n}\n\n// Remove item from cart\nfunction removeCartItem($cart_item_id) {\n  global $db;\n  $query = \"DELETE FROM cart WHERE id = $cart_item_id\";\n  mysqli_query($db, $query);\n}\n?>\n```\n\n**purchase.php**\n```php\n<?php\nrequire_once 'database.php';\nrequire_once 'config.php';\n\n// Process payment and update inventory\nfunction processPurchase() {\n  global $db;\n  \n  // Get customer ID from session\n  $customer_id = $_SESSION['customer']['id'];\n  \n  // Calculate total cost of order\n  $total_cost = 0;\n  $query = \"SELECT * FROM cart WHERE customer_id = $customer_id\";\n  $result = mysqli_query($db, $query);\n  while ($row = mysqli_fetch_assoc($result)) {\n    $total_cost += $row['product_price'] * $row['quantity'];\n  }\n  \n  // Create new order\n  $order_id = mysqli_insert_id($db);\n  $query = \"INSERT INTO orders (customer_id, total) VALUES ($customer_id, $total_cost)\";\n  mysqli_query($db, $query);\n  \n  // Add order items\n  foreach ($result as $row) {\n    $product_id = $row['product_id'];\n    $quantity = $row['quantity'];\n    \n    $query = \"INSERT INTO order_items (order_id, product_id, quantity) VALUES ($order_id, $product_id, $quantity)\";\n    mysqli_query($db, $query);\n    \n    // Update inventory\n    $inventory_query = \"UPDATE products SET stock = stock - $quantity WHERE id = $product_id\";\n    mysqli_query($db, $inventory_query);\n  }\n  \n  // Clear cart\n  clearCart();\n}\n\n// Clear cart after purchase\nfunction clearCart() {\n  global $db;\n  $query = \"TRUNCATE TABLE cart\";\n  mysqli_query($db, $query);\n}\n?>\n```\n\n**config.php**\n```php\n<?php\ndefine('DB_HOST', 'localhost');\ndefine('DB_USER', 'your_username');\ndefine('DB_PASSWORD', 'your_password');\ndefine('DB_NAME', 'your_database_name');\n\n$_SESSION['customer'] = array(\n  'id' => $_POST['customer_id'],\n  'name' => $_POST['customer_name'],\n  'email' => $_POST['customer_email']\n);\n?>\n```\n\n**Example Usage:**\n\n1. Customer adds items to cart using `cart.php`.\n2. When customer submits purchase form, server processes payment and updates inventory using `purchase.php`.\n3. After successful payment, cart is cleared using `clearCart()` function.\n\nNote that this is a simplified example and does not include error handling or security measures such as encryption for sensitive data (e.g. credit card numbers). In a real-world application, you would want to add additional features like:\n\n* Validation of customer information\n* Secure payment processing\n* Handling failed payments\n* Notifying customers of successful transactions\n\nThis is just an example to demonstrate the basic flow of a purchase functionality in PHP. You should adapt and expand upon this example to suit your specific needs.", "code_blocks": [null, "```php\n<?php\nrequire_once 'database.php';\nrequire_once 'config.php';\n\n// Display cart contents\nfunction displayCart() {\n  global $db;\n  $query = \"SELECT * FROM cart WHERE customer_id = \".$_SESSION['customer']['id'].\"\";\n  $result = mysqli_query($db, $query);\n  while ($row = mysqli_fetch_assoc($result)) {\n    echo $row['product_name'] . ' x ' . $row['quantity'];\n  }\n}\n\n// Add item to cart\nfunction addCartItem($product_id, $quantity) {\n  global $db;\n  $query = \"INSERT INTO cart (customer_id, product_id, quantity) VALUES (\".$_SESSION['customer']['id'].\", $product_id, $quantity)\";\n  mysqli_query($db, $query);\n}\n\n// Remove item from cart\nfunction removeCartItem($cart_item_id) {\n  global $db;\n  $query = \"DELETE FROM cart WHERE id = $cart_item_id\";\n  mysqli_query($db, $query);\n}\n?>\n```", "```php\n<?php\nrequire_once 'database.php';\nrequire_once 'config.php';\n\n// Process payment and update inventory\nfunction processPurchase() {\n  global $db;\n  \n  // Get customer ID from session\n  $customer_id = $_SESSION['customer']['id'];\n  \n  // Calculate total cost of order\n  $total_cost = 0;\n  $query = \"SELECT * FROM cart WHERE customer_id = $customer_id\";\n  $result = mysqli_query($db, $query);\n  while ($row = mysqli_fetch_assoc($result)) {\n    $total_cost += $row['product_price'] * $row['quantity'];\n  }\n  \n  // Create new order\n  $order_id = mysqli_insert_id($db);\n  $query = \"INSERT INTO orders (customer_id, total) VALUES ($customer_id, $total_cost)\";\n  mysqli_query($db, $query);\n  \n  // Add order items\n  foreach ($result as $row) {\n    $product_id = $row['product_id'];\n    $quantity = $row['quantity'];\n    \n    $query = \"INSERT INTO order_items (order_id, product_id, quantity) VALUES ($order_id, $product_id, $quantity)\";\n    mysqli_query($db, $query);\n    \n    // Update inventory\n    $inventory_query = \"UPDATE products SET stock = stock - $quantity WHERE id = $product_id\";\n    mysqli_query($db, $inventory_query);\n  }\n  \n  // Clear cart\n  clearCart();\n}\n\n// Clear cart after purchase\nfunction clearCart() {\n  global $db;\n  $query = \"TRUNCATE TABLE cart\";\n  mysqli_query($db, $query);\n}\n?>\n```", "```php\n<?php\ndefine('DB_HOST', 'localhost');\ndefine('DB_USER', 'your_username');\ndefine('DB_PASSWORD', 'your_password');\ndefine('DB_NAME', 'your_database_name');\n\n$_SESSION['customer'] = array(\n  'id' => $_POST['customer_id'],\n  'name' => $_POST['customer_name'],\n  'email' => $_POST['customer_email']\n);\n?>\n```"]}
