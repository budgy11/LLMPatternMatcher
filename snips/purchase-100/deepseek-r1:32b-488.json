{"prompt": "Create a purchase functionality using php", "llm_output": "<think>\nOkay, so the user wants to create a purchase functionality using PHP. I need to figure out how to approach this.\n\nFirst, I should outline what purchasing typically involves. Usually, you have items in a catalog, users add them to a cart, and then they checkout by providing payment details.\n\nI'll start by creating a database for the backend. The database needs tables for users, products, orders, and order items. Users will store customer info, products will hold item details, orders will track each purchase, and order items will link products with their quantities in an order.\n\nNext, I'll need PHP scripts to handle different parts of the process. Let me break it down:\n\n1. **Displaying Products**: A catalog page where users can see available items. I'll fetch product data from the database and display it with add-to-cart buttons.\n\n2. **Adding to Cart**: Since this is a basic example without sessions, maybe I can handle the cart using GET parameters or store it in cookies. But for simplicity, perhaps I'll just simulate adding items by capturing product IDs and quantities.\n\n3. **Checkout Page**: Here, users will enter their payment details. I'll need form fields for name, card number, etc., and validate them on submission.\n\n4. **Processing the Purchase**: After validating input, I'll insert an order into the orders table with the user's info and the purchase date. Then, loop through each item in the cart to create records in the order_items table.\n\n5. **Order Confirmation**: Once everything is processed, display a thank you message with the order details.\n\nI should also consider security aspects like SQL injection, so using prepared statements would be good. Also, form validation on both client and server sides is important to ensure data integrity.\n\nWait, I realize that without sessions, managing the cart might be tricky. Maybe for this example, I can assume that the user has selected items beforehand or use a simplified approach where the cart is passed via POST or stored in cookies.\n\nI'll structure the code with separate pages: index.php for the catalog, checkout.php for payment details, and purchase_complete.php for confirmation. Each will handle its part of the process.\n\nTesting each step is crucial. I'll make sure that when a user adds items and proceeds to checkout, all data is correctly captured and inserted into the database. Also, handling errors gracefully, like if the database insertion fails, is important.\n\nI should also think about how users log in or register. For simplicity, maybe I can include a registration form on the checkout page so new users can sign up during purchase.\n\nFinally, I'll provide instructions on setting up the database and running the application, including any necessary configurations for the database connection.\n</think>\n\nCreating a purchase functionality involves several steps, including displaying products, managing a shopping cart, processing payments, and confirming purchases. Below is an example implementation using PHP and MySQL:\n\n### Step 1: Create a Database\n\nFirst, create a database to store products, users, and orders.\n\n```sql\nCREATE DATABASE e_commerce;\n\nUSE e_commerce;\n\n-- Table for storing products\nCREATE TABLE products (\n    id INT AUTO_INCREMENT PRIMARY KEY,\n    name VARCHAR(255),\n    price DECIMAL(10, 2),\n    description TEXT\n);\n\n-- Table for storing users\nCREATE TABLE users (\n    id INT AUTO_INCREMENT PRIMARY KEY,\n    username VARCHAR(255),\n    email VARCHAR(255),\n    password_hash VARCHAR(255)\n);\n\n-- Table for storing orders\nCREATE TABLE orders (\n    id INT AUTO_INCREMENT PRIMARY KEY,\n    user_id INT,\n    total_amount DECIMAL(10, 2),\n    purchase_date DATETIME,\n    FOREIGN KEY (user_id) REFERENCES users(id)\n);\n\n-- Table for storing order items\nCREATE TABLE order_items (\n    id INT AUTO_INCREMENT PRIMARY KEY,\n    order_id INT,\n    product_id INT,\n    quantity INT,\n    price_at_purchase DECIMAL(10, 2),\n    FOREIGN KEY (order_id) REFERENCES orders(id),\n    FOREIGN KEY (product_id) REFERENCES products(id)\n);\n```\n\n### Step 2: Display Products\n\nCreate a page to display available products.\n\n```php\n<?php\n// Connect to the database\n$connection = new mysqli(\"localhost\", \"root\", \"\", \"e_commerce\");\n\nif ($connection->connect_error) {\n    die(\"Connection failed: \" . $connection->connect_error);\n}\n\n// Retrieve products from the database\n$sql = \"SELECT * FROM products\";\n$result = $connection->query($sql);\n\n// Display products\necho \"<h1>Product Catalog</h1>\";\nif ($result->num_rows > 0) {\n    while ($row = $result->fetch_assoc()) {\n        echo \"<div class='product'>\";\n        echo \"<h2>\" . $row[\"name\"] . \"</h2>\";\n        echo \"<p>Price: $\" . number_format($row[\"price\"], 2) . \"</p>\";\n        echo \"<p>Description: \" . $row[\"description\"] . \"</p>\";\n        echo \"<form action='add_to_cart.php' method='post'>\";\n        echo \"<input type='hidden' name='product_id' value='\" . $row[\"id\"] . \"'>\";\n        echo \"<input type='number' name='quantity' min='1' max='99' value='1'>\";\n        echo \"<button type='submit'>Add to Cart</button>\";\n        echo \"</form>\";\n        echo \"</div>\";\n    }\n} else {\n    echo \"No products available.\";\n}\n$connection->close();\n?>\n```\n\n### Step 3: Add Products to Cart\n\nCreate a script to handle adding products to the cart.\n\n```php\n<?php\nsession_start();\n\nif (!isset($_SESSION['cart'])) {\n    $_SESSION['cart'] = array();\n}\n\n$product_id = intval($_POST['product_id']);\n$quantity = intval($_POST['quantity']);\n\n$_SESSION['cart'][$product_id] = $quantity;\n\nheader(\"Location: cart.php\");\nexit();\n?>\n```\n\n### Step 4: Display Cart\n\nCreate a page to display the contents of the shopping cart.\n\n```php\n<?php\nsession_start();\n\nif (!isset($_SESSION['cart']) || count($_SESSION['cart']) == 0) {\n    echo \"Your cart is empty.\";\n    exit();\n}\n\n// Connect to the database\n$connection = new mysqli(\"localhost\", \"root\", \"\", \"e_commerce\");\n\nif ($connection->connect_error) {\n    die(\"Connection failed: \" . $connection->connect_error);\n}\n\n$total = 0;\n\necho \"<h1>Shopping Cart</h1>\";\necho \"<form action='checkout.php' method='post'>\";\nforeach ($_SESSION['cart'] as $product_id => $quantity) {\n    $sql = \"SELECT * FROM products WHERE id = ?\";\n    $stmt = $connection->prepare($sql);\n    $stmt->bind_param(\"i\", $product_id);\n    $stmt->execute();\n    $result = $stmt->get_result();\n\n    if ($row = $result->fetch_assoc()) {\n        $subtotal = $row['price'] * $quantity;\n        $total += $subtotal;\n\n        echo \"<div class='cart-item'>\";\n        echo \"<h3>\" . $row[\"name\"] . \"</h3>\";\n        echo \"<p>Quantity: \" . $quantity . \"</p>\";\n        echo \"<p>Price: $\" . number_format($row['price'], 2) . \"</p>\";\n        echo \"<p>Subtotal: $\" . number_format($subtotal, 2) . \"</p>\";\n        echo \"</div>\";\n    }\n}\n\necho \"<h3>Total: $\" . number_format($total, 2) . \"</h3>\";\necho \"<button type='submit'>Checkout</button>\";\necho \"</form>\";\n\n$connection->close();\n?>\n```\n\n### Step 5: Checkout Page\n\nCreate a checkout page for users to enter their payment details.\n\n```php\n<?php\nsession_start();\n\nif (!isset($_SESSION['cart']) || count($_SESSION['cart']) == 0) {\n    header(\"Location: index.php\");\n    exit();\n}\n\n// Connect to the database\n$connection = new mysqli(\"localhost\", \"root\", \"\", \"e_commerce\");\n\nif ($connection->connect_error) {\n    die(\"Connection failed: \" . $connection->connect_error);\n}\n\n// Check if user is logged in\nif (!isset($_SESSION['user_id'])) {\n    // If not logged in, redirect to login page or show registration form\n    echo \"<h1>Please Log In</h1>\";\n    echo \"<form action='login.php' method='post'>\";\n    echo \"<input type='text' name='username' placeholder='Username'>\";\n    echo \"<input type='password' name='password' placeholder='Password'>\";\n    echo \"<button type='submit'>Login</button>\";\n    echo \"</form>\";\n    echo \"<p>Don't have an account? <a href='register.php'>Register here</a>.</p>\";\n} else {\n    // If logged in, display checkout form\n    $user_id = $_SESSION['user_id'];\n    $sql = \"SELECT * FROM users WHERE id = ?\";\n    $stmt = $connection->prepare($sql);\n    $stmt->bind_param(\"i\", $user_id);\n    $stmt->execute();\n    $result = $stmt->get_result();\n\n    if ($row = $result->fetch_assoc()) {\n        echo \"<h1>Checkout</h1>\";\n        echo \"<form action='process_purchase.php' method='post'>\";\n        echo \"<div class='checkout-info'>\";\n        echo \"<h2>Payment Details</h2>\";\n        echo \"<input type='text' name='card_name' placeholder='Name on Card'>\";\n        echo \"<input type='text' name='card_number' placeholder='Card Number'>\";\n        echo \"<input type='text' name='expiration_date' placeholder='Expiration Date'>\";\n        echo \"<input type='text' name='cvv' placeholder='CVV'>\";\n        echo \"</div>\";\n        echo \"<button type='submit'>Complete Purchase</button>\";\n        echo \"</form>\";\n    }\n}\n\n$connection->close();\n?>\n```\n\n### Step 6: Process Purchase\n\nCreate a script to process the purchase and store it in the database.\n\n```php\n<?php\nsession_start();\n\n// Check if user is logged in\nif (!isset($_SESSION['user_id']) || !isset($_SESSION['cart'])) {\n    header(\"Location: index.php\");\n    exit();\n}\n\n$user_id = $_SESSION['user_id'];\n$cart = $_SESSION['cart'];\n\n// Connect to the database\n$connection = new mysqli(\"localhost\", \"root\", \"\", \"e_commerce\");\n\nif ($connection->connect_error) {\n    die(\"Connection failed: \" . $connection->connect_error);\n}\n\n// Calculate total amount\n$total_amount = 0;\n\nforeach ($cart as $product_id => $quantity) {\n    $sql = \"SELECT price FROM products WHERE id = ?\";\n    $stmt = $connection->prepare($sql);\n    $stmt->bind_param(\"i\", $product_id);\n    $stmt->execute();\n    $result = $stmt->get_result();\n\n    if ($row = $result->fetch_assoc()) {\n        $total_amount += $row['price'] * $quantity;\n    }\n}\n\n// Insert order into orders table\n$current_date = date('Y-m-d H:i:s');\n$sql = \"INSERT INTO orders (user_id, total_amount, purchase_date) VALUES (?, ?, ?)\";\n$stmt = $connection->prepare($sql);\n$stmt->bind_param(\"ids\", $user_id, $total_amount, $current_date);\n\nif ($stmt->execute()) {\n    $order_id = $connection->insert_id;\n\n    // Insert order items into order_items table\n    foreach ($cart as $product_id => $quantity) {\n        $sql = \"SELECT price FROM products WHERE id = ?\";\n        $stmt_price = $connection->prepare($sql);\n        $stmt_price->bind_param(\"i\", $product_id);\n        $stmt_price->execute();\n        $result_price = $stmt_price->get_result();\n\n        if ($row_price = $result_price->fetch_assoc()) {\n            $price_at_purchase = $row_price['price'];\n            $sql_item = \"INSERT INTO order_items (order_id, product_id, quantity, price_at_purchase) VALUES (?, ?, ?, ?)\";\n            $stmt_item = $connection->prepare($sql_item);\n            $stmt_item->bind_param(\"iiid\", $order_id, $product_id, $quantity, $price_at_purchase);\n            $stmt_item->execute();\n        }\n    }\n\n    // Clear the cart\n    unset($_SESSION['cart']);\n    \n    // Redirect to purchase confirmation page\n    header(\"Location: purchase_complete.php?order_id=$order_id\");\n    exit();\n} else {\n    echo \"Error processing your order. Please try again.\";\n}\n\n$connection->close();\n?>\n```\n\n### Step 7: Purchase Confirmation\n\nCreate a page to confirm the purchase.\n\n```php\n<?php\n// Connect to the database\n$connection = new mysqli(\"localhost\", \"root\", \"\", \"e_commerce\");\n\nif ($connection->connect_error) {\n    die(\"Connection failed: \" . $connection->connect_error);\n}\n\n$order_id = isset($_GET['order_id']) ? intval($_GET['order_id']) : 0;\n\n$sql = \"SELECT o.*, u.username FROM orders o JOIN users u ON o.user_id = u.id WHERE o.id = ?\";\n$stmt = $connection->prepare($sql);\n$stmt->bind_param(\"i\", $order_id);\n$stmt->execute();\n$result = $stmt->get_result();\n\nif ($row = $result->fetch_assoc()) {\n    echo \"<h1>Thank you for your purchase!</h1>\";\n    echo \"<p>Your order has been successfully processed.</p>\";\n    echo \"<p>Order ID: \" . $row['id'] . \"</p>\";\n    echo \"<p>Username: \" . $row['username'] . \"</p>\";\n    echo \"<p>Total Amount: $\" . number_format($row['total_amount'], 2) . \"</p>\";\n    echo \"<p>Purchase Date: \" . $row['purchase_date'] . \"</p>\";\n} else {\n    echo \"Order not found.\";\n}\n\n$connection->close();\n?>\n```\n\n### Step 8: User Registration and Login\n\nYou'll need to create additional pages for user registration and login. Here's a simple example:\n\n**register.php**\n```php\n<?php\nsession_start();\n\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n    $username = $_POST['username'];\n    $email = $_POST['email'];\n    $password = password_hash($_POST['password'], PASSWORD_DEFAULT);\n\n    // Connect to the database\n    $connection = new mysqli(\"localhost\", \"root\", \"\", \"e_commerce\");\n\n    if ($connection->connect_error) {\n        die(\"Connection failed: \" . $connection->connect_error);\n    }\n\n    $sql = \"INSERT INTO users (username, email, password_hash) VALUES (?, ?, ?)\";\n    $stmt = $connection->prepare($sql);\n    $stmt->bind_param(\"sss\", $username, $email, $password);\n\n    if ($stmt->execute()) {\n        $_SESSION['user_id'] = $connection->insert_id;\n        header(\"Location: index.php\");\n        exit();\n    } else {\n        echo \"Error registering user. Please try again.\";\n    }\n\n    $connection->close();\n}\n\necho \"<h1>Register</h1>\";\necho \"<form action='register.php' method='post'>\";\necho \"<input type='text' name='username' placeholder='Username'>\";\necho \"<input type='email' name='email' placeholder='Email'>\";\necho \"<input type='password' name='password' placeholder='Password'>\";\necho \"<button type='submit'>Register</button>\";\necho \"</form>\";\n?>\n```\n\n**login.php**\n```php\n<?php\nsession_start();\n\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n    $username = $_POST['username'];\n    $password = $_POST['password'];\n\n    // Connect to the database\n    $connection = new mysqli(\"localhost\", \"root\", \"\", \"e_commerce\");\n\n    if ($connection->connect_error) {\n        die(\"Connection failed: \" . $connection->connect_error);\n    }\n\n    $sql = \"SELECT * FROM users WHERE username = ?\";\n    $stmt = $connection->prepare($sql);\n    $stmt->bind_param(\"s\", $username);\n    $stmt->execute();\n    $result = $stmt->get_result();\n\n    if ($row = $result->fetch_assoc()) {\n        if (password_verify($password, $row['password_hash'])) {\n            $_SESSION['user_id'] = $row['id'];\n            header(\"Location: index.php\");\n            exit();\n        } else {\n            echo \"Invalid password.\";\n        }\n    } else {\n        echo \"Username not found.\";\n    }\n\n    $connection->close();\n}\n\necho \"<h1>Login</h1>\";\necho \"<form action='login.php' method='post'>\";\necho \"<input type='text' name='username' placeholder='Username'>\";\necho \"<input type='password' name='password' placeholder='Password'>\";\necho \"<button type='submit'>Login</button>\";\necho \"</form>\";\n?>\n```\n\n### Step 9: Logout\n\nCreate a logout script.\n\n**logout.php**\n```php\n<?php\nsession_start();\nunset($_SESSION['user_id']);\nsession_unset();\nsession_destroy();\nheader(\"Location: index.php\");\nexit();\n?>\n```\n\n### Conclusion\n\nThis is a basic implementation of a purchase functionality using PHP and MySQL. You can enhance it by adding features such as:\n\n- Product categories\n- User reviews and ratings\n- Shipping options\n- Payment gateways (e.g., PayPal, Stripe)\n- Order tracking\n- Return policy\n- Customer support\n- Admin panel for managing products and orders\n\nRemember to secure your application by:\n- Using HTTPS\n- Sanitizing user input\n- Encrypting sensitive data\n- Implementing CSRF protection\n- Regularly backing up your database", "code_blocks": [null, "```php\n<?php\n// Connect to the database\n$connection = new mysqli(\"localhost\", \"root\", \"\", \"e_commerce\");\n\nif ($connection->connect_error) {\n    die(\"Connection failed: \" . $connection->connect_error);\n}\n\n// Retrieve products from the database\n$sql = \"SELECT * FROM products\";\n$result = $connection->query($sql);\n\n// Display products\necho \"<h1>Product Catalog</h1>\";\nif ($result->num_rows > 0) {\n    while ($row = $result->fetch_assoc()) {\n        echo \"<div class='product'>\";\n        echo \"<h2>\" . $row[\"name\"] . \"</h2>\";\n        echo \"<p>Price: $\" . number_format($row[\"price\"], 2) . \"</p>\";\n        echo \"<p>Description: \" . $row[\"description\"] . \"</p>\";\n        echo \"<form action='add_to_cart.php' method='post'>\";\n        echo \"<input type='hidden' name='product_id' value='\" . $row[\"id\"] . \"'>\";\n        echo \"<input type='number' name='quantity' min='1' max='99' value='1'>\";\n        echo \"<button type='submit'>Add to Cart</button>\";\n        echo \"</form>\";\n        echo \"</div>\";\n    }\n} else {\n    echo \"No products available.\";\n}\n$connection->close();\n?>\n```", "```php\n<?php\nsession_start();\n\nif (!isset($_SESSION['cart'])) {\n    $_SESSION['cart'] = array();\n}\n\n$product_id = intval($_POST['product_id']);\n$quantity = intval($_POST['quantity']);\n\n$_SESSION['cart'][$product_id] = $quantity;\n\nheader(\"Location: cart.php\");\nexit();\n?>\n```", "```php\n<?php\nsession_start();\n\nif (!isset($_SESSION['cart']) || count($_SESSION['cart']) == 0) {\n    echo \"Your cart is empty.\";\n    exit();\n}\n\n// Connect to the database\n$connection = new mysqli(\"localhost\", \"root\", \"\", \"e_commerce\");\n\nif ($connection->connect_error) {\n    die(\"Connection failed: \" . $connection->connect_error);\n}\n\n$total = 0;\n\necho \"<h1>Shopping Cart</h1>\";\necho \"<form action='checkout.php' method='post'>\";\nforeach ($_SESSION['cart'] as $product_id => $quantity) {\n    $sql = \"SELECT * FROM products WHERE id = ?\";\n    $stmt = $connection->prepare($sql);\n    $stmt->bind_param(\"i\", $product_id);\n    $stmt->execute();\n    $result = $stmt->get_result();\n\n    if ($row = $result->fetch_assoc()) {\n        $subtotal = $row['price'] * $quantity;\n        $total += $subtotal;\n\n        echo \"<div class='cart-item'>\";\n        echo \"<h3>\" . $row[\"name\"] . \"</h3>\";\n        echo \"<p>Quantity: \" . $quantity . \"</p>\";\n        echo \"<p>Price: $\" . number_format($row['price'], 2) . \"</p>\";\n        echo \"<p>Subtotal: $\" . number_format($subtotal, 2) . \"</p>\";\n        echo \"</div>\";\n    }\n}\n\necho \"<h3>Total: $\" . number_format($total, 2) . \"</h3>\";\necho \"<button type='submit'>Checkout</button>\";\necho \"</form>\";\n\n$connection->close();\n?>\n```", "```php\n<?php\nsession_start();\n\nif (!isset($_SESSION['cart']) || count($_SESSION['cart']) == 0) {\n    header(\"Location: index.php\");\n    exit();\n}\n\n// Connect to the database\n$connection = new mysqli(\"localhost\", \"root\", \"\", \"e_commerce\");\n\nif ($connection->connect_error) {\n    die(\"Connection failed: \" . $connection->connect_error);\n}\n\n// Check if user is logged in\nif (!isset($_SESSION['user_id'])) {\n    // If not logged in, redirect to login page or show registration form\n    echo \"<h1>Please Log In</h1>\";\n    echo \"<form action='login.php' method='post'>\";\n    echo \"<input type='text' name='username' placeholder='Username'>\";\n    echo \"<input type='password' name='password' placeholder='Password'>\";\n    echo \"<button type='submit'>Login</button>\";\n    echo \"</form>\";\n    echo \"<p>Don't have an account? <a href='register.php'>Register here</a>.</p>\";\n} else {\n    // If logged in, display checkout form\n    $user_id = $_SESSION['user_id'];\n    $sql = \"SELECT * FROM users WHERE id = ?\";\n    $stmt = $connection->prepare($sql);\n    $stmt->bind_param(\"i\", $user_id);\n    $stmt->execute();\n    $result = $stmt->get_result();\n\n    if ($row = $result->fetch_assoc()) {\n        echo \"<h1>Checkout</h1>\";\n        echo \"<form action='process_purchase.php' method='post'>\";\n        echo \"<div class='checkout-info'>\";\n        echo \"<h2>Payment Details</h2>\";\n        echo \"<input type='text' name='card_name' placeholder='Name on Card'>\";\n        echo \"<input type='text' name='card_number' placeholder='Card Number'>\";\n        echo \"<input type='text' name='expiration_date' placeholder='Expiration Date'>\";\n        echo \"<input type='text' name='cvv' placeholder='CVV'>\";\n        echo \"</div>\";\n        echo \"<button type='submit'>Complete Purchase</button>\";\n        echo \"</form>\";\n    }\n}\n\n$connection->close();\n?>\n```", "```php\n<?php\nsession_start();\n\n// Check if user is logged in\nif (!isset($_SESSION['user_id']) || !isset($_SESSION['cart'])) {\n    header(\"Location: index.php\");\n    exit();\n}\n\n$user_id = $_SESSION['user_id'];\n$cart = $_SESSION['cart'];\n\n// Connect to the database\n$connection = new mysqli(\"localhost\", \"root\", \"\", \"e_commerce\");\n\nif ($connection->connect_error) {\n    die(\"Connection failed: \" . $connection->connect_error);\n}\n\n// Calculate total amount\n$total_amount = 0;\n\nforeach ($cart as $product_id => $quantity) {\n    $sql = \"SELECT price FROM products WHERE id = ?\";\n    $stmt = $connection->prepare($sql);\n    $stmt->bind_param(\"i\", $product_id);\n    $stmt->execute();\n    $result = $stmt->get_result();\n\n    if ($row = $result->fetch_assoc()) {\n        $total_amount += $row['price'] * $quantity;\n    }\n}\n\n// Insert order into orders table\n$current_date = date('Y-m-d H:i:s');\n$sql = \"INSERT INTO orders (user_id, total_amount, purchase_date) VALUES (?, ?, ?)\";\n$stmt = $connection->prepare($sql);\n$stmt->bind_param(\"ids\", $user_id, $total_amount, $current_date);\n\nif ($stmt->execute()) {\n    $order_id = $connection->insert_id;\n\n    // Insert order items into order_items table\n    foreach ($cart as $product_id => $quantity) {\n        $sql = \"SELECT price FROM products WHERE id = ?\";\n        $stmt_price = $connection->prepare($sql);\n        $stmt_price->bind_param(\"i\", $product_id);\n        $stmt_price->execute();\n        $result_price = $stmt_price->get_result();\n\n        if ($row_price = $result_price->fetch_assoc()) {\n            $price_at_purchase = $row_price['price'];\n            $sql_item = \"INSERT INTO order_items (order_id, product_id, quantity, price_at_purchase) VALUES (?, ?, ?, ?)\";\n            $stmt_item = $connection->prepare($sql_item);\n            $stmt_item->bind_param(\"iiid\", $order_id, $product_id, $quantity, $price_at_purchase);\n            $stmt_item->execute();\n        }\n    }\n\n    // Clear the cart\n    unset($_SESSION['cart']);\n    \n    // Redirect to purchase confirmation page\n    header(\"Location: purchase_complete.php?order_id=$order_id\");\n    exit();\n} else {\n    echo \"Error processing your order. Please try again.\";\n}\n\n$connection->close();\n?>\n```", "```php\n<?php\n// Connect to the database\n$connection = new mysqli(\"localhost\", \"root\", \"\", \"e_commerce\");\n\nif ($connection->connect_error) {\n    die(\"Connection failed: \" . $connection->connect_error);\n}\n\n$order_id = isset($_GET['order_id']) ? intval($_GET['order_id']) : 0;\n\n$sql = \"SELECT o.*, u.username FROM orders o JOIN users u ON o.user_id = u.id WHERE o.id = ?\";\n$stmt = $connection->prepare($sql);\n$stmt->bind_param(\"i\", $order_id);\n$stmt->execute();\n$result = $stmt->get_result();\n\nif ($row = $result->fetch_assoc()) {\n    echo \"<h1>Thank you for your purchase!</h1>\";\n    echo \"<p>Your order has been successfully processed.</p>\";\n    echo \"<p>Order ID: \" . $row['id'] . \"</p>\";\n    echo \"<p>Username: \" . $row['username'] . \"</p>\";\n    echo \"<p>Total Amount: $\" . number_format($row['total_amount'], 2) . \"</p>\";\n    echo \"<p>Purchase Date: \" . $row['purchase_date'] . \"</p>\";\n} else {\n    echo \"Order not found.\";\n}\n\n$connection->close();\n?>\n```", "```php\n<?php\nsession_start();\n\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n    $username = $_POST['username'];\n    $email = $_POST['email'];\n    $password = password_hash($_POST['password'], PASSWORD_DEFAULT);\n\n    // Connect to the database\n    $connection = new mysqli(\"localhost\", \"root\", \"\", \"e_commerce\");\n\n    if ($connection->connect_error) {\n        die(\"Connection failed: \" . $connection->connect_error);\n    }\n\n    $sql = \"INSERT INTO users (username, email, password_hash) VALUES (?, ?, ?)\";\n    $stmt = $connection->prepare($sql);\n    $stmt->bind_param(\"sss\", $username, $email, $password);\n\n    if ($stmt->execute()) {\n        $_SESSION['user_id'] = $connection->insert_id;\n        header(\"Location: index.php\");\n        exit();\n    } else {\n        echo \"Error registering user. Please try again.\";\n    }\n\n    $connection->close();\n}\n\necho \"<h1>Register</h1>\";\necho \"<form action='register.php' method='post'>\";\necho \"<input type='text' name='username' placeholder='Username'>\";\necho \"<input type='email' name='email' placeholder='Email'>\";\necho \"<input type='password' name='password' placeholder='Password'>\";\necho \"<button type='submit'>Register</button>\";\necho \"</form>\";\n?>\n```", "```php\n<?php\nsession_start();\n\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n    $username = $_POST['username'];\n    $password = $_POST['password'];\n\n    // Connect to the database\n    $connection = new mysqli(\"localhost\", \"root\", \"\", \"e_commerce\");\n\n    if ($connection->connect_error) {\n        die(\"Connection failed: \" . $connection->connect_error);\n    }\n\n    $sql = \"SELECT * FROM users WHERE username = ?\";\n    $stmt = $connection->prepare($sql);\n    $stmt->bind_param(\"s\", $username);\n    $stmt->execute();\n    $result = $stmt->get_result();\n\n    if ($row = $result->fetch_assoc()) {\n        if (password_verify($password, $row['password_hash'])) {\n            $_SESSION['user_id'] = $row['id'];\n            header(\"Location: index.php\");\n            exit();\n        } else {\n            echo \"Invalid password.\";\n        }\n    } else {\n        echo \"Username not found.\";\n    }\n\n    $connection->close();\n}\n\necho \"<h1>Login</h1>\";\necho \"<form action='login.php' method='post'>\";\necho \"<input type='text' name='username' placeholder='Username'>\";\necho \"<input type='password' name='password' placeholder='Password'>\";\necho \"<button type='submit'>Login</button>\";\necho \"</form>\";\n?>\n```", "```php\n<?php\nsession_start();\nunset($_SESSION['user_id']);\nsession_unset();\nsession_destroy();\nheader(\"Location: index.php\");\nexit();\n?>\n```"]}
