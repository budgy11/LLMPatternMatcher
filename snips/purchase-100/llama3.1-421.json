{"prompt": "Create a purchase functionality using php", "llm_output": "**Purchase Functionality in PHP**\n====================================\n\nThis is an example of how to create a basic purchase functionality using PHP. This code assumes you have a database set up with the necessary tables for users and products.\n\n**Database Schema**\n-------------------\n\n```sql\nCREATE TABLE users (\n  id INT PRIMARY KEY,\n  name VARCHAR(255),\n  email VARCHAR(255)\n);\n\nCREATE TABLE products (\n  id INT PRIMARY KEY,\n  name VARCHAR(255),\n  price DECIMAL(10,2)\n);\n```\n\n**PHP Code**\n------------\n\n### **purchase.php**\n```php\n<?php\n\n// Include database connection settings\nrequire_once 'dbconfig.php';\n\n// Check if user is logged in\nif (!isset($_SESSION['user_id'])) {\n    header('Location: login.php');\n    exit;\n}\n\n// Get product ID from URL parameter\n$product_id = $_GET['product_id'];\n\n// Retrieve product details\n$query = \"SELECT * FROM products WHERE id = $product_id\";\n$result = mysqli_query($conn, $query);\n$product = mysqli_fetch_assoc($result);\n\n// Check if product exists\nif (!$product) {\n    echo 'Product not found!';\n    exit;\n}\n\n// Update user's order history\n$query = \"INSERT INTO orders (user_id, product_id, price, created_at)\n          VALUES ('\" . $_SESSION['user_id'] . \"', '$product_id', '\" . $product['price'] . \"', NOW())\";\nmysqli_query($conn, $query);\n\n// Update product quantity\n$query = \"UPDATE products SET quantity = quantity - 1 WHERE id = $product_id\";\nmysqli_query($conn, $query);\n\n// Display success message and redirect to cart\necho 'Product purchased successfully!';\nheader('Location: cart.php');\nexit;\n\n?>\n```\n\n### **cart.php**\n```php\n<?php\n\n// Include database connection settings\nrequire_once 'dbconfig.php';\n\n// Get user's orders\n$query = \"SELECT * FROM orders WHERE user_id = '\" . $_SESSION['user_id'] . \"'\";\n$result = mysqli_query($conn, $query);\n$orders = mysqli_fetch_all($result);\n\n?>\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Cart</title>\n</head>\n<body>\n    <?php foreach ($orders as $order) : ?>\n        <p><?= $order['product_name'] ?> x <?= $order['quantity'] ?></p>\n    <?php endforeach; ?>\n</body>\n</html>\n```\n\n### **dbconfig.php**\n```php\n<?php\n\n// Database connection settings\n$conn = mysqli_connect('localhost', 'username', 'password', 'database');\n\n?>\n```\n\n**How it works**\n\n1. The user is redirected to the `purchase.php` page with a product ID as a URL parameter.\n2. The script checks if the user is logged in and retrieves the product details from the database.\n3. If the product exists, the script updates the user's order history by inserting a new record into the `orders` table.\n4. It also updates the product quantity in the `products` table by decrementing it by 1.\n5. Finally, the script displays a success message and redirects the user to the cart page.\n\nNote: This is a basic example and you should adapt it to your specific needs. Also, make sure to secure your database connection settings and handle potential errors properly.", "code_blocks": [null, "```php\n<?php\n\n// Include database connection settings\nrequire_once 'dbconfig.php';\n\n// Check if user is logged in\nif (!isset($_SESSION['user_id'])) {\n    header('Location: login.php');\n    exit;\n}\n\n// Get product ID from URL parameter\n$product_id = $_GET['product_id'];\n\n// Retrieve product details\n$query = \"SELECT * FROM products WHERE id = $product_id\";\n$result = mysqli_query($conn, $query);\n$product = mysqli_fetch_assoc($result);\n\n// Check if product exists\nif (!$product) {\n    echo 'Product not found!';\n    exit;\n}\n\n// Update user's order history\n$query = \"INSERT INTO orders (user_id, product_id, price, created_at)\n          VALUES ('\" . $_SESSION['user_id'] . \"', '$product_id', '\" . $product['price'] . \"', NOW())\";\nmysqli_query($conn, $query);\n\n// Update product quantity\n$query = \"UPDATE products SET quantity = quantity - 1 WHERE id = $product_id\";\nmysqli_query($conn, $query);\n\n// Display success message and redirect to cart\necho 'Product purchased successfully!';\nheader('Location: cart.php');\nexit;\n\n?>\n```", "```php\n<?php\n\n// Include database connection settings\nrequire_once 'dbconfig.php';\n\n// Get user's orders\n$query = \"SELECT * FROM orders WHERE user_id = '\" . $_SESSION['user_id'] . \"'\";\n$result = mysqli_query($conn, $query);\n$orders = mysqli_fetch_all($result);\n\n?>\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Cart</title>\n</head>\n<body>\n    <?php foreach ($orders as $order) : ?>\n        <p><?= $order['product_name'] ?> x <?= $order['quantity'] ?></p>\n    <?php endforeach; ?>\n</body>\n</html>\n```", "```php\n<?php\n\n// Database connection settings\n$conn = mysqli_connect('localhost', 'username', 'password', 'database');\n\n?>\n```"]}
