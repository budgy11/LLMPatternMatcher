{"prompt": "Create a purchase functionality using php", "llm_output": "Here's an example of a basic purchase functionality using PHP. This example assumes that you have a database set up with the necessary tables to store orders and products.\n\n**Database Schema**\n\nFirst, let's define the schema for our database:\n\n```sql\nCREATE TABLE users (\n    id INT PRIMARY KEY,\n    name VARCHAR(255),\n    email VARCHAR(255)\n);\n\nCREATE TABLE products (\n    id INT PRIMARY KEY,\n    name VARCHAR(255),\n    price DECIMAL(10,2)\n);\n\nCREATE TABLE orders (\n    id INT PRIMARY KEY,\n    user_id INT,\n    order_date DATE,\n    total DECIMAL(10,2),\n    FOREIGN KEY (user_id) REFERENCES users(id)\n);\n\nCREATE TABLE order_items (\n    id INT PRIMARY KEY,\n    order_id INT,\n    product_id INT,\n    quantity INT,\n    FOREIGN KEY (order_id) REFERENCES orders(id),\n    FOREIGN KEY (product_id) REFERENCES products(id)\n);\n```\n\n**PHP Code**\n\nNext, let's create the PHP code to handle purchases:\n\n```php\n// database connection settings\n$host = 'localhost';\n$dbname = 'shop';\n$username = 'root';\n$password = '';\n\n// connect to database\n$conn = new PDO(\"mysql:host=$host;dbname=$dbname\", $username, $password);\n\n// function to get products from database\nfunction get_products($conn) {\n    $stmt = $conn->prepare('SELECT * FROM products');\n    $stmt->execute();\n    return $stmt->fetchAll(PDO::FETCH_ASSOC);\n}\n\n// function to add product to cart\nfunction add_product_to_cart($conn, $product_id, $quantity) {\n    // check if user has an existing cart\n    $stmt = $conn->prepare('SELECT * FROM carts WHERE user_id = :user_id');\n    $stmt->bindParam(':user_id', $_SESSION['user_id']);\n    $stmt->execute();\n    $cart = $stmt->fetch(PDO::FETCH_ASSOC);\n\n    // add product to cart\n    if ($cart) {\n        $new_quantity = $cart['quantity'] + $quantity;\n        $stmt = $conn->prepare('UPDATE carts SET quantity = :quantity WHERE id = :id');\n        $stmt->bindParam(':quantity', $new_quantity);\n        $stmt->bindParam(':id', $cart['id']);\n        $stmt->execute();\n    } else {\n        // create new cart\n        $stmt = $conn->prepare('INSERT INTO carts (user_id, quantity) VALUES (:user_id, :quantity)');\n        $stmt->bindParam(':user_id', $_SESSION['user_id']);\n        $stmt->bindParam(':quantity', $quantity);\n        $stmt->execute();\n    }\n}\n\n// function to process purchase\nfunction process_purchase($conn) {\n    // check if user has a cart\n    $stmt = $conn->prepare('SELECT * FROM carts WHERE user_id = :user_id');\n    $stmt->bindParam(':user_id', $_SESSION['user_id']);\n    $stmt->execute();\n    $cart = $stmt->fetch(PDO::FETCH_ASSOC);\n\n    // process purchase\n    if ($cart) {\n        $order_date = date('Y-m-d');\n        $total = 0;\n        foreach (get_products($conn) as $product) {\n            $quantity = $cart['quantity'];\n            $total += $product['price'] * $quantity;\n        }\n        $stmt = $conn->prepare('INSERT INTO orders (user_id, order_date, total) VALUES (:user_id, :order_date, :total)');\n        $stmt->bindParam(':user_id', $_SESSION['user_id']);\n        $stmt->bindParam(':order_date', $order_date);\n        $stmt->bindParam(':total', $total);\n        $stmt->execute();\n\n        // create order items\n        foreach (get_products($conn) as $product) {\n            $quantity = $cart['quantity'];\n            $stmt = $conn->prepare('INSERT INTO order_items (order_id, product_id, quantity) VALUES (:order_id, :product_id, :quantity)');\n            $stmt->bindParam(':order_id', $conn->lastInsertId());\n            $stmt->bindParam(':product_id', $product['id']);\n            $stmt->bindParam(':quantity', $quantity);\n            $stmt->execute();\n        }\n\n        // update cart quantity to 0\n        $stmt = $conn->prepare('UPDATE carts SET quantity = :quantity WHERE id = :id');\n        $stmt->bindParam(':quantity', 0);\n        $stmt->bindParam(':id', $cart['id']);\n        $stmt->execute();\n\n        // clear session cart\n        unset($_SESSION['cart']);\n    }\n}\n\n// example usage\nif (isset($_POST['add_product'])) {\n    add_product_to_cart($conn, $_POST['product_id'], 1);\n} elseif (isset($_POST['process_purchase'])) {\n    process_purchase($conn);\n}\n```\n\n**HTML Form**\n\nFinally, let's create a basic HTML form to test the purchase functionality:\n\n```php\n<form action=\"\" method=\"post\">\n    <select name=\"product_id\" id=\"product_id\">\n        <?php foreach (get_products($conn) as $product): ?>\n            <option value=\"<?= $product['id'] ?>\"><?= $product['name'] ?></option>\n        <?php endforeach; ?>\n    </select>\n    <button type=\"submit\" name=\"add_product\">Add to Cart</button>\n</form>\n\n<form action=\"\" method=\"post\">\n    <button type=\"submit\" name=\"process_purchase\">Process Purchase</button>\n</form>\n```\n\nThis code assumes that you have already set up a session to store the user's cart. You can modify the code to fit your specific needs and database schema.\n\nPlease note that this is a basic example and you should add error checking, validation, and security measures as needed to protect against SQL injection and other potential vulnerabilities.", "code_blocks": [null, "```php\n// database connection settings\n$host = 'localhost';\n$dbname = 'shop';\n$username = 'root';\n$password = '';\n\n// connect to database\n$conn = new PDO(\"mysql:host=$host;dbname=$dbname\", $username, $password);\n\n// function to get products from database\nfunction get_products($conn) {\n    $stmt = $conn->prepare('SELECT * FROM products');\n    $stmt->execute();\n    return $stmt->fetchAll(PDO::FETCH_ASSOC);\n}\n\n// function to add product to cart\nfunction add_product_to_cart($conn, $product_id, $quantity) {\n    // check if user has an existing cart\n    $stmt = $conn->prepare('SELECT * FROM carts WHERE user_id = :user_id');\n    $stmt->bindParam(':user_id', $_SESSION['user_id']);\n    $stmt->execute();\n    $cart = $stmt->fetch(PDO::FETCH_ASSOC);\n\n    // add product to cart\n    if ($cart) {\n        $new_quantity = $cart['quantity'] + $quantity;\n        $stmt = $conn->prepare('UPDATE carts SET quantity = :quantity WHERE id = :id');\n        $stmt->bindParam(':quantity', $new_quantity);\n        $stmt->bindParam(':id', $cart['id']);\n        $stmt->execute();\n    } else {\n        // create new cart\n        $stmt = $conn->prepare('INSERT INTO carts (user_id, quantity) VALUES (:user_id, :quantity)');\n        $stmt->bindParam(':user_id', $_SESSION['user_id']);\n        $stmt->bindParam(':quantity', $quantity);\n        $stmt->execute();\n    }\n}\n\n// function to process purchase\nfunction process_purchase($conn) {\n    // check if user has a cart\n    $stmt = $conn->prepare('SELECT * FROM carts WHERE user_id = :user_id');\n    $stmt->bindParam(':user_id', $_SESSION['user_id']);\n    $stmt->execute();\n    $cart = $stmt->fetch(PDO::FETCH_ASSOC);\n\n    // process purchase\n    if ($cart) {\n        $order_date = date('Y-m-d');\n        $total = 0;\n        foreach (get_products($conn) as $product) {\n            $quantity = $cart['quantity'];\n            $total += $product['price'] * $quantity;\n        }\n        $stmt = $conn->prepare('INSERT INTO orders (user_id, order_date, total) VALUES (:user_id, :order_date, :total)');\n        $stmt->bindParam(':user_id', $_SESSION['user_id']);\n        $stmt->bindParam(':order_date', $order_date);\n        $stmt->bindParam(':total', $total);\n        $stmt->execute();\n\n        // create order items\n        foreach (get_products($conn) as $product) {\n            $quantity = $cart['quantity'];\n            $stmt = $conn->prepare('INSERT INTO order_items (order_id, product_id, quantity) VALUES (:order_id, :product_id, :quantity)');\n            $stmt->bindParam(':order_id', $conn->lastInsertId());\n            $stmt->bindParam(':product_id', $product['id']);\n            $stmt->bindParam(':quantity', $quantity);\n            $stmt->execute();\n        }\n\n        // update cart quantity to 0\n        $stmt = $conn->prepare('UPDATE carts SET quantity = :quantity WHERE id = :id');\n        $stmt->bindParam(':quantity', 0);\n        $stmt->bindParam(':id', $cart['id']);\n        $stmt->execute();\n\n        // clear session cart\n        unset($_SESSION['cart']);\n    }\n}\n\n// example usage\nif (isset($_POST['add_product'])) {\n    add_product_to_cart($conn, $_POST['product_id'], 1);\n} elseif (isset($_POST['process_purchase'])) {\n    process_purchase($conn);\n}\n```", "```php\n<form action=\"\" method=\"post\">\n    <select name=\"product_id\" id=\"product_id\">\n        <?php foreach (get_products($conn) as $product): ?>\n            <option value=\"<?= $product['id'] ?>\"><?= $product['name'] ?></option>\n        <?php endforeach; ?>\n    </select>\n    <button type=\"submit\" name=\"add_product\">Add to Cart</button>\n</form>\n\n<form action=\"\" method=\"post\">\n    <button type=\"submit\" name=\"process_purchase\">Process Purchase</button>\n</form>\n```"]}
