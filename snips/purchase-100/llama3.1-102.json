{"prompt": "Create a purchase functionality using php", "llm_output": "Here is an example of a simple purchase functionality using PHP, including user authentication and database interaction:\n\n**Database Structure**\n\nWe will use a MySQL database with the following structure:\n```sql\nCREATE TABLE users (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  username VARCHAR(255),\n  email VARCHAR(255)\n);\n\nCREATE TABLE products (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  name VARCHAR(255),\n  price DECIMAL(10,2)\n);\n\nCREATE TABLE orders (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  user_id INT,\n  order_date DATE,\n  total DECIMAL(10,2)\n);\n\nCREATE TABLE order_items (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  order_id INT,\n  product_id INT,\n  quantity INT\n);\n```\n**Authentication**\n\nFirst, we will create a simple authentication system using PHP's built-in `session` module:\n```php\n// auth.php\n\n<?php\nif (!isset($_SESSION['user_id'])) {\n  // redirect to login page if not logged in\n  header('Location: login.php');\n}\n\n// load user data from database\n$user = $_SESSION['user'];\n\nfunction authenticate($username, $password) {\n  global $db;\n  $query = \"SELECT * FROM users WHERE username = '$username'\";\n  $result = mysqli_query($db, $query);\n  if (mysqli_num_rows($result) == 1) {\n    // user exists, check password\n    $user_data = mysqli_fetch_assoc($result);\n    if ($password === $user_data['password']) {\n      return true;\n    }\n  }\n  return false;\n}\n\nfunction login($username, $password) {\n  global $db;\n  if (authenticate($username, $password)) {\n    // authenticate successful, set session variables\n    $_SESSION['user_id'] = $user_data['id'];\n    $_SESSION['username'] = $username;\n    header('Location: index.php');\n  } else {\n    echo \"Invalid username or password\";\n  }\n}\n\nfunction register($username, $email, $password) {\n  global $db;\n  // hash password before storing in database\n  $hashed_password = password_hash($password, PASSWORD_DEFAULT);\n  $query = \"INSERT INTO users (username, email, password) VALUES ('$username', '$email', '$hashed_password')\";\n  mysqli_query($db, $query);\n}\n```\n**Purchase Functionality**\n\nNext, we will create the purchase functionality:\n```php\n// cart.php\n\n<?php\nif (!isset($_SESSION['user_id'])) {\n  // redirect to login page if not logged in\n  header('Location: login.php');\n}\n\n// load product data from database\n$product_query = \"SELECT * FROM products\";\n$product_result = mysqli_query($db, $product_query);\n$product_list = array();\nwhile ($product_row = mysqli_fetch_assoc($product_result)) {\n  $product_list[] = $product_row;\n}\n\nfunction add_to_cart($product_id) {\n  global $cart;\n  // check if product is already in cart\n  foreach ($cart as &$item) {\n    if ($item['id'] == $product_id) {\n      // increment quantity\n      $item['quantity']++;\n      return true;\n    }\n  }\n  // add new item to cart\n  $new_item = array(\n    'id' => $product_id,\n    'name' => '',\n    'price' => '',\n    'quantity' => 1\n  );\n  $cart[] = $new_item;\n}\n\nfunction view_cart() {\n  global $cart;\n  // print out contents of cart\n  foreach ($cart as &$item) {\n    echo \"Product: {$item['name']} ({$item['price']}) x {$item['quantity']}<br>\";\n  }\n}\n\n// add items to cart based on form submission\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n  // check if user has submitted a product ID\n  $product_id = $_POST['product_id'];\n  add_to_cart($product_id);\n}\n```\n**Checkout Functionality**\n\nFinally, we will create the checkout functionality:\n```php\n// checkout.php\n\n<?php\nif (!isset($_SESSION['user_id'])) {\n  // redirect to login page if not logged in\n  header('Location: login.php');\n}\n\n// load cart contents and calculate total\n$cart_query = \"SELECT * FROM products WHERE id IN (\".implode(',', array_column($cart, 'id')).\")\";\n$cart_result = mysqli_query($db, $cart_query);\n$cart_list = array();\nwhile ($row = mysqli_fetch_assoc($cart_result)) {\n  foreach ($cart as &$item) {\n    if ($item['id'] == $row['id']) {\n      $item['name'] = $row['name'];\n      $item['price'] = $row['price'];\n    }\n  }\n}\n\nfunction calculate_total() {\n  global $cart;\n  // calculate total cost\n  $total = 0;\n  foreach ($cart as &$item) {\n    $total += $item['price'] * $item['quantity'];\n  }\n  return $total;\n}\n\n// process payment and update database\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n  // check if user has submitted payment information\n  $payment_method = $_POST['payment_method'];\n  $payment_details = $_POST['payment_details'];\n  \n  // create new order in database\n  $order_query = \"INSERT INTO orders (user_id, total) VALUES ({$_SESSION['user_id']}, '{$total}')\";\n  mysqli_query($db, $order_query);\n  \n  // add items to order in database\n  foreach ($cart as &$item) {\n    $order_item_query = \"INSERT INTO order_items (order_id, product_id, quantity) VALUES ((SELECT MAX(id) FROM orders), {$item['id']}, {$item['quantity']})\";\n    mysqli_query($db, $order_item_query);\n  }\n  \n  // update cart contents\n  $cart = array();\n}\n```\nThis is a basic example of how you can implement a purchase functionality using PHP. Note that this code does not handle errors or security vulnerabilities and should be modified to suit your specific needs.\n\n**Example Use Cases**\n\n1. User adds items to cart:\n```php\n// index.php\n\n<form action=\"cart.php\" method=\"post\">\n  <input type=\"hidden\" name=\"product_id\" value=\"123\">\n  <button type=\"submit\">Add to Cart</button>\n</form>\n```\n2. User views cart contents:\n```php\n// cart.php\n\necho \"Your Cart:<br>\";\nview_cart();\n```\n3. User checks out and processes payment:\n```php\n// checkout.php\n\n<form action=\"checkout.php\" method=\"post\">\n  <input type=\"hidden\" name=\"payment_method\" value=\"paypal\">\n  <input type=\"text\" name=\"payment_details\" placeholder=\"Payment Details...\">\n  <button type=\"submit\">Submit Payment</button>\n</form>\n```\n4. System creates new order and adds items to database:\n```php\n// checkout.php\n\n$order_query = \"INSERT INTO orders (user_id, total) VALUES ({$_SESSION['user_id']}, '{$total}')\";\nmysqli_query($db, $order_query);\n```\nNote that this is a simplified example and you should modify it to fit your specific needs. Additionally, you should consider implementing security measures such as encryption and authentication to protect user data.", "code_blocks": [null, "```php\n// auth.php\n\n<?php\nif (!isset($_SESSION['user_id'])) {\n  // redirect to login page if not logged in\n  header('Location: login.php');\n}\n\n// load user data from database\n$user = $_SESSION['user'];\n\nfunction authenticate($username, $password) {\n  global $db;\n  $query = \"SELECT * FROM users WHERE username = '$username'\";\n  $result = mysqli_query($db, $query);\n  if (mysqli_num_rows($result) == 1) {\n    // user exists, check password\n    $user_data = mysqli_fetch_assoc($result);\n    if ($password === $user_data['password']) {\n      return true;\n    }\n  }\n  return false;\n}\n\nfunction login($username, $password) {\n  global $db;\n  if (authenticate($username, $password)) {\n    // authenticate successful, set session variables\n    $_SESSION['user_id'] = $user_data['id'];\n    $_SESSION['username'] = $username;\n    header('Location: index.php');\n  } else {\n    echo \"Invalid username or password\";\n  }\n}\n\nfunction register($username, $email, $password) {\n  global $db;\n  // hash password before storing in database\n  $hashed_password = password_hash($password, PASSWORD_DEFAULT);\n  $query = \"INSERT INTO users (username, email, password) VALUES ('$username', '$email', '$hashed_password')\";\n  mysqli_query($db, $query);\n}\n```", "```php\n// cart.php\n\n<?php\nif (!isset($_SESSION['user_id'])) {\n  // redirect to login page if not logged in\n  header('Location: login.php');\n}\n\n// load product data from database\n$product_query = \"SELECT * FROM products\";\n$product_result = mysqli_query($db, $product_query);\n$product_list = array();\nwhile ($product_row = mysqli_fetch_assoc($product_result)) {\n  $product_list[] = $product_row;\n}\n\nfunction add_to_cart($product_id) {\n  global $cart;\n  // check if product is already in cart\n  foreach ($cart as &$item) {\n    if ($item['id'] == $product_id) {\n      // increment quantity\n      $item['quantity']++;\n      return true;\n    }\n  }\n  // add new item to cart\n  $new_item = array(\n    'id' => $product_id,\n    'name' => '',\n    'price' => '',\n    'quantity' => 1\n  );\n  $cart[] = $new_item;\n}\n\nfunction view_cart() {\n  global $cart;\n  // print out contents of cart\n  foreach ($cart as &$item) {\n    echo \"Product: {$item['name']} ({$item['price']}) x {$item['quantity']}<br>\";\n  }\n}\n\n// add items to cart based on form submission\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n  // check if user has submitted a product ID\n  $product_id = $_POST['product_id'];\n  add_to_cart($product_id);\n}\n```", "```php\n// checkout.php\n\n<?php\nif (!isset($_SESSION['user_id'])) {\n  // redirect to login page if not logged in\n  header('Location: login.php');\n}\n\n// load cart contents and calculate total\n$cart_query = \"SELECT * FROM products WHERE id IN (\".implode(',', array_column($cart, 'id')).\")\";\n$cart_result = mysqli_query($db, $cart_query);\n$cart_list = array();\nwhile ($row = mysqli_fetch_assoc($cart_result)) {\n  foreach ($cart as &$item) {\n    if ($item['id'] == $row['id']) {\n      $item['name'] = $row['name'];\n      $item['price'] = $row['price'];\n    }\n  }\n}\n\nfunction calculate_total() {\n  global $cart;\n  // calculate total cost\n  $total = 0;\n  foreach ($cart as &$item) {\n    $total += $item['price'] * $item['quantity'];\n  }\n  return $total;\n}\n\n// process payment and update database\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n  // check if user has submitted payment information\n  $payment_method = $_POST['payment_method'];\n  $payment_details = $_POST['payment_details'];\n  \n  // create new order in database\n  $order_query = \"INSERT INTO orders (user_id, total) VALUES ({$_SESSION['user_id']}, '{$total}')\";\n  mysqli_query($db, $order_query);\n  \n  // add items to order in database\n  foreach ($cart as &$item) {\n    $order_item_query = \"INSERT INTO order_items (order_id, product_id, quantity) VALUES ((SELECT MAX(id) FROM orders), {$item['id']}, {$item['quantity']})\";\n    mysqli_query($db, $order_item_query);\n  }\n  \n  // update cart contents\n  $cart = array();\n}\n```", "```php\n// index.php\n\n<form action=\"cart.php\" method=\"post\">\n  <input type=\"hidden\" name=\"product_id\" value=\"123\">\n  <button type=\"submit\">Add to Cart</button>\n</form>\n```", "```php\n// cart.php\n\necho \"Your Cart:<br>\";\nview_cart();\n```", "```php\n// checkout.php\n\n<form action=\"checkout.php\" method=\"post\">\n  <input type=\"hidden\" name=\"payment_method\" value=\"paypal\">\n  <input type=\"text\" name=\"payment_details\" placeholder=\"Payment Details...\">\n  <button type=\"submit\">Submit Payment</button>\n</form>\n```", "```php\n// checkout.php\n\n$order_query = \"INSERT INTO orders (user_id, total) VALUES ({$_SESSION['user_id']}, '{$total}')\";\nmysqli_query($db, $order_query);\n```"]}
