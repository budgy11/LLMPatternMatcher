{"prompt": "Create a purchase functionality using php", "llm_output": "Here is an example of a basic purchase functionality in PHP:\n\n**purchase.php**\n```php\n<?php\n// Database connection settings\n$servername = \"localhost\";\n$username = \"root\";\n$password = \"\";\n$dbname = \"shopping_cart\";\n\n// Create database connection\n$conn = new mysqli($servername, $username, $password, $dbname);\n\n// Check if database connection was successful\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Define a function to add a product to the cart\nfunction add_product_to_cart($product_id, $quantity) {\n    global $conn;\n    \n    // Check if product exists in database\n    $query = \"SELECT * FROM products WHERE id = '$product_id'\";\n    $result = $conn->query($query);\n    \n    if ($result->num_rows > 0) {\n        // Retrieve product details from database\n        while($row = $result->fetch_assoc()) {\n            $product_name = $row[\"name\"];\n            $product_price = $row[\"price\"];\n            \n            // Check if quantity is valid (not less than or equal to 0)\n            if ($quantity > 0) {\n                // Add product to cart\n                $query = \"INSERT INTO cart (product_id, name, price, quantity) VALUES ('$product_id', '$product_name', '$product_price', '$quantity')\";\n                $result = $conn->query($query);\n                \n                if (!$result) {\n                    echo \"Error adding product to cart: \" . $conn->error;\n                }\n            } else {\n                echo \"Invalid quantity.\";\n            }\n        }\n    } else {\n        echo \"Product not found in database.\";\n    }\n}\n\n// Define a function to view the cart\nfunction view_cart() {\n    global $conn;\n    \n    // Retrieve all products from cart\n    $query = \"SELECT * FROM cart WHERE user_id = '$user_id'\";\n    $result = $conn->query($query);\n    \n    if ($result->num_rows > 0) {\n        while($row = $result->fetch_assoc()) {\n            $product_name = $row[\"name\"];\n            $product_price = $row[\"price\"];\n            $quantity = $row[\"quantity\"];\n            \n            echo \"<p>Product: $product_name, Price: $product_price, Quantity: $quantity</p>\";\n        }\n    } else {\n        echo \"Cart is empty.\";\n    }\n}\n\n// Define a function to checkout\nfunction checkout() {\n    global $conn;\n    \n    // Retrieve all products from cart\n    $query = \"SELECT * FROM cart WHERE user_id = '$user_id'\";\n    $result = $conn->query($query);\n    \n    if ($result->num_rows > 0) {\n        while($row = $result->fetch_assoc()) {\n            $product_name = $row[\"name\"];\n            $product_price = $row[\"price\"];\n            $quantity = $row[\"quantity\"];\n            \n            // Update stock levels in database\n            $query = \"UPDATE products SET quantity = quantity - '$quantity' WHERE name = '$product_name'\";\n            $result = $conn->query($query);\n            \n            if (!$result) {\n                echo \"Error updating stock levels: \" . $conn->error;\n            }\n        }\n        \n        // Clear cart\n        $query = \"TRUNCATE TABLE cart\";\n        $result = $conn->query($query);\n    } else {\n        echo \"Cart is empty.\";\n    }\n}\n\n// Define a function to handle form submission (e.g. add product to cart)\nfunction handle_form_submission() {\n    global $conn;\n    \n    if (isset($_POST[\"product_id\"]) && isset($_POST[\"quantity\"])) {\n        // Extract user input\n        $product_id = $_POST[\"product_id\"];\n        $quantity = $_POST[\"quantity\"];\n        \n        // Add product to cart\n        add_product_to_cart($product_id, $quantity);\n    } else {\n        echo \"Error processing form submission.\";\n    }\n}\n\n// Include navigation and content sections\nrequire_once(\"navigation.php\");\n?>\n\n<h1>Purchase</h1>\n\n<!-- Form to add products to cart -->\n<form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\">\n  <label for=\"product_id\">Product ID:</label>\n  <input type=\"text\" id=\"product_id\" name=\"product_id\"><br><br>\n  <label for=\"quantity\">Quantity:</label>\n  <input type=\"number\" id=\"quantity\" name=\"quantity\"><br><br>\n  <button type=\"submit\" name=\"submit\">Add to Cart</button>\n</form>\n\n<!-- Display cart contents -->\n<?php\nview_cart();\n?>\n\n<!-- Checkout button -->\n<button onclick=\"location.href='checkout.php'\">Checkout</button>\n\n<?php\n// Include footer section\nrequire_once(\"footer.php\");\n?>\n```\nThis example includes the following functionality:\n\n1. Database connection settings and a `mysqli` object to interact with the database.\n2. A function `add_product_to_cart()` to add products to the cart, including validation of product existence and quantity.\n3. A function `view_cart()` to display the contents of the cart.\n4. A function `checkout()` to update stock levels in the database and clear the cart.\n5. A function `handle_form_submission()` to handle form submissions (e.g. adding products to the cart).\n6. Includes for navigation, content, and footer sections.\n\nNote that this example assumes a basic database schema with tables for `products` and `cart`. The database connection settings should be updated accordingly.\n\n**Next Steps:**\n\n1. Update the database schema to include a `users` table for user authentication.\n2. Implement user authentication using PHP sessions or another method.\n3. Add additional functionality, such as displaying product details, updating cart quantities, and processing payments.\n4. Style the page with CSS and add any necessary JavaScript functionality.\n\n**Example Use Case:**\n\n1. User navigates to the `purchase.php` page.\n2. User submits a form with a product ID and quantity.\n3. The `handle_form_submission()` function is called, which adds the product to the cart using the `add_product_to_cart()` function.\n4. The user views their cart contents using the `view_cart()` function.\n5. When ready, the user clicks the \"Checkout\" button, which triggers the `checkout()` function to update stock levels and clear the cart.\n\nThis example demonstrates a basic purchase functionality in PHP using a database connection.", "code_blocks": ["```php\n<?php\n// Database connection settings\n$servername = \"localhost\";\n$username = \"root\";\n$password = \"\";\n$dbname = \"shopping_cart\";\n\n// Create database connection\n$conn = new mysqli($servername, $username, $password, $dbname);\n\n// Check if database connection was successful\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Define a function to add a product to the cart\nfunction add_product_to_cart($product_id, $quantity) {\n    global $conn;\n    \n    // Check if product exists in database\n    $query = \"SELECT * FROM products WHERE id = '$product_id'\";\n    $result = $conn->query($query);\n    \n    if ($result->num_rows > 0) {\n        // Retrieve product details from database\n        while($row = $result->fetch_assoc()) {\n            $product_name = $row[\"name\"];\n            $product_price = $row[\"price\"];\n            \n            // Check if quantity is valid (not less than or equal to 0)\n            if ($quantity > 0) {\n                // Add product to cart\n                $query = \"INSERT INTO cart (product_id, name, price, quantity) VALUES ('$product_id', '$product_name', '$product_price', '$quantity')\";\n                $result = $conn->query($query);\n                \n                if (!$result) {\n                    echo \"Error adding product to cart: \" . $conn->error;\n                }\n            } else {\n                echo \"Invalid quantity.\";\n            }\n        }\n    } else {\n        echo \"Product not found in database.\";\n    }\n}\n\n// Define a function to view the cart\nfunction view_cart() {\n    global $conn;\n    \n    // Retrieve all products from cart\n    $query = \"SELECT * FROM cart WHERE user_id = '$user_id'\";\n    $result = $conn->query($query);\n    \n    if ($result->num_rows > 0) {\n        while($row = $result->fetch_assoc()) {\n            $product_name = $row[\"name\"];\n            $product_price = $row[\"price\"];\n            $quantity = $row[\"quantity\"];\n            \n            echo \"<p>Product: $product_name, Price: $product_price, Quantity: $quantity</p>\";\n        }\n    } else {\n        echo \"Cart is empty.\";\n    }\n}\n\n// Define a function to checkout\nfunction checkout() {\n    global $conn;\n    \n    // Retrieve all products from cart\n    $query = \"SELECT * FROM cart WHERE user_id = '$user_id'\";\n    $result = $conn->query($query);\n    \n    if ($result->num_rows > 0) {\n        while($row = $result->fetch_assoc()) {\n            $product_name = $row[\"name\"];\n            $product_price = $row[\"price\"];\n            $quantity = $row[\"quantity\"];\n            \n            // Update stock levels in database\n            $query = \"UPDATE products SET quantity = quantity - '$quantity' WHERE name = '$product_name'\";\n            $result = $conn->query($query);\n            \n            if (!$result) {\n                echo \"Error updating stock levels: \" . $conn->error;\n            }\n        }\n        \n        // Clear cart\n        $query = \"TRUNCATE TABLE cart\";\n        $result = $conn->query($query);\n    } else {\n        echo \"Cart is empty.\";\n    }\n}\n\n// Define a function to handle form submission (e.g. add product to cart)\nfunction handle_form_submission() {\n    global $conn;\n    \n    if (isset($_POST[\"product_id\"]) && isset($_POST[\"quantity\"])) {\n        // Extract user input\n        $product_id = $_POST[\"product_id\"];\n        $quantity = $_POST[\"quantity\"];\n        \n        // Add product to cart\n        add_product_to_cart($product_id, $quantity);\n    } else {\n        echo \"Error processing form submission.\";\n    }\n}\n\n// Include navigation and content sections\nrequire_once(\"navigation.php\");\n?>\n\n<h1>Purchase</h1>\n\n<!-- Form to add products to cart -->\n<form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\">\n  <label for=\"product_id\">Product ID:</label>\n  <input type=\"text\" id=\"product_id\" name=\"product_id\"><br><br>\n  <label for=\"quantity\">Quantity:</label>\n  <input type=\"number\" id=\"quantity\" name=\"quantity\"><br><br>\n  <button type=\"submit\" name=\"submit\">Add to Cart</button>\n</form>\n\n<!-- Display cart contents -->\n<?php\nview_cart();\n?>\n\n<!-- Checkout button -->\n<button onclick=\"location.href='checkout.php'\">Checkout</button>\n\n<?php\n// Include footer section\nrequire_once(\"footer.php\");\n?>\n```"]}
