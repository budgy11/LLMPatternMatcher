{"prompt": "Create a purchase functionality using php", "llm_output": "Here is an example of a simple purchase functionality using PHP, HTML, and MySQL:\n\n**purchase.php**\n```php\n<?php\nrequire 'dbconnect.php';\n\nif (isset($_POST['submit'])) {\n  $product_id = $_POST['product_id'];\n  $quantity = $_POST['quantity'];\n\n  // Validate input\n  if ($quantity < 1 || !is_numeric($quantity)) {\n    echo \"Invalid quantity\";\n    exit;\n  }\n\n  // Check if product exists and has sufficient stock\n  $query = \"SELECT * FROM products WHERE id = '$product_id'\";\n  $result = mysqli_query($conn, $query);\n  if (!$result) {\n    die(\"Database query failed: \" . mysqli_error($conn));\n  }\n  $row = mysqli_fetch_assoc($result);\n  if ($row['stock'] < $quantity) {\n    echo \"Insufficient stock\";\n    exit;\n  }\n\n  // Update product stock and create new order\n  $query = \"UPDATE products SET stock = stock - '$quantity' WHERE id = '$product_id'\";\n  mysqli_query($conn, $query);\n  $order_id = uniqid();\n  $query = \"INSERT INTO orders (product_id, quantity, order_date) VALUES ('$product_id', '$quantity', NOW())\";\n  mysqli_query($conn, $query);\n\n  echo \"Purchase successful!\";\n}\n\n// Display products for purchase\n$query = \"SELECT * FROM products\";\n$result = mysqli_query($conn, $query);\nwhile ($row = mysqli_fetch_assoc($result)) {\n  ?>\n  <form action=\"purchase.php\" method=\"post\">\n    <input type=\"hidden\" name=\"product_id\" value=\"<?php echo $row['id']; ?>\">\n    <label for=\"quantity\"><?php echo $row['name']; ?></label>\n    <input type=\"number\" id=\"quantity\" name=\"quantity\" value=\"1\">\n    <button type=\"submit\">Buy</button>\n  </form>\n  <?php\n}\n?>\n```\n\n**dbconnect.php**\n```php\n<?php\n$conn = mysqli_connect('localhost', 'username', 'password', 'database');\nif (!$conn) {\n  die(\"Connection failed: \" . mysqli_error($conn));\n}\n?>\n```\n**products table schema**\n\n| Column Name | Data Type | Description |\n| --- | --- | --- |\n| id | int | Unique product ID |\n| name | varchar(255) | Product name |\n| stock | int | Current stock quantity |\n\n**orders table schema**\n\n| Column Name | Data Type | Description |\n| --- | --- | --- |\n| id | int | Unique order ID |\n| product_id | int | Foreign key referencing products table |\n| quantity | int | Quantity purchased |\n| order_date | timestamp | Date and time of purchase |\n\nTo use this code, you'll need to replace the placeholders in `dbconnect.php` with your actual database credentials. You should also modify the table schema to match your specific requirements.\n\n**Example Use Case:**\n\n1. The user selects a product from the list and enters the desired quantity.\n2. When they submit the form, the server-side script checks if the product exists and has sufficient stock.\n3. If all conditions are met, the script updates the product stock and creates a new order in the database.\n4. The user is notified that their purchase was successful.\n\nNote: This example uses MySQL as the database management system. You can modify it to work with other databases (e.g., PostgreSQL) by changing the `dbconnect.php` file accordingly. Additionally, this code does not handle errors or edge cases exhaustively; you should add proper error handling and security measures in a real-world application.", "code_blocks": ["```php\n<?php\nrequire 'dbconnect.php';\n\nif (isset($_POST['submit'])) {\n  $product_id = $_POST['product_id'];\n  $quantity = $_POST['quantity'];\n\n  // Validate input\n  if ($quantity < 1 || !is_numeric($quantity)) {\n    echo \"Invalid quantity\";\n    exit;\n  }\n\n  // Check if product exists and has sufficient stock\n  $query = \"SELECT * FROM products WHERE id = '$product_id'\";\n  $result = mysqli_query($conn, $query);\n  if (!$result) {\n    die(\"Database query failed: \" . mysqli_error($conn));\n  }\n  $row = mysqli_fetch_assoc($result);\n  if ($row['stock'] < $quantity) {\n    echo \"Insufficient stock\";\n    exit;\n  }\n\n  // Update product stock and create new order\n  $query = \"UPDATE products SET stock = stock - '$quantity' WHERE id = '$product_id'\";\n  mysqli_query($conn, $query);\n  $order_id = uniqid();\n  $query = \"INSERT INTO orders (product_id, quantity, order_date) VALUES ('$product_id', '$quantity', NOW())\";\n  mysqli_query($conn, $query);\n\n  echo \"Purchase successful!\";\n}\n\n// Display products for purchase\n$query = \"SELECT * FROM products\";\n$result = mysqli_query($conn, $query);\nwhile ($row = mysqli_fetch_assoc($result)) {\n  ?>\n  <form action=\"purchase.php\" method=\"post\">\n    <input type=\"hidden\" name=\"product_id\" value=\"<?php echo $row['id']; ?>\">\n    <label for=\"quantity\"><?php echo $row['name']; ?></label>\n    <input type=\"number\" id=\"quantity\" name=\"quantity\" value=\"1\">\n    <button type=\"submit\">Buy</button>\n  </form>\n  <?php\n}\n?>\n```", "```php\n<?php\n$conn = mysqli_connect('localhost', 'username', 'password', 'database');\nif (!$conn) {\n  die(\"Connection failed: \" . mysqli_error($conn));\n}\n?>\n```"]}
