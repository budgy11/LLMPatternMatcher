{"prompt": "Create a purchase functionality using php", "llm_output": "Here is an example of a simple purchase functionality using PHP:\n\n**purchase.php**\n```php\n<?php\n// Configuration file (e.g. database connection)\nrequire_once 'config.php';\n\n// Check if the user is logged in\nif (!isset($_SESSION['username'])) {\n    header('Location: login.php');\n    exit;\n}\n\n// Get the product ID from the URL parameter\n$product_id = $_GET['product_id'];\n\n// Validate the product ID\nif (!$product_id || !ctype_digit($product_id)) {\n    header('Location: products.php');\n    exit;\n}\n\n// Connect to the database\n$conn = mysqli_connect(DB_HOST, DB_USER, DB_PASSWORD, DB_NAME);\n\n// Check connection\nif (!$conn) {\n    die(\"Connection failed: \" . mysqli_error());\n}\n\n// Query to get the product details\n$sql = \"SELECT * FROM products WHERE id = '$product_id'\";\n$result = mysqli_query($conn, $sql);\n\n// Check if the product exists\nif (mysqli_num_rows($result) == 0) {\n    header('Location: products.php');\n    exit;\n}\n\n// Get the product details from the result\n$product = mysqli_fetch_assoc($result);\n\n// Query to insert a new order into the database\n$sql = \"INSERT INTO orders SET customer_id = '\".$_SESSION['id'].\"', product_id = '$product_id', quantity = 1\";\nmysqli_query($conn, $sql);\n\n// Update the product stock\n$stock = $product['quantity'] - 1;\n$sql = \"UPDATE products SET quantity = '$stock' WHERE id = '$product_id'\";\nmysqli_query($conn, $sql);\n\n// Display a success message\necho 'Your purchase has been successful!';\n?>\n```\n**config.php**\n```php\n<?php\n// Database configuration\ndefine('DB_HOST', 'localhost');\ndefine('DB_USER', 'username');\ndefine('DB_PASSWORD', 'password');\ndefine('DB_NAME', 'database_name');\n\n// Session configuration\nsession_start();\n\n// Define the customer ID (e.g. from a login system)\n$_SESSION['id'] = 1; // Replace with actual customer ID\n\n?>\n```\n**Explanation**\n\nThis example assumes that you have a database table `products` with columns `id`, `name`, and `quantity`. It also assumes that you have a session variable `username` set to the current user's name.\n\nThe script does the following:\n\n1. Checks if the user is logged in.\n2. Validates the product ID passed through the URL parameter.\n3. Connects to the database using the configuration file.\n4. Retrieves the product details from the database.\n5. Inserts a new order into the database with the current customer's ID and the selected product's ID.\n6. Updates the product stock by decrementing the quantity.\n\n**Note**: This is a simplified example and you should adapt it to your specific requirements (e.g., handling errors, validating user input, etc.). Additionally, this example uses MySQLi, but you can use PDO or other database libraries depending on your preference.", "code_blocks": ["```php\n<?php\n// Configuration file (e.g. database connection)\nrequire_once 'config.php';\n\n// Check if the user is logged in\nif (!isset($_SESSION['username'])) {\n    header('Location: login.php');\n    exit;\n}\n\n// Get the product ID from the URL parameter\n$product_id = $_GET['product_id'];\n\n// Validate the product ID\nif (!$product_id || !ctype_digit($product_id)) {\n    header('Location: products.php');\n    exit;\n}\n\n// Connect to the database\n$conn = mysqli_connect(DB_HOST, DB_USER, DB_PASSWORD, DB_NAME);\n\n// Check connection\nif (!$conn) {\n    die(\"Connection failed: \" . mysqli_error());\n}\n\n// Query to get the product details\n$sql = \"SELECT * FROM products WHERE id = '$product_id'\";\n$result = mysqli_query($conn, $sql);\n\n// Check if the product exists\nif (mysqli_num_rows($result) == 0) {\n    header('Location: products.php');\n    exit;\n}\n\n// Get the product details from the result\n$product = mysqli_fetch_assoc($result);\n\n// Query to insert a new order into the database\n$sql = \"INSERT INTO orders SET customer_id = '\".$_SESSION['id'].\"', product_id = '$product_id', quantity = 1\";\nmysqli_query($conn, $sql);\n\n// Update the product stock\n$stock = $product['quantity'] - 1;\n$sql = \"UPDATE products SET quantity = '$stock' WHERE id = '$product_id'\";\nmysqli_query($conn, $sql);\n\n// Display a success message\necho 'Your purchase has been successful!';\n?>\n```", "```php\n<?php\n// Database configuration\ndefine('DB_HOST', 'localhost');\ndefine('DB_USER', 'username');\ndefine('DB_PASSWORD', 'password');\ndefine('DB_NAME', 'database_name');\n\n// Session configuration\nsession_start();\n\n// Define the customer ID (e.g. from a login system)\n$_SESSION['id'] = 1; // Replace with actual customer ID\n\n?>\n```"]}
