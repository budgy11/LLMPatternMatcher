{"prompt": "Create a purchase functionality using php", "llm_output": "Here is an example of a basic purchase functionality using PHP:\n\n**Database Schema**\n\nLet's assume we have the following database schema for our e-commerce application:\n```sql\nCREATE TABLE users (\n  id INT PRIMARY KEY,\n  name VARCHAR(255),\n  email VARCHAR(255)\n);\n\nCREATE TABLE products (\n  id INT PRIMARY KEY,\n  name VARCHAR(255),\n  price DECIMAL(10,2)\n);\n\nCREATE TABLE orders (\n  id INT PRIMARY KEY,\n  user_id INT,\n  total_price DECIMAL(10,2),\n  created_at TIMESTAMP\n);\n\nCREATE TABLE order_items (\n  id INT PRIMARY KEY,\n  order_id INT,\n  product_id INT,\n  quantity INT,\n  price DECIMAL(10,2)\n);\n```\n**PHP Code**\n\nWe'll create a simple controller to handle the purchase functionality. Let's call it `PurchaseController.php`.\n```php\n<?php\n\nclass PurchaseController {\n  private $db;\n\n  public function __construct() {\n    $this->db = new Database(); // assume we have a Database class that connects to our database\n  }\n\n  public function index() {\n    // display products page\n    $products = $this->db->query(\"SELECT * FROM products\");\n    return view('products', ['products' => $products]);\n  }\n\n  public function addtocart($product_id) {\n    // add product to cart\n    if (!isset($_SESSION['cart'])) {\n      $_SESSION['cart'] = array();\n    }\n    $_SESSION['cart'][$product_id] = true;\n    header(\"Location: \" . url('view_cart'));\n  }\n\n  public function view_cart() {\n    // display cart page\n    $products_in_cart = array();\n    if (isset($_SESSION['cart'])) {\n      foreach ($_SESSION['cart'] as $product_id => $quantity) {\n        $product = $this->db->query(\"SELECT * FROM products WHERE id = '$product_id'\")->fetch_assoc();\n        $products_in_cart[] = $product;\n      }\n    }\n    return view('cart', ['products' => $products_in_cart]);\n  }\n\n  public function checkout() {\n    // display checkout page\n    if (!isset($_SESSION['customer'])) {\n      header(\"Location: \" . url('login'));\n    }\n    $order = array();\n    $order['total_price'] = 0;\n    $order_items = array();\n\n    foreach ($_SESSION['cart'] as $product_id => $quantity) {\n      $product = $this->db->query(\"SELECT * FROM products WHERE id = '$product_id'\")->fetch_assoc();\n      $order_items[] = array(\n        'id' => $product['id'],\n        'name' => $product['name'],\n        'price' => $product['price'],\n        'quantity' => $_SESSION['cart'][$product_id]\n      );\n      $order['total_price'] += ($product['price'] * $_SESSION['cart'][$product_id]);\n    }\n\n    return view('checkout', ['order' => $order, 'items' => $order_items]);\n  }\n\n  public function place_order() {\n    // create new order\n    if (!isset($_SESSION['customer'])) {\n      header(\"Location: \" . url('login'));\n    }\n    $order = array();\n    $order['user_id'] = $_SESSION['customer']['id'];\n    $order['total_price'] = 0;\n    foreach ($_SESSION['cart'] as $product_id => $quantity) {\n      $order_items[] = array(\n        'id' => $product_id,\n        'name' => '',\n        'price' => 0,\n        'quantity' => $_SESSION['cart'][$product_id]\n      );\n      $order['total_price'] += ($product_id * $_SESSION['cart'][$product_id]);\n    }\n    $this->db->query(\"INSERT INTO orders (user_id, total_price) VALUES ('$order[user_id]', '$order[total_price]')\");\n    $order_id = $this->db->insert_id;\n    foreach ($order_items as $item) {\n      $this->db->query(\"INSERT INTO order_items (order_id, product_id, quantity, price) VALUES ('$order_id', '$item[id]', '$item[quantity]', '$item[price]')\");\n    }\n    header(\"Location: \" . url('view_orders'));\n  }\n\n  public function view_orders() {\n    // display orders page\n    $orders = array();\n    $user_id = $_SESSION['customer']['id'];\n    $orders_query = \"SELECT * FROM orders WHERE user_id = '$user_id'\";\n    $orders_result = $this->db->query($orders_query);\n    while ($order = $orders_result->fetch_assoc()) {\n      $orders[] = array(\n        'id' => $order['id'],\n        'total_price' => $order['total_price']\n      );\n    }\n    return view('orders', ['orders' => $orders]);\n  }\n}\n```\n**View Files**\n\nWe'll create basic view files for each page. Let's assume we have the following files:\n\n`products.php`:\n```php\n<?php foreach ($products as $product): ?>\n  <div>\n    <h2><?= $product['name'] ?></h2>\n    <p>Price: <?= $product['price'] ?></p>\n    <button onclick=\"location.href='<?= url('addtocart', array($product['id'])) ?>'\">Add to Cart</button>\n  </div>\n<?php endforeach; ?>\n```\n`cart.php`:\n```php\n<?php foreach ($products_in_cart as $product): ?>\n  <div>\n    <h2><?= $product['name'] ?></h2>\n    <p>Price: <?= $product['price'] ?></p>\n    <p>Quantity: <?= $_SESSION['cart'][$product['id']] ?></p>\n  </div>\n<?php endforeach; ?>\n```\n`checkout.php`:\n```php\n<h1>Checkout</h1>\n\n<p>Total Price: <?= $order['total_price'] ?></p>\n\n<form action=\"<?= url('place_order') ?>\" method=\"post\">\n  <input type=\"hidden\" name=\"order\" value=\"<?= json_encode($order) ?>\">\n  <button type=\"submit\">Place Order</button>\n</form>\n```\n**Note**\n\nThis is a basic example to illustrate the concept of purchase functionality using PHP. You'll likely need to add more features, error handling, and security measures depending on your specific requirements.\n\nAlso, this example assumes that you have a `Database` class that connects to your database and provides methods for querying and inserting data.\n\nYou can modify and extend this code as needed to suit your project's needs.", "code_blocks": [null, "```php\n<?php\n\nclass PurchaseController {\n  private $db;\n\n  public function __construct() {\n    $this->db = new Database(); // assume we have a Database class that connects to our database\n  }\n\n  public function index() {\n    // display products page\n    $products = $this->db->query(\"SELECT * FROM products\");\n    return view('products', ['products' => $products]);\n  }\n\n  public function addtocart($product_id) {\n    // add product to cart\n    if (!isset($_SESSION['cart'])) {\n      $_SESSION['cart'] = array();\n    }\n    $_SESSION['cart'][$product_id] = true;\n    header(\"Location: \" . url('view_cart'));\n  }\n\n  public function view_cart() {\n    // display cart page\n    $products_in_cart = array();\n    if (isset($_SESSION['cart'])) {\n      foreach ($_SESSION['cart'] as $product_id => $quantity) {\n        $product = $this->db->query(\"SELECT * FROM products WHERE id = '$product_id'\")->fetch_assoc();\n        $products_in_cart[] = $product;\n      }\n    }\n    return view('cart', ['products' => $products_in_cart]);\n  }\n\n  public function checkout() {\n    // display checkout page\n    if (!isset($_SESSION['customer'])) {\n      header(\"Location: \" . url('login'));\n    }\n    $order = array();\n    $order['total_price'] = 0;\n    $order_items = array();\n\n    foreach ($_SESSION['cart'] as $product_id => $quantity) {\n      $product = $this->db->query(\"SELECT * FROM products WHERE id = '$product_id'\")->fetch_assoc();\n      $order_items[] = array(\n        'id' => $product['id'],\n        'name' => $product['name'],\n        'price' => $product['price'],\n        'quantity' => $_SESSION['cart'][$product_id]\n      );\n      $order['total_price'] += ($product['price'] * $_SESSION['cart'][$product_id]);\n    }\n\n    return view('checkout', ['order' => $order, 'items' => $order_items]);\n  }\n\n  public function place_order() {\n    // create new order\n    if (!isset($_SESSION['customer'])) {\n      header(\"Location: \" . url('login'));\n    }\n    $order = array();\n    $order['user_id'] = $_SESSION['customer']['id'];\n    $order['total_price'] = 0;\n    foreach ($_SESSION['cart'] as $product_id => $quantity) {\n      $order_items[] = array(\n        'id' => $product_id,\n        'name' => '',\n        'price' => 0,\n        'quantity' => $_SESSION['cart'][$product_id]\n      );\n      $order['total_price'] += ($product_id * $_SESSION['cart'][$product_id]);\n    }\n    $this->db->query(\"INSERT INTO orders (user_id, total_price) VALUES ('$order[user_id]', '$order[total_price]')\");\n    $order_id = $this->db->insert_id;\n    foreach ($order_items as $item) {\n      $this->db->query(\"INSERT INTO order_items (order_id, product_id, quantity, price) VALUES ('$order_id', '$item[id]', '$item[quantity]', '$item[price]')\");\n    }\n    header(\"Location: \" . url('view_orders'));\n  }\n\n  public function view_orders() {\n    // display orders page\n    $orders = array();\n    $user_id = $_SESSION['customer']['id'];\n    $orders_query = \"SELECT * FROM orders WHERE user_id = '$user_id'\";\n    $orders_result = $this->db->query($orders_query);\n    while ($order = $orders_result->fetch_assoc()) {\n      $orders[] = array(\n        'id' => $order['id'],\n        'total_price' => $order['total_price']\n      );\n    }\n    return view('orders', ['orders' => $orders]);\n  }\n}\n```", "```php\n<?php foreach ($products as $product): ?>\n  <div>\n    <h2><?= $product['name'] ?></h2>\n    <p>Price: <?= $product['price'] ?></p>\n    <button onclick=\"location.href='<?= url('addtocart', array($product['id'])) ?>'\">Add to Cart</button>\n  </div>\n<?php endforeach; ?>\n```", "```php\n<?php foreach ($products_in_cart as $product): ?>\n  <div>\n    <h2><?= $product['name'] ?></h2>\n    <p>Price: <?= $product['price'] ?></p>\n    <p>Quantity: <?= $_SESSION['cart'][$product['id']] ?></p>\n  </div>\n<?php endforeach; ?>\n```", "```php\n<h1>Checkout</h1>\n\n<p>Total Price: <?= $order['total_price'] ?></p>\n\n<form action=\"<?= url('place_order') ?>\" method=\"post\">\n  <input type=\"hidden\" name=\"order\" value=\"<?= json_encode($order) ?>\">\n  <button type=\"submit\">Place Order</button>\n</form>\n```"]}
