{"prompt": "Create a purchase functionality using php", "llm_output": "Here is an example of a basic purchase functionality using PHP. This example assumes you have a database set up with the necessary tables to store orders and products.\n\n**Database Schema**\n\nFor this example, let's assume we have two tables:\n\n* `products`: stores information about each product\n\t+ `id` (primary key)\n\t+ `name`\n\t+ `price`\n* `orders`: stores information about each order\n\t+ `id` (primary key)\n\t+ `customer_name`\n\t+ `order_date`\n\t+ `total_cost`\n\n**PHP Code**\n\n```php\n<?php\n\n// Connect to the database\n$conn = new mysqli('localhost', 'username', 'password', 'database');\n\n// Check connection\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Function to add a product to the order\nfunction add_product_to_order($order_id, $product_id, $quantity) {\n    global $conn;\n\n    // Validate input\n    if (empty($order_id) || empty($product_id) || !is_numeric($quantity)) {\n        return false;\n    }\n\n    // Insert into orders_products table\n    $query = \"INSERT INTO orders_products (order_id, product_id, quantity)\n              VALUES ('$order_id', '$product_id', '$quantity')\";\n    if (!$conn->query($query)) {\n        echo \"Error adding product to order: \" . $conn->error;\n        return false;\n    }\n\n    // Update the order total cost\n    $total_cost = get_order_total($order_id);\n    update_order_total($order_id, $total_cost);\n\n    return true;\n}\n\n// Function to get the order total cost\nfunction get_order_total($order_id) {\n    global $conn;\n\n    // Query the database for the order total cost\n    $query = \"SELECT SUM(op.quantity * p.price) AS total_cost FROM orders_products op\n              JOIN products p ON op.product_id = p.id\n              WHERE op.order_id = '$order_id'\";\n    if ($result = $conn->query($query)) {\n        return $result->fetch_assoc()['total_cost'];\n    } else {\n        echo \"Error getting order total: \" . $conn->error;\n        return false;\n    }\n}\n\n// Function to update the order total cost\nfunction update_order_total($order_id, $total_cost) {\n    global $conn;\n\n    // Update the order total cost in the orders table\n    $query = \"UPDATE orders SET total_cost = '$total_cost' WHERE id = '$order_id'\";\n    if (!$conn->query($query)) {\n        echo \"Error updating order total: \" . $conn->error;\n        return false;\n    }\n\n    return true;\n}\n\n// Function to create a new order\nfunction create_order($customer_name) {\n    global $conn;\n\n    // Generate a unique order ID\n    $order_id = uniqid();\n\n    // Insert into orders table\n    $query = \"INSERT INTO orders (id, customer_name, total_cost)\n              VALUES ('$order_id', '$customer_name', 0)\";\n    if (!$conn->query($query)) {\n        echo \"Error creating order: \" . $conn->error;\n        return false;\n    }\n\n    return $order_id;\n}\n\n// Function to purchase a product\nfunction purchase_product($product_id, $quantity) {\n    global $conn;\n\n    // Get the current customer's order ID (assuming we have a session variable or cookie storing this info)\n    $customer_name = $_SESSION['customer_name'];\n    $order_id = get_customer_order_id($customer_name);\n\n    if (!empty($order_id)) {\n        add_product_to_order($order_id, $product_id, $quantity);\n    } else {\n        // If the customer doesn't have an existing order, create a new one\n        $order_id = create_order($customer_name);\n        add_product_to_order($order_id, $product_id, $quantity);\n    }\n\n    return true;\n}\n\n// Function to get the customer's current order ID\nfunction get_customer_order_id($customer_name) {\n    global $conn;\n\n    // Query the database for the customer's current order ID\n    $query = \"SELECT id FROM orders WHERE customer_name = '$customer_name' AND total_cost > 0\";\n    if ($result = $conn->query($query)) {\n        return $result->fetch_assoc()['id'];\n    } else {\n        echo \"Error getting customer's current order ID: \" . $conn->error;\n        return false;\n    }\n}\n\n// Example usage:\n$customer_name = 'John Doe';\n$product_id = 1; // assuming product with id=1 exists in the database\n$quantity = 2;\n\n$purchased = purchase_product($product_id, $quantity);\n\nif ($purchased) {\n    echo \"Product purchased successfully!\";\n} else {\n    echo \"Error purchasing product.\";\n}\n```\n\nNote: This is a basic example and doesn't include any error handling or security measures (e.g. input validation, SQL injection protection). You should adapt this code to your specific use case and add the necessary features for a production-ready application.\n\nAlso note that this example uses the `mysqli` extension which is deprecated since PHP 7.2. You may want to consider using `PDO` or `mysqli` with prepared statements instead.", "code_blocks": ["```php\n<?php\n\n// Connect to the database\n$conn = new mysqli('localhost', 'username', 'password', 'database');\n\n// Check connection\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Function to add a product to the order\nfunction add_product_to_order($order_id, $product_id, $quantity) {\n    global $conn;\n\n    // Validate input\n    if (empty($order_id) || empty($product_id) || !is_numeric($quantity)) {\n        return false;\n    }\n\n    // Insert into orders_products table\n    $query = \"INSERT INTO orders_products (order_id, product_id, quantity)\n              VALUES ('$order_id', '$product_id', '$quantity')\";\n    if (!$conn->query($query)) {\n        echo \"Error adding product to order: \" . $conn->error;\n        return false;\n    }\n\n    // Update the order total cost\n    $total_cost = get_order_total($order_id);\n    update_order_total($order_id, $total_cost);\n\n    return true;\n}\n\n// Function to get the order total cost\nfunction get_order_total($order_id) {\n    global $conn;\n\n    // Query the database for the order total cost\n    $query = \"SELECT SUM(op.quantity * p.price) AS total_cost FROM orders_products op\n              JOIN products p ON op.product_id = p.id\n              WHERE op.order_id = '$order_id'\";\n    if ($result = $conn->query($query)) {\n        return $result->fetch_assoc()['total_cost'];\n    } else {\n        echo \"Error getting order total: \" . $conn->error;\n        return false;\n    }\n}\n\n// Function to update the order total cost\nfunction update_order_total($order_id, $total_cost) {\n    global $conn;\n\n    // Update the order total cost in the orders table\n    $query = \"UPDATE orders SET total_cost = '$total_cost' WHERE id = '$order_id'\";\n    if (!$conn->query($query)) {\n        echo \"Error updating order total: \" . $conn->error;\n        return false;\n    }\n\n    return true;\n}\n\n// Function to create a new order\nfunction create_order($customer_name) {\n    global $conn;\n\n    // Generate a unique order ID\n    $order_id = uniqid();\n\n    // Insert into orders table\n    $query = \"INSERT INTO orders (id, customer_name, total_cost)\n              VALUES ('$order_id', '$customer_name', 0)\";\n    if (!$conn->query($query)) {\n        echo \"Error creating order: \" . $conn->error;\n        return false;\n    }\n\n    return $order_id;\n}\n\n// Function to purchase a product\nfunction purchase_product($product_id, $quantity) {\n    global $conn;\n\n    // Get the current customer's order ID (assuming we have a session variable or cookie storing this info)\n    $customer_name = $_SESSION['customer_name'];\n    $order_id = get_customer_order_id($customer_name);\n\n    if (!empty($order_id)) {\n        add_product_to_order($order_id, $product_id, $quantity);\n    } else {\n        // If the customer doesn't have an existing order, create a new one\n        $order_id = create_order($customer_name);\n        add_product_to_order($order_id, $product_id, $quantity);\n    }\n\n    return true;\n}\n\n// Function to get the customer's current order ID\nfunction get_customer_order_id($customer_name) {\n    global $conn;\n\n    // Query the database for the customer's current order ID\n    $query = \"SELECT id FROM orders WHERE customer_name = '$customer_name' AND total_cost > 0\";\n    if ($result = $conn->query($query)) {\n        return $result->fetch_assoc()['id'];\n    } else {\n        echo \"Error getting customer's current order ID: \" . $conn->error;\n        return false;\n    }\n}\n\n// Example usage:\n$customer_name = 'John Doe';\n$product_id = 1; // assuming product with id=1 exists in the database\n$quantity = 2;\n\n$purchased = purchase_product($product_id, $quantity);\n\nif ($purchased) {\n    echo \"Product purchased successfully!\";\n} else {\n    echo \"Error purchasing product.\";\n}\n```"]}
