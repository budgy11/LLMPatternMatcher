{"prompt": "Create a purchase functionality using php", "llm_output": "Here's an example of a basic purchase functionality in PHP:\n\n**Database Structure**\n\nFirst, let's create the database structure to store purchases. We'll use MySQL as our database management system.\n\n```sql\nCREATE TABLE customers (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  name VARCHAR(255),\n  email VARCHAR(255)\n);\n\nCREATE TABLE products (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  name VARCHAR(255),\n  price DECIMAL(10,2)\n);\n\nCREATE TABLE purchases (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  customer_id INT,\n  product_id INT,\n  quantity INT,\n  total DECIMAL(10,2),\n  FOREIGN KEY (customer_id) REFERENCES customers(id),\n  FOREIGN KEY (product_id) REFERENCES products(id)\n);\n```\n\n**PHP Code**\n\nNow, let's create the PHP code for the purchase functionality. We'll use a simple form to collect customer and product information, and then process the payment using PayPal as an example.\n\n```php\n// database connection settings\n$host = 'localhost';\n$username = 'your_username';\n$password = 'your_password';\n$dbname = 'your_database_name';\n\n// connect to database\n$conn = new mysqli($host, $username, $password, $dbname);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// form to collect customer and product information\n?>\n\n<form action=\"purchase.php\" method=\"post\">\n  <label for=\"customer_name\">Customer Name:</label>\n  <input type=\"text\" id=\"customer_name\" name=\"customer_name\"><br><br>\n\n  <label for=\"product_id\">Product ID:</label>\n  <select id=\"product_id\" name=\"product_id\">\n    <?php\n      // retrieve products from database\n      $query = \"SELECT * FROM products\";\n      $result = $conn->query($query);\n      \n      while ($row = $result->fetch_assoc()) {\n        echo \"<option value='\" . $row['id'] . \"'>\" . $row['name'] . \"</option>\";\n      }\n    ?>\n  </select><br><br>\n\n  <label for=\"quantity\">Quantity:</label>\n  <input type=\"number\" id=\"quantity\" name=\"quantity\"><br><br>\n\n  <button type=\"submit\" name=\"submit\">Purchase</button>\n</form>\n\n<?php\n\n// process purchase form submission\nif (isset($_POST['submit'])) {\n  // retrieve customer and product information from database\n  $customer_name = $_POST['customer_name'];\n  $product_id = $_POST['product_id'];\n  $quantity = $_POST['quantity'];\n\n  // calculate total cost\n  $query = \"SELECT price FROM products WHERE id = '$product_id'\";\n  $result = $conn->query($query);\n  $row = $result->fetch_assoc();\n  $total = $row['price'] * $quantity;\n\n  // insert purchase into database\n  $query = \"INSERT INTO purchases (customer_name, product_id, quantity, total) VALUES ('$customer_name', '$product_id', '$quantity', '$total')\";\n  $conn->query($query);\n\n  echo \"Purchase successful!\";\n}\n\n// close database connection\n$conn->close();\n?>\n```\n\n**Note**: This is a basic example and you should consider implementing additional security measures such as validation, sanitization, and authentication.\n\n**Example Use Case**\n\n1. The customer fills out the form with their name, selects a product from the dropdown list, enters the quantity they want to purchase, and clicks the \"Purchase\" button.\n2. The PHP code processes the form submission by retrieving the customer's name, product ID, and quantity from the database.\n3. It calculates the total cost of the purchase by multiplying the product price with the quantity.\n4. It inserts a new row into the `purchases` table in the database to record the transaction.\n5. Finally, it displays a success message to the customer indicating that their purchase has been processed successfully.\n\nPlease let me know if you need any further assistance or clarification!", "code_blocks": [null, "```php\n// database connection settings\n$host = 'localhost';\n$username = 'your_username';\n$password = 'your_password';\n$dbname = 'your_database_name';\n\n// connect to database\n$conn = new mysqli($host, $username, $password, $dbname);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// form to collect customer and product information\n?>\n\n<form action=\"purchase.php\" method=\"post\">\n  <label for=\"customer_name\">Customer Name:</label>\n  <input type=\"text\" id=\"customer_name\" name=\"customer_name\"><br><br>\n\n  <label for=\"product_id\">Product ID:</label>\n  <select id=\"product_id\" name=\"product_id\">\n    <?php\n      // retrieve products from database\n      $query = \"SELECT * FROM products\";\n      $result = $conn->query($query);\n      \n      while ($row = $result->fetch_assoc()) {\n        echo \"<option value='\" . $row['id'] . \"'>\" . $row['name'] . \"</option>\";\n      }\n    ?>\n  </select><br><br>\n\n  <label for=\"quantity\">Quantity:</label>\n  <input type=\"number\" id=\"quantity\" name=\"quantity\"><br><br>\n\n  <button type=\"submit\" name=\"submit\">Purchase</button>\n</form>\n\n<?php\n\n// process purchase form submission\nif (isset($_POST['submit'])) {\n  // retrieve customer and product information from database\n  $customer_name = $_POST['customer_name'];\n  $product_id = $_POST['product_id'];\n  $quantity = $_POST['quantity'];\n\n  // calculate total cost\n  $query = \"SELECT price FROM products WHERE id = '$product_id'\";\n  $result = $conn->query($query);\n  $row = $result->fetch_assoc();\n  $total = $row['price'] * $quantity;\n\n  // insert purchase into database\n  $query = \"INSERT INTO purchases (customer_name, product_id, quantity, total) VALUES ('$customer_name', '$product_id', '$quantity', '$total')\";\n  $conn->query($query);\n\n  echo \"Purchase successful!\";\n}\n\n// close database connection\n$conn->close();\n?>\n```"]}
