{"prompt": "Create a purchase functionality using php", "llm_output": "Here is an example of a simple purchase functionality in PHP:\n\n**Database Schema**\n\nWe will use a MySQL database with the following tables:\n\n```sql\nCREATE TABLE products (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  name VARCHAR(255),\n  price DECIMAL(10,2)\n);\n\nCREATE TABLE orders (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  customer_name VARCHAR(255),\n  total DECIMAL(10,2),\n  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n);\n\nCREATE TABLE order_items (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  order_id INT,\n  product_id INT,\n  quantity INT,\n  FOREIGN KEY (order_id) REFERENCES orders(id),\n  FOREIGN KEY (product_id) REFERENCES products(id)\n);\n```\n\n**PHP Code**\n\n```php\n// db.php: database connection settings\n<?php\n$servername = \"localhost\";\n$username = \"username\";\n$password = \"password\";\n$dbname = \"shop\";\n\n$conn = new mysqli($servername, $username, $password, $dbname);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n?>\n\n// index.php: purchase functionality\n<?php\nrequire 'db.php';\n\nif (isset($_POST['purchase'])) {\n  // Get product ID and quantity from form submission\n  $product_id = $_POST['product_id'];\n  $quantity = $_POST['quantity'];\n\n  // Check if product exists and user has sufficient balance\n  $sql = \"SELECT price FROM products WHERE id = ?\";\n  $stmt = $conn->prepare($sql);\n  $stmt->bind_param(\"i\", $product_id);\n  $stmt->execute();\n  $result = $stmt->get_result();\n\n  while ($row = $result->fetch_assoc()) {\n    if ($row['price'] > $_SESSION['balance']) {\n      echo \"Insufficient balance\";\n      exit;\n    }\n  }\n\n  // Get user's ID from session\n  $user_id = $_SESSION['id'];\n\n  // Insert order item into database\n  $sql = \"INSERT INTO order_items (order_id, product_id, quantity) VALUES (?, ?, ?)\";\n  $stmt = $conn->prepare($sql);\n  $stmt->bind_param(\"iii\", $order_id, $product_id, $quantity);\n  $stmt->execute();\n\n  // Update user's balance and total\n  $balance = $_SESSION['balance'] - $row['price'];\n  $total = $total + $row['price'];\n\n  $sql = \"UPDATE users SET balance = ? WHERE id = ?\";\n  $stmt = $conn->prepare($sql);\n  $stmt->bind_param(\"di\", $balance, $user_id);\n  $stmt->execute();\n\n  // Create new order\n  $order_sql = \"INSERT INTO orders (customer_name, total) VALUES (?, ?)\";\n  $order_stmt = $conn->prepare($order_sql);\n  $order_stmt->bind_param(\"si\", $customer_name, $total);\n  $order_stmt->execute();\n}\n?>\n\n// index.php: HTML form\n<form action=\"\" method=\"post\">\n  <input type=\"hidden\" name=\"product_id\" value=\"<?php echo $_GET['id']; ?>\">\n  <label>Quantity:</label>\n  <input type=\"number\" name=\"quantity\"><br><br>\n  <input type=\"submit\" name=\"purchase\" value=\"Purchase\">\n</form>\n```\n\n**Usage**\n\n1. The user visits the index.php page with a product ID in the URL query string (`index.php?id=1`).\n2. The user selects a quantity and submits the form.\n3. The PHP script checks if the product exists, if the user has sufficient balance, and updates the user's balance and total accordingly.\n4. A new order item is inserted into the database.\n5. A new order is created.\n\nNote that this is a simplified example and you may want to add additional functionality such as payment processing, taxes, and error handling. Additionally, you should ensure that your database connection settings are secure and follow best practices for web development.", "code_blocks": [null, "```php\n// db.php: database connection settings\n<?php\n$servername = \"localhost\";\n$username = \"username\";\n$password = \"password\";\n$dbname = \"shop\";\n\n$conn = new mysqli($servername, $username, $password, $dbname);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n?>\n\n// index.php: purchase functionality\n<?php\nrequire 'db.php';\n\nif (isset($_POST['purchase'])) {\n  // Get product ID and quantity from form submission\n  $product_id = $_POST['product_id'];\n  $quantity = $_POST['quantity'];\n\n  // Check if product exists and user has sufficient balance\n  $sql = \"SELECT price FROM products WHERE id = ?\";\n  $stmt = $conn->prepare($sql);\n  $stmt->bind_param(\"i\", $product_id);\n  $stmt->execute();\n  $result = $stmt->get_result();\n\n  while ($row = $result->fetch_assoc()) {\n    if ($row['price'] > $_SESSION['balance']) {\n      echo \"Insufficient balance\";\n      exit;\n    }\n  }\n\n  // Get user's ID from session\n  $user_id = $_SESSION['id'];\n\n  // Insert order item into database\n  $sql = \"INSERT INTO order_items (order_id, product_id, quantity) VALUES (?, ?, ?)\";\n  $stmt = $conn->prepare($sql);\n  $stmt->bind_param(\"iii\", $order_id, $product_id, $quantity);\n  $stmt->execute();\n\n  // Update user's balance and total\n  $balance = $_SESSION['balance'] - $row['price'];\n  $total = $total + $row['price'];\n\n  $sql = \"UPDATE users SET balance = ? WHERE id = ?\";\n  $stmt = $conn->prepare($sql);\n  $stmt->bind_param(\"di\", $balance, $user_id);\n  $stmt->execute();\n\n  // Create new order\n  $order_sql = \"INSERT INTO orders (customer_name, total) VALUES (?, ?)\";\n  $order_stmt = $conn->prepare($order_sql);\n  $order_stmt->bind_param(\"si\", $customer_name, $total);\n  $order_stmt->execute();\n}\n?>\n\n// index.php: HTML form\n<form action=\"\" method=\"post\">\n  <input type=\"hidden\" name=\"product_id\" value=\"<?php echo $_GET['id']; ?>\">\n  <label>Quantity:</label>\n  <input type=\"number\" name=\"quantity\"><br><br>\n  <input type=\"submit\" name=\"purchase\" value=\"Purchase\">\n</form>\n```"]}
