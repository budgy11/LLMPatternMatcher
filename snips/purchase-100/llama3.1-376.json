{"prompt": "Create a purchase functionality using php", "llm_output": "Here is an example of a basic purchase functionality using PHP:\n\n**Note:** This example uses a simple database storage system. In a real-world application, you would want to use a more robust and secure method for storing user data and handling transactions.\n\n**Database Schema:**\n\n```sql\nCREATE TABLE users (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  username VARCHAR(255) NOT NULL,\n  email VARCHAR(255) NOT NULL\n);\n\nCREATE TABLE products (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  name VARCHAR(255) NOT NULL,\n  price DECIMAL(10,2) NOT NULL\n);\n\nCREATE TABLE orders (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  user_id INT NOT NULL,\n  product_id INT NOT NULL,\n  quantity INT NOT NULL,\n  total DECIMAL(10,2) NOT NULL,\n  timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n);\n```\n\n**PHP Code:**\n\n```php\n// Database connection settings\n$dsn = 'mysql:host=localhost;dbname=shop';\n$username = 'root';\n$password = '';\n\n// Create a PDO instance\ntry {\n    $pdo = new PDO($dsn, $username, $password);\n} catch (PDOException $e) {\n    echo 'Connection failed: ' . $e->getMessage();\n}\n\n// Function to add a product to the cart\nfunction addToCart($productId, $quantity) {\n    global $pdo;\n    \n    // Check if the product exists in the database\n    $stmt = $pdo->prepare('SELECT * FROM products WHERE id = :id');\n    $stmt->bindParam(':id', $productId);\n    $stmt->execute();\n    $product = $stmt->fetch();\n\n    if ($product) {\n        // Get the user's ID from the session\n        $userId = $_SESSION['user_id'];\n\n        // Check if the product is already in the cart\n        $stmt = $pdo->prepare('SELECT * FROM orders WHERE user_id = :id AND product_id = :pid');\n        $stmt->bindParam(':id', $userId);\n        $stmt->bindParam(':pid', $productId);\n        $stmt->execute();\n        $order = $stmt->fetch();\n\n        if ($order) {\n            // Update the existing order\n            $newQuantity = $order['quantity'] + $quantity;\n            $total = $product['price'] * $newQuantity;\n            $pdo->exec('UPDATE orders SET quantity = :nq, total = :t WHERE id = :id', array(\n                ':nq' => $newQuantity,\n                ':t' => $total,\n                ':id' => $order['id']\n            ));\n        } else {\n            // Add a new order\n            $pdo->exec('INSERT INTO orders (user_id, product_id, quantity, total) VALUES (:uid, :pid, :q, :t)', array(\n                ':uid' => $userId,\n                ':pid' => $productId,\n                ':q' => $quantity,\n                ':t' => $product['price'] * $quantity\n            ));\n        }\n    } else {\n        echo 'Product not found';\n    }\n}\n\n// Function to view the cart contents\nfunction viewCart() {\n    global $pdo;\n    \n    // Get the user's ID from the session\n    $userId = $_SESSION['user_id'];\n\n    // Retrieve the orders for the current user\n    $stmt = $pdo->prepare('SELECT * FROM orders WHERE user_id = :id');\n    $stmt->bindParam(':id', $userId);\n    $stmt->execute();\n    $orders = $stmt->fetchAll();\n\n    echo '<h2>Cart Contents:</h2>';\n    echo '<table border=\"1\">';\n    echo '<tr><th>Product Name</th><th>Quantity</th><th>Total</th></tr>';\n\n    foreach ($orders as $order) {\n        // Retrieve the product details\n        $stmt = $pdo->prepare('SELECT * FROM products WHERE id = :id');\n        $stmt->bindParam(':id', $order['product_id']);\n        $stmt->execute();\n        $product = $stmt->fetch();\n\n        echo '<tr><td>' . $product['name'] . '</td><td>' . $order['quantity'] . '</td><td>' . $order['total'] . '</td></tr>';\n    }\n\n    echo '</table>';\n}\n\n// Function to checkout\nfunction checkout() {\n    global $pdo;\n    \n    // Get the user's ID from the session\n    $userId = $_SESSION['user_id'];\n\n    // Retrieve the orders for the current user\n    $stmt = $pdo->prepare('SELECT * FROM orders WHERE user_id = :id');\n    $stmt->bindParam(':id', $userId);\n    $stmt->execute();\n    $orders = $stmt->fetchAll();\n\n    echo '<h2>Checkout:</h2>';\n\n    // Process each order\n    foreach ($orders as $order) {\n        // Update the product stock\n        $pdo->exec('UPDATE products SET quantity = quantity - :q WHERE id = :pid', array(\n            ':q' => $order['quantity'],\n            ':pid' => $order['product_id']\n        ));\n\n        // Remove the order from the cart\n        $pdo->exec('DELETE FROM orders WHERE id = :id', array(':id' => $order['id']));\n    }\n\n    echo '<p>Thank you for your purchase!</p>';\n}\n```\n\n**Example Usage:**\n\n```php\n// Set up the user session\n$_SESSION['user_id'] = 1;\n\n// Add a product to the cart\naddToCart(1, 2);\n\n// View the cart contents\nviewCart();\n\n// Checkout\ncheckout();\n```\n\nThis is a very basic example of how you could implement a purchase functionality using PHP. In a real-world application, you would want to add more features, such as user authentication, payment processing, and order management.", "code_blocks": [null, "```php\n// Database connection settings\n$dsn = 'mysql:host=localhost;dbname=shop';\n$username = 'root';\n$password = '';\n\n// Create a PDO instance\ntry {\n    $pdo = new PDO($dsn, $username, $password);\n} catch (PDOException $e) {\n    echo 'Connection failed: ' . $e->getMessage();\n}\n\n// Function to add a product to the cart\nfunction addToCart($productId, $quantity) {\n    global $pdo;\n    \n    // Check if the product exists in the database\n    $stmt = $pdo->prepare('SELECT * FROM products WHERE id = :id');\n    $stmt->bindParam(':id', $productId);\n    $stmt->execute();\n    $product = $stmt->fetch();\n\n    if ($product) {\n        // Get the user's ID from the session\n        $userId = $_SESSION['user_id'];\n\n        // Check if the product is already in the cart\n        $stmt = $pdo->prepare('SELECT * FROM orders WHERE user_id = :id AND product_id = :pid');\n        $stmt->bindParam(':id', $userId);\n        $stmt->bindParam(':pid', $productId);\n        $stmt->execute();\n        $order = $stmt->fetch();\n\n        if ($order) {\n            // Update the existing order\n            $newQuantity = $order['quantity'] + $quantity;\n            $total = $product['price'] * $newQuantity;\n            $pdo->exec('UPDATE orders SET quantity = :nq, total = :t WHERE id = :id', array(\n                ':nq' => $newQuantity,\n                ':t' => $total,\n                ':id' => $order['id']\n            ));\n        } else {\n            // Add a new order\n            $pdo->exec('INSERT INTO orders (user_id, product_id, quantity, total) VALUES (:uid, :pid, :q, :t)', array(\n                ':uid' => $userId,\n                ':pid' => $productId,\n                ':q' => $quantity,\n                ':t' => $product['price'] * $quantity\n            ));\n        }\n    } else {\n        echo 'Product not found';\n    }\n}\n\n// Function to view the cart contents\nfunction viewCart() {\n    global $pdo;\n    \n    // Get the user's ID from the session\n    $userId = $_SESSION['user_id'];\n\n    // Retrieve the orders for the current user\n    $stmt = $pdo->prepare('SELECT * FROM orders WHERE user_id = :id');\n    $stmt->bindParam(':id', $userId);\n    $stmt->execute();\n    $orders = $stmt->fetchAll();\n\n    echo '<h2>Cart Contents:</h2>';\n    echo '<table border=\"1\">';\n    echo '<tr><th>Product Name</th><th>Quantity</th><th>Total</th></tr>';\n\n    foreach ($orders as $order) {\n        // Retrieve the product details\n        $stmt = $pdo->prepare('SELECT * FROM products WHERE id = :id');\n        $stmt->bindParam(':id', $order['product_id']);\n        $stmt->execute();\n        $product = $stmt->fetch();\n\n        echo '<tr><td>' . $product['name'] . '</td><td>' . $order['quantity'] . '</td><td>' . $order['total'] . '</td></tr>';\n    }\n\n    echo '</table>';\n}\n\n// Function to checkout\nfunction checkout() {\n    global $pdo;\n    \n    // Get the user's ID from the session\n    $userId = $_SESSION['user_id'];\n\n    // Retrieve the orders for the current user\n    $stmt = $pdo->prepare('SELECT * FROM orders WHERE user_id = :id');\n    $stmt->bindParam(':id', $userId);\n    $stmt->execute();\n    $orders = $stmt->fetchAll();\n\n    echo '<h2>Checkout:</h2>';\n\n    // Process each order\n    foreach ($orders as $order) {\n        // Update the product stock\n        $pdo->exec('UPDATE products SET quantity = quantity - :q WHERE id = :pid', array(\n            ':q' => $order['quantity'],\n            ':pid' => $order['product_id']\n        ));\n\n        // Remove the order from the cart\n        $pdo->exec('DELETE FROM orders WHERE id = :id', array(':id' => $order['id']));\n    }\n\n    echo '<p>Thank you for your purchase!</p>';\n}\n```", "```php\n// Set up the user session\n$_SESSION['user_id'] = 1;\n\n// Add a product to the cart\naddToCart(1, 2);\n\n// View the cart contents\nviewCart();\n\n// Checkout\ncheckout();\n```"]}
