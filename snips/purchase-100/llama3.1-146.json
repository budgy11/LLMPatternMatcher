{"prompt": "Create a purchase functionality using php", "llm_output": "Here is an example of a basic purchase functionality using PHP, MySQL, and HTML. This example assumes you have already set up a database with the following table:\n\n**products**\n\n| id | name | price |\n| --- | --- | --- |\n| 1   | Apple    | 1.99 |\n| 2   | Banana   | 0.99 |\n| 3   | Orange  | 1.49 |\n\n**users**\n\n| id | username | email |\n| --- | --- | --- |\n| 1   | JohnDoe   | johndoe@example.com |\n\n**orders**\n\n| id | user_id | product_id | quantity | total_cost |\n| --- | --- | --- | --- | --- |\n\nWe will create the following PHP files:\n\n* `index.php`: Displaying products and handling form submission\n* `process_purchase.php`: Processing purchase data and updating database\n\n### index.php\n```php\n<?php\n// Include database connection settings\nrequire_once 'db_config.php';\n\n// Get all products from database\n$query = \"SELECT * FROM products\";\n$result = mysqli_query($conn, $query);\n$products = mysqli_fetch_all($result, MYSQLI_ASSOC);\n\n?>\n\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Purchase</title>\n</head>\n<body>\n\n<form action=\"process_purchase.php\" method=\"post\">\n    <?php foreach ($products as $product): ?>\n        <p>\n            <input type=\"checkbox\" id=\"<?= $product['id'] ?>\" name=\"cart[<?= $product['id'] ?>]\">\n            <label for=\"<?= $product['id'] ?>\"> <?= $product['name'] ?> (<?= $product['price'] ?>)</label><br>\n            <select name=\"quantity[<?= $product['id'] ?>]\" id=\"quantity-<?= $product['id'] ?>\">\n                <?php for ($i = 1; $i <= 10; $i++): ?>\n                    <option value=\"<?= $i ?>\" <?= (isset($_SESSION['cart'][$product['id']]) && $_SESSION['cart'][$product['id']] == $i) ? 'selected' : '' ?>><?= $i ?></option>\n                <?php endfor; ?>\n            </select><br>\n        </p>\n    <?php endforeach; ?>\n\n    <input type=\"submit\" value=\"Purchase\">\n</form>\n\n<?php if (isset($_SESSION['cart'])): ?>\n    <h2>Cart:</h2>\n    <ul>\n        <?php foreach ($_SESSION['cart'] as $product_id => $quantity): ?>\n            <li><?= get_product_name($product_id) ?> x <?= $quantity ?></li>\n        <?php endforeach; ?>\n    </ul>\n\n    <p>Total: <?= calculate_total_cost() ?></p>\n<?php endif; ?>\n\n</body>\n</html>\n\n<?php function get_product_name($product_id) {\n    global $conn;\n    $query = \"SELECT name FROM products WHERE id = '$product_id'\";\n    $result = mysqli_query($conn, $query);\n    return mysqli_fetch_assoc($result)['name'];\n}\n\nfunction calculate_total_cost() {\n    global $_SESSION;\n    $total = 0;\n    foreach ($_SESSION['cart'] as $product_id => $quantity) {\n        $query = \"SELECT price FROM products WHERE id = '$product_id'\";\n        $result = mysqli_query($conn, $query);\n        $price = mysqli_fetch_assoc($result)['price'];\n        $total += $price * $quantity;\n    }\n    return $total;\n}\n?>\n```\n### process_purchase.php\n```php\n<?php\n// Include database connection settings\nrequire_once 'db_config.php';\n\n// Get all cart items from session\n$cart = $_SESSION['cart'];\n\n// Loop through each product in the cart\nforeach ($cart as $product_id => $quantity) {\n    // Insert order into database\n    $query = \"INSERT INTO orders (user_id, product_id, quantity, total_cost)\n                VALUES (?, ?, ?, ?)\";\n    $stmt = mysqli_prepare($conn, $query);\n    mysqli_stmt_bind_param($stmt, 'iiss', $_SESSION['user_id'], $product_id, $quantity, calculate_total_cost());\n    mysqli_stmt_execute($stmt);\n\n    // Update product stock\n    $query = \"UPDATE products SET stock = stock - ? WHERE id = ?\";\n    $stmt = mysqli_prepare($conn, $query);\n    mysqli_stmt_bind_param($stmt, 'ii', $quantity, $product_id);\n    mysqli_stmt_execute($stmt);\n}\n\n// Remove cart items from session\n$_SESSION['cart'] = array();\n\n// Redirect user to confirmation page\nheader('Location: thank_you.php');\nexit;\n\nfunction calculate_total_cost() {\n    global $_SESSION;\n    $total = 0;\n    foreach ($_SESSION['cart'] as $product_id => $quantity) {\n        $query = \"SELECT price FROM products WHERE id = '$product_id'\";\n        $result = mysqli_query($conn, $query);\n        $price = mysqli_fetch_assoc($result)['price'];\n        $total += $price * $quantity;\n    }\n    return $total;\n}\n?>\n```\nNote that this is a basic example and you should add more validation and error checking to make it secure. Additionally, you may want to consider using a more advanced payment gateway instead of just storing the order in your database.\n\nAlso, don't forget to replace `db_config.php` with your actual database connection settings.", "code_blocks": ["```php\n<?php\n// Include database connection settings\nrequire_once 'db_config.php';\n\n// Get all products from database\n$query = \"SELECT * FROM products\";\n$result = mysqli_query($conn, $query);\n$products = mysqli_fetch_all($result, MYSQLI_ASSOC);\n\n?>\n\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Purchase</title>\n</head>\n<body>\n\n<form action=\"process_purchase.php\" method=\"post\">\n    <?php foreach ($products as $product): ?>\n        <p>\n            <input type=\"checkbox\" id=\"<?= $product['id'] ?>\" name=\"cart[<?= $product['id'] ?>]\">\n            <label for=\"<?= $product['id'] ?>\"> <?= $product['name'] ?> (<?= $product['price'] ?>)</label><br>\n            <select name=\"quantity[<?= $product['id'] ?>]\" id=\"quantity-<?= $product['id'] ?>\">\n                <?php for ($i = 1; $i <= 10; $i++): ?>\n                    <option value=\"<?= $i ?>\" <?= (isset($_SESSION['cart'][$product['id']]) && $_SESSION['cart'][$product['id']] == $i) ? 'selected' : '' ?>><?= $i ?></option>\n                <?php endfor; ?>\n            </select><br>\n        </p>\n    <?php endforeach; ?>\n\n    <input type=\"submit\" value=\"Purchase\">\n</form>\n\n<?php if (isset($_SESSION['cart'])): ?>\n    <h2>Cart:</h2>\n    <ul>\n        <?php foreach ($_SESSION['cart'] as $product_id => $quantity): ?>\n            <li><?= get_product_name($product_id) ?> x <?= $quantity ?></li>\n        <?php endforeach; ?>\n    </ul>\n\n    <p>Total: <?= calculate_total_cost() ?></p>\n<?php endif; ?>\n\n</body>\n</html>\n\n<?php function get_product_name($product_id) {\n    global $conn;\n    $query = \"SELECT name FROM products WHERE id = '$product_id'\";\n    $result = mysqli_query($conn, $query);\n    return mysqli_fetch_assoc($result)['name'];\n}\n\nfunction calculate_total_cost() {\n    global $_SESSION;\n    $total = 0;\n    foreach ($_SESSION['cart'] as $product_id => $quantity) {\n        $query = \"SELECT price FROM products WHERE id = '$product_id'\";\n        $result = mysqli_query($conn, $query);\n        $price = mysqli_fetch_assoc($result)['price'];\n        $total += $price * $quantity;\n    }\n    return $total;\n}\n?>\n```", "```php\n<?php\n// Include database connection settings\nrequire_once 'db_config.php';\n\n// Get all cart items from session\n$cart = $_SESSION['cart'];\n\n// Loop through each product in the cart\nforeach ($cart as $product_id => $quantity) {\n    // Insert order into database\n    $query = \"INSERT INTO orders (user_id, product_id, quantity, total_cost)\n                VALUES (?, ?, ?, ?)\";\n    $stmt = mysqli_prepare($conn, $query);\n    mysqli_stmt_bind_param($stmt, 'iiss', $_SESSION['user_id'], $product_id, $quantity, calculate_total_cost());\n    mysqli_stmt_execute($stmt);\n\n    // Update product stock\n    $query = \"UPDATE products SET stock = stock - ? WHERE id = ?\";\n    $stmt = mysqli_prepare($conn, $query);\n    mysqli_stmt_bind_param($stmt, 'ii', $quantity, $product_id);\n    mysqli_stmt_execute($stmt);\n}\n\n// Remove cart items from session\n$_SESSION['cart'] = array();\n\n// Redirect user to confirmation page\nheader('Location: thank_you.php');\nexit;\n\nfunction calculate_total_cost() {\n    global $_SESSION;\n    $total = 0;\n    foreach ($_SESSION['cart'] as $product_id => $quantity) {\n        $query = \"SELECT price FROM products WHERE id = '$product_id'\";\n        $result = mysqli_query($conn, $query);\n        $price = mysqli_fetch_assoc($result)['price'];\n        $total += $price * $quantity;\n    }\n    return $total;\n}\n?>\n```"]}
