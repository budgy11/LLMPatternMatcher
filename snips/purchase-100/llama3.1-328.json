{"prompt": "Create a purchase functionality using php", "llm_output": "**Purchase Functionality in PHP**\n\nBelow is an example of how to implement a basic purchase functionality using PHP. This will include creating a user, adding items to cart, viewing cart contents, and making the actual purchase.\n\n### Database Setup\n\nBefore we start with the code, let's set up our database schema.\n\n```sql\nCREATE TABLE users (\n    id INT AUTO_INCREMENT,\n    name VARCHAR(255),\n    email VARCHAR(255) PRIMARY KEY\n);\n\nCREATE TABLE products (\n    id INT AUTO_INCREMENT,\n    name VARCHAR(255),\n    price DECIMAL(10,2)\n);\n\nCREATE TABLE cart (\n    id INT AUTO_INCREMENT,\n    user_id INT,\n    product_id INT,\n    quantity INT,\n    FOREIGN KEY (user_id) REFERENCES users(id),\n    FOREIGN KEY (product_id) REFERENCES products(id)\n);\n```\n\n### PHP Code\n\n```php\n// database connection details\n$servername = \"localhost\";\n$username = \"root\";\n$password = \"\";\n$dbname = \"store\";\n\n// create a new mysqli object with the database connection parameters\n$conn = new mysqli($servername, $username, $password, $dbname);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\nfunction createUser() {\n    global $conn;\n    \n    // get user details from form input\n    $name = $_POST['name'];\n    $email = $_POST['email'];\n\n    // insert new user into database\n    $sql = \"INSERT INTO users (name, email) VALUES ('$name', '$email')\";\n    if ($conn->query($sql)) {\n        echo \"User created successfully!\";\n    } else {\n        echo \"Error creating user: \" . $conn->error;\n    }\n}\n\nfunction viewCart() {\n    global $conn;\n    \n    // get the current logged in user's id\n    $user_id = $_SESSION['user_id'];\n\n    // fetch all products from cart for this user\n    $sql = \"SELECT p.id, p.name, c.quantity FROM cart c INNER JOIN products p ON c.product_id=p.id WHERE c.user_id='$user_id'\";\n    $result = $conn->query($sql);\n\n    if ($result->num_rows > 0) {\n        echo \"<table><tr><th>Product ID</th><th>Product Name</th><th>Quantity</th></tr>\";\n        while($row = $result->fetch_assoc()) {\n            echo \"<tr><td>\" . $row[\"id\"] . \"</td><td>\" . $row[\"name\"] . \"</td><td>\" . $row[\"quantity\"] . \"</td></tr>\";\n        }\n        echo \"</table>\";\n    } else {\n        echo \"Cart is empty.\";\n    }\n}\n\nfunction purchase() {\n    global $conn;\n    \n    // get the current logged in user's id\n    $user_id = $_SESSION['user_id'];\n\n    // fetch all products from cart for this user\n    $sql = \"SELECT * FROM cart WHERE user_id='$user_id'\";\n    $result = $conn->query($sql);\n\n    if ($result->num_rows > 0) {\n        while($row = $result->fetch_assoc()) {\n            // remove the product from the cart and add it to the purchase history\n            $sql = \"INSERT INTO purchase_history (product_id, quantity, user_id) VALUES ('$row[id]', '$row[quantity]', '$user_id')\";\n            if ($conn->query($sql)) {\n                echo \"Product purchased successfully!\";\n            } else {\n                echo \"Error purchasing product: \" . $conn->error;\n            }\n        }\n\n        // empty the cart after purchase\n        $sql = \"TRUNCATE TABLE cart\";\n        if ($conn->query($sql)) {\n            echo \"Cart emptied successfully!\";\n        } else {\n            echo \"Error emptying cart: \" . $conn->error;\n        }\n    } else {\n        echo \"No products to purchase.\";\n    }\n}\n\n// create a session for the logged in user\nsession_start();\n\n// handle user creation\nif (isset($_POST['create_user'])) {\n    createUser();\n}\n\n// handle viewing of cart\nif (isset($_GET['view_cart'])) {\n    viewCart();\n}\n\n// handle making a purchase\nif (isset($_GET['purchase'])) {\n    purchase();\n}\n```\n\n### HTML Code\n\n```html\n<!-- index.php for user creation -->\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Document</title>\n</head>\n<body>\n\n<h1>Create User</h1>\n<form action=\"\" method=\"post\">\n    <input type=\"text\" name=\"name\"><br><br>\n    <input type=\"email\" name=\"email\"><br><br>\n    <input type=\"submit\" name=\"create_user\" value=\"Create User\">\n</form>\n\n</body>\n</html>\n\n<!-- view_cart.php for viewing cart -->\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Document</title>\n</head>\n<body>\n\n<h1>View Cart</h1>\n<a href=\"?view_cart\">View Cart</a>\n\n<!-- display cart contents here -->\n<?php include_once 'view_cart.php'; ?>\n\n</body>\n</html>\n\n<!-- purchase.php for making a purchase -->\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Document</title>\n</head>\n<body>\n\n<h1>Purchase</h1>\n<a href=\"?purchase\">Make Purchase</a>\n\n<!-- display purchase confirmation here -->\n<?php include_once 'purchase.php'; ?>\n\n</body>\n</html>\n```\n\nNote: This is a basic implementation and does not cover all possible error scenarios. Also, please keep in mind that this code assumes you're already familiar with the basics of PHP, HTML, and MySQL.", "code_blocks": [null, "```php\n// database connection details\n$servername = \"localhost\";\n$username = \"root\";\n$password = \"\";\n$dbname = \"store\";\n\n// create a new mysqli object with the database connection parameters\n$conn = new mysqli($servername, $username, $password, $dbname);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\nfunction createUser() {\n    global $conn;\n    \n    // get user details from form input\n    $name = $_POST['name'];\n    $email = $_POST['email'];\n\n    // insert new user into database\n    $sql = \"INSERT INTO users (name, email) VALUES ('$name', '$email')\";\n    if ($conn->query($sql)) {\n        echo \"User created successfully!\";\n    } else {\n        echo \"Error creating user: \" . $conn->error;\n    }\n}\n\nfunction viewCart() {\n    global $conn;\n    \n    // get the current logged in user's id\n    $user_id = $_SESSION['user_id'];\n\n    // fetch all products from cart for this user\n    $sql = \"SELECT p.id, p.name, c.quantity FROM cart c INNER JOIN products p ON c.product_id=p.id WHERE c.user_id='$user_id'\";\n    $result = $conn->query($sql);\n\n    if ($result->num_rows > 0) {\n        echo \"<table><tr><th>Product ID</th><th>Product Name</th><th>Quantity</th></tr>\";\n        while($row = $result->fetch_assoc()) {\n            echo \"<tr><td>\" . $row[\"id\"] . \"</td><td>\" . $row[\"name\"] . \"</td><td>\" . $row[\"quantity\"] . \"</td></tr>\";\n        }\n        echo \"</table>\";\n    } else {\n        echo \"Cart is empty.\";\n    }\n}\n\nfunction purchase() {\n    global $conn;\n    \n    // get the current logged in user's id\n    $user_id = $_SESSION['user_id'];\n\n    // fetch all products from cart for this user\n    $sql = \"SELECT * FROM cart WHERE user_id='$user_id'\";\n    $result = $conn->query($sql);\n\n    if ($result->num_rows > 0) {\n        while($row = $result->fetch_assoc()) {\n            // remove the product from the cart and add it to the purchase history\n            $sql = \"INSERT INTO purchase_history (product_id, quantity, user_id) VALUES ('$row[id]', '$row[quantity]', '$user_id')\";\n            if ($conn->query($sql)) {\n                echo \"Product purchased successfully!\";\n            } else {\n                echo \"Error purchasing product: \" . $conn->error;\n            }\n        }\n\n        // empty the cart after purchase\n        $sql = \"TRUNCATE TABLE cart\";\n        if ($conn->query($sql)) {\n            echo \"Cart emptied successfully!\";\n        } else {\n            echo \"Error emptying cart: \" . $conn->error;\n        }\n    } else {\n        echo \"No products to purchase.\";\n    }\n}\n\n// create a session for the logged in user\nsession_start();\n\n// handle user creation\nif (isset($_POST['create_user'])) {\n    createUser();\n}\n\n// handle viewing of cart\nif (isset($_GET['view_cart'])) {\n    viewCart();\n}\n\n// handle making a purchase\nif (isset($_GET['purchase'])) {\n    purchase();\n}\n```", null]}
