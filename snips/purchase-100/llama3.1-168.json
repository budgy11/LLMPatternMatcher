{"prompt": "Create a purchase functionality using php", "llm_output": "Here is an example of a simple purchase functionality using PHP, MySQL, and HTML. This example includes user registration, login, adding items to cart, and checking out.\n\n**Database Schema:**\n\nWe will need two tables in our database: `users` and `products`.\n\n```sql\nCREATE TABLE users (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  username VARCHAR(255) NOT NULL,\n  email VARCHAR(255) NOT NULL,\n  password VARCHAR(255) NOT NULL\n);\n\nCREATE TABLE products (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  name VARCHAR(255) NOT NULL,\n  price DECIMAL(10,2) NOT NULL\n);\n```\n\n**PHP Code:**\n\n### `config.php`:\n\n```php\n<?php\n\n// Database configuration\ndefine('DB_HOST', 'localhost');\ndefine('DB_USERNAME', 'root');\ndefine('DB_PASSWORD', '');\ndefine('DB_NAME', 'store');\n\n// Connect to database\n$conn = new mysqli(DB_HOST, DB_USERNAME, DB_PASSWORD, DB_NAME);\n\nif ($conn->connect_error) {\n  die(\"Connection failed: \" . $conn->connect_error);\n}\n\n?>\n```\n\n### `register.php`:\n\n```php\n<?php\nrequire_once 'config.php';\n\nif (isset($_POST['username']) && isset($_POST['email']) && isset($_POST['password'])) {\n  $username = $_POST['username'];\n  $email = $_POST['email'];\n  $password = password_hash($_POST['password'], PASSWORD_DEFAULT);\n\n  $query = \"INSERT INTO users SET username='$username', email='$email', password='$password'\";\n  $conn->query($query);\n}\n\n?>\n\n<!DOCTYPE html>\n<html>\n<head>\n  <title>Register</title>\n</head>\n<body>\n\n<form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\">\n  Username: <input type=\"text\" name=\"username\"><br><br>\n  Email: <input type=\"email\" name=\"email\"><br><br>\n  Password: <input type=\"password\" name=\"password\"><br><br>\n  <input type=\"submit\" value=\"Register\">\n</form>\n\n</body>\n</html>\n```\n\n### `login.php`:\n\n```php\n<?php\nrequire_once 'config.php';\n\nif (isset($_POST['username']) && isset($_POST['password'])) {\n  $username = $_POST['username'];\n  $password = $_POST['password'];\n\n  $query = \"SELECT * FROM users WHERE username='$username' AND password='\".password_verify($password, get_password_from_database()).\"'\";\n  $result = $conn->query($query);\n\n  if ($result->num_rows > 0) {\n    session_start();\n    $_SESSION['username'] = $username;\n    header('Location: index.php');\n  } else {\n    echo 'Invalid username or password';\n  }\n}\n\n?>\n\n<!DOCTYPE html>\n<html>\n<head>\n  <title>Login</title>\n</head>\n<body>\n\n<form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\">\n  Username: <input type=\"text\" name=\"username\"><br><br>\n  Password: <input type=\"password\" name=\"password\"><br><br>\n  <input type=\"submit\" value=\"Login\">\n</form>\n\n</body>\n</html>\n```\n\n### `index.php`:\n\n```php\n<?php\nrequire_once 'config.php';\n\n// Get products from database\n$query = \"SELECT * FROM products\";\n$result = $conn->query($query);\n\n?>\n\n<!DOCTYPE html>\n<html>\n<head>\n  <title>Index</title>\n</head>\n<body>\n\n<h1>Welcome, <?php echo $_SESSION['username']; ?></h1>\n\n<!-- Display products -->\n<table border=\"1\">\n  <tr>\n    <th>Name</th>\n    <th>Price</th>\n  </tr>\n  <?php while ($row = $result->fetch_assoc()) { ?>\n  <tr>\n    <td><?php echo $row['name']; ?></td>\n    <td><?php echo $row['price']; ?></td>\n  </tr>\n  <?php } ?>\n</table>\n\n<!-- Add to cart form -->\n<form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\">\n  Product ID: <input type=\"text\" name=\"product_id\"><br><br>\n  Quantity: <input type=\"number\" name=\"quantity\"><br><br>\n  <input type=\"submit\" value=\"Add to Cart\">\n</form>\n\n<!-- Display cart -->\n<h2>Cart:</h2>\n<table border=\"1\">\n  <?php\n  if (isset($_SESSION['cart'])) {\n    $cart = $_SESSION['cart'];\n    foreach ($cart as $item) {\n      echo \"<tr><td>\" . $item['name'] . \"</td><td>\" . $item['price'] . \" x \" . $item['quantity'] . \"</td></tr>\";\n    }\n  }\n  ?>\n</table>\n\n</body>\n</html>\n```\n\n### `cart.php`:\n\n```php\n<?php\nrequire_once 'config.php';\n\n// Update cart in session\nif (isset($_POST['product_id']) && isset($_POST['quantity'])) {\n  $product_id = $_POST['product_id'];\n  $quantity = $_POST['quantity'];\n\n  if (!isset($_SESSION['cart'])) {\n    $_SESSION['cart'] = array();\n  }\n\n  // Check if product is already in cart\n  foreach ($_SESSION['cart'] as &$item) {\n    if ($item['id'] == $product_id) {\n      $item['quantity'] += $quantity;\n      break;\n    }\n  }\n\n  // Add product to cart if not already there\n  else {\n    $_SESSION['cart'][] = array('id' => $product_id, 'name' => get_product_name_from_database($product_id), 'price' => get_product_price_from_database($product_id), 'quantity' => $quantity);\n  }\n}\n\n?>\n\n<!DOCTYPE html>\n<html>\n<head>\n  <title>Cart</title>\n</head>\n<body>\n\n<h1>Cart:</h1>\n\n<!-- Display cart -->\n<table border=\"1\">\n  <?php\n  if (isset($_SESSION['cart'])) {\n    foreach ($_SESSION['cart'] as $item) {\n      echo \"<tr><td>\" . $item['name'] . \"</td><td>\" . $item['price'] . \" x \" . $item['quantity'] . \"</td></tr>\";\n    }\n  }\n  ?>\n</table>\n\n<!-- Checkout form -->\n<form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\">\n  <input type=\"submit\" value=\"Checkout\">\n</form>\n\n</body>\n</html>\n```\n\n### `checkout.php`:\n\n```php\n<?php\nrequire_once 'config.php';\n\n// Process checkout\nif (isset($_POST['cart'])) {\n  $cart = $_SESSION['cart'];\n\n  // Calculate total cost\n  $total_cost = 0;\n  foreach ($cart as $item) {\n    $total_cost += $item['price'] * $item['quantity'];\n  }\n\n  // Update database with order details\n  $query = \"INSERT INTO orders SET username='\" . $_SESSION['username'] . \"', total_cost=\" . $total_cost;\n  $conn->query($query);\n\n  // Clear cart session variable\n  unset($_SESSION['cart']);\n}\n\n?>\n\n<!DOCTYPE html>\n<html>\n<head>\n  <title>Checkout</title>\n</head>\n<body>\n\n<h1>Checkout:</h1>\n\n<!-- Display order summary -->\n<table border=\"1\">\n  <?php\n  if (isset($_POST['cart'])) {\n    echo \"<tr><td>Total Cost:</td><td>\" . $total_cost . \"</td></tr>\";\n  }\n  ?>\n</table>\n\n<!-- Process payment form -->\n<form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\">\n  <input type=\"submit\" value=\"Process Payment\">\n</form>\n\n</body>\n</html>\n```\n\nThis is a basic example of how you can create a purchase functionality using PHP. You may need to modify the code based on your specific requirements.\n\n**Note:** This example does not include any security measures such as CSRF protection, input validation, or prepared statements. In a production environment, you should always use these best practices to prevent SQL injection and other types of attacks.", "code_blocks": [null, "```php\n<?php\n\n// Database configuration\ndefine('DB_HOST', 'localhost');\ndefine('DB_USERNAME', 'root');\ndefine('DB_PASSWORD', '');\ndefine('DB_NAME', 'store');\n\n// Connect to database\n$conn = new mysqli(DB_HOST, DB_USERNAME, DB_PASSWORD, DB_NAME);\n\nif ($conn->connect_error) {\n  die(\"Connection failed: \" . $conn->connect_error);\n}\n\n?>\n```", "```php\n<?php\nrequire_once 'config.php';\n\nif (isset($_POST['username']) && isset($_POST['email']) && isset($_POST['password'])) {\n  $username = $_POST['username'];\n  $email = $_POST['email'];\n  $password = password_hash($_POST['password'], PASSWORD_DEFAULT);\n\n  $query = \"INSERT INTO users SET username='$username', email='$email', password='$password'\";\n  $conn->query($query);\n}\n\n?>\n\n<!DOCTYPE html>\n<html>\n<head>\n  <title>Register</title>\n</head>\n<body>\n\n<form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\">\n  Username: <input type=\"text\" name=\"username\"><br><br>\n  Email: <input type=\"email\" name=\"email\"><br><br>\n  Password: <input type=\"password\" name=\"password\"><br><br>\n  <input type=\"submit\" value=\"Register\">\n</form>\n\n</body>\n</html>\n```", "```php\n<?php\nrequire_once 'config.php';\n\nif (isset($_POST['username']) && isset($_POST['password'])) {\n  $username = $_POST['username'];\n  $password = $_POST['password'];\n\n  $query = \"SELECT * FROM users WHERE username='$username' AND password='\".password_verify($password, get_password_from_database()).\"'\";\n  $result = $conn->query($query);\n\n  if ($result->num_rows > 0) {\n    session_start();\n    $_SESSION['username'] = $username;\n    header('Location: index.php');\n  } else {\n    echo 'Invalid username or password';\n  }\n}\n\n?>\n\n<!DOCTYPE html>\n<html>\n<head>\n  <title>Login</title>\n</head>\n<body>\n\n<form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\">\n  Username: <input type=\"text\" name=\"username\"><br><br>\n  Password: <input type=\"password\" name=\"password\"><br><br>\n  <input type=\"submit\" value=\"Login\">\n</form>\n\n</body>\n</html>\n```", "```php\n<?php\nrequire_once 'config.php';\n\n// Get products from database\n$query = \"SELECT * FROM products\";\n$result = $conn->query($query);\n\n?>\n\n<!DOCTYPE html>\n<html>\n<head>\n  <title>Index</title>\n</head>\n<body>\n\n<h1>Welcome, <?php echo $_SESSION['username']; ?></h1>\n\n<!-- Display products -->\n<table border=\"1\">\n  <tr>\n    <th>Name</th>\n    <th>Price</th>\n  </tr>\n  <?php while ($row = $result->fetch_assoc()) { ?>\n  <tr>\n    <td><?php echo $row['name']; ?></td>\n    <td><?php echo $row['price']; ?></td>\n  </tr>\n  <?php } ?>\n</table>\n\n<!-- Add to cart form -->\n<form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\">\n  Product ID: <input type=\"text\" name=\"product_id\"><br><br>\n  Quantity: <input type=\"number\" name=\"quantity\"><br><br>\n  <input type=\"submit\" value=\"Add to Cart\">\n</form>\n\n<!-- Display cart -->\n<h2>Cart:</h2>\n<table border=\"1\">\n  <?php\n  if (isset($_SESSION['cart'])) {\n    $cart = $_SESSION['cart'];\n    foreach ($cart as $item) {\n      echo \"<tr><td>\" . $item['name'] . \"</td><td>\" . $item['price'] . \" x \" . $item['quantity'] . \"</td></tr>\";\n    }\n  }\n  ?>\n</table>\n\n</body>\n</html>\n```", "```php\n<?php\nrequire_once 'config.php';\n\n// Update cart in session\nif (isset($_POST['product_id']) && isset($_POST['quantity'])) {\n  $product_id = $_POST['product_id'];\n  $quantity = $_POST['quantity'];\n\n  if (!isset($_SESSION['cart'])) {\n    $_SESSION['cart'] = array();\n  }\n\n  // Check if product is already in cart\n  foreach ($_SESSION['cart'] as &$item) {\n    if ($item['id'] == $product_id) {\n      $item['quantity'] += $quantity;\n      break;\n    }\n  }\n\n  // Add product to cart if not already there\n  else {\n    $_SESSION['cart'][] = array('id' => $product_id, 'name' => get_product_name_from_database($product_id), 'price' => get_product_price_from_database($product_id), 'quantity' => $quantity);\n  }\n}\n\n?>\n\n<!DOCTYPE html>\n<html>\n<head>\n  <title>Cart</title>\n</head>\n<body>\n\n<h1>Cart:</h1>\n\n<!-- Display cart -->\n<table border=\"1\">\n  <?php\n  if (isset($_SESSION['cart'])) {\n    foreach ($_SESSION['cart'] as $item) {\n      echo \"<tr><td>\" . $item['name'] . \"</td><td>\" . $item['price'] . \" x \" . $item['quantity'] . \"</td></tr>\";\n    }\n  }\n  ?>\n</table>\n\n<!-- Checkout form -->\n<form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\">\n  <input type=\"submit\" value=\"Checkout\">\n</form>\n\n</body>\n</html>\n```", "```php\n<?php\nrequire_once 'config.php';\n\n// Process checkout\nif (isset($_POST['cart'])) {\n  $cart = $_SESSION['cart'];\n\n  // Calculate total cost\n  $total_cost = 0;\n  foreach ($cart as $item) {\n    $total_cost += $item['price'] * $item['quantity'];\n  }\n\n  // Update database with order details\n  $query = \"INSERT INTO orders SET username='\" . $_SESSION['username'] . \"', total_cost=\" . $total_cost;\n  $conn->query($query);\n\n  // Clear cart session variable\n  unset($_SESSION['cart']);\n}\n\n?>\n\n<!DOCTYPE html>\n<html>\n<head>\n  <title>Checkout</title>\n</head>\n<body>\n\n<h1>Checkout:</h1>\n\n<!-- Display order summary -->\n<table border=\"1\">\n  <?php\n  if (isset($_POST['cart'])) {\n    echo \"<tr><td>Total Cost:</td><td>\" . $total_cost . \"</td></tr>\";\n  }\n  ?>\n</table>\n\n<!-- Process payment form -->\n<form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\">\n  <input type=\"submit\" value=\"Process Payment\">\n</form>\n\n</body>\n</html>\n```"]}
