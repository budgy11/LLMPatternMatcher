{"prompt": "Create a purchase functionality using php", "llm_output": "<think>\nOkay, so the user wants to create a purchase functionality using PHP. Let me think about how to approach this.\n\nFirst, I need to understand what exactly they're looking for. Purchase functionality typically involves allowing users to add items to a cart and then checkout. So, I should probably cover both adding products and processing the order.\n\nI'll start by setting up a basic structure. Maybe create separate pages: one for displaying products, another for the shopping cart, and a third for confirming the purchase.\n\nFor the products page, I can hardcode some example items to keep it simple. Each product should have an \"Add to Cart\" button that sends its details to the cart page. Using POST method makes sense here because we're sending data.\n\nNext, the cart functionality. I'll need to store the cart contents somewhere. Since this is a basic example, using sessions seems appropriate because they persist across pages and are easy to manage. So, when a user adds an item, it's stored in the session array.\n\nI should display the cart items on the cart page, showing quantity, price, and a remove button. Also, calculate the total price by looping through each item. Including an \"Update Cart\" button allows users to adjust quantities or remove items without reloading the page, but for simplicity, maybe just handle removal with links.\n\nThen, moving on to checkout. The user needs to enter their details: name, email, and address. I'll create a form that POSTs this data along with the cart contents to another PHP script. That script will handle saving the order, probably in a database, and then display a confirmation message.\n\nFor the database part, using MySQL is standard. I'll need two tables: one for orders containing user details and total price, and another for order items linking each product to the order. This way, we can track what was purchased with which order.\n\nSecurity is important, so I should mention sanitizing inputs and using prepared statements to prevent SQL injection. Also, form validation on both client and server sides will ensure data integrity.\n\nI should also think about error handling. What if the database insertion fails? The user should get an appropriate message. Maybe display a confirmation number upon success.\n\nPutting it all together, I'll outline each step: displaying products, adding to cart via sessions, showing the cart with total, processing checkout by saving to the database, and confirming the purchase.\n\nI need to make sure the code is clear and well-commented so the user can follow along. Maybe include notes on how they can extend this functionality in the future, like adding a real product list or payment integration.\n\nOverall, the goal is to provide a straightforward example that covers all necessary aspects of a basic purchase system using PHP.\n</think>\n\nHere's an example of a simple purchase functionality using PHP:\n\nThis example includes:\n1. Displaying products\n2. Adding items to cart\n3. Cart management\n4. Checkout process\n\n```php\n<?php\n// Include configuration file\ninclude('config.php');\n\n// Products page\nif ($_SERVER['PHP_SELF'] == '/products.php') {\n    // Retrieve all products from database\n    $sql = \"SELECT * FROM products\";\n    $result = mysqli_query($conn, $sql);\n    \n    echo \"<h2>Our Products</h2>\";\n    while ($row = mysqli_fetch_assoc($result)) {\n        echo \"<div class='product'>\";\n        echo \"<h3>{$row['name']}</h3>\";\n        echo \"<p>Price: \\${$row['price']}</p>\";\n        echo \"<form action='cart.php' method='post'>\";\n        echo \"<input type='hidden' name='id' value='{$row['id']}'>\";\n        echo \"<input type='hidden' name='name' value='{$row['name']}'>\";\n        echo \"<input type='hidden' name='price' value='{$row['price']}'>\";\n        echo \"<button type='submit'>Add to Cart</button>\";\n        echo \"</form>\";\n        echo \"</div>\";\n    }\n}\n\n// Cart page\nelseif ($_SERVER['PHP_SELF'] == '/cart.php') {\n    session_start();\n    \n    // Add item to cart\n    if ($_SERVER['REQUEST_METHOD'] == 'POST') {\n        $item = array(\n            'id' => $_POST['id'],\n            'name' => $_POST['name'],\n            'price' => $_POST['price'],\n            'quantity' => 1\n        );\n        \n        if (isset($_SESSION['cart'])) {\n            $found = false;\n            foreach ($_SESSION['cart'] as &$item) {\n                if ($item['id'] == $_POST['id']) {\n                    $item['quantity']++;\n                    $found = true;\n                }\n            }\n            if (!$found) {\n                array_push($_SESSION['cart'], $item);\n            }\n        } else {\n            $_SESSION['cart'] = array($item);\n        }\n    }\n    \n    // Update cart\n    elseif (isset($_GET['action']) && $_GET['action'] == 'update') {\n        foreach ($_SESSION['cart'] as &$item) {\n            if ($item['id'] == $_POST['id']) {\n                $item['quantity'] = $_POST['quantity'];\n            }\n        }\n    }\n    \n    // Remove item from cart\n    elseif (isset($_GET['action']) && $_GET['action'] == 'remove') {\n        foreach ($_SESSION['cart'] as &$item) {\n            if ($item['id'] == $_GET['id']) {\n                unset($_SESSION['cart'][$key]);\n            }\n        }\n    }\n    \n    // Display cart\n    echo \"<h2>Your Cart</h2>\";\n    if (isset($_SESSION['cart'])) {\n        $total = 0;\n        foreach ($_SESSION['cart'] as $item) {\n            echo \"<div class='cart-item'>\";\n            echo \"<p>{$item['name']}</p>\";\n            echo \"<p>Quantity: {$item['quantity']}</p>\";\n            echo \"<p>Price: \\${$item['price']} each</p>\";\n            echo \"<form action='cart.php?action=update' method='post'>\";\n            echo \"<input type='hidden' name='id' value='{$item['id']}'>\";\n            echo \"<input type='number' name='quantity' min='1' max='10' value='{$item['quantity']}'>\";\n            echo \"<button type='submit'>Update</button>\";\n            echo \"</form>\";\n            echo \"<a href='cart.php?action=remove&id={$item['id']}'>Remove</a>\";\n            echo \"</div>\";\n            $total += $item['price'] * $item['quantity'];\n        }\n        echo \"<h3>Total: \\${$total}</h3>\";\n        echo \"<a href='checkout.php'>Proceed to Checkout</a>\";\n    } else {\n        echo \"Your cart is empty.\";\n    }\n}\n\n// Checkout page\nelseif ($_SERVER['PHP_SELF'] == '/checkout.php') {\n    session_start();\n    \n    if (isset($_SESSION['cart'])) {\n        // Display checkout form\n        echo \"<h2>Checkout</h2>\";\n        echo \"<form action='purchase.php' method='post'>\";\n        echo \"<label for='name'>Name:</label>\";\n        echo \"<input type='text' id='name' name='name' required><br>\";\n        echo \"<label for='email'>Email:</label>\";\n        echo \"<input type='email' id='email' name='email' required><br>\";\n        echo \"<label for='address'>Address:</label>\";\n        echo \"<input type='text' id='address' name='address' required><br>\";\n        \n        // Hide cart details\n        foreach ($_SESSION['cart'] as $item) {\n            echo \"<input type='hidden' name='items[]' value='{$item['id']}'>\";\n            echo \"<input type='hidden' name='quantities[]' value='{$item['quantity']}'>\";\n        }\n        \n        echo \"<button type='submit'>Place Order</button>\";\n        echo \"</form>\";\n    } else {\n        echo \"Your cart is empty.\";\n    }\n}\n\n// Purchase confirmation\nelseif ($_SERVER['PHP_SELF'] == '/purchase.php') {\n    session_start();\n    \n    if (isset($_POST)) {\n        // Calculate total price\n        $total = 0;\n        foreach ($_SESSION['cart'] as $item) {\n            $total += $item['price'] * $item['quantity'];\n        }\n        \n        // Insert order into database\n        $sql = \"INSERT INTO orders (name, email, address, total_price) VALUES (?, ?, ?, ?)\";\n        $stmt = mysqli_prepare($conn, $sql);\n        mysqli_stmt_bind_param($stmt, \"sssd\", $_POST['name'], $_POST['email'], $_POST['address'], $total);\n        mysqli_stmt_execute($stmt);\n        \n        // Get order ID\n        $order_id = mysqli_insert_id($conn);\n        \n        // Insert order items into database\n        foreach ($_SESSION['cart'] as $item) {\n            $sql = \"INSERT INTO order_items (order_id, product_id, quantity) VALUES (?, ?, ?)\";\n            $stmt = mysqli_prepare($conn, $sql);\n            mysqli_stmt_bind_param($stmt, \"iii\", $order_id, $item['id'], $item['quantity']);\n            mysqli_stmt_execute($stmt);\n        }\n        \n        // Clear cart\n        unset($_SESSION['cart']);\n        \n        // Display confirmation message\n        echo \"<h2>Thank you for your purchase!</h2>\";\n        echo \"<p>Your order number is #{$order_id}</p>\";\n    }\n}\n?>\n```\n\nThis code includes:\n\n1. `products.php`: Displays available products with \"Add to Cart\" buttons.\n\n2. `cart.php`: \n   - Adds items to cart\n   - Updates item quantities\n   - Removes items from cart\n   - Shows current cart contents and total price\n\n3. `checkout.php`: Shows checkout form where users can enter their details before placing the order\n\n4. `purchase.php`: Processes the purchase, saves order information to database, and shows confirmation message\n\nTo use this code:\n\n1. Make sure you have a MySQL database with these tables:\n   - `products` table with columns: id, name, price\n   - `orders` table with columns: id, name, email, address, total_price, order_date\n   - `order_items` table with columns: id, order_id, product_id, quantity\n\n2. Configure the database connection in your config.php file.\n\n3. Add some sample products to your database.\n\nFeatures:\n- Multiple product selection\n- Quantity adjustment\n- Cart removal functionality\n- Order confirmation\n- Database storage of orders and items\n\nNote: This is a basic implementation and you should add:\n- Input validation\n- Error handling\n- Secure payment processing (e.g., PayPal, Stripe)\n- User authentication\n- Product images\n- More detailed order tracking\n\nRemember to sanitize all user inputs and use prepared statements to prevent SQL injection.", "code_blocks": ["```php\n<?php\n// Include configuration file\ninclude('config.php');\n\n// Products page\nif ($_SERVER['PHP_SELF'] == '/products.php') {\n    // Retrieve all products from database\n    $sql = \"SELECT * FROM products\";\n    $result = mysqli_query($conn, $sql);\n    \n    echo \"<h2>Our Products</h2>\";\n    while ($row = mysqli_fetch_assoc($result)) {\n        echo \"<div class='product'>\";\n        echo \"<h3>{$row['name']}</h3>\";\n        echo \"<p>Price: \\${$row['price']}</p>\";\n        echo \"<form action='cart.php' method='post'>\";\n        echo \"<input type='hidden' name='id' value='{$row['id']}'>\";\n        echo \"<input type='hidden' name='name' value='{$row['name']}'>\";\n        echo \"<input type='hidden' name='price' value='{$row['price']}'>\";\n        echo \"<button type='submit'>Add to Cart</button>\";\n        echo \"</form>\";\n        echo \"</div>\";\n    }\n}\n\n// Cart page\nelseif ($_SERVER['PHP_SELF'] == '/cart.php') {\n    session_start();\n    \n    // Add item to cart\n    if ($_SERVER['REQUEST_METHOD'] == 'POST') {\n        $item = array(\n            'id' => $_POST['id'],\n            'name' => $_POST['name'],\n            'price' => $_POST['price'],\n            'quantity' => 1\n        );\n        \n        if (isset($_SESSION['cart'])) {\n            $found = false;\n            foreach ($_SESSION['cart'] as &$item) {\n                if ($item['id'] == $_POST['id']) {\n                    $item['quantity']++;\n                    $found = true;\n                }\n            }\n            if (!$found) {\n                array_push($_SESSION['cart'], $item);\n            }\n        } else {\n            $_SESSION['cart'] = array($item);\n        }\n    }\n    \n    // Update cart\n    elseif (isset($_GET['action']) && $_GET['action'] == 'update') {\n        foreach ($_SESSION['cart'] as &$item) {\n            if ($item['id'] == $_POST['id']) {\n                $item['quantity'] = $_POST['quantity'];\n            }\n        }\n    }\n    \n    // Remove item from cart\n    elseif (isset($_GET['action']) && $_GET['action'] == 'remove') {\n        foreach ($_SESSION['cart'] as &$item) {\n            if ($item['id'] == $_GET['id']) {\n                unset($_SESSION['cart'][$key]);\n            }\n        }\n    }\n    \n    // Display cart\n    echo \"<h2>Your Cart</h2>\";\n    if (isset($_SESSION['cart'])) {\n        $total = 0;\n        foreach ($_SESSION['cart'] as $item) {\n            echo \"<div class='cart-item'>\";\n            echo \"<p>{$item['name']}</p>\";\n            echo \"<p>Quantity: {$item['quantity']}</p>\";\n            echo \"<p>Price: \\${$item['price']} each</p>\";\n            echo \"<form action='cart.php?action=update' method='post'>\";\n            echo \"<input type='hidden' name='id' value='{$item['id']}'>\";\n            echo \"<input type='number' name='quantity' min='1' max='10' value='{$item['quantity']}'>\";\n            echo \"<button type='submit'>Update</button>\";\n            echo \"</form>\";\n            echo \"<a href='cart.php?action=remove&id={$item['id']}'>Remove</a>\";\n            echo \"</div>\";\n            $total += $item['price'] * $item['quantity'];\n        }\n        echo \"<h3>Total: \\${$total}</h3>\";\n        echo \"<a href='checkout.php'>Proceed to Checkout</a>\";\n    } else {\n        echo \"Your cart is empty.\";\n    }\n}\n\n// Checkout page\nelseif ($_SERVER['PHP_SELF'] == '/checkout.php') {\n    session_start();\n    \n    if (isset($_SESSION['cart'])) {\n        // Display checkout form\n        echo \"<h2>Checkout</h2>\";\n        echo \"<form action='purchase.php' method='post'>\";\n        echo \"<label for='name'>Name:</label>\";\n        echo \"<input type='text' id='name' name='name' required><br>\";\n        echo \"<label for='email'>Email:</label>\";\n        echo \"<input type='email' id='email' name='email' required><br>\";\n        echo \"<label for='address'>Address:</label>\";\n        echo \"<input type='text' id='address' name='address' required><br>\";\n        \n        // Hide cart details\n        foreach ($_SESSION['cart'] as $item) {\n            echo \"<input type='hidden' name='items[]' value='{$item['id']}'>\";\n            echo \"<input type='hidden' name='quantities[]' value='{$item['quantity']}'>\";\n        }\n        \n        echo \"<button type='submit'>Place Order</button>\";\n        echo \"</form>\";\n    } else {\n        echo \"Your cart is empty.\";\n    }\n}\n\n// Purchase confirmation\nelseif ($_SERVER['PHP_SELF'] == '/purchase.php') {\n    session_start();\n    \n    if (isset($_POST)) {\n        // Calculate total price\n        $total = 0;\n        foreach ($_SESSION['cart'] as $item) {\n            $total += $item['price'] * $item['quantity'];\n        }\n        \n        // Insert order into database\n        $sql = \"INSERT INTO orders (name, email, address, total_price) VALUES (?, ?, ?, ?)\";\n        $stmt = mysqli_prepare($conn, $sql);\n        mysqli_stmt_bind_param($stmt, \"sssd\", $_POST['name'], $_POST['email'], $_POST['address'], $total);\n        mysqli_stmt_execute($stmt);\n        \n        // Get order ID\n        $order_id = mysqli_insert_id($conn);\n        \n        // Insert order items into database\n        foreach ($_SESSION['cart'] as $item) {\n            $sql = \"INSERT INTO order_items (order_id, product_id, quantity) VALUES (?, ?, ?)\";\n            $stmt = mysqli_prepare($conn, $sql);\n            mysqli_stmt_bind_param($stmt, \"iii\", $order_id, $item['id'], $item['quantity']);\n            mysqli_stmt_execute($stmt);\n        }\n        \n        // Clear cart\n        unset($_SESSION['cart']);\n        \n        // Display confirmation message\n        echo \"<h2>Thank you for your purchase!</h2>\";\n        echo \"<p>Your order number is #{$order_id}</p>\";\n    }\n}\n?>\n```"]}
