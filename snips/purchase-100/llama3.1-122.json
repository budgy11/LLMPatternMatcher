{"prompt": "Create a purchase functionality using php", "llm_output": "Here's an example of a basic purchase functionality using PHP. This includes user registration, login, and the ability to add products to cart and make purchases.\n\n**Note:** This is a simplified example and should not be used in production without proper security measures (e.g., sanitizing input data, validating user credentials).\n\n### Database Setup\n\nCreate a database with the following tables:\n\n```sql\nCREATE TABLE users (\n    id INT PRIMARY KEY AUTO_INCREMENT,\n    username VARCHAR(255) NOT NULL,\n    email VARCHAR(255) NOT NULL,\n    password VARCHAR(255) NOT NULL\n);\n\nCREATE TABLE products (\n    id INT PRIMARY KEY AUTO_INCREMENT,\n    name VARCHAR(255) NOT NULL,\n    price DECIMAL(10, 2) NOT NULL\n);\n\nCREATE TABLE orders (\n    id INT PRIMARY KEY AUTO_INCREMENT,\n    user_id INT NOT NULL,\n    total DECIMAL(10, 2) NOT NULL,\n    status ENUM('pending', 'shipped', 'delivered') DEFAULT 'pending'\n);\n```\n\n### PHP Code\n\n**config.php**\n```php\n<?php\n// Database connection settings\n$host = 'localhost';\n$dbname = 'mydatabase';\n$user = 'myuser';\n$password = 'mypassword';\n\n// Establish database connection\n$conn = new PDO(\"mysql:host=$host;dbname=$dbname\", $user, $password);\n?>\n```\n\n**index.php (Registration and Login)**\n```php\n<?php\nrequire_once 'config.php';\n\n// User registration form handler\nif (isset($_POST['register'])) {\n    $username = $_POST['username'];\n    $email = $_POST['email'];\n    $password = password_hash($_POST['password'], PASSWORD_DEFAULT);\n\n    $stmt = $conn->prepare(\"INSERT INTO users (username, email, password) VALUES (:username, :email, :password)\");\n    $stmt->bindParam(':username', $username);\n    $stmt->bindParam(':email', $email);\n    $stmt->bindParam(':password', $password);\n    $stmt->execute();\n\n    echo \"User created successfully!\";\n}\n\n// User login form handler\nif (isset($_POST['login'])) {\n    $username = $_POST['username'];\n    $password = $_POST['password'];\n\n    $stmt = $conn->prepare(\"SELECT * FROM users WHERE username = :username\");\n    $stmt->bindParam(':username', $username);\n    $stmt->execute();\n\n    $user = $stmt->fetch();\n    if ($user && password_verify($password, $user['password'])) {\n        // Successful login\n        session_start();\n        $_SESSION['user_id'] = $user['id'];\n        header('Location: products.php');\n        exit;\n    } else {\n        echo \"Invalid username or password!\";\n    }\n}\n?>\n```\n\n**products.php (Display Products and Add to Cart)**\n```php\n<?php\nrequire_once 'config.php';\n\n// Display all products\n$stmt = $conn->query(\"SELECT * FROM products\");\n$products = $stmt->fetchAll();\n\nif (isset($_POST['add_to_cart'])) {\n    $product_id = $_POST['product_id'];\n    $quantity = $_POST['quantity'];\n\n    // Add product to cart\n    if (!isset($_SESSION['cart'])) {\n        $_SESSION['cart'] = array();\n    }\n    $_SESSION['cart'][$product_id] = $quantity;\n}\n?>\n```\n\n**cart.php (Display Cart and Checkout)**\n```php\n<?php\nrequire_once 'config.php';\n\n// Display cart contents\nif (isset($_SESSION['cart'])) {\n    echo \"Cart Contents:\\n\";\n    foreach ($_SESSION['cart'] as $product_id => $quantity) {\n        // Fetch product details from database\n        $stmt = $conn->prepare(\"SELECT * FROM products WHERE id = :id\");\n        $stmt->bindParam(':id', $product_id);\n        $stmt->execute();\n        $product = $stmt->fetch();\n\n        echo \"$product[name] x $quantity\\n\";\n    }\n}\n\n// Checkout form handler\nif (isset($_POST['checkout'])) {\n    // Calculate total cost and update order status\n    $total = 0;\n    foreach ($_SESSION['cart'] as $product_id => $quantity) {\n        $stmt = $conn->prepare(\"SELECT price FROM products WHERE id = :id\");\n        $stmt->bindParam(':id', $product_id);\n        $stmt->execute();\n        $price = $stmt->fetch();\n\n        $total += ($price['price'] * $quantity);\n    }\n\n    // Create new order in database\n    $order_id = uniqid();\n    $user_id = $_SESSION['user_id'];\n    $stmt = $conn->prepare(\"INSERT INTO orders (user_id, total, status) VALUES (:user_id, :total, 'pending')\");\n    $stmt->bindParam(':user_id', $user_id);\n    $stmt->bindParam(':total', $total);\n    $stmt->execute();\n\n    // Update product quantities and order details\n    foreach ($_SESSION['cart'] as $product_id => $quantity) {\n        // Update product quantity in database\n        $stmt = $conn->prepare(\"UPDATE products SET quantity = quantity - :quantity WHERE id = :id\");\n        $stmt->bindParam(':quantity', $quantity);\n        $stmt->bindParam(':id', $product_id);\n        $stmt->execute();\n\n        // Add order details to database\n        $stmt = $conn->prepare(\"INSERT INTO orders_products (order_id, product_id, quantity) VALUES (:order_id, :product_id, :quantity)\");\n        $stmt->bindParam(':order_id', $order_id);\n        $stmt->bindParam(':product_id', $product_id);\n        $stmt->bindParam(':quantity', $quantity);\n        $stmt->execute();\n    }\n\n    // Clear cart and redirect to confirmation page\n    unset($_SESSION['cart']);\n    header('Location: confirm.php');\n    exit;\n}\n?>\n```\n\n**confirm.php (Order Confirmation)**\n```php\n<?php\nrequire_once 'config.php';\n\n// Display order details\n$order_id = $_GET['order_id'];\n$stmt = $conn->prepare(\"SELECT * FROM orders WHERE id = :id\");\n$stmt->bindParam(':id', $order_id);\n$stmt->execute();\n$order = $stmt->fetch();\n\necho \"Order #{$order['id']} confirmed!\";\n?>\n```\n\nThis is a basic example and may need modifications to fit your specific requirements. Remember to handle errors, implement security measures (e.g., CSRF protection), and follow best practices for coding standards and documentation.\n\n### Usage\n\n1. Create a new database and import the SQL schema.\n2. Update the `config.php` file with your database credentials.\n3. Visit `index.php` to register or login.\n4. Once logged in, visit `products.php` to browse products and add them to cart.\n5. Proceed to `cart.php` to review your cart contents and checkout.\n6. Complete the checkout form to place an order and confirm.\n\nNote that this example does not include features like user authentication, product reviews, or payment processing. You may need to modify or extend it to suit your needs.", "code_blocks": [null, "```php\n<?php\n// Database connection settings\n$host = 'localhost';\n$dbname = 'mydatabase';\n$user = 'myuser';\n$password = 'mypassword';\n\n// Establish database connection\n$conn = new PDO(\"mysql:host=$host;dbname=$dbname\", $user, $password);\n?>\n```", "```php\n<?php\nrequire_once 'config.php';\n\n// User registration form handler\nif (isset($_POST['register'])) {\n    $username = $_POST['username'];\n    $email = $_POST['email'];\n    $password = password_hash($_POST['password'], PASSWORD_DEFAULT);\n\n    $stmt = $conn->prepare(\"INSERT INTO users (username, email, password) VALUES (:username, :email, :password)\");\n    $stmt->bindParam(':username', $username);\n    $stmt->bindParam(':email', $email);\n    $stmt->bindParam(':password', $password);\n    $stmt->execute();\n\n    echo \"User created successfully!\";\n}\n\n// User login form handler\nif (isset($_POST['login'])) {\n    $username = $_POST['username'];\n    $password = $_POST['password'];\n\n    $stmt = $conn->prepare(\"SELECT * FROM users WHERE username = :username\");\n    $stmt->bindParam(':username', $username);\n    $stmt->execute();\n\n    $user = $stmt->fetch();\n    if ($user && password_verify($password, $user['password'])) {\n        // Successful login\n        session_start();\n        $_SESSION['user_id'] = $user['id'];\n        header('Location: products.php');\n        exit;\n    } else {\n        echo \"Invalid username or password!\";\n    }\n}\n?>\n```", "```php\n<?php\nrequire_once 'config.php';\n\n// Display all products\n$stmt = $conn->query(\"SELECT * FROM products\");\n$products = $stmt->fetchAll();\n\nif (isset($_POST['add_to_cart'])) {\n    $product_id = $_POST['product_id'];\n    $quantity = $_POST['quantity'];\n\n    // Add product to cart\n    if (!isset($_SESSION['cart'])) {\n        $_SESSION['cart'] = array();\n    }\n    $_SESSION['cart'][$product_id] = $quantity;\n}\n?>\n```", "```php\n<?php\nrequire_once 'config.php';\n\n// Display cart contents\nif (isset($_SESSION['cart'])) {\n    echo \"Cart Contents:\\n\";\n    foreach ($_SESSION['cart'] as $product_id => $quantity) {\n        // Fetch product details from database\n        $stmt = $conn->prepare(\"SELECT * FROM products WHERE id = :id\");\n        $stmt->bindParam(':id', $product_id);\n        $stmt->execute();\n        $product = $stmt->fetch();\n\n        echo \"$product[name] x $quantity\\n\";\n    }\n}\n\n// Checkout form handler\nif (isset($_POST['checkout'])) {\n    // Calculate total cost and update order status\n    $total = 0;\n    foreach ($_SESSION['cart'] as $product_id => $quantity) {\n        $stmt = $conn->prepare(\"SELECT price FROM products WHERE id = :id\");\n        $stmt->bindParam(':id', $product_id);\n        $stmt->execute();\n        $price = $stmt->fetch();\n\n        $total += ($price['price'] * $quantity);\n    }\n\n    // Create new order in database\n    $order_id = uniqid();\n    $user_id = $_SESSION['user_id'];\n    $stmt = $conn->prepare(\"INSERT INTO orders (user_id, total, status) VALUES (:user_id, :total, 'pending')\");\n    $stmt->bindParam(':user_id', $user_id);\n    $stmt->bindParam(':total', $total);\n    $stmt->execute();\n\n    // Update product quantities and order details\n    foreach ($_SESSION['cart'] as $product_id => $quantity) {\n        // Update product quantity in database\n        $stmt = $conn->prepare(\"UPDATE products SET quantity = quantity - :quantity WHERE id = :id\");\n        $stmt->bindParam(':quantity', $quantity);\n        $stmt->bindParam(':id', $product_id);\n        $stmt->execute();\n\n        // Add order details to database\n        $stmt = $conn->prepare(\"INSERT INTO orders_products (order_id, product_id, quantity) VALUES (:order_id, :product_id, :quantity)\");\n        $stmt->bindParam(':order_id', $order_id);\n        $stmt->bindParam(':product_id', $product_id);\n        $stmt->bindParam(':quantity', $quantity);\n        $stmt->execute();\n    }\n\n    // Clear cart and redirect to confirmation page\n    unset($_SESSION['cart']);\n    header('Location: confirm.php');\n    exit;\n}\n?>\n```", "```php\n<?php\nrequire_once 'config.php';\n\n// Display order details\n$order_id = $_GET['order_id'];\n$stmt = $conn->prepare(\"SELECT * FROM orders WHERE id = :id\");\n$stmt->bindParam(':id', $order_id);\n$stmt->execute();\n$order = $stmt->fetch();\n\necho \"Order #{$order['id']} confirmed!\";\n?>\n```"]}
