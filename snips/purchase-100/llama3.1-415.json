{"prompt": "Create a purchase functionality using php", "llm_output": "**Purchase Functionality in PHP**\n=====================================\n\nIn this example, we will create a simple purchase functionality that allows users to add items to their cart and checkout. We'll use a basic database setup with MySQL and handle form submissions using PHP.\n\n**Database Setup**\n-----------------\n\nFirst, let's set up our database schema:\n\n```sql\nCREATE TABLE products (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  name VARCHAR(255),\n  price DECIMAL(10,2)\n);\n\nCREATE TABLE cart (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  user_id INT,\n  product_id INT,\n  quantity INT,\n  FOREIGN KEY (user_id) REFERENCES users(id),\n  FOREIGN KEY (product_id) REFERENCES products(id)\n);\n```\n\n**Database Connection**\n----------------------\n\nCreate a `db.php` file to handle database connections:\n```php\n<?php\n$servername = \"localhost\";\n$username = \"username\";\n$password = \"password\";\n$dbname = \"database_name\";\n\n$conn = new mysqli($servername, $username, $password, $dbname);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n?>\n```\n\n**Product Model**\n----------------\n\nCreate a `product.php` file to handle product data:\n```php\n<?php\nclass Product {\n  private $id;\n  private $name;\n  private $price;\n\n  public function __construct($id, $name, $price) {\n    $this->id = $id;\n    $this->name = $name;\n    $this->price = $price;\n  }\n\n  public function getId() { return $this->id; }\n  public function getName() { return $this->name; }\n  public function getPrice() { return $this->price; }\n}\n?>\n```\n\n**Cart Model**\n-------------\n\nCreate a `cart.php` file to handle cart data:\n```php\n<?php\nclass Cart {\n  private $userId;\n  private $products = array();\n\n  public function __construct($userId) {\n    $this->userId = $userId;\n  }\n\n  public function addProduct($productId, $quantity) {\n    if (array_key_exists($productId, $this->products)) {\n      $this->products[$productId] += $quantity;\n    } else {\n      $this->products[$productId] = $quantity;\n    }\n  }\n\n  public function getProducts() { return $this->products; }\n}\n?>\n```\n\n**Controller**\n--------------\n\nCreate a `controller.php` file to handle user input and logic:\n```php\n<?php\nrequire_once 'db.php';\nrequire_once 'product.php';\nrequire_once 'cart.php';\n\n// Add product to cart\nif (isset($_POST['add_to_cart'])) {\n  $userId = $_SESSION['user_id'];\n  $productId = $_POST['product_id'];\n  $quantity = $_POST['quantity'];\n\n  $cart = new Cart($userId);\n  $cart->addProduct($productId, $quantity);\n\n  // Save cart to database\n  $stmt = $conn->prepare(\"INSERT INTO cart (user_id, product_id, quantity) VALUES (?, ?, ?)\");\n  $stmt->bind_param(\"iis\", $userId, $productId, $quantity);\n  $stmt->execute();\n}\n\n// Checkout\nif (isset($_POST['checkout'])) {\n  // Save order to database\n  $stmt = $conn->prepare(\"INSERT INTO orders (user_id) VALUES (?)\");\n  $stmt->bind_param(\"i\", $_SESSION['user_id']);\n  $stmt->execute();\n\n  // Clear cart\n  unset($cart);\n}\n\n// Display products and cart contents\nif (isset($_GET['products'])) {\n  $query = \"SELECT * FROM products\";\n  $result = $conn->query($query);\n\n  echo '<h2>Products</h2>';\n  while ($row = $result->fetch_assoc()) {\n    echo '<p><a href=\"cart.php?add_to_cart='.$row['id'].'&quantity=1\">'.$row['name'].'</a></p>';\n  }\n}\n\nif (isset($_GET['cart'])) {\n  $query = \"SELECT * FROM cart WHERE user_id=\".$_SESSION['user_id'];\n  $result = $conn->query($query);\n\n  echo '<h2>Cart Contents</h2>';\n  while ($row = $result->fetch_assoc()) {\n    echo '<p>'.$row['name'].' x '.$row['quantity'].'</p>';\n  }\n}\n?>\n```\n\n**HTML Form**\n-------------\n\nCreate an `index.php` file to display the form:\n```php\n<?php\nrequire_once 'controller.php';\n?>\n\n<!DOCTYPE html>\n<html>\n<head>\n  <title>Purchase Functionality</title>\n</head>\n<body>\n\n<form action=\"\" method=\"post\">\n  <input type=\"hidden\" name=\"product_id\" value=\"<?php echo $_GET['id']; ?>\">\n  <input type=\"number\" name=\"quantity\" value=\"1\">\n  <button type=\"submit\" name=\"add_to_cart\">Add to Cart</button>\n</form>\n\n<form action=\"\" method=\"post\">\n  <button type=\"submit\" name=\"checkout\">Checkout</button>\n</form>\n\n<h2>Products:</h2>\n<a href=\"index.php?products=true\">View Products</a>\n\n<h2>Cart Contents:</h2>\n<a href=\"index.php?cart=true\">View Cart</a>\n\n<?php echo $_GET['id']; ?>\n```\n\n**Example Use Case**\n--------------------\n\n1. User visits the index page and clicks on a product to add it to their cart.\n2. The user is redirected to the cart page, where they can view their current cart contents.\n3. When the user clicks the \"Checkout\" button, an order is created in the database and the cart is cleared.\n\nNote: This is a basic example and does not include error handling or security measures. You should modify it according to your specific needs.", "code_blocks": [null, "```php\n<?php\n$servername = \"localhost\";\n$username = \"username\";\n$password = \"password\";\n$dbname = \"database_name\";\n\n$conn = new mysqli($servername, $username, $password, $dbname);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n?>\n```", "```php\n<?php\nclass Product {\n  private $id;\n  private $name;\n  private $price;\n\n  public function __construct($id, $name, $price) {\n    $this->id = $id;\n    $this->name = $name;\n    $this->price = $price;\n  }\n\n  public function getId() { return $this->id; }\n  public function getName() { return $this->name; }\n  public function getPrice() { return $this->price; }\n}\n?>\n```", "```php\n<?php\nclass Cart {\n  private $userId;\n  private $products = array();\n\n  public function __construct($userId) {\n    $this->userId = $userId;\n  }\n\n  public function addProduct($productId, $quantity) {\n    if (array_key_exists($productId, $this->products)) {\n      $this->products[$productId] += $quantity;\n    } else {\n      $this->products[$productId] = $quantity;\n    }\n  }\n\n  public function getProducts() { return $this->products; }\n}\n?>\n```", "```php\n<?php\nrequire_once 'db.php';\nrequire_once 'product.php';\nrequire_once 'cart.php';\n\n// Add product to cart\nif (isset($_POST['add_to_cart'])) {\n  $userId = $_SESSION['user_id'];\n  $productId = $_POST['product_id'];\n  $quantity = $_POST['quantity'];\n\n  $cart = new Cart($userId);\n  $cart->addProduct($productId, $quantity);\n\n  // Save cart to database\n  $stmt = $conn->prepare(\"INSERT INTO cart (user_id, product_id, quantity) VALUES (?, ?, ?)\");\n  $stmt->bind_param(\"iis\", $userId, $productId, $quantity);\n  $stmt->execute();\n}\n\n// Checkout\nif (isset($_POST['checkout'])) {\n  // Save order to database\n  $stmt = $conn->prepare(\"INSERT INTO orders (user_id) VALUES (?)\");\n  $stmt->bind_param(\"i\", $_SESSION['user_id']);\n  $stmt->execute();\n\n  // Clear cart\n  unset($cart);\n}\n\n// Display products and cart contents\nif (isset($_GET['products'])) {\n  $query = \"SELECT * FROM products\";\n  $result = $conn->query($query);\n\n  echo '<h2>Products</h2>';\n  while ($row = $result->fetch_assoc()) {\n    echo '<p><a href=\"cart.php?add_to_cart='.$row['id'].'&quantity=1\">'.$row['name'].'</a></p>';\n  }\n}\n\nif (isset($_GET['cart'])) {\n  $query = \"SELECT * FROM cart WHERE user_id=\".$_SESSION['user_id'];\n  $result = $conn->query($query);\n\n  echo '<h2>Cart Contents</h2>';\n  while ($row = $result->fetch_assoc()) {\n    echo '<p>'.$row['name'].' x '.$row['quantity'].'</p>';\n  }\n}\n?>\n```", "```php\n<?php\nrequire_once 'controller.php';\n?>\n\n<!DOCTYPE html>\n<html>\n<head>\n  <title>Purchase Functionality</title>\n</head>\n<body>\n\n<form action=\"\" method=\"post\">\n  <input type=\"hidden\" name=\"product_id\" value=\"<?php echo $_GET['id']; ?>\">\n  <input type=\"number\" name=\"quantity\" value=\"1\">\n  <button type=\"submit\" name=\"add_to_cart\">Add to Cart</button>\n</form>\n\n<form action=\"\" method=\"post\">\n  <button type=\"submit\" name=\"checkout\">Checkout</button>\n</form>\n\n<h2>Products:</h2>\n<a href=\"index.php?products=true\">View Products</a>\n\n<h2>Cart Contents:</h2>\n<a href=\"index.php?cart=true\">View Cart</a>\n\n<?php echo $_GET['id']; ?>\n```"]}
