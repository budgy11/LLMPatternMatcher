{"prompt": "Create a purchase functionality using php", "llm_output": "Here is an example of a simple purchase functionality using PHP, HTML, and MySQL:\n\n**Database Setup**\n\nFirst, let's create the database schema for our application. We'll use a MySQL database with two tables: `products` and `orders`.\n\n```sql\nCREATE TABLE products (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  name VARCHAR(255),\n  price DECIMAL(10,2)\n);\n\nCREATE TABLE orders (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  customer_name VARCHAR(255),\n  order_date DATE,\n  total_cost DECIMAL(10,2)\n);\n```\n\n**PHP Code**\n\nNext, let's create the PHP code for our purchase functionality. We'll use a simple HTML form to allow users to select products and add them to their cart.\n\n```php\n// config.php\n<?php\ndefine('DB_HOST', 'localhost');\ndefine('DB_USERNAME', 'your_username');\ndefine('DB_PASSWORD', 'your_password');\ndefine('DB_NAME', 'your_database');\n\n$connection = new mysqli(DB_HOST, DB_USERNAME, DB_PASSWORD, DB_NAME);\n\nif ($connection->connect_error) {\n    die(\"Connection failed: \" . $connection->connect_error);\n}\n?>\n\n// index.php\n<?php\nrequire_once 'config.php';\n\n// display products\n$query = \"SELECT * FROM products\";\n$results = $connection->query($query);\n\necho \"<h1>Products</h1>\";\necho \"<ul>\";\n\nwhile ($row = $results->fetch_assoc()) {\n    echo \"<li><a href='add_to_cart.php?id=\" . $row['id'] . \"'>\" . $row['name'] . \"</a></li>\";\n}\n\necho \"</ul>\";\n\n// add to cart\nif (isset($_GET['id'])) {\n    $product_id = $_GET['id'];\n    $cart[] = array('id' => $product_id, 'quantity' => 1);\n    session_start();\n    $_SESSION['cart'] = $cart;\n    echo \"Added \" . $_SESSION['cart'][0]['name'] . \" to cart!\";\n}\n\n// display cart\nif (isset($_SESSION['cart'])) {\n    echo \"<h1>Cart</h1>\";\n    foreach ($_SESSION['cart'] as $item) {\n        $query = \"SELECT * FROM products WHERE id = '\" . $item['id'] . \"'\";\n        $result = $connection->query($query);\n        $row = $result->fetch_assoc();\n        echo \"<p>\" . $row['name'] . \" x \" . $item['quantity'] . \"</p>\";\n    }\n}\n\n// checkout\nif (isset($_POST['submit'])) {\n    // retrieve cart contents\n    $cart_contents = $_SESSION['cart'];\n    \n    // calculate total cost\n    $total_cost = 0;\n    foreach ($cart_contents as $item) {\n        $query = \"SELECT price FROM products WHERE id = '\" . $item['id'] . \"'\";\n        $result = $connection->query($query);\n        $row = $result->fetch_assoc();\n        $total_cost += $row['price'] * $item['quantity'];\n    }\n    \n    // insert order into database\n    $customer_name = $_POST['customer_name'];\n    $order_date = date('Y-m-d');\n    $query = \"INSERT INTO orders (customer_name, order_date, total_cost) VALUES ('$customer_name', '$order_date', '$total_cost')\";\n    $connection->query($query);\n    \n    // insert cart contents into database\n    foreach ($cart_contents as $item) {\n        $query = \"INSERT INTO orders_items (order_id, product_id, quantity) VALUES ((SELECT MAX(id) FROM orders), '\" . $item['id'] . \"', '\" . $item['quantity'] . \"') \";\n        $connection->query($query);\n    }\n    \n    // clear cart\n    session_start();\n    unset($_SESSION['cart']);\n}\n\n?>\n\n<form action=\"\" method=\"post\">\n    <label for=\"customer_name\">Customer Name:</label>\n    <input type=\"text\" id=\"customer_name\" name=\"customer_name\"><br><br>\n    <input type=\"submit\" name=\"submit\" value=\"Checkout\">\n</form>\n\n// add_to_cart.php\n<?php\nrequire_once 'config.php';\n\n$product_id = $_GET['id'];\n$cart[] = array('id' => $product_id, 'quantity' => 1);\nsession_start();\n$_SESSION['cart'] = $cart;\n\necho \"Added \" . $_SESSION['cart'][0]['name'] . \" to cart!\";\n?>\n```\n\nThis is a basic example of how you can implement a purchase functionality using PHP and MySQL. This code allows users to select products, add them to their cart, and checkout with the option to insert their order into the database.\n\n**Note**: This is just an example code and should not be used in production without proper security measures (e.g., validation, sanitization, and escaping user input).\n\nPlease let me know if you need any further assistance or modifications!", "code_blocks": [null, "```php\n// config.php\n<?php\ndefine('DB_HOST', 'localhost');\ndefine('DB_USERNAME', 'your_username');\ndefine('DB_PASSWORD', 'your_password');\ndefine('DB_NAME', 'your_database');\n\n$connection = new mysqli(DB_HOST, DB_USERNAME, DB_PASSWORD, DB_NAME);\n\nif ($connection->connect_error) {\n    die(\"Connection failed: \" . $connection->connect_error);\n}\n?>\n\n// index.php\n<?php\nrequire_once 'config.php';\n\n// display products\n$query = \"SELECT * FROM products\";\n$results = $connection->query($query);\n\necho \"<h1>Products</h1>\";\necho \"<ul>\";\n\nwhile ($row = $results->fetch_assoc()) {\n    echo \"<li><a href='add_to_cart.php?id=\" . $row['id'] . \"'>\" . $row['name'] . \"</a></li>\";\n}\n\necho \"</ul>\";\n\n// add to cart\nif (isset($_GET['id'])) {\n    $product_id = $_GET['id'];\n    $cart[] = array('id' => $product_id, 'quantity' => 1);\n    session_start();\n    $_SESSION['cart'] = $cart;\n    echo \"Added \" . $_SESSION['cart'][0]['name'] . \" to cart!\";\n}\n\n// display cart\nif (isset($_SESSION['cart'])) {\n    echo \"<h1>Cart</h1>\";\n    foreach ($_SESSION['cart'] as $item) {\n        $query = \"SELECT * FROM products WHERE id = '\" . $item['id'] . \"'\";\n        $result = $connection->query($query);\n        $row = $result->fetch_assoc();\n        echo \"<p>\" . $row['name'] . \" x \" . $item['quantity'] . \"</p>\";\n    }\n}\n\n// checkout\nif (isset($_POST['submit'])) {\n    // retrieve cart contents\n    $cart_contents = $_SESSION['cart'];\n    \n    // calculate total cost\n    $total_cost = 0;\n    foreach ($cart_contents as $item) {\n        $query = \"SELECT price FROM products WHERE id = '\" . $item['id'] . \"'\";\n        $result = $connection->query($query);\n        $row = $result->fetch_assoc();\n        $total_cost += $row['price'] * $item['quantity'];\n    }\n    \n    // insert order into database\n    $customer_name = $_POST['customer_name'];\n    $order_date = date('Y-m-d');\n    $query = \"INSERT INTO orders (customer_name, order_date, total_cost) VALUES ('$customer_name', '$order_date', '$total_cost')\";\n    $connection->query($query);\n    \n    // insert cart contents into database\n    foreach ($cart_contents as $item) {\n        $query = \"INSERT INTO orders_items (order_id, product_id, quantity) VALUES ((SELECT MAX(id) FROM orders), '\" . $item['id'] . \"', '\" . $item['quantity'] . \"') \";\n        $connection->query($query);\n    }\n    \n    // clear cart\n    session_start();\n    unset($_SESSION['cart']);\n}\n\n?>\n\n<form action=\"\" method=\"post\">\n    <label for=\"customer_name\">Customer Name:</label>\n    <input type=\"text\" id=\"customer_name\" name=\"customer_name\"><br><br>\n    <input type=\"submit\" name=\"submit\" value=\"Checkout\">\n</form>\n\n// add_to_cart.php\n<?php\nrequire_once 'config.php';\n\n$product_id = $_GET['id'];\n$cart[] = array('id' => $product_id, 'quantity' => 1);\nsession_start();\n$_SESSION['cart'] = $cart;\n\necho \"Added \" . $_SESSION['cart'][0]['name'] . \" to cart!\";\n?>\n```"]}
