{"prompt": "Create a purchase functionality using php", "llm_output": "Here is an example of how you can create a basic purchase functionality using PHP:\n\n**Database Schema:**\n\nFirst, let's assume we have the following database schema for products and orders:\n```sql\nCREATE TABLE products (\n  id INT PRIMARY KEY,\n  name VARCHAR(255),\n  price DECIMAL(10,2)\n);\n\nCREATE TABLE orders (\n  id INT PRIMARY KEY,\n  customer_name VARCHAR(255),\n  order_date DATE\n);\n\nCREATE TABLE order_items (\n  id INT PRIMARY KEY,\n  order_id INT,\n  product_id INT,\n  quantity INT,\n  FOREIGN KEY (order_id) REFERENCES orders(id),\n  FOREIGN KEY (product_id) REFERENCES products(id)\n);\n```\n**PHP Code:**\n\nNow, let's create the PHP code for the purchase functionality. We'll use a simple form to allow customers to select products and submit their order.\n```php\n<?php\n\n// Connect to database\n$conn = new mysqli(\"localhost\", \"username\", \"password\", \"database\");\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Function to display products\nfunction display_products() {\n  global $conn;\n  $query = \"SELECT * FROM products\";\n  $result = $conn->query($query);\n\n  if ($result->num_rows > 0) {\n      while ($row = $result->fetch_assoc()) {\n          echo \"<option value='\" . $row[\"id\"] . \"'>\" . $row[\"name\"] . \"</option>\";\n      }\n  } else {\n      echo \"No products available\";\n  }\n}\n\n// Function to process order\nfunction process_order() {\n  global $conn;\n  if (isset($_POST['submit'])) {\n      $customer_name = $_POST['customer_name'];\n      $order_date = date(\"Y-m-d\");\n\n      // Insert into orders table\n      $query = \"INSERT INTO orders (customer_name, order_date) VALUES ('$customer_name', '$order_date')\";\n      $conn->query($query);\n\n      // Get the last inserted ID\n      $last_id = $conn->insert_id;\n\n      // Loop through selected products and insert into order_items table\n      foreach ($_POST['products'] as $product_id => $quantity) {\n          if ($quantity > 0) {\n              $query = \"INSERT INTO order_items (order_id, product_id, quantity) VALUES ('$last_id', '$product_id', '$quantity')\";\n              $conn->query($query);\n          }\n      }\n\n      echo \"Order processed successfully\";\n  }\n}\n\n// Display products and process order form\n?>\n\n<form method=\"post\">\n  <h2>Customer Information</h2>\n  <label for=\"customer_name\">Name:</label>\n  <input type=\"text\" id=\"customer_name\" name=\"customer_name\"><br><br>\n\n  <h2>Select Products:</h2>\n  <select multiple name=\"products[]\">\n    <?php display_products(); ?>\n  </select>\n\n  <button type=\"submit\" name=\"submit\">Place Order</button>\n</form>\n\n<?php\nprocess_order();\n?>\n```\n**How it works:**\n\n1. The `display_products()` function queries the database to fetch all products and displays them as options in a dropdown list.\n2. When the customer submits the form, the `process_order()` function is called.\n3. This function inserts the customer's information into the orders table and gets the last inserted ID.\n4. It then loops through the selected products and inserts each one into the order_items table along with the quantity.\n\nNote: This is a very basic example and you should consider implementing proper validation, security measures (e.g., escaping user input), and error handling to make your code more robust.", "code_blocks": [null, "```php\n<?php\n\n// Connect to database\n$conn = new mysqli(\"localhost\", \"username\", \"password\", \"database\");\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Function to display products\nfunction display_products() {\n  global $conn;\n  $query = \"SELECT * FROM products\";\n  $result = $conn->query($query);\n\n  if ($result->num_rows > 0) {\n      while ($row = $result->fetch_assoc()) {\n          echo \"<option value='\" . $row[\"id\"] . \"'>\" . $row[\"name\"] . \"</option>\";\n      }\n  } else {\n      echo \"No products available\";\n  }\n}\n\n// Function to process order\nfunction process_order() {\n  global $conn;\n  if (isset($_POST['submit'])) {\n      $customer_name = $_POST['customer_name'];\n      $order_date = date(\"Y-m-d\");\n\n      // Insert into orders table\n      $query = \"INSERT INTO orders (customer_name, order_date) VALUES ('$customer_name', '$order_date')\";\n      $conn->query($query);\n\n      // Get the last inserted ID\n      $last_id = $conn->insert_id;\n\n      // Loop through selected products and insert into order_items table\n      foreach ($_POST['products'] as $product_id => $quantity) {\n          if ($quantity > 0) {\n              $query = \"INSERT INTO order_items (order_id, product_id, quantity) VALUES ('$last_id', '$product_id', '$quantity')\";\n              $conn->query($query);\n          }\n      }\n\n      echo \"Order processed successfully\";\n  }\n}\n\n// Display products and process order form\n?>\n\n<form method=\"post\">\n  <h2>Customer Information</h2>\n  <label for=\"customer_name\">Name:</label>\n  <input type=\"text\" id=\"customer_name\" name=\"customer_name\"><br><br>\n\n  <h2>Select Products:</h2>\n  <select multiple name=\"products[]\">\n    <?php display_products(); ?>\n  </select>\n\n  <button type=\"submit\" name=\"submit\">Place Order</button>\n</form>\n\n<?php\nprocess_order();\n?>\n```"]}
