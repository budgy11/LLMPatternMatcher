{"prompt": "Create a purchase functionality using php", "llm_output": "Here's an example of a basic purchase functionality using PHP, MySQL, and HTML. This will cover the creation of a simple online store where users can view products, add them to cart, and checkout.\n\n**Database Schema:**\n\nFirst, let's create a database schema for our e-commerce application. We'll need four tables:\n\n```sql\nCREATE TABLE products (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  name VARCHAR(255),\n  price DECIMAL(10,2)\n);\n\nCREATE TABLE orders (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  customer_name VARCHAR(255),\n  order_date DATE\n);\n\nCREATE TABLE order_items (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  order_id INT,\n  product_id INT,\n  quantity INT,\n  FOREIGN KEY (order_id) REFERENCES orders(id),\n  FOREIGN KEY (product_id) REFERENCES products(id)\n);\n\nCREATE TABLE customers (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  name VARCHAR(255),\n  email VARCHAR(255)\n);\n```\n\n**PHP Code:**\n\nLet's create a basic purchase functionality using PHP. We'll use the `$_POST` array to handle form submissions and MySQLi extension for database interactions.\n\n```php\n<?php\n\n// Connect to the database\n$conn = new mysqli(\"localhost\", \"username\", \"password\", \"database\");\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Get products from the database\nfunction getProducts() {\n  global $conn;\n  $query = \"SELECT * FROM products\";\n  $result = $conn->query($query);\n\n  if ($result->num_rows > 0) {\n    while($row = $result->fetch_assoc()) {\n      echo \"<div class='product'>\";\n      echo \"<h2>\" . $row[\"name\"] . \"</h2>\";\n      echo \"<p>Price: $\" . $row[\"price\"] . \"</p>\";\n      echo \"<button class='add-to-cart' data-id='\" . $row[\"id\"] . \"'>Add to Cart</button>\";\n      echo \"</div>\";\n    }\n  } else {\n    echo \"0 results\";\n  }\n}\n\n// Add product to cart\nfunction addProductToCart() {\n  global $conn;\n  if (isset($_POST['product_id'])) {\n    $product_id = $_POST['product_id'];\n    $customer_name = $_POST['customer_name'];\n\n    // Check if the product exists in the cart\n    $query = \"SELECT * FROM order_items WHERE product_id = '$product_id' AND customer_name = '$customer_name'\";\n    $result = $conn->query($query);\n\n    if ($result->num_rows > 0) {\n      echo \"Product already added to your cart\";\n    } else {\n      // Add the product to the cart\n      $query = \"INSERT INTO order_items (order_id, product_id, quantity) VALUES (NULL, '$product_id', '1')\";\n      $conn->query($query);\n      echo \"Product added successfully to your cart!\";\n    }\n  }\n}\n\n// Checkout functionality\nfunction checkout() {\n  global $conn;\n  if (isset($_POST['customer_name'])) {\n    $customer_name = $_POST['customer_name'];\n    $order_date = date(\"Y-m-d\");\n\n    // Insert new order into the database\n    $query = \"INSERT INTO orders (customer_name, order_date) VALUES ('$customer_name', '$order_date')\";\n    $conn->query($query);\n\n    // Get the latest order ID\n    $latest_order_id = $conn->insert_id;\n\n    // Update the order items with the new order ID\n    $query = \"UPDATE order_items SET order_id = '$latest_order_id'\";\n    $conn->query($query);\n    echo \"Order created successfully!\";\n  }\n}\n\n// Execute functions based on user actions\nif (isset($_POST['action'])) {\n  if ($_POST['action'] == 'add_product_to_cart') {\n    addProductToCart();\n  } elseif ($_POST['action'] == 'checkout') {\n    checkout();\n  }\n}\n\n?>\n\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n<meta charset=\"UTF-8\">\n<title>Online Store</title>\n<style>\n.product {\n  border: 1px solid #ccc;\n  padding: 10px;\n}\n.add-to-cart {\n  background-color: #4CAF50;\n  color: white;\n  padding: 10px 20px;\n  border: none;\n  cursor: pointer;\n}\n.add-to-cart:hover {\n  background-color: #3e8e41;\n}\n</style>\n</head>\n\n<body>\n<h1>Online Store</h1>\n<div class=\"products\">\n<?php getProducts(); ?>\n</div>\n\n<!-- Add product to cart form -->\n<form id=\"add_product_to_cart_form\" action=\"\" method=\"post\">\n  <input type=\"hidden\" name=\"product_id\" value=\"\">\n  <button type=\"submit\" class=\"add-to-cart\">Add to Cart</button>\n</form>\n\n<!-- Checkout form -->\n<form id=\"checkout_form\" action=\"\" method=\"post\">\n  <label for=\"customer_name\">Customer Name:</label>\n  <input type=\"text\" name=\"customer_name\" required>\n  <button type=\"submit\" class=\"add-to-cart\">Checkout</button>\n</form>\n\n<script src=\"https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js\"></script>\n<script>\n$(document).ready(function() {\n  $(\".add-to-cart\").on(\"click\", function() {\n    var product_id = $(this).data('id');\n    $(\"#add_product_to_cart_form input[name='product_id']\").val(product_id);\n  });\n});\n</script>\n</body>\n</html>\n\n```\n\nThis is a basic example of how you can create a purchase functionality using PHP. The code includes functions to retrieve products from the database, add products to cart, and checkout. It also uses HTML forms for user input and jQuery for event handling.\n\nPlease note that this is just an example, and you will need to modify it to fit your specific needs. Additionally, make sure to secure your database connection by using prepared statements or another form of SQL injection prevention.", "code_blocks": [null, "```php\n<?php\n\n// Connect to the database\n$conn = new mysqli(\"localhost\", \"username\", \"password\", \"database\");\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Get products from the database\nfunction getProducts() {\n  global $conn;\n  $query = \"SELECT * FROM products\";\n  $result = $conn->query($query);\n\n  if ($result->num_rows > 0) {\n    while($row = $result->fetch_assoc()) {\n      echo \"<div class='product'>\";\n      echo \"<h2>\" . $row[\"name\"] . \"</h2>\";\n      echo \"<p>Price: $\" . $row[\"price\"] . \"</p>\";\n      echo \"<button class='add-to-cart' data-id='\" . $row[\"id\"] . \"'>Add to Cart</button>\";\n      echo \"</div>\";\n    }\n  } else {\n    echo \"0 results\";\n  }\n}\n\n// Add product to cart\nfunction addProductToCart() {\n  global $conn;\n  if (isset($_POST['product_id'])) {\n    $product_id = $_POST['product_id'];\n    $customer_name = $_POST['customer_name'];\n\n    // Check if the product exists in the cart\n    $query = \"SELECT * FROM order_items WHERE product_id = '$product_id' AND customer_name = '$customer_name'\";\n    $result = $conn->query($query);\n\n    if ($result->num_rows > 0) {\n      echo \"Product already added to your cart\";\n    } else {\n      // Add the product to the cart\n      $query = \"INSERT INTO order_items (order_id, product_id, quantity) VALUES (NULL, '$product_id', '1')\";\n      $conn->query($query);\n      echo \"Product added successfully to your cart!\";\n    }\n  }\n}\n\n// Checkout functionality\nfunction checkout() {\n  global $conn;\n  if (isset($_POST['customer_name'])) {\n    $customer_name = $_POST['customer_name'];\n    $order_date = date(\"Y-m-d\");\n\n    // Insert new order into the database\n    $query = \"INSERT INTO orders (customer_name, order_date) VALUES ('$customer_name', '$order_date')\";\n    $conn->query($query);\n\n    // Get the latest order ID\n    $latest_order_id = $conn->insert_id;\n\n    // Update the order items with the new order ID\n    $query = \"UPDATE order_items SET order_id = '$latest_order_id'\";\n    $conn->query($query);\n    echo \"Order created successfully!\";\n  }\n}\n\n// Execute functions based on user actions\nif (isset($_POST['action'])) {\n  if ($_POST['action'] == 'add_product_to_cart') {\n    addProductToCart();\n  } elseif ($_POST['action'] == 'checkout') {\n    checkout();\n  }\n}\n\n?>\n\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n<meta charset=\"UTF-8\">\n<title>Online Store</title>\n<style>\n.product {\n  border: 1px solid #ccc;\n  padding: 10px;\n}\n.add-to-cart {\n  background-color: #4CAF50;\n  color: white;\n  padding: 10px 20px;\n  border: none;\n  cursor: pointer;\n}\n.add-to-cart:hover {\n  background-color: #3e8e41;\n}\n</style>\n</head>\n\n<body>\n<h1>Online Store</h1>\n<div class=\"products\">\n<?php getProducts(); ?>\n</div>\n\n<!-- Add product to cart form -->\n<form id=\"add_product_to_cart_form\" action=\"\" method=\"post\">\n  <input type=\"hidden\" name=\"product_id\" value=\"\">\n  <button type=\"submit\" class=\"add-to-cart\">Add to Cart</button>\n</form>\n\n<!-- Checkout form -->\n<form id=\"checkout_form\" action=\"\" method=\"post\">\n  <label for=\"customer_name\">Customer Name:</label>\n  <input type=\"text\" name=\"customer_name\" required>\n  <button type=\"submit\" class=\"add-to-cart\">Checkout</button>\n</form>\n\n<script src=\"https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js\"></script>\n<script>\n$(document).ready(function() {\n  $(\".add-to-cart\").on(\"click\", function() {\n    var product_id = $(this).data('id');\n    $(\"#add_product_to_cart_form input[name='product_id']\").val(product_id);\n  });\n});\n</script>\n</body>\n</html>\n\n```"]}
