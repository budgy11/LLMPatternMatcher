{"prompt": "Create a purchase functionality using php", "llm_output": "Here is an example of a simple purchase functionality using PHP:\n\n**Note:** This is a basic example and you should consider implementing security measures such as encryption, authentication, and validation to make your code more secure.\n\n**Database Schema:**\n```sql\nCREATE TABLE products (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  name VARCHAR(255),\n  price DECIMAL(10,2)\n);\n\nCREATE TABLE orders (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  customer_name VARCHAR(255),\n  order_date DATE,\n  total DECIMAL(10,2)\n);\n\nCREATE TABLE order_items (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  order_id INT,\n  product_id INT,\n  quantity INT\n);\n```\n**PHP Code:**\n```php\n// config.php (database connection settings)\n$db_host = 'localhost';\n$db_username = 'root';\n$db_password = '';\n$db_name = 'your_database';\n\n// functions.php (functions for database interactions)\nfunction connectDB() {\n  global $db_host, $db_username, $db_password, $db_name;\n  $conn = new mysqli($db_host, $db_username, $db_password, $db_name);\n  if ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n  }\n  return $conn;\n}\n\nfunction getProducts() {\n  global $conn;\n  $query = \"SELECT * FROM products\";\n  $result = $conn->query($query);\n  return $result;\n}\n\nfunction addProductToCart($product_id, $quantity) {\n  global $conn;\n  $query = \"INSERT INTO order_items (order_id, product_id, quantity) VALUES ('', '$product_id', '$quantity')\";\n  $conn->query($query);\n}\n\nfunction checkout() {\n  global $conn;\n  // Get total cost of items in cart\n  $total = 0;\n  $query = \"SELECT SUM(p.price * oi.quantity) as total FROM products p INNER JOIN order_items oi ON p.id = oi.product_id\";\n  $result = $conn->query($query);\n  $row = $result->fetch_assoc();\n  $total = $row['total'];\n  \n  // Create new order\n  $query = \"INSERT INTO orders (customer_name, order_date, total) VALUES ('', CURDATE(), '$total')\";\n  $conn->query($query);\n  \n  // Update product quantities and remove items from cart\n  $query = \"UPDATE products SET quantity = quantity - oi.quantity FROM products p INNER JOIN order_items oi ON p.id = oi.product_id\";\n  $conn->query($query);\n  \n  // Clear cart\n  $query = \"TRUNCATE TABLE order_items\";\n  $conn->query($query);\n}\n\n// index.php (display products and allow user to add to cart)\n<?php\nrequire_once 'config.php';\n$conn = connectDB();\n\n// Display products\n$result = getProducts();\nwhile ($row = $result->fetch_assoc()) {\n  echo '<div>';\n  echo '<h2>' . $row['name'] . '</h2>';\n  echo '<p>Price: ' . $row['price'] . '</p>';\n  echo '<form action=\"\" method=\"post\">';\n  echo '<input type=\"hidden\" name=\"product_id\" value=\"' . $row['id'] . '\">';\n  echo '<label for=\"quantity\">Quantity:</label>';\n  echo '<input type=\"number\" id=\"quantity\" name=\"quantity\">';\n  echo '<button type=\"submit\">Add to Cart</button>';\n  echo '</form>';\n  echo '</div>';\n}\n\nif (isset($_POST['product_id'])) {\n  addProductToCart($_POST['product_id'], $_POST['quantity']);\n}\n\n// Allow user to checkout\necho '<form action=\"\" method=\"post\">';\necho '<button type=\"submit\">Checkout</button>';\necho '</form>';\n\n?>\n```\n**Explanation:**\n\n* The `config.php` file contains the database connection settings.\n* The `functions.php` file contains functions for interacting with the database, such as connecting to the database, getting products, adding a product to cart, and checking out.\n* The `index.php` file displays products and allows the user to add to cart. When the user clicks \"Add to Cart\", it calls the `addProductToCart` function to update the cart. When the user clicks \"Checkout\", it calls the `checkout` function to process the order.\n\nNote: This is a basic example, you should consider implementing security measures such as encryption, authentication, and validation to make your code more secure.", "code_blocks": [null, "```php\n// config.php (database connection settings)\n$db_host = 'localhost';\n$db_username = 'root';\n$db_password = '';\n$db_name = 'your_database';\n\n// functions.php (functions for database interactions)\nfunction connectDB() {\n  global $db_host, $db_username, $db_password, $db_name;\n  $conn = new mysqli($db_host, $db_username, $db_password, $db_name);\n  if ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n  }\n  return $conn;\n}\n\nfunction getProducts() {\n  global $conn;\n  $query = \"SELECT * FROM products\";\n  $result = $conn->query($query);\n  return $result;\n}\n\nfunction addProductToCart($product_id, $quantity) {\n  global $conn;\n  $query = \"INSERT INTO order_items (order_id, product_id, quantity) VALUES ('', '$product_id', '$quantity')\";\n  $conn->query($query);\n}\n\nfunction checkout() {\n  global $conn;\n  // Get total cost of items in cart\n  $total = 0;\n  $query = \"SELECT SUM(p.price * oi.quantity) as total FROM products p INNER JOIN order_items oi ON p.id = oi.product_id\";\n  $result = $conn->query($query);\n  $row = $result->fetch_assoc();\n  $total = $row['total'];\n  \n  // Create new order\n  $query = \"INSERT INTO orders (customer_name, order_date, total) VALUES ('', CURDATE(), '$total')\";\n  $conn->query($query);\n  \n  // Update product quantities and remove items from cart\n  $query = \"UPDATE products SET quantity = quantity - oi.quantity FROM products p INNER JOIN order_items oi ON p.id = oi.product_id\";\n  $conn->query($query);\n  \n  // Clear cart\n  $query = \"TRUNCATE TABLE order_items\";\n  $conn->query($query);\n}\n\n// index.php (display products and allow user to add to cart)\n<?php\nrequire_once 'config.php';\n$conn = connectDB();\n\n// Display products\n$result = getProducts();\nwhile ($row = $result->fetch_assoc()) {\n  echo '<div>';\n  echo '<h2>' . $row['name'] . '</h2>';\n  echo '<p>Price: ' . $row['price'] . '</p>';\n  echo '<form action=\"\" method=\"post\">';\n  echo '<input type=\"hidden\" name=\"product_id\" value=\"' . $row['id'] . '\">';\n  echo '<label for=\"quantity\">Quantity:</label>';\n  echo '<input type=\"number\" id=\"quantity\" name=\"quantity\">';\n  echo '<button type=\"submit\">Add to Cart</button>';\n  echo '</form>';\n  echo '</div>';\n}\n\nif (isset($_POST['product_id'])) {\n  addProductToCart($_POST['product_id'], $_POST['quantity']);\n}\n\n// Allow user to checkout\necho '<form action=\"\" method=\"post\">';\necho '<button type=\"submit\">Checkout</button>';\necho '</form>';\n\n?>\n```"]}
