{"prompt": "Create a purchase functionality using php", "llm_output": "Here is an example of how to create a simple purchase functionality in PHP:\n\n**purchase.php**\n```php\n<?php\n// Database connection settings\n$servername = \"localhost\";\n$username = \"root\";\n$password = \"\";\n$dbname = \"store\";\n\n// Create a new PDO instance\n$conn = new PDO(\"mysql:host=$servername;dbname=$dbname\", $username, $password);\n\n// Function to add product to cart\nfunction add_product_to_cart($product_id) {\n  global $conn;\n  // Get the current session user ID\n  $user_id = $_SESSION['user_id'];\n  \n  // Check if product is already in cart\n  $stmt = $conn->prepare(\"SELECT * FROM cart WHERE user_id = :user_id AND product_id = :product_id\");\n  $stmt->bindParam(\":user_id\", $user_id);\n  $stmt->bindParam(\":product_id\", $product_id);\n  $stmt->execute();\n  \n  if ($stmt->rowCount() == 0) {\n    // Add product to cart\n    $stmt = $conn->prepare(\"INSERT INTO cart (user_id, product_id) VALUES (:user_id, :product_id)\");\n    $stmt->bindParam(\":user_id\", $user_id);\n    $stmt->bindParam(\":product_id\", $product_id);\n    $stmt->execute();\n  }\n}\n\n// Function to purchase products in cart\nfunction purchase_products() {\n  global $conn;\n  \n  // Get the current session user ID and product IDs in cart\n  $user_id = $_SESSION['user_id'];\n  $product_ids = array();\n  \n  // Retrieve product IDs from cart\n  $stmt = $conn->prepare(\"SELECT product_id FROM cart WHERE user_id = :user_id\");\n  $stmt->bindParam(\":user_id\", $user_id);\n  $stmt->execute();\n  \n  while ($row = $stmt->fetch(PDO::FETCH_ASSOC)) {\n    $product_ids[] = $row['product_id'];\n  }\n  \n  // Update product stock levels\n  foreach ($product_ids as $product_id) {\n    $stmt = $conn->prepare(\"UPDATE products SET stock_level = stock_level - 1 WHERE id = :product_id\");\n    $stmt->bindParam(\":product_id\", $product_id);\n    $stmt->execute();\n  }\n  \n  // Remove products from cart\n  $stmt = $conn->prepare(\"DELETE FROM cart WHERE user_id = :user_id\");\n  $stmt->bindParam(\":user_id\", $user_id);\n  $stmt->execute();\n}\n\n// Check if form has been submitted\nif (isset($_POST['submit'])) {\n  $product_id = $_POST['product_id'];\n  \n  // Add product to cart and purchase products in cart\n  add_product_to_cart($product_id);\n  purchase_products();\n  \n  header(\"Location: index.php\");\n}\n?>\n```\n**index.php**\n```php\n<?php\n// Include the database connection settings\ninclude_once \"purchase.php\";\n?>\n\n<!-- Create a form to submit product ID -->\n<form action=\"purchase.php\" method=\"post\">\n  <input type=\"hidden\" name=\"product_id\" value=\"<?php echo $_GET['id']; ?>\">\n  <button type=\"submit\" name=\"submit\">Purchase</button>\n</form>\n```\n**products table**\n\n```sql\nCREATE TABLE products (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  name VARCHAR(255),\n  price DECIMAL(10,2),\n  stock_level INT DEFAULT 0\n);\n```\n\n**cart table**\n\n```sql\nCREATE TABLE cart (\n  user_id INT,\n  product_id INT,\n  PRIMARY KEY (user_id, product_id)\n);\n```\nThis code creates two functions: `add_product_to_cart` and `purchase_products`. The first function adds a product to the cart for the current session user. The second function retrieves all products in the cart for the current session user, updates their stock levels, and removes them from the cart.\n\nThe code also includes a simple form in `index.php` that allows users to submit a product ID to add it to their cart and purchase it.\n\nNote: This is a simplified example and should not be used as-is in production. You may need to modify it to fit your specific use case and database schema.", "code_blocks": ["```php\n<?php\n// Database connection settings\n$servername = \"localhost\";\n$username = \"root\";\n$password = \"\";\n$dbname = \"store\";\n\n// Create a new PDO instance\n$conn = new PDO(\"mysql:host=$servername;dbname=$dbname\", $username, $password);\n\n// Function to add product to cart\nfunction add_product_to_cart($product_id) {\n  global $conn;\n  // Get the current session user ID\n  $user_id = $_SESSION['user_id'];\n  \n  // Check if product is already in cart\n  $stmt = $conn->prepare(\"SELECT * FROM cart WHERE user_id = :user_id AND product_id = :product_id\");\n  $stmt->bindParam(\":user_id\", $user_id);\n  $stmt->bindParam(\":product_id\", $product_id);\n  $stmt->execute();\n  \n  if ($stmt->rowCount() == 0) {\n    // Add product to cart\n    $stmt = $conn->prepare(\"INSERT INTO cart (user_id, product_id) VALUES (:user_id, :product_id)\");\n    $stmt->bindParam(\":user_id\", $user_id);\n    $stmt->bindParam(\":product_id\", $product_id);\n    $stmt->execute();\n  }\n}\n\n// Function to purchase products in cart\nfunction purchase_products() {\n  global $conn;\n  \n  // Get the current session user ID and product IDs in cart\n  $user_id = $_SESSION['user_id'];\n  $product_ids = array();\n  \n  // Retrieve product IDs from cart\n  $stmt = $conn->prepare(\"SELECT product_id FROM cart WHERE user_id = :user_id\");\n  $stmt->bindParam(\":user_id\", $user_id);\n  $stmt->execute();\n  \n  while ($row = $stmt->fetch(PDO::FETCH_ASSOC)) {\n    $product_ids[] = $row['product_id'];\n  }\n  \n  // Update product stock levels\n  foreach ($product_ids as $product_id) {\n    $stmt = $conn->prepare(\"UPDATE products SET stock_level = stock_level - 1 WHERE id = :product_id\");\n    $stmt->bindParam(\":product_id\", $product_id);\n    $stmt->execute();\n  }\n  \n  // Remove products from cart\n  $stmt = $conn->prepare(\"DELETE FROM cart WHERE user_id = :user_id\");\n  $stmt->bindParam(\":user_id\", $user_id);\n  $stmt->execute();\n}\n\n// Check if form has been submitted\nif (isset($_POST['submit'])) {\n  $product_id = $_POST['product_id'];\n  \n  // Add product to cart and purchase products in cart\n  add_product_to_cart($product_id);\n  purchase_products();\n  \n  header(\"Location: index.php\");\n}\n?>\n```", "```php\n<?php\n// Include the database connection settings\ninclude_once \"purchase.php\";\n?>\n\n<!-- Create a form to submit product ID -->\n<form action=\"purchase.php\" method=\"post\">\n  <input type=\"hidden\" name=\"product_id\" value=\"<?php echo $_GET['id']; ?>\">\n  <button type=\"submit\" name=\"submit\">Purchase</button>\n</form>\n```", null, null]}
