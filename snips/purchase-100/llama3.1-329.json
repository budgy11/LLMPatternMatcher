{"prompt": "Create a purchase functionality using php", "llm_output": "Here is an example of a basic purchase functionality using PHP:\n\n**Note:** This example assumes you have a MySQL database set up with the following tables:\n\n* `products` table:\n\t+ `id` (primary key)\n\t+ `name`\n\t+ `price`\n* `carts` table:\n\t+ `id` (primary key)\n\t+ `user_id` (foreign key referencing the users table)\n\t+ `product_id` (foreign key referencing the products table)\n* `orders` table:\n\t+ `id` (primary key)\n\t+ `user_id` (foreign key referencing the users table)\n\t+ `total_price`\n\t+ `status`\n\n**purchase.php**\n```php\n<?php\n\n// Database connection settings\n$dbHost = 'localhost';\n$dbUsername = 'root';\n$dbPassword = '';\n$dbName = 'your_database_name';\n\n// Create a database connection\n$conn = new mysqli($dbHost, $dbUsername, $dbPassword, $dbName);\n\n// Check if the connection was successful\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Get the product ID from the URL query string\n$product_id = $_GET['product_id'];\n\n// Check if a user is logged in (for security reasons)\nif (!isset($_SESSION['user_id'])) {\n    echo 'You must be logged in to make a purchase.';\n    exit;\n}\n\n// Retrieve the product details from the database\n$stmt = $conn->prepare(\"SELECT * FROM products WHERE id = ?\");\n$stmt->bind_param('i', $product_id);\n$stmt->execute();\n$product = $stmt->get_result()->fetch_assoc();\n\n// Check if the product exists\nif (!$product) {\n    echo 'Product not found.';\n    exit;\n}\n\n// Add the product to the user's cart (cart is assumed to be already created)\n$stmt = $conn->prepare(\"INSERT INTO carts (user_id, product_id) VALUES (?, ?)\");\n$stmt->bind_param('ii', $_SESSION['user_id'], $product_id);\n$stmt->execute();\n\n// Update the cart quantity\n$stmt = $conn->prepare(\"UPDATE carts SET quantity = quantity + 1 WHERE user_id = ? AND product_id = ?\");\n$stmt->bind_param('ii', $_SESSION['user_id'], $product_id);\n$stmt->execute();\n\n// Calculate the new total price for the order\n$total_price = 0;\n$stmt = $conn->prepare(\"SELECT * FROM carts WHERE user_id = ?\");\n$stmt->bind_param('i', $_SESSION['user_id']);\n$stmt->execute();\n$carts = $stmt->get_result()->fetch_all(MYSQLI_ASSOC);\n\nforeach ($carts as $cart) {\n    $product_price = get_product_price($cart['product_id'], $conn);\n    $total_price += $product_price * $cart['quantity'];\n}\n\n// Create a new order\n$stmt = $conn->prepare(\"INSERT INTO orders (user_id, total_price, status) VALUES (?, ?, ?)\");\n$stmt->bind_param('iii', $_SESSION['user_id'], $total_price, 0); // pending status\n$stmt->execute();\n\n// Update the cart quantity and remove the product from the user's cart\n$stmt = $conn->prepare(\"UPDATE carts SET quantity = quantity - 1 WHERE user_id = ? AND product_id = ?\");\n$stmt->bind_param('ii', $_SESSION['user_id'], $product_id);\n$stmt->execute();\n$stmt = $conn->prepare(\"DELETE FROM carts WHERE user_id = ? AND product_id = ?\");\n$stmt->bind_param('ii', $_SESSION['user_id'], $product_id);\n$stmt->execute();\n\n// Redirect to the order summary page\nheader('Location: order_summary.php');\nexit;\n\n// Helper function to retrieve a product's price from the database\nfunction get_product_price($product_id, $conn) {\n    $stmt = $conn->prepare(\"SELECT price FROM products WHERE id = ?\");\n    $stmt->bind_param('i', $product_id);\n    $stmt->execute();\n    return $stmt->get_result()->fetch_assoc()['price'];\n}\n\n?>\n```\n**order_summary.php**\n```php\n<?php\n\n// Retrieve the order details from the database\n$stmt = $conn->prepare(\"SELECT * FROM orders WHERE user_id = ?\");\n$stmt->bind_param('i', $_SESSION['user_id']);\n$stmt->execute();\n$order = $stmt->get_result()->fetch_assoc();\n\n// Display the order summary\necho 'Order Summary:';\n\necho '<ul>';\necho '<li>Order ID: ' . $order['id'] . '</li>';\necho '<li>Total Price: $\" . number_format($order['total_price']) . \"</li>\";\necho '<li>Status: Pending</li>';\necho '</ul>';\n\n// Display the products in the order\n$stmt = $conn->prepare(\"SELECT * FROM carts WHERE user_id = ?\");\n$stmt->bind_param('i', $_SESSION['user_id']);\n$stmt->execute();\n$carts = $stmt->get_result()->fetch_all(MYSQLI_ASSOC);\n\nforeach ($carts as $cart) {\n    echo '<h2>' . get_product_name($cart['product_id'], $conn) . '</h2>';\n    echo 'Quantity: ' . $cart['quantity'] . '<br>';\n}\n\n// Helper function to retrieve a product's name from the database\nfunction get_product_name($product_id, $conn) {\n    $stmt = $conn->prepare(\"SELECT name FROM products WHERE id = ?\");\n    $stmt->bind_param('i', $product_id);\n    $stmt->execute();\n    return $stmt->get_result()->fetch_assoc()['name'];\n}\n\n?>\n```\nNote that this is a basic example and you should modify it to fit your specific needs. You may also want to add error handling, validation, and security measures to the code.\n\nAlso, please note that this example uses `$_SESSION` variables to store the user's ID, which assumes that you have already implemented session management in your application.\n\nPlease let me know if you need any further assistance!", "code_blocks": ["```php\n<?php\n\n// Database connection settings\n$dbHost = 'localhost';\n$dbUsername = 'root';\n$dbPassword = '';\n$dbName = 'your_database_name';\n\n// Create a database connection\n$conn = new mysqli($dbHost, $dbUsername, $dbPassword, $dbName);\n\n// Check if the connection was successful\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Get the product ID from the URL query string\n$product_id = $_GET['product_id'];\n\n// Check if a user is logged in (for security reasons)\nif (!isset($_SESSION['user_id'])) {\n    echo 'You must be logged in to make a purchase.';\n    exit;\n}\n\n// Retrieve the product details from the database\n$stmt = $conn->prepare(\"SELECT * FROM products WHERE id = ?\");\n$stmt->bind_param('i', $product_id);\n$stmt->execute();\n$product = $stmt->get_result()->fetch_assoc();\n\n// Check if the product exists\nif (!$product) {\n    echo 'Product not found.';\n    exit;\n}\n\n// Add the product to the user's cart (cart is assumed to be already created)\n$stmt = $conn->prepare(\"INSERT INTO carts (user_id, product_id) VALUES (?, ?)\");\n$stmt->bind_param('ii', $_SESSION['user_id'], $product_id);\n$stmt->execute();\n\n// Update the cart quantity\n$stmt = $conn->prepare(\"UPDATE carts SET quantity = quantity + 1 WHERE user_id = ? AND product_id = ?\");\n$stmt->bind_param('ii', $_SESSION['user_id'], $product_id);\n$stmt->execute();\n\n// Calculate the new total price for the order\n$total_price = 0;\n$stmt = $conn->prepare(\"SELECT * FROM carts WHERE user_id = ?\");\n$stmt->bind_param('i', $_SESSION['user_id']);\n$stmt->execute();\n$carts = $stmt->get_result()->fetch_all(MYSQLI_ASSOC);\n\nforeach ($carts as $cart) {\n    $product_price = get_product_price($cart['product_id'], $conn);\n    $total_price += $product_price * $cart['quantity'];\n}\n\n// Create a new order\n$stmt = $conn->prepare(\"INSERT INTO orders (user_id, total_price, status) VALUES (?, ?, ?)\");\n$stmt->bind_param('iii', $_SESSION['user_id'], $total_price, 0); // pending status\n$stmt->execute();\n\n// Update the cart quantity and remove the product from the user's cart\n$stmt = $conn->prepare(\"UPDATE carts SET quantity = quantity - 1 WHERE user_id = ? AND product_id = ?\");\n$stmt->bind_param('ii', $_SESSION['user_id'], $product_id);\n$stmt->execute();\n$stmt = $conn->prepare(\"DELETE FROM carts WHERE user_id = ? AND product_id = ?\");\n$stmt->bind_param('ii', $_SESSION['user_id'], $product_id);\n$stmt->execute();\n\n// Redirect to the order summary page\nheader('Location: order_summary.php');\nexit;\n\n// Helper function to retrieve a product's price from the database\nfunction get_product_price($product_id, $conn) {\n    $stmt = $conn->prepare(\"SELECT price FROM products WHERE id = ?\");\n    $stmt->bind_param('i', $product_id);\n    $stmt->execute();\n    return $stmt->get_result()->fetch_assoc()['price'];\n}\n\n?>\n```", "```php\n<?php\n\n// Retrieve the order details from the database\n$stmt = $conn->prepare(\"SELECT * FROM orders WHERE user_id = ?\");\n$stmt->bind_param('i', $_SESSION['user_id']);\n$stmt->execute();\n$order = $stmt->get_result()->fetch_assoc();\n\n// Display the order summary\necho 'Order Summary:';\n\necho '<ul>';\necho '<li>Order ID: ' . $order['id'] . '</li>';\necho '<li>Total Price: $\" . number_format($order['total_price']) . \"</li>\";\necho '<li>Status: Pending</li>';\necho '</ul>';\n\n// Display the products in the order\n$stmt = $conn->prepare(\"SELECT * FROM carts WHERE user_id = ?\");\n$stmt->bind_param('i', $_SESSION['user_id']);\n$stmt->execute();\n$carts = $stmt->get_result()->fetch_all(MYSQLI_ASSOC);\n\nforeach ($carts as $cart) {\n    echo '<h2>' . get_product_name($cart['product_id'], $conn) . '</h2>';\n    echo 'Quantity: ' . $cart['quantity'] . '<br>';\n}\n\n// Helper function to retrieve a product's name from the database\nfunction get_product_name($product_id, $conn) {\n    $stmt = $conn->prepare(\"SELECT name FROM products WHERE id = ?\");\n    $stmt->bind_param('i', $product_id);\n    $stmt->execute();\n    return $stmt->get_result()->fetch_assoc()['name'];\n}\n\n?>\n```"]}
