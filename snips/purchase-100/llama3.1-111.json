{"prompt": "Create a purchase functionality using php", "llm_output": "Here's an example of how to create a basic purchase functionality using PHP:\n\n**Database Schema:**\n\nFirst, let's assume we have the following database schema:\n```sql\nCREATE TABLE products (\n  id INT PRIMARY KEY,\n  name VARCHAR(255),\n  price DECIMAL(10,2)\n);\n\nCREATE TABLE orders (\n  id INT PRIMARY KEY,\n  customer_name VARCHAR(255),\n  order_date DATE,\n  total DECIMAL(10,2)\n);\n\nCREATE TABLE order_items (\n  id INT PRIMARY KEY,\n  order_id INT,\n  product_id INT,\n  quantity INT\n);\n```\n**PHP Code:**\n\nWe'll create a `purchase.php` file with the following code:\n```php\n<?php\n\n// Configuration\ndefine('DB_HOST', 'localhost');\ndefine('DB_USERNAME', 'root');\ndefine('DB_PASSWORD', '');\ndefine('DB_NAME', 'store');\n\n// Connect to database\n$conn = new mysqli(DB_HOST, DB_USERNAME, DB_PASSWORD, DB_NAME);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Function to get products\nfunction getProducts() {\n    global $conn;\n    $query = \"SELECT * FROM products\";\n    $result = $conn->query($query);\n    return $result;\n}\n\n// Function to process purchase\nfunction processPurchase() {\n    global $conn;\n    if ($_SERVER[\"REQUEST_METHOD\"] == \"POST\") {\n        // Get data from form\n        $customerName = $_POST['customer_name'];\n        $productId = $_POST['product_id'];\n        $quantity = $_POST['quantity'];\n\n        // Validate input\n        if (empty($customerName) || empty($productId) || empty($quantity)) {\n            echo \"Error: Please fill in all fields.\";\n            return;\n        }\n\n        // Get product price and quantity available\n        $query = \"SELECT * FROM products WHERE id = '$productId'\";\n        $result = $conn->query($query);\n        if ($result->num_rows > 0) {\n            $productData = $result->fetch_assoc();\n            $price = $productData['price'];\n            $availableQuantity = $productData['quantity'];\n\n            // Check if quantity is available\n            if ($availableQuantity < $quantity) {\n                echo \"Error: Not enough quantity available.\";\n                return;\n            }\n\n            // Process order\n            $orderDate = date('Y-m-d');\n            $total = $price * $quantity;\n\n            // Insert order into database\n            $query = \"INSERT INTO orders (customer_name, order_date, total) VALUES ('$customerName', '$orderDate', '$total')\";\n            $conn->query($query);\n\n            // Get order ID\n            $orderId = $conn->insert_id;\n\n            // Insert order item into database\n            $query = \"INSERT INTO order_items (order_id, product_id, quantity) VALUES ('$orderId', '$productId', '$quantity')\";\n            $conn->query($query);\n\n            echo \"Purchase successful!\";\n        } else {\n            echo \"Error: Product not found.\";\n        }\n    }\n}\n\n// Call function to process purchase\nprocessPurchase();\n\n?>\n```\n**HTML Form:**\n```html\n<form action=\"\" method=\"post\">\n  <label for=\"customer_name\">Customer Name:</label>\n  <input type=\"text\" id=\"customer_name\" name=\"customer_name\"><br><br>\n  <label for=\"product_id\">Product ID:</label>\n  <select id=\"product_id\" name=\"product_id\">\n    <?php\n      $products = getProducts();\n      while ($row = $products->fetch_assoc()) {\n        echo \"<option value='\" . $row['id'] . \"'>\" . $row['name'] . \"</option>\";\n      }\n    ?>\n  </select><br><br>\n  <label for=\"quantity\">Quantity:</label>\n  <input type=\"number\" id=\"quantity\" name=\"quantity\"><br><br>\n  <button type=\"submit\">Purchase</button>\n</form>\n```\n**How it works:**\n\n1. When the form is submitted, the `processPurchase()` function is called.\n2. The function checks if all required fields are filled in and validates the input data.\n3. It then gets the product price and quantity available from the database.\n4. If the quantity is available, it processes the order by inserting a new record into the `orders` table and creating an entry for each product in the `order_items` table.\n5. Finally, it displays a success message to the user.\n\n**Note:** This is a basic example and you should consider implementing additional features such as:\n\n* Handling errors and exceptions\n* Implementing security measures (e.g., sanitizing input data)\n* Displaying order details and product information\n* Providing payment options (e.g., credit card, PayPal)\n\nAlso, this code assumes that the database connection is established using the `mysqli` extension. You should adjust the code to match your specific database setup.", "code_blocks": [null, "```php\n<?php\n\n// Configuration\ndefine('DB_HOST', 'localhost');\ndefine('DB_USERNAME', 'root');\ndefine('DB_PASSWORD', '');\ndefine('DB_NAME', 'store');\n\n// Connect to database\n$conn = new mysqli(DB_HOST, DB_USERNAME, DB_PASSWORD, DB_NAME);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Function to get products\nfunction getProducts() {\n    global $conn;\n    $query = \"SELECT * FROM products\";\n    $result = $conn->query($query);\n    return $result;\n}\n\n// Function to process purchase\nfunction processPurchase() {\n    global $conn;\n    if ($_SERVER[\"REQUEST_METHOD\"] == \"POST\") {\n        // Get data from form\n        $customerName = $_POST['customer_name'];\n        $productId = $_POST['product_id'];\n        $quantity = $_POST['quantity'];\n\n        // Validate input\n        if (empty($customerName) || empty($productId) || empty($quantity)) {\n            echo \"Error: Please fill in all fields.\";\n            return;\n        }\n\n        // Get product price and quantity available\n        $query = \"SELECT * FROM products WHERE id = '$productId'\";\n        $result = $conn->query($query);\n        if ($result->num_rows > 0) {\n            $productData = $result->fetch_assoc();\n            $price = $productData['price'];\n            $availableQuantity = $productData['quantity'];\n\n            // Check if quantity is available\n            if ($availableQuantity < $quantity) {\n                echo \"Error: Not enough quantity available.\";\n                return;\n            }\n\n            // Process order\n            $orderDate = date('Y-m-d');\n            $total = $price * $quantity;\n\n            // Insert order into database\n            $query = \"INSERT INTO orders (customer_name, order_date, total) VALUES ('$customerName', '$orderDate', '$total')\";\n            $conn->query($query);\n\n            // Get order ID\n            $orderId = $conn->insert_id;\n\n            // Insert order item into database\n            $query = \"INSERT INTO order_items (order_id, product_id, quantity) VALUES ('$orderId', '$productId', '$quantity')\";\n            $conn->query($query);\n\n            echo \"Purchase successful!\";\n        } else {\n            echo \"Error: Product not found.\";\n        }\n    }\n}\n\n// Call function to process purchase\nprocessPurchase();\n\n?>\n```", null]}
