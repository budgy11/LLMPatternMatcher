{"prompt": "Create a purchase functionality using php", "llm_output": "Here is an example of a basic purchase functionality in PHP:\n\n**`purchase.php`**\n```php\n<?php\n\n// Configuration\n$db_host = 'localhost';\n$db_username = 'username';\n$db_password = 'password';\n$db_name = 'database';\n\n// Connect to database\n$conn = new mysqli($db_host, $db_username, $db_password, $db_name);\n\n// Check connection\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Function to add product to cart\nfunction add_product_to_cart($product_id, $quantity) {\n    global $conn;\n    \n    // Check if product exists in database\n    $sql = \"SELECT * FROM products WHERE id = '$product_id'\";\n    $result = $conn->query($sql);\n    \n    if ($result->num_rows > 0) {\n        // Get product details\n        $row = $result->fetch_assoc();\n        \n        // Check if quantity is valid\n        if ($quantity <= $row['stock'] && $quantity >= 1) {\n            // Add product to cart\n            $sql = \"INSERT INTO cart (product_id, quantity)\n                    VALUES ('$product_id', '$quantity')\";\n            $conn->query($sql);\n            \n            echo \"Product added to cart successfully!\";\n        } else {\n            echo \"Invalid quantity. Please try again.\";\n        }\n    } else {\n        echo \"Product not found in database.\";\n    }\n}\n\n// Function to update product quantity in cart\nfunction update_product_quantity_in_cart($product_id, $new_quantity) {\n    global $conn;\n    \n    // Check if product exists in cart\n    $sql = \"SELECT * FROM cart WHERE product_id = '$product_id'\";\n    $result = $conn->query($sql);\n    \n    if ($result->num_rows > 0) {\n        // Get current quantity\n        $row = $result->fetch_assoc();\n        \n        // Update quantity\n        $sql = \"UPDATE cart SET quantity = '$new_quantity' WHERE product_id = '$product_id'\";\n        $conn->query($sql);\n        \n        echo \"Quantity updated successfully!\";\n    } else {\n        echo \"Product not found in cart.\";\n    }\n}\n\n// Function to remove product from cart\nfunction remove_product_from_cart($product_id) {\n    global $conn;\n    \n    // Check if product exists in cart\n    $sql = \"SELECT * FROM cart WHERE product_id = '$product_id'\";\n    $result = $conn->query($sql);\n    \n    if ($result->num_rows > 0) {\n        // Remove product from cart\n        $sql = \"DELETE FROM cart WHERE product_id = '$product_id'\";\n        $conn->query($sql);\n        \n        echo \"Product removed from cart successfully!\";\n    } else {\n        echo \"Product not found in cart.\";\n    }\n}\n\n// Function to checkout\nfunction checkout() {\n    global $conn;\n    \n    // Get total cost\n    $total_cost = 0;\n    $sql = \"SELECT * FROM cart\";\n    $result = $conn->query($sql);\n    \n    if ($result->num_rows > 0) {\n        while ($row = $result->fetch_assoc()) {\n            $product_id = $row['product_id'];\n            $quantity = $row['quantity'];\n            \n            // Get product price\n            $sql = \"SELECT * FROM products WHERE id = '$product_id'\";\n            $result2 = $conn->query($sql);\n            $row2 = $result2->fetch_assoc();\n            \n            $total_cost += ($quantity * $row2['price']);\n        }\n    }\n    \n    // Update stock\n    $sql = \"UPDATE products SET stock = stock - 1 WHERE id IN (SELECT product_id FROM cart)\";\n    $conn->query($sql);\n    \n    // Remove products from cart\n    $sql = \"DELETE FROM cart\";\n    $conn->query($sql);\n    \n    echo \"Checkout successful! Total cost: $\" . number_format($total_cost, 2) . \".\";\n}\n\n?>\n```\n**`index.php`**\n```php\n<?php include 'purchase.php'; ?>\n\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Purchase</title>\n</head>\n<body>\n\n    <!-- Form to add product to cart -->\n    <form action=\"\" method=\"post\">\n        <label for=\"product_id\">Product ID:</label>\n        <input type=\"text\" id=\"product_id\" name=\"product_id\"><br><br>\n        <label for=\"quantity\">Quantity:</label>\n        <input type=\"number\" id=\"quantity\" name=\"quantity\"><br><br>\n        <input type=\"submit\" value=\"Add to Cart\">\n    </form>\n\n    <!-- Form to update quantity in cart -->\n    <form action=\"\" method=\"post\">\n        <label for=\"product_id\">Product ID:</label>\n        <input type=\"text\" id=\"product_id\" name=\"product_id\"><br><br>\n        <label for=\"new_quantity\">New Quantity:</label>\n        <input type=\"number\" id=\"new_quantity\" name=\"new_quantity\"><br><br>\n        <input type=\"submit\" value=\"Update Quantity\">\n    </form>\n\n    <!-- Form to remove product from cart -->\n    <form action=\"\" method=\"post\">\n        <label for=\"product_id\">Product ID:</label>\n        <input type=\"text\" id=\"product_id\" name=\"product_id\"><br><br>\n        <input type=\"submit\" value=\"Remove from Cart\">\n    </form>\n\n    <!-- Form to checkout -->\n    <form action=\"\" method=\"post\">\n        <input type=\"submit\" value=\"Checkout\">\n    </form>\n\n</body>\n</html>\n\n<?php\n\n// Handle form submissions\nif (isset($_POST['product_id'])) {\n    add_product_to_cart($_POST['product_id'], $_POST['quantity']);\n}\n\nif (isset($_POST['new_quantity'])) {\n    update_product_quantity_in_cart($_POST['product_id'], $_POST['new_quantity']);\n}\n\nif (isset($_POST['remove'])) {\n    remove_product_from_cart($_POST['product_id']);\n}\n\nif (isset($_POST['checkout'])) {\n    checkout();\n}\n?>\n```\nThis code creates a basic purchase functionality with the following features:\n\n*   **Add product to cart:** Users can add products to their cart by entering the product ID and quantity.\n*   **Update quantity in cart:** Users can update the quantity of a product in their cart by entering the new quantity.\n*   **Remove product from cart:** Users can remove a product from their cart by entering the product ID.\n*   **Checkout:** Users can checkout by clicking on the \"Checkout\" button, which will calculate the total cost, update the stock, and remove the products from the cart.\n\nNote that this code assumes a basic database structure with two tables: `products` and `cart`. The `products` table has columns for product ID, price, and stock. The `cart` table has columns for product ID, quantity, and total cost.\n\nYou will need to modify the code to fit your specific use case and database schema.\n\nAlso note that this is a basic example and you should add proper error handling, validation, and security measures to make it production-ready.", "code_blocks": ["```php\n<?php\n\n// Configuration\n$db_host = 'localhost';\n$db_username = 'username';\n$db_password = 'password';\n$db_name = 'database';\n\n// Connect to database\n$conn = new mysqli($db_host, $db_username, $db_password, $db_name);\n\n// Check connection\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Function to add product to cart\nfunction add_product_to_cart($product_id, $quantity) {\n    global $conn;\n    \n    // Check if product exists in database\n    $sql = \"SELECT * FROM products WHERE id = '$product_id'\";\n    $result = $conn->query($sql);\n    \n    if ($result->num_rows > 0) {\n        // Get product details\n        $row = $result->fetch_assoc();\n        \n        // Check if quantity is valid\n        if ($quantity <= $row['stock'] && $quantity >= 1) {\n            // Add product to cart\n            $sql = \"INSERT INTO cart (product_id, quantity)\n                    VALUES ('$product_id', '$quantity')\";\n            $conn->query($sql);\n            \n            echo \"Product added to cart successfully!\";\n        } else {\n            echo \"Invalid quantity. Please try again.\";\n        }\n    } else {\n        echo \"Product not found in database.\";\n    }\n}\n\n// Function to update product quantity in cart\nfunction update_product_quantity_in_cart($product_id, $new_quantity) {\n    global $conn;\n    \n    // Check if product exists in cart\n    $sql = \"SELECT * FROM cart WHERE product_id = '$product_id'\";\n    $result = $conn->query($sql);\n    \n    if ($result->num_rows > 0) {\n        // Get current quantity\n        $row = $result->fetch_assoc();\n        \n        // Update quantity\n        $sql = \"UPDATE cart SET quantity = '$new_quantity' WHERE product_id = '$product_id'\";\n        $conn->query($sql);\n        \n        echo \"Quantity updated successfully!\";\n    } else {\n        echo \"Product not found in cart.\";\n    }\n}\n\n// Function to remove product from cart\nfunction remove_product_from_cart($product_id) {\n    global $conn;\n    \n    // Check if product exists in cart\n    $sql = \"SELECT * FROM cart WHERE product_id = '$product_id'\";\n    $result = $conn->query($sql);\n    \n    if ($result->num_rows > 0) {\n        // Remove product from cart\n        $sql = \"DELETE FROM cart WHERE product_id = '$product_id'\";\n        $conn->query($sql);\n        \n        echo \"Product removed from cart successfully!\";\n    } else {\n        echo \"Product not found in cart.\";\n    }\n}\n\n// Function to checkout\nfunction checkout() {\n    global $conn;\n    \n    // Get total cost\n    $total_cost = 0;\n    $sql = \"SELECT * FROM cart\";\n    $result = $conn->query($sql);\n    \n    if ($result->num_rows > 0) {\n        while ($row = $result->fetch_assoc()) {\n            $product_id = $row['product_id'];\n            $quantity = $row['quantity'];\n            \n            // Get product price\n            $sql = \"SELECT * FROM products WHERE id = '$product_id'\";\n            $result2 = $conn->query($sql);\n            $row2 = $result2->fetch_assoc();\n            \n            $total_cost += ($quantity * $row2['price']);\n        }\n    }\n    \n    // Update stock\n    $sql = \"UPDATE products SET stock = stock - 1 WHERE id IN (SELECT product_id FROM cart)\";\n    $conn->query($sql);\n    \n    // Remove products from cart\n    $sql = \"DELETE FROM cart\";\n    $conn->query($sql);\n    \n    echo \"Checkout successful! Total cost: $\" . number_format($total_cost, 2) . \".\";\n}\n\n?>\n```", "```php\n<?php include 'purchase.php'; ?>\n\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Purchase</title>\n</head>\n<body>\n\n    <!-- Form to add product to cart -->\n    <form action=\"\" method=\"post\">\n        <label for=\"product_id\">Product ID:</label>\n        <input type=\"text\" id=\"product_id\" name=\"product_id\"><br><br>\n        <label for=\"quantity\">Quantity:</label>\n        <input type=\"number\" id=\"quantity\" name=\"quantity\"><br><br>\n        <input type=\"submit\" value=\"Add to Cart\">\n    </form>\n\n    <!-- Form to update quantity in cart -->\n    <form action=\"\" method=\"post\">\n        <label for=\"product_id\">Product ID:</label>\n        <input type=\"text\" id=\"product_id\" name=\"product_id\"><br><br>\n        <label for=\"new_quantity\">New Quantity:</label>\n        <input type=\"number\" id=\"new_quantity\" name=\"new_quantity\"><br><br>\n        <input type=\"submit\" value=\"Update Quantity\">\n    </form>\n\n    <!-- Form to remove product from cart -->\n    <form action=\"\" method=\"post\">\n        <label for=\"product_id\">Product ID:</label>\n        <input type=\"text\" id=\"product_id\" name=\"product_id\"><br><br>\n        <input type=\"submit\" value=\"Remove from Cart\">\n    </form>\n\n    <!-- Form to checkout -->\n    <form action=\"\" method=\"post\">\n        <input type=\"submit\" value=\"Checkout\">\n    </form>\n\n</body>\n</html>\n\n<?php\n\n// Handle form submissions\nif (isset($_POST['product_id'])) {\n    add_product_to_cart($_POST['product_id'], $_POST['quantity']);\n}\n\nif (isset($_POST['new_quantity'])) {\n    update_product_quantity_in_cart($_POST['product_id'], $_POST['new_quantity']);\n}\n\nif (isset($_POST['remove'])) {\n    remove_product_from_cart($_POST['product_id']);\n}\n\nif (isset($_POST['checkout'])) {\n    checkout();\n}\n?>\n```"]}
