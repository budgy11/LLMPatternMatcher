{"prompt": "Create a purchase functionality using php", "llm_output": "Here is an example of a basic purchase functionality using PHP. This example includes user registration, login, and a simple shopping cart system.\n\n**Database Setup**\n\nFirst, you'll need to set up your database with the following tables:\n\n```sql\nCREATE TABLE users (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  username VARCHAR(255) NOT NULL,\n  email VARCHAR(255) NOT NULL,\n  password_hash VARCHAR(255) NOT NULL\n);\n\nCREATE TABLE products (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  name VARCHAR(255) NOT NULL,\n  price DECIMAL(10,2) NOT NULL\n);\n\nCREATE TABLE cart (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  user_id INT NOT NULL,\n  product_id INT NOT NULL,\n  quantity INT NOT NULL DEFAULT 1,\n  FOREIGN KEY (user_id) REFERENCES users(id),\n  FOREIGN KEY (product_id) REFERENCES products(id)\n);\n```\n\n**PHP Code**\n\n**`config.php`**: Configuration file for database connection\n\n```php\n<?php\ndefine('DB_HOST', 'localhost');\ndefine('DB_USER', 'your_username');\ndefine('DB_PASSWORD', 'your_password');\ndefine('DB_NAME', 'your_database_name');\n\n$mysqli = new mysqli(DB_HOST, DB_USER, DB_PASSWORD, DB_NAME);\n\nif ($mysqli->connect_errno) {\n    echo \"Failed to connect to MySQL: (\" . $mysqli->connect_errno . \") \" . $mysqli->connect_error;\n}\n?>\n```\n\n**`register.php`**: User registration form\n\n```php\n<?php\nrequire_once 'config.php';\n\nif ($_SERVER['REQUEST_METHOD'] === 'POST') {\n    $username = $_POST['username'];\n    $email = $_POST['email'];\n    $password = password_hash($_POST['password'], PASSWORD_DEFAULT);\n\n    $query = \"INSERT INTO users (username, email, password_hash) VALUES (?, ?, ?)\";\n    $stmt = $mysqli->prepare($query);\n    $stmt->bind_param('ss', $username, $email, $password);\n    $stmt->execute();\n\n    header('Location: login.php');\n}\n?>\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Register</title>\n</head>\n<body>\n    <form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\">\n        Username: <input type=\"text\" name=\"username\"><br><br>\n        Email: <input type=\"email\" name=\"email\"><br><br>\n        Password: <input type=\"password\" name=\"password\"><br><br>\n        <input type=\"submit\" value=\"Register\">\n    </form>\n</body>\n</html>\n```\n\n**`login.php`**: User login form\n\n```php\n<?php\nrequire_once 'config.php';\n\nif ($_SERVER['REQUEST_METHOD'] === 'POST') {\n    $username = $_POST['username'];\n    $password = $_POST['password'];\n\n    $query = \"SELECT * FROM users WHERE username = ? AND password_hash = ?\";\n    $stmt = $mysqli->prepare($query);\n    $stmt->bind_param('ss', $username, $password);\n    $stmt->execute();\n    $result = $stmt->get_result();\n\n    if ($result->num_rows === 1) {\n        $_SESSION['user_id'] = $result->fetch_assoc()['id'];\n        header('Location: cart.php');\n    }\n}\n?>\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Login</title>\n</head>\n<body>\n    <form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\">\n        Username: <input type=\"text\" name=\"username\"><br><br>\n        Password: <input type=\"password\" name=\"password\"><br><br>\n        <input type=\"submit\" value=\"Login\">\n    </form>\n</body>\n</html>\n```\n\n**`cart.php`**: Shopping cart page\n\n```php\n<?php\nrequire_once 'config.php';\n\nif (!isset($_SESSION['user_id'])) {\n    header('Location: login.php');\n}\n\n$query = \"SELECT * FROM products\";\n$result = $mysqli->query($query);\n\n?>\n\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Shopping Cart</title>\n</head>\n<body>\n    <?php while ($product = $result->fetch_assoc()): ?>\n        Name: <?= $product['name']; ?> | Price: <?= $product['price']; ?><br><br>\n        <input type=\"number\" name=\"quantity\" value=\"1\">\n        <button onclick=\"addProduct(<?= $product['id']; ?>)\">Add to Cart</button>\n    <?php endwhile; ?>\n\n    <script>\n    function addProduct(productId) {\n        var quantity = document.querySelector(`[name=quantity][value=1]`).value;\n\n        $.ajax({\n            type: 'POST',\n            url: 'add_to_cart.php',\n            data: {productId: productId, quantity: quantity},\n            success: function() {\n                alert('Product added to cart!');\n            }\n        });\n    }\n    </script>\n</body>\n</html>\n```\n\n**`add_to_cart.php`**: Add product to cart\n\n```php\n<?php\nrequire_once 'config.php';\n\n$user_id = $_SESSION['user_id'];\n$productId = $_POST['productId'];\n$quantity = $_POST['quantity'];\n\n$query = \"INSERT INTO cart (user_id, product_id, quantity) VALUES (?, ?, ?)\";\n$stmt = $mysqli->prepare($query);\n$stmt->bind_param('iis', $user_id, $productId, $quantity);\n$stmt->execute();\n\n?>\n```\n\n**`product_details.php`**: Product details page\n\n```php\n<?php\nrequire_once 'config.php';\n\n$productId = $_GET['id'];\n\n$query = \"SELECT * FROM products WHERE id = ?\";\n$result = $mysqli->prepare($query);\n$result->bind_param('i', $productId);\n$result->execute();\n$product = $result->get_result()->fetch_assoc();\n\n?>\n\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Product Details</title>\n</head>\n<body>\n    Name: <?= $product['name']; ?> | Price: <?= $product['price']; ?>\n    <button onclick=\"buyNow()\">Buy Now</button>\n\n    <script>\n    function buyNow() {\n        $.ajax({\n            type: 'POST',\n            url: 'purchase.php',\n            data: {productId: <?= $productId; ?>},\n            success: function() {\n                alert('Product purchased!');\n            }\n        });\n    }\n    </script>\n</body>\n</html>\n```\n\n**`purchase.php`**: Finalize purchase\n\n```php\n<?php\nrequire_once 'config.php';\n\n$user_id = $_SESSION['user_id'];\n$productId = $_POST['productId'];\n\n$query = \"INSERT INTO purchases (user_id, product_id) VALUES (?, ?)\";\n$stmt = $mysqli->prepare($query);\n$stmt->bind_param('ii', $user_id, $productId);\n$stmt->execute();\n\n// Reduce quantity in cart\n$query = \"UPDATE cart SET quantity = quantity - 1 WHERE user_id = ? AND product_id = ?\";\n$stmt = $mysqli->prepare($query);\n$stmt->bind_param('ii', $user_id, $productId);\n$stmt->execute();\n?>\n```\n\nThis is a basic example and you should adjust it to your specific needs. Also, this code does not handle errors and edge cases, you should add proper error handling and validation.\n\nPlease note that this is just an example and in a real-world application, you would likely use more secure methods for storing passwords (e.g., bcrypt) and using prepared statements with parameterized queries to prevent SQL injection attacks.", "code_blocks": [null, "```php\n<?php\ndefine('DB_HOST', 'localhost');\ndefine('DB_USER', 'your_username');\ndefine('DB_PASSWORD', 'your_password');\ndefine('DB_NAME', 'your_database_name');\n\n$mysqli = new mysqli(DB_HOST, DB_USER, DB_PASSWORD, DB_NAME);\n\nif ($mysqli->connect_errno) {\n    echo \"Failed to connect to MySQL: (\" . $mysqli->connect_errno . \") \" . $mysqli->connect_error;\n}\n?>\n```", "```php\n<?php\nrequire_once 'config.php';\n\nif ($_SERVER['REQUEST_METHOD'] === 'POST') {\n    $username = $_POST['username'];\n    $email = $_POST['email'];\n    $password = password_hash($_POST['password'], PASSWORD_DEFAULT);\n\n    $query = \"INSERT INTO users (username, email, password_hash) VALUES (?, ?, ?)\";\n    $stmt = $mysqli->prepare($query);\n    $stmt->bind_param('ss', $username, $email, $password);\n    $stmt->execute();\n\n    header('Location: login.php');\n}\n?>\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Register</title>\n</head>\n<body>\n    <form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\">\n        Username: <input type=\"text\" name=\"username\"><br><br>\n        Email: <input type=\"email\" name=\"email\"><br><br>\n        Password: <input type=\"password\" name=\"password\"><br><br>\n        <input type=\"submit\" value=\"Register\">\n    </form>\n</body>\n</html>\n```", "```php\n<?php\nrequire_once 'config.php';\n\nif ($_SERVER['REQUEST_METHOD'] === 'POST') {\n    $username = $_POST['username'];\n    $password = $_POST['password'];\n\n    $query = \"SELECT * FROM users WHERE username = ? AND password_hash = ?\";\n    $stmt = $mysqli->prepare($query);\n    $stmt->bind_param('ss', $username, $password);\n    $stmt->execute();\n    $result = $stmt->get_result();\n\n    if ($result->num_rows === 1) {\n        $_SESSION['user_id'] = $result->fetch_assoc()['id'];\n        header('Location: cart.php');\n    }\n}\n?>\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Login</title>\n</head>\n<body>\n    <form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\">\n        Username: <input type=\"text\" name=\"username\"><br><br>\n        Password: <input type=\"password\" name=\"password\"><br><br>\n        <input type=\"submit\" value=\"Login\">\n    </form>\n</body>\n</html>\n```", "```php\n<?php\nrequire_once 'config.php';\n\nif (!isset($_SESSION['user_id'])) {\n    header('Location: login.php');\n}\n\n$query = \"SELECT * FROM products\";\n$result = $mysqli->query($query);\n\n?>\n\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Shopping Cart</title>\n</head>\n<body>\n    <?php while ($product = $result->fetch_assoc()): ?>\n        Name: <?= $product['name']; ?> | Price: <?= $product['price']; ?><br><br>\n        <input type=\"number\" name=\"quantity\" value=\"1\">\n        <button onclick=\"addProduct(<?= $product['id']; ?>)\">Add to Cart</button>\n    <?php endwhile; ?>\n\n    <script>\n    function addProduct(productId) {\n        var quantity = document.querySelector(`[name=quantity][value=1]`).value;\n\n        $.ajax({\n            type: 'POST',\n            url: 'add_to_cart.php',\n            data: {productId: productId, quantity: quantity},\n            success: function() {\n                alert('Product added to cart!');\n            }\n        });\n    }\n    </script>\n</body>\n</html>\n```", "```php\n<?php\nrequire_once 'config.php';\n\n$user_id = $_SESSION['user_id'];\n$productId = $_POST['productId'];\n$quantity = $_POST['quantity'];\n\n$query = \"INSERT INTO cart (user_id, product_id, quantity) VALUES (?, ?, ?)\";\n$stmt = $mysqli->prepare($query);\n$stmt->bind_param('iis', $user_id, $productId, $quantity);\n$stmt->execute();\n\n?>\n```", "```php\n<?php\nrequire_once 'config.php';\n\n$productId = $_GET['id'];\n\n$query = \"SELECT * FROM products WHERE id = ?\";\n$result = $mysqli->prepare($query);\n$result->bind_param('i', $productId);\n$result->execute();\n$product = $result->get_result()->fetch_assoc();\n\n?>\n\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Product Details</title>\n</head>\n<body>\n    Name: <?= $product['name']; ?> | Price: <?= $product['price']; ?>\n    <button onclick=\"buyNow()\">Buy Now</button>\n\n    <script>\n    function buyNow() {\n        $.ajax({\n            type: 'POST',\n            url: 'purchase.php',\n            data: {productId: <?= $productId; ?>},\n            success: function() {\n                alert('Product purchased!');\n            }\n        });\n    }\n    </script>\n</body>\n</html>\n```", "```php\n<?php\nrequire_once 'config.php';\n\n$user_id = $_SESSION['user_id'];\n$productId = $_POST['productId'];\n\n$query = \"INSERT INTO purchases (user_id, product_id) VALUES (?, ?)\";\n$stmt = $mysqli->prepare($query);\n$stmt->bind_param('ii', $user_id, $productId);\n$stmt->execute();\n\n// Reduce quantity in cart\n$query = \"UPDATE cart SET quantity = quantity - 1 WHERE user_id = ? AND product_id = ?\";\n$stmt = $mysqli->prepare($query);\n$stmt->bind_param('ii', $user_id, $productId);\n$stmt->execute();\n?>\n```"]}
