{"prompt": "Create a purchase functionality using php", "llm_output": "Here's an example of a basic purchase functionality in PHP. This will include creating a form for users to input their details and the product they wish to buy, as well as saving this data into a database.\n\nFirstly, we'll assume that you're working with MySQL as your database management system. Ensure you have PHP, MySQLi (or PDO for Prepared Statements) installed on your server.\n\n**Database Setup**\n\nWe will need two tables in our database:\n\n1. `products`: This table stores information about the products available for purchase.\n2. `purchases`: This table stores the records of all purchases made by users.\n\n```sql\nCREATE TABLE IF NOT EXISTS `products` (\n    `id` int(10) unsigned NOT NULL AUTO_INCREMENT,\n    `name` varchar(255) NOT NULL DEFAULT '',\n    `description` text NOT NULL,\n    `price` decimal(15,2) NOT NULL DEFAULT '0.00',\n    PRIMARY KEY (`id`)\n);\n\nCREATE TABLE IF NOT EXISTS `purchases` (\n    `id` int(10) unsigned NOT NULL AUTO_INCREMENT,\n    `product_id` int(10) unsigned NOT NULL,\n    `username` varchar(255) NOT NULL,\n    `email` varchar(255) NOT NULL DEFAULT '',\n    PRIMARY KEY (`id`)\n);\n```\n\n**PHP Code**\n\nFirst, let's create a PHP script to handle the purchase functionality.\n\n```php\n// Configuration for Database Connection\n$host = 'localhost';\n$dbname = 'your_database_name';\n$username = 'your_username';\n$password = 'your_password';\n\n// Create Connection\n$conn = new mysqli($host, $username, $password, $dbname);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Query to Select Products\n$query = \"SELECT * FROM products\";\n$result = $conn->query($query);\n\n?>\n\n<!-- Display Products -->\n<form action=\"\" method=\"post\">\n    <select name=\"product_id\" required>\n        <option value=\"\">Select a product</option>\n        <?php while ($row = $result->fetch_assoc()) { ?>\n            <option value=\"<?php echo $row['id']; ?>\">\n                <?php echo $row['name']; ?> | Price: <?php echo $row['price']; ?>\n            </option>\n        <?php } ?>\n    </select>\n\n    <!-- User Input -->\n    <input type=\"text\" name=\"username\" placeholder=\"Username\" required>\n    <input type=\"email\" name=\"email\" placeholder=\"Email Address\" required>\n\n    <!-- Submit Button -->\n    <button type=\"submit\">Purchase</button>\n</form>\n\n<?php\nif ($_SERVER['REQUEST_METHOD'] === 'POST') {\n    // Retrieve Selected Product ID\n    $product_id = $_POST['product_id'];\n    \n    // Insert Purchase into Database\n    $query = \"INSERT INTO purchases (product_id, username, email) VALUES ('$product_id', '\".$_POST['username'].\"','\".$_POST['email'].\"')\";\n    if ($conn->query($query)) {\n        echo 'Purchase made successfully!';\n    } else {\n        die(\"Error: \" . $conn->error);\n    }\n}\n?>\n\n<?php\n// Close the database connection\n$conn->close();\n?>\n```\n\n**Security Note**\n\nThis example uses a direct `mysqli` query which can be vulnerable to SQL injection attacks. To prevent this, always use prepared statements or parameterized queries.\n\n```php\n$stmt = $conn->prepare(\"INSERT INTO purchases (product_id, username, email) VALUES (?, ?, ?)\");\n$stmt->bind_param(\"iii\", $product_id, $_POST['username'], $_POST['email']);\nif ($stmt->execute()) {\n    echo 'Purchase made successfully!';\n} else {\n    die(\"Error: \" . $conn->error);\n}\n```\n\nRemember to replace placeholders like `localhost`, `your_database_name`, etc. with your actual database configuration.\n\nThis is a basic example and should be enhanced according to your specific requirements, including security measures.", "code_blocks": [null, "```php\n// Configuration for Database Connection\n$host = 'localhost';\n$dbname = 'your_database_name';\n$username = 'your_username';\n$password = 'your_password';\n\n// Create Connection\n$conn = new mysqli($host, $username, $password, $dbname);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Query to Select Products\n$query = \"SELECT * FROM products\";\n$result = $conn->query($query);\n\n?>\n\n<!-- Display Products -->\n<form action=\"\" method=\"post\">\n    <select name=\"product_id\" required>\n        <option value=\"\">Select a product</option>\n        <?php while ($row = $result->fetch_assoc()) { ?>\n            <option value=\"<?php echo $row['id']; ?>\">\n                <?php echo $row['name']; ?> | Price: <?php echo $row['price']; ?>\n            </option>\n        <?php } ?>\n    </select>\n\n    <!-- User Input -->\n    <input type=\"text\" name=\"username\" placeholder=\"Username\" required>\n    <input type=\"email\" name=\"email\" placeholder=\"Email Address\" required>\n\n    <!-- Submit Button -->\n    <button type=\"submit\">Purchase</button>\n</form>\n\n<?php\nif ($_SERVER['REQUEST_METHOD'] === 'POST') {\n    // Retrieve Selected Product ID\n    $product_id = $_POST['product_id'];\n    \n    // Insert Purchase into Database\n    $query = \"INSERT INTO purchases (product_id, username, email) VALUES ('$product_id', '\".$_POST['username'].\"','\".$_POST['email'].\"')\";\n    if ($conn->query($query)) {\n        echo 'Purchase made successfully!';\n    } else {\n        die(\"Error: \" . $conn->error);\n    }\n}\n?>\n\n<?php\n// Close the database connection\n$conn->close();\n?>\n```", "```php\n$stmt = $conn->prepare(\"INSERT INTO purchases (product_id, username, email) VALUES (?, ?, ?)\");\n$stmt->bind_param(\"iii\", $product_id, $_POST['username'], $_POST['email']);\nif ($stmt->execute()) {\n    echo 'Purchase made successfully!';\n} else {\n    die(\"Error: \" . $conn->error);\n}\n```"]}
