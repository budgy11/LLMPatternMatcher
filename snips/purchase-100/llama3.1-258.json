{"prompt": "Create a purchase functionality using php", "llm_output": "Here is an example of how you can create a simple purchase functionality using PHP, HTML, and MySQL:\n\n**Database Schema:**\n```sql\nCREATE TABLE users (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  name VARCHAR(255),\n  email VARCHAR(255)\n);\n\nCREATE TABLE products (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  name VARCHAR(255),\n  price DECIMAL(10,2)\n);\n\nCREATE TABLE orders (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  user_id INT,\n  total DECIMAL(10,2),\n  date TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n);\n\nCREATE TABLE order_items (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  order_id INT,\n  product_id INT,\n  quantity INT,\n  FOREIGN KEY (order_id) REFERENCES orders(id),\n  FOREIGN KEY (product_id) REFERENCES products(id)\n);\n```\n**PHP Code:**\n```php\n<?php\n\n// database connection settings\n$db_host = 'localhost';\n$db_username = 'root';\n$db_password = '';\n$db_name = 'example';\n\n// connect to the database\n$conn = new mysqli($db_host, $db_username, $db_password, $db_name);\n\n// check if the connection was successful\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\nfunction display_products() {\n  global $conn;\n  $query = \"SELECT * FROM products\";\n  $result = $conn->query($query);\n  echo \"<table>\";\n  while ($row = $result->fetch_assoc()) {\n    echo \"<tr><td>\" . $row['name'] . \"</td><td> $\" . number_format($row['price'], 2) . \"</td></tr>\";\n  }\n  echo \"</table>\";\n}\n\nfunction add_to_cart($product_id, $quantity) {\n  global $conn;\n  if (isset($_SESSION['cart'])) {\n    $_SESSION['cart'][$product_id] += $quantity;\n  } else {\n    $_SESSION['cart'] = array();\n    $_SESSION['cart'][$product_id] = $quantity;\n  }\n}\n\nfunction display_cart() {\n  global $conn;\n  echo \"<table>\";\n  if (isset($_SESSION['cart'])) {\n    foreach ($_SESSION['cart'] as $product_id => $quantity) {\n      $query = \"SELECT * FROM products WHERE id = '$product_id'\";\n      $result = $conn->query($query);\n      $row = $result->fetch_assoc();\n      echo \"<tr><td>\" . $row['name'] . \"</td><td> $\" . number_format($row['price'], 2) . \" x $quantity</td></tr>\";\n    }\n  }\n  echo \"</table>\";\n}\n\nfunction checkout() {\n  global $conn;\n  if (isset($_SESSION['cart'])) {\n    // get the user's id\n    $user_id = $_SESSION['user']['id'];\n\n    // calculate the total cost\n    $total = 0;\n    foreach ($_SESSION['cart'] as $product_id => $quantity) {\n      $query = \"SELECT price FROM products WHERE id = '$product_id'\";\n      $result = $conn->query($query);\n      $row = $result->fetch_assoc();\n      $total += $row['price'] * $quantity;\n    }\n\n    // create a new order\n    $order_id = uniqid();\n    $query = \"INSERT INTO orders (user_id, total) VALUES ('$user_id', '$total')\";\n    $conn->query($query);\n\n    // add the items to the order\n    foreach ($_SESSION['cart'] as $product_id => $quantity) {\n      $query = \"INSERT INTO order_items (order_id, product_id, quantity) VALUES ('$order_id', '$product_id', '$quantity')\";\n      $conn->query($query);\n    }\n\n    // clear the cart\n    unset($_SESSION['cart']);\n\n    echo \"Order placed successfully!\";\n  }\n}\n\n?>\n```\n**HTML Code:**\n```html\n<!DOCTYPE html>\n<html>\n<head>\n  <title>Shop</title>\n</head>\n<body>\n  <?php display_products(); ?>\n  <form action=\"\" method=\"post\">\n    <select name=\"product_id\" id=\"product_id\">\n      <?php foreach ($products as $product) { ?>\n        <option value=\"<?php echo $product['id']; ?>\"><?php echo $product['name']; ?></option>\n      <?php } ?>\n    </select>\n    <input type=\"number\" name=\"quantity\" id=\"quantity\" />\n    <button type=\"submit\">Add to Cart</button>\n  </form>\n\n  <?php display_cart(); ?>\n\n  <button onclick=\"checkout()\">Checkout</button>\n\n  <script>\n    function checkout() {\n      // code to submit the form\n    }\n  </script>\n</body>\n</html>\n```\nThis is a basic example and you should add more functionality, error handling and security measures as per your requirements.\n\nPlease note that this is just a simple example and in a real-world application, you would want to use a framework like Laravel or CodeIgniter to handle the database interactions and user authentication. Also, you would want to validate the user input data before inserting it into the database.", "code_blocks": [null, "```php\n<?php\n\n// database connection settings\n$db_host = 'localhost';\n$db_username = 'root';\n$db_password = '';\n$db_name = 'example';\n\n// connect to the database\n$conn = new mysqli($db_host, $db_username, $db_password, $db_name);\n\n// check if the connection was successful\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\nfunction display_products() {\n  global $conn;\n  $query = \"SELECT * FROM products\";\n  $result = $conn->query($query);\n  echo \"<table>\";\n  while ($row = $result->fetch_assoc()) {\n    echo \"<tr><td>\" . $row['name'] . \"</td><td> $\" . number_format($row['price'], 2) . \"</td></tr>\";\n  }\n  echo \"</table>\";\n}\n\nfunction add_to_cart($product_id, $quantity) {\n  global $conn;\n  if (isset($_SESSION['cart'])) {\n    $_SESSION['cart'][$product_id] += $quantity;\n  } else {\n    $_SESSION['cart'] = array();\n    $_SESSION['cart'][$product_id] = $quantity;\n  }\n}\n\nfunction display_cart() {\n  global $conn;\n  echo \"<table>\";\n  if (isset($_SESSION['cart'])) {\n    foreach ($_SESSION['cart'] as $product_id => $quantity) {\n      $query = \"SELECT * FROM products WHERE id = '$product_id'\";\n      $result = $conn->query($query);\n      $row = $result->fetch_assoc();\n      echo \"<tr><td>\" . $row['name'] . \"</td><td> $\" . number_format($row['price'], 2) . \" x $quantity</td></tr>\";\n    }\n  }\n  echo \"</table>\";\n}\n\nfunction checkout() {\n  global $conn;\n  if (isset($_SESSION['cart'])) {\n    // get the user's id\n    $user_id = $_SESSION['user']['id'];\n\n    // calculate the total cost\n    $total = 0;\n    foreach ($_SESSION['cart'] as $product_id => $quantity) {\n      $query = \"SELECT price FROM products WHERE id = '$product_id'\";\n      $result = $conn->query($query);\n      $row = $result->fetch_assoc();\n      $total += $row['price'] * $quantity;\n    }\n\n    // create a new order\n    $order_id = uniqid();\n    $query = \"INSERT INTO orders (user_id, total) VALUES ('$user_id', '$total')\";\n    $conn->query($query);\n\n    // add the items to the order\n    foreach ($_SESSION['cart'] as $product_id => $quantity) {\n      $query = \"INSERT INTO order_items (order_id, product_id, quantity) VALUES ('$order_id', '$product_id', '$quantity')\";\n      $conn->query($query);\n    }\n\n    // clear the cart\n    unset($_SESSION['cart']);\n\n    echo \"Order placed successfully!\";\n  }\n}\n\n?>\n```", null]}
