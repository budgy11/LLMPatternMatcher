{"prompt": "Create a purchase functionality using php", "llm_output": "Here is an example of a basic purchase functionality in PHP:\n\n**Note:** This is a simplified example and you should consider implementing security measures such as authentication, authorization, and input validation to prevent common web vulnerabilities like SQL injection and cross-site scripting (XSS).\n\n**Database schema:**\n```sql\nCREATE TABLE products (\n  id INT PRIMARY KEY,\n  name VARCHAR(255),\n  price DECIMAL(10,2)\n);\n\nCREATE TABLE orders (\n  id INT PRIMARY KEY,\n  customer_id INT,\n  order_date DATE,\n  total DECIMAL(10,2)\n);\n\nCREATE TABLE order_items (\n  id INT PRIMARY KEY,\n  order_id INT,\n  product_id INT,\n  quantity INT\n);\n```\n**PHP code:**\n```php\n// config.php (database connection settings)\n$db_host = 'localhost';\n$db_user = 'root';\n$db_password = '';\n$db_name = 'store';\n\n// purchase.php (purchase functionality)\nrequire_once 'config.php';\n\n// Connect to database\n$conn = new mysqli($db_host, $db_user, $db_password, $db_name);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Function to add product to cart\nfunction add_to_cart() {\n  global $conn;\n  \n  // Get product ID and quantity from POST request\n  $product_id = $_POST['product_id'];\n  $quantity = $_POST['quantity'];\n  \n  // Check if product exists in database\n  $query = \"SELECT * FROM products WHERE id = '$product_id'\";\n  $result = $conn->query($query);\n  \n  if ($result->num_rows > 0) {\n    while ($row = $result->fetch_assoc()) {\n      $price = $row['price'];\n      \n      // Check if product is already in cart\n      $query = \"SELECT * FROM order_items WHERE product_id = '$product_id' AND order_id = '$_SESSION[cart_id]'\";\n      $result = $conn->query($query);\n      \n      if ($result->num_rows > 0) {\n        while ($row = $result->fetch_assoc()) {\n          $current_quantity = $row['quantity'];\n          \n          // Update quantity in cart\n          $new_quantity = $current_quantity + $quantity;\n          $query = \"UPDATE order_items SET quantity = '$new_quantity' WHERE id = '\" . $row['id'] . \"'\";\n          $conn->query($query);\n        }\n      } else {\n        // Add product to cart\n        $query = \"INSERT INTO order_items (order_id, product_id, quantity) VALUES ('$_SESSION[cart_id]', '$product_id', '$quantity')\";\n        $conn->query($query);\n      }\n    }\n  }\n}\n\n// Function to process purchase\nfunction process_purchase() {\n  global $conn;\n  \n  // Get customer ID from session\n  $customer_id = $_SESSION['customer_id'];\n  \n  // Calculate total cost of items in cart\n  $total = 0;\n  $query = \"SELECT * FROM order_items WHERE order_id = '$_SESSION[cart_id]'\";\n  $result = $conn->query($query);\n  \n  while ($row = $result->fetch_assoc()) {\n    $price = get_product_price($row['product_id']);\n    $quantity = $row['quantity'];\n    \n    // Add product cost to total\n    $total += $price * $quantity;\n  }\n  \n  // Insert order into database\n  $query = \"INSERT INTO orders (customer_id, total) VALUES ('$customer_id', '$total')\";\n  $conn->query($query);\n  \n  // Update cart with new order ID\n  $query = \"UPDATE order_items SET order_id = LAST_INSERT_ID() WHERE order_id = '$_SESSION[cart_id]'\";\n  $conn->query($query);\n}\n\n// Function to get product price\nfunction get_product_price($product_id) {\n  global $conn;\n  \n  // Get product price from database\n  $query = \"SELECT price FROM products WHERE id = '$product_id'\";\n  $result = $conn->query($query);\n  \n  if ($result->num_rows > 0) {\n    while ($row = $result->fetch_assoc()) {\n      return $row['price'];\n    }\n  }\n}\n\n// Check if user is logged in\nif (isset($_SESSION['customer_id'])) {\n  // Check if purchase button was clicked\n  if (isset($_POST['purchase'])) {\n    process_purchase();\n  } elseif (isset($_POST['add_to_cart'])) {\n    add_to_cart();\n  }\n} else {\n  echo 'Please log in to make a purchase.';\n}\n\n// Close database connection\n$conn->close();\n```\n**HTML code:**\n```html\n<!-- index.php -->\n<?php require_once 'purchase.php'; ?>\n\n<!DOCTYPE html>\n<html>\n<head>\n  <title>Store</title>\n</head>\n<body>\n\n  <!-- Add product to cart form -->\n  <form action=\"\" method=\"post\">\n    <input type=\"hidden\" name=\"product_id\" value=\"<?php echo $product_id; ?>\">\n    <input type=\"hidden\" name=\"quantity\" value=\"<?php echo $quantity; ?>\">\n    <button type=\"submit\" name=\"add_to_cart\">Add to Cart</button>\n  </form>\n\n  <!-- Purchase form -->\n  <form action=\"\" method=\"post\">\n    <button type=\"submit\" name=\"purchase\">Purchase</button>\n  </form>\n\n  <?php if (isset($_SESSION['cart_id'])) : ?>\n    <!-- Display cart contents -->\n    <h2>Cart Contents:</h2>\n    <ul>\n      <?php\n        $query = \"SELECT * FROM order_items WHERE order_id = '$_SESSION[cart_id]'\";\n        $result = $conn->query($query);\n        \n        while ($row = $result->fetch_assoc()) {\n          echo '<li>' . $row['product_id'] . ' x ' . $row['quantity'] . '</li>';\n        }\n      ?>\n    </ul>\n  <?php endif; ?>\n\n</body>\n</html>\n```\nThis is a basic example of a purchase functionality using PHP. The user can add products to their cart and then proceed to checkout by clicking the \"Purchase\" button. The system calculates the total cost of items in the cart and inserts an order into the database when the user clicks the \"Purchase\" button.\n\nPlease note that this is a simplified example and you should consider implementing security measures such as authentication, authorization, and input validation to prevent common web vulnerabilities like SQL injection and cross-site scripting (XSS). Additionally, you may want to add more features such as displaying product prices, calculating taxes and shipping costs, etc.", "code_blocks": [null, "```php\n// config.php (database connection settings)\n$db_host = 'localhost';\n$db_user = 'root';\n$db_password = '';\n$db_name = 'store';\n\n// purchase.php (purchase functionality)\nrequire_once 'config.php';\n\n// Connect to database\n$conn = new mysqli($db_host, $db_user, $db_password, $db_name);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Function to add product to cart\nfunction add_to_cart() {\n  global $conn;\n  \n  // Get product ID and quantity from POST request\n  $product_id = $_POST['product_id'];\n  $quantity = $_POST['quantity'];\n  \n  // Check if product exists in database\n  $query = \"SELECT * FROM products WHERE id = '$product_id'\";\n  $result = $conn->query($query);\n  \n  if ($result->num_rows > 0) {\n    while ($row = $result->fetch_assoc()) {\n      $price = $row['price'];\n      \n      // Check if product is already in cart\n      $query = \"SELECT * FROM order_items WHERE product_id = '$product_id' AND order_id = '$_SESSION[cart_id]'\";\n      $result = $conn->query($query);\n      \n      if ($result->num_rows > 0) {\n        while ($row = $result->fetch_assoc()) {\n          $current_quantity = $row['quantity'];\n          \n          // Update quantity in cart\n          $new_quantity = $current_quantity + $quantity;\n          $query = \"UPDATE order_items SET quantity = '$new_quantity' WHERE id = '\" . $row['id'] . \"'\";\n          $conn->query($query);\n        }\n      } else {\n        // Add product to cart\n        $query = \"INSERT INTO order_items (order_id, product_id, quantity) VALUES ('$_SESSION[cart_id]', '$product_id', '$quantity')\";\n        $conn->query($query);\n      }\n    }\n  }\n}\n\n// Function to process purchase\nfunction process_purchase() {\n  global $conn;\n  \n  // Get customer ID from session\n  $customer_id = $_SESSION['customer_id'];\n  \n  // Calculate total cost of items in cart\n  $total = 0;\n  $query = \"SELECT * FROM order_items WHERE order_id = '$_SESSION[cart_id]'\";\n  $result = $conn->query($query);\n  \n  while ($row = $result->fetch_assoc()) {\n    $price = get_product_price($row['product_id']);\n    $quantity = $row['quantity'];\n    \n    // Add product cost to total\n    $total += $price * $quantity;\n  }\n  \n  // Insert order into database\n  $query = \"INSERT INTO orders (customer_id, total) VALUES ('$customer_id', '$total')\";\n  $conn->query($query);\n  \n  // Update cart with new order ID\n  $query = \"UPDATE order_items SET order_id = LAST_INSERT_ID() WHERE order_id = '$_SESSION[cart_id]'\";\n  $conn->query($query);\n}\n\n// Function to get product price\nfunction get_product_price($product_id) {\n  global $conn;\n  \n  // Get product price from database\n  $query = \"SELECT price FROM products WHERE id = '$product_id'\";\n  $result = $conn->query($query);\n  \n  if ($result->num_rows > 0) {\n    while ($row = $result->fetch_assoc()) {\n      return $row['price'];\n    }\n  }\n}\n\n// Check if user is logged in\nif (isset($_SESSION['customer_id'])) {\n  // Check if purchase button was clicked\n  if (isset($_POST['purchase'])) {\n    process_purchase();\n  } elseif (isset($_POST['add_to_cart'])) {\n    add_to_cart();\n  }\n} else {\n  echo 'Please log in to make a purchase.';\n}\n\n// Close database connection\n$conn->close();\n```", null]}
