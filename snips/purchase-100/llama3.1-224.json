{"prompt": "Create a purchase functionality using php", "llm_output": "Here is an example of how you can create a basic purchase functionality in PHP. This example assumes that you have already set up a database with the necessary tables for storing users, products, and orders.\n\n**Database Schema:**\n\n```sql\nCREATE TABLE users (\n  id INT PRIMARY KEY,\n  name VARCHAR(255),\n  email VARCHAR(255)\n);\n\nCREATE TABLE products (\n  id INT PRIMARY KEY,\n  name VARCHAR(255),\n  price DECIMAL(10,2)\n);\n\nCREATE TABLE orders (\n  id INT PRIMARY KEY,\n  user_id INT,\n  product_id INT,\n  order_date DATE,\n  total DECIMAL(10,2)\n);\n```\n\n**PHP Code:**\n\n```php\n// Connect to database\n$conn = mysqli_connect(\"localhost\", \"username\", \"password\", \"database\");\n\n// Check connection\nif (!$conn) {\n    die(\"Connection failed: \" . mysqli_connect_error());\n}\n\n// Function to display products\nfunction getProducts() {\n    $query = \"SELECT * FROM products\";\n    $result = mysqli_query($GLOBALS['conn'], $query);\n    while ($row = mysqli_fetch_assoc($result)) {\n        echo \"<option value='{$row['id']}'>{$row['name']} - {$row['price']}</option>\";\n    }\n}\n\n// Function to add product to cart\nfunction addToCart() {\n    if (isset($_POST['product_id']) && isset($_SESSION['cart'])) {\n        $productId = $_POST['product_id'];\n        $quantity = 1;\n        array_push($_SESSION['cart'], array('product_id' => $productId, 'quantity' => $quantity));\n        echo \"Product added to cart\";\n    }\n}\n\n// Function to checkout\nfunction checkout() {\n    if (isset($_SESSION['cart'])) {\n        $user_id = $_SESSION['user']['id'];\n        foreach ($_SESSION['cart'] as $item) {\n            $query = \"INSERT INTO orders (user_id, product_id, order_date, total)\n                      VALUES ('$user_id', '$item[product_id]', NOW(), '{$_SESSION['total']}')\";\n            mysqli_query($conn, $query);\n            $_SESSION['cart'] = array();\n        }\n        echo \"Order successful\";\n    }\n}\n\n// Check if user is logged in\nif (!isset($_SESSION['user'])) {\n    header(\"Location: login.php\");\n} else {\n    // Display products\n    getProducts();\n\n    // Add product to cart\n    if (isset($_POST['product_id'])) {\n        addToCart();\n    }\n\n    // Checkout\n    if (isset($_POST['checkout'])) {\n        checkout();\n    }\n}\n```\n\n**HTML Code:**\n\n```html\n<form action=\"\" method=\"post\">\n  <select name=\"product_id\" id=\"product_id\">\n    <!-- Products will be populated dynamically using JavaScript -->\n  </select>\n  <button type=\"submit\">Add to Cart</button>\n</form>\n\n<?php if (isset($_SESSION['cart'])) : ?>\n  <table>\n    <tr>\n      <th>Product Name</th>\n      <th>Quantity</th>\n      <th>Total</th>\n    </tr>\n    <?php foreach ($_SESSION['cart'] as $item) : ?>\n      <tr>\n        <td><?php echo getProductname($item['product_id']); ?></td>\n        <td><?php echo $item['quantity']; ?></td>\n        <td><?php echo calculateTotal($item['product_id'], $item['quantity']); ?></td>\n      </tr>\n    <?php endforeach; ?>\n  </table>\n<?php endif; ?>\n\n<form action=\"\" method=\"post\">\n  <button type=\"submit\" name=\"checkout\">Checkout</button>\n</form>\n```\n\n**JavaScript Code:**\n\n```javascript\n// Populate products dynamically using JavaScript\nfunction populateProducts() {\n    var productSelect = document.getElementById(\"product_id\");\n    $.ajax({\n        url: \"get_products.php\",\n        success: function(data) {\n            productSelect.innerHTML = data;\n        }\n    });\n}\n\npopulateProducts();\n```\n\n**get_products.php (for populating products dynamically):**\n\n```php\n<?php\nfunction getProducts() {\n    $query = \"SELECT * FROM products\";\n    $result = mysqli_query($GLOBALS['conn'], $query);\n    while ($row = mysqli_fetch_assoc($result)) {\n        echo \"<option value='{$row['id']}'>{$row['name']} - {$row['price']}</option>\";\n    }\n}\ngetProducts();\n?>\n```\n\nNote that this is a basic example and does not include any validation or security measures. In a real-world application, you should always validate user input and ensure proper security practices are followed.\n\nAlso note that the database schema used in this example is very basic and may need to be modified based on your specific requirements.", "code_blocks": [null, "```php\n// Connect to database\n$conn = mysqli_connect(\"localhost\", \"username\", \"password\", \"database\");\n\n// Check connection\nif (!$conn) {\n    die(\"Connection failed: \" . mysqli_connect_error());\n}\n\n// Function to display products\nfunction getProducts() {\n    $query = \"SELECT * FROM products\";\n    $result = mysqli_query($GLOBALS['conn'], $query);\n    while ($row = mysqli_fetch_assoc($result)) {\n        echo \"<option value='{$row['id']}'>{$row['name']} - {$row['price']}</option>\";\n    }\n}\n\n// Function to add product to cart\nfunction addToCart() {\n    if (isset($_POST['product_id']) && isset($_SESSION['cart'])) {\n        $productId = $_POST['product_id'];\n        $quantity = 1;\n        array_push($_SESSION['cart'], array('product_id' => $productId, 'quantity' => $quantity));\n        echo \"Product added to cart\";\n    }\n}\n\n// Function to checkout\nfunction checkout() {\n    if (isset($_SESSION['cart'])) {\n        $user_id = $_SESSION['user']['id'];\n        foreach ($_SESSION['cart'] as $item) {\n            $query = \"INSERT INTO orders (user_id, product_id, order_date, total)\n                      VALUES ('$user_id', '$item[product_id]', NOW(), '{$_SESSION['total']}')\";\n            mysqli_query($conn, $query);\n            $_SESSION['cart'] = array();\n        }\n        echo \"Order successful\";\n    }\n}\n\n// Check if user is logged in\nif (!isset($_SESSION['user'])) {\n    header(\"Location: login.php\");\n} else {\n    // Display products\n    getProducts();\n\n    // Add product to cart\n    if (isset($_POST['product_id'])) {\n        addToCart();\n    }\n\n    // Checkout\n    if (isset($_POST['checkout'])) {\n        checkout();\n    }\n}\n```", null, null, "```php\n<?php\nfunction getProducts() {\n    $query = \"SELECT * FROM products\";\n    $result = mysqli_query($GLOBALS['conn'], $query);\n    while ($row = mysqli_fetch_assoc($result)) {\n        echo \"<option value='{$row['id']}'>{$row['name']} - {$row['price']}</option>\";\n    }\n}\ngetProducts();\n?>\n```"]}
