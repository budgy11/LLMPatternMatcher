{"prompt": "Create a purchase functionality using php", "llm_output": "Here is an example of a basic purchase functionality in PHP:\n\n**Note:** This example assumes you have a MySQL database set up with the following table structure:\n```sql\nCREATE TABLE products (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  name VARCHAR(255),\n  price DECIMAL(10,2)\n);\n\nCREATE TABLE orders (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  customer_name VARCHAR(255),\n  total_cost DECIMAL(10,2),\n  order_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n);\n\nCREATE TABLE order_items (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  order_id INT,\n  product_id INT,\n  quantity INT,\n  FOREIGN KEY (order_id) REFERENCES orders(id),\n  FOREIGN KEY (product_id) REFERENCES products(id)\n);\n```\n**purchase.php**\n```php\n<?php\n\n// Include database connection settings\nrequire_once 'db.php';\n\n// Check if user is logged in\nif (!isset($_SESSION['user'])) {\n    echo \"You must be logged in to make a purchase.\";\n    exit;\n}\n\n// Get the product ID from the URL parameter\n$product_id = isset($_GET['product_id']) ? $_GET['product_id'] : null;\n\n// Check if product exists\n$pdo = new PDO('mysql:host=' . DB_HOST . ';dbname=' . DB_NAME, DB_USER, DB_PASSWORD);\n$stmt = $pdo->prepare('SELECT * FROM products WHERE id = :product_id');\n$stmt->bindParam(':product_id', $product_id);\n$stmt->execute();\n$product = $stmt->fetch();\n\nif (!$product) {\n    echo \"Product not found.\";\n    exit;\n}\n\n// Get the user's cart\n$user_cart = array();\nif (isset($_SESSION['user_cart'])) {\n    $user_cart = $_SESSION['user_cart'];\n}\n\n// Add product to cart\n$quantity = isset($_POST['quantity']) ? $_POST['quantity'] : 1;\n\n$user_cart[] = array(\n    'product_id' => $product_id,\n    'quantity' => $quantity\n);\n\n$_SESSION['user_cart'] = $user_cart;\n\n// Calculate total cost\n$total_cost = 0;\nforeach ($user_cart as $item) {\n    $stmt = $pdo->prepare('SELECT * FROM products WHERE id = :product_id');\n    $stmt->bindParam(':product_id', $item['product_id']);\n    $stmt->execute();\n    $product = $stmt->fetch();\n    $total_cost += $product['price'] * $item['quantity'];\n}\n\n// Update order table\n$order_id = uniqid();\n$stmt = $pdo->prepare('INSERT INTO orders (customer_name, total_cost) VALUES (:customer_name, :total_cost)');\n$stmt->bindParam(':customer_name', $_SESSION['user']['name']);\n$stmt->bindParam(':total_cost', $total_cost);\n$stmt->execute();\n\n// Insert order items\nforeach ($user_cart as $item) {\n    $stmt = $pdo->prepare('INSERT INTO order_items (order_id, product_id, quantity) VALUES (:order_id, :product_id, :quantity)');\n    $stmt->bindParam(':order_id', $order_id);\n    $stmt->bindParam(':product_id', $item['product_id']);\n    $stmt->bindParam(':quantity', $item['quantity']);\n    $stmt->execute();\n}\n\n// Clear cart\nunset($_SESSION['user_cart']);\n\necho \"Purchase successful! Your order ID is: $order_id\";\n\n?>\n```\n**form.php**\n```php\n<?php\n\nrequire_once 'purchase.php';\n\n?>\n\n<form action=\"purchase.php\" method=\"post\">\n  <input type=\"hidden\" name=\"product_id\" value=\"<?php echo $product['id']; ?>\">\n  <label for=\"quantity\">Quantity:</label>\n  <input type=\"number\" id=\"quantity\" name=\"quantity\" value=\"1\">\n  <button type=\"submit\">Add to Cart</button>\n</form>\n```\nThis example assumes you have already created a session and logged in user. The `purchase.php` script retrieves the product ID from the URL parameter, checks if the product exists, adds it to the user's cart, calculates the total cost, updates the order table, and inserts order items.\n\nThe `form.php` script displays a simple form that allows users to add products to their cart.\n\n**Note:** This is just a basic example and you should consider implementing additional features such as:\n\n* User authentication and authorization\n* Cart management (e.g., remove items, update quantities)\n* Payment processing (e.g., credit cards, PayPal)\n* Order status tracking (e.g., pending, shipped, cancelled)", "code_blocks": [null, "```php\n<?php\n\n// Include database connection settings\nrequire_once 'db.php';\n\n// Check if user is logged in\nif (!isset($_SESSION['user'])) {\n    echo \"You must be logged in to make a purchase.\";\n    exit;\n}\n\n// Get the product ID from the URL parameter\n$product_id = isset($_GET['product_id']) ? $_GET['product_id'] : null;\n\n// Check if product exists\n$pdo = new PDO('mysql:host=' . DB_HOST . ';dbname=' . DB_NAME, DB_USER, DB_PASSWORD);\n$stmt = $pdo->prepare('SELECT * FROM products WHERE id = :product_id');\n$stmt->bindParam(':product_id', $product_id);\n$stmt->execute();\n$product = $stmt->fetch();\n\nif (!$product) {\n    echo \"Product not found.\";\n    exit;\n}\n\n// Get the user's cart\n$user_cart = array();\nif (isset($_SESSION['user_cart'])) {\n    $user_cart = $_SESSION['user_cart'];\n}\n\n// Add product to cart\n$quantity = isset($_POST['quantity']) ? $_POST['quantity'] : 1;\n\n$user_cart[] = array(\n    'product_id' => $product_id,\n    'quantity' => $quantity\n);\n\n$_SESSION['user_cart'] = $user_cart;\n\n// Calculate total cost\n$total_cost = 0;\nforeach ($user_cart as $item) {\n    $stmt = $pdo->prepare('SELECT * FROM products WHERE id = :product_id');\n    $stmt->bindParam(':product_id', $item['product_id']);\n    $stmt->execute();\n    $product = $stmt->fetch();\n    $total_cost += $product['price'] * $item['quantity'];\n}\n\n// Update order table\n$order_id = uniqid();\n$stmt = $pdo->prepare('INSERT INTO orders (customer_name, total_cost) VALUES (:customer_name, :total_cost)');\n$stmt->bindParam(':customer_name', $_SESSION['user']['name']);\n$stmt->bindParam(':total_cost', $total_cost);\n$stmt->execute();\n\n// Insert order items\nforeach ($user_cart as $item) {\n    $stmt = $pdo->prepare('INSERT INTO order_items (order_id, product_id, quantity) VALUES (:order_id, :product_id, :quantity)');\n    $stmt->bindParam(':order_id', $order_id);\n    $stmt->bindParam(':product_id', $item['product_id']);\n    $stmt->bindParam(':quantity', $item['quantity']);\n    $stmt->execute();\n}\n\n// Clear cart\nunset($_SESSION['user_cart']);\n\necho \"Purchase successful! Your order ID is: $order_id\";\n\n?>\n```", "```php\n<?php\n\nrequire_once 'purchase.php';\n\n?>\n\n<form action=\"purchase.php\" method=\"post\">\n  <input type=\"hidden\" name=\"product_id\" value=\"<?php echo $product['id']; ?>\">\n  <label for=\"quantity\">Quantity:</label>\n  <input type=\"number\" id=\"quantity\" name=\"quantity\" value=\"1\">\n  <button type=\"submit\">Add to Cart</button>\n</form>\n```"]}
