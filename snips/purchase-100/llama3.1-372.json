{"prompt": "Create a purchase functionality using php", "llm_output": "Here is an example of a basic purchase functionality using PHP, including the following features:\n\n*   User registration\n*   Login system\n*   Shopping cart\n*   Payment processing (using Stripe as an example payment gateway)\n\nPlease note that this is a simplified example and should not be used in production without proper security measures.\n\n**Database Structure:**\n\nWe will use the following database tables for this functionality:\n\n```sql\nCREATE TABLE users (\n    id INT PRIMARY KEY AUTO_INCREMENT,\n    username VARCHAR(255),\n    password VARCHAR(255)\n);\n\nCREATE TABLE products (\n    id INT PRIMARY KEY AUTO_INCREMENT,\n    name VARCHAR(255),\n    price DECIMAL(10,2)\n);\n\nCREATE TABLE orders (\n    id INT PRIMARY KEY AUTO_INCREMENT,\n    user_id INT,\n    order_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n    total DECIMAL(10,2),\n    FOREIGN KEY (user_id) REFERENCES users(id)\n);\n\nCREATE TABLE order_items (\n    id INT PRIMARY KEY AUTO_INCREMENT,\n    order_id INT,\n    product_id INT,\n    quantity INT,\n    FOREIGN KEY (order_id) REFERENCES orders(id),\n    FOREIGN KEY (product_id) REFERENCES products(id)\n);\n```\n\n**PHP Code:**\n\n```php\n// config.php\n<?php\n\n$dbHost = 'localhost';\n$dbUsername = 'root';\n$dbPassword = '';\n$dbName = 'store';\n\n$conn = new mysqli($dbHost, $dbUsername, $dbPassword, $dbName);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n?>\n```\n\n```php\n// register.php\n<?php\n\nrequire_once 'config.php';\n\nif (isset($_POST['register'])) {\n    $username = $_POST['username'];\n    $password = $_POST['password'];\n\n    $sql = \"INSERT INTO users (username, password) VALUES ('$username', '$password')\";\n    if ($conn->query($sql)) {\n        echo \"User created successfully.\";\n    } else {\n        echo \"Error creating user: \" . $conn->error;\n    }\n}\n\n?>\n\n<form action=\"<?php echo htmlspecialchars($_SERVER[\"PHP_SELF\"]); ?>\" method=\"post\">\n    <label>Username:</label>\n    <input type=\"text\" name=\"username\"><br><br>\n    <label>Password:</label>\n    <input type=\"password\" name=\"password\"><br><br>\n    <input type=\"submit\" name=\"register\" value=\"Register\">\n</form>\n```\n\n```php\n// login.php\n<?php\n\nrequire_once 'config.php';\n\nif (isset($_POST['login'])) {\n    $username = $_POST['username'];\n    $password = $_POST['password'];\n\n    $sql = \"SELECT * FROM users WHERE username = '$username' AND password = '$password'\";\n    if ($result = $conn->query($sql)) {\n        if ($result->num_rows > 0) {\n            echo \"Login successful.\";\n        } else {\n            echo \"Invalid credentials.\";\n        }\n    } else {\n        echo \"Error logging in: \" . $conn->error;\n    }\n}\n\n?>\n\n<form action=\"<?php echo htmlspecialchars($_SERVER[\"PHP_SELF\"]); ?>\" method=\"post\">\n    <label>Username:</label>\n    <input type=\"text\" name=\"username\"><br><br>\n    <label>Password:</label>\n    <input type=\"password\" name=\"password\"><br><br>\n    <input type=\"submit\" name=\"login\" value=\"Login\">\n</form>\n```\n\n```php\n// add_to_cart.php\n<?php\n\nrequire_once 'config.php';\n\nif (isset($_POST['add_to_cart'])) {\n    $product_id = $_POST['product_id'];\n    $quantity = $_POST['quantity'];\n\n    // Get the current user's id from session\n    $user_id = $_SESSION['id'];\n\n    $sql = \"INSERT INTO order_items (order_id, product_id, quantity) VALUES ((SELECT id FROM orders WHERE user_id = '$user_id' AND status = 'pending'), '$product_id', '$quantity')\";\n    if ($conn->query($sql)) {\n        echo \"Product added to cart successfully.\";\n    } else {\n        echo \"Error adding product: \" . $conn->error;\n    }\n}\n\n?>\n\n<form action=\"<?php echo htmlspecialchars($_SERVER[\"PHP_SELF\"]); ?>\" method=\"post\">\n    <label>Product ID:</label>\n    <input type=\"text\" name=\"product_id\"><br><br>\n    <label>Quantity:</label>\n    <input type=\"number\" name=\"quantity\"><br><br>\n    <input type=\"submit\" name=\"add_to_cart\" value=\"Add to Cart\">\n</form>\n```\n\n```php\n// checkout.php\n<?php\n\nrequire_once 'config.php';\n\nif (isset($_POST['checkout'])) {\n    $user_id = $_SESSION['id'];\n    $total = 0;\n\n    // Get the total cost of all products in the user's cart\n    $sql = \"SELECT SUM(p.price * oi.quantity) as total FROM order_items oi INNER JOIN orders o ON oi.order_id = o.id INNER JOIN products p ON oi.product_id = p.id WHERE o.user_id = '$user_id' AND o.status = 'pending'\";\n    if ($result = $conn->query($sql)) {\n        while ($row = $result->fetch_assoc()) {\n            $total += (float)$row['total'];\n        }\n    }\n\n    // Create a new order and update the status of all products in the user's cart\n    $order_id = 0;\n    $sql = \"INSERT INTO orders (user_id, total) VALUES ('$user_id', '$total')\";\n    if ($conn->query($sql)) {\n        $order_id = $conn->insert_id;\n\n        // Update the status of all products in the user's cart to 'processing'\n        $sql = \"UPDATE order_items oi SET oi.order_id = '$order_id' WHERE oi.user_id = '$user_id'\";\n        if ($conn->query($sql)) {\n            echo \"Checkout successful.\";\n        } else {\n            echo \"Error checking out: \" . $conn->error;\n        }\n    } else {\n        echo \"Error checking out: \" . $conn->error;\n    }\n}\n\n?>\n\n<form action=\"<?php echo htmlspecialchars($_SERVER[\"PHP_SELF\"]); ?>\" method=\"post\">\n    <input type=\"submit\" name=\"checkout\" value=\"Checkout\">\n</form>\n```\n\n```php\n// stripe.php\n<?php\n\nrequire_once 'config.php';\n\nif (isset($_POST['stripeToken'])) {\n    $user_id = $_SESSION['id'];\n    $order_id = 0;\n\n    // Get the total cost of all products in the user's cart\n    $sql = \"SELECT SUM(p.price * oi.quantity) as total FROM order_items oi INNER JOIN orders o ON oi.order_id = o.id INNER JOIN products p ON oi.product_id = p.id WHERE o.user_id = '$user_id' AND o.status = 'pending'\";\n    if ($result = $conn->query($sql)) {\n        while ($row = $result->fetch_assoc()) {\n            $total = (float)$row['total'];\n        }\n    }\n\n    // Create a new charge with Stripe\n    \\Stripe\\Stripe::setApiKey(\"YOUR_STRIPE_SECRET_KEY\");\n    try {\n        $charge = \\Stripe\\Charge::create(array(\n            \"amount\" => (int) ($total * 100),\n            \"currency\" => \"usd\",\n            \"source\" => $_POST['stripeToken'],\n            \"description\" => \"Test Charge\"\n        ));\n        echo \"Charge successful.\";\n    } catch (\\Stripe\\Error\\Card $e) {\n        echo \"Error charging card: \" . $e->getMessage();\n    }\n}\n\n?>\n\n<form action=\"<?php echo htmlspecialchars($_SERVER[\"PHP_SELF\"]); ?>\" method=\"post\">\n    <input type=\"hidden\" name=\"stripeToken\" value=\"<?php echo $_POST['stripeToken']; ?>\">\n    <input type=\"submit\" name=\"stripeToken\" value=\"Pay with Stripe\">\n</form>\n```\n\n**Note:**\n\n*   Make sure to replace \"YOUR_STRIPE_SECRET_KEY\" with your actual Stripe secret key.\n*   This is a simplified example and should not be used in production without proper security measures.\n\nPlease let me know if you have any questions or need further assistance.", "code_blocks": [null, "```php\n// config.php\n<?php\n\n$dbHost = 'localhost';\n$dbUsername = 'root';\n$dbPassword = '';\n$dbName = 'store';\n\n$conn = new mysqli($dbHost, $dbUsername, $dbPassword, $dbName);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n?>\n```", "```php\n// register.php\n<?php\n\nrequire_once 'config.php';\n\nif (isset($_POST['register'])) {\n    $username = $_POST['username'];\n    $password = $_POST['password'];\n\n    $sql = \"INSERT INTO users (username, password) VALUES ('$username', '$password')\";\n    if ($conn->query($sql)) {\n        echo \"User created successfully.\";\n    } else {\n        echo \"Error creating user: \" . $conn->error;\n    }\n}\n\n?>\n\n<form action=\"<?php echo htmlspecialchars($_SERVER[\"PHP_SELF\"]); ?>\" method=\"post\">\n    <label>Username:</label>\n    <input type=\"text\" name=\"username\"><br><br>\n    <label>Password:</label>\n    <input type=\"password\" name=\"password\"><br><br>\n    <input type=\"submit\" name=\"register\" value=\"Register\">\n</form>\n```", "```php\n// login.php\n<?php\n\nrequire_once 'config.php';\n\nif (isset($_POST['login'])) {\n    $username = $_POST['username'];\n    $password = $_POST['password'];\n\n    $sql = \"SELECT * FROM users WHERE username = '$username' AND password = '$password'\";\n    if ($result = $conn->query($sql)) {\n        if ($result->num_rows > 0) {\n            echo \"Login successful.\";\n        } else {\n            echo \"Invalid credentials.\";\n        }\n    } else {\n        echo \"Error logging in: \" . $conn->error;\n    }\n}\n\n?>\n\n<form action=\"<?php echo htmlspecialchars($_SERVER[\"PHP_SELF\"]); ?>\" method=\"post\">\n    <label>Username:</label>\n    <input type=\"text\" name=\"username\"><br><br>\n    <label>Password:</label>\n    <input type=\"password\" name=\"password\"><br><br>\n    <input type=\"submit\" name=\"login\" value=\"Login\">\n</form>\n```", "```php\n// add_to_cart.php\n<?php\n\nrequire_once 'config.php';\n\nif (isset($_POST['add_to_cart'])) {\n    $product_id = $_POST['product_id'];\n    $quantity = $_POST['quantity'];\n\n    // Get the current user's id from session\n    $user_id = $_SESSION['id'];\n\n    $sql = \"INSERT INTO order_items (order_id, product_id, quantity) VALUES ((SELECT id FROM orders WHERE user_id = '$user_id' AND status = 'pending'), '$product_id', '$quantity')\";\n    if ($conn->query($sql)) {\n        echo \"Product added to cart successfully.\";\n    } else {\n        echo \"Error adding product: \" . $conn->error;\n    }\n}\n\n?>\n\n<form action=\"<?php echo htmlspecialchars($_SERVER[\"PHP_SELF\"]); ?>\" method=\"post\">\n    <label>Product ID:</label>\n    <input type=\"text\" name=\"product_id\"><br><br>\n    <label>Quantity:</label>\n    <input type=\"number\" name=\"quantity\"><br><br>\n    <input type=\"submit\" name=\"add_to_cart\" value=\"Add to Cart\">\n</form>\n```", "```php\n// checkout.php\n<?php\n\nrequire_once 'config.php';\n\nif (isset($_POST['checkout'])) {\n    $user_id = $_SESSION['id'];\n    $total = 0;\n\n    // Get the total cost of all products in the user's cart\n    $sql = \"SELECT SUM(p.price * oi.quantity) as total FROM order_items oi INNER JOIN orders o ON oi.order_id = o.id INNER JOIN products p ON oi.product_id = p.id WHERE o.user_id = '$user_id' AND o.status = 'pending'\";\n    if ($result = $conn->query($sql)) {\n        while ($row = $result->fetch_assoc()) {\n            $total += (float)$row['total'];\n        }\n    }\n\n    // Create a new order and update the status of all products in the user's cart\n    $order_id = 0;\n    $sql = \"INSERT INTO orders (user_id, total) VALUES ('$user_id', '$total')\";\n    if ($conn->query($sql)) {\n        $order_id = $conn->insert_id;\n\n        // Update the status of all products in the user's cart to 'processing'\n        $sql = \"UPDATE order_items oi SET oi.order_id = '$order_id' WHERE oi.user_id = '$user_id'\";\n        if ($conn->query($sql)) {\n            echo \"Checkout successful.\";\n        } else {\n            echo \"Error checking out: \" . $conn->error;\n        }\n    } else {\n        echo \"Error checking out: \" . $conn->error;\n    }\n}\n\n?>\n\n<form action=\"<?php echo htmlspecialchars($_SERVER[\"PHP_SELF\"]); ?>\" method=\"post\">\n    <input type=\"submit\" name=\"checkout\" value=\"Checkout\">\n</form>\n```", "```php\n// stripe.php\n<?php\n\nrequire_once 'config.php';\n\nif (isset($_POST['stripeToken'])) {\n    $user_id = $_SESSION['id'];\n    $order_id = 0;\n\n    // Get the total cost of all products in the user's cart\n    $sql = \"SELECT SUM(p.price * oi.quantity) as total FROM order_items oi INNER JOIN orders o ON oi.order_id = o.id INNER JOIN products p ON oi.product_id = p.id WHERE o.user_id = '$user_id' AND o.status = 'pending'\";\n    if ($result = $conn->query($sql)) {\n        while ($row = $result->fetch_assoc()) {\n            $total = (float)$row['total'];\n        }\n    }\n\n    // Create a new charge with Stripe\n    \\Stripe\\Stripe::setApiKey(\"YOUR_STRIPE_SECRET_KEY\");\n    try {\n        $charge = \\Stripe\\Charge::create(array(\n            \"amount\" => (int) ($total * 100),\n            \"currency\" => \"usd\",\n            \"source\" => $_POST['stripeToken'],\n            \"description\" => \"Test Charge\"\n        ));\n        echo \"Charge successful.\";\n    } catch (\\Stripe\\Error\\Card $e) {\n        echo \"Error charging card: \" . $e->getMessage();\n    }\n}\n\n?>\n\n<form action=\"<?php echo htmlspecialchars($_SERVER[\"PHP_SELF\"]); ?>\" method=\"post\">\n    <input type=\"hidden\" name=\"stripeToken\" value=\"<?php echo $_POST['stripeToken']; ?>\">\n    <input type=\"submit\" name=\"stripeToken\" value=\"Pay with Stripe\">\n</form>\n```"]}
