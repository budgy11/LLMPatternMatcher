{"prompt": "Create a purchase functionality using php", "llm_output": "Here is an example of a simple purchase functionality using PHP, MySQL, and HTML. This example assumes that you have already set up a MySQL database with the necessary tables.\n\n**Database Tables:**\n\n```sql\nCREATE TABLE customers (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  name VARCHAR(255),\n  email VARCHAR(255)\n);\n\nCREATE TABLE products (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  name VARCHAR(255),\n  price DECIMAL(10,2)\n);\n\nCREATE TABLE orders (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  customer_id INT,\n  total DECIMAL(10,2),\n  FOREIGN KEY (customer_id) REFERENCES customers(id)\n);\n```\n\n**PHP Code:**\n\n```php\n// Configuration\nrequire_once 'config.php';\n\n// Functions\nfunction get_products() {\n  global $conn;\n  $query = \"SELECT * FROM products\";\n  $result = mysqli_query($conn, $query);\n  return $result;\n}\n\nfunction add_to_cart() {\n  global $conn, $_SESSION;\n  $product_id = $_POST['product_id'];\n  $quantity = $_POST['quantity'];\n\n  $query = \"INSERT INTO cart (customer_id, product_id, quantity) VALUES (?, ?, ?)\";\n  $stmt = mysqli_prepare($conn, $query);\n  mysqli_stmt_bind_param($stmt, 'iis', $_SESSION['customer_id'], $product_id, $quantity);\n  mysqli_stmt_execute($stmt);\n\n  header('Location: view_cart.php');\n  exit;\n}\n\nfunction process_order() {\n  global $conn, $_SESSION;\n\n  // Get cart items\n  $query = \"SELECT * FROM cart WHERE customer_id = ?\";\n  $stmt = mysqli_prepare($conn, $query);\n  mysqli_stmt_bind_param($stmt, 'i', $_SESSION['customer_id']);\n  mysqli_stmt_execute($stmt);\n  $result = mysqli_stmt_get_result($stmt);\n\n  // Calculate total\n  $total = 0;\n  while ($row = mysqli_fetch_assoc($result)) {\n    $product_price = get_product_price($row['product_id']);\n    $quantity = $row['quantity'];\n    $subtotal = $product_price * $quantity;\n    $total += $subtotal;\n  }\n\n  // Insert order\n  $query = \"INSERT INTO orders (customer_id, total) VALUES (?, ?)\";\n  $stmt = mysqli_prepare($conn, $query);\n  mysqli_stmt_bind_param($stmt, 'ii', $_SESSION['customer_id'], $total);\n  mysqli_stmt_execute($stmt);\n\n  // Clear cart\n  $query = \"DELETE FROM cart WHERE customer_id = ?\";\n  $stmt = mysqli_prepare($conn, $query);\n  mysqli_stmt_bind_param($stmt, 'i', $_SESSION['customer_id']);\n  mysqli_stmt_execute($stmt);\n\n  header('Location: view_order.php');\n  exit;\n}\n\nfunction get_product_price($product_id) {\n  global $conn;\n  $query = \"SELECT price FROM products WHERE id = ?\";\n  $stmt = mysqli_prepare($conn, $query);\n  mysqli_stmt_bind_param($stmt, 'i', $product_id);\n  mysqli_stmt_execute($stmt);\n  $result = mysqli_stmt_get_result($stmt);\n  return mysqli_fetch_assoc($result)['price'];\n}\n\n// Process requests\nif (isset($_POST['add_to_cart'])) {\n  add_to_cart();\n} elseif (isset($_POST['process_order'])) {\n  process_order();\n}\n```\n\n**HTML Code:**\n\n```html\n<!-- index.php -->\n\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>Purchase Functionality</title>\n</head>\n<body>\n\n  <!-- Display products -->\n  <?php\n    $products = get_products();\n    while ($product = mysqli_fetch_assoc($products)) {\n      echo \"<div>\";\n      echo \"<h2>\" . $product['name'] . \"</h2>\";\n      echo \"<p>Price: $\" . number_format($product['price'], 2) . \"</p>\";\n      echo \"<form action='' method='post'>\";\n      echo \"<input type='hidden' name='product_id' value='\" . $product['id'] . \"'>\";\n      echo \"<button type='submit' name='add_to_cart'>Add to Cart</button>\";\n      echo \"</form>\";\n      echo \"</div>\";\n    }\n  ?>\n\n  <!-- Display cart -->\n  <?php\n    if (isset($_SESSION['cart'])) {\n      echo \"<h2>Cart:</h2>\";\n      echo \"<ul>\";\n      foreach ($_SESSION['cart'] as $product_id => $quantity) {\n        echo \"<li>\" . get_product_name($product_id) . \" x \" . $quantity . \"</li>\";\n      }\n      echo \"</ul>\";\n\n      // Display total\n      $total = 0;\n      foreach ($_SESSION['cart'] as $product_id => $quantity) {\n        $price = get_product_price($product_id);\n        $subtotal = $price * $quantity;\n        $total += $subtotal;\n      }\n      echo \"<p>Total: $\" . number_format($total, 2) . \"</p>\";\n\n      // Display checkout button\n      echo \"<form action='' method='post'>\";\n      echo \"<button type='submit' name='process_order'>Checkout</button>\";\n      echo \"</form>\";\n    }\n  ?>\n\n  <!-- JavaScript for cart functionality -->\n  <script>\n    function update_cart() {\n      var product_id = document.getElementById('product_id').value;\n      var quantity = document.getElementById('quantity').value;\n\n      $.ajax({\n        type: 'POST',\n        url: '?add_to_cart=true',\n        data: {product_id: product_id, quantity: quantity},\n        success: function(data) {\n          alert('Added to cart!');\n        }\n      });\n    }\n\n    $(document).ready(function() {\n      $('#add-to-cart').click(function(e) {\n        e.preventDefault();\n        update_cart();\n      });\n    });\n  </script>\n\n</body>\n</html>\n```\n\n**config.php**\n\n```php\n<?php\n// Configuration\ndefine('DB_HOST', 'localhost');\ndefine('DB_USERNAME', 'your_username');\ndefine('DB_PASSWORD', 'your_password');\ndefine('DB_NAME', 'your_database');\n\n$conn = new mysqli(DB_HOST, DB_USERNAME, DB_PASSWORD, DB_NAME);\n\nif ($conn->connect_error) {\n  die(\"Connection failed: \" . $conn->connect_error);\n}\n```\n\nNote that this is a basic example and you should adjust the code to fit your specific needs. Additionally, this example assumes that you have already set up a MySQL database with the necessary tables.\n\nAlso, make sure to replace `'your_username'`, `'your_password'`, and `'your_database'` with your actual database credentials and name.\n\nThis code is for educational purposes only and should not be used in production without proper security measures.", "code_blocks": [null, "```php\n// Configuration\nrequire_once 'config.php';\n\n// Functions\nfunction get_products() {\n  global $conn;\n  $query = \"SELECT * FROM products\";\n  $result = mysqli_query($conn, $query);\n  return $result;\n}\n\nfunction add_to_cart() {\n  global $conn, $_SESSION;\n  $product_id = $_POST['product_id'];\n  $quantity = $_POST['quantity'];\n\n  $query = \"INSERT INTO cart (customer_id, product_id, quantity) VALUES (?, ?, ?)\";\n  $stmt = mysqli_prepare($conn, $query);\n  mysqli_stmt_bind_param($stmt, 'iis', $_SESSION['customer_id'], $product_id, $quantity);\n  mysqli_stmt_execute($stmt);\n\n  header('Location: view_cart.php');\n  exit;\n}\n\nfunction process_order() {\n  global $conn, $_SESSION;\n\n  // Get cart items\n  $query = \"SELECT * FROM cart WHERE customer_id = ?\";\n  $stmt = mysqli_prepare($conn, $query);\n  mysqli_stmt_bind_param($stmt, 'i', $_SESSION['customer_id']);\n  mysqli_stmt_execute($stmt);\n  $result = mysqli_stmt_get_result($stmt);\n\n  // Calculate total\n  $total = 0;\n  while ($row = mysqli_fetch_assoc($result)) {\n    $product_price = get_product_price($row['product_id']);\n    $quantity = $row['quantity'];\n    $subtotal = $product_price * $quantity;\n    $total += $subtotal;\n  }\n\n  // Insert order\n  $query = \"INSERT INTO orders (customer_id, total) VALUES (?, ?)\";\n  $stmt = mysqli_prepare($conn, $query);\n  mysqli_stmt_bind_param($stmt, 'ii', $_SESSION['customer_id'], $total);\n  mysqli_stmt_execute($stmt);\n\n  // Clear cart\n  $query = \"DELETE FROM cart WHERE customer_id = ?\";\n  $stmt = mysqli_prepare($conn, $query);\n  mysqli_stmt_bind_param($stmt, 'i', $_SESSION['customer_id']);\n  mysqli_stmt_execute($stmt);\n\n  header('Location: view_order.php');\n  exit;\n}\n\nfunction get_product_price($product_id) {\n  global $conn;\n  $query = \"SELECT price FROM products WHERE id = ?\";\n  $stmt = mysqli_prepare($conn, $query);\n  mysqli_stmt_bind_param($stmt, 'i', $product_id);\n  mysqli_stmt_execute($stmt);\n  $result = mysqli_stmt_get_result($stmt);\n  return mysqli_fetch_assoc($result)['price'];\n}\n\n// Process requests\nif (isset($_POST['add_to_cart'])) {\n  add_to_cart();\n} elseif (isset($_POST['process_order'])) {\n  process_order();\n}\n```", null, "```php\n<?php\n// Configuration\ndefine('DB_HOST', 'localhost');\ndefine('DB_USERNAME', 'your_username');\ndefine('DB_PASSWORD', 'your_password');\ndefine('DB_NAME', 'your_database');\n\n$conn = new mysqli(DB_HOST, DB_USERNAME, DB_PASSWORD, DB_NAME);\n\nif ($conn->connect_error) {\n  die(\"Connection failed: \" . $conn->connect_error);\n}\n```"]}
