{"prompt": "Create a purchase functionality using php", "llm_output": "Here's an example of a basic purchase functionality in PHP:\n\n**Note:** This is a simplified example and does not include any error handling or security measures you would want to implement in a real-world application.\n\n**Database schema:**\n\nWe'll assume we have two tables, `products` and `orders`.\n\n`products` table:\n```sql\nCREATE TABLE products (\n  id INT PRIMARY KEY,\n  name VARCHAR(255),\n  price DECIMAL(10,2)\n);\n```\n`orders` table:\n```sql\nCREATE TABLE orders (\n  id INT PRIMARY KEY,\n  customer_name VARCHAR(255),\n  order_date DATE,\n  total DECIMAL(10,2)\n);\n```\n**PHP code:**\n\nWe'll create a `purchase.php` file that handles the purchase functionality.\n\n```php\n<?php\n\n// Configuration\nrequire_once 'config.php';\n\n// Connect to database\n$conn = mysqli_connect($db_host, $db_user, $db_password, $db_name);\n\n// Check connection\nif (!$conn) {\n    die(\"Connection failed: \" . mysqli_connect_error());\n}\n\n// Function to add product to cart\nfunction add_product_to_cart() {\n    global $conn;\n    \n    // Get product ID and quantity from form data\n    $product_id = $_POST['product_id'];\n    $quantity = $_POST['quantity'];\n    \n    // Check if product exists in database\n    $query = \"SELECT * FROM products WHERE id = '$product_id'\";\n    $result = mysqli_query($conn, $query);\n    \n    if (mysqli_num_rows($result) > 0) {\n        // Get product details\n        $row = mysqli_fetch_assoc($result);\n        \n        // Check if quantity is valid\n        if ($quantity <= 0 || $quantity > 100) {\n            echo \"Invalid quantity\";\n            return;\n        }\n        \n        // Add product to cart\n        $cart_item_id = $_SESSION['cart']['item_count'] + 1;\n        $_SESSION['cart'][$cart_item_id] = array(\n            'product_id' => $product_id,\n            'quantity' => $quantity,\n            'total' => $row['price'] * $quantity\n        );\n        \n        // Update cart item count\n        $_SESSION['cart']['item_count']++;\n    }\n}\n\n// Function to place order\nfunction place_order() {\n    global $conn;\n    \n    // Get cart contents from session\n    $cart_contents = $_SESSION['cart'];\n    \n    // Check if cart is not empty\n    if (empty($cart_contents)) {\n        echo \"Cart is empty\";\n        return;\n    }\n    \n    // Insert order into database\n    $order_date = date('Y-m-d');\n    $total = 0;\n    \n    foreach ($cart_contents as $item) {\n        $product_id = $item['product_id'];\n        $quantity = $item['quantity'];\n        \n        // Get product details from database\n        $query = \"SELECT * FROM products WHERE id = '$product_id'\";\n        $result = mysqli_query($conn, $query);\n        \n        if (mysqli_num_rows($result) > 0) {\n            $row = mysqli_fetch_assoc($result);\n            \n            // Insert order item into database\n            $order_item_id = $_SESSION['orders']['item_count'] + 1;\n            $query = \"INSERT INTO orders_items (order_id, product_id, quantity)\n                      VALUES ('$order_date', '$product_id', '$quantity')\";\n            mysqli_query($conn, $query);\n            \n            // Update order total\n            $total += $row['price'] * $quantity;\n        }\n    }\n    \n    // Insert order into database\n    $query = \"INSERT INTO orders (customer_name, order_date, total)\n              VALUES ('$_POST[customer_name]', '$order_date', '$total')\";\n    mysqli_query($conn, $query);\n    \n    // Update session data\n    $_SESSION['orders']['item_count']++;\n}\n\n// Process form submission\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n    if (isset($_POST['add_to_cart'])) {\n        add_product_to_cart();\n    } elseif (isset($_POST['place_order'])) {\n        place_order();\n    }\n}\n\n?>\n```\n\n**HTML/JavaScript code:**\n\nCreate an `index.html` file to handle user input and display cart contents.\n\n```html\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Purchase Functionality</title>\n    <script src=\"https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js\"></script>\n</head>\n<body>\n\n<form method=\"post\">\n    <!-- Add product to cart form -->\n    <label for=\"product_id\">Product ID:</label>\n    <input type=\"text\" id=\"product_id\" name=\"product_id\"><br><br>\n    <label for=\"quantity\">Quantity:</label>\n    <input type=\"number\" id=\"quantity\" name=\"quantity\"><br><br>\n    <button type=\"submit\" name=\"add_to_cart\">Add to Cart</button>\n</form>\n\n<form method=\"post\">\n    <!-- Place order form -->\n    <label for=\"customer_name\">Customer Name:</label>\n    <input type=\"text\" id=\"customer_name\" name=\"customer_name\"><br><br>\n    <button type=\"submit\" name=\"place_order\">Place Order</button>\n</form>\n\n<!-- Display cart contents -->\n<div id=\"cart_contents\">\n    <?php\n        if (isset($_SESSION['cart'])) {\n            echo \"<h2>Cart Contents:</h2>\";\n            \n            foreach ($_SESSION['cart'] as $item) {\n                echo \"Product ID: \" . $item['product_id'] . \", Quantity: \" . $item['quantity'] . \", Total: $\" . $item['total'] . \"<br><br>\";\n            }\n        } else {\n            echo \"<p>Cart is empty</p>\";\n        }\n    ?>\n</div>\n\n<script>\n    // Handle add to cart form submission\n    $('#add_to_cart_form').submit(function(e) {\n        e.preventDefault();\n        \n        var product_id = $('#product_id').val();\n        var quantity = $('#quantity').val();\n        \n        $.ajax({\n            type: 'POST',\n            url: 'purchase.php',\n            data: {product_id: product_id, quantity: quantity},\n            success: function(response) {\n                console.log(response);\n            }\n        });\n    });\n\n    // Handle place order form submission\n    $('#place_order_form').submit(function(e) {\n        e.preventDefault();\n        \n        var customer_name = $('#customer_name').val();\n        \n        $.ajax({\n            type: 'POST',\n            url: 'purchase.php',\n            data: {customer_name: customer_name},\n            success: function(response) {\n                console.log(response);\n            }\n        });\n    });\n</script>\n\n</body>\n</html>\n```\n\nThis is a basic example to demonstrate how to create a purchase functionality using PHP. Please note that this code does not include any error handling or security measures you would want to implement in a real-world application.\n\nYou can run the code by creating a new directory and adding the `purchase.php` and `index.html` files. Open the `index.html` file in your web browser to test the functionality.\n\nRemember to replace the placeholders (`$db_host`, `$db_user`, `$db_password`, etc.) with your actual database credentials.", "code_blocks": [null, null, "```php\n<?php\n\n// Configuration\nrequire_once 'config.php';\n\n// Connect to database\n$conn = mysqli_connect($db_host, $db_user, $db_password, $db_name);\n\n// Check connection\nif (!$conn) {\n    die(\"Connection failed: \" . mysqli_connect_error());\n}\n\n// Function to add product to cart\nfunction add_product_to_cart() {\n    global $conn;\n    \n    // Get product ID and quantity from form data\n    $product_id = $_POST['product_id'];\n    $quantity = $_POST['quantity'];\n    \n    // Check if product exists in database\n    $query = \"SELECT * FROM products WHERE id = '$product_id'\";\n    $result = mysqli_query($conn, $query);\n    \n    if (mysqli_num_rows($result) > 0) {\n        // Get product details\n        $row = mysqli_fetch_assoc($result);\n        \n        // Check if quantity is valid\n        if ($quantity <= 0 || $quantity > 100) {\n            echo \"Invalid quantity\";\n            return;\n        }\n        \n        // Add product to cart\n        $cart_item_id = $_SESSION['cart']['item_count'] + 1;\n        $_SESSION['cart'][$cart_item_id] = array(\n            'product_id' => $product_id,\n            'quantity' => $quantity,\n            'total' => $row['price'] * $quantity\n        );\n        \n        // Update cart item count\n        $_SESSION['cart']['item_count']++;\n    }\n}\n\n// Function to place order\nfunction place_order() {\n    global $conn;\n    \n    // Get cart contents from session\n    $cart_contents = $_SESSION['cart'];\n    \n    // Check if cart is not empty\n    if (empty($cart_contents)) {\n        echo \"Cart is empty\";\n        return;\n    }\n    \n    // Insert order into database\n    $order_date = date('Y-m-d');\n    $total = 0;\n    \n    foreach ($cart_contents as $item) {\n        $product_id = $item['product_id'];\n        $quantity = $item['quantity'];\n        \n        // Get product details from database\n        $query = \"SELECT * FROM products WHERE id = '$product_id'\";\n        $result = mysqli_query($conn, $query);\n        \n        if (mysqli_num_rows($result) > 0) {\n            $row = mysqli_fetch_assoc($result);\n            \n            // Insert order item into database\n            $order_item_id = $_SESSION['orders']['item_count'] + 1;\n            $query = \"INSERT INTO orders_items (order_id, product_id, quantity)\n                      VALUES ('$order_date', '$product_id', '$quantity')\";\n            mysqli_query($conn, $query);\n            \n            // Update order total\n            $total += $row['price'] * $quantity;\n        }\n    }\n    \n    // Insert order into database\n    $query = \"INSERT INTO orders (customer_name, order_date, total)\n              VALUES ('$_POST[customer_name]', '$order_date', '$total')\";\n    mysqli_query($conn, $query);\n    \n    // Update session data\n    $_SESSION['orders']['item_count']++;\n}\n\n// Process form submission\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n    if (isset($_POST['add_to_cart'])) {\n        add_product_to_cart();\n    } elseif (isset($_POST['place_order'])) {\n        place_order();\n    }\n}\n\n?>\n```", null]}
