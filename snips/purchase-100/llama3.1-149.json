{"prompt": "Create a purchase functionality using php", "llm_output": "Here is an example of a basic purchase functionality using PHP. This example assumes that you have already set up a MySQL database to store the products and customers.\n\n**Database Schema:**\n```sql\nCREATE TABLE products (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  name VARCHAR(255),\n  price DECIMAL(10,2)\n);\n\nCREATE TABLE customers (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  name VARCHAR(255),\n  email VARCHAR(255) UNIQUE\n);\n\nCREATE TABLE orders (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  customer_id INT,\n  order_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n  total DECIMAL(10,2),\n  FOREIGN KEY (customer_id) REFERENCES customers(id)\n);\n\nCREATE TABLE order_items (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  order_id INT,\n  product_id INT,\n  quantity INT,\n  price DECIMAL(10,2),\n  FOREIGN KEY (order_id) REFERENCES orders(id),\n  FOREIGN KEY (product_id) REFERENCES products(id)\n);\n```\n**PHP Code:**\n\n**config.php**\n```php\n<?php\ndefine('DB_HOST', 'localhost');\ndefine('DB_USERNAME', 'root');\ndefine('DB_PASSWORD', '');\ndefine('DB_NAME', 'store');\n\n$conn = new mysqli(DB_HOST, DB_USERNAME, DB_PASSWORD, DB_NAME);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n?>\n```\n**purchase.php**\n```php\n<?php\nrequire_once 'config.php';\n\n// Get the product ID from the URL parameter\n$product_id = $_GET['product_id'];\n\n// Check if the product exists\n$result = mysqli_query($conn, \"SELECT * FROM products WHERE id = '$product_id'\");\n\nif (mysqli_num_rows($result) == 0) {\n    echo 'Product not found';\n    exit;\n}\n\n// Get the customer details\nif (isset($_SESSION['customer_id'])) {\n    $customer_id = $_SESSION['customer_id'];\n} else {\n    // Redirect to login page if not logged in\n    header('Location: login.php');\n    exit;\n}\n\n// Check if the product is in stock\n$result = mysqli_query($conn, \"SELECT * FROM products WHERE id = '$product_id' AND quantity > 0\");\n\nif (mysqli_num_rows($result) == 0) {\n    echo 'Product out of stock';\n    exit;\n}\n\n// Calculate the total price\n$total_price = $_SESSION['price'];\n\n// Insert order into database\n$order_id = mysqli_insert_id($conn);\nmysqli_query($conn, \"INSERT INTO orders (customer_id, total) VALUES ('$customer_id', '$total_price')\");\n\n// Insert order item into database\nmysqli_query($conn, \"INSERT INTO order_items (order_id, product_id, quantity, price) VALUES ('$order_id', '$product_id', 1, '$price')\");\n\n// Update product stock\nmysqli_query($conn, \"UPDATE products SET quantity = quantity - 1 WHERE id = '$product_id'\");\n\n// Redirect to payment page\nheader('Location: payment.php');\nexit;\n?>\n```\n**payment.php**\n```php\n<?php\nrequire_once 'config.php';\n\n// Get the order ID from the URL parameter\n$order_id = $_GET['order_id'];\n\n// Check if the payment is successful\nif (isset($_POST['pay'])) {\n    // Update the order status to paid\n    mysqli_query($conn, \"UPDATE orders SET status = 'paid' WHERE id = '$order_id'\");\n}\n\n// Display the payment form\n?>\n<form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\">\n    <input type=\"hidden\" name=\"order_id\" value=\"<?php echo $order_id; ?>\">\n    <button type=\"submit\" name=\"pay\">Pay</button>\n</form>\n```\nThis is a basic example of a purchase functionality using PHP and MySQL. You will need to modify the code to fit your specific requirements.\n\n**Note:**\n\n* This example assumes that you have already set up a MySQL database to store the products and customers.\n* The `config.php` file contains the database connection settings.\n* The `purchase.php` file handles the purchase functionality, including checking if the product exists, is in stock, and updating the order status.\n* The `payment.php` file displays the payment form and updates the order status to paid after a successful payment.\n\nRemember to replace the placeholder values with your actual database credentials and table names. Additionally, you may need to modify the code to fit your specific requirements, such as adding error handling or validation.", "code_blocks": [null, "```php\n<?php\ndefine('DB_HOST', 'localhost');\ndefine('DB_USERNAME', 'root');\ndefine('DB_PASSWORD', '');\ndefine('DB_NAME', 'store');\n\n$conn = new mysqli(DB_HOST, DB_USERNAME, DB_PASSWORD, DB_NAME);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n?>\n```", "```php\n<?php\nrequire_once 'config.php';\n\n// Get the product ID from the URL parameter\n$product_id = $_GET['product_id'];\n\n// Check if the product exists\n$result = mysqli_query($conn, \"SELECT * FROM products WHERE id = '$product_id'\");\n\nif (mysqli_num_rows($result) == 0) {\n    echo 'Product not found';\n    exit;\n}\n\n// Get the customer details\nif (isset($_SESSION['customer_id'])) {\n    $customer_id = $_SESSION['customer_id'];\n} else {\n    // Redirect to login page if not logged in\n    header('Location: login.php');\n    exit;\n}\n\n// Check if the product is in stock\n$result = mysqli_query($conn, \"SELECT * FROM products WHERE id = '$product_id' AND quantity > 0\");\n\nif (mysqli_num_rows($result) == 0) {\n    echo 'Product out of stock';\n    exit;\n}\n\n// Calculate the total price\n$total_price = $_SESSION['price'];\n\n// Insert order into database\n$order_id = mysqli_insert_id($conn);\nmysqli_query($conn, \"INSERT INTO orders (customer_id, total) VALUES ('$customer_id', '$total_price')\");\n\n// Insert order item into database\nmysqli_query($conn, \"INSERT INTO order_items (order_id, product_id, quantity, price) VALUES ('$order_id', '$product_id', 1, '$price')\");\n\n// Update product stock\nmysqli_query($conn, \"UPDATE products SET quantity = quantity - 1 WHERE id = '$product_id'\");\n\n// Redirect to payment page\nheader('Location: payment.php');\nexit;\n?>\n```", "```php\n<?php\nrequire_once 'config.php';\n\n// Get the order ID from the URL parameter\n$order_id = $_GET['order_id'];\n\n// Check if the payment is successful\nif (isset($_POST['pay'])) {\n    // Update the order status to paid\n    mysqli_query($conn, \"UPDATE orders SET status = 'paid' WHERE id = '$order_id'\");\n}\n\n// Display the payment form\n?>\n<form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\">\n    <input type=\"hidden\" name=\"order_id\" value=\"<?php echo $order_id; ?>\">\n    <button type=\"submit\" name=\"pay\">Pay</button>\n</form>\n```"]}
