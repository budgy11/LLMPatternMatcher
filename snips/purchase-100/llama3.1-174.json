{"prompt": "Create a purchase functionality using php", "llm_output": "Here is an example of a basic purchase functionality in PHP, including user authentication and payment processing. This example assumes you have a database setup with tables for users, products, and orders.\n\n**Note:** This is a simplified example and should not be used as-is in production without proper security measures (e.g., input validation, error handling, and encryption).\n\n**Database Schema:**\n\n```sql\nCREATE TABLE users (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  username VARCHAR(255) NOT NULL,\n  password VARCHAR(255) NOT NULL\n);\n\nCREATE TABLE products (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  name VARCHAR(255) NOT NULL,\n  price DECIMAL(10,2) NOT NULL\n);\n\nCREATE TABLE orders (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  user_id INT NOT NULL,\n  product_id INT NOT NULL,\n  quantity INT NOT NULL,\n  total DECIMAL(10,2) NOT NULL,\n  FOREIGN KEY (user_id) REFERENCES users(id),\n  FOREIGN KEY (product_id) REFERENCES products(id)\n);\n```\n\n**PHP Code:**\n\n**`config.php`:**\n```php\n<?php\ndefine('DB_HOST', 'localhost');\ndefine('DB_USERNAME', 'your_username');\ndefine('DB_PASSWORD', 'your_password');\ndefine('DB_NAME', 'your_database');\n\n$conn = new mysqli(DB_HOST, DB_USERNAME, DB_PASSWORD, DB_NAME);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\nsession_start();\n?>\n```\n\n**`authenticate.php`:**\n```php\n<?php\nrequire_once('config.php');\n\nif (isset($_POST['username']) && isset($_POST['password'])) {\n    $username = $_POST['username'];\n    $password = $_POST['password'];\n\n    $query = \"SELECT * FROM users WHERE username = '$username'\";\n    $result = $conn->query($query);\n\n    if ($result->num_rows > 0) {\n        while ($row = $result->fetch_assoc()) {\n            if (password_verify($password, $row['password'])) {\n                $_SESSION['user_id'] = $row['id'];\n                header('Location: products.php');\n                exit;\n            }\n        }\n    }\n\n    echo 'Invalid username or password';\n}\n?>\n```\n\n**`products.php`:**\n```php\n<?php\nrequire_once('config.php');\n\nif (isset($_SESSION['user_id'])) {\n    echo '<h1>Products</h1>';\n\n    $query = \"SELECT * FROM products\";\n    $result = $conn->query($query);\n\n    if ($result->num_rows > 0) {\n        while ($row = $result->fetch_assoc()) {\n            echo \"<p>ID: {$row['id']} - Name: {$row['name']} - Price: {$row['price']}</p>\";\n            echo '<form action=\"purchase.php\" method=\"post\">';\n            echo '<input type=\"hidden\" name=\"product_id\" value=\"' . $row['id'] . '\">';\n            echo '<button type=\"submit\">Purchase</button>';\n            echo '</form>';\n        }\n    } else {\n        echo 'No products available';\n    }\n} else {\n    header('Location: authenticate.php');\n}\n?>\n```\n\n**`purchase.php`:**\n```php\n<?php\nrequire_once('config.php');\n\nif (isset($_POST['product_id'])) {\n    $user_id = $_SESSION['user_id'];\n    $product_id = $_POST['product_id'];\n\n    $query = \"INSERT INTO orders SET user_id = '$user_id', product_id = '$product_id', quantity = 1, total = (SELECT price FROM products WHERE id = '$product_id')\";\n    $conn->query($query);\n\n    echo 'Purchase successful!';\n} else {\n    header('Location: products.php');\n}\n?>\n```\n\nThis code allows users to:\n\n*   Authenticate with a username and password\n*   View available products\n*   Purchase a product, which creates an order in the database\n\nRemember that this is a simplified example. You should add proper input validation, error handling, and security measures (e.g., encryption) before using it in production.\n\n**Note:** This code uses `password_verify` for password hashing, which is recommended for storing passwords securely.", "code_blocks": [null, "```php\n<?php\ndefine('DB_HOST', 'localhost');\ndefine('DB_USERNAME', 'your_username');\ndefine('DB_PASSWORD', 'your_password');\ndefine('DB_NAME', 'your_database');\n\n$conn = new mysqli(DB_HOST, DB_USERNAME, DB_PASSWORD, DB_NAME);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\nsession_start();\n?>\n```", "```php\n<?php\nrequire_once('config.php');\n\nif (isset($_POST['username']) && isset($_POST['password'])) {\n    $username = $_POST['username'];\n    $password = $_POST['password'];\n\n    $query = \"SELECT * FROM users WHERE username = '$username'\";\n    $result = $conn->query($query);\n\n    if ($result->num_rows > 0) {\n        while ($row = $result->fetch_assoc()) {\n            if (password_verify($password, $row['password'])) {\n                $_SESSION['user_id'] = $row['id'];\n                header('Location: products.php');\n                exit;\n            }\n        }\n    }\n\n    echo 'Invalid username or password';\n}\n?>\n```", "```php\n<?php\nrequire_once('config.php');\n\nif (isset($_SESSION['user_id'])) {\n    echo '<h1>Products</h1>';\n\n    $query = \"SELECT * FROM products\";\n    $result = $conn->query($query);\n\n    if ($result->num_rows > 0) {\n        while ($row = $result->fetch_assoc()) {\n            echo \"<p>ID: {$row['id']} - Name: {$row['name']} - Price: {$row['price']}</p>\";\n            echo '<form action=\"purchase.php\" method=\"post\">';\n            echo '<input type=\"hidden\" name=\"product_id\" value=\"' . $row['id'] . '\">';\n            echo '<button type=\"submit\">Purchase</button>';\n            echo '</form>';\n        }\n    } else {\n        echo 'No products available';\n    }\n} else {\n    header('Location: authenticate.php');\n}\n?>\n```", "```php\n<?php\nrequire_once('config.php');\n\nif (isset($_POST['product_id'])) {\n    $user_id = $_SESSION['user_id'];\n    $product_id = $_POST['product_id'];\n\n    $query = \"INSERT INTO orders SET user_id = '$user_id', product_id = '$product_id', quantity = 1, total = (SELECT price FROM products WHERE id = '$product_id')\";\n    $conn->query($query);\n\n    echo 'Purchase successful!';\n} else {\n    header('Location: products.php');\n}\n?>\n```"]}
