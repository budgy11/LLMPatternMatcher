{"prompt": "Create a purchase functionality using php", "llm_output": "Here is an example of how to create a simple purchase functionality using PHP:\n\n**Database Schema:**\n```sql\nCREATE TABLE products (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  name VARCHAR(255),\n  price DECIMAL(10,2)\n);\n\nCREATE TABLE orders (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  user_id INT,\n  total DECIMAL(10,2),\n  status ENUM('pending', 'shipped', 'delivered')\n);\n\nCREATE TABLE order_items (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  order_id INT,\n  product_id INT,\n  quantity INT\n);\n```\n**PHP Code:**\n```php\n// Configuration file (e.g. config.php)\n<?php\n\ndefine('DB_HOST', 'localhost');\ndefine('DB_USERNAME', 'your_username');\ndefine('DB_PASSWORD', 'your_password');\ndefine('DB_NAME', 'your_database');\n\n?>\n```\n\n```php\n// Connection to database\nfunction connect_to_db() {\n  $conn = new PDO(\"mysql:host=\".DB_HOST.\";dbname=\".DB_NAME, DB_USERNAME, DB_PASSWORD);\n  return $conn;\n}\n\n// Function to add product to cart\nfunction add_product_to_cart($product_id, $quantity) {\n  $conn = connect_to_db();\n  $stmt = $conn->prepare(\"INSERT INTO order_items (order_id, product_id, quantity) VALUES (:order_id, :product_id, :quantity)\");\n  $stmt->bindParam(':order_id', $_SESSION['cart']['id']);\n  $stmt->bindParam(':product_id', $product_id);\n  $stmt->bindParam(':quantity', $quantity);\n  if ($stmt->execute()) {\n    return true;\n  } else {\n    return false;\n  }\n}\n\n// Function to checkout\nfunction checkout() {\n  $conn = connect_to_db();\n  $order_id = $_SESSION['cart']['id'];\n  $total = $_SESSION['cart']['total'];\n  $status = 'pending';\n  $stmt = $conn->prepare(\"INSERT INTO orders (user_id, total, status) VALUES (:user_id, :total, :status)\");\n  $stmt->bindParam(':user_id', $_SESSION['user']['id']);\n  $stmt->bindParam(':total', $total);\n  $stmt->bindParam(':status', $status);\n  if ($stmt->execute()) {\n    // Update order items with the new order id\n    $order_items_stmt = $conn->prepare(\"UPDATE order_items SET order_id = :order_id WHERE order_id = :old_order_id\");\n    $order_items_stmt->bindParam(':order_id', $order_id);\n    $order_items_stmt->bindParam(':old_order_id', $_SESSION['cart']['id']);\n    if ($order_items_stmt->execute()) {\n      // Clear the cart\n      unset($_SESSION['cart']);\n      return true;\n    } else {\n      return false;\n    }\n  } else {\n    return false;\n  }\n}\n\n// Function to purchase product\nfunction purchase_product($product_id, $quantity) {\n  $conn = connect_to_db();\n  $stmt = $conn->prepare(\"SELECT * FROM products WHERE id = :id\");\n  $stmt->bindParam(':id', $product_id);\n  if ($stmt->execute()) {\n    $product_data = $stmt->fetch();\n    if (isset($_SESSION['cart']['total'])) {\n      $_SESSION['cart']['total'] += ($product_data['price'] * $quantity);\n    } else {\n      $_SESSION['cart']['total'] = ($product_data['price'] * $quantity);\n    }\n    // Add product to cart\n    add_product_to_cart($product_id, $quantity);\n  }\n}\n```\n**Example Usage:**\n```php\n// Set up session variables\n$_SESSION['user']['id'] = 1;\n$_SESSION['cart'] = array('total' => 0);\n\n// Purchase a product\npurchase_product(1, 2); // Product ID: 1, Quantity: 2\n\n// Checkout\nif (checkout()) {\n  echo 'Order successful!';\n} else {\n  echo 'Error placing order.';\n}\n```\nNote that this is a simplified example and you should add proper error handling, security measures, and validation to your code. Additionally, the database schema and PHP code are just examples and may need to be adjusted based on your specific requirements.\n\nAlso, this example assumes that you have already set up sessions in your application using `session_start()` or equivalent.\n\nRemember to always use prepared statements to prevent SQL injection attacks!", "code_blocks": [null, "```php\n// Configuration file (e.g. config.php)\n<?php\n\ndefine('DB_HOST', 'localhost');\ndefine('DB_USERNAME', 'your_username');\ndefine('DB_PASSWORD', 'your_password');\ndefine('DB_NAME', 'your_database');\n\n?>\n```", "```php\n// Connection to database\nfunction connect_to_db() {\n  $conn = new PDO(\"mysql:host=\".DB_HOST.\";dbname=\".DB_NAME, DB_USERNAME, DB_PASSWORD);\n  return $conn;\n}\n\n// Function to add product to cart\nfunction add_product_to_cart($product_id, $quantity) {\n  $conn = connect_to_db();\n  $stmt = $conn->prepare(\"INSERT INTO order_items (order_id, product_id, quantity) VALUES (:order_id, :product_id, :quantity)\");\n  $stmt->bindParam(':order_id', $_SESSION['cart']['id']);\n  $stmt->bindParam(':product_id', $product_id);\n  $stmt->bindParam(':quantity', $quantity);\n  if ($stmt->execute()) {\n    return true;\n  } else {\n    return false;\n  }\n}\n\n// Function to checkout\nfunction checkout() {\n  $conn = connect_to_db();\n  $order_id = $_SESSION['cart']['id'];\n  $total = $_SESSION['cart']['total'];\n  $status = 'pending';\n  $stmt = $conn->prepare(\"INSERT INTO orders (user_id, total, status) VALUES (:user_id, :total, :status)\");\n  $stmt->bindParam(':user_id', $_SESSION['user']['id']);\n  $stmt->bindParam(':total', $total);\n  $stmt->bindParam(':status', $status);\n  if ($stmt->execute()) {\n    // Update order items with the new order id\n    $order_items_stmt = $conn->prepare(\"UPDATE order_items SET order_id = :order_id WHERE order_id = :old_order_id\");\n    $order_items_stmt->bindParam(':order_id', $order_id);\n    $order_items_stmt->bindParam(':old_order_id', $_SESSION['cart']['id']);\n    if ($order_items_stmt->execute()) {\n      // Clear the cart\n      unset($_SESSION['cart']);\n      return true;\n    } else {\n      return false;\n    }\n  } else {\n    return false;\n  }\n}\n\n// Function to purchase product\nfunction purchase_product($product_id, $quantity) {\n  $conn = connect_to_db();\n  $stmt = $conn->prepare(\"SELECT * FROM products WHERE id = :id\");\n  $stmt->bindParam(':id', $product_id);\n  if ($stmt->execute()) {\n    $product_data = $stmt->fetch();\n    if (isset($_SESSION['cart']['total'])) {\n      $_SESSION['cart']['total'] += ($product_data['price'] * $quantity);\n    } else {\n      $_SESSION['cart']['total'] = ($product_data['price'] * $quantity);\n    }\n    // Add product to cart\n    add_product_to_cart($product_id, $quantity);\n  }\n}\n```", "```php\n// Set up session variables\n$_SESSION['user']['id'] = 1;\n$_SESSION['cart'] = array('total' => 0);\n\n// Purchase a product\npurchase_product(1, 2); // Product ID: 1, Quantity: 2\n\n// Checkout\nif (checkout()) {\n  echo 'Order successful!';\n} else {\n  echo 'Error placing order.';\n}\n```"]}
