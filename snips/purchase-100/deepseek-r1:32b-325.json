{"prompt": "Create a purchase functionality using php", "llm_output": "<think>\nAlright, the user wants to create a purchase functionality using PHP. I need to outline the essential steps and considerations for this.\n\nFirst, I'll start by understanding the main components involved in a purchase process. There's the product display, adding items to the cart, viewing the cart, checkout, payment processing, order confirmation, and admin backend management.\n\nI should begin with setting up the database because that's foundational. Creating tables for products, orders, and order details makes sense. The products table will hold item information, orders will track customer purchases, and order details will store each item in an order.\n\nNext, displaying products is crucial. I'll need to fetch data from the database and present it on a webpage. Using PHP to loop through results and display them in a user-friendly manner, maybe using Bootstrap for styling to make it responsive.\n\nThen, handling the shopping cart functionality. Sessions are perfect here because they store data temporarily. When a user adds an item, I'll check if it's already in the session; if so, increment the quantity, else add it as a new entry.\n\nMoving on to displaying the cart contents. Again, using sessions to retrieve items and show them dynamically. Including options to remove items or adjust quantities is important for usability.\n\nCheckout involves collecting customer details. I'll create a form that captures necessary information like name, email, address, phone, and payment method. Validation is key here\u2014using JavaScript to ensure all required fields are filled before submission.\n\nProcessing the order is where the backend does the heavy lifting. I'll validate the input data again for security, calculate the total amount, then insert the order into the orders table. Using transactions ensures that multiple database operations either all succeed or fail together, preventing inconsistencies.\n\nAfter a successful purchase, redirecting to an order confirmation page with details like order ID and total is essential for user feedback. Storing this information in the session helps display it without relying on the database again immediately.\n\nOn the admin side, displaying orders allows management. Fetching all orders from the database and presenting them in a table format makes it easy to review each purchase and its items.\n\nSecurity is a big concern throughout. I'll use prepared statements with mysqli to prevent SQL injection. Also, sanitizing inputs and validating both on client and server sides helps protect against attacks.\n\nTesting is something I shouldn't overlook. Manually checking each part of the process ensures everything works smoothly\u2014adding products, managing the cart, checkout flow, order confirmation, and admin access.\n\nConsidering future enhancements like integrating payment gateways or adding an admin panel for product management can make the system more robust. Also, user authentication could be added later to improve security and personalization.\n\nFinally, organizing the code into separate files keeps things clean and manageable. Using includes allows for reusing common parts like headers and footers across multiple pages.\n\nIn summary, breaking down the problem into these steps helps create a structured approach to building the purchase functionality in PHP, ensuring each component works together securely and efficiently.\n</think>\n\nTo create a purchase functionality using PHP, you'll need to follow several steps including database setup, product display, shopping cart management, checkout process, payment processing, and order confirmation. Below is a basic implementation:\n\n### Step 1: Database Setup\nFirst, create the necessary tables in your MySQL database.\n\n```sql\n-- Create products table\nCREATE TABLE products (\n    id INT AUTO_INCREMENT PRIMARY KEY,\n    name VARCHAR(255) NOT NULL,\n    price DECIMAL(10,2) NOT NULL,\n    description TEXT,\n    image VARCHAR(255)\n);\n\n-- Create orders table\nCREATE TABLE orders (\n    order_id INT AUTO_INCREMENT PRIMARY KEY,\n    user_name VARCHAR(255),\n    email VARCHAR(255),\n    address VARCHAR(255),\n    phone VARCHAR(15),\n    total DECIMAL(10,2),\n    payment_method VARCHAR(255)\n);\n\n-- Create order_details table\nCREATE TABLE order_details (\n    id INT AUTO_INCREMENT PRIMARY KEY,\n    order_id INT NOT NULL,\n    product_id INT NOT NULL,\n    quantity INT DEFAULT 1,\n    price DECIMAL(10,2) NOT NULL,\n    FOREIGN KEY (order_id) REFERENCES orders(order_id),\n    FOREIGN KEY (product_id) REFERENCES products(id)\n);\n```\n\n### Step 2: Display Products\nCreate a page to display available products.\n\n```php\n<?php\n// Connect to database\n$servername = \"localhost\";\n$username = \"username\";\n$password = \"password\";\n$dbname = \"myDB\";\n\n$conn = mysqli_connect($servername, $username, $password, $dbname);\nif (!$conn) {\n    die(\"Connection failed: \" . mysqli_connect_error());\n}\n\n// Fetch products from database\n$sql = \"SELECT * FROM products\";\n$result = mysqli_query($conn, $sql);\n\n?>\n\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Product List</title>\n    <!-- Include Bootstrap for styling -->\n    <link href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css\" rel=\"stylesheet\">\n</head>\n<body>\n    <div class=\"container mt-4\">\n        <?php\n        while ($row = mysqli_fetch_assoc($result)) {\n            echo \"\n                <div class='card mb-4' style='max-width: 500px;'>\n                    <img src='{$row['image']}' class='card-img-top' alt='$row[name]'>\n                    <div class='card-body'>\n                        <h5 class='card-title'>$row[name]</h5>\n                        <p class='card-text'><strong>Price:</strong> $row[price] $</p>\n                        <p class='card-text'>$row[description]</p>\n                        <form action='add_to_cart.php' method='post'>\n                            <input type='hidden' name='product_id' value='{$row['id']}'>\n                            <button type='submit' class='btn btn-primary'>Add to Cart</button>\n                        </form>\n                    </div>\n                </div>\n            \";\n        }\n        ?>\n    </div>\n\n    <!-- Include Bootstrap JS -->\n    <script src=\"https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js\"></script>\n</body>\n</html>\n\n<?php\n// Close database connection\nmysqli_close($conn);\n?>\n```\n\n### Step 3: Shopping Cart Functionality\nCreate a `cart.php` file to manage the shopping cart.\n\n```php\n<?php\nsession_start();\n?>\n\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Shopping Cart</title>\n    <link href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css\" rel=\"stylesheet\">\n</head>\n<body>\n    <div class=\"container mt-4\">\n        <?php\n        if (!empty($_SESSION['cart'])) {\n            $total = 0;\n            echo \"<table class='table table-striped'>\";\n            foreach ($_SESSION['cart'] as $product) {\n                echo \"\n                    <tr>\n                        <td>{$product['name']}</td>\n                        <td>Quantity: {$product['quantity']}</td>\n                        <td>Price: \\${$product['price']}</td>\n                        <td>Total: \\${$product['quantity'] * $product['price']}</td>\n                        <td><a href='remove_from_cart.php?id={$product['id']}' class='btn btn-danger'>Remove</a></td>\n                    </tr>\n                \";\n                $total += $product['quantity'] * $product['price'];\n            }\n            echo \"\n                <tr>\n                    <td colspan='4'><strong>Total:</strong> \\$$total</td>\n                    <td><a href='checkout.php' class='btn btn-success'>Checkout</a></td>\n                </tr>\n            \";\n            echo \"</table>\";\n        } else {\n            echo \"<p>Your cart is empty.</p>\";\n        }\n        ?>\n    </div>\n\n    <!-- Include Bootstrap JS -->\n    <script src=\"https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js\"></script>\n</body>\n</html>\n```\n\n### Step 4: Add to Cart\nCreate `add_to_cart.php`:\n\n```php\n<?php\nsession_start();\n\n// Get product details from database\n$conn = mysqli_connect(\"localhost\", \"username\", \"password\", \"myDB\");\nif (!$conn) {\n    die(\"Connection failed: \" . mysqli_connect_error());\n}\n\n$product_id = $_POST['product_id'];\n\n$sql = \"SELECT * FROM products WHERE id = $product_id\";\n$result = mysqli_query($conn, $sql);\n$product = mysqli_fetch_assoc($result);\n\nmysqli_close($conn);\n\n// Add to cart\nif (isset($_SESSION['cart'])) {\n    // Check if product already exists in cart\n    $found = false;\n    foreach ($_SESSION['cart'] as &$item) {\n        if ($item['id'] == $product_id) {\n            $item['quantity']++;\n            $found = true;\n            break;\n        }\n    }\n    if (!$found) {\n        $_SESSION['cart'][] = array(\n            'id' => $product['id'],\n            'name' => $product['name'],\n            'price' => $product['price'],\n            'quantity' => 1\n        );\n    }\n} else {\n    $_SESSION['cart'] = array();\n    $_SESSION['cart'][] = array(\n        'id' => $product['id'],\n        'name' => $product['name'],\n        'price' => $product['price'],\n        'quantity' => 1\n    );\n}\n\nheader(\"Location: cart.php\");\n?>\n```\n\n### Step 5: Remove from Cart\nCreate `remove_from_cart.php`:\n\n```php\n<?php\nsession_start();\n\n$product_id = $_GET['id'];\n\n// Loop through the session cart and remove the product with matching id\nforeach ($_SESSION['cart'] as $key => $product) {\n    if ($product['id'] == $product_id) {\n        unset($_SESSION['cart'][$key]);\n    }\n}\n\n$_SESSION['cart'] = array_values($_SESSION['cart']); // Re-index the array\n\nheader(\"Location: cart.php\");\n?>\n```\n\n### Step 6: Checkout Page\nCreate `checkout.php`:\n\n```php\n<?php\nsession_start();\n?>\n\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Checkout</title>\n    <link href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css\" rel=\"stylesheet\">\n</head>\n<body>\n    <div class=\"container mt-4\">\n        <?php if (!empty($_SESSION['cart'])): ?>\n            <h2>Enter your details to complete the purchase:</h2>\n            <form action=\"process_order.php\" method=\"post\">\n                <div class=\"mb-3\">\n                    <label for=\"name\">Name</label>\n                    <input type=\"text\" name=\"name\" id=\"name\" required class=\"form-control\">\n                </div>\n                <div class=\"mb-3\">\n                    <label for=\"email\">Email</label>\n                    <input type=\"email\" name=\"email\" id=\"email\" required class=\"form-control\">\n                </div>\n                <div class=\"mb-3\">\n                    <label for=\"address\">Address</label>\n                    <input type=\"text\" name=\"address\" id=\"address\" required class=\"form-control\">\n                </div>\n                <div class=\"mb-3\">\n                    <label for=\"phone\">Phone</label>\n                    <input type=\"tel\" name=\"phone\" id=\"phone\" required class=\"form-control\">\n                </div>\n                <div class=\"mb-3\">\n                    <label for=\"payment_method\">Payment Method</label>\n                    <select name=\"payment_method\" id=\"payment_method\" required class=\"form-control\">\n                        <option value=\"\">Select Payment Method</option>\n                        <option value=\"credit_card\">Credit Card</option>\n                        <option value=\"paypal\">PayPal</option>\n                        <option value=\"cash\">Cash on Delivery</option>\n                    </select>\n                </div>\n                <button type=\"submit\" class=\"btn btn-primary\">Place Order</button>\n            </form>\n        <?php else: ?>\n            <p>Your cart is empty. Please add products first.</p>\n        <?php endif; ?>\n    </div>\n\n    <!-- Include Bootstrap JS -->\n    <script src=\"https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js\"></script>\n</body>\n</html>\n```\n\n### Step 7: Process Order\nCreate `process_order.php`:\n\n```php\n<?php\nsession_start();\n\n// Check if cart is not empty and form data is submitted\nif (!empty($_SESSION['cart']) && !empty($_POST)) {\n    // Sanitize input\n    $name = htmlspecialchars(trim($_POST['name']));\n    $email = htmlspecialchars(trim($_POST['email']));\n    $address = htmlspecialchars(trim($_POST['address']));\n    $phone = htmlspecialchars(trim($_POST['phone']));\n    $payment_method = htmlspecialchars(trim($_POST['payment_method']));\n\n    // Calculate total amount\n    $total = 0;\n    foreach ($_SESSION['cart'] as $product) {\n        $total += $product['quantity'] * $product['price'];\n    }\n\n    // Connect to database\n    $conn = mysqli_connect(\"localhost\", \"username\", \"password\", \"myDB\");\n    if (!$conn) {\n        die(\"Connection failed: \" . mysqli_connect_error());\n    }\n\n    // Start transaction\n    mysqli_autocommit($conn, FALSE);\n\n    try {\n        // Insert order into orders table\n        $order_sql = \"\n            INSERT INTO orders (user_name, email, address, phone, total, payment_method)\n            VALUES ('$name', '$email', '$address', '$phone', '$total', '$payment_method')\n        \";\n        if (!mysqli_query($conn, $order_sql)) {\n            throw new Exception(\"Error inserting order\");\n        }\n\n        // Get last inserted order id\n        $order_id = mysqli_insert_id($conn);\n\n        // Insert order details into order_details table\n        foreach ($_SESSION['cart'] as $product) {\n            $detail_sql = \"\n                INSERT INTO order_details (order_id, product_id, quantity, price)\n                VALUES ('$order_id', '{$product['id']}', '{$product['quantity']}', '{$product['price']}')\n            \";\n            if (!mysqli_query($conn, $detail_sql)) {\n                throw new Exception(\"Error inserting order details\");\n            }\n        }\n\n        // Commit transaction\n        mysqli_commit($conn);\n\n        // Clear cart\n        unset($_SESSION['cart']);\n\n        // Redirect to confirmation page\n        header(\"Location: confirmation.php?order_id=$order_id\");\n\n    } catch (Exception $e) {\n        // Rollback transaction on error\n        mysqli_rollback($conn);\n        echo \"Error: \" . $e->getMessage();\n    }\n\n    // Close connection\n    mysqli_close($conn);\n\n} else {\n    header(\"Location: cart.php\");\n}\n?>\n```\n\n### Step 8: Order Confirmation\nCreate `confirmation.php`:\n\n```php\n<?php\nsession_start();\n\n// Get order details from session or database\nif (isset($_GET['order_id'])) {\n    $order_id = $_GET['order_id'];\n    // Here you can fetch order details from the database if needed\n}\n\n?>\n\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Order Confirmation</title>\n    <link href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css\" rel=\"stylesheet\">\n</head>\n<body>\n    <div class=\"container mt-4\">\n        <?php if (isset($_GET['order_id'])): ?>\n            <h2>Thank you for your order!</h2>\n            <p>Your order ID is: #<?php echo $order_id; ?></p>\n            <p>We will contact you soon to confirm your payment.</p>\n            <a href=\"index.php\" class=\"btn btn-primary\">Continue Shopping</a>\n        <?php else: ?>\n            <p>Something went wrong. Please try again.</p>\n        <?php endif; ?>\n    </div>\n\n    <!-- Include Bootstrap JS -->\n    <script src=\"https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js\"></script>\n</body>\n</html>\n```\n\n### Step 9: Admin Order Management\nCreate an `admin.php` to view orders:\n\n```php\n<?php\n// Connect to database\n$servername = \"localhost\";\n$username = \"username\";\n$password = \"password\";\n$dbname = \"myDB\";\n\n$conn = mysqli_connect($servername, $username, $password, $dbname);\nif (!$conn) {\n    die(\"Connection failed: \" . mysqli_connect_error());\n}\n\n$sql = \"SELECT * FROM orders\";\n$result = mysqli_query($conn, $sql);\n\n?>\n\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Order Management</title>\n    <link href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css\" rel=\"stylesheet\">\n</head>\n<body>\n    <div class=\"container mt-4\">\n        <?php\n        if (mysqli_num_rows($result) > 0) {\n            echo \"<table class='table table-striped'>\";\n            while ($row = mysqli_fetch_assoc($result)) {\n                $order_id = $row['order_id'];\n                $user_name = $row['user_name'];\n                $total = $row['total'];\n                $status = $row['status'];\n\n                // Get order details\n                $details_sql = \"SELECT * FROM order_details WHERE order_id = $order_id\";\n                $details_result = mysqli_query($conn, $details_sql);\n                $details_count = mysqli_num_rows($details_result);\n\n                echo \"\n                    <tr>\n                        <td><strong>Order ID:</strong> $order_id</td>\n                        <td><strong>Name:</strong> $user_name</td>\n                        <td><strong>Total:</strong> \\${$total}</td>\n                        <td><a href='view_order.php?id=$order_id' class='btn btn-info'>View Details ($details_count items)</a></td>\n                    </tr>\n                \";\n            }\n            echo \"</table>\";\n        } else {\n            echo \"<p>No orders found.</p>\";\n        }\n        ?>\n    </div>\n\n    <!-- Include Bootstrap JS -->\n    <script src=\"https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js\"></script>\n</body>\n</html>\n\n<?php\n// Close database connection\nmysqli_close($conn);\n?>\n```\n\n### Important Notes:\n1. **Security**: This is a basic implementation and does not include advanced security measures like CSRF protection, input validation, or secure payment processing.\n2. **Payment Gateway Integration**: For real-world applications, you should integrate a secure payment gateway (e.g., PayPal, Stripe).\n3. **User Authentication**: Consider adding user authentication to allow customers to log in and view their orders.\n4. **Error Handling**: Add proper error handling and logging for better debugging and security.\n5. **Transactions**: The code uses transactions but make sure your database is set up to support them (InnoDB engine).\n\nThis implementation provides a basic framework for an online purchase system. You can extend it by adding more features like user authentication, payment gateways, order tracking, and more.", "code_blocks": [null, "```php\n<?php\n// Connect to database\n$servername = \"localhost\";\n$username = \"username\";\n$password = \"password\";\n$dbname = \"myDB\";\n\n$conn = mysqli_connect($servername, $username, $password, $dbname);\nif (!$conn) {\n    die(\"Connection failed: \" . mysqli_connect_error());\n}\n\n// Fetch products from database\n$sql = \"SELECT * FROM products\";\n$result = mysqli_query($conn, $sql);\n\n?>\n\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Product List</title>\n    <!-- Include Bootstrap for styling -->\n    <link href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css\" rel=\"stylesheet\">\n</head>\n<body>\n    <div class=\"container mt-4\">\n        <?php\n        while ($row = mysqli_fetch_assoc($result)) {\n            echo \"\n                <div class='card mb-4' style='max-width: 500px;'>\n                    <img src='{$row['image']}' class='card-img-top' alt='$row[name]'>\n                    <div class='card-body'>\n                        <h5 class='card-title'>$row[name]</h5>\n                        <p class='card-text'><strong>Price:</strong> $row[price] $</p>\n                        <p class='card-text'>$row[description]</p>\n                        <form action='add_to_cart.php' method='post'>\n                            <input type='hidden' name='product_id' value='{$row['id']}'>\n                            <button type='submit' class='btn btn-primary'>Add to Cart</button>\n                        </form>\n                    </div>\n                </div>\n            \";\n        }\n        ?>\n    </div>\n\n    <!-- Include Bootstrap JS -->\n    <script src=\"https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js\"></script>\n</body>\n</html>\n\n<?php\n// Close database connection\nmysqli_close($conn);\n?>\n```", "```php\n<?php\nsession_start();\n?>\n\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Shopping Cart</title>\n    <link href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css\" rel=\"stylesheet\">\n</head>\n<body>\n    <div class=\"container mt-4\">\n        <?php\n        if (!empty($_SESSION['cart'])) {\n            $total = 0;\n            echo \"<table class='table table-striped'>\";\n            foreach ($_SESSION['cart'] as $product) {\n                echo \"\n                    <tr>\n                        <td>{$product['name']}</td>\n                        <td>Quantity: {$product['quantity']}</td>\n                        <td>Price: \\${$product['price']}</td>\n                        <td>Total: \\${$product['quantity'] * $product['price']}</td>\n                        <td><a href='remove_from_cart.php?id={$product['id']}' class='btn btn-danger'>Remove</a></td>\n                    </tr>\n                \";\n                $total += $product['quantity'] * $product['price'];\n            }\n            echo \"\n                <tr>\n                    <td colspan='4'><strong>Total:</strong> \\$$total</td>\n                    <td><a href='checkout.php' class='btn btn-success'>Checkout</a></td>\n                </tr>\n            \";\n            echo \"</table>\";\n        } else {\n            echo \"<p>Your cart is empty.</p>\";\n        }\n        ?>\n    </div>\n\n    <!-- Include Bootstrap JS -->\n    <script src=\"https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js\"></script>\n</body>\n</html>\n```", "```php\n<?php\nsession_start();\n\n// Get product details from database\n$conn = mysqli_connect(\"localhost\", \"username\", \"password\", \"myDB\");\nif (!$conn) {\n    die(\"Connection failed: \" . mysqli_connect_error());\n}\n\n$product_id = $_POST['product_id'];\n\n$sql = \"SELECT * FROM products WHERE id = $product_id\";\n$result = mysqli_query($conn, $sql);\n$product = mysqli_fetch_assoc($result);\n\nmysqli_close($conn);\n\n// Add to cart\nif (isset($_SESSION['cart'])) {\n    // Check if product already exists in cart\n    $found = false;\n    foreach ($_SESSION['cart'] as &$item) {\n        if ($item['id'] == $product_id) {\n            $item['quantity']++;\n            $found = true;\n            break;\n        }\n    }\n    if (!$found) {\n        $_SESSION['cart'][] = array(\n            'id' => $product['id'],\n            'name' => $product['name'],\n            'price' => $product['price'],\n            'quantity' => 1\n        );\n    }\n} else {\n    $_SESSION['cart'] = array();\n    $_SESSION['cart'][] = array(\n        'id' => $product['id'],\n        'name' => $product['name'],\n        'price' => $product['price'],\n        'quantity' => 1\n    );\n}\n\nheader(\"Location: cart.php\");\n?>\n```", "```php\n<?php\nsession_start();\n\n$product_id = $_GET['id'];\n\n// Loop through the session cart and remove the product with matching id\nforeach ($_SESSION['cart'] as $key => $product) {\n    if ($product['id'] == $product_id) {\n        unset($_SESSION['cart'][$key]);\n    }\n}\n\n$_SESSION['cart'] = array_values($_SESSION['cart']); // Re-index the array\n\nheader(\"Location: cart.php\");\n?>\n```", "```php\n<?php\nsession_start();\n?>\n\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Checkout</title>\n    <link href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css\" rel=\"stylesheet\">\n</head>\n<body>\n    <div class=\"container mt-4\">\n        <?php if (!empty($_SESSION['cart'])): ?>\n            <h2>Enter your details to complete the purchase:</h2>\n            <form action=\"process_order.php\" method=\"post\">\n                <div class=\"mb-3\">\n                    <label for=\"name\">Name</label>\n                    <input type=\"text\" name=\"name\" id=\"name\" required class=\"form-control\">\n                </div>\n                <div class=\"mb-3\">\n                    <label for=\"email\">Email</label>\n                    <input type=\"email\" name=\"email\" id=\"email\" required class=\"form-control\">\n                </div>\n                <div class=\"mb-3\">\n                    <label for=\"address\">Address</label>\n                    <input type=\"text\" name=\"address\" id=\"address\" required class=\"form-control\">\n                </div>\n                <div class=\"mb-3\">\n                    <label for=\"phone\">Phone</label>\n                    <input type=\"tel\" name=\"phone\" id=\"phone\" required class=\"form-control\">\n                </div>\n                <div class=\"mb-3\">\n                    <label for=\"payment_method\">Payment Method</label>\n                    <select name=\"payment_method\" id=\"payment_method\" required class=\"form-control\">\n                        <option value=\"\">Select Payment Method</option>\n                        <option value=\"credit_card\">Credit Card</option>\n                        <option value=\"paypal\">PayPal</option>\n                        <option value=\"cash\">Cash on Delivery</option>\n                    </select>\n                </div>\n                <button type=\"submit\" class=\"btn btn-primary\">Place Order</button>\n            </form>\n        <?php else: ?>\n            <p>Your cart is empty. Please add products first.</p>\n        <?php endif; ?>\n    </div>\n\n    <!-- Include Bootstrap JS -->\n    <script src=\"https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js\"></script>\n</body>\n</html>\n```", "```php\n<?php\nsession_start();\n\n// Check if cart is not empty and form data is submitted\nif (!empty($_SESSION['cart']) && !empty($_POST)) {\n    // Sanitize input\n    $name = htmlspecialchars(trim($_POST['name']));\n    $email = htmlspecialchars(trim($_POST['email']));\n    $address = htmlspecialchars(trim($_POST['address']));\n    $phone = htmlspecialchars(trim($_POST['phone']));\n    $payment_method = htmlspecialchars(trim($_POST['payment_method']));\n\n    // Calculate total amount\n    $total = 0;\n    foreach ($_SESSION['cart'] as $product) {\n        $total += $product['quantity'] * $product['price'];\n    }\n\n    // Connect to database\n    $conn = mysqli_connect(\"localhost\", \"username\", \"password\", \"myDB\");\n    if (!$conn) {\n        die(\"Connection failed: \" . mysqli_connect_error());\n    }\n\n    // Start transaction\n    mysqli_autocommit($conn, FALSE);\n\n    try {\n        // Insert order into orders table\n        $order_sql = \"\n            INSERT INTO orders (user_name, email, address, phone, total, payment_method)\n            VALUES ('$name', '$email', '$address', '$phone', '$total', '$payment_method')\n        \";\n        if (!mysqli_query($conn, $order_sql)) {\n            throw new Exception(\"Error inserting order\");\n        }\n\n        // Get last inserted order id\n        $order_id = mysqli_insert_id($conn);\n\n        // Insert order details into order_details table\n        foreach ($_SESSION['cart'] as $product) {\n            $detail_sql = \"\n                INSERT INTO order_details (order_id, product_id, quantity, price)\n                VALUES ('$order_id', '{$product['id']}', '{$product['quantity']}', '{$product['price']}')\n            \";\n            if (!mysqli_query($conn, $detail_sql)) {\n                throw new Exception(\"Error inserting order details\");\n            }\n        }\n\n        // Commit transaction\n        mysqli_commit($conn);\n\n        // Clear cart\n        unset($_SESSION['cart']);\n\n        // Redirect to confirmation page\n        header(\"Location: confirmation.php?order_id=$order_id\");\n\n    } catch (Exception $e) {\n        // Rollback transaction on error\n        mysqli_rollback($conn);\n        echo \"Error: \" . $e->getMessage();\n    }\n\n    // Close connection\n    mysqli_close($conn);\n\n} else {\n    header(\"Location: cart.php\");\n}\n?>\n```", "```php\n<?php\nsession_start();\n\n// Get order details from session or database\nif (isset($_GET['order_id'])) {\n    $order_id = $_GET['order_id'];\n    // Here you can fetch order details from the database if needed\n}\n\n?>\n\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Order Confirmation</title>\n    <link href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css\" rel=\"stylesheet\">\n</head>\n<body>\n    <div class=\"container mt-4\">\n        <?php if (isset($_GET['order_id'])): ?>\n            <h2>Thank you for your order!</h2>\n            <p>Your order ID is: #<?php echo $order_id; ?></p>\n            <p>We will contact you soon to confirm your payment.</p>\n            <a href=\"index.php\" class=\"btn btn-primary\">Continue Shopping</a>\n        <?php else: ?>\n            <p>Something went wrong. Please try again.</p>\n        <?php endif; ?>\n    </div>\n\n    <!-- Include Bootstrap JS -->\n    <script src=\"https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js\"></script>\n</body>\n</html>\n```", "```php\n<?php\n// Connect to database\n$servername = \"localhost\";\n$username = \"username\";\n$password = \"password\";\n$dbname = \"myDB\";\n\n$conn = mysqli_connect($servername, $username, $password, $dbname);\nif (!$conn) {\n    die(\"Connection failed: \" . mysqli_connect_error());\n}\n\n$sql = \"SELECT * FROM orders\";\n$result = mysqli_query($conn, $sql);\n\n?>\n\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Order Management</title>\n    <link href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css\" rel=\"stylesheet\">\n</head>\n<body>\n    <div class=\"container mt-4\">\n        <?php\n        if (mysqli_num_rows($result) > 0) {\n            echo \"<table class='table table-striped'>\";\n            while ($row = mysqli_fetch_assoc($result)) {\n                $order_id = $row['order_id'];\n                $user_name = $row['user_name'];\n                $total = $row['total'];\n                $status = $row['status'];\n\n                // Get order details\n                $details_sql = \"SELECT * FROM order_details WHERE order_id = $order_id\";\n                $details_result = mysqli_query($conn, $details_sql);\n                $details_count = mysqli_num_rows($details_result);\n\n                echo \"\n                    <tr>\n                        <td><strong>Order ID:</strong> $order_id</td>\n                        <td><strong>Name:</strong> $user_name</td>\n                        <td><strong>Total:</strong> \\${$total}</td>\n                        <td><a href='view_order.php?id=$order_id' class='btn btn-info'>View Details ($details_count items)</a></td>\n                    </tr>\n                \";\n            }\n            echo \"</table>\";\n        } else {\n            echo \"<p>No orders found.</p>\";\n        }\n        ?>\n    </div>\n\n    <!-- Include Bootstrap JS -->\n    <script src=\"https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js\"></script>\n</body>\n</html>\n\n<?php\n// Close database connection\nmysqli_close($conn);\n?>\n```"]}
