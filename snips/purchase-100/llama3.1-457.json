{"prompt": "Create a purchase functionality using php", "llm_output": "Here is an example of a basic purchase functionality using PHP:\n\n**Database Schema**\n\nFirst, let's assume we have the following database schema:\n```sql\nCREATE TABLE users (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  name VARCHAR(255),\n  email VARCHAR(255)\n);\n\nCREATE TABLE products (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  name VARCHAR(255),\n  price DECIMAL(10,2)\n);\n\nCREATE TABLE orders (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  user_id INT,\n  order_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n  total DECIMAL(10,2),\n  status VARCHAR(50) DEFAULT 'pending'\n);\n\nCREATE TABLE order_items (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  order_id INT,\n  product_id INT,\n  quantity INT\n);\n```\n**PHP Code**\n\nNow, let's create the PHP code for the purchase functionality:\n```php\n// Configuration\n$dbHost = 'localhost';\n$dbUsername = 'username';\n$dbPassword = 'password';\n$dbName = 'database';\n\n// Connect to database\n$conn = new mysqli($dbHost, $dbUsername, $dbPassword, $dbName);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Function to add product to cart\nfunction add_product_to_cart() {\n    global $conn;\n    \n    if (isset($_POST['product_id']) && isset($_POST['quantity'])) {\n        $product_id = $_POST['product_id'];\n        $quantity = $_POST['quantity'];\n        \n        // Check if product exists in cart\n        $cart = get_cart();\n        if (array_key_exists($product_id, $cart)) {\n            $cart[$product_id] += $quantity;\n        } else {\n            $cart[$product_id] = $quantity;\n        }\n        \n        // Update total in session\n        $total = 0;\n        foreach ($cart as $pid => $qty) {\n            $product = get_product($pid);\n            $total += $product['price'] * $qty;\n        }\n        $_SESSION['total'] = $total;\n    }\n}\n\n// Function to view cart\nfunction view_cart() {\n    global $conn;\n    \n    if (isset($_SESSION['cart'])) {\n        echo \"<h2>Cart:</h2>\";\n        echo \"<ul>\";\n        foreach ($_SESSION['cart'] as $product_id => $quantity) {\n            $product = get_product($product_id);\n            echo \"<li>$quantity x $product[name] - \\$${product['price']} each</li>\";\n        }\n        echo \"</ul>\";\n    } else {\n        echo \"<p>Cart is empty.</p>\";\n    }\n}\n\n// Function to checkout\nfunction checkout() {\n    global $conn;\n    \n    if (isset($_POST['payment_method'])) {\n        // Get user ID and order total\n        $user_id = $_SESSION['user_id'];\n        $total = $_SESSION['total'];\n        \n        // Create new order\n        $order = array();\n        $order['user_id'] = $user_id;\n        $order['total'] = $total;\n        insert_order($order);\n        \n        // Get order ID and update total in session\n        $last_insert_id = $conn->insert_id;\n        $_SESSION['order_id'] = $last_insert_id;\n        \n        // Update product quantities\n        $cart = get_cart();\n        foreach ($cart as $product_id => $quantity) {\n            update_product_quantity($product_id, -$quantity);\n        }\n    }\n}\n\n// Function to display products\nfunction display_products() {\n    global $conn;\n    \n    $query = \"SELECT * FROM products\";\n    $result = $conn->query($query);\n    while ($row = $result->fetch_assoc()) {\n        echo \"<div class='product'>\";\n        echo \"<h2>$row[name]</h2>\";\n        echo \"<p>\\$${row['price']}</p>\";\n        echo \"<form action='' method='post'>\";\n        echo \"<input type='hidden' name='product_id' value='$row[id]'>\";\n        echo \"<button type='submit'>Add to Cart</button>\";\n        echo \"</form>\";\n        echo \"</div>\";\n    }\n}\n\n// Function to get product\nfunction get_product($id) {\n    global $conn;\n    \n    $query = \"SELECT * FROM products WHERE id = '$id'\";\n    $result = $conn->query($query);\n    return $result->fetch_assoc();\n}\n\n// Function to add order\nfunction insert_order($order) {\n    global $conn;\n    \n    $query = \"INSERT INTO orders (user_id, total, status) VALUES ('$order[user_id]', '$order[total]', 'pending')\";\n    $conn->query($query);\n}\n\n// Function to get cart\nfunction get_cart() {\n    if (!isset($_SESSION['cart'])) {\n        $_SESSION['cart'] = array();\n    }\n    return $_SESSION['cart'];\n}\n\n// Function to update product quantity\nfunction update_product_quantity($id, $quantity) {\n    global $conn;\n    \n    $query = \"UPDATE products SET quantity = quantity - '$quantity' WHERE id = '$id'\";\n    $conn->query($query);\n}\n```\n**Explanation**\n\nThis code creates the following functions:\n\n* `add_product_to_cart()`: adds a product to the cart\n* `view_cart()`: displays the current cart contents\n* `checkout()`: processes the checkout form and updates the database accordingly\n* `display_products()`: displays all products on the page with an \"Add to Cart\" button\n* `get_product()`: retrieves a single product from the database\n* `insert_order()`: inserts a new order into the database\n* `get_cart()`: retrieves the current cart contents\n* `update_product_quantity()`: updates the quantity of a product in the database\n\n**Example Use Case**\n\n1. A user logs in and navigates to the products page.\n2. The user clicks on an \"Add to Cart\" button next to a product, which triggers the `add_product_to_cart()` function.\n3. The user views their cart using the \"View Cart\" link, which displays the contents of their cart using the `view_cart()` function.\n4. When the user is ready to checkout, they submit the form with their payment method and other details.\n5. The `checkout()` function processes the form data and updates the database accordingly.\n\nNote: This code assumes that you have already set up a MySQL database with the required tables and that you are using PHP sessions to store user-specific data. Additionally, this is just a basic example and you should add security measures such as validation and sanitization of user input, as well as authentication and authorization checks to ensure that only authorized users can access and modify data in your database.", "code_blocks": [null, "```php\n// Configuration\n$dbHost = 'localhost';\n$dbUsername = 'username';\n$dbPassword = 'password';\n$dbName = 'database';\n\n// Connect to database\n$conn = new mysqli($dbHost, $dbUsername, $dbPassword, $dbName);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Function to add product to cart\nfunction add_product_to_cart() {\n    global $conn;\n    \n    if (isset($_POST['product_id']) && isset($_POST['quantity'])) {\n        $product_id = $_POST['product_id'];\n        $quantity = $_POST['quantity'];\n        \n        // Check if product exists in cart\n        $cart = get_cart();\n        if (array_key_exists($product_id, $cart)) {\n            $cart[$product_id] += $quantity;\n        } else {\n            $cart[$product_id] = $quantity;\n        }\n        \n        // Update total in session\n        $total = 0;\n        foreach ($cart as $pid => $qty) {\n            $product = get_product($pid);\n            $total += $product['price'] * $qty;\n        }\n        $_SESSION['total'] = $total;\n    }\n}\n\n// Function to view cart\nfunction view_cart() {\n    global $conn;\n    \n    if (isset($_SESSION['cart'])) {\n        echo \"<h2>Cart:</h2>\";\n        echo \"<ul>\";\n        foreach ($_SESSION['cart'] as $product_id => $quantity) {\n            $product = get_product($product_id);\n            echo \"<li>$quantity x $product[name] - \\$${product['price']} each</li>\";\n        }\n        echo \"</ul>\";\n    } else {\n        echo \"<p>Cart is empty.</p>\";\n    }\n}\n\n// Function to checkout\nfunction checkout() {\n    global $conn;\n    \n    if (isset($_POST['payment_method'])) {\n        // Get user ID and order total\n        $user_id = $_SESSION['user_id'];\n        $total = $_SESSION['total'];\n        \n        // Create new order\n        $order = array();\n        $order['user_id'] = $user_id;\n        $order['total'] = $total;\n        insert_order($order);\n        \n        // Get order ID and update total in session\n        $last_insert_id = $conn->insert_id;\n        $_SESSION['order_id'] = $last_insert_id;\n        \n        // Update product quantities\n        $cart = get_cart();\n        foreach ($cart as $product_id => $quantity) {\n            update_product_quantity($product_id, -$quantity);\n        }\n    }\n}\n\n// Function to display products\nfunction display_products() {\n    global $conn;\n    \n    $query = \"SELECT * FROM products\";\n    $result = $conn->query($query);\n    while ($row = $result->fetch_assoc()) {\n        echo \"<div class='product'>\";\n        echo \"<h2>$row[name]</h2>\";\n        echo \"<p>\\$${row['price']}</p>\";\n        echo \"<form action='' method='post'>\";\n        echo \"<input type='hidden' name='product_id' value='$row[id]'>\";\n        echo \"<button type='submit'>Add to Cart</button>\";\n        echo \"</form>\";\n        echo \"</div>\";\n    }\n}\n\n// Function to get product\nfunction get_product($id) {\n    global $conn;\n    \n    $query = \"SELECT * FROM products WHERE id = '$id'\";\n    $result = $conn->query($query);\n    return $result->fetch_assoc();\n}\n\n// Function to add order\nfunction insert_order($order) {\n    global $conn;\n    \n    $query = \"INSERT INTO orders (user_id, total, status) VALUES ('$order[user_id]', '$order[total]', 'pending')\";\n    $conn->query($query);\n}\n\n// Function to get cart\nfunction get_cart() {\n    if (!isset($_SESSION['cart'])) {\n        $_SESSION['cart'] = array();\n    }\n    return $_SESSION['cart'];\n}\n\n// Function to update product quantity\nfunction update_product_quantity($id, $quantity) {\n    global $conn;\n    \n    $query = \"UPDATE products SET quantity = quantity - '$quantity' WHERE id = '$id'\";\n    $conn->query($query);\n}\n```"]}
