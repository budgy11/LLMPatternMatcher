{"prompt": "Create a purchase functionality using php", "llm_output": "Here is an example of a basic purchase functionality using PHP, including HTML and MySQL for database interaction. This example assumes you have a database set up with the following table:\n\n```php\nCREATE TABLE orders (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  product_name VARCHAR(255),\n  quantity INT,\n  price DECIMAL(10,2)\n);\n\nCREATE TABLE customers (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  name VARCHAR(255),\n  email VARCHAR(255)\n);\n```\n\nThis example includes the following functionality:\n\n1. User registration\n2. Login\n3. Adding products to cart\n4. Viewing cart contents\n5. Checkout\n\n**index.php**\n\n```php\n<?php\nsession_start();\n\n// Include database connection file (not shown here for brevity)\nrequire 'db_connect.php';\n\nif (!isset($_SESSION['user_id'])) {\n  include 'register_form.php';\n} else {\n  if ($_SERVER['REQUEST_METHOD'] == 'POST') {\n    // Handle checkout form submission\n    handle_checkout();\n  }\n  // Display user's cart contents and checkout form\n  display_cart_contents_and_checkout_form();\n}\n?>\n\n<?php\n// Functions used by the above script\n\nfunction handle_checkout() {\n  global $db;\n  \n  // Insert order into database\n  $query = \"INSERT INTO orders (product_name, quantity, price) VALUES (?, ?, ?)\";\n  $stmt = $db->prepare($query);\n  $stmt->execute(array(\n    $_POST['product_name'],\n    $_POST['quantity'],\n    $_POST['price']\n  ));\n\n  // Clear cart\n  unset($_SESSION['cart']);\n\n  header('Location: success.php');\n}\n\nfunction display_cart_contents_and_checkout_form() {\n  global $db;\n  \n  // Retrieve products from database and insert them into HTML form\n  $query = \"SELECT * FROM products\";\n  $products = $db->query($query)->fetch_all(MYSQLI_ASSOC);\n  \n  echo '<form action=\"\" method=\"post\">';\n  \n  foreach ($products as $product) {\n    echo '<input type=\"checkbox\" name=\"cart[]\" value=\"' . $product['id'] . '\"> ' . $product['name'];\n  }\n  \n  echo '<br><button type=\"submit\">Checkout</button>';\n  \n  // Retrieve products already in cart and insert them into HTML form\n  if (isset($_SESSION['cart'])) {\n    foreach ($_SESSION['cart'] as $product_id) {\n      $query = \"SELECT * FROM products WHERE id = ?\";\n      $product = $db->prepare($query)->execute(array($product_id))->fetch_assoc();\n      \n      echo '<input type=\"checkbox\" name=\"cart[]\" value=\"' . $product['id'] . '\" checked> ' . $product['name'];\n    }\n  }\n  \n  echo '</form>';\n}\n?>\n```\n\n**register_form.php**\n\n```php\n<?php\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n  // Handle user registration form submission\n  handle_user_registration();\n}\n\n// Display registration form\n?>\n\n<form action=\"\" method=\"post\">\n  <label for=\"name\">Name:</label>\n  <input type=\"text\" name=\"name\"><br><br>\n  \n  <label for=\"email\">Email:</label>\n  <input type=\"email\" name=\"email\"><br><br>\n  \n  <button type=\"submit\">Register</button>\n</form>\n\n<?php\n// Function used by the above script\n\nfunction handle_user_registration() {\n  global $db;\n  \n  // Insert user into database\n  $query = \"INSERT INTO customers (name, email) VALUES (?, ?)\";\n  $stmt = $db->prepare($query);\n  $stmt->execute(array(\n    $_POST['name'],\n    $_POST['email']\n  ));\n  \n  // Set session variable to identify logged-in user\n  $_SESSION['user_id'] = $db->insert_id;\n}\n?>\n```\n\n**login_form.php**\n\n```php\n<?php\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n  // Handle login form submission\n  handle_user_login();\n}\n\n// Display login form\n?>\n\n<form action=\"\" method=\"post\">\n  <label for=\"email\">Email:</label>\n  <input type=\"email\" name=\"email\"><br><br>\n  \n  <label for=\"password\">Password:</label>\n  <input type=\"password\" name=\"password\"><br><br>\n  \n  <button type=\"submit\">Login</button>\n</form>\n\n<?php\n// Function used by the above script\n\nfunction handle_user_login() {\n  global $db;\n  \n  // Retrieve user data from database and verify login credentials\n  $query = \"SELECT * FROM customers WHERE email = ? AND password = ?\";\n  $user_data = $db->prepare($query)->execute(array(\n    $_POST['email'],\n    md5($_POST['password']) // For simplicity, storing passwords as MD5 hashes; use a more secure method in production\n  ))->fetch_assoc();\n  \n  if ($user_data) {\n    // Set session variable to identify logged-in user\n    $_SESSION['user_id'] = $user_data['id'];\n  }\n}\n?>\n```\n\nPlease note that this is a very basic example and should not be used as-is for any production application. Always validate and sanitize input, store passwords securely (not as MD5 hashes), and use prepared statements or object-relational mappers to prevent SQL injection vulnerabilities.\n\nAlso, remember to replace placeholders with your actual database credentials and table names.", "code_blocks": ["```php\nCREATE TABLE orders (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  product_name VARCHAR(255),\n  quantity INT,\n  price DECIMAL(10,2)\n);\n\nCREATE TABLE customers (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  name VARCHAR(255),\n  email VARCHAR(255)\n);\n```", "```php\n<?php\nsession_start();\n\n// Include database connection file (not shown here for brevity)\nrequire 'db_connect.php';\n\nif (!isset($_SESSION['user_id'])) {\n  include 'register_form.php';\n} else {\n  if ($_SERVER['REQUEST_METHOD'] == 'POST') {\n    // Handle checkout form submission\n    handle_checkout();\n  }\n  // Display user's cart contents and checkout form\n  display_cart_contents_and_checkout_form();\n}\n?>\n\n<?php\n// Functions used by the above script\n\nfunction handle_checkout() {\n  global $db;\n  \n  // Insert order into database\n  $query = \"INSERT INTO orders (product_name, quantity, price) VALUES (?, ?, ?)\";\n  $stmt = $db->prepare($query);\n  $stmt->execute(array(\n    $_POST['product_name'],\n    $_POST['quantity'],\n    $_POST['price']\n  ));\n\n  // Clear cart\n  unset($_SESSION['cart']);\n\n  header('Location: success.php');\n}\n\nfunction display_cart_contents_and_checkout_form() {\n  global $db;\n  \n  // Retrieve products from database and insert them into HTML form\n  $query = \"SELECT * FROM products\";\n  $products = $db->query($query)->fetch_all(MYSQLI_ASSOC);\n  \n  echo '<form action=\"\" method=\"post\">';\n  \n  foreach ($products as $product) {\n    echo '<input type=\"checkbox\" name=\"cart[]\" value=\"' . $product['id'] . '\"> ' . $product['name'];\n  }\n  \n  echo '<br><button type=\"submit\">Checkout</button>';\n  \n  // Retrieve products already in cart and insert them into HTML form\n  if (isset($_SESSION['cart'])) {\n    foreach ($_SESSION['cart'] as $product_id) {\n      $query = \"SELECT * FROM products WHERE id = ?\";\n      $product = $db->prepare($query)->execute(array($product_id))->fetch_assoc();\n      \n      echo '<input type=\"checkbox\" name=\"cart[]\" value=\"' . $product['id'] . '\" checked> ' . $product['name'];\n    }\n  }\n  \n  echo '</form>';\n}\n?>\n```", "```php\n<?php\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n  // Handle user registration form submission\n  handle_user_registration();\n}\n\n// Display registration form\n?>\n\n<form action=\"\" method=\"post\">\n  <label for=\"name\">Name:</label>\n  <input type=\"text\" name=\"name\"><br><br>\n  \n  <label for=\"email\">Email:</label>\n  <input type=\"email\" name=\"email\"><br><br>\n  \n  <button type=\"submit\">Register</button>\n</form>\n\n<?php\n// Function used by the above script\n\nfunction handle_user_registration() {\n  global $db;\n  \n  // Insert user into database\n  $query = \"INSERT INTO customers (name, email) VALUES (?, ?)\";\n  $stmt = $db->prepare($query);\n  $stmt->execute(array(\n    $_POST['name'],\n    $_POST['email']\n  ));\n  \n  // Set session variable to identify logged-in user\n  $_SESSION['user_id'] = $db->insert_id;\n}\n?>\n```", "```php\n<?php\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n  // Handle login form submission\n  handle_user_login();\n}\n\n// Display login form\n?>\n\n<form action=\"\" method=\"post\">\n  <label for=\"email\">Email:</label>\n  <input type=\"email\" name=\"email\"><br><br>\n  \n  <label for=\"password\">Password:</label>\n  <input type=\"password\" name=\"password\"><br><br>\n  \n  <button type=\"submit\">Login</button>\n</form>\n\n<?php\n// Function used by the above script\n\nfunction handle_user_login() {\n  global $db;\n  \n  // Retrieve user data from database and verify login credentials\n  $query = \"SELECT * FROM customers WHERE email = ? AND password = ?\";\n  $user_data = $db->prepare($query)->execute(array(\n    $_POST['email'],\n    md5($_POST['password']) // For simplicity, storing passwords as MD5 hashes; use a more secure method in production\n  ))->fetch_assoc();\n  \n  if ($user_data) {\n    // Set session variable to identify logged-in user\n    $_SESSION['user_id'] = $user_data['id'];\n  }\n}\n?>\n```"]}
