{"prompt": "Create a purchase functionality using php", "llm_output": "<think>\nOkay, I need to help the user create a purchase functionality using PHP. Let me think about what that entails.\n\nFirst, I should consider the main components involved in a purchase process. There's the product catalog, shopping cart, checkout page, order processing, and confirmation. Each of these steps requires different PHP scripts.\n\nI'll start by outlining each part. For the product catalog, I need to display products from a database. So, I'll create a connection to MySQL using mysqli_connect. Then, fetch the products with SELECT * FROM products. Display them in a table with details and an \"Add to Cart\" button that links to addtocart.php with the product ID.\n\nNext, the shopping cart functionality. When a user clicks \"Add to Cart,\" they should see the items they're purchasing. I'll use sessions to store the cart data because sessions are temporary and tied to the user's session. So, in addtocart.php, I'll check if the product is already in the cart; if so, increment quantity, else add it. Then redirect back to the catalog.\n\nThe cart page will display all items in the session. It should show product name, price, quantity, and total for each item. Also, provide links to update quantity or remove items. This requires looping through $_SESSION['cart'] and fetching product details from the database again.\n\nFor updating quantities, I'll need an updatecart.php script. It will handle POST data, adjust the quantity in the session, and redirect back to cart.php.\n\nThe checkout page needs a form for user input: name, email, address, payment method. After submission, processorder.php will validate this data, then insert the order into the orders table with an order ID. Then, insert each item from the cart into order_details. Finally, send a confirmation email and clear the session.\n\nOrder history should display past orders for the user. Assuming we have an orders table linked by user_id, but since this example doesn't handle user login, I'll note that as a future consideration.\n\nI also need to include database connection details in each script or create a config file to avoid repetition. Error handling is important too; adding try-catch blocks and checking for query errors will make the system more robust.\n\nFinally, the example is basic. Real-world scenarios would require additional features like user authentication, secure payment processing, and CSRF protection. But this should give the user a solid foundation to build upon.\n</think>\n\nHere's an example of how to create a purchase functionality using PHP:\n\nThis example includes:\n1. Product catalog display\n2. Shopping cart implementation\n3. Checkout process\n4. Order confirmation\n\n**Note:** This is a basic example and should be customized according to your specific needs.\n\n### Step 1: Database Setup\n\nFirst, create a database table for products:\n\n```sql\nCREATE TABLE products (\n    id INT AUTO_INCREMENT PRIMARY KEY,\n    name VARCHAR(255),\n    price DECIMAL(10, 2),\n    description TEXT\n);\n```\n\nInsert some sample products:\n\n```sql\nINSERT INTO products (name, price, description) VALUES \n('Product 1', 9.99, 'Description for Product 1'),\n('Product 2', 14.99, 'Description for Product 2'),\n('Product 3', 19.99, 'Description for Product 3');\n```\n\n### Step 2: Product Catalog Page (`index.php`)\n\n```php\n<?php\n$servername = \"localhost\";\n$username = \"username\";\n$password = \"password\";\n$dbname = \"myDB\";\n\n// Create connection\n$conn = mysqli_connect($servername, $username, $password, $dbname);\n\n// Check connection\nif (!$conn) {\n    die(\"Connection failed: \" . mysqli_connect_error());\n}\n\n$sql = \"SELECT * FROM products\";\n$result = mysqli_query($conn, $sql);\n?>\n\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Product Catalog</title>\n</head>\n<body>\n    <h1>Product Catalog</h1>\n    <?php if (mysqli_num_rows($result) > 0) { ?>\n        <table border=\"1\">\n            <tr>\n                <th>Name</th>\n                <th>Price</th>\n                <th>Description</th>\n                <th>Action</th>\n            </tr>\n            <?php while ($row = mysqli_fetch_assoc($result)) { ?>\n                <tr>\n                    <td><?php echo $row[\"name\"]; ?></td>\n                    <td>$<?php echo $row[\"price\"]; ?></td>\n                    <td><?php echo $row[\"description\"]; ?></td>\n                    <td><a href=\"addtocart.php?id=<?php echo $row[\"id\"]; ?>\">Add to Cart</a></td>\n                </tr>\n            <?php } ?>\n        </table>\n    <?php } else { ?>\n        <p>No products available.</p>\n    <?php } ?>\n\n    <p><a href=\"cart.php\">View Cart</a></p>\n\n<?php\nmysqli_close($conn);\n?>\n</body>\n</html>\n```\n\n### Step 3: Add to Cart Page (`addtocart.php`)\n\n```php\n<?php\nsession_start();\n\n$servername = \"localhost\";\n$username = \"username\";\n$password = \"password\";\n$dbname = \"myDB\";\n\n// Create connection\n$conn = mysqli_connect($servername, $username, $password, $dbname);\n\nif (!$conn) {\n    die(\"Connection failed: \" . mysqli_connect_error());\n}\n\n$product_id = $_GET['id'];\n\n$sql = \"SELECT * FROM products WHERE id = $product_id\";\n$result = mysqli_query($conn, $sql);\n$product = mysqli_fetch_assoc($result);\n\n// Add product to cart\nif (isset($_SESSION['cart'])) {\n    if (array_key_exists($product_id, $_SESSION['cart'])) {\n        // Increment quantity\n        $_SESSION['cart'][$product_id]['quantity']++;\n    } else {\n        // Add new product\n        $_SESSION['cart'][$product_id] = array(\n            'name' => $product['name'],\n            'price' => $product['price'],\n            'quantity' => 1\n        );\n    }\n} else {\n    $_SESSION['cart'] = array();\n    $_SESSION['cart'][$product_id] = array(\n        'name' => $product['name'],\n        'price' => $product['price'],\n        'quantity' => 1\n    );\n}\n\nmysqli_close($conn);\n\n// Redirect back to product catalog\nheader('Location: index.php');\nexit();\n```\n\n### Step 4: Cart Page (`cart.php`)\n\n```php\n<?php\nsession_start();\n\n$servername = \"localhost\";\n$username = \"username\";\n$password = \"password\";\n$dbname = \"myDB\";\n\n// Create connection\n$conn = mysqli_connect($servername, $username, $password, $dbname);\n\nif (!$conn) {\n    die(\"Connection failed: \" . mysqli_connect_error());\n}\n\n$total = 0;\n?>\n\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Shopping Cart</title>\n</head>\n<body>\n    <h1>Shopping Cart</h1>\n    \n    <?php if (!empty($_SESSION['cart'])) { ?>\n        <table border=\"1\">\n            <tr>\n                <th>Name</th>\n                <th>Price</th>\n                <th>Quantity</th>\n                <th>Total</th>\n                <th>Action</th>\n            </tr>\n            <?php foreach ($_SESSION['cart'] as $product_id => $item) { \n                $sql = \"SELECT * FROM products WHERE id = $product_id\";\n                $result = mysqli_query($conn, $sql);\n                $product = mysqli_fetch_assoc($result); ?>\n\n                <tr>\n                    <td><?php echo $product['name']; ?></td>\n                    <td>$<?php echo $item['price']; ?></td>\n                    <td><form action=\"updatecart.php\" method=\"post\">\n                        <input type=\"hidden\" name=\"id\" value=\"<?php echo $product_id; ?>\">\n                        <input type=\"number\" name=\"quantity\" min=\"1\" value=\"<?php echo $item['quantity']; ?>\">\n                        <input type=\"submit\" value=\"Update\">\n                    </form></td>\n                    <td>$<?php echo number_format($item['price'] * $item['quantity'], 2); ?></td>\n                    <td><a href=\"removefromcart.php?id=<?php echo $product_id; ?>\">Remove</a></td>\n                </tr>\n\n                <?php $total += $item['price'] * $item['quantity']; ?>\n            <?php } ?>\n        </table>\n        <h3>Total: $<?php echo number_format($total, 2); ?></h3>\n        <p><a href=\"checkout.php\">Checkout</a></p>\n    <?php } else { ?>\n        <p>Your cart is empty.</p>\n        <p><a href=\"index.php\">Continue Shopping</a></p>\n    <?php } ?>\n\n<?php\nmysqli_close($conn);\n?>\n</body>\n</html>\n```\n\n### Step 5: Update Cart Page (`updatecart.php`)\n\n```php\n<?php\nsession_start();\n\n$product_id = $_POST['id'];\n$quantity = $_POST['quantity'];\n\nif (isset($_SESSION['cart'][$product_id])) {\n    $_SESSION['cart'][$product_id]['quantity'] = $quantity;\n}\n\n// Redirect back to cart page\nheader('Location: cart.php');\nexit();\n```\n\n### Step 6: Remove from Cart Page (`removefromcart.php`)\n\n```php\n<?php\nsession_start();\n\n$product_id = $_GET['id'];\n\nif (isset($_SESSION['cart'][$product_id])) {\n    unset($_SESSION['cart'][$product_id]);\n}\n\n// Redirect back to cart page\nheader('Location: cart.php');\nexit();\n```\n\n### Step 7: Checkout Page (`checkout.php`)\n\n```php\n<?php\nsession_start();\n\n$servername = \"localhost\";\n$username = \"username\";\n$password = \"password\";\n$dbname = \"myDB\";\n\n$conn = mysqli_connect($servername, $username, $password, $dbname);\n\nif (!$conn) {\n    die(\"Connection failed: \" . mysqli_connect_error());\n}\n?>\n\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Checkout</title>\n</head>\n<body>\n    <h1>Checkout</h1>\n    \n    <?php if (!empty($_SESSION['cart'])) { ?>\n        <form action=\"processorder.php\" method=\"post\">\n            <table border=\"1\">\n                <tr>\n                    <th>Name</th>\n                    <th>Price</th>\n                    <th>Quantity</th>\n                    <th>Total</th>\n                </tr>\n                <?php $total = 0; foreach ($_SESSION['cart'] as $product_id => $item) { \n                    $sql = \"SELECT * FROM products WHERE id = $product_id\";\n                    $result = mysqli_query($conn, $sql);\n                    $product = mysqli_fetch_assoc($result); ?>\n\n                    <tr>\n                        <td><?php echo $product['name']; ?></td>\n                        <td>$<?php echo $item['price']; ?></td>\n                        <td><?php echo $item['quantity']; ?></td>\n                        <td>$<?php echo number_format($item['price'] * $item['quantity'], 2); ?></td>\n                    </tr>\n\n                    <?php $total += $item['price'] * $item['quantity']; ?>\n                <?php } ?>\n            </table>\n            <h3>Total: $<?php echo number_format($total, 2); ?></h3>\n\n            <div>\n                <label for=\"name\">Name:</label>\n                <input type=\"text\" id=\"name\" name=\"name\" required><br>\n                \n                <label for=\"email\">Email:</label>\n                <input type=\"email\" id=\"email\" name=\"email\" required><br>\n                \n                <label for=\"address\">Address:</label>\n                <input type=\"text\" id=\"address\" name=\"address\" required><br>\n                \n                <label for=\"payment_method\">Payment Method:</label>\n                <select id=\"payment_method\" name=\"payment_method\">\n                    <option value=\"credit_card\">Credit Card</option>\n                    <option value=\"debit_card\">Debit Card</option>\n                    <option value=\"paypal\">PayPal</option>\n                </select><br>\n\n                <input type=\"submit\" value=\"Place Order\">\n            </div>\n        </form>\n    <?php } else { ?>\n        <p>Your cart is empty.</p>\n        <p><a href=\"index.php\">Continue Shopping</a></p>\n    <?php } ?>\n\n<?php\nmysqli_close($conn);\n?>\n</body>\n</html>\n```\n\n### Step 8: Process Order Page (`processorder.php`)\n\n```php\n<?php\nsession_start();\n\n$servername = \"localhost\";\n$username = \"username\";\n$password = \"password\";\n$dbname = \"myDB\";\n\n$conn = mysqli_connect($servername, $username, $password, $dbname);\n\nif (!$conn) {\n    die(\"Connection failed: \" . mysqli_connect_error());\n}\n\n// Get order details from form\n$name = $_POST['name'];\n$email = $_POST['email'];\n$address = $_POST['address'];\n$payment_method = $_POST['payment_method'];\n\n// Calculate total\n$total = 0;\nforeach ($_SESSION['cart'] as $product_id => $item) {\n    $total += $item['price'] * $item['quantity'];\n}\n\n// Insert order into orders table\n$sql = \"INSERT INTO orders (name, email, address, payment_method, total_amount)\n        VALUES ('$name', '$email', '$address', '$payment_method', $total)\";\nif (mysqli_query($conn, $sql)) {\n    $order_id = mysqli_insert_id($conn);\n\n    // Insert order details into order_details table\n    foreach ($_SESSION['cart'] as $product_id => $item) {\n        $price = $item['price'];\n        $quantity = $item['quantity'];\n        \n        $sql_details = \"INSERT INTO order_details (order_id, product_id, price, quantity)\n                        VALUES ($order_id, $product_id, $price, $quantity)\";\n        mysqli_query($conn, $sql_details);\n    }\n\n    // Clear cart\n    unset($_SESSION['cart']);\n    \n    // Send confirmation email\n    $to = $email;\n    $subject = \"Order Confirmation\";\n    $message = \"Thank you for your order! Your order ID is #$order_id and has been processed successfully.\";\n    $headers = \"From: noreply@example.com\";\n\n    mail($to, $subject, $message, $headers);\n\n    // Redirect to thank you page\n    header('Location: confirmation.php');\n    exit();\n} else {\n    echo \"Error processing order: \" . mysqli_error($conn);\n}\n\nmysqli_close($conn);\n```\n\n### Step 9: Order Confirmation Page (`confirmation.php`)\n\n```php\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Order Confirmation</title>\n</head>\n<body>\n    <h1>Thank you for your order!</h1>\n    <p>Your order has been processed successfully.</p>\n    <p><a href=\"index.php\">Continue Shopping</a></p>\n</body>\n</html>\n```\n\n### Step 10: Order History Page (`orderhistory.php`)\n\n```php\n<?php\nsession_start();\n\n$servername = \"localhost\";\n$username = \"username\";\n$password = \"password\";\n$dbname = \"myDB\";\n\n$conn = mysqli_connect($servername, $username, $password, $dbname);\n\nif (!$conn) {\n    die(\"Connection failed: \" . mysqli_connect_error());\n}\n\n// Assuming user is logged in and has a user_id session variable\n$user_id = $_SESSION['user_id'];\n\n$sql = \"SELECT * FROM orders WHERE user_id = $user_id\";\n$result = mysqli_query($conn, $sql);\n?>\n\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Order History</title>\n</head>\n<body>\n    <h1>Order History</h1>\n    \n    <?php if (mysqli_num_rows($result) > 0) { ?>\n        <table border=\"1\">\n            <tr>\n                <th>Order ID</th>\n                <th>Date</th>\n                <th>Total Amount</th>\n                <th>Status</th>\n            </tr>\n            <?php while ($row = mysqli_fetch_assoc($result)) { ?>\n                <tr>\n                    <td><?php echo $row[\"id\"]; ?></td>\n                    <td><?php echo $row[\"order_date\"]; ?></td>\n                    <td>$<?php echo number_format($row[\"total_amount\"], 2); ?></td>\n                    <td><?php echo $row[\"status\"]; ?></td>\n                </tr>\n            <?php } ?>\n        </table>\n    <?php } else { ?>\n        <p>No orders found.</p>\n    <?php } ?>\n\n<?php\nmysqli_close($conn);\n?>\n</body>\n</html>\n```\n\n### Important Notes:\n1. This is a basic implementation and should be customized according to your specific needs.\n2. You'll need to create the necessary database tables (`orders`, `order_details`) before running this code.\n3. Add proper error handling and security measures (e.g., input validation, SQL injection prevention).\n4. Implement user authentication for real-world applications.\n5. Use secure payment gateways for actual transactions.\n6. Add CSRF protection for forms to prevent cross-site request forgery attacks.\n\nThis example provides a basic structure for implementing a purchase functionality using PHP. You can extend it by adding more features like:\n- User registration and login\n- Payment integration (e.g., PayPal, Stripe)\n- Order tracking\n- Returns and refunds\n- Product reviews\n- Discount codes\n- Shipping options", "code_blocks": [null, null, "```php\n<?php\n$servername = \"localhost\";\n$username = \"username\";\n$password = \"password\";\n$dbname = \"myDB\";\n\n// Create connection\n$conn = mysqli_connect($servername, $username, $password, $dbname);\n\n// Check connection\nif (!$conn) {\n    die(\"Connection failed: \" . mysqli_connect_error());\n}\n\n$sql = \"SELECT * FROM products\";\n$result = mysqli_query($conn, $sql);\n?>\n\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Product Catalog</title>\n</head>\n<body>\n    <h1>Product Catalog</h1>\n    <?php if (mysqli_num_rows($result) > 0) { ?>\n        <table border=\"1\">\n            <tr>\n                <th>Name</th>\n                <th>Price</th>\n                <th>Description</th>\n                <th>Action</th>\n            </tr>\n            <?php while ($row = mysqli_fetch_assoc($result)) { ?>\n                <tr>\n                    <td><?php echo $row[\"name\"]; ?></td>\n                    <td>$<?php echo $row[\"price\"]; ?></td>\n                    <td><?php echo $row[\"description\"]; ?></td>\n                    <td><a href=\"addtocart.php?id=<?php echo $row[\"id\"]; ?>\">Add to Cart</a></td>\n                </tr>\n            <?php } ?>\n        </table>\n    <?php } else { ?>\n        <p>No products available.</p>\n    <?php } ?>\n\n    <p><a href=\"cart.php\">View Cart</a></p>\n\n<?php\nmysqli_close($conn);\n?>\n</body>\n</html>\n```", "```php\n<?php\nsession_start();\n\n$servername = \"localhost\";\n$username = \"username\";\n$password = \"password\";\n$dbname = \"myDB\";\n\n// Create connection\n$conn = mysqli_connect($servername, $username, $password, $dbname);\n\nif (!$conn) {\n    die(\"Connection failed: \" . mysqli_connect_error());\n}\n\n$product_id = $_GET['id'];\n\n$sql = \"SELECT * FROM products WHERE id = $product_id\";\n$result = mysqli_query($conn, $sql);\n$product = mysqli_fetch_assoc($result);\n\n// Add product to cart\nif (isset($_SESSION['cart'])) {\n    if (array_key_exists($product_id, $_SESSION['cart'])) {\n        // Increment quantity\n        $_SESSION['cart'][$product_id]['quantity']++;\n    } else {\n        // Add new product\n        $_SESSION['cart'][$product_id] = array(\n            'name' => $product['name'],\n            'price' => $product['price'],\n            'quantity' => 1\n        );\n    }\n} else {\n    $_SESSION['cart'] = array();\n    $_SESSION['cart'][$product_id] = array(\n        'name' => $product['name'],\n        'price' => $product['price'],\n        'quantity' => 1\n    );\n}\n\nmysqli_close($conn);\n\n// Redirect back to product catalog\nheader('Location: index.php');\nexit();\n```", "```php\n<?php\nsession_start();\n\n$servername = \"localhost\";\n$username = \"username\";\n$password = \"password\";\n$dbname = \"myDB\";\n\n// Create connection\n$conn = mysqli_connect($servername, $username, $password, $dbname);\n\nif (!$conn) {\n    die(\"Connection failed: \" . mysqli_connect_error());\n}\n\n$total = 0;\n?>\n\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Shopping Cart</title>\n</head>\n<body>\n    <h1>Shopping Cart</h1>\n    \n    <?php if (!empty($_SESSION['cart'])) { ?>\n        <table border=\"1\">\n            <tr>\n                <th>Name</th>\n                <th>Price</th>\n                <th>Quantity</th>\n                <th>Total</th>\n                <th>Action</th>\n            </tr>\n            <?php foreach ($_SESSION['cart'] as $product_id => $item) { \n                $sql = \"SELECT * FROM products WHERE id = $product_id\";\n                $result = mysqli_query($conn, $sql);\n                $product = mysqli_fetch_assoc($result); ?>\n\n                <tr>\n                    <td><?php echo $product['name']; ?></td>\n                    <td>$<?php echo $item['price']; ?></td>\n                    <td><form action=\"updatecart.php\" method=\"post\">\n                        <input type=\"hidden\" name=\"id\" value=\"<?php echo $product_id; ?>\">\n                        <input type=\"number\" name=\"quantity\" min=\"1\" value=\"<?php echo $item['quantity']; ?>\">\n                        <input type=\"submit\" value=\"Update\">\n                    </form></td>\n                    <td>$<?php echo number_format($item['price'] * $item['quantity'], 2); ?></td>\n                    <td><a href=\"removefromcart.php?id=<?php echo $product_id; ?>\">Remove</a></td>\n                </tr>\n\n                <?php $total += $item['price'] * $item['quantity']; ?>\n            <?php } ?>\n        </table>\n        <h3>Total: $<?php echo number_format($total, 2); ?></h3>\n        <p><a href=\"checkout.php\">Checkout</a></p>\n    <?php } else { ?>\n        <p>Your cart is empty.</p>\n        <p><a href=\"index.php\">Continue Shopping</a></p>\n    <?php } ?>\n\n<?php\nmysqli_close($conn);\n?>\n</body>\n</html>\n```", "```php\n<?php\nsession_start();\n\n$product_id = $_POST['id'];\n$quantity = $_POST['quantity'];\n\nif (isset($_SESSION['cart'][$product_id])) {\n    $_SESSION['cart'][$product_id]['quantity'] = $quantity;\n}\n\n// Redirect back to cart page\nheader('Location: cart.php');\nexit();\n```", "```php\n<?php\nsession_start();\n\n$product_id = $_GET['id'];\n\nif (isset($_SESSION['cart'][$product_id])) {\n    unset($_SESSION['cart'][$product_id]);\n}\n\n// Redirect back to cart page\nheader('Location: cart.php');\nexit();\n```", "```php\n<?php\nsession_start();\n\n$servername = \"localhost\";\n$username = \"username\";\n$password = \"password\";\n$dbname = \"myDB\";\n\n$conn = mysqli_connect($servername, $username, $password, $dbname);\n\nif (!$conn) {\n    die(\"Connection failed: \" . mysqli_connect_error());\n}\n?>\n\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Checkout</title>\n</head>\n<body>\n    <h1>Checkout</h1>\n    \n    <?php if (!empty($_SESSION['cart'])) { ?>\n        <form action=\"processorder.php\" method=\"post\">\n            <table border=\"1\">\n                <tr>\n                    <th>Name</th>\n                    <th>Price</th>\n                    <th>Quantity</th>\n                    <th>Total</th>\n                </tr>\n                <?php $total = 0; foreach ($_SESSION['cart'] as $product_id => $item) { \n                    $sql = \"SELECT * FROM products WHERE id = $product_id\";\n                    $result = mysqli_query($conn, $sql);\n                    $product = mysqli_fetch_assoc($result); ?>\n\n                    <tr>\n                        <td><?php echo $product['name']; ?></td>\n                        <td>$<?php echo $item['price']; ?></td>\n                        <td><?php echo $item['quantity']; ?></td>\n                        <td>$<?php echo number_format($item['price'] * $item['quantity'], 2); ?></td>\n                    </tr>\n\n                    <?php $total += $item['price'] * $item['quantity']; ?>\n                <?php } ?>\n            </table>\n            <h3>Total: $<?php echo number_format($total, 2); ?></h3>\n\n            <div>\n                <label for=\"name\">Name:</label>\n                <input type=\"text\" id=\"name\" name=\"name\" required><br>\n                \n                <label for=\"email\">Email:</label>\n                <input type=\"email\" id=\"email\" name=\"email\" required><br>\n                \n                <label for=\"address\">Address:</label>\n                <input type=\"text\" id=\"address\" name=\"address\" required><br>\n                \n                <label for=\"payment_method\">Payment Method:</label>\n                <select id=\"payment_method\" name=\"payment_method\">\n                    <option value=\"credit_card\">Credit Card</option>\n                    <option value=\"debit_card\">Debit Card</option>\n                    <option value=\"paypal\">PayPal</option>\n                </select><br>\n\n                <input type=\"submit\" value=\"Place Order\">\n            </div>\n        </form>\n    <?php } else { ?>\n        <p>Your cart is empty.</p>\n        <p><a href=\"index.php\">Continue Shopping</a></p>\n    <?php } ?>\n\n<?php\nmysqli_close($conn);\n?>\n</body>\n</html>\n```", "```php\n<?php\nsession_start();\n\n$servername = \"localhost\";\n$username = \"username\";\n$password = \"password\";\n$dbname = \"myDB\";\n\n$conn = mysqli_connect($servername, $username, $password, $dbname);\n\nif (!$conn) {\n    die(\"Connection failed: \" . mysqli_connect_error());\n}\n\n// Get order details from form\n$name = $_POST['name'];\n$email = $_POST['email'];\n$address = $_POST['address'];\n$payment_method = $_POST['payment_method'];\n\n// Calculate total\n$total = 0;\nforeach ($_SESSION['cart'] as $product_id => $item) {\n    $total += $item['price'] * $item['quantity'];\n}\n\n// Insert order into orders table\n$sql = \"INSERT INTO orders (name, email, address, payment_method, total_amount)\n        VALUES ('$name', '$email', '$address', '$payment_method', $total)\";\nif (mysqli_query($conn, $sql)) {\n    $order_id = mysqli_insert_id($conn);\n\n    // Insert order details into order_details table\n    foreach ($_SESSION['cart'] as $product_id => $item) {\n        $price = $item['price'];\n        $quantity = $item['quantity'];\n        \n        $sql_details = \"INSERT INTO order_details (order_id, product_id, price, quantity)\n                        VALUES ($order_id, $product_id, $price, $quantity)\";\n        mysqli_query($conn, $sql_details);\n    }\n\n    // Clear cart\n    unset($_SESSION['cart']);\n    \n    // Send confirmation email\n    $to = $email;\n    $subject = \"Order Confirmation\";\n    $message = \"Thank you for your order! Your order ID is #$order_id and has been processed successfully.\";\n    $headers = \"From: noreply@example.com\";\n\n    mail($to, $subject, $message, $headers);\n\n    // Redirect to thank you page\n    header('Location: confirmation.php');\n    exit();\n} else {\n    echo \"Error processing order: \" . mysqli_error($conn);\n}\n\nmysqli_close($conn);\n```", "```php\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Order Confirmation</title>\n</head>\n<body>\n    <h1>Thank you for your order!</h1>\n    <p>Your order has been processed successfully.</p>\n    <p><a href=\"index.php\">Continue Shopping</a></p>\n</body>\n</html>\n```", "```php\n<?php\nsession_start();\n\n$servername = \"localhost\";\n$username = \"username\";\n$password = \"password\";\n$dbname = \"myDB\";\n\n$conn = mysqli_connect($servername, $username, $password, $dbname);\n\nif (!$conn) {\n    die(\"Connection failed: \" . mysqli_connect_error());\n}\n\n// Assuming user is logged in and has a user_id session variable\n$user_id = $_SESSION['user_id'];\n\n$sql = \"SELECT * FROM orders WHERE user_id = $user_id\";\n$result = mysqli_query($conn, $sql);\n?>\n\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Order History</title>\n</head>\n<body>\n    <h1>Order History</h1>\n    \n    <?php if (mysqli_num_rows($result) > 0) { ?>\n        <table border=\"1\">\n            <tr>\n                <th>Order ID</th>\n                <th>Date</th>\n                <th>Total Amount</th>\n                <th>Status</th>\n            </tr>\n            <?php while ($row = mysqli_fetch_assoc($result)) { ?>\n                <tr>\n                    <td><?php echo $row[\"id\"]; ?></td>\n                    <td><?php echo $row[\"order_date\"]; ?></td>\n                    <td>$<?php echo number_format($row[\"total_amount\"], 2); ?></td>\n                    <td><?php echo $row[\"status\"]; ?></td>\n                </tr>\n            <?php } ?>\n        </table>\n    <?php } else { ?>\n        <p>No orders found.</p>\n    <?php } ?>\n\n<?php\nmysqli_close($conn);\n?>\n</body>\n</html>\n```"]}
