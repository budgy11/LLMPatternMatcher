{"prompt": "Create a purchase functionality using php", "llm_output": "Here's an example of a basic purchase functionality in PHP:\n\n**Database Schema**\n\nFor this example, let's assume we have the following database schema:\n```sql\nCREATE TABLE products (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  name VARCHAR(255),\n  price DECIMAL(10,2)\n);\n\nCREATE TABLE orders (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  customer_id INT,\n  order_date DATE,\n  total DECIMAL(10,2)\n);\n\nCREATE TABLE order_items (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  order_id INT,\n  product_id INT,\n  quantity INT\n);\n```\n**PHP Code**\n\nCreate a new PHP file named `purchase.php` and add the following code:\n```php\n<?php\n\n// Configuration\n$db_host = 'localhost';\n$db_username = 'root';\n$db_password = '';\n$db_name = 'store';\n\n// Connect to database\n$conn = mysqli_connect($db_host, $db_username, $db_password, $db_name);\n\n// Check connection\nif (!$conn) {\n  die(\"Connection failed: \" . mysqli_connect_error());\n}\n\n// Function to add product to cart\nfunction add_product_to_cart($product_id, $quantity) {\n  global $conn;\n  \n  // Insert into order_items table\n  $query = \"INSERT INTO order_items (order_id, product_id, quantity)\n            VALUES ('', '$product_id', '$quantity')\";\n  mysqli_query($conn, $query);\n}\n\n// Function to process purchase\nfunction process_purchase() {\n  global $conn;\n  \n  // Get customer ID from session\n  $customer_id = $_SESSION['customer_id'];\n  \n  // Create new order\n  $query = \"INSERT INTO orders (customer_id, order_date, total)\n            VALUES ('$customer_id', NOW(), '')\";\n  mysqli_query($conn, $query);\n  \n  // Get last inserted order ID\n  $order_id = mysqli_insert_id($conn);\n  \n  // Update total for new order\n  $query = \"UPDATE orders SET total = (SELECT SUM(p.price * oi.quantity) \n                                        FROM products p\n                                        JOIN order_items oi ON p.id = oi.product_id\n                                        WHERE oi.order_id = '$order_id')\";\n  mysqli_query($conn, $query);\n  \n  // Return order ID\n  return $order_id;\n}\n\n// Function to add product to order\nfunction add_product_to_order($product_id, $quantity) {\n  global $conn;\n  \n  // Get customer ID from session\n  $customer_id = $_SESSION['customer_id'];\n  \n  // Add product to cart\n  add_product_to_cart($product_id, $quantity);\n  \n  // Process purchase\n  $order_id = process_purchase();\n  \n  // Update order items with new order ID\n  $query = \"UPDATE order_items SET order_id = '$order_id'\n            WHERE product_id = '$product_id'\";\n  mysqli_query($conn, $query);\n}\n\n// Handle form submission\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n  $product_id = $_POST['product_id'];\n  $quantity = $_POST['quantity'];\n  \n  // Add product to order\n  add_product_to_order($product_id, $quantity);\n  \n  // Redirect to success page\n  header('Location: success.php');\n  exit;\n}\n\n// Display form\n?>\n<form action=\"\" method=\"post\">\n  <label for=\"product_id\">Product ID:</label>\n  <input type=\"text\" id=\"product_id\" name=\"product_id\"><br><br>\n  <label for=\"quantity\">Quantity:</label>\n  <input type=\"number\" id=\"quantity\" name=\"quantity\"><br><br>\n  <input type=\"submit\" value=\"Add to Cart\">\n</form>\n```\n**How it works**\n\n1. The user submits a form with the product ID and quantity.\n2. The `add_product_to_order()` function is called, which adds the product to cart and processes the purchase.\n3. The `process_purchase()` function creates a new order and updates the total for that order.\n4. The `add_product_to_cart()` function inserts a new record into the `order_items` table with the order ID, product ID, and quantity.\n\n**Note**: This is a basic example and does not include any validation or error handling. You should modify it to fit your specific needs and add any necessary features (e.g., authentication, payment processing).", "code_blocks": [null, "```php\n<?php\n\n// Configuration\n$db_host = 'localhost';\n$db_username = 'root';\n$db_password = '';\n$db_name = 'store';\n\n// Connect to database\n$conn = mysqli_connect($db_host, $db_username, $db_password, $db_name);\n\n// Check connection\nif (!$conn) {\n  die(\"Connection failed: \" . mysqli_connect_error());\n}\n\n// Function to add product to cart\nfunction add_product_to_cart($product_id, $quantity) {\n  global $conn;\n  \n  // Insert into order_items table\n  $query = \"INSERT INTO order_items (order_id, product_id, quantity)\n            VALUES ('', '$product_id', '$quantity')\";\n  mysqli_query($conn, $query);\n}\n\n// Function to process purchase\nfunction process_purchase() {\n  global $conn;\n  \n  // Get customer ID from session\n  $customer_id = $_SESSION['customer_id'];\n  \n  // Create new order\n  $query = \"INSERT INTO orders (customer_id, order_date, total)\n            VALUES ('$customer_id', NOW(), '')\";\n  mysqli_query($conn, $query);\n  \n  // Get last inserted order ID\n  $order_id = mysqli_insert_id($conn);\n  \n  // Update total for new order\n  $query = \"UPDATE orders SET total = (SELECT SUM(p.price * oi.quantity) \n                                        FROM products p\n                                        JOIN order_items oi ON p.id = oi.product_id\n                                        WHERE oi.order_id = '$order_id')\";\n  mysqli_query($conn, $query);\n  \n  // Return order ID\n  return $order_id;\n}\n\n// Function to add product to order\nfunction add_product_to_order($product_id, $quantity) {\n  global $conn;\n  \n  // Get customer ID from session\n  $customer_id = $_SESSION['customer_id'];\n  \n  // Add product to cart\n  add_product_to_cart($product_id, $quantity);\n  \n  // Process purchase\n  $order_id = process_purchase();\n  \n  // Update order items with new order ID\n  $query = \"UPDATE order_items SET order_id = '$order_id'\n            WHERE product_id = '$product_id'\";\n  mysqli_query($conn, $query);\n}\n\n// Handle form submission\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n  $product_id = $_POST['product_id'];\n  $quantity = $_POST['quantity'];\n  \n  // Add product to order\n  add_product_to_order($product_id, $quantity);\n  \n  // Redirect to success page\n  header('Location: success.php');\n  exit;\n}\n\n// Display form\n?>\n<form action=\"\" method=\"post\">\n  <label for=\"product_id\">Product ID:</label>\n  <input type=\"text\" id=\"product_id\" name=\"product_id\"><br><br>\n  <label for=\"quantity\">Quantity:</label>\n  <input type=\"number\" id=\"quantity\" name=\"quantity\"><br><br>\n  <input type=\"submit\" value=\"Add to Cart\">\n</form>\n```"]}
