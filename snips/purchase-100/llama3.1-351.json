{"prompt": "Create a purchase functionality using php", "llm_output": "**Purchase Functionality in PHP**\n=====================================\n\nBelow is an example of a basic purchase functionality implemented in PHP. This example includes user registration, login, product management, and checkout.\n\n### Database Setup\n\nFor this example, we'll use a MySQL database with the following schema:\n\n```sql\nCREATE TABLE users (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  name VARCHAR(255) NOT NULL,\n  email VARCHAR(255) UNIQUE NOT NULL,\n  password VARCHAR(255) NOT NULL\n);\n\nCREATE TABLE products (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  name VARCHAR(255) NOT NULL,\n  price DECIMAL(10,2) NOT NULL,\n  description TEXT\n);\n\nCREATE TABLE orders (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  user_id INT NOT NULL,\n  total DECIMAL(10,2) NOT NULL,\n  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n);\n\nCREATE TABLE order_items (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  order_id INT NOT NULL,\n  product_id INT NOT NULL,\n  quantity INT NOT NULL\n);\n```\n\n### PHP Code\n\n#### `config.php` (database connection settings)\n\n```php\n<?php\ndefined('DB_HOST') or define('DB_HOST', 'localhost');\ndefined('DB_USERNAME') or define('DB_USERNAME', 'root');\ndefined('DB_PASSWORD') or define('DB_PASSWORD', '');\ndefined('DB_NAME') or define('DB_NAME', 'your_database_name');\n\n$conn = new mysqli(DB_HOST, DB_USERNAME, DB_PASSWORD, DB_NAME);\n?>\n```\n\n#### `register.php` (user registration)\n\n```php\n<?php\nrequire_once 'config.php';\n\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n  $name = $_POST['name'];\n  $email = $_POST['email'];\n  $password = $_POST['password'];\n\n  $sql = \"INSERT INTO users (name, email, password) VALUES (?, ?, ?)\";\n  $stmt = $conn->prepare($sql);\n  $stmt->bind_param('sss', $name, $email, md5($password));\n  $stmt->execute();\n\n  echo 'User registered successfully!';\n}\n\n?>\n```\n\n#### `login.php` (user login)\n\n```php\n<?php\nrequire_once 'config.php';\n\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n  $email = $_POST['email'];\n  $password = $_POST['password'];\n\n  $sql = \"SELECT * FROM users WHERE email = ? AND password = ?\";\n  $stmt = $conn->prepare($sql);\n  $stmt->bind_param('ss', $email, md5($password));\n  $stmt->execute();\n  $result = $stmt->get_result();\n\n  if ($result->num_rows > 0) {\n    echo 'Login successful!';\n  } else {\n    echo 'Invalid email or password.';\n  }\n}\n\n?>\n```\n\n#### `products.php` (product management)\n\n```php\n<?php\nrequire_once 'config.php';\n\n$sql = \"SELECT * FROM products\";\n$result = $conn->query($sql);\n\nwhile ($row = $result->fetch_assoc()) {\n  echo '<p>' . $row['name'] . ' - $\" . $row['price'] . '</p>';\n}\n?>\n```\n\n#### `checkout.php` (purchase functionality)\n\n```php\n<?php\nrequire_once 'config.php';\n\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n  session_start();\n  $order_id = uniqid();\n  $user_id = $_SESSION['user']['id'];\n  $total = 0;\n\n  foreach ($_SESSION['cart'] as $product_id => $quantity) {\n    $sql = \"INSERT INTO order_items (order_id, product_id, quantity) VALUES (?, ?, ?)\";\n    $stmt = $conn->prepare($sql);\n    $stmt->bind_param('iis', $order_id, $product_id, $quantity);\n    $stmt->execute();\n\n    $sql = \"UPDATE products SET stock = stock - ? WHERE id = ?\";\n    $stmt = $conn->prepare($sql);\n    $stmt->bind_param('ii', $quantity, $product_id);\n    $stmt->execute();\n  }\n\n  $sql = \"INSERT INTO orders (user_id, total) VALUES (?, ?)\";\n  $stmt = $conn->prepare($sql);\n  $stmt->bind_param('is', $user_id, $total);\n  $stmt->execute();\n\n  unset($_SESSION['cart']);\n  echo 'Order placed successfully!';\n}\n\n?>\n```\n\n### Example Use Case\n\n1. User registers by submitting the registration form.\n2. User logs in using their email and password.\n3. User views products on the `products.php` page.\n4. User adds products to cart by clicking the \"Add to Cart\" button.\n5. User proceeds to checkout by clicking the \"Checkout\" button.\n6. User confirms purchase by submitting the form on the `checkout.php` page.\n\nNote: This is a basic example and you may want to add additional features such as payment gateway integration, user authentication, and error handling.", "code_blocks": [null, "```php\n<?php\ndefined('DB_HOST') or define('DB_HOST', 'localhost');\ndefined('DB_USERNAME') or define('DB_USERNAME', 'root');\ndefined('DB_PASSWORD') or define('DB_PASSWORD', '');\ndefined('DB_NAME') or define('DB_NAME', 'your_database_name');\n\n$conn = new mysqli(DB_HOST, DB_USERNAME, DB_PASSWORD, DB_NAME);\n?>\n```", "```php\n<?php\nrequire_once 'config.php';\n\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n  $name = $_POST['name'];\n  $email = $_POST['email'];\n  $password = $_POST['password'];\n\n  $sql = \"INSERT INTO users (name, email, password) VALUES (?, ?, ?)\";\n  $stmt = $conn->prepare($sql);\n  $stmt->bind_param('sss', $name, $email, md5($password));\n  $stmt->execute();\n\n  echo 'User registered successfully!';\n}\n\n?>\n```", "```php\n<?php\nrequire_once 'config.php';\n\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n  $email = $_POST['email'];\n  $password = $_POST['password'];\n\n  $sql = \"SELECT * FROM users WHERE email = ? AND password = ?\";\n  $stmt = $conn->prepare($sql);\n  $stmt->bind_param('ss', $email, md5($password));\n  $stmt->execute();\n  $result = $stmt->get_result();\n\n  if ($result->num_rows > 0) {\n    echo 'Login successful!';\n  } else {\n    echo 'Invalid email or password.';\n  }\n}\n\n?>\n```", "```php\n<?php\nrequire_once 'config.php';\n\n$sql = \"SELECT * FROM products\";\n$result = $conn->query($sql);\n\nwhile ($row = $result->fetch_assoc()) {\n  echo '<p>' . $row['name'] . ' - $\" . $row['price'] . '</p>';\n}\n?>\n```", "```php\n<?php\nrequire_once 'config.php';\n\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n  session_start();\n  $order_id = uniqid();\n  $user_id = $_SESSION['user']['id'];\n  $total = 0;\n\n  foreach ($_SESSION['cart'] as $product_id => $quantity) {\n    $sql = \"INSERT INTO order_items (order_id, product_id, quantity) VALUES (?, ?, ?)\";\n    $stmt = $conn->prepare($sql);\n    $stmt->bind_param('iis', $order_id, $product_id, $quantity);\n    $stmt->execute();\n\n    $sql = \"UPDATE products SET stock = stock - ? WHERE id = ?\";\n    $stmt = $conn->prepare($sql);\n    $stmt->bind_param('ii', $quantity, $product_id);\n    $stmt->execute();\n  }\n\n  $sql = \"INSERT INTO orders (user_id, total) VALUES (?, ?)\";\n  $stmt = $conn->prepare($sql);\n  $stmt->bind_param('is', $user_id, $total);\n  $stmt->execute();\n\n  unset($_SESSION['cart']);\n  echo 'Order placed successfully!';\n}\n\n?>\n```"]}
