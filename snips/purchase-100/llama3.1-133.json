{"prompt": "Create a purchase functionality using php", "llm_output": "Here is an example of a basic purchase functionality in PHP. This example assumes you have a database set up with the necessary tables for products and customers.\n\n**Database Schema**\n\nFor this example, we'll assume you have two tables:\n\n`products`\n\n| Field Name | Data Type |\n| --- | --- |\n| id | int (primary key) |\n| name | varchar(255) |\n| price | decimal(10,2) |\n\n`customers`\n\n| Field Name | Data Type |\n| --- | --- |\n| id | int (primary key) |\n| name | varchar(255) |\n| email | varchar(255) |\n| password | varchar(255) |\n\n`orders`\n\n| Field Name | Data Type |\n| --- | --- |\n| id | int (primary key) |\n| customer_id | int (foreign key to customers table) |\n| order_date | datetime |\n| total_cost | decimal(10,2) |\n\n**PHP Code**\n\nCreate a new file called `purchase.php` and add the following code:\n```php\n<?php\n\n// Include database connection file\nrequire_once 'dbconnect.php';\n\n// Check if form has been submitted\nif (isset($_POST['submit'])) {\n  // Process form data\n  $product_id = $_POST['product_id'];\n  $customer_id = $_POST['customer_id'];\n  $quantity = $_POST['quantity'];\n\n  // Validate input data\n  if ($product_id == '' || $customer_id == '' || $quantity == '') {\n    echo 'Please fill in all fields';\n    exit;\n  }\n\n  // Check if product is available\n  $query = \"SELECT * FROM products WHERE id = '$product_id'\";\n  $result = mysqli_query($conn, $query);\n  $product = mysqli_fetch_assoc($result);\n\n  if ($quantity > $product['stock']) {\n    echo 'Insufficient stock for this product';\n    exit;\n  }\n\n  // Calculate total cost\n  $total_cost = $product['price'] * $quantity;\n\n  // Insert order into database\n  $query = \"INSERT INTO orders (customer_id, order_date, total_cost) VALUES ('$customer_id', NOW(), '$total_cost')\";\n  mysqli_query($conn, $query);\n\n  // Update stock level\n  $query = \"UPDATE products SET stock = stock - $quantity WHERE id = '$product_id'\";\n  mysqli_query($conn, $query);\n\n  // Display success message\n  echo 'Order placed successfully!';\n} else {\n  // Display form to user\n?>\n<form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\">\n  <label for=\"customer_id\">Customer ID:</label>\n  <input type=\"text\" id=\"customer_id\" name=\"customer_id\"><br><br>\n  <label for=\"product_id\">Product ID:</label>\n  <select id=\"product_id\" name=\"product_id\">\n    <?php\n      $query = \"SELECT * FROM products\";\n      $result = mysqli_query($conn, $query);\n      while ($product = mysqli_fetch_assoc($result)) {\n        echo '<option value=\"' . $product['id'] . '\">' . $product['name'] . '</option>';\n      }\n    ?>\n  </select><br><br>\n  <label for=\"quantity\">Quantity:</label>\n  <input type=\"number\" id=\"quantity\" name=\"quantity\"><br><br>\n  <input type=\"submit\" name=\"submit\" value=\"Place Order\">\n</form>\n\n<?php\n}\n?>\n```\nThis code checks if the form has been submitted, and if so, processes the form data to place an order. It validates input data, checks for sufficient stock, calculates total cost, inserts a new order into the database, updates the product's stock level, and displays a success message.\n\nIf the form has not been submitted, it displays the form to the user with a dropdown list of products and a field for entering customer ID and quantity.", "code_blocks": ["```php\n<?php\n\n// Include database connection file\nrequire_once 'dbconnect.php';\n\n// Check if form has been submitted\nif (isset($_POST['submit'])) {\n  // Process form data\n  $product_id = $_POST['product_id'];\n  $customer_id = $_POST['customer_id'];\n  $quantity = $_POST['quantity'];\n\n  // Validate input data\n  if ($product_id == '' || $customer_id == '' || $quantity == '') {\n    echo 'Please fill in all fields';\n    exit;\n  }\n\n  // Check if product is available\n  $query = \"SELECT * FROM products WHERE id = '$product_id'\";\n  $result = mysqli_query($conn, $query);\n  $product = mysqli_fetch_assoc($result);\n\n  if ($quantity > $product['stock']) {\n    echo 'Insufficient stock for this product';\n    exit;\n  }\n\n  // Calculate total cost\n  $total_cost = $product['price'] * $quantity;\n\n  // Insert order into database\n  $query = \"INSERT INTO orders (customer_id, order_date, total_cost) VALUES ('$customer_id', NOW(), '$total_cost')\";\n  mysqli_query($conn, $query);\n\n  // Update stock level\n  $query = \"UPDATE products SET stock = stock - $quantity WHERE id = '$product_id'\";\n  mysqli_query($conn, $query);\n\n  // Display success message\n  echo 'Order placed successfully!';\n} else {\n  // Display form to user\n?>\n<form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\">\n  <label for=\"customer_id\">Customer ID:</label>\n  <input type=\"text\" id=\"customer_id\" name=\"customer_id\"><br><br>\n  <label for=\"product_id\">Product ID:</label>\n  <select id=\"product_id\" name=\"product_id\">\n    <?php\n      $query = \"SELECT * FROM products\";\n      $result = mysqli_query($conn, $query);\n      while ($product = mysqli_fetch_assoc($result)) {\n        echo '<option value=\"' . $product['id'] . '\">' . $product['name'] . '</option>';\n      }\n    ?>\n  </select><br><br>\n  <label for=\"quantity\">Quantity:</label>\n  <input type=\"number\" id=\"quantity\" name=\"quantity\"><br><br>\n  <input type=\"submit\" name=\"submit\" value=\"Place Order\">\n</form>\n\n<?php\n}\n?>\n```"]}
