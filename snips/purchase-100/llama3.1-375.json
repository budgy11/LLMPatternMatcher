{"prompt": "Create a purchase functionality using php", "llm_output": "Here's an example of a simple purchase functionality in PHP:\n\n**database.sql**\n```sql\nCREATE TABLE orders (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  user_id INT,\n  product_id INT,\n  quantity INT,\n  total DECIMAL(10,2),\n  status VARCHAR(50),\n  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n);\n\nCREATE TABLE products (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  name VARCHAR(255),\n  price DECIMAL(10,2)\n);\n```\n\n**config.php**\n```php\n<?php\n$host = 'localhost';\n$dbname = 'shop';\n$username = 'root';\n$password = '';\n\ntry {\n    $conn = new PDO(\"mysql:host=$host;dbname=$dbname\", $username, $password);\n} catch (PDOException $e) {\n    echo \"Connection failed: \" . $e->getMessage();\n}\n\nfunction getProducts() {\n    global $conn;\n    $stmt = $conn->prepare('SELECT * FROM products');\n    $stmt->execute();\n    return $stmt->fetchAll();\n}\n\nfunction addOrder($user_id, $product_id, $quantity) {\n    global $conn;\n    $total = get_product_price($product_id);\n    $order = array(\n        'user_id' => $user_id,\n        'product_id' => $product_id,\n        'quantity' => $quantity,\n        'total' => $total\n    );\n    insert_order($order);\n}\n\nfunction get_product_price($id) {\n    global $conn;\n    $stmt = $conn->prepare('SELECT price FROM products WHERE id = :id');\n    $stmt->bindParam(':id', $id);\n    $stmt->execute();\n    return $stmt->fetch()['price'];\n}\n\nfunction insert_order($order) {\n    global $conn;\n    $sql = 'INSERT INTO orders (user_id, product_id, quantity, total, status) VALUES (:user_id, :product_id, :quantity, :total, \"pending\")';\n    $stmt = $conn->prepare($sql);\n    $stmt->bindParam(':user_id', $order['user_id']);\n    $stmt->bindParam(':product_id', $order['product_id']);\n    $stmt->bindParam(':quantity', $order['quantity']);\n    $stmt->bindParam(':total', $order['total']);\n    $stmt->execute();\n}\n\nfunction process_payment($id) {\n    global $conn;\n    $stmt = $conn->prepare('UPDATE orders SET status = \"paid\" WHERE id = :id');\n    $stmt->bindParam(':id', $id);\n    $stmt->execute();\n}\n?>\n```\n\n**index.php**\n```php\n<?php\nrequire_once 'config.php';\n\nif (isset($_POST['add_to_cart'])) {\n    addOrder($_SESSION['user_id'], $_POST['product_id'], $_POST['quantity']);\n}\n\nif (isset($_GET['process_payment'])) {\n    process_payment($_GET['id']);\n}\n\n$products = getProducts();\n\n?>\n\n<html>\n<head>\n    <title>Shop</title>\n</head>\n<body>\n    <h1>Shop</h1>\n\n    <?php foreach ($products as $product): ?>\n        <div>\n            <h2><?php echo $product['name']; ?></h2>\n            <p>Price: <?php echo $product['price']; ?></p>\n            <form action=\"\" method=\"post\">\n                <input type=\"hidden\" name=\"product_id\" value=\"<?php echo $product['id']; ?>\">\n                <input type=\"number\" name=\"quantity\" min=\"1\">\n                <button type=\"submit\" name=\"add_to_cart\">Add to cart</button>\n            </form>\n        </div>\n    <?php endforeach; ?>\n\n    <a href=\"?process_payment=<?php echo $_SESSION['order_id']; ?>\">Process payment</a>\n\n    <?php if (isset($_SESSION['order_id'])): ?>\n        <h2>Order summary:</h2>\n        <?php\n            $stmt = $conn->prepare('SELECT * FROM orders WHERE id = :id');\n            $stmt->bindParam(':id', $_SESSION['order_id']);\n            $stmt->execute();\n            $order = $stmt->fetch();\n\n            echo \"Product: \" . get_product_name($order['product_id']) . \", Quantity: \" . $order['quantity'] . \", Total: $\" . $order['total'];\n        ?>\n    <?php endif; ?>\n\n</body>\n</html>\n```\nThis example creates a simple shop with the following functionality:\n\n1. User can add products to their cart.\n2. When user clicks on \"Process payment\", it sends them to a page where they can process the payment for their order.\n\nPlease note that this is just an example and you will need to modify it according to your specific requirements. Also, remember to replace `'localhost'`, `'shop'`, `'root'` with your own database credentials in `config.php`.", "code_blocks": [null, "```php\n<?php\n$host = 'localhost';\n$dbname = 'shop';\n$username = 'root';\n$password = '';\n\ntry {\n    $conn = new PDO(\"mysql:host=$host;dbname=$dbname\", $username, $password);\n} catch (PDOException $e) {\n    echo \"Connection failed: \" . $e->getMessage();\n}\n\nfunction getProducts() {\n    global $conn;\n    $stmt = $conn->prepare('SELECT * FROM products');\n    $stmt->execute();\n    return $stmt->fetchAll();\n}\n\nfunction addOrder($user_id, $product_id, $quantity) {\n    global $conn;\n    $total = get_product_price($product_id);\n    $order = array(\n        'user_id' => $user_id,\n        'product_id' => $product_id,\n        'quantity' => $quantity,\n        'total' => $total\n    );\n    insert_order($order);\n}\n\nfunction get_product_price($id) {\n    global $conn;\n    $stmt = $conn->prepare('SELECT price FROM products WHERE id = :id');\n    $stmt->bindParam(':id', $id);\n    $stmt->execute();\n    return $stmt->fetch()['price'];\n}\n\nfunction insert_order($order) {\n    global $conn;\n    $sql = 'INSERT INTO orders (user_id, product_id, quantity, total, status) VALUES (:user_id, :product_id, :quantity, :total, \"pending\")';\n    $stmt = $conn->prepare($sql);\n    $stmt->bindParam(':user_id', $order['user_id']);\n    $stmt->bindParam(':product_id', $order['product_id']);\n    $stmt->bindParam(':quantity', $order['quantity']);\n    $stmt->bindParam(':total', $order['total']);\n    $stmt->execute();\n}\n\nfunction process_payment($id) {\n    global $conn;\n    $stmt = $conn->prepare('UPDATE orders SET status = \"paid\" WHERE id = :id');\n    $stmt->bindParam(':id', $id);\n    $stmt->execute();\n}\n?>\n```", "```php\n<?php\nrequire_once 'config.php';\n\nif (isset($_POST['add_to_cart'])) {\n    addOrder($_SESSION['user_id'], $_POST['product_id'], $_POST['quantity']);\n}\n\nif (isset($_GET['process_payment'])) {\n    process_payment($_GET['id']);\n}\n\n$products = getProducts();\n\n?>\n\n<html>\n<head>\n    <title>Shop</title>\n</head>\n<body>\n    <h1>Shop</h1>\n\n    <?php foreach ($products as $product): ?>\n        <div>\n            <h2><?php echo $product['name']; ?></h2>\n            <p>Price: <?php echo $product['price']; ?></p>\n            <form action=\"\" method=\"post\">\n                <input type=\"hidden\" name=\"product_id\" value=\"<?php echo $product['id']; ?>\">\n                <input type=\"number\" name=\"quantity\" min=\"1\">\n                <button type=\"submit\" name=\"add_to_cart\">Add to cart</button>\n            </form>\n        </div>\n    <?php endforeach; ?>\n\n    <a href=\"?process_payment=<?php echo $_SESSION['order_id']; ?>\">Process payment</a>\n\n    <?php if (isset($_SESSION['order_id'])): ?>\n        <h2>Order summary:</h2>\n        <?php\n            $stmt = $conn->prepare('SELECT * FROM orders WHERE id = :id');\n            $stmt->bindParam(':id', $_SESSION['order_id']);\n            $stmt->execute();\n            $order = $stmt->fetch();\n\n            echo \"Product: \" . get_product_name($order['product_id']) . \", Quantity: \" . $order['quantity'] . \", Total: $\" . $order['total'];\n        ?>\n    <?php endif; ?>\n\n</body>\n</html>\n```"]}
