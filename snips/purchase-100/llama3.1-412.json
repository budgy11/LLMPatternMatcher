{"prompt": "Create a purchase functionality using php", "llm_output": "**Purchase Functionality in PHP**\n=====================================\n\nThis is an example of a basic purchase functionality implemented in PHP. It includes features such as adding products to cart, viewing cart contents, and making a payment.\n\n**Database Schema**\n--------------------\n\nFor this example, we'll assume the following database schema:\n\n```sql\nCREATE TABLE products (\n  id INT PRIMARY KEY,\n  name VARCHAR(255),\n  price DECIMAL(10,2)\n);\n\nCREATE TABLE carts (\n  id INT PRIMARY KEY,\n  user_id INT,\n  total DECIMAL(10,2)\n);\n\nCREATE TABLE cart_items (\n  id INT PRIMARY KEY,\n  cart_id INT,\n  product_id INT,\n  quantity INT\n);\n```\n\n**PHP Code**\n-------------\n\n### `config.php`\n\n```php\n<?php\n\n// Database connection settings\n$host = 'localhost';\n$username = 'root';\n$password = '';\n$dbname = 'store';\n\ntry {\n    $conn = new PDO(\"mysql:host=$host;dbname=$dbname\", $username, $password);\n} catch(PDOException $e) {\n    die(\"ERROR: Could not connect. \" . $e->getMessage());\n}\n\n?>\n```\n\n### `product.php`\n\n```php\n<?php\n\n// Display a list of products\nfunction displayProducts() {\n  global $conn;\n\n  $query = \"SELECT * FROM products\";\n  $result = $conn->prepare($query);\n  $result->execute();\n\n  while ($row = $result->fetch()) {\n    echo \"<p>\" . $row['name'] . \" - $\" . number_format($row['price'], 2) . \"</p>\";\n  }\n}\n\n?>\n```\n\n### `cart.php`\n\n```php\n<?php\n\n// Display the cart contents\nfunction displayCart() {\n  global $conn;\n  session_start();\n\n  if (isset($_SESSION['cart_id'])) {\n    $query = \"SELECT * FROM cart_items WHERE cart_id = :id\";\n    $result = $conn->prepare($query);\n    $result->bindParam(':id', $_SESSION['cart_id']);\n    $result->execute();\n\n    echo \"<p>Cart Contents:</p>\";\n    while ($row = $result->fetch()) {\n      echo \"<p>\" . $row['product_name'] . \" x \" . $row['quantity'] . \"</p>\";\n    }\n\n    // Calculate the total cost\n    $query = \"SELECT * FROM cart_items WHERE cart_id = :id\";\n    $result = $conn->prepare($query);\n    $result->bindParam(':id', $_SESSION['cart_id']);\n    $result->execute();\n\n    $total = 0;\n    while ($row = $result->fetch()) {\n      $total += $row['quantity'] * $row['price'];\n    }\n\n    echo \"<p>Total: $\" . number_format($total, 2) . \"</p>\";\n  } else {\n    echo \"Your cart is empty.\";\n  }\n}\n\n// Add a product to the cart\nfunction addProductToCart() {\n  global $conn;\n  session_start();\n\n  if (isset($_POST['product_id'])) {\n    $query = \"SELECT * FROM products WHERE id = :id\";\n    $result = $conn->prepare($query);\n    $result->bindParam(':id', $_POST['product_id']);\n    $result->execute();\n\n    $row = $result->fetch();\n    $product_name = $row['name'];\n    $price = $row['price'];\n\n    // Check if the product is already in the cart\n    $query = \"SELECT * FROM cart_items WHERE product_id = :id AND cart_id = :cart_id\";\n    $result = $conn->prepare($query);\n    $result->bindParam(':id', $_POST['product_id']);\n    $result->bindParam(':cart_id', $_SESSION['cart_id']);\n    $result->execute();\n\n    if ($result->rowCount() > 0) {\n      // Update the quantity\n      $query = \"UPDATE cart_items SET quantity = quantity + :quantity WHERE product_id = :id AND cart_id = :cart_id\";\n      $result = $conn->prepare($query);\n      $result->bindParam(':id', $_POST['product_id']);\n      $result->bindParam(':quantity', $_POST['quantity']);\n      $result->bindParam(':cart_id', $_SESSION['cart_id']);\n      $result->execute();\n    } else {\n      // Insert a new cart item\n      $query = \"INSERT INTO cart_items (cart_id, product_id, quantity) VALUES (:id, :product_id, :quantity)\";\n      $result = $conn->prepare($query);\n      $result->bindParam(':id', $_SESSION['cart_id']);\n      $result->bindParam(':product_id', $_POST['product_id']);\n      $result->bindParam(':quantity', $_POST['quantity']);\n      $result->execute();\n    }\n\n    header(\"Location: cart.php\");\n  }\n}\n\n?>\n```\n\n### `payment.php`\n\n```php\n<?php\n\n// Process the payment\nfunction processPayment() {\n  global $conn;\n  session_start();\n\n  // Check if the user has a cart\n  if (isset($_SESSION['cart_id'])) {\n    // Get the total cost of the cart\n    $query = \"SELECT * FROM cart_items WHERE cart_id = :id\";\n    $result = $conn->prepare($query);\n    $result->bindParam(':id', $_SESSION['cart_id']);\n    $result->execute();\n\n    $total = 0;\n    while ($row = $result->fetch()) {\n      $total += $row['quantity'] * $row['price'];\n    }\n\n    // Process the payment\n    // (Insert payment processing code here)\n\n    echo \"Payment processed successfully!\";\n  } else {\n    echo \"Your cart is empty.\";\n  }\n}\n\n?>\n```\n\n**Example Usage**\n-----------------\n\n1. Create a new page (`index.php`) and include the `config.php` file.\n2. Use the `displayProducts()` function to display a list of products.\n3. When a user clicks on a product, use an AJAX request to call the `addProductToCart()` function.\n4. Once a product is added to the cart, redirect the user to the `cart.php` page.\n5. On the `cart.php` page, use the `displayCart()` function to display the contents of the cart and calculate the total cost.\n6. When the user clicks on the \"Checkout\" button, call the `processPayment()` function.\n\nNote: This is a basic example and you should modify it to fit your specific needs. Additionally, this code does not handle errors or security concerns, so make sure to add proper error handling and security measures before deploying it in a production environment.", "code_blocks": [null, "```php\n<?php\n\n// Database connection settings\n$host = 'localhost';\n$username = 'root';\n$password = '';\n$dbname = 'store';\n\ntry {\n    $conn = new PDO(\"mysql:host=$host;dbname=$dbname\", $username, $password);\n} catch(PDOException $e) {\n    die(\"ERROR: Could not connect. \" . $e->getMessage());\n}\n\n?>\n```", "```php\n<?php\n\n// Display a list of products\nfunction displayProducts() {\n  global $conn;\n\n  $query = \"SELECT * FROM products\";\n  $result = $conn->prepare($query);\n  $result->execute();\n\n  while ($row = $result->fetch()) {\n    echo \"<p>\" . $row['name'] . \" - $\" . number_format($row['price'], 2) . \"</p>\";\n  }\n}\n\n?>\n```", "```php\n<?php\n\n// Display the cart contents\nfunction displayCart() {\n  global $conn;\n  session_start();\n\n  if (isset($_SESSION['cart_id'])) {\n    $query = \"SELECT * FROM cart_items WHERE cart_id = :id\";\n    $result = $conn->prepare($query);\n    $result->bindParam(':id', $_SESSION['cart_id']);\n    $result->execute();\n\n    echo \"<p>Cart Contents:</p>\";\n    while ($row = $result->fetch()) {\n      echo \"<p>\" . $row['product_name'] . \" x \" . $row['quantity'] . \"</p>\";\n    }\n\n    // Calculate the total cost\n    $query = \"SELECT * FROM cart_items WHERE cart_id = :id\";\n    $result = $conn->prepare($query);\n    $result->bindParam(':id', $_SESSION['cart_id']);\n    $result->execute();\n\n    $total = 0;\n    while ($row = $result->fetch()) {\n      $total += $row['quantity'] * $row['price'];\n    }\n\n    echo \"<p>Total: $\" . number_format($total, 2) . \"</p>\";\n  } else {\n    echo \"Your cart is empty.\";\n  }\n}\n\n// Add a product to the cart\nfunction addProductToCart() {\n  global $conn;\n  session_start();\n\n  if (isset($_POST['product_id'])) {\n    $query = \"SELECT * FROM products WHERE id = :id\";\n    $result = $conn->prepare($query);\n    $result->bindParam(':id', $_POST['product_id']);\n    $result->execute();\n\n    $row = $result->fetch();\n    $product_name = $row['name'];\n    $price = $row['price'];\n\n    // Check if the product is already in the cart\n    $query = \"SELECT * FROM cart_items WHERE product_id = :id AND cart_id = :cart_id\";\n    $result = $conn->prepare($query);\n    $result->bindParam(':id', $_POST['product_id']);\n    $result->bindParam(':cart_id', $_SESSION['cart_id']);\n    $result->execute();\n\n    if ($result->rowCount() > 0) {\n      // Update the quantity\n      $query = \"UPDATE cart_items SET quantity = quantity + :quantity WHERE product_id = :id AND cart_id = :cart_id\";\n      $result = $conn->prepare($query);\n      $result->bindParam(':id', $_POST['product_id']);\n      $result->bindParam(':quantity', $_POST['quantity']);\n      $result->bindParam(':cart_id', $_SESSION['cart_id']);\n      $result->execute();\n    } else {\n      // Insert a new cart item\n      $query = \"INSERT INTO cart_items (cart_id, product_id, quantity) VALUES (:id, :product_id, :quantity)\";\n      $result = $conn->prepare($query);\n      $result->bindParam(':id', $_SESSION['cart_id']);\n      $result->bindParam(':product_id', $_POST['product_id']);\n      $result->bindParam(':quantity', $_POST['quantity']);\n      $result->execute();\n    }\n\n    header(\"Location: cart.php\");\n  }\n}\n\n?>\n```", "```php\n<?php\n\n// Process the payment\nfunction processPayment() {\n  global $conn;\n  session_start();\n\n  // Check if the user has a cart\n  if (isset($_SESSION['cart_id'])) {\n    // Get the total cost of the cart\n    $query = \"SELECT * FROM cart_items WHERE cart_id = :id\";\n    $result = $conn->prepare($query);\n    $result->bindParam(':id', $_SESSION['cart_id']);\n    $result->execute();\n\n    $total = 0;\n    while ($row = $result->fetch()) {\n      $total += $row['quantity'] * $row['price'];\n    }\n\n    // Process the payment\n    // (Insert payment processing code here)\n\n    echo \"Payment processed successfully!\";\n  } else {\n    echo \"Your cart is empty.\";\n  }\n}\n\n?>\n```"]}
