{"prompt": "Create a purchase functionality using php", "llm_output": "Here's an example of a basic purchase functionality using PHP. This example assumes you have the following:\n\n* A MySQL database with a table `orders` and another table `products`.\n* The product table has fields: `id`, `name`, `price`.\n* The order table has fields: `id`, `product_id`, `customer_name`, `order_date`.\n\n```php\n// Database connection details\n$host = 'localhost';\n$dbname = 'store';\n$username = 'root';\n$password = '';\n\n// Create a database connection\n$conn = new mysqli($host, $username, $password, $dbname);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Function to add product to cart\nfunction addToCart() {\n    global $conn;\n\n    // Get the user's selected products and quantities\n    if (isset($_POST['product_id'])) {\n        foreach ($_POST['product_id'] as $key => $value) {\n            // Insert into order table for each product\n            $sql = \"INSERT INTO orders (customer_name, product_id, quantity)\n                    VALUES ('\".$_POST['customer_name'].\"', '\".$_POST['product_id'][$key].\"','\".$_POST['quantity'][$key].\"', NOW())\";\n            \n            if ($conn->query($sql) === TRUE) {\n                echo 'Product added to cart!';\n            } else {\n                echo \"Error adding product: \" . $conn->error;\n            }\n        }\n    }\n}\n\n// Function to checkout\nfunction checkout() {\n    global $conn;\n\n    // Delete the products from the order table\n    $sql = \"DELETE FROM orders WHERE customer_name = '\".$_POST['customer_name'].\"' AND order_date > DATE_SUB(NOW(), INTERVAL 1 DAY)\";\n    \n    if ($conn->query($sql) === TRUE) {\n        echo 'Order successful!';\n    } else {\n        echo \"Error: \" . $conn->error;\n    }\n}\n\n// Add product to cart\nif (isset($_POST['addToCart'])) {\n    addToCart();\n} elseif (isset($_POST['checkout'])) {\n    checkout();\n}\n\n// Close database connection\n$conn->close();\n```\n\n**Please note**: This example is basic and does not include any kind of validation or security checks. For a real-world application, you should consider using prepared statements to prevent SQL injection.\n\n```html\n<!-- HTML form -->\n<form action=\"purchase.php\" method=\"post\">\n    <input type=\"hidden\" name=\"addToCart\" value=\"1\">\n\n    <!-- Table for products -->\n    <table>\n        <tr>\n            <th>Product Name</th>\n            <th>Price</th>\n            <th>Quantity</th>\n        </tr>\n        \n        <?php\n        // Retrieve all products from database and display them in the form\n        $sql = \"SELECT * FROM products\";\n        $result = $conn->query($sql);\n        \n        while ($row = $result->fetch_assoc()) {\n            echo \"<tr>\";\n                echo \"<td>\".$row['name'].\"</td>\";\n                echo \"<td>\".$row['price'].\"</td>\";\n                echo \"<td><input type='number' name='quantity[]'></td>\";\n            echo \"</tr>\";\n        }\n        ?>\n        \n    </table>\n\n    <!-- Customer details -->\n    <label>Customer Name:</label>\n    <input type=\"text\" name=\"customer_name\">\n    \n    <input type=\"submit\" value=\"Add to Cart\">\n\n</form>\n\n<!-- HTML form for checkout -->\n<form action=\"purchase.php\" method=\"post\">\n    <input type=\"hidden\" name=\"checkout\" value=\"1\">\n\n    <!-- Table for products in cart -->\n    <table>\n        <tr>\n            <th>Product Name</th>\n            <th>Quantity</th>\n        </tr>\n        \n        <?php\n        // Retrieve all products from order table and display them in the form\n        $sql = \"SELECT * FROM orders WHERE customer_name='\".$_POST['customer_name'].\"'\";\n        $result = $conn->query($sql);\n        \n        while ($row = $result->fetch_assoc()) {\n            echo \"<tr>\";\n                echo \"<td>\".$row['name'].\"</td>\";\n                echo \"<td>\".$row['quantity'].\"</td>\";\n            echo \"</tr>\";\n        }\n        ?>\n        \n    </table>\n\n    <input type=\"submit\" value=\"Checkout\">\n\n</form>\n```\n\nThis example includes two forms: one for adding products to cart, and another for checking out. The `addToCart()` function adds the selected products from the first form into the order table. The `checkout()` function deletes the products from the order table after checkout is successful.\n\nPlease note that this example does not include any kind of authentication or authorization mechanism. For a real-world application, you should consider using sessions or other mechanisms to authenticate and authorize users before allowing them to purchase products.", "code_blocks": ["```php\n// Database connection details\n$host = 'localhost';\n$dbname = 'store';\n$username = 'root';\n$password = '';\n\n// Create a database connection\n$conn = new mysqli($host, $username, $password, $dbname);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Function to add product to cart\nfunction addToCart() {\n    global $conn;\n\n    // Get the user's selected products and quantities\n    if (isset($_POST['product_id'])) {\n        foreach ($_POST['product_id'] as $key => $value) {\n            // Insert into order table for each product\n            $sql = \"INSERT INTO orders (customer_name, product_id, quantity)\n                    VALUES ('\".$_POST['customer_name'].\"', '\".$_POST['product_id'][$key].\"','\".$_POST['quantity'][$key].\"', NOW())\";\n            \n            if ($conn->query($sql) === TRUE) {\n                echo 'Product added to cart!';\n            } else {\n                echo \"Error adding product: \" . $conn->error;\n            }\n        }\n    }\n}\n\n// Function to checkout\nfunction checkout() {\n    global $conn;\n\n    // Delete the products from the order table\n    $sql = \"DELETE FROM orders WHERE customer_name = '\".$_POST['customer_name'].\"' AND order_date > DATE_SUB(NOW(), INTERVAL 1 DAY)\";\n    \n    if ($conn->query($sql) === TRUE) {\n        echo 'Order successful!';\n    } else {\n        echo \"Error: \" . $conn->error;\n    }\n}\n\n// Add product to cart\nif (isset($_POST['addToCart'])) {\n    addToCart();\n} elseif (isset($_POST['checkout'])) {\n    checkout();\n}\n\n// Close database connection\n$conn->close();\n```", null]}
