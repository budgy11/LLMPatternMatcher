{"prompt": "Create a purchase functionality using php", "llm_output": "<think>\nOkay, so the user wants to create a purchase functionality using PHP. I need to figure out how to approach this.\n\nFirst, I should outline what a basic purchase system entails. It probably includes displaying products, allowing users to add them to a cart, and then processing the checkout.\n\nI'll start by setting up a database to store product information. That makes sense because we need to retrieve and display products dynamically. Using MySQL seems appropriate since it's widely used and integrates well with PHP.\n\nNext, I'll create a table called 'products' with columns for id, name, price, description, and image. This will hold all the necessary details about each product.\n\nThen, I need an HTML page to display these products. I'll use PHP to connect to the database and fetch the product data. Looping through each product, I can generate HTML elements like cards or rows to show them on the page. Each product should have a \"Buy Now\" button that links to the checkout process.\n\nNow, for the cart functionality. Since this is a basic example, using session variables makes sense because they persist across pages and don't require a database. When a user clicks \"Buy Now,\" it triggers an event that adds the product to the cart. I'll need a PHP script that handles adding items to the session array.\n\nWait, but in my initial thought, I included a 'cart.php' file where products are added. However, using AJAX might be better for a smoother experience without reloading the page. But since this is a basic example, maybe keeping it simple with form submissions or direct links is okay.\n\nIn the checkout process, I'll display the items in the cart and let the user input their shipping details. This requires another PHP script that calculates the total price by iterating through the cart items and summing up the prices.\n\nAfter collecting the payment information, processing it involves simulating a transaction since we're not integrating actual payment gateways here. I'll check if the payment is successful, update the order status, and clear the cart. Sending a confirmation email would be a nice touch, but for simplicity, maybe just displaying a success message on the page.\n\nError handling is crucial. I should include checks for empty fields in the checkout form and ensure that all required information is provided before processing the payment.\n\nI also need to consider security aspects, like preventing SQL injection with prepared statements or using mysqli_real_escape_string. Since this is a basic example, I might not implement everything securely, but it's good to mention these considerations.\n\nFinally, testing each part step by step: displaying products, adding to cart, viewing cart contents, entering shipping info, and seeing the confirmation message. Making sure all parts work together smoothly without any bugs.\n\nI think that covers the main points. I should structure the code into separate files for better organization: index.php for displaying products, checkout.php for processing orders, and functions.php for including helper functions like database connections.\n\nWait, in the initial answer, I included a 'cart.php' file but didn't elaborate much on how it works. Maybe I should explain that when a user clicks \"Buy Now,\" they're redirected to cart.php where the product is added using session variables. Then, from there, they can proceed to checkout.\n\nAlso, in the checkout process, after submitting the form, the payment_processing.php script handles everything: checking if the cart isn't empty, validating the payment details, simulating a transaction, and updating the order status.\n\nI should make sure that all database interactions use proper escaping or prepared statements to prevent SQL injection. For example, using mysqli_real_escape_string when inserting product data into the database.\n\nAnother thing is handling cases where the cart might be empty. We need to ensure that users can't proceed to checkout without any items in their cart.\n\nI think I've covered all the necessary steps and considerations for creating a basic purchase functionality using PHP. Now, I'll present this as a step-by-step explanation with code examples.\n</think>\n\nTo create a purchase functionality using PHP, follow these steps:\n\n### 1. Set Up the Database\nFirst, create a database to store product information.\n\n```sql\nCREATE DATABASE purchase_system;\nUSE purchase_system;\n\nCREATE TABLE products (\n    id INT AUTO_INCREMENT PRIMARY KEY,\n    name VARCHAR(255) NOT NULL,\n    price DECIMAL(10, 2) NOT NULL,\n    description TEXT,\n    image VARCHAR(255)\n);\n```\n\n### 2. Create Product Display Page\nCreate an `index.php` file to display products.\n\n```php\n<?php\nsession_start();\ninclude('functions.php');\n\n$products = fetchAllProducts();\n\nif (isset($_GET['buy'])) {\n    $productId = $_GET['buy'];\n    addProductToCart($productId);\n}\n?>\n\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Product Store</title>\n    <!-- Include Bootstrap CSS for styling -->\n    <link rel=\"stylesheet\" href=\"https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css\">\n</head>\n<body>\n    <div class=\"container mt-5\">\n        <h1>Welcome to Product Store</h1>\n        \n        <?php if (!empty($products)) : ?>\n            <div class=\"row\">\n                <?php foreach ($products as $product) : ?>\n                    <div class=\"col-md-3 mb-4\">\n                        <div class=\"card\">\n                            <img src=\"<?php echo $product['image']; ?>\" class=\"card-img-top\" alt=\"<?php echo $product['name']; ?>\">\n                            <div class=\"card-body\">\n                                <h5 class=\"card-title\"><?php echo $product['name']; ?></h5>\n                                <p class=\"card-text\">$<?php echo number_format($product['price'], 2); ?></p>\n                                <a href=\"?buy=<?php echo $product['id']; ?>\" class=\"btn btn-primary\">Buy Now</a>\n                            </div>\n                        </div>\n                    </div>\n                <?php endforeach; ?>\n            </div>\n        <?php else : ?>\n            <p>No products available.</p>\n        <?php endif; ?>\n    </div>\n\n    <!-- Include Bootstrap JS and dependencies -->\n    <script src=\"https://code.jquery.com/jquery-3.5.1.slim.min.js\"></script>\n    <script src=\"https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js\"></script>\n    <script src=\"https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js\"></script>\n</body>\n</html>\n```\n\n### 3. Implement Cart Functionality\nCreate a `cart.php` to manage the shopping cart.\n\n```php\n<?php\nsession_start();\ninclude('functions.php');\n\nif (!empty($_SESSION['cart'])) :\n    $cartItems = $_SESSION['cart'];\nelse :\n    $cartItems = array();\nendif;\n?>\n\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Shopping Cart</title>\n    <link rel=\"stylesheet\" href=\"https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css\">\n</head>\n<body>\n    <div class=\"container mt-5\">\n        <?php if (!empty($cartItems)) : ?>\n            <h1>Your Shopping Cart</h1>\n            <table class=\"table table-striped\">\n                <thead>\n                    <tr>\n                        <th>Product Name</th>\n                        <th>Price</th>\n                        <th>Action</th>\n                    </tr>\n                </thead>\n                <tbody>\n                    <?php foreach ($cartItems as $productId => $quantity) :\n                        $product = getProductById($productId);\n                    ?>\n                        <tr>\n                            <td><?php echo $product['name']; ?></td>\n                            <td>$<?php echo number_format($product['price'], 2); ?></td>\n                            <td><a href=\"remove_from_cart.php?id=<?php echo $productId; ?>\">Remove</a></td>\n                        </tr>\n                    <?php endforeach; ?>\n                </tbody>\n            </table>\n            <form action=\"checkout.php\" method=\"post\">\n                <div class=\"form-group\">\n                    <label for=\"email\">Email Address:</label>\n                    <input type=\"email\" class=\"form-control\" id=\"email\" name=\"email\" required>\n                </div>\n                <button type=\"submit\" class=\"btn btn-primary\">Proceed to Checkout</button>\n            </form>\n        <?php else : ?>\n            <p>Your cart is empty.</p>\n            <a href=\"index.php\" class=\"btn btn-secondary\">Continue Shopping</a>\n        <?php endif; ?>\n    </div>\n\n    <script src=\"https://code.jquery.com/jquery-3.5.1.slim.min.js\"></script>\n    <script src=\"https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js\"></script>\n    <script src=\"https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js\"></script>\n</body>\n</html>\n```\n\n### 4. Create Checkout Page\nCreate a `checkout.php` to process the order.\n\n```php\n<?php\nsession_start();\ninclude('functions.php');\n\nif (!empty($_SESSION['cart']) && isset($_POST['email'])) :\n    $totalPrice = calculateTotalPrice();\n    $email = $_POST['email'];\n    \n    // Process payment (simulated)\n    if (processPayment($totalPrice)) :\n        $orderId = createOrder($email, $totalPrice);\n        \n        // Clear cart\n        unset($_SESSION['cart']);\n        \n        // Redirect to confirmation page\n        header(\"Location: order_confirmation.php?id=$orderId\");\n        exit();\n    else :\n        echo \"Payment failed. Please try again.\";\n    endif;\nendif;\n?>\n\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Checkout</title>\n    <link rel=\"stylesheet\" href=\"https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css\">\n</head>\n<body>\n    <?php if (empty($_SESSION['cart'])) : ?>\n        <div class=\"container mt-5\">\n            <p>Your cart is empty.</p>\n            <a href=\"index.php\" class=\"btn btn-secondary\">Continue Shopping</a>\n        </div>\n    <?php else : ?>\n        <form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\">\n            <div class=\"container mt-5\">\n                <h1>Checkout</h1>\n                \n                <div class=\"form-group\">\n                    <label for=\"name\">Name:</label>\n                    <input type=\"text\" class=\"form-control\" id=\"name\" name=\"name\" required>\n                </div>\n\n                <div class=\"form-group\">\n                    <label for=\"email\">Email:</label>\n                    <input type=\"email\" class=\"form-control\" id=\"email\" name=\"email\" required>\n                </div>\n\n                <div class=\"form-group\">\n                    <label for=\"address\">Address:</label>\n                    <input type=\"text\" class=\"form-control\" id=\"address\" name=\"address\" required>\n                </div>\n\n                <?php\n                $cartItems = $_SESSION['cart'];\n                $totalPrice = calculateTotalPrice();\n                ?>\n\n                <div class=\"row mt-4\">\n                    <div class=\"col-md-6\">\n                        <h3>Total Price: $<?php echo number_format($totalPrice, 2); ?></h3>\n                    </div>\n                </div>\n\n                <button type=\"submit\" class=\"btn btn-primary\">Place Order</button>\n            </div>\n        </form>\n    <?php endif; ?>\n\n    <script src=\"https://code.jquery.com/jquery-3.5.1.slim.min.js\"></script>\n    <script src=\"https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js\"></script>\n    <script src=\"https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js\"></script>\n</body>\n</html>\n```\n\n### 5. Implement Helper Functions\nCreate a `functions.php` file with necessary functions.\n\n```php\n<?php\nfunction connectDB() {\n    $host = \"localhost\";\n    $user = \"root\";\n    $password = \"\";\n    $db_name = \"purchase_system\";\n    \n    $conn = mysqli_connect($host, $user, $password, $db_name);\n    if (!$conn) {\n        die(\"Connection failed: \" . mysqli_connect_error());\n    }\n    return $conn;\n}\n\nfunction fetchAllProducts() {\n    $conn = connectDB();\n    $sql = \"SELECT * FROM products\";\n    $result = mysqli_query($conn, $sql);\n    \n    $products = array();\n    if (mysqli_num_rows($result) > 0) {\n        while ($row = mysqli_fetch_assoc($result)) {\n            $products[] = $row;\n        }\n    }\n    \n    mysqli_close($conn);\n    return $products;\n}\n\nfunction addProductToCart($productId) {\n    session_start();\n    $_SESSION['cart'][$productId] = isset($_SESSION['cart'][$productId]) ? \n                                   $_SESSION['cart'][$productId] + 1 : 1;\n}\n\nfunction getProductById($productId) {\n    $conn = connectDB();\n    $sql = \"SELECT * FROM products WHERE id = ?\";\n    $stmt = mysqli_prepare($conn, $sql);\n    mysqli_stmt_bind_param($stmt, \"i\", $productId);\n    mysqli_stmt_execute($stmt);\n    $result = mysqli_stmt_get_result($stmt);\n    \n    $product = array();\n    if ($row = mysqli_fetch_assoc($result)) {\n        $product = $row;\n    }\n    \n    mysqli_close($conn);\n    return $product;\n}\n\nfunction calculateTotalPrice() {\n    session_start();\n    $cartItems = $_SESSION['cart'];\n    $totalPrice = 0;\n    \n    foreach ($cartItems as $productId => $quantity) {\n        $product = getProductById($productId);\n        $totalPrice += $product['price'] * $quantity;\n    }\n    \n    return $totalPrice;\n}\n\nfunction processPayment($amount) {\n    // Simulate payment processing\n    return true; // Assume payment is successful\n}\n\nfunction createOrder($email, $totalAmount) {\n    $conn = connectDB();\n    $orderDate = date('Y-m-d H:i:s');\n    \n    $sql = \"INSERT INTO orders (email, total_amount, order_date) \n            VALUES (?, ?, ?)\";\n    $stmt = mysqli_prepare($conn, $sql);\n    mysqli_stmt_bind_param($stmt, \"sds\", $email, $totalAmount, $orderDate);\n    \n    if (mysqli_stmt_execute($stmt)) {\n        $orderId = mysqli_insert_id($conn);\n        \n        // Insert order details\n        foreach ($_SESSION['cart'] as $productId => $quantity) {\n            $productPrice = getProductById($productId)['price'];\n            $sqlDetails = \"INSERT INTO order_details \n                          (order_id, product_id, quantity, price) \n                          VALUES (?, ?, ?, ?)\";\n            $stmtDetails = mysqli_prepare($conn, $sqlDetails);\n            mysqli_stmt_bind_param($stmtDetails, \"iidi\", $orderId, $productId, $quantity, $productPrice);\n            mysqli_stmt_execute($stmtDetails);\n        }\n        \n        return $orderId;\n    } else {\n        return false;\n    }\n}\n\nfunction createOrderTable() {\n    $conn = connectDB();\n    $sql = \"CREATE TABLE orders (\n                id INT AUTO_INCREMENT PRIMARY KEY,\n                email VARCHAR(255) NOT NULL,\n                total_amount DECIMAL(10, 2) NOT NULL,\n                order_date DATETIME\n            )\";\n    \n    if (mysqli_query($conn, $sql)) {\n        $sqlDetails = \"CREATE TABLE order_details (\n                        id INT AUTO_INCREMENT PRIMARY KEY,\n                        order_id INT NOT NULL,\n                        product_id INT NOT NULL,\n                        quantity INT NOT NULL,\n                        price DECIMAL(10, 2) NOT NULL\n                      )\";\n        mysqli_query($conn, $sqlDetails);\n    }\n    \n    mysqli_close($conn);\n}\n\n// Create the necessary tables if they don't exist\ncreateOrderTable();\n?>\n```\n\n### 6. Optional: Order Confirmation Page\nCreate an `order_confirmation.php` to display order confirmation.\n\n```php\n<?php\nsession_start();\ninclude('functions.php');\n\n$orderId = isset($_GET['id']) ? $_GET['id'] : '';\n?>\n\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Order Confirmation</title>\n    <link rel=\"stylesheet\" href=\"https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css\">\n</head>\n<body>\n    <div class=\"container mt-5\">\n        <?php if ($orderId) : ?>\n            <h1>Thank you for your order!</h1>\n            <p>Your order has been successfully processed.</p>\n            <p>Order ID: <?php echo $orderId; ?></p>\n            <a href=\"index.php\" class=\"btn btn-primary\">Continue Shopping</a>\n        <?php else : ?>\n            <p>There was an error processing your order. Please try again.</p>\n        <?php endif; ?>\n    </div>\n\n    <script src=\"https://code.jquery.com/jquery-3.5.1.slim.min.js\"></script>\n    <script src=\"https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js\"></script>\n    <script src=\"https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js\"></script>\n</body>\n</html>\n```\n\n### Notes:\n- **Database Connection**: Ensure your database credentials are correct in `functions.php`.\n- **Security Considerations**: This example is basic and doesn't include security measures like CSRF protection or input validation, which should be added for a production environment.\n- **Payment Integration**: The payment processing is simulated. Replace the `processPayment` function with actual payment gateway integration as needed.\n\nThis setup provides a simple but functional e-commerce system where users can view products, add them to their cart, and complete a checkout process.", "code_blocks": [null, "```php\n<?php\nsession_start();\ninclude('functions.php');\n\n$products = fetchAllProducts();\n\nif (isset($_GET['buy'])) {\n    $productId = $_GET['buy'];\n    addProductToCart($productId);\n}\n?>\n\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Product Store</title>\n    <!-- Include Bootstrap CSS for styling -->\n    <link rel=\"stylesheet\" href=\"https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css\">\n</head>\n<body>\n    <div class=\"container mt-5\">\n        <h1>Welcome to Product Store</h1>\n        \n        <?php if (!empty($products)) : ?>\n            <div class=\"row\">\n                <?php foreach ($products as $product) : ?>\n                    <div class=\"col-md-3 mb-4\">\n                        <div class=\"card\">\n                            <img src=\"<?php echo $product['image']; ?>\" class=\"card-img-top\" alt=\"<?php echo $product['name']; ?>\">\n                            <div class=\"card-body\">\n                                <h5 class=\"card-title\"><?php echo $product['name']; ?></h5>\n                                <p class=\"card-text\">$<?php echo number_format($product['price'], 2); ?></p>\n                                <a href=\"?buy=<?php echo $product['id']; ?>\" class=\"btn btn-primary\">Buy Now</a>\n                            </div>\n                        </div>\n                    </div>\n                <?php endforeach; ?>\n            </div>\n        <?php else : ?>\n            <p>No products available.</p>\n        <?php endif; ?>\n    </div>\n\n    <!-- Include Bootstrap JS and dependencies -->\n    <script src=\"https://code.jquery.com/jquery-3.5.1.slim.min.js\"></script>\n    <script src=\"https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js\"></script>\n    <script src=\"https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js\"></script>\n</body>\n</html>\n```", "```php\n<?php\nsession_start();\ninclude('functions.php');\n\nif (!empty($_SESSION['cart'])) :\n    $cartItems = $_SESSION['cart'];\nelse :\n    $cartItems = array();\nendif;\n?>\n\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Shopping Cart</title>\n    <link rel=\"stylesheet\" href=\"https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css\">\n</head>\n<body>\n    <div class=\"container mt-5\">\n        <?php if (!empty($cartItems)) : ?>\n            <h1>Your Shopping Cart</h1>\n            <table class=\"table table-striped\">\n                <thead>\n                    <tr>\n                        <th>Product Name</th>\n                        <th>Price</th>\n                        <th>Action</th>\n                    </tr>\n                </thead>\n                <tbody>\n                    <?php foreach ($cartItems as $productId => $quantity) :\n                        $product = getProductById($productId);\n                    ?>\n                        <tr>\n                            <td><?php echo $product['name']; ?></td>\n                            <td>$<?php echo number_format($product['price'], 2); ?></td>\n                            <td><a href=\"remove_from_cart.php?id=<?php echo $productId; ?>\">Remove</a></td>\n                        </tr>\n                    <?php endforeach; ?>\n                </tbody>\n            </table>\n            <form action=\"checkout.php\" method=\"post\">\n                <div class=\"form-group\">\n                    <label for=\"email\">Email Address:</label>\n                    <input type=\"email\" class=\"form-control\" id=\"email\" name=\"email\" required>\n                </div>\n                <button type=\"submit\" class=\"btn btn-primary\">Proceed to Checkout</button>\n            </form>\n        <?php else : ?>\n            <p>Your cart is empty.</p>\n            <a href=\"index.php\" class=\"btn btn-secondary\">Continue Shopping</a>\n        <?php endif; ?>\n    </div>\n\n    <script src=\"https://code.jquery.com/jquery-3.5.1.slim.min.js\"></script>\n    <script src=\"https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js\"></script>\n    <script src=\"https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js\"></script>\n</body>\n</html>\n```", "```php\n<?php\nsession_start();\ninclude('functions.php');\n\nif (!empty($_SESSION['cart']) && isset($_POST['email'])) :\n    $totalPrice = calculateTotalPrice();\n    $email = $_POST['email'];\n    \n    // Process payment (simulated)\n    if (processPayment($totalPrice)) :\n        $orderId = createOrder($email, $totalPrice);\n        \n        // Clear cart\n        unset($_SESSION['cart']);\n        \n        // Redirect to confirmation page\n        header(\"Location: order_confirmation.php?id=$orderId\");\n        exit();\n    else :\n        echo \"Payment failed. Please try again.\";\n    endif;\nendif;\n?>\n\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Checkout</title>\n    <link rel=\"stylesheet\" href=\"https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css\">\n</head>\n<body>\n    <?php if (empty($_SESSION['cart'])) : ?>\n        <div class=\"container mt-5\">\n            <p>Your cart is empty.</p>\n            <a href=\"index.php\" class=\"btn btn-secondary\">Continue Shopping</a>\n        </div>\n    <?php else : ?>\n        <form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\">\n            <div class=\"container mt-5\">\n                <h1>Checkout</h1>\n                \n                <div class=\"form-group\">\n                    <label for=\"name\">Name:</label>\n                    <input type=\"text\" class=\"form-control\" id=\"name\" name=\"name\" required>\n                </div>\n\n                <div class=\"form-group\">\n                    <label for=\"email\">Email:</label>\n                    <input type=\"email\" class=\"form-control\" id=\"email\" name=\"email\" required>\n                </div>\n\n                <div class=\"form-group\">\n                    <label for=\"address\">Address:</label>\n                    <input type=\"text\" class=\"form-control\" id=\"address\" name=\"address\" required>\n                </div>\n\n                <?php\n                $cartItems = $_SESSION['cart'];\n                $totalPrice = calculateTotalPrice();\n                ?>\n\n                <div class=\"row mt-4\">\n                    <div class=\"col-md-6\">\n                        <h3>Total Price: $<?php echo number_format($totalPrice, 2); ?></h3>\n                    </div>\n                </div>\n\n                <button type=\"submit\" class=\"btn btn-primary\">Place Order</button>\n            </div>\n        </form>\n    <?php endif; ?>\n\n    <script src=\"https://code.jquery.com/jquery-3.5.1.slim.min.js\"></script>\n    <script src=\"https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js\"></script>\n    <script src=\"https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js\"></script>\n</body>\n</html>\n```", "```php\n<?php\nfunction connectDB() {\n    $host = \"localhost\";\n    $user = \"root\";\n    $password = \"\";\n    $db_name = \"purchase_system\";\n    \n    $conn = mysqli_connect($host, $user, $password, $db_name);\n    if (!$conn) {\n        die(\"Connection failed: \" . mysqli_connect_error());\n    }\n    return $conn;\n}\n\nfunction fetchAllProducts() {\n    $conn = connectDB();\n    $sql = \"SELECT * FROM products\";\n    $result = mysqli_query($conn, $sql);\n    \n    $products = array();\n    if (mysqli_num_rows($result) > 0) {\n        while ($row = mysqli_fetch_assoc($result)) {\n            $products[] = $row;\n        }\n    }\n    \n    mysqli_close($conn);\n    return $products;\n}\n\nfunction addProductToCart($productId) {\n    session_start();\n    $_SESSION['cart'][$productId] = isset($_SESSION['cart'][$productId]) ? \n                                   $_SESSION['cart'][$productId] + 1 : 1;\n}\n\nfunction getProductById($productId) {\n    $conn = connectDB();\n    $sql = \"SELECT * FROM products WHERE id = ?\";\n    $stmt = mysqli_prepare($conn, $sql);\n    mysqli_stmt_bind_param($stmt, \"i\", $productId);\n    mysqli_stmt_execute($stmt);\n    $result = mysqli_stmt_get_result($stmt);\n    \n    $product = array();\n    if ($row = mysqli_fetch_assoc($result)) {\n        $product = $row;\n    }\n    \n    mysqli_close($conn);\n    return $product;\n}\n\nfunction calculateTotalPrice() {\n    session_start();\n    $cartItems = $_SESSION['cart'];\n    $totalPrice = 0;\n    \n    foreach ($cartItems as $productId => $quantity) {\n        $product = getProductById($productId);\n        $totalPrice += $product['price'] * $quantity;\n    }\n    \n    return $totalPrice;\n}\n\nfunction processPayment($amount) {\n    // Simulate payment processing\n    return true; // Assume payment is successful\n}\n\nfunction createOrder($email, $totalAmount) {\n    $conn = connectDB();\n    $orderDate = date('Y-m-d H:i:s');\n    \n    $sql = \"INSERT INTO orders (email, total_amount, order_date) \n            VALUES (?, ?, ?)\";\n    $stmt = mysqli_prepare($conn, $sql);\n    mysqli_stmt_bind_param($stmt, \"sds\", $email, $totalAmount, $orderDate);\n    \n    if (mysqli_stmt_execute($stmt)) {\n        $orderId = mysqli_insert_id($conn);\n        \n        // Insert order details\n        foreach ($_SESSION['cart'] as $productId => $quantity) {\n            $productPrice = getProductById($productId)['price'];\n            $sqlDetails = \"INSERT INTO order_details \n                          (order_id, product_id, quantity, price) \n                          VALUES (?, ?, ?, ?)\";\n            $stmtDetails = mysqli_prepare($conn, $sqlDetails);\n            mysqli_stmt_bind_param($stmtDetails, \"iidi\", $orderId, $productId, $quantity, $productPrice);\n            mysqli_stmt_execute($stmtDetails);\n        }\n        \n        return $orderId;\n    } else {\n        return false;\n    }\n}\n\nfunction createOrderTable() {\n    $conn = connectDB();\n    $sql = \"CREATE TABLE orders (\n                id INT AUTO_INCREMENT PRIMARY KEY,\n                email VARCHAR(255) NOT NULL,\n                total_amount DECIMAL(10, 2) NOT NULL,\n                order_date DATETIME\n            )\";\n    \n    if (mysqli_query($conn, $sql)) {\n        $sqlDetails = \"CREATE TABLE order_details (\n                        id INT AUTO_INCREMENT PRIMARY KEY,\n                        order_id INT NOT NULL,\n                        product_id INT NOT NULL,\n                        quantity INT NOT NULL,\n                        price DECIMAL(10, 2) NOT NULL\n                      )\";\n        mysqli_query($conn, $sqlDetails);\n    }\n    \n    mysqli_close($conn);\n}\n\n// Create the necessary tables if they don't exist\ncreateOrderTable();\n?>\n```", "```php\n<?php\nsession_start();\ninclude('functions.php');\n\n$orderId = isset($_GET['id']) ? $_GET['id'] : '';\n?>\n\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Order Confirmation</title>\n    <link rel=\"stylesheet\" href=\"https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css\">\n</head>\n<body>\n    <div class=\"container mt-5\">\n        <?php if ($orderId) : ?>\n            <h1>Thank you for your order!</h1>\n            <p>Your order has been successfully processed.</p>\n            <p>Order ID: <?php echo $orderId; ?></p>\n            <a href=\"index.php\" class=\"btn btn-primary\">Continue Shopping</a>\n        <?php else : ?>\n            <p>There was an error processing your order. Please try again.</p>\n        <?php endif; ?>\n    </div>\n\n    <script src=\"https://code.jquery.com/jquery-3.5.1.slim.min.js\"></script>\n    <script src=\"https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js\"></script>\n    <script src=\"https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js\"></script>\n</body>\n</html>\n```"]}
