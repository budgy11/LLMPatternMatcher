{"prompt": "Create a purchase functionality using php", "llm_output": "Here is an example of a basic purchase functionality in PHP:\n\n**Note:** This is a simplified example and you should consider implementing additional features such as user authentication, payment processing, and database integration for a real-world application.\n\n**purchase.php**\n```php\n<?php\n\n// Database connection settings\n$host = 'localhost';\n$dbname = 'store';\n$username = 'root';\n$password = '';\n\n// Connect to the database\n$conn = new PDO(\"mysql:host=$host;dbname=$dbname\", $username, $password);\n\n// Function to add a product to cart\nfunction add_product_to_cart($product_id) {\n  global $conn;\n  // Get user's cart ID (assuming a session variable)\n  $cart_id = $_SESSION['cart_id'];\n  \n  // Insert product into cart\n  $query = \"INSERT INTO cart_items (cart_id, product_id, quantity) VALUES (:cart_id, :product_id, 1)\";\n  $stmt = $conn->prepare($query);\n  $stmt->bindParam(':cart_id', $cart_id);\n  $stmt->bindParam(':product_id', $product_id);\n  $stmt->execute();\n}\n\n// Function to remove a product from cart\nfunction remove_product_from_cart($product_id) {\n  global $conn;\n  // Get user's cart ID (assuming a session variable)\n  $cart_id = $_SESSION['cart_id'];\n  \n  // Delete product from cart\n  $query = \"DELETE FROM cart_items WHERE cart_id = :cart_id AND product_id = :product_id\";\n  $stmt = $conn->prepare($query);\n  $stmt->bindParam(':cart_id', $cart_id);\n  $stmt->bindParam(':product_id', $product_id);\n  $stmt->execute();\n}\n\n// Function to update quantity of a product in cart\nfunction update_quantity_in_cart($product_id, $quantity) {\n  global $conn;\n  // Get user's cart ID (assuming a session variable)\n  $cart_id = $_SESSION['cart_id'];\n  \n  // Update quantity in cart\n  $query = \"UPDATE cart_items SET quantity = :quantity WHERE cart_id = :cart_id AND product_id = :product_id\";\n  $stmt = $conn->prepare($query);\n  $stmt->bindParam(':cart_id', $cart_id);\n  $stmt->bindParam(':product_id', $product_id);\n  $stmt->bindParam(':quantity', $quantity);\n  $stmt->execute();\n}\n\n// Function to calculate total cost of cart\nfunction calculate_cart_total() {\n  global $conn;\n  // Get user's cart ID (assuming a session variable)\n  $cart_id = $_SESSION['cart_id'];\n  \n  // Calculate total cost of cart\n  $query = \"SELECT SUM(p.price * ci.quantity) AS total FROM products p INNER JOIN cart_items ci ON p.id = ci.product_id WHERE ci.cart_id = :cart_id\";\n  $stmt = $conn->prepare($query);\n  $stmt->bindParam(':cart_id', $cart_id);\n  $stmt->execute();\n  \n  // Return total cost\n  return $stmt->fetchColumn();\n}\n\n// Function to create order\nfunction create_order() {\n  global $conn;\n  // Get user's cart ID (assuming a session variable)\n  $cart_id = $_SESSION['cart_id'];\n  \n  // Create new order\n  $query = \"INSERT INTO orders (customer_id, total) VALUES (:customer_id, :total)\";\n  $stmt = $conn->prepare($query);\n  $stmt->bindParam(':customer_id', $_SESSION['user_id']);\n  $stmt->bindParam(':total', calculate_cart_total());\n  $stmt->execute();\n  \n  // Update cart items to be ordered\n  $query = \"UPDATE cart_items SET ordered = 1 WHERE cart_id = :cart_id\";\n  $stmt = $conn->prepare($query);\n  $stmt->bindParam(':cart_id', $cart_id);\n  $stmt->execute();\n}\n\n// Check if user is logged in\nif (!isset($_SESSION['user_id'])) {\n  echo \"Please log in to purchase products.\";\n  exit;\n}\n\n// Get product list from database\n$query = \"SELECT * FROM products\";\n$stmt = $conn->prepare($query);\n$stmt->execute();\n$products = $stmt->fetchAll();\n\n// Display cart contents and total cost\necho \"<h1>Cart Contents</h1>\";\necho \"<p>Total: $\" . calculate_cart_total() . \"</p>\";\n\n// Display product list\necho \"<h1>Product List</h1>\";\nforeach ($products as $product) {\n  echo \"<p>\" . $product['name'] . \" - $\" . $product['price'] . \"</p>\";\n  \n  // Add to cart button\n  if (isset($_SESSION['cart_id'])) {\n    echo \"<button onclick='add_product_to_cart(\" . $product['id'] . \")'>Add to Cart</button>\";\n  } else {\n    echo \"<button disabled>Add to Cart</button>\";\n  }\n}\n\n// Purchase button\necho \"<button onclick='create_order()'>Purchase</button>\";\n\n?>\n```\n**cart.php**\n```php\n<?php\n\n// Get user's cart ID (assuming a session variable)\n$cart_id = $_SESSION['cart_id'];\n\n// Display cart contents and total cost\necho \"<h1>Cart Contents</h1>\";\necho \"<p>Total: $\" . calculate_cart_total() . \"</p>\";\n\n// Display product list with add to cart buttons\n$query = \"SELECT * FROM products\";\n$stmt = $conn->prepare($query);\n$stmt->execute();\n$products = $stmt->fetchAll();\n\nforeach ($products as $product) {\n  echo \"<p>\" . $product['name'] . \" - $\" . $product['price'] . \"</p>\";\n  \n  // Add to cart button\n  if (isset($_SESSION['cart_id'])) {\n    echo \"<button onclick='add_product_to_cart(\" . $product['id'] . \")'>Add to Cart</button>\";\n  } else {\n    echo \"<button disabled>Add to Cart</button>\";\n  }\n}\n\n?>\n```\nThis code assumes you have a `products` table in your database with columns for product name, price, and ID. It also assumes you have a `cart_items` table with columns for cart ID, product ID, quantity, and ordered.\n\nThe purchase functionality is as follows:\n\n1. User selects products to add to their cart.\n2. When user clicks \"Purchase\", the code creates a new order in the database and updates the cart items to be ordered.\n3. The total cost of the cart is calculated using the `calculate_cart_total()` function.\n\nNote that this is a basic example and you should consider implementing additional features such as:\n\n* User authentication\n* Payment processing (e.g. PayPal, credit cards)\n* Database integration (e.g. MySQLi or PDO)\n* Security measures (e.g. CSRF protection)\n\nAlso, keep in mind that this code assumes you have already set up a session to store the user's cart ID and other relevant information.", "code_blocks": ["```php\n<?php\n\n// Database connection settings\n$host = 'localhost';\n$dbname = 'store';\n$username = 'root';\n$password = '';\n\n// Connect to the database\n$conn = new PDO(\"mysql:host=$host;dbname=$dbname\", $username, $password);\n\n// Function to add a product to cart\nfunction add_product_to_cart($product_id) {\n  global $conn;\n  // Get user's cart ID (assuming a session variable)\n  $cart_id = $_SESSION['cart_id'];\n  \n  // Insert product into cart\n  $query = \"INSERT INTO cart_items (cart_id, product_id, quantity) VALUES (:cart_id, :product_id, 1)\";\n  $stmt = $conn->prepare($query);\n  $stmt->bindParam(':cart_id', $cart_id);\n  $stmt->bindParam(':product_id', $product_id);\n  $stmt->execute();\n}\n\n// Function to remove a product from cart\nfunction remove_product_from_cart($product_id) {\n  global $conn;\n  // Get user's cart ID (assuming a session variable)\n  $cart_id = $_SESSION['cart_id'];\n  \n  // Delete product from cart\n  $query = \"DELETE FROM cart_items WHERE cart_id = :cart_id AND product_id = :product_id\";\n  $stmt = $conn->prepare($query);\n  $stmt->bindParam(':cart_id', $cart_id);\n  $stmt->bindParam(':product_id', $product_id);\n  $stmt->execute();\n}\n\n// Function to update quantity of a product in cart\nfunction update_quantity_in_cart($product_id, $quantity) {\n  global $conn;\n  // Get user's cart ID (assuming a session variable)\n  $cart_id = $_SESSION['cart_id'];\n  \n  // Update quantity in cart\n  $query = \"UPDATE cart_items SET quantity = :quantity WHERE cart_id = :cart_id AND product_id = :product_id\";\n  $stmt = $conn->prepare($query);\n  $stmt->bindParam(':cart_id', $cart_id);\n  $stmt->bindParam(':product_id', $product_id);\n  $stmt->bindParam(':quantity', $quantity);\n  $stmt->execute();\n}\n\n// Function to calculate total cost of cart\nfunction calculate_cart_total() {\n  global $conn;\n  // Get user's cart ID (assuming a session variable)\n  $cart_id = $_SESSION['cart_id'];\n  \n  // Calculate total cost of cart\n  $query = \"SELECT SUM(p.price * ci.quantity) AS total FROM products p INNER JOIN cart_items ci ON p.id = ci.product_id WHERE ci.cart_id = :cart_id\";\n  $stmt = $conn->prepare($query);\n  $stmt->bindParam(':cart_id', $cart_id);\n  $stmt->execute();\n  \n  // Return total cost\n  return $stmt->fetchColumn();\n}\n\n// Function to create order\nfunction create_order() {\n  global $conn;\n  // Get user's cart ID (assuming a session variable)\n  $cart_id = $_SESSION['cart_id'];\n  \n  // Create new order\n  $query = \"INSERT INTO orders (customer_id, total) VALUES (:customer_id, :total)\";\n  $stmt = $conn->prepare($query);\n  $stmt->bindParam(':customer_id', $_SESSION['user_id']);\n  $stmt->bindParam(':total', calculate_cart_total());\n  $stmt->execute();\n  \n  // Update cart items to be ordered\n  $query = \"UPDATE cart_items SET ordered = 1 WHERE cart_id = :cart_id\";\n  $stmt = $conn->prepare($query);\n  $stmt->bindParam(':cart_id', $cart_id);\n  $stmt->execute();\n}\n\n// Check if user is logged in\nif (!isset($_SESSION['user_id'])) {\n  echo \"Please log in to purchase products.\";\n  exit;\n}\n\n// Get product list from database\n$query = \"SELECT * FROM products\";\n$stmt = $conn->prepare($query);\n$stmt->execute();\n$products = $stmt->fetchAll();\n\n// Display cart contents and total cost\necho \"<h1>Cart Contents</h1>\";\necho \"<p>Total: $\" . calculate_cart_total() . \"</p>\";\n\n// Display product list\necho \"<h1>Product List</h1>\";\nforeach ($products as $product) {\n  echo \"<p>\" . $product['name'] . \" - $\" . $product['price'] . \"</p>\";\n  \n  // Add to cart button\n  if (isset($_SESSION['cart_id'])) {\n    echo \"<button onclick='add_product_to_cart(\" . $product['id'] . \")'>Add to Cart</button>\";\n  } else {\n    echo \"<button disabled>Add to Cart</button>\";\n  }\n}\n\n// Purchase button\necho \"<button onclick='create_order()'>Purchase</button>\";\n\n?>\n```", "```php\n<?php\n\n// Get user's cart ID (assuming a session variable)\n$cart_id = $_SESSION['cart_id'];\n\n// Display cart contents and total cost\necho \"<h1>Cart Contents</h1>\";\necho \"<p>Total: $\" . calculate_cart_total() . \"</p>\";\n\n// Display product list with add to cart buttons\n$query = \"SELECT * FROM products\";\n$stmt = $conn->prepare($query);\n$stmt->execute();\n$products = $stmt->fetchAll();\n\nforeach ($products as $product) {\n  echo \"<p>\" . $product['name'] . \" - $\" . $product['price'] . \"</p>\";\n  \n  // Add to cart button\n  if (isset($_SESSION['cart_id'])) {\n    echo \"<button onclick='add_product_to_cart(\" . $product['id'] . \")'>Add to Cart</button>\";\n  } else {\n    echo \"<button disabled>Add to Cart</button>\";\n  }\n}\n\n?>\n```"]}
