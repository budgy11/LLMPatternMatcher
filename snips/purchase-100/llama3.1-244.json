{"prompt": "Create a purchase functionality using php", "llm_output": "Here is an example of a basic purchase functionality using PHP, MySQL, and HTML. This example assumes that you have already set up a MySQL database with the necessary tables.\n\n**Database Schema**\n\nFirst, let's create the necessary tables in our database:\n\n```sql\nCREATE TABLE products (\n  id INT AUTO_INCREMENT,\n  name VARCHAR(255),\n  price DECIMAL(10,2),\n  description TEXT,\n  PRIMARY KEY (id)\n);\n\nCREATE TABLE orders (\n  id INT AUTO_INCREMENT,\n  customer_name VARCHAR(255),\n  order_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n  total DECIMAL(10,2),\n  status VARCHAR(50) DEFAULT 'pending',\n  PRIMARY KEY (id)\n);\n\nCREATE TABLE order_items (\n  id INT AUTO_INCREMENT,\n  order_id INT,\n  product_id INT,\n  quantity INT,\n  price DECIMAL(10,2),\n  PRIMARY KEY (id),\n  FOREIGN KEY (order_id) REFERENCES orders(id),\n  FOREIGN KEY (product_id) REFERENCES products(id)\n);\n```\n\n**PHP Code**\n\nNext, let's create a PHP script to handle the purchase functionality:\n\n```php\n// db.php: connect to database and return PDO instance\n$dsn = 'mysql:host=localhost;dbname=shop';\n$username = 'root';\n$password = '';\n\ntry {\n  $pdo = new PDO($dsn, $username, $password);\n} catch (PDOException $e) {\n  echo 'Connection failed: ' . $e->getMessage();\n}\n\n// index.php: handle form submission\nif ($_SERVER['REQUEST_METHOD'] === 'POST') {\n  // Get product ID from form data\n  $productId = $_POST['product_id'];\n\n  // Retrieve product details from database\n  $query = \"SELECT * FROM products WHERE id = :id\";\n  $stmt = $pdo->prepare($query);\n  $stmt->bindParam(':id', $productId);\n  $stmt->execute();\n  $product = $stmt->fetch();\n\n  if (!$product) {\n    echo 'Product not found!';\n    exit;\n  }\n\n  // Retrieve customer details from session (or form data)\n  $customerName = $_SESSION['customer_name'] ?? null;\n\n  if (!$customerName) {\n    echo 'Please login to proceed!';\n    exit;\n  }\n\n  // Create new order\n  $query = \"INSERT INTO orders (customer_name, total) VALUES (:name, :total)\";\n  $stmt = $pdo->prepare($query);\n  $stmt->bindParam(':name', $customerName);\n  $stmt->bindParam(':total', $product['price']);\n  $stmt->execute();\n\n  // Get order ID\n  $orderId = $pdo->lastInsertId();\n\n  // Add product to order items table\n  $query = \"INSERT INTO order_items (order_id, product_id, quantity, price) VALUES (:id, :pid, 1, :price)\";\n  $stmt = $pdo->prepare($query);\n  $stmt->bindParam(':id', $orderId);\n  $stmt->bindParam(':pid', $productId);\n  $stmt->bindParam(':price', $product['price']);\n  $stmt->execute();\n\n  // Update order total\n  $query = \"UPDATE orders SET total = (SELECT SUM(price) FROM order_items WHERE order_id = :id)\";\n  $stmt = $pdo->prepare($query);\n  $stmt->bindParam(':id', $orderId);\n  $stmt->execute();\n\n  echo 'Order placed successfully!';\n} else {\n?>\n  <!-- index.php: display form for user to select product -->\n  <form action=\"\" method=\"post\">\n    <select name=\"product_id\">\n      <?php\n        // Retrieve products from database and populate select options\n        $query = \"SELECT * FROM products\";\n        $stmt = $pdo->prepare($query);\n        $stmt->execute();\n        while ($row = $stmt->fetch()) {\n          echo \"<option value='{$row['id']}'>{$row['name']}</option>\";\n        }\n      ?>\n    </select>\n    <input type=\"submit\" value=\"Place Order\">\n  </form>\n<?php\n}\n```\n\n**HTML Form**\n\nCreate an HTML form to display product options and submit the purchase:\n\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <title>Purchase Product</title>\n</head>\n<body>\n  <!-- index.php: display form for user to select product -->\n  <form action=\"\" method=\"post\">\n    <select name=\"product_id\">\n      <?php\n        // Retrieve products from database and populate select options\n        $query = \"SELECT * FROM products\";\n        $stmt = $pdo->prepare($query);\n        $stmt->execute();\n        while ($row = $stmt->fetch()) {\n          echo \"<option value='{$row['id']}'>{$row['name']}</option>\";\n        }\n      ?>\n    </select>\n    <input type=\"submit\" value=\"Place Order\">\n  </form>\n</body>\n</html>\n```\n\nThis is a basic example and may require modifications to fit your specific requirements. Additionally, you should consider implementing security measures such as input validation and sanitization to prevent SQL injection attacks.\n\n**Remember to replace placeholders (`$dsn`, `$username`, `$password`, etc.) with actual database credentials and schema details.**\n\nPlease let me know if you need further assistance or have any questions about this code!", "code_blocks": [null, "```php\n// db.php: connect to database and return PDO instance\n$dsn = 'mysql:host=localhost;dbname=shop';\n$username = 'root';\n$password = '';\n\ntry {\n  $pdo = new PDO($dsn, $username, $password);\n} catch (PDOException $e) {\n  echo 'Connection failed: ' . $e->getMessage();\n}\n\n// index.php: handle form submission\nif ($_SERVER['REQUEST_METHOD'] === 'POST') {\n  // Get product ID from form data\n  $productId = $_POST['product_id'];\n\n  // Retrieve product details from database\n  $query = \"SELECT * FROM products WHERE id = :id\";\n  $stmt = $pdo->prepare($query);\n  $stmt->bindParam(':id', $productId);\n  $stmt->execute();\n  $product = $stmt->fetch();\n\n  if (!$product) {\n    echo 'Product not found!';\n    exit;\n  }\n\n  // Retrieve customer details from session (or form data)\n  $customerName = $_SESSION['customer_name'] ?? null;\n\n  if (!$customerName) {\n    echo 'Please login to proceed!';\n    exit;\n  }\n\n  // Create new order\n  $query = \"INSERT INTO orders (customer_name, total) VALUES (:name, :total)\";\n  $stmt = $pdo->prepare($query);\n  $stmt->bindParam(':name', $customerName);\n  $stmt->bindParam(':total', $product['price']);\n  $stmt->execute();\n\n  // Get order ID\n  $orderId = $pdo->lastInsertId();\n\n  // Add product to order items table\n  $query = \"INSERT INTO order_items (order_id, product_id, quantity, price) VALUES (:id, :pid, 1, :price)\";\n  $stmt = $pdo->prepare($query);\n  $stmt->bindParam(':id', $orderId);\n  $stmt->bindParam(':pid', $productId);\n  $stmt->bindParam(':price', $product['price']);\n  $stmt->execute();\n\n  // Update order total\n  $query = \"UPDATE orders SET total = (SELECT SUM(price) FROM order_items WHERE order_id = :id)\";\n  $stmt = $pdo->prepare($query);\n  $stmt->bindParam(':id', $orderId);\n  $stmt->execute();\n\n  echo 'Order placed successfully!';\n} else {\n?>\n  <!-- index.php: display form for user to select product -->\n  <form action=\"\" method=\"post\">\n    <select name=\"product_id\">\n      <?php\n        // Retrieve products from database and populate select options\n        $query = \"SELECT * FROM products\";\n        $stmt = $pdo->prepare($query);\n        $stmt->execute();\n        while ($row = $stmt->fetch()) {\n          echo \"<option value='{$row['id']}'>{$row['name']}</option>\";\n        }\n      ?>\n    </select>\n    <input type=\"submit\" value=\"Place Order\">\n  </form>\n<?php\n}\n```", null]}
