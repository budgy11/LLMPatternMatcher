{"prompt": "Create a purchase functionality using php", "llm_output": "Here is an example of a basic purchase functionality in PHP:\n\n**Database Schema**\n\nWe'll assume we have the following database schema for products and orders:\n```sql\nCREATE TABLE products (\n  id INT PRIMARY KEY,\n  name VARCHAR(255),\n  price DECIMAL(10,2)\n);\n\nCREATE TABLE orders (\n  id INT PRIMARY KEY,\n  customer_name VARCHAR(255),\n  order_date DATE,\n  total DECIMAL(10,2)\n);\n\nCREATE TABLE order_items (\n  id INT PRIMARY KEY,\n  order_id INT,\n  product_id INT,\n  quantity INT,\n  FOREIGN KEY (order_id) REFERENCES orders(id),\n  FOREIGN KEY (product_id) REFERENCES products(id)\n);\n```\n**PHP Code**\n\nCreate a new file called `purchase.php` and add the following code:\n```php\n<?php\n\n// Connect to database\n$servername = \"localhost\";\n$username = \"username\";\n$password = \"password\";\n$dbname = \"database_name\";\n\n$conn = new mysqli($servername, $username, $password, $dbname);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Function to display products\nfunction display_products() {\n  global $conn;\n  $sql = \"SELECT * FROM products\";\n  $result = $conn->query($sql);\n  while ($row = $result->fetch_assoc()) {\n      echo \"<li>\" . $row[\"name\"] . \" - $\" . $row[\"price\"] . \"</li>\";\n  }\n}\n\n// Function to add product to cart\nfunction add_product_to_cart() {\n  global $conn;\n  if (isset($_POST[\"product_id\"]) && isset($_POST[\"quantity\"])) {\n      $product_id = $_POST[\"product_id\"];\n      $quantity = $_POST[\"quantity\"];\n\n      // Check if product is already in cart\n      $sql = \"SELECT * FROM order_items WHERE order_id = ? AND product_id = ?\";\n      $stmt = $conn->prepare($sql);\n      $stmt->bind_param(\"ii\", $_SESSION[\"order_id\"], $product_id);\n      $stmt->execute();\n      $result = $stmt->get_result();\n\n      if ($result->num_rows > 0) {\n          // Product is already in cart, update quantity\n          while ($row = $result->fetch_assoc()) {\n              $new_quantity = $row[\"quantity\"] + $quantity;\n              $sql = \"UPDATE order_items SET quantity = ? WHERE id = ?\";\n              $stmt = $conn->prepare($sql);\n              $stmt->bind_param(\"ii\", $new_quantity, $row[\"id\"]);\n              $stmt->execute();\n          }\n      } else {\n          // Add product to cart\n          $sql = \"INSERT INTO order_items (order_id, product_id, quantity) VALUES (?, ?, ?)\";\n          $stmt = $conn->prepare($sql);\n          $stmt->bind_param(\"iii\", $_SESSION[\"order_id\"], $product_id, $quantity);\n          $stmt->execute();\n      }\n  }\n}\n\n// Function to place order\nfunction place_order() {\n  global $conn;\n  if (isset($_POST[\"customer_name\"]) && isset($_POST[\"order_date\"])) {\n      $customer_name = $_POST[\"customer_name\"];\n      $order_date = $_POST[\"order_date\"];\n\n      // Calculate total cost of order\n      $sql = \"SELECT SUM(price * quantity) AS total FROM products INNER JOIN order_items ON products.id = order_items.product_id WHERE order_id = ?\";\n      $stmt = $conn->prepare($sql);\n      $stmt->bind_param(\"i\", $_SESSION[\"order_id\"]);\n      $stmt->execute();\n      $result = $stmt->get_result();\n\n      while ($row = $result->fetch_assoc()) {\n          $total = $row[\"total\"];\n\n          // Insert order into database\n          $sql = \"INSERT INTO orders (customer_name, order_date, total) VALUES (?, ?, ?)\";\n          $stmt = $conn->prepare($sql);\n          $stmt->bind_param(\"sss\", $customer_name, $order_date, $total);\n          $stmt->execute();\n      }\n  }\n}\n\n// Start session\nsession_start();\n\n// Display products\ndisplay_products();\n\n?>\n```\n**HTML Code**\n\nCreate a new file called `index.html` and add the following code:\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Purchase Functionality</title>\n</head>\n<body>\n\n    <h1>Products:</h1>\n    <ul id=\"products\"></ul>\n\n    <script src=\"https://code.jquery.com/jquery-3.5.1.min.js\"></script>\n    <script>\n        $(document).ready(function() {\n            // Display products on page load\n            $.ajax({\n                type: \"GET\",\n                url: \"purchase.php\",\n                dataType: \"html\"\n            }).done(function(data) {\n                $(\"#products\").html(data);\n            });\n\n            // Add event listener to add product button\n            $(\"#add_product\").on(\"click\", function() {\n                var product_id = $(this).data(\"product-id\");\n                var quantity = prompt(\"Enter quantity:\");\n                $.ajax({\n                    type: \"POST\",\n                    url: \"purchase.php\",\n                    data: {product_id: product_id, quantity: quantity},\n                    dataType: \"html\"\n                }).done(function(data) {\n                    $(\"#products\").html(data);\n                });\n            });\n\n            // Add event listener to place order button\n            $(\"#place_order\").on(\"click\", function() {\n                var customer_name = prompt(\"Enter customer name:\");\n                var order_date = prompt(\"Enter order date:\");\n                $.ajax({\n                    type: \"POST\",\n                    url: \"purchase.php\",\n                    data: {customer_name: customer_name, order_date: order_date},\n                    dataType: \"html\"\n                }).done(function(data) {\n                    $(\"#products\").html(data);\n                });\n            });\n        });\n    </script>\n\n</body>\n</html>\n```\n**How it works**\n\n1. The `purchase.php` file connects to the database and defines three functions: `display_products`, `add_product_to_cart`, and `place_order`.\n2. The `display_products` function displays a list of products on the page using an AJAX request.\n3. When the user clicks the \"Add Product\" button, it sends a POST request to `purchase.php` with the product ID and quantity as parameters. The `add_product_to_cart` function checks if the product is already in the cart and updates or adds it accordingly.\n4. When the user clicks the \"Place Order\" button, it sends a POST request to `purchase.php` with the customer name and order date as parameters. The `place_order` function calculates the total cost of the order and inserts an entry into the database.\n\nNote that this is just a basic example and you may want to add more functionality, such as validating user input, handling errors, and improving performance.", "code_blocks": [null, "```php\n<?php\n\n// Connect to database\n$servername = \"localhost\";\n$username = \"username\";\n$password = \"password\";\n$dbname = \"database_name\";\n\n$conn = new mysqli($servername, $username, $password, $dbname);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Function to display products\nfunction display_products() {\n  global $conn;\n  $sql = \"SELECT * FROM products\";\n  $result = $conn->query($sql);\n  while ($row = $result->fetch_assoc()) {\n      echo \"<li>\" . $row[\"name\"] . \" - $\" . $row[\"price\"] . \"</li>\";\n  }\n}\n\n// Function to add product to cart\nfunction add_product_to_cart() {\n  global $conn;\n  if (isset($_POST[\"product_id\"]) && isset($_POST[\"quantity\"])) {\n      $product_id = $_POST[\"product_id\"];\n      $quantity = $_POST[\"quantity\"];\n\n      // Check if product is already in cart\n      $sql = \"SELECT * FROM order_items WHERE order_id = ? AND product_id = ?\";\n      $stmt = $conn->prepare($sql);\n      $stmt->bind_param(\"ii\", $_SESSION[\"order_id\"], $product_id);\n      $stmt->execute();\n      $result = $stmt->get_result();\n\n      if ($result->num_rows > 0) {\n          // Product is already in cart, update quantity\n          while ($row = $result->fetch_assoc()) {\n              $new_quantity = $row[\"quantity\"] + $quantity;\n              $sql = \"UPDATE order_items SET quantity = ? WHERE id = ?\";\n              $stmt = $conn->prepare($sql);\n              $stmt->bind_param(\"ii\", $new_quantity, $row[\"id\"]);\n              $stmt->execute();\n          }\n      } else {\n          // Add product to cart\n          $sql = \"INSERT INTO order_items (order_id, product_id, quantity) VALUES (?, ?, ?)\";\n          $stmt = $conn->prepare($sql);\n          $stmt->bind_param(\"iii\", $_SESSION[\"order_id\"], $product_id, $quantity);\n          $stmt->execute();\n      }\n  }\n}\n\n// Function to place order\nfunction place_order() {\n  global $conn;\n  if (isset($_POST[\"customer_name\"]) && isset($_POST[\"order_date\"])) {\n      $customer_name = $_POST[\"customer_name\"];\n      $order_date = $_POST[\"order_date\"];\n\n      // Calculate total cost of order\n      $sql = \"SELECT SUM(price * quantity) AS total FROM products INNER JOIN order_items ON products.id = order_items.product_id WHERE order_id = ?\";\n      $stmt = $conn->prepare($sql);\n      $stmt->bind_param(\"i\", $_SESSION[\"order_id\"]);\n      $stmt->execute();\n      $result = $stmt->get_result();\n\n      while ($row = $result->fetch_assoc()) {\n          $total = $row[\"total\"];\n\n          // Insert order into database\n          $sql = \"INSERT INTO orders (customer_name, order_date, total) VALUES (?, ?, ?)\";\n          $stmt = $conn->prepare($sql);\n          $stmt->bind_param(\"sss\", $customer_name, $order_date, $total);\n          $stmt->execute();\n      }\n  }\n}\n\n// Start session\nsession_start();\n\n// Display products\ndisplay_products();\n\n?>\n```", null]}
