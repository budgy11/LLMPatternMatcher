{"prompt": "Create a purchase functionality using php", "llm_output": "Here's an example of a basic purchase functionality using PHP, HTML, and MySQL:\n\n**Database Setup**\n\nFirst, create a database and add a table to store purchase information. You can use the following SQL commands:\n```sql\nCREATE TABLE purchases (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  user_id INT,\n  product_id INT,\n  quantity INT,\n  total DECIMAL(10,2),\n  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n);\n\nCREATE TABLE products (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  name VARCHAR(255),\n  price DECIMAL(10,2)\n);\n```\n**PHP Code**\n\nCreate a PHP file (e.g., `purchase.php`) and add the following code:\n```php\n<?php\n\n// Configuration\n$db_host = 'localhost';\n$db_username = 'your_username';\n$db_password = 'your_password';\n$db_name = 'your_database';\n\n// Connect to database\n$conn = new mysqli($db_host, $db_username, $db_password, $db_name);\n\n// Check connection\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Function to add purchase\nfunction add_purchase($user_id, $product_id, $quantity) {\n  global $conn;\n\n  // Get product price\n  $sql = \"SELECT price FROM products WHERE id = '$product_id'\";\n  $result = $conn->query($sql);\n  if ($result->num_rows > 0) {\n    $row = $result->fetch_assoc();\n    $price = $row['price'];\n    $total = $price * $quantity;\n\n    // Add purchase to database\n    $sql = \"INSERT INTO purchases (user_id, product_id, quantity, total)\n            VALUES ('$user_id', '$product_id', '$quantity', '$total')\";\n    if ($conn->query($sql) === TRUE) {\n      echo \"Purchase added successfully!\";\n    } else {\n      echo \"Error adding purchase: \" . $conn->error;\n    }\n  } else {\n    echo \"Product not found.\";\n  }\n}\n\n// Function to get products\nfunction get_products() {\n  global $conn;\n\n  // Get all products from database\n  $sql = \"SELECT * FROM products\";\n  $result = $conn->query($sql);\n  if ($result->num_rows > 0) {\n    while($row = $result->fetch_assoc()) {\n      echo \"<option value='\" . $row['id'] . \"'>\" . $row['name'] . \"</option>\";\n    }\n  } else {\n    echo \"No products found.\";\n  }\n}\n\n// Function to get user ID\nfunction get_user_id() {\n  global $conn;\n\n  // Get user ID from session or database (not implemented here)\n  return $_SESSION['user_id']; // Replace with actual implementation\n}\n\n// Handle form submission\nif ($_SERVER[\"REQUEST_METHOD\"] == \"POST\") {\n  if (isset($_POST['product_id']) && isset($_POST['quantity'])) {\n    $user_id = get_user_id();\n    $product_id = $_POST['product_id'];\n    $quantity = $_POST['quantity'];\n\n    // Validate quantity and product ID\n    if ($quantity > 0 && ctype_digit($product_id)) {\n      add_purchase($user_id, $product_id, $quantity);\n    } else {\n      echo \"Invalid input.\";\n    }\n  }\n}\n\n?>\n```\n**HTML Form**\n\nCreate an HTML form (e.g., `purchase.html`) and link it to the PHP file:\n```html\n<!DOCTYPE html>\n<html>\n<head>\n  <title>Purchase</title>\n</head>\n<body>\n  <h1>Purchase Product</h1>\n\n  <form action=\"purchase.php\" method=\"post\">\n    <label for=\"product_id\">Select a product:</label>\n    <select id=\"product_id\" name=\"product_id\">\n      <?php get_products(); ?>\n    </select>\n\n    <br><br>\n    <label for=\"quantity\">Quantity:</label>\n    <input type=\"number\" id=\"quantity\" name=\"quantity\" required>\n\n    <br><br>\n    <button type=\"submit\">Purchase</button>\n  </form>\n</body>\n</html>\n```\n**Usage**\n\n1. Create a MySQL database and add the `purchases` and `products` tables.\n2. Replace the configuration variables (`$db_host`, `$db_username`, etc.) with your actual database credentials.\n3. Run the PHP file to create a connection to the database.\n4. Go to the HTML form page and select a product, enter the quantity, and click \"Purchase\". The purchase will be added to the database.\n\nNote: This is a basic example and should not be used in production without proper validation, sanitization, and security measures. Additionally, this code assumes that user IDs are stored in session or database (not implemented here). You may need to modify it according to your specific requirements.", "code_blocks": [null, "```php\n<?php\n\n// Configuration\n$db_host = 'localhost';\n$db_username = 'your_username';\n$db_password = 'your_password';\n$db_name = 'your_database';\n\n// Connect to database\n$conn = new mysqli($db_host, $db_username, $db_password, $db_name);\n\n// Check connection\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Function to add purchase\nfunction add_purchase($user_id, $product_id, $quantity) {\n  global $conn;\n\n  // Get product price\n  $sql = \"SELECT price FROM products WHERE id = '$product_id'\";\n  $result = $conn->query($sql);\n  if ($result->num_rows > 0) {\n    $row = $result->fetch_assoc();\n    $price = $row['price'];\n    $total = $price * $quantity;\n\n    // Add purchase to database\n    $sql = \"INSERT INTO purchases (user_id, product_id, quantity, total)\n            VALUES ('$user_id', '$product_id', '$quantity', '$total')\";\n    if ($conn->query($sql) === TRUE) {\n      echo \"Purchase added successfully!\";\n    } else {\n      echo \"Error adding purchase: \" . $conn->error;\n    }\n  } else {\n    echo \"Product not found.\";\n  }\n}\n\n// Function to get products\nfunction get_products() {\n  global $conn;\n\n  // Get all products from database\n  $sql = \"SELECT * FROM products\";\n  $result = $conn->query($sql);\n  if ($result->num_rows > 0) {\n    while($row = $result->fetch_assoc()) {\n      echo \"<option value='\" . $row['id'] . \"'>\" . $row['name'] . \"</option>\";\n    }\n  } else {\n    echo \"No products found.\";\n  }\n}\n\n// Function to get user ID\nfunction get_user_id() {\n  global $conn;\n\n  // Get user ID from session or database (not implemented here)\n  return $_SESSION['user_id']; // Replace with actual implementation\n}\n\n// Handle form submission\nif ($_SERVER[\"REQUEST_METHOD\"] == \"POST\") {\n  if (isset($_POST['product_id']) && isset($_POST['quantity'])) {\n    $user_id = get_user_id();\n    $product_id = $_POST['product_id'];\n    $quantity = $_POST['quantity'];\n\n    // Validate quantity and product ID\n    if ($quantity > 0 && ctype_digit($product_id)) {\n      add_purchase($user_id, $product_id, $quantity);\n    } else {\n      echo \"Invalid input.\";\n    }\n  }\n}\n\n?>\n```", null]}
