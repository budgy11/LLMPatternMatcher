{"prompt": "Create a purchase functionality using php", "llm_output": "Here's an example of a simple purchase functionality using PHP, HTML, and MySQL. This example includes:\n\n1. User login\n2. Product listing with add to cart feature\n3. View Cart functionality\n4. Place Order functionality\n\n**Note:** This is a basic implementation for demonstration purposes only. You should consider security, validation, and other aspects in a real-world application.\n\n### Database Schema\n\nCreate the following tables in your MySQL database:\n\n```sql\nCREATE TABLE users (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  username VARCHAR(255) NOT NULL,\n  password VARCHAR(255) NOT NULL\n);\n\nCREATE TABLE products (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  name VARCHAR(255) NOT NULL,\n  price DECIMAL(10,2) NOT NULL\n);\n\nCREATE TABLE orders (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  user_id INT NOT NULL,\n  order_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n  total DECIMAL(10,2) NOT NULL,\n  status VARCHAR(50) NOT NULL DEFAULT 'pending'\n);\n\nCREATE TABLE order_items (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  order_id INT NOT NULL,\n  product_id INT NOT NULL,\n  quantity INT NOT NULL\n);\n```\n\n### PHP Code\n\n**config.php**\n\n```php\n<?php\ndefine('DB_HOST', 'localhost');\ndefine('DB_USERNAME', 'your_username');\ndefine('DB_PASSWORD', 'your_password');\ndefine('DB_NAME', 'your_database_name');\n\n$conn = new mysqli(DB_HOST, DB_USERNAME, DB_PASSWORD, DB_NAME);\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n?>\n```\n\n**login.php**\n\n```php\n<?php\nrequire_once 'config.php';\n\nif (isset($_POST['username']) && isset($_POST['password'])) {\n    $username = $_POST['username'];\n    $password = $_POST['password'];\n\n    $query = \"SELECT * FROM users WHERE username = '$username' AND password = '$password'\";\n    $result = $conn->query($query);\n    if ($result->num_rows > 0) {\n        session_start();\n        $_SESSION['user_id'] = $result->fetch_assoc()['id'];\n        header('Location: products.php');\n        exit;\n    } else {\n        echo 'Invalid username or password';\n    }\n}\n?>\n```\n\n**products.php**\n\n```php\n<?php\nrequire_once 'config.php';\n\nif (isset($_POST['add_to_cart'])) {\n    $product_id = $_POST['product_id'];\n    $quantity = $_POST['quantity'];\n\n    if (isset($_SESSION['cart'])) {\n        foreach ($_SESSION['cart'] as &$item) {\n            if ($item['id'] == $product_id) {\n                $item['quantity'] += $quantity;\n                break;\n            }\n        }\n    } else {\n        $_SESSION['cart'][] = ['id' => $product_id, 'quantity' => $quantity];\n    }\n\n    header('Location: products.php');\n    exit;\n}\n\n$query = \"SELECT * FROM products\";\n$result = $conn->query($query);\n\n?>\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Products</title>\n</head>\n<body>\n\n<form action=\"\" method=\"post\">\n    <?php while ($product = $result->fetch_assoc()) { ?>\n        <div>\n            <h2><?php echo $product['name']; ?></h2>\n            <p>Price: <?php echo $product['price']; ?></p>\n            <input type=\"hidden\" name=\"product_id\" value=\"<?php echo $product['id']; ?>\">\n            <button type=\"submit\" name=\"add_to_cart\">Add to Cart</button>\n        </div>\n    <?php } ?>\n</form>\n\n<?php if (isset($_SESSION['cart'])) { ?>\n    <h2>Cart:</h2>\n    <ul>\n        <?php foreach ($_SESSION['cart'] as $item) { ?>\n            <li>\n                <?php echo $item['quantity']; ?> x <?php echo get_product_name($conn, $item['id']); ?>\n            </li>\n        <?php } ?>\n    </ul>\n<?php } ?>\n\n<?php function get_product_name($conn, $product_id) {\n    $query = \"SELECT name FROM products WHERE id = '$product_id'\";\n    $result = $conn->query($query);\n    return $result->fetch_assoc()['name'];\n} ?>\n</body>\n</html>\n```\n\n**cart.php**\n\n```php\n<?php\nrequire_once 'config.php';\n\nif (isset($_POST['update_cart'])) {\n    foreach ($_SESSION['cart'] as &$item) {\n        if ($item['id'] == $_POST['product_id']) {\n            $item['quantity'] = $_POST['quantity'];\n            break;\n        }\n    }\n\n    header('Location: cart.php');\n    exit;\n}\n\nif (isset($_POST['remove_from_cart'])) {\n    foreach ($_SESSION['cart'] as $key => &$item) {\n        if ($item['id'] == $_POST['product_id']) {\n            unset($_SESSION['cart'][$key]);\n            break;\n        }\n    }\n\n    header('Location: cart.php');\n    exit;\n}\n\nif (isset($_POST['place_order'])) {\n    $total = 0;\n\n    foreach ($_SESSION['cart'] as $item) {\n        $query = \"INSERT INTO order_items (order_id, product_id, quantity) VALUES ('', '$item[id]', '$item[quantity]')\";\n        $conn->query($query);\n\n        $query = \"SELECT id FROM orders WHERE user_id = '\".$_SESSION['user_id'].\"'\";\n        $result = $conn->query($query);\n        $order_id = $result->fetch_assoc()['id'];\n\n        $total += get_product_price($conn, $item['id']) * $item['quantity'];\n    }\n\n    $query = \"UPDATE orders SET total = '$total' WHERE user_id = '\".$_SESSION['user_id'].\"'\";\n    $conn->query($query);\n\n    header('Location: order.php');\n    exit;\n}\n\n?>\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Cart</title>\n</head>\n<body>\n\n<form action=\"\" method=\"post\">\n    <?php foreach ($_SESSION['cart'] as $item) { ?>\n        <div>\n            <h2><?php echo get_product_name($conn, $item['id']); ?></h2>\n            <p>Quantity: <?php echo $item['quantity']; ?></p>\n            <input type=\"hidden\" name=\"product_id\" value=\"<?php echo $item['id']; ?>\">\n            <button type=\"submit\" name=\"update_cart\">Update Quantity</button>\n        </div>\n    <?php } ?>\n</form>\n\n<form action=\"\" method=\"post\">\n    <?php foreach ($_SESSION['cart'] as $key => $item) { ?>\n        <div>\n            <input type=\"hidden\" name=\"product_id[]\" value=\"<?php echo $item['id']; ?>\">\n            <button type=\"submit\" name=\"remove_from_cart\">Remove from Cart</button>\n        </div>\n    <?php } ?>\n</form>\n\n<form action=\"\" method=\"post\">\n    Total: <?php echo $_SESSION['cart'][0]['quantity'] * get_product_price($conn, $_SESSION['cart'][0]['id']); ?><br><br>\n    <input type=\"submit\" name=\"place_order\" value=\"Place Order\">\n</form>\n\n<?php function get_product_price($conn, $product_id) {\n    $query = \"SELECT price FROM products WHERE id = '$product_id'\";\n    $result = $conn->query($query);\n    return $result->fetch_assoc()['price'];\n} ?>\n</body>\n</html>\n```\n\n**order.php**\n\n```php\n<?php\nrequire_once 'config.php';\n\n?>\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Order</title>\n</head>\n<body>\n\n<h2>Your Order:</h2>\n\n<table border=\"1\">\n    <?php $query = \"SELECT * FROM order_items WHERE order_id = '\".$_SESSION['user_id'].\"'\";\n    $result = $conn->query($query); ?>\n    <tr>\n        <th>Product Name</th>\n        <th>Quantity</th>\n        <th>Total Price</th>\n    </tr>\n    <?php while ($item = $result->fetch_assoc()) { ?>\n        <tr>\n            <td><?php echo get_product_name($conn, $item['product_id']); ?></td>\n            <td><?php echo $item['quantity']; ?></td>\n            <td><?php echo $item['quantity'] * get_product_price($conn, $item['product_id']); ?></td>\n        </tr>\n    <?php } ?>\n</table>\n\nTotal: <?php $query = \"SELECT total FROM orders WHERE user_id = '\".$_SESSION['user_id'].\"'\";\n$result = $conn->query($query); echo $result->fetch_assoc()['total']; ?>\n\n<?php function get_product_name($conn, $product_id) {\n    $query = \"SELECT name FROM products WHERE id = '$product_id'\";\n    $result = $conn->query($query);\n    return $result->fetch_assoc()['name'];\n} ?>\n</body>\n</html>\n```\n\nThis is a basic implementation of a purchase functionality. You should consider adding security measures, validation, and error handling to make it more robust.\n\n**Note:** This code uses `mysqli` extension which is deprecated in PHP 7.2 and removed in PHP 8.0. Consider using PDO or prepared statements for better security.", "code_blocks": [null, "```php\n<?php\ndefine('DB_HOST', 'localhost');\ndefine('DB_USERNAME', 'your_username');\ndefine('DB_PASSWORD', 'your_password');\ndefine('DB_NAME', 'your_database_name');\n\n$conn = new mysqli(DB_HOST, DB_USERNAME, DB_PASSWORD, DB_NAME);\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n?>\n```", "```php\n<?php\nrequire_once 'config.php';\n\nif (isset($_POST['username']) && isset($_POST['password'])) {\n    $username = $_POST['username'];\n    $password = $_POST['password'];\n\n    $query = \"SELECT * FROM users WHERE username = '$username' AND password = '$password'\";\n    $result = $conn->query($query);\n    if ($result->num_rows > 0) {\n        session_start();\n        $_SESSION['user_id'] = $result->fetch_assoc()['id'];\n        header('Location: products.php');\n        exit;\n    } else {\n        echo 'Invalid username or password';\n    }\n}\n?>\n```", "```php\n<?php\nrequire_once 'config.php';\n\nif (isset($_POST['add_to_cart'])) {\n    $product_id = $_POST['product_id'];\n    $quantity = $_POST['quantity'];\n\n    if (isset($_SESSION['cart'])) {\n        foreach ($_SESSION['cart'] as &$item) {\n            if ($item['id'] == $product_id) {\n                $item['quantity'] += $quantity;\n                break;\n            }\n        }\n    } else {\n        $_SESSION['cart'][] = ['id' => $product_id, 'quantity' => $quantity];\n    }\n\n    header('Location: products.php');\n    exit;\n}\n\n$query = \"SELECT * FROM products\";\n$result = $conn->query($query);\n\n?>\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Products</title>\n</head>\n<body>\n\n<form action=\"\" method=\"post\">\n    <?php while ($product = $result->fetch_assoc()) { ?>\n        <div>\n            <h2><?php echo $product['name']; ?></h2>\n            <p>Price: <?php echo $product['price']; ?></p>\n            <input type=\"hidden\" name=\"product_id\" value=\"<?php echo $product['id']; ?>\">\n            <button type=\"submit\" name=\"add_to_cart\">Add to Cart</button>\n        </div>\n    <?php } ?>\n</form>\n\n<?php if (isset($_SESSION['cart'])) { ?>\n    <h2>Cart:</h2>\n    <ul>\n        <?php foreach ($_SESSION['cart'] as $item) { ?>\n            <li>\n                <?php echo $item['quantity']; ?> x <?php echo get_product_name($conn, $item['id']); ?>\n            </li>\n        <?php } ?>\n    </ul>\n<?php } ?>\n\n<?php function get_product_name($conn, $product_id) {\n    $query = \"SELECT name FROM products WHERE id = '$product_id'\";\n    $result = $conn->query($query);\n    return $result->fetch_assoc()['name'];\n} ?>\n</body>\n</html>\n```", "```php\n<?php\nrequire_once 'config.php';\n\nif (isset($_POST['update_cart'])) {\n    foreach ($_SESSION['cart'] as &$item) {\n        if ($item['id'] == $_POST['product_id']) {\n            $item['quantity'] = $_POST['quantity'];\n            break;\n        }\n    }\n\n    header('Location: cart.php');\n    exit;\n}\n\nif (isset($_POST['remove_from_cart'])) {\n    foreach ($_SESSION['cart'] as $key => &$item) {\n        if ($item['id'] == $_POST['product_id']) {\n            unset($_SESSION['cart'][$key]);\n            break;\n        }\n    }\n\n    header('Location: cart.php');\n    exit;\n}\n\nif (isset($_POST['place_order'])) {\n    $total = 0;\n\n    foreach ($_SESSION['cart'] as $item) {\n        $query = \"INSERT INTO order_items (order_id, product_id, quantity) VALUES ('', '$item[id]', '$item[quantity]')\";\n        $conn->query($query);\n\n        $query = \"SELECT id FROM orders WHERE user_id = '\".$_SESSION['user_id'].\"'\";\n        $result = $conn->query($query);\n        $order_id = $result->fetch_assoc()['id'];\n\n        $total += get_product_price($conn, $item['id']) * $item['quantity'];\n    }\n\n    $query = \"UPDATE orders SET total = '$total' WHERE user_id = '\".$_SESSION['user_id'].\"'\";\n    $conn->query($query);\n\n    header('Location: order.php');\n    exit;\n}\n\n?>\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Cart</title>\n</head>\n<body>\n\n<form action=\"\" method=\"post\">\n    <?php foreach ($_SESSION['cart'] as $item) { ?>\n        <div>\n            <h2><?php echo get_product_name($conn, $item['id']); ?></h2>\n            <p>Quantity: <?php echo $item['quantity']; ?></p>\n            <input type=\"hidden\" name=\"product_id\" value=\"<?php echo $item['id']; ?>\">\n            <button type=\"submit\" name=\"update_cart\">Update Quantity</button>\n        </div>\n    <?php } ?>\n</form>\n\n<form action=\"\" method=\"post\">\n    <?php foreach ($_SESSION['cart'] as $key => $item) { ?>\n        <div>\n            <input type=\"hidden\" name=\"product_id[]\" value=\"<?php echo $item['id']; ?>\">\n            <button type=\"submit\" name=\"remove_from_cart\">Remove from Cart</button>\n        </div>\n    <?php } ?>\n</form>\n\n<form action=\"\" method=\"post\">\n    Total: <?php echo $_SESSION['cart'][0]['quantity'] * get_product_price($conn, $_SESSION['cart'][0]['id']); ?><br><br>\n    <input type=\"submit\" name=\"place_order\" value=\"Place Order\">\n</form>\n\n<?php function get_product_price($conn, $product_id) {\n    $query = \"SELECT price FROM products WHERE id = '$product_id'\";\n    $result = $conn->query($query);\n    return $result->fetch_assoc()['price'];\n} ?>\n</body>\n</html>\n```", "```php\n<?php\nrequire_once 'config.php';\n\n?>\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Order</title>\n</head>\n<body>\n\n<h2>Your Order:</h2>\n\n<table border=\"1\">\n    <?php $query = \"SELECT * FROM order_items WHERE order_id = '\".$_SESSION['user_id'].\"'\";\n    $result = $conn->query($query); ?>\n    <tr>\n        <th>Product Name</th>\n        <th>Quantity</th>\n        <th>Total Price</th>\n    </tr>\n    <?php while ($item = $result->fetch_assoc()) { ?>\n        <tr>\n            <td><?php echo get_product_name($conn, $item['product_id']); ?></td>\n            <td><?php echo $item['quantity']; ?></td>\n            <td><?php echo $item['quantity'] * get_product_price($conn, $item['product_id']); ?></td>\n        </tr>\n    <?php } ?>\n</table>\n\nTotal: <?php $query = \"SELECT total FROM orders WHERE user_id = '\".$_SESSION['user_id'].\"'\";\n$result = $conn->query($query); echo $result->fetch_assoc()['total']; ?>\n\n<?php function get_product_name($conn, $product_id) {\n    $query = \"SELECT name FROM products WHERE id = '$product_id'\";\n    $result = $conn->query($query);\n    return $result->fetch_assoc()['name'];\n} ?>\n</body>\n</html>\n```"]}
