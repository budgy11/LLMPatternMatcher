{"prompt": "Create a user login function using php", "llm_output": "Here's an example of how you can create a basic user login function in PHP. This code includes error handling and password hashing for security.\n\n### User Login Function\n\n```php\n// db.php (database connection)\n<?php\n$servername = \"localhost\";\n$username = \"username\";\n$password = \"password\";\n$dbname = \"mydatabase\";\n\n$conn = new mysqli($servername, $username, $password, $dbname);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n?>\n```\n\n```php\n// login.php (user login script)\n<?php\nrequire_once 'db.php';\n\nfunction user_login() {\n    if (isset($_POST['username']) && isset($_POST['password'])) {\n        $username = $_POST['username'];\n        $password = $_POST['password'];\n\n        // Password hashing using SHA-256 and SHA-1 for comparison with stored hash.\n        $hashed_password = sha1($password);\n\n        $sql = \"SELECT * FROM users WHERE username='$username' AND password='$hashed_password'\";\n        $result = mysqli_query($conn, $sql);\n\n        if ($result->num_rows > 0) {\n            while ($row = $result->fetch_assoc()) {\n                if ($row['status'] == 1 && $row['role'] == 'user') {\n                    session_start();\n                    $_SESSION['username'] = $username;\n                    $_SESSION['logged_in'] = true;\n\n                    echo \"Login Success!\";\n                    header('Location: dashboard.php');\n                } else {\n                    echo \"Access denied. User status is not active or role is not user.\";\n                }\n            }\n        } else {\n            echo \"Invalid username and password\";\n        }\n\n        mysqli_close($conn);\n    }\n}\n?>\n```\n\n### Example Usage\n\n```php\n// login.html (example login form)\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <title>Login</title>\n</head>\n<body>\n\n<form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\" id=\"login-form\">\n    <input type=\"text\" name=\"username\" placeholder=\"Username\"><br><br>\n    <input type=\"password\" name=\"password\" placeholder=\"Password\"><br><br>\n    <button type=\"submit\">Login</button>\n</form>\n\n<?php\nrequire_once 'db.php';\nuser_login();\n?>\n</body>\n</html>\n```\n\nThis code creates a simple user login system where users can log in with their username and password. It includes basic error handling for invalid usernames and passwords, as well as checks to ensure the user status is active and role is set to \"user\" before granting access to the dashboard.\n\n### Notes\n\n- For security reasons, consider using more advanced encryption methods such as bcrypt or PBKDF2 instead of SHA-1 for password hashing.\n- This code does not handle cases where a user might be trying to log in with an existing session. To prevent this, you can implement a session verification mechanism on each page load.\n- Remember to always validate and sanitize any input from users to prevent SQL injection attacks.\n- This is just a basic example, consider implementing additional security measures such as password reset functionality, forgot password emails, etc.", "code_blocks": ["```php\n// db.php (database connection)\n<?php\n$servername = \"localhost\";\n$username = \"username\";\n$password = \"password\";\n$dbname = \"mydatabase\";\n\n$conn = new mysqli($servername, $username, $password, $dbname);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n?>\n```", "```php\n// login.php (user login script)\n<?php\nrequire_once 'db.php';\n\nfunction user_login() {\n    if (isset($_POST['username']) && isset($_POST['password'])) {\n        $username = $_POST['username'];\n        $password = $_POST['password'];\n\n        // Password hashing using SHA-256 and SHA-1 for comparison with stored hash.\n        $hashed_password = sha1($password);\n\n        $sql = \"SELECT * FROM users WHERE username='$username' AND password='$hashed_password'\";\n        $result = mysqli_query($conn, $sql);\n\n        if ($result->num_rows > 0) {\n            while ($row = $result->fetch_assoc()) {\n                if ($row['status'] == 1 && $row['role'] == 'user') {\n                    session_start();\n                    $_SESSION['username'] = $username;\n                    $_SESSION['logged_in'] = true;\n\n                    echo \"Login Success!\";\n                    header('Location: dashboard.php');\n                } else {\n                    echo \"Access denied. User status is not active or role is not user.\";\n                }\n            }\n        } else {\n            echo \"Invalid username and password\";\n        }\n\n        mysqli_close($conn);\n    }\n}\n?>\n```", "```php\n// login.html (example login form)\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <title>Login</title>\n</head>\n<body>\n\n<form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\" id=\"login-form\">\n    <input type=\"text\" name=\"username\" placeholder=\"Username\"><br><br>\n    <input type=\"password\" name=\"password\" placeholder=\"Password\"><br><br>\n    <button type=\"submit\">Login</button>\n</form>\n\n<?php\nrequire_once 'db.php';\nuser_login();\n?>\n</body>\n</html>\n```"]}
