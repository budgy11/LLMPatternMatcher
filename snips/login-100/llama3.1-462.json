{"prompt": "Create a user login function using php", "llm_output": "**User Login Function in PHP**\n=====================================\n\nBelow is an example of a basic user login function in PHP. This example uses prepared statements for security and hashing passwords for secure password storage.\n\n**login.php**\n```php\n<?php\n\n// Database connection settings\n$servername = \"localhost\";\n$username = \"username\";\n$password = \"password\";\n$dbname = \"database_name\";\n\n// Create a new database connection\n$conn = new mysqli($servername, $username, $password, $dbname);\n\n// Check for errors in the database connection\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\nfunction login_user() {\n    // Get input data from the form\n    $email = $_POST['email'];\n    $password = $_POST['password'];\n\n    // Prepare SQL query to select user's password hash and salt\n    $stmt = $conn->prepare(\"SELECT password_hash, email FROM users WHERE email = ?\");\n    $stmt->bind_param(\"s\", $email);\n    $stmt->execute();\n    $result = $stmt->get_result();\n\n    if ($result->num_rows == 1) {\n        // Fetch user's data\n        $row = $result->fetch_assoc();\n        $password_hash = $row['password_hash'];\n        $user_email = $row['email'];\n\n        // Verify password using hashing and comparison\n        $is_valid_password = password_verify($password, $password_hash);\n\n        if ($is_valid_password) {\n            // Login successful, generate a session for the user\n            $_SESSION['logged_in'] = true;\n            $_SESSION['user_email'] = $user_email;\n\n            header(\"Location: dashboard.php\");\n            exit();\n        } else {\n            echo \"Invalid password\";\n        }\n    } else {\n        echo \"User not found\";\n    }\n\n    // Close prepared statement and connection\n    $stmt->close();\n    $conn->close();\n}\n\n// Check for POST request to the login form\nif ($_SERVER[\"REQUEST_METHOD\"] == \"POST\") {\n    login_user();\n} else {\n    // Display login form if there is no POST request\n    ?>\n    <form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\">\n        Email: <input type=\"email\" name=\"email\"><br><br>\n        Password: <input type=\"password\" name=\"password\"><br><br>\n        <input type=\"submit\" value=\"Login\">\n    </form>\n    <?php\n}\n?>\n```\n**Explanation**\n\n1. This script connects to a MySQL database using prepared statements for security.\n2. The `login_user()` function retrieves the input data from the login form and checks if the user exists in the database by matching their email address.\n3. If the user is found, it fetches the password hash and salt from the database.\n4. It then verifies the input password against the stored password hash using PHP's built-in `password_verify()` function.\n5. If the password is valid, a session for the user is generated, and they are redirected to the dashboard page.\n\n**Note**: This example uses PHP 7's prepared statements and hashing functions for security. You should adapt it according to your specific database connection settings and requirements. Additionally, make sure to update the `login_user()` function to match your database schema and table structure.", "code_blocks": ["```php\n<?php\n\n// Database connection settings\n$servername = \"localhost\";\n$username = \"username\";\n$password = \"password\";\n$dbname = \"database_name\";\n\n// Create a new database connection\n$conn = new mysqli($servername, $username, $password, $dbname);\n\n// Check for errors in the database connection\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\nfunction login_user() {\n    // Get input data from the form\n    $email = $_POST['email'];\n    $password = $_POST['password'];\n\n    // Prepare SQL query to select user's password hash and salt\n    $stmt = $conn->prepare(\"SELECT password_hash, email FROM users WHERE email = ?\");\n    $stmt->bind_param(\"s\", $email);\n    $stmt->execute();\n    $result = $stmt->get_result();\n\n    if ($result->num_rows == 1) {\n        // Fetch user's data\n        $row = $result->fetch_assoc();\n        $password_hash = $row['password_hash'];\n        $user_email = $row['email'];\n\n        // Verify password using hashing and comparison\n        $is_valid_password = password_verify($password, $password_hash);\n\n        if ($is_valid_password) {\n            // Login successful, generate a session for the user\n            $_SESSION['logged_in'] = true;\n            $_SESSION['user_email'] = $user_email;\n\n            header(\"Location: dashboard.php\");\n            exit();\n        } else {\n            echo \"Invalid password\";\n        }\n    } else {\n        echo \"User not found\";\n    }\n\n    // Close prepared statement and connection\n    $stmt->close();\n    $conn->close();\n}\n\n// Check for POST request to the login form\nif ($_SERVER[\"REQUEST_METHOD\"] == \"POST\") {\n    login_user();\n} else {\n    // Display login form if there is no POST request\n    ?>\n    <form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\">\n        Email: <input type=\"email\" name=\"email\"><br><br>\n        Password: <input type=\"password\" name=\"password\"><br><br>\n        <input type=\"submit\" value=\"Login\">\n    </form>\n    <?php\n}\n?>\n```"]}
