{"prompt": "Create a forgot password function using php", "llm_output": "Here is an example of a forgotten password function in PHP that sends a reset link to the user's email address:\n\n**forgot-password.php**\n```php\n<?php\n\n// Configuration variables\ndefine('RESET_LINK_EXPIRE', 60); // minutes\ndefine('RESET_LINK_SECRET', 'your_secret_key_here'); // replace with your own secret key\n\n// Get the user's email from the form submission\n$email = $_POST['email'];\n\n// Validate the user's email address\nif (!filter_var($email, FILTER_VALIDATE_EMAIL)) {\n    echo 'Invalid email address';\n    exit;\n}\n\n// Connect to the database (replace with your own connection code)\n$db = mysqli_connect('localhost', 'username', 'password', 'database_name');\nif (!$db) {\n    die('Error connecting to database: ' . mysqli_error($db));\n}\n\n// Query the database for the user's account information\n$query = \"SELECT * FROM users WHERE email = '$email'\";\n$result = mysqli_query($db, $query);\nif (mysqli_num_rows($result) == 0) {\n    echo 'No account found with that email address';\n    exit;\n}\n\n// Retrieve the user's account information from the database\n$user_data = mysqli_fetch_array($result);\n\n// Generate a unique reset link for the user\n$reset_link = hash_hmac('sha256', $user_data['id'] . time(), RESET_LINK_SECRET);\n$reset_link_expires_at = date('Y-m-d H:i:s', time() + (RESET_LINK_EXPIRE * 60));\n\n// Update the database with the new reset link and expiration time\n$query = \"UPDATE users SET reset_link = '$reset_link', reset_link_expires_at = '$reset_link_expires_at' WHERE id = '\" . $user_data['id'] . \"'\";\nmysqli_query($db, $query);\n\n// Send a reset link to the user's email address\n$subject = 'Reset your password';\n$message = \"Click this link to reset your password: <a href='\" . BASE_URL . \"/reset-password.php?reset_link=\" . $reset_link . \"'>\" . BASE_URL . \"/reset-password.php?reset_link=\" . $reset_link . \"</a>\";\n$headers = 'From: Your Email Address <your_email@example.com>' . \"\\r\\n\" .\n          'Reply-To: your_email@example.com' . \"\\r\\n\" .\n          'Content-Type: text/html; charset=UTF-8';\nmail($email, $subject, $message, $headers);\n\necho 'A password reset link has been sent to your email address. Check your inbox and follow the instructions to reset your password.';\n\n?>\n```\n**reset-password.php**\n```php\n<?php\n\n// Configuration variables\ndefine('BASE_URL', 'https://your_domain.com'); // replace with your own domain URL\n\n// Get the reset link from the query string\n$reset_link = $_GET['reset_link'];\n\n// Validate the reset link\nif (!hash_hmac_verify($reset_link, '', RESET_LINK_SECRET)) {\n    echo 'Invalid reset link';\n    exit;\n}\n\n// Connect to the database (replace with your own connection code)\n$db = mysqli_connect('localhost', 'username', 'password', 'database_name');\nif (!$db) {\n    die('Error connecting to database: ' . mysqli_error($db));\n}\n\n// Query the database for the user's account information\n$query = \"SELECT * FROM users WHERE reset_link = '$reset_link' AND reset_link_expires_at > NOW()\";\n$result = mysqli_query($db, $query);\nif (mysqli_num_rows($result) == 0) {\n    echo 'Reset link has expired';\n    exit;\n}\n\n// Retrieve the user's account information from the database\n$user_data = mysqli_fetch_array($result);\n\n// Prompt the user to enter their new password\n?>\n<form action=\"<?php echo BASE_URL; ?>/update-password.php\" method=\"post\">\n    <input type=\"hidden\" name=\"user_id\" value=\"<?php echo $user_data['id']; ?>\">\n    <label for=\"new_password\">New Password:</label>\n    <input type=\"password\" id=\"new_password\" name=\"new_password\"><br><br>\n    <label for=\"confirm_password\">Confirm New Password:</label>\n    <input type=\"password\" id=\"confirm_password\" name=\"confirm_password\"><br><br>\n    <input type=\"submit\" value=\"Reset Password\">\n</form>\n\n<?php\n?>\n```\n**update-password.php**\n```php\n<?php\n\n// Get the user's ID from the form submission\n$user_id = $_POST['user_id'];\n\n// Get the new password and confirmation from the form submission\n$new_password = $_POST['new_password'];\n$confirm_password = $_POST['confirm_password'];\n\n// Validate the new password and confirmation\nif ($new_password != $confirm_password) {\n    echo 'Passwords do not match';\n    exit;\n}\n\n// Connect to the database (replace with your own connection code)\n$db = mysqli_connect('localhost', 'username', 'password', 'database_name');\nif (!$db) {\n    die('Error connecting to database: ' . mysqli_error($db));\n}\n\n// Update the user's password in the database\n$query = \"UPDATE users SET password = '$new_password' WHERE id = '\" . $user_id . \"'\";\nmysqli_query($db, $query);\n\n// Clear the reset link from the database\n$query = \"UPDATE users SET reset_link = NULL, reset_link_expires_at = NULL WHERE id = '\" . $user_id . \"'\";\nmysqli_query($db, $query);\n\necho 'Your password has been successfully reset. You can now log in with your new credentials.';\n\n?>\n```\nNote that this is just an example implementation and you should adjust the code to fit your specific needs. Additionally, make sure to replace the placeholders (e.g. `your_secret_key_here`, `localhost`, etc.) with your own values.\n\nAlso, keep in mind that storing passwords in plain text is not recommended. You should use a secure password hashing algorithm like bcrypt or Argon2 to store passwords securely.", "code_blocks": ["```php\n<?php\n\n// Configuration variables\ndefine('RESET_LINK_EXPIRE', 60); // minutes\ndefine('RESET_LINK_SECRET', 'your_secret_key_here'); // replace with your own secret key\n\n// Get the user's email from the form submission\n$email = $_POST['email'];\n\n// Validate the user's email address\nif (!filter_var($email, FILTER_VALIDATE_EMAIL)) {\n    echo 'Invalid email address';\n    exit;\n}\n\n// Connect to the database (replace with your own connection code)\n$db = mysqli_connect('localhost', 'username', 'password', 'database_name');\nif (!$db) {\n    die('Error connecting to database: ' . mysqli_error($db));\n}\n\n// Query the database for the user's account information\n$query = \"SELECT * FROM users WHERE email = '$email'\";\n$result = mysqli_query($db, $query);\nif (mysqli_num_rows($result) == 0) {\n    echo 'No account found with that email address';\n    exit;\n}\n\n// Retrieve the user's account information from the database\n$user_data = mysqli_fetch_array($result);\n\n// Generate a unique reset link for the user\n$reset_link = hash_hmac('sha256', $user_data['id'] . time(), RESET_LINK_SECRET);\n$reset_link_expires_at = date('Y-m-d H:i:s', time() + (RESET_LINK_EXPIRE * 60));\n\n// Update the database with the new reset link and expiration time\n$query = \"UPDATE users SET reset_link = '$reset_link', reset_link_expires_at = '$reset_link_expires_at' WHERE id = '\" . $user_data['id'] . \"'\";\nmysqli_query($db, $query);\n\n// Send a reset link to the user's email address\n$subject = 'Reset your password';\n$message = \"Click this link to reset your password: <a href='\" . BASE_URL . \"/reset-password.php?reset_link=\" . $reset_link . \"'>\" . BASE_URL . \"/reset-password.php?reset_link=\" . $reset_link . \"</a>\";\n$headers = 'From: Your Email Address <your_email@example.com>' . \"\\r\\n\" .\n          'Reply-To: your_email@example.com' . \"\\r\\n\" .\n          'Content-Type: text/html; charset=UTF-8';\nmail($email, $subject, $message, $headers);\n\necho 'A password reset link has been sent to your email address. Check your inbox and follow the instructions to reset your password.';\n\n?>\n```", "```php\n<?php\n\n// Configuration variables\ndefine('BASE_URL', 'https://your_domain.com'); // replace with your own domain URL\n\n// Get the reset link from the query string\n$reset_link = $_GET['reset_link'];\n\n// Validate the reset link\nif (!hash_hmac_verify($reset_link, '', RESET_LINK_SECRET)) {\n    echo 'Invalid reset link';\n    exit;\n}\n\n// Connect to the database (replace with your own connection code)\n$db = mysqli_connect('localhost', 'username', 'password', 'database_name');\nif (!$db) {\n    die('Error connecting to database: ' . mysqli_error($db));\n}\n\n// Query the database for the user's account information\n$query = \"SELECT * FROM users WHERE reset_link = '$reset_link' AND reset_link_expires_at > NOW()\";\n$result = mysqli_query($db, $query);\nif (mysqli_num_rows($result) == 0) {\n    echo 'Reset link has expired';\n    exit;\n}\n\n// Retrieve the user's account information from the database\n$user_data = mysqli_fetch_array($result);\n\n// Prompt the user to enter their new password\n?>\n<form action=\"<?php echo BASE_URL; ?>/update-password.php\" method=\"post\">\n    <input type=\"hidden\" name=\"user_id\" value=\"<?php echo $user_data['id']; ?>\">\n    <label for=\"new_password\">New Password:</label>\n    <input type=\"password\" id=\"new_password\" name=\"new_password\"><br><br>\n    <label for=\"confirm_password\">Confirm New Password:</label>\n    <input type=\"password\" id=\"confirm_password\" name=\"confirm_password\"><br><br>\n    <input type=\"submit\" value=\"Reset Password\">\n</form>\n\n<?php\n?>\n```", "```php\n<?php\n\n// Get the user's ID from the form submission\n$user_id = $_POST['user_id'];\n\n// Get the new password and confirmation from the form submission\n$new_password = $_POST['new_password'];\n$confirm_password = $_POST['confirm_password'];\n\n// Validate the new password and confirmation\nif ($new_password != $confirm_password) {\n    echo 'Passwords do not match';\n    exit;\n}\n\n// Connect to the database (replace with your own connection code)\n$db = mysqli_connect('localhost', 'username', 'password', 'database_name');\nif (!$db) {\n    die('Error connecting to database: ' . mysqli_error($db));\n}\n\n// Update the user's password in the database\n$query = \"UPDATE users SET password = '$new_password' WHERE id = '\" . $user_id . \"'\";\nmysqli_query($db, $query);\n\n// Clear the reset link from the database\n$query = \"UPDATE users SET reset_link = NULL, reset_link_expires_at = NULL WHERE id = '\" . $user_id . \"'\";\nmysqli_query($db, $query);\n\necho 'Your password has been successfully reset. You can now log in with your new credentials.';\n\n?>\n```"]}
