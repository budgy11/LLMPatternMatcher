{"prompt": "Create a forgot password function using php", "llm_output": "Here's an example of how you can implement a \"Forgot Password\" functionality in PHP. This will send the user an email with a link to reset their password.\n\n**Database Schema**\n\nFirst, let's create a table called `users` in your database with columns for `username`, `email`, and `password`.\n\n```sql\nCREATE TABLE users (\n    id INT PRIMARY KEY AUTO_INCREMENT,\n    username VARCHAR(255),\n    email VARCHAR(255),\n    password VARCHAR(255)\n);\n```\n\n**PHP Code**\n\nCreate a new PHP file, e.g., `forgot_password.php` and add the following code:\n\n```php\n<?php\n\n// Configuration\ndefine('APP_URL', 'http://example.com');\n\n// Database connection settings\n$host = 'localhost';\n$dbname = 'your_database_name';\n$username = 'your_database_username';\n$password = 'your_database_password';\n\n// Connect to database\ntry {\n    $conn = new PDO(\"mysql:host=$host;dbname=$dbname\", $username, $password);\n} catch (PDOException $e) {\n    echo \"Connection failed: \" . $e->getMessage();\n}\n\nif ($_SERVER['REQUEST_METHOD'] === 'POST') {\n\n    // Get the user's email\n    $email = $_POST['email'];\n\n    // Check if the email exists in the database\n    $stmt = $conn->prepare(\"SELECT * FROM users WHERE email=:email\");\n    $stmt->bindParam(':email', $email);\n    $stmt->execute();\n\n    // Fetch the user data\n    $user_data = $stmt->fetch();\n\n    if ($user_data) {\n\n        // Generate a random token for password reset\n        $token = bin2hex(random_bytes(16));\n\n        // Update the user's token in the database\n        $update_stmt = $conn->prepare(\"UPDATE users SET password_token=:token WHERE email=:email\");\n        $update_stmt->bindParam(':token', $token);\n        $update_stmt->bindParam(':email', $email);\n        $update_stmt->execute();\n\n        // Send an email with a link to reset the password\n        $subject = 'Reset your password';\n        $message = '\n            <p>Click on the following link to reset your password:</p>\n            <p><a href=\"' . APP_URL . '/reset_password.php?email=' . urlencode($email) . '&token=' . $token . '\">Reset Password</a></p>\n            ';\n        $headers = 'From: no-reply@example.com' . \"\\r\\n\" .\n            'Content-Type: text/html; charset=UTF-8' . \"\\r\\n\";\n\n        mail($email, $subject, $message, $headers);\n\n        echo \"An email with password reset link has been sent to your registered email address.\";\n    } else {\n        echo \"Email not found in the database.\";\n    }\n}\n\n?>\n\n<!-- HTML Form -->\n<form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\">\n    <label for=\"email\">Enter your email:</label>\n    <input type=\"email\" id=\"email\" name=\"email\" required>\n\n    <button type=\"submit\">Send Password Reset Link</button>\n</form>\n```\n\n**reset_password.php**\n\nCreate a new PHP file, e.g., `reset_password.php` and add the following code:\n\n```php\n<?php\n\n// Configuration\ndefine('APP_URL', 'http://example.com');\n\n// Database connection settings\n$host = 'localhost';\n$dbname = 'your_database_name';\n$username = 'your_database_username';\n$password = 'your_database_password';\n\n// Connect to database\ntry {\n    $conn = new PDO(\"mysql:host=$host;dbname=$dbname\", $username, $password);\n} catch (PDOException $e) {\n    echo \"Connection failed: \" . $e->getMessage();\n}\n\n// Get the email and token from the URL query string\n$email = $_GET['email'];\n$token = $_GET['token'];\n\n// Check if the user's token matches the one in the database\n$stmt = $conn->prepare(\"SELECT * FROM users WHERE email=:email AND password_token=:token\");\n$stmt->bindParam(':email', $email);\n$stmt->bindParam(':token', $token);\n$stmt->execute();\n\n// Fetch the user data\n$user_data = $stmt->fetch();\n\nif ($user_data) {\n\n    // Display a form to enter new password\n?>\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Reset Password</title>\n</head>\n<body>\n\n<form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\">\n    <label for=\"new_password\">Enter your new password:</label>\n    <input type=\"password\" id=\"new_password\" name=\"new_password\" required>\n\n    <button type=\"submit\">Reset Password</button>\n</form>\n\n<?php\n} else {\n    echo \"Invalid token.\";\n}\n\nif ($_SERVER['REQUEST_METHOD'] === 'POST') {\n\n    // Get the new password from the form\n    $new_password = $_POST['new_password'];\n\n    // Update the user's password in the database\n    $update_stmt = $conn->prepare(\"UPDATE users SET password=:password, password_token=NULL WHERE email=:email\");\n    $update_stmt->bindParam(':password', hash('sha256', $new_password));\n    $update_stmt->bindParam(':email', $email);\n    $update_stmt->execute();\n\n    echo \"Password reset successfully!\";\n}\n\n?>\n\n</body>\n</html>\n```\n\nThis is a basic example to get you started. You may want to improve it by adding more security measures, such as validating the token and checking for rate limits on password resets.", "code_blocks": [null, "```php\n<?php\n\n// Configuration\ndefine('APP_URL', 'http://example.com');\n\n// Database connection settings\n$host = 'localhost';\n$dbname = 'your_database_name';\n$username = 'your_database_username';\n$password = 'your_database_password';\n\n// Connect to database\ntry {\n    $conn = new PDO(\"mysql:host=$host;dbname=$dbname\", $username, $password);\n} catch (PDOException $e) {\n    echo \"Connection failed: \" . $e->getMessage();\n}\n\nif ($_SERVER['REQUEST_METHOD'] === 'POST') {\n\n    // Get the user's email\n    $email = $_POST['email'];\n\n    // Check if the email exists in the database\n    $stmt = $conn->prepare(\"SELECT * FROM users WHERE email=:email\");\n    $stmt->bindParam(':email', $email);\n    $stmt->execute();\n\n    // Fetch the user data\n    $user_data = $stmt->fetch();\n\n    if ($user_data) {\n\n        // Generate a random token for password reset\n        $token = bin2hex(random_bytes(16));\n\n        // Update the user's token in the database\n        $update_stmt = $conn->prepare(\"UPDATE users SET password_token=:token WHERE email=:email\");\n        $update_stmt->bindParam(':token', $token);\n        $update_stmt->bindParam(':email', $email);\n        $update_stmt->execute();\n\n        // Send an email with a link to reset the password\n        $subject = 'Reset your password';\n        $message = '\n            <p>Click on the following link to reset your password:</p>\n            <p><a href=\"' . APP_URL . '/reset_password.php?email=' . urlencode($email) . '&token=' . $token . '\">Reset Password</a></p>\n            ';\n        $headers = 'From: no-reply@example.com' . \"\\r\\n\" .\n            'Content-Type: text/html; charset=UTF-8' . \"\\r\\n\";\n\n        mail($email, $subject, $message, $headers);\n\n        echo \"An email with password reset link has been sent to your registered email address.\";\n    } else {\n        echo \"Email not found in the database.\";\n    }\n}\n\n?>\n\n<!-- HTML Form -->\n<form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\">\n    <label for=\"email\">Enter your email:</label>\n    <input type=\"email\" id=\"email\" name=\"email\" required>\n\n    <button type=\"submit\">Send Password Reset Link</button>\n</form>\n```", "```php\n<?php\n\n// Configuration\ndefine('APP_URL', 'http://example.com');\n\n// Database connection settings\n$host = 'localhost';\n$dbname = 'your_database_name';\n$username = 'your_database_username';\n$password = 'your_database_password';\n\n// Connect to database\ntry {\n    $conn = new PDO(\"mysql:host=$host;dbname=$dbname\", $username, $password);\n} catch (PDOException $e) {\n    echo \"Connection failed: \" . $e->getMessage();\n}\n\n// Get the email and token from the URL query string\n$email = $_GET['email'];\n$token = $_GET['token'];\n\n// Check if the user's token matches the one in the database\n$stmt = $conn->prepare(\"SELECT * FROM users WHERE email=:email AND password_token=:token\");\n$stmt->bindParam(':email', $email);\n$stmt->bindParam(':token', $token);\n$stmt->execute();\n\n// Fetch the user data\n$user_data = $stmt->fetch();\n\nif ($user_data) {\n\n    // Display a form to enter new password\n?>\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Reset Password</title>\n</head>\n<body>\n\n<form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\">\n    <label for=\"new_password\">Enter your new password:</label>\n    <input type=\"password\" id=\"new_password\" name=\"new_password\" required>\n\n    <button type=\"submit\">Reset Password</button>\n</form>\n\n<?php\n} else {\n    echo \"Invalid token.\";\n}\n\nif ($_SERVER['REQUEST_METHOD'] === 'POST') {\n\n    // Get the new password from the form\n    $new_password = $_POST['new_password'];\n\n    // Update the user's password in the database\n    $update_stmt = $conn->prepare(\"UPDATE users SET password=:password, password_token=NULL WHERE email=:email\");\n    $update_stmt->bindParam(':password', hash('sha256', $new_password));\n    $update_stmt->bindParam(':email', $email);\n    $update_stmt->execute();\n\n    echo \"Password reset successfully!\";\n}\n\n?>\n\n</body>\n</html>\n```"]}
