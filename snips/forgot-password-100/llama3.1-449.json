{"prompt": "Create a forgot password function using php", "llm_output": "Here is an example of a \"Forgot Password\" function in PHP, which includes the following features:\n\n1. User enters their email address on the login page.\n2. The system checks if the email exists in the database and sends a reset link to the user's email with a unique code.\n3. The user clicks on the reset link and is redirected to a new page where they can enter a new password.\n\n**Note:** This example assumes you have a MySQL database setup with a table named `users` containing columns `email`, `password`, and `reset_code`.\n\n**Database Setup:**\n\nCreate a new table in your MySQL database:\n```sql\nCREATE TABLE users (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  email VARCHAR(255) NOT NULL,\n  password VARCHAR(255) NOT NULL,\n  reset_code VARCHAR(255)\n);\n```\n**PHP Code:**\n```php\n// forgot_password.php\n\nrequire_once 'connect.php'; // include your database connection script\n\nif (isset($_POST['email'])) {\n    $email = $_POST['email'];\n\n    // Check if email exists in the database\n    $query = \"SELECT * FROM users WHERE email = '$email'\";\n    $result = mysqli_query($conn, $query);\n\n    if ($result) {\n        $user_data = mysqli_fetch_assoc($result);\n        \n        // If user data is found, generate a new reset code and send it to the user's email\n        if (!empty($user_data)) {\n            $new_reset_code = bin2hex(random_bytes(16));\n            \n            $query = \"UPDATE users SET reset_code = '$new_reset_code' WHERE id = '$user_data[id]'\";\n            mysqli_query($conn, $query);\n\n            // Send an email with a link to the new password page\n            $to      = $email;\n            $subject = 'Reset Password';\n            $message = '<a href=\"reset_password.php?code=' . $new_reset_code . '\">Click here to reset your password</a>';\n            mail($to, $subject, $message);\n\n            echo \"Email sent with a reset link. Please check your email.\";\n        } else {\n            echo \"Email not found in the database\";\n        }\n    } else {\n        echo \"Error checking user data\";\n    }\n\n    // Close the connection\n    mysqli_close($conn);\n} else {\n    ?>\n    <form action=\"\" method=\"post\">\n        Email: <input type=\"email\" name=\"email\"><br>\n        <input type=\"submit\" value=\"Reset Password\">\n    </form>\n    <?php\n}\n```\n\n**reset_password.php**\n\nThis script is called when the user clicks on the reset link in their email. It takes the reset code from the URL and displays a form for entering a new password.\n```php\n// reset_password.php\n\nrequire_once 'connect.php'; // include your database connection script\n\n$code = $_GET['code'];\n\nif (isset($code)) {\n    $query = \"SELECT * FROM users WHERE reset_code = '$code'\";\n    $result = mysqli_query($conn, $query);\n\n    if ($result) {\n        $user_data = mysqli_fetch_assoc($result);\n        \n        // If user data is found and the reset code matches, display a form for entering a new password\n        if (!empty($user_data)) {\n            ?>\n            <form action=\"\" method=\"post\">\n                Password: <input type=\"password\" name=\"new_password\"><br>\n                Confirm Password: <input type=\"password\" name=\"confirm_password\"><br>\n                <input type=\"hidden\" name=\"code\" value=\"<?php echo $code; ?>\">\n                <input type=\"submit\" value=\"Reset Password\">\n            </form>\n            <?php\n        } else {\n            echo \"Invalid reset code\";\n        }\n    } else {\n        echo \"Error checking user data\";\n    }\n\n    // Close the connection\n    mysqli_close($conn);\n} else {\n    ?>\n    <p>Invalid request</p>\n    <?php\n}\n```\n\n**Update Password Script:**\n```php\n// update_password.php\n\nrequire_once 'connect.php'; // include your database connection script\n\nif (isset($_POST['new_password'])) {\n    $code = $_POST['code'];\n    $new_password = $_POST['new_password'];\n\n    $query = \"SELECT * FROM users WHERE reset_code = '$code'\";\n    $result = mysqli_query($conn, $query);\n\n    if ($result) {\n        $user_data = mysqli_fetch_assoc($result);\n        \n        // If user data is found and the reset code matches, update the password\n        if (!empty($user_data)) {\n            $password_hash = password_hash($new_password, PASSWORD_DEFAULT);\n            \n            $query = \"UPDATE users SET password = '$password_hash', reset_code = '' WHERE id = '$user_data[id]'\";\n            mysqli_query($conn, $query);\n\n            echo \"Password updated successfully\";\n        } else {\n            echo \"Invalid reset code\";\n        }\n    } else {\n        echo \"Error checking user data\";\n    }\n\n    // Close the connection\n    mysqli_close($conn);\n}\n```\n\nRemember to replace `connect.php` with your actual database connection script.\n\nThis is a basic example and may need modifications based on your specific requirements.", "code_blocks": [null, "```php\n// forgot_password.php\n\nrequire_once 'connect.php'; // include your database connection script\n\nif (isset($_POST['email'])) {\n    $email = $_POST['email'];\n\n    // Check if email exists in the database\n    $query = \"SELECT * FROM users WHERE email = '$email'\";\n    $result = mysqli_query($conn, $query);\n\n    if ($result) {\n        $user_data = mysqli_fetch_assoc($result);\n        \n        // If user data is found, generate a new reset code and send it to the user's email\n        if (!empty($user_data)) {\n            $new_reset_code = bin2hex(random_bytes(16));\n            \n            $query = \"UPDATE users SET reset_code = '$new_reset_code' WHERE id = '$user_data[id]'\";\n            mysqli_query($conn, $query);\n\n            // Send an email with a link to the new password page\n            $to      = $email;\n            $subject = 'Reset Password';\n            $message = '<a href=\"reset_password.php?code=' . $new_reset_code . '\">Click here to reset your password</a>';\n            mail($to, $subject, $message);\n\n            echo \"Email sent with a reset link. Please check your email.\";\n        } else {\n            echo \"Email not found in the database\";\n        }\n    } else {\n        echo \"Error checking user data\";\n    }\n\n    // Close the connection\n    mysqli_close($conn);\n} else {\n    ?>\n    <form action=\"\" method=\"post\">\n        Email: <input type=\"email\" name=\"email\"><br>\n        <input type=\"submit\" value=\"Reset Password\">\n    </form>\n    <?php\n}\n```", "```php\n// reset_password.php\n\nrequire_once 'connect.php'; // include your database connection script\n\n$code = $_GET['code'];\n\nif (isset($code)) {\n    $query = \"SELECT * FROM users WHERE reset_code = '$code'\";\n    $result = mysqli_query($conn, $query);\n\n    if ($result) {\n        $user_data = mysqli_fetch_assoc($result);\n        \n        // If user data is found and the reset code matches, display a form for entering a new password\n        if (!empty($user_data)) {\n            ?>\n            <form action=\"\" method=\"post\">\n                Password: <input type=\"password\" name=\"new_password\"><br>\n                Confirm Password: <input type=\"password\" name=\"confirm_password\"><br>\n                <input type=\"hidden\" name=\"code\" value=\"<?php echo $code; ?>\">\n                <input type=\"submit\" value=\"Reset Password\">\n            </form>\n            <?php\n        } else {\n            echo \"Invalid reset code\";\n        }\n    } else {\n        echo \"Error checking user data\";\n    }\n\n    // Close the connection\n    mysqli_close($conn);\n} else {\n    ?>\n    <p>Invalid request</p>\n    <?php\n}\n```", "```php\n// update_password.php\n\nrequire_once 'connect.php'; // include your database connection script\n\nif (isset($_POST['new_password'])) {\n    $code = $_POST['code'];\n    $new_password = $_POST['new_password'];\n\n    $query = \"SELECT * FROM users WHERE reset_code = '$code'\";\n    $result = mysqli_query($conn, $query);\n\n    if ($result) {\n        $user_data = mysqli_fetch_assoc($result);\n        \n        // If user data is found and the reset code matches, update the password\n        if (!empty($user_data)) {\n            $password_hash = password_hash($new_password, PASSWORD_DEFAULT);\n            \n            $query = \"UPDATE users SET password = '$password_hash', reset_code = '' WHERE id = '$user_data[id]'\";\n            mysqli_query($conn, $query);\n\n            echo \"Password updated successfully\";\n        } else {\n            echo \"Invalid reset code\";\n        }\n    } else {\n        echo \"Error checking user data\";\n    }\n\n    // Close the connection\n    mysqli_close($conn);\n}\n```"]}
