{"prompt": "Create a forgot password function using php", "llm_output": "**Forgot Password Function in PHP**\n=====================================\n\nHere's an example of how to create a forgot password function in PHP. This function will send a reset password link to the user's email.\n\n**Database Schema**\n--------------------\n\nLet's assume we have a `users` table with the following columns:\n\n| Column Name | Data Type |\n| --- | --- |\n| id | int (primary key) |\n| email | varchar(255) |\n| password | varchar(255) |\n\n**PHP Code**\n```php\n<?php\n\n// Configuration\ndefine('RESET_PASSWORD_LINK', 'http://example.com/reset-password.php');\n\n// Function to send reset password link via email\nfunction sendResetPasswordLink($email) {\n  // Connect to database\n  $db = new PDO('mysql:host=localhost;dbname=mydatabase', 'username', 'password');\n  \n  // Prepare query to get user's details\n  $query = \"SELECT id, password FROM users WHERE email = :email\";\n  $stmt = $db->prepare($query);\n  $stmt->bindParam(':email', $email);\n  $stmt->execute();\n  \n  // Get user's details\n  $userDetails = $stmt->fetch();\n  \n  if ($userDetails) {\n    // Generate reset password link\n    $resetPasswordLink = RESET_PASSWORD_LINK . '?id=' . $userDetails['id'] . '&token=' . bin2hex(random_bytes(32));\n    \n    // Send email using mail function (or use a library like PHPMailer)\n    $subject = 'Reset Password Link';\n    $body = \"Click on the link below to reset your password: $resetPasswordLink\";\n    $headers = 'From: no-reply@example.com' . \"\\r\\n\" .\n               'Reply-To: no-reply@example.com' . \"\\r\\n\" .\n               'X-Mailer: PHP/' . phpversion();\n    \n    mail($email, $subject, $body, $headers);\n  } else {\n    echo \"User not found.\";\n  }\n}\n\n// Function to reset password\nfunction resetPassword($id, $token) {\n  // Connect to database\n  $db = new PDO('mysql:host=localhost;dbname=mydatabase', 'username', 'password');\n  \n  // Prepare query to update user's password\n  $query = \"UPDATE users SET password = :password WHERE id = :id AND token = :token\";\n  $stmt = $db->prepare($query);\n  $stmt->bindParam(':id', $id);\n  $stmt->bindParam(':token', $token);\n  \n  // Generate new password\n  $newPassword = bin2hex(random_bytes(32));\n  \n  $stmt->bindParam(':password', $newPassword);\n  $stmt->execute();\n  \n  if ($stmt->rowCount() > 0) {\n    echo \"Password updated successfully.\";\n  } else {\n    echo \"Invalid token or user not found.\";\n  }\n}\n\n?>\n```\n**HTML Code**\n```html\n<!-- Forgot password form -->\n<form action=\"forgot-password.php\" method=\"post\">\n  <input type=\"email\" name=\"email\" placeholder=\"Enter your email\">\n  <button type=\"submit\">Submit</button>\n</form>\n\n<?php if (isset($_GET['success'])) : ?>\n  <p>Password updated successfully.</p>\n<?php endif; ?>\n\n<?php if (isset($_GET['error'])) : ?>\n  <p>Invalid token or user not found.</p>\n<?php endif; ?>\n```\n**How it Works**\n\n1. The `sendResetPasswordLink` function is called when the user submits the forgot password form.\n2. This function sends a reset password link to the user's email using the mail function (or use a library like PHPMailer).\n3. The reset password link contains a unique token that can be used to update the user's password.\n4. When the user clicks on the reset password link, they are redirected to the `reset-password.php` page.\n5. The `resetPassword` function is called with the user's ID and token as parameters.\n6. This function updates the user's password in the database using the new password generated by the `bin2hex(random_bytes(32))` function.\n\n**Security Notes**\n\n* Make sure to use a secure connection (HTTPS) for your website.\n* Use a library like PHPMailer to send emails instead of the built-in mail function.\n* Store passwords securely using bcrypt, Argon2, or PBKDF2.\n* Avoid storing sensitive data in plain text.", "code_blocks": ["```php\n<?php\n\n// Configuration\ndefine('RESET_PASSWORD_LINK', 'http://example.com/reset-password.php');\n\n// Function to send reset password link via email\nfunction sendResetPasswordLink($email) {\n  // Connect to database\n  $db = new PDO('mysql:host=localhost;dbname=mydatabase', 'username', 'password');\n  \n  // Prepare query to get user's details\n  $query = \"SELECT id, password FROM users WHERE email = :email\";\n  $stmt = $db->prepare($query);\n  $stmt->bindParam(':email', $email);\n  $stmt->execute();\n  \n  // Get user's details\n  $userDetails = $stmt->fetch();\n  \n  if ($userDetails) {\n    // Generate reset password link\n    $resetPasswordLink = RESET_PASSWORD_LINK . '?id=' . $userDetails['id'] . '&token=' . bin2hex(random_bytes(32));\n    \n    // Send email using mail function (or use a library like PHPMailer)\n    $subject = 'Reset Password Link';\n    $body = \"Click on the link below to reset your password: $resetPasswordLink\";\n    $headers = 'From: no-reply@example.com' . \"\\r\\n\" .\n               'Reply-To: no-reply@example.com' . \"\\r\\n\" .\n               'X-Mailer: PHP/' . phpversion();\n    \n    mail($email, $subject, $body, $headers);\n  } else {\n    echo \"User not found.\";\n  }\n}\n\n// Function to reset password\nfunction resetPassword($id, $token) {\n  // Connect to database\n  $db = new PDO('mysql:host=localhost;dbname=mydatabase', 'username', 'password');\n  \n  // Prepare query to update user's password\n  $query = \"UPDATE users SET password = :password WHERE id = :id AND token = :token\";\n  $stmt = $db->prepare($query);\n  $stmt->bindParam(':id', $id);\n  $stmt->bindParam(':token', $token);\n  \n  // Generate new password\n  $newPassword = bin2hex(random_bytes(32));\n  \n  $stmt->bindParam(':password', $newPassword);\n  $stmt->execute();\n  \n  if ($stmt->rowCount() > 0) {\n    echo \"Password updated successfully.\";\n  } else {\n    echo \"Invalid token or user not found.\";\n  }\n}\n\n?>\n```", null]}
