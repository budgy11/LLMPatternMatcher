{"prompt": "Create a forgot password function using php", "llm_output": "Here is an example of how you can create a \"forgot password\" function using PHP:\n\n**Database Schema**\n\nFirst, let's assume we have a database table `users` with the following columns:\n\n| Column Name | Data Type | Description |\n| --- | --- | --- |\n| id | int | Unique user ID |\n| email | varchar | User email address |\n| password | varchar | Stored hashed password |\n\n**PHP Code**\n\nWe'll create a PHP script that handles the forgot password functionality. Create a new file called `forgot_password.php` and add the following code:\n```php\n<?php\n\n// Configuration settings\n$db_host = 'localhost';\n$db_username = 'your_username';\n$db_password = 'your_password';\n$db_name = 'your_database';\n\n// Connect to database\n$conn = new mysqli($db_host, $db_username, $db_password, $db_name);\n\n// Check connection\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Function to generate password reset token\nfunction generateToken() {\n    return bin2hex(random_bytes(32));\n}\n\n// Function to send email with password reset link\nfunction sendEmail($email, $token) {\n    // Email settings\n    $from_email = 'your_email@example.com';\n    $from_name = 'Your Website';\n    $subject = 'Reset Password';\n\n    // Email body\n    $body = '\n        <p>Dear user,</p>\n        <p>To reset your password, click on the following link:</p>\n        <p><a href=\"' . $_SERVER['HTTP_HOST'] . '/reset_password.php?token=' . $token . '\">Reset Password</a></p>\n        <p>Best regards,</p>\n    ';\n\n    // Send email using PHPMailer (or your preferred mail library)\n    $mail = new PHPMailer();\n    $mail->isSMTP();\n    $mail->Host = 'your_smtp_host';\n    $mail->SMTPAuth = true;\n    $mail->Username = 'your_smtp_username';\n    $mail->Password = 'your_smtp_password';\n    $mail->Port = 587;\n\n    // Set recipient email address\n    $mail->setFrom($from_email, $from_name);\n    $mail->addAddress($email);\n\n    // Set email body and send\n    $mail->isHTML(true);\n    $mail->Body = $body;\n    if (!$mail->send()) {\n        return false;\n    } else {\n        return true;\n    }\n}\n\n// Handle forgot password form submission\nif (isset($_POST['forgot_password'])) {\n    // Get user email address from form input\n    $email = $_POST['email'];\n\n    // Check if user exists in database\n    $query = \"SELECT * FROM users WHERE email = '$email'\";\n    $result = $conn->query($query);\n\n    // If user exists, generate password reset token and send email\n    if ($result->num_rows > 0) {\n        while ($row = $result->fetch_assoc()) {\n            $token = generateToken();\n            if (sendEmail($email, $token)) {\n                echo \"Password reset link sent to your email.\";\n            } else {\n                echo \"Error sending email. Please try again later.\";\n            }\n        }\n    } else {\n        echo \"User not found with that email address.\";\n    }\n}\n\n?>\n```\n**Explanation**\n\n1. The code connects to the database using the `mysqli` extension.\n2. It defines two functions: `generateToken()` generates a random 32-character token, and `sendEmail()` sends an email to the user's email address with a password reset link.\n3. When the forgot password form is submitted (i.e., when the `forgot_password` button is clicked), it checks if the user exists in the database based on their email address.\n4. If the user exists, it generates a password reset token and sends an email to the user's email address with a password reset link.\n\n**HTML Form**\n\nCreate an HTML form that submits to the `forgot_password.php` script:\n```html\n<form action=\"forgot_password.php\" method=\"post\">\n    <label for=\"email\">Email Address:</label>\n    <input type=\"email\" id=\"email\" name=\"email\"><br><br>\n    <button type=\"submit\" name=\"forgot_password\">Forgot Password</button>\n</form>\n```\nNote that this is a basic example and you should adapt it to your specific use case. Additionally, make sure to secure the password reset link by including a token that can be validated on the server-side to prevent tampering.\n\nAlso, consider implementing email verification using PHPMailer or another mail library to improve security and deliverability.", "code_blocks": ["```php\n<?php\n\n// Configuration settings\n$db_host = 'localhost';\n$db_username = 'your_username';\n$db_password = 'your_password';\n$db_name = 'your_database';\n\n// Connect to database\n$conn = new mysqli($db_host, $db_username, $db_password, $db_name);\n\n// Check connection\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Function to generate password reset token\nfunction generateToken() {\n    return bin2hex(random_bytes(32));\n}\n\n// Function to send email with password reset link\nfunction sendEmail($email, $token) {\n    // Email settings\n    $from_email = 'your_email@example.com';\n    $from_name = 'Your Website';\n    $subject = 'Reset Password';\n\n    // Email body\n    $body = '\n        <p>Dear user,</p>\n        <p>To reset your password, click on the following link:</p>\n        <p><a href=\"' . $_SERVER['HTTP_HOST'] . '/reset_password.php?token=' . $token . '\">Reset Password</a></p>\n        <p>Best regards,</p>\n    ';\n\n    // Send email using PHPMailer (or your preferred mail library)\n    $mail = new PHPMailer();\n    $mail->isSMTP();\n    $mail->Host = 'your_smtp_host';\n    $mail->SMTPAuth = true;\n    $mail->Username = 'your_smtp_username';\n    $mail->Password = 'your_smtp_password';\n    $mail->Port = 587;\n\n    // Set recipient email address\n    $mail->setFrom($from_email, $from_name);\n    $mail->addAddress($email);\n\n    // Set email body and send\n    $mail->isHTML(true);\n    $mail->Body = $body;\n    if (!$mail->send()) {\n        return false;\n    } else {\n        return true;\n    }\n}\n\n// Handle forgot password form submission\nif (isset($_POST['forgot_password'])) {\n    // Get user email address from form input\n    $email = $_POST['email'];\n\n    // Check if user exists in database\n    $query = \"SELECT * FROM users WHERE email = '$email'\";\n    $result = $conn->query($query);\n\n    // If user exists, generate password reset token and send email\n    if ($result->num_rows > 0) {\n        while ($row = $result->fetch_assoc()) {\n            $token = generateToken();\n            if (sendEmail($email, $token)) {\n                echo \"Password reset link sent to your email.\";\n            } else {\n                echo \"Error sending email. Please try again later.\";\n            }\n        }\n    } else {\n        echo \"User not found with that email address.\";\n    }\n}\n\n?>\n```", null]}
