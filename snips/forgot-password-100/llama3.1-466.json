{"prompt": "Create a forgot password function using php", "llm_output": "**Forgot Password Function in PHP**\n=====================================\n\nHere is an example of a forgot password function using PHP, MySQL, and the PDO extension. This script will send a reset link to the user's email with a unique token.\n\n**Database Schema**\n\nFirst, let's create a database schema for our users table:\n\n```sql\nCREATE TABLE users (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  email VARCHAR(255) UNIQUE NOT NULL,\n  password_hash VARCHAR(255) NOT NULL,\n  reset_token VARCHAR(255),\n  reset_expires TIMESTAMP\n);\n```\n\n**PHP Code**\n\nCreate a new file called `forgot_password.php` and add the following code:\n\n```php\n<?php\n\n// Configuration\ndefine('DB_HOST', 'your_host');\ndefine('DB_NAME', 'your_database');\ndefine('DB_USER', 'your_username');\ndefine('DB_PASSWORD', 'your_password');\n\n// Connect to database\n$dsn = \"mysql:host=\" . DB_HOST . \";dbname=\" . DB_NAME;\n$conn = new PDO($dsn, DB_USER, DB_PASSWORD);\n\nfunction sendEmail($to, $subject, $message) {\n  // Email configuration (change as needed)\n  $fromEmail = 'your_email@example.com';\n  $fromName = 'Your Name';\n  $emailServer = 'smtp.example.com';\n  $emailPort = 587;\n  $emailUsername = 'your_email_username';\n  $emailPassword = 'your_email_password';\n\n  $headers = \"From: $fromName <$fromEmail>\\r\\n\";\n  $headers .= \"Reply-To: $fromEmail\\r\\n\";\n  $headers .= \"Content-Type: text/html; charset=UTF-8\\r\\n\";\n\n  mail($to, $subject, $message, $headers);\n}\n\nfunction generateToken() {\n  return bin2hex(random_bytes(16));\n}\n\n// Check for form submission\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n\n  // Get the email address from the form\n  $email = trim($_POST['email']);\n\n  try {\n    // Query to get user with matching email\n    $stmt = $conn->prepare('SELECT * FROM users WHERE email = :email');\n    $stmt->bindParam(':email', $email);\n    $stmt->execute();\n\n    if ($user = $stmt->fetch()) {\n\n      // Generate a new reset token\n      $token = generateToken();\n      $reset_expires = date('Y-m-d H:i:s', strtotime('+1 day'));\n\n      // Update user's reset token and expires timestamp\n      $stmt = $conn->prepare('UPDATE users SET reset_token = :token, reset_expires = :expires WHERE id = :id');\n      $stmt->bindParam(':token', $token);\n      $stmt->bindParam(':expires', $reset_expires);\n      $stmt->bindParam(':id', $user['id']);\n      $stmt->execute();\n\n      // Send email with reset link\n      $subject = 'Reset your password';\n      $message = '<p>Hello ' . $user['name'] . ',</p>';\n      $message .= '<p>Click the following link to reset your password: ';\n      $message .= '<a href=\"' . $_SERVER['PHP_SELF'] . '?token=' . $token . '\">Reset Password</a></p>';\n      sendEmail($email, $subject, $message);\n\n      echo 'Check your email for a reset link.';\n    } else {\n      throw new Exception('User not found');\n    }\n  } catch (Exception $e) {\n    echo 'Error: ' . $e->getMessage();\n  }\n\n} else {\n\n  // Display the forgot password form\n?>\n\n<form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\">\n  <label for=\"email\">Email:</label>\n  <input type=\"text\" id=\"email\" name=\"email\"><br><br>\n  <input type=\"submit\" value=\"Send Reset Link\">\n</form>\n\n<?php\n\n}\n?>\n```\n\n**How it Works**\n\n1. When the user submits the forgot password form, the script checks for a matching email address in the database.\n2. If a match is found, the script generates a new reset token and updates the user's record with the token and an expires timestamp (set to one day from now).\n3. The script sends an email to the user's email address with a reset link containing the generated token.\n4. When the user clicks on the reset link, it will redirect them to the same page with the token as a query string parameter.\n\n**Note**: This is a basic example and you should adapt it to your specific needs (e.g., add error handling, security measures like email verification tokens).", "code_blocks": [null, "```php\n<?php\n\n// Configuration\ndefine('DB_HOST', 'your_host');\ndefine('DB_NAME', 'your_database');\ndefine('DB_USER', 'your_username');\ndefine('DB_PASSWORD', 'your_password');\n\n// Connect to database\n$dsn = \"mysql:host=\" . DB_HOST . \";dbname=\" . DB_NAME;\n$conn = new PDO($dsn, DB_USER, DB_PASSWORD);\n\nfunction sendEmail($to, $subject, $message) {\n  // Email configuration (change as needed)\n  $fromEmail = 'your_email@example.com';\n  $fromName = 'Your Name';\n  $emailServer = 'smtp.example.com';\n  $emailPort = 587;\n  $emailUsername = 'your_email_username';\n  $emailPassword = 'your_email_password';\n\n  $headers = \"From: $fromName <$fromEmail>\\r\\n\";\n  $headers .= \"Reply-To: $fromEmail\\r\\n\";\n  $headers .= \"Content-Type: text/html; charset=UTF-8\\r\\n\";\n\n  mail($to, $subject, $message, $headers);\n}\n\nfunction generateToken() {\n  return bin2hex(random_bytes(16));\n}\n\n// Check for form submission\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n\n  // Get the email address from the form\n  $email = trim($_POST['email']);\n\n  try {\n    // Query to get user with matching email\n    $stmt = $conn->prepare('SELECT * FROM users WHERE email = :email');\n    $stmt->bindParam(':email', $email);\n    $stmt->execute();\n\n    if ($user = $stmt->fetch()) {\n\n      // Generate a new reset token\n      $token = generateToken();\n      $reset_expires = date('Y-m-d H:i:s', strtotime('+1 day'));\n\n      // Update user's reset token and expires timestamp\n      $stmt = $conn->prepare('UPDATE users SET reset_token = :token, reset_expires = :expires WHERE id = :id');\n      $stmt->bindParam(':token', $token);\n      $stmt->bindParam(':expires', $reset_expires);\n      $stmt->bindParam(':id', $user['id']);\n      $stmt->execute();\n\n      // Send email with reset link\n      $subject = 'Reset your password';\n      $message = '<p>Hello ' . $user['name'] . ',</p>';\n      $message .= '<p>Click the following link to reset your password: ';\n      $message .= '<a href=\"' . $_SERVER['PHP_SELF'] . '?token=' . $token . '\">Reset Password</a></p>';\n      sendEmail($email, $subject, $message);\n\n      echo 'Check your email for a reset link.';\n    } else {\n      throw new Exception('User not found');\n    }\n  } catch (Exception $e) {\n    echo 'Error: ' . $e->getMessage();\n  }\n\n} else {\n\n  // Display the forgot password form\n?>\n\n<form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\">\n  <label for=\"email\">Email:</label>\n  <input type=\"text\" id=\"email\" name=\"email\"><br><br>\n  <input type=\"submit\" value=\"Send Reset Link\">\n</form>\n\n<?php\n\n}\n?>\n```"]}
