{"prompt": "Create a forgot password function using php", "llm_output": "Here is an example of how you can create a \"Forgot Password\" function in PHP:\n\n**Database Schema**\n\nLet's assume we have a `users` table with the following columns:\n\n| Column Name | Data Type |\n| --- | --- |\n| id | int (primary key) |\n| email | varchar(255) |\n| password | varchar(255) |\n\n**Forgot Password Function**\n\nFirst, create a new PHP file for your forgot password function. Let's call it `forgot_password.php`.\n\n```php\n<?php\n\n// Configuration settings\ndefine('DB_HOST', 'localhost');\ndefine('DB_USERNAME', 'your_username');\ndefine('DB_PASSWORD', 'your_password');\ndefine('DB_NAME', 'your_database');\n\n// Connect to database\n$connection = new mysqli(DB_HOST, DB_USERNAME, DB_PASSWORD, DB_NAME);\n\nif ($connection->connect_error) {\n    die(\"Connection failed: \" . $connection->connect_error);\n}\n\nfunction forgotPassword($email)\n{\n    // Query to retrieve user ID\n    $query = \"SELECT id FROM users WHERE email = '$email'\";\n    $result = $connection->query($query);\n\n    if ($result->num_rows > 0) {\n        // Retrieve user ID\n        $row = $result->fetch_assoc();\n        $userId = $row['id'];\n\n        // Generate random token\n        $token = bin2hex(random_bytes(32));\n\n        // Update password reset token in database\n        $query = \"UPDATE users SET password_reset_token = '$token' WHERE id = '$userId'\";\n        $connection->query($query);\n\n        // Send email with reset link\n        sendEmail($email, $token);\n    }\n}\n\nfunction sendEmail($email, $token)\n{\n    // Your email configuration settings here (e.g. SMTP server, username, password, etc.)\n    $to = $email;\n    $subject = \"Reset your password\";\n    $body = \"Click on this link to reset your password: <a href='http://your-website.com/reset-password.php?token=$token'>Reset Password</a>\";\n\n    // Send email\n    mail($to, $subject, $body);\n}\n\n// Process form submission (e.g. from forgot_password.html)\nif (isset($_POST['email'])) {\n    forgotPassword($_POST['email']);\n    echo \"An email with a password reset link has been sent to your registered email address.\";\n} else {\n    echo \"Invalid request\";\n}\n```\n\n**HTML Form**\n\nCreate an HTML form for the user to input their email address. Let's call it `forgot_password.html`.\n\n```html\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Forgot Password</title>\n</head>\n<body>\n    <h2>Forgot Password</h2>\n    <form action=\"forgot_password.php\" method=\"post\">\n        <label for=\"email\">Email:</label><br>\n        <input type=\"text\" id=\"email\" name=\"email\"><br>\n        <button type=\"submit\">Submit</button>\n    </form>\n</body>\n</html>\n```\n\n**Security Notes**\n\n1. **Password Reset Token**: This is a one-time token that will be sent to the user's email address when they request a password reset. It should be kept secret and only used once.\n2. **Email Configuration**: Make sure your email configuration settings are correct (e.g. SMTP server, username, password).\n3. **Input Validation**: Validate user input to prevent SQL injection attacks.\n\nThis is a basic example of how you can implement a \"Forgot Password\" function in PHP. Note that this example uses a simple random token for password reset, but you may want to consider using more secure methods such as hashing and salting for storing and verifying passwords.", "code_blocks": ["```php\n<?php\n\n// Configuration settings\ndefine('DB_HOST', 'localhost');\ndefine('DB_USERNAME', 'your_username');\ndefine('DB_PASSWORD', 'your_password');\ndefine('DB_NAME', 'your_database');\n\n// Connect to database\n$connection = new mysqli(DB_HOST, DB_USERNAME, DB_PASSWORD, DB_NAME);\n\nif ($connection->connect_error) {\n    die(\"Connection failed: \" . $connection->connect_error);\n}\n\nfunction forgotPassword($email)\n{\n    // Query to retrieve user ID\n    $query = \"SELECT id FROM users WHERE email = '$email'\";\n    $result = $connection->query($query);\n\n    if ($result->num_rows > 0) {\n        // Retrieve user ID\n        $row = $result->fetch_assoc();\n        $userId = $row['id'];\n\n        // Generate random token\n        $token = bin2hex(random_bytes(32));\n\n        // Update password reset token in database\n        $query = \"UPDATE users SET password_reset_token = '$token' WHERE id = '$userId'\";\n        $connection->query($query);\n\n        // Send email with reset link\n        sendEmail($email, $token);\n    }\n}\n\nfunction sendEmail($email, $token)\n{\n    // Your email configuration settings here (e.g. SMTP server, username, password, etc.)\n    $to = $email;\n    $subject = \"Reset your password\";\n    $body = \"Click on this link to reset your password: <a href='http://your-website.com/reset-password.php?token=$token'>Reset Password</a>\";\n\n    // Send email\n    mail($to, $subject, $body);\n}\n\n// Process form submission (e.g. from forgot_password.html)\nif (isset($_POST['email'])) {\n    forgotPassword($_POST['email']);\n    echo \"An email with a password reset link has been sent to your registered email address.\";\n} else {\n    echo \"Invalid request\";\n}\n```", null]}
