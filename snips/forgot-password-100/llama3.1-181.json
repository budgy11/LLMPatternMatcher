{"prompt": "Create a forgot password function using php", "llm_output": "Here is an example of how you can create a \"forgot password\" function using PHP:\n\n**Database Schema**\n\nLet's assume we have a database table called `users` with the following structure:\n```sql\nCREATE TABLE users (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  username VARCHAR(255),\n  email VARCHAR(255),\n  password VARCHAR(255)\n);\n```\n**Forgot Password Function**\n\nCreate a PHP file (e.g. `forgot_password.php`) and add the following code:\n```php\n<?php\n\n// Configuration\ndefine('DB_HOST', 'your_database_host');\ndefine('DB_USER', 'your_database_user');\ndefine('DB_PASSWORD', 'your_database_password');\ndefine('DB_NAME', 'your_database_name');\n\n// Connect to database\n$conn = new mysqli(DB_HOST, DB_USER, DB_PASSWORD, DB_NAME);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Function to send password reset email\nfunction sendPasswordResetEmail($userEmail)\n{\n    // Generate random token\n    $token = substr(str_shuffle('abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'), 0, 32);\n\n    // Update user's password reset token in database\n    $query = \"UPDATE users SET password_reset_token = '$token' WHERE email = '$userEmail'\";\n    $conn->query($query);\n\n    // Send password reset email\n    $subject = 'Reset your password';\n    $message = '\n        <p>Hello, please click on the following link to reset your password:</p>\n        <p><a href=\"' . $_SERVER['HTTP_HOST'] . '/reset_password.php?token=' . $token . '\">Reset Password</a></p>\n        <p>Best regards,\n            Your Application\n        </p>';\n\n    mail($userEmail, $subject, $message);\n}\n\n// Handle forgot password request\nif (isset($_POST['forgotPassword'])) {\n    $email = $_POST['email'];\n\n    // Check if email exists in database\n    $query = \"SELECT * FROM users WHERE email = '$email'\";\n    $result = $conn->query($query);\n\n    if ($result->num_rows > 0) {\n        sendPasswordResetEmail($email);\n        echo 'An email has been sent to you with a password reset link.';\n    } else {\n        echo 'No account found with this email address.';\n    }\n}\n\n// Close database connection\n$conn->close();\n\n?>\n```\n**Reset Password Page**\n\nCreate another PHP file (e.g. `reset_password.php`) and add the following code:\n```php\n<?php\n\n// Configuration\ndefine('DB_HOST', 'your_database_host');\ndefine('DB_USER', 'your_database_user');\ndefine('DB_PASSWORD', 'your_database_password');\ndefine('DB_NAME', 'your_database_name');\n\n// Connect to database\n$conn = new mysqli(DB_HOST, DB_USER, DB_PASSWORD, DB_NAME);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Function to update user's password\nfunction updatePassword($token, $newPassword)\n{\n    // Get user ID from token\n    $query = \"SELECT id FROM users WHERE password_reset_token = '$token'\";\n    $result = $conn->query($query);\n\n    if ($result->num_rows > 0) {\n        $userId = $result->fetch_assoc()['id'];\n\n        // Update user's password in database\n        $newPasswordHash = md5($newPassword);\n        $query = \"UPDATE users SET password = '$newPasswordHash' WHERE id = '$userId'\";\n        $conn->query($query);\n\n        // Remove password reset token from database\n        $query = \"UPDATE users SET password_reset_token = NULL WHERE id = '$userId'\";\n        $conn->query($query);\n    }\n}\n\n// Handle password update request\nif (isset($_POST['updatePassword'])) {\n    $token = $_GET['token'];\n    $newPassword = $_POST['newPassword'];\n\n    // Check if token is valid\n    $query = \"SELECT * FROM users WHERE password_reset_token = '$token'\";\n    $result = $conn->query($query);\n\n    if ($result->num_rows > 0) {\n        updatePassword($token, $newPassword);\n        echo 'Your password has been updated successfully.';\n    } else {\n        echo 'Invalid token.';\n    }\n}\n\n// Close database connection\n$conn->close();\n\n?>\n```\n**Usage**\n\nTo use this code, follow these steps:\n\n1. Create a new PHP file (e.g. `forgot_password.php`) and add the above code.\n2. Replace the placeholders (`your_database_host`, etc.) with your actual database credentials.\n3. Upload the files to your web server.\n4. When a user clicks on the \"Forgot Password\" link, they will be taken to the `forgot_password.php` page, where they can enter their email address and submit it.\n5. If the email exists in the database, an email with a password reset link will be sent to the user's email address.\n6. When the user clicks on the password reset link, they will be taken to the `reset_password.php` page, where they can enter their new password and submit it.\n7. The `updatePassword()` function will update the user's password in the database, and remove the password reset token.\n\nNote: This is a basic example, and you should consider adding more security measures, such as:\n\n* Salting and hashing passwords\n* Using HTTPS to encrypt communication between the client and server\n* Validating user input to prevent SQL injection attacks\n* etc.", "code_blocks": [null, "```php\n<?php\n\n// Configuration\ndefine('DB_HOST', 'your_database_host');\ndefine('DB_USER', 'your_database_user');\ndefine('DB_PASSWORD', 'your_database_password');\ndefine('DB_NAME', 'your_database_name');\n\n// Connect to database\n$conn = new mysqli(DB_HOST, DB_USER, DB_PASSWORD, DB_NAME);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Function to send password reset email\nfunction sendPasswordResetEmail($userEmail)\n{\n    // Generate random token\n    $token = substr(str_shuffle('abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'), 0, 32);\n\n    // Update user's password reset token in database\n    $query = \"UPDATE users SET password_reset_token = '$token' WHERE email = '$userEmail'\";\n    $conn->query($query);\n\n    // Send password reset email\n    $subject = 'Reset your password';\n    $message = '\n        <p>Hello, please click on the following link to reset your password:</p>\n        <p><a href=\"' . $_SERVER['HTTP_HOST'] . '/reset_password.php?token=' . $token . '\">Reset Password</a></p>\n        <p>Best regards,\n            Your Application\n        </p>';\n\n    mail($userEmail, $subject, $message);\n}\n\n// Handle forgot password request\nif (isset($_POST['forgotPassword'])) {\n    $email = $_POST['email'];\n\n    // Check if email exists in database\n    $query = \"SELECT * FROM users WHERE email = '$email'\";\n    $result = $conn->query($query);\n\n    if ($result->num_rows > 0) {\n        sendPasswordResetEmail($email);\n        echo 'An email has been sent to you with a password reset link.';\n    } else {\n        echo 'No account found with this email address.';\n    }\n}\n\n// Close database connection\n$conn->close();\n\n?>\n```", "```php\n<?php\n\n// Configuration\ndefine('DB_HOST', 'your_database_host');\ndefine('DB_USER', 'your_database_user');\ndefine('DB_PASSWORD', 'your_database_password');\ndefine('DB_NAME', 'your_database_name');\n\n// Connect to database\n$conn = new mysqli(DB_HOST, DB_USER, DB_PASSWORD, DB_NAME);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Function to update user's password\nfunction updatePassword($token, $newPassword)\n{\n    // Get user ID from token\n    $query = \"SELECT id FROM users WHERE password_reset_token = '$token'\";\n    $result = $conn->query($query);\n\n    if ($result->num_rows > 0) {\n        $userId = $result->fetch_assoc()['id'];\n\n        // Update user's password in database\n        $newPasswordHash = md5($newPassword);\n        $query = \"UPDATE users SET password = '$newPasswordHash' WHERE id = '$userId'\";\n        $conn->query($query);\n\n        // Remove password reset token from database\n        $query = \"UPDATE users SET password_reset_token = NULL WHERE id = '$userId'\";\n        $conn->query($query);\n    }\n}\n\n// Handle password update request\nif (isset($_POST['updatePassword'])) {\n    $token = $_GET['token'];\n    $newPassword = $_POST['newPassword'];\n\n    // Check if token is valid\n    $query = \"SELECT * FROM users WHERE password_reset_token = '$token'\";\n    $result = $conn->query($query);\n\n    if ($result->num_rows > 0) {\n        updatePassword($token, $newPassword);\n        echo 'Your password has been updated successfully.';\n    } else {\n        echo 'Invalid token.';\n    }\n}\n\n// Close database connection\n$conn->close();\n\n?>\n```"]}
