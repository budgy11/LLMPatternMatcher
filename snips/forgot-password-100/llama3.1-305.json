{"prompt": "Create a forgot password function using php", "llm_output": "Here's an example of how to create a \"Forgot Password\" functionality in PHP:\n\n**Note:** This is a basic implementation and you should consider security best practices (e.g. hashing passwords, validating user input) when implementing this in a real-world application.\n\n**Database Structure:**\n\nAssuming you have a database table `users` with the following structure:\n```sql\nCREATE TABLE users (\n  id INT PRIMARY KEY,\n  email VARCHAR(255) NOT NULL UNIQUE,\n  password VARCHAR(255) NOT NULL,\n  reset_token VARCHAR(255)\n);\n```\n**PHP Code:**\n```php\n<?php\n\n// Configuration\n$dbHost = 'localhost';\n$dbUsername = 'your_username';\n$dbPassword = 'your_password';\n$dbName = 'your_database';\n\n// Connect to database\n$conn = new mysqli($dbHost, $dbUsername, $dbPassword, $dbName);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\nfunction forgotPassword() {\n  // Get user email from form submission\n  $email = $_POST['email'];\n\n  // Query database to retrieve user's reset token and password\n  $query = \"SELECT * FROM users WHERE email='$email'\";\n  $result = $conn->query($query);\n\n  if ($result->num_rows > 0) {\n    while($row = $result->fetch_assoc()) {\n      $user_id = $row['id'];\n      $current_token = $row['reset_token'];\n\n      // Generate new reset token\n      $newToken = bin2hex(random_bytes(16));\n      $conn->query(\"UPDATE users SET reset_token='$newToken' WHERE id=$user_id\");\n\n      // Send email with password reset link (example using PHPMailer)\n      require_once 'PHPMailer/PHPMailerAutoload.php';\n      $mail = new PHPMailer;\n      $mail->isSMTP();\n      $mail->Host = 'smtp.example.com';\n      $mail->SMTPAuth = true;\n      $mail->Username = 'your_email@example.com';\n      $mail->Password = 'your_password';\n      $mail->Port = 587;\n\n      $mail->setFrom('your_email@example.com', 'Your Name');\n      $mail->addAddress($email);\n      $mail->Subject = 'Reset Password';\n\n      $password_reset_link = \"http://example.com/reset-password.php?token=$newToken&user_id=$user_id\";\n      $messageBody = \"\n        <p>Dear user,</p>\n        <p>To reset your password, please click on the following link:</p>\n        <a href=\\\"$password_reset_link\\\">Reset Password</a>\n        \";\n      $mail->msgHTML($messageBody);\n      if (!$mail->send()) {\n          echo 'Message could not be sent.';\n          echo 'Mailer Error: ' . $mail->ErrorInfo;\n      } else {\n          echo \"Password reset link has been sent to your email.\";\n      }\n    }\n  } else {\n    echo \"Email not found in database.\";\n  }\n}\n\n// Handle form submission\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n  forgotPassword();\n}\n?>\n```\n**HTML Form:**\n```html\n<form action=\"\" method=\"post\">\n  <label for=\"email\">Email:</label>\n  <input type=\"email\" id=\"email\" name=\"email\" required>\n\n  <button type=\"submit\">Submit</button>\n</form>\n```\nThis code assumes that you have PHPMailer installed and configured in your project. You'll need to create a `reset-password.php` file with the following code:\n```php\n<?php\n\n// Configuration\n$dbHost = 'localhost';\n$dbUsername = 'your_username';\n$dbPassword = 'your_password';\n$dbName = 'your_database';\n\n// Connect to database\n$conn = new mysqli($dbHost, $dbUsername, $dbPassword, $dbName);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\nfunction resetPassword() {\n  // Get user ID and token from URL parameters\n  $user_id = $_GET['user_id'];\n  $token = $_GET['token'];\n\n  // Query database to retrieve user's password\n  $query = \"SELECT * FROM users WHERE id=$user_id AND reset_token='$token'\";\n  $result = $conn->query($query);\n\n  if ($result->num_rows > 0) {\n    while($row = $result->fetch_assoc()) {\n      // Hash and store new password in database\n      $new_password = password_hash($_POST['password'], PASSWORD_DEFAULT);\n      $conn->query(\"UPDATE users SET password='$new_password' WHERE id=$user_id\");\n      echo \"Password reset successfully.\";\n    }\n  } else {\n    echo \"Invalid token or user ID.\";\n  }\n}\n\n// Handle form submission\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n  resetPassword();\n}\n?>\n```\n**HTML Form:**\n```html\n<form action=\"\" method=\"post\">\n  <label for=\"password\">New Password:</label>\n  <input type=\"password\" id=\"password\" name=\"password\" required>\n\n  <button type=\"submit\">Submit</button>\n</form>\n```\nThis code will generate a password reset link and send it to the user's email address. When the user clicks on the link, they'll be taken to the `reset-password.php` page where they can enter their new password.\n\n**Note:** This is just an example implementation and you should consider security best practices (e.g. hashing passwords, validating user input) when implementing this in a real-world application.", "code_blocks": [null, "```php\n<?php\n\n// Configuration\n$dbHost = 'localhost';\n$dbUsername = 'your_username';\n$dbPassword = 'your_password';\n$dbName = 'your_database';\n\n// Connect to database\n$conn = new mysqli($dbHost, $dbUsername, $dbPassword, $dbName);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\nfunction forgotPassword() {\n  // Get user email from form submission\n  $email = $_POST['email'];\n\n  // Query database to retrieve user's reset token and password\n  $query = \"SELECT * FROM users WHERE email='$email'\";\n  $result = $conn->query($query);\n\n  if ($result->num_rows > 0) {\n    while($row = $result->fetch_assoc()) {\n      $user_id = $row['id'];\n      $current_token = $row['reset_token'];\n\n      // Generate new reset token\n      $newToken = bin2hex(random_bytes(16));\n      $conn->query(\"UPDATE users SET reset_token='$newToken' WHERE id=$user_id\");\n\n      // Send email with password reset link (example using PHPMailer)\n      require_once 'PHPMailer/PHPMailerAutoload.php';\n      $mail = new PHPMailer;\n      $mail->isSMTP();\n      $mail->Host = 'smtp.example.com';\n      $mail->SMTPAuth = true;\n      $mail->Username = 'your_email@example.com';\n      $mail->Password = 'your_password';\n      $mail->Port = 587;\n\n      $mail->setFrom('your_email@example.com', 'Your Name');\n      $mail->addAddress($email);\n      $mail->Subject = 'Reset Password';\n\n      $password_reset_link = \"http://example.com/reset-password.php?token=$newToken&user_id=$user_id\";\n      $messageBody = \"\n        <p>Dear user,</p>\n        <p>To reset your password, please click on the following link:</p>\n        <a href=\\\"$password_reset_link\\\">Reset Password</a>\n        \";\n      $mail->msgHTML($messageBody);\n      if (!$mail->send()) {\n          echo 'Message could not be sent.';\n          echo 'Mailer Error: ' . $mail->ErrorInfo;\n      } else {\n          echo \"Password reset link has been sent to your email.\";\n      }\n    }\n  } else {\n    echo \"Email not found in database.\";\n  }\n}\n\n// Handle form submission\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n  forgotPassword();\n}\n?>\n```", null, "```php\n<?php\n\n// Configuration\n$dbHost = 'localhost';\n$dbUsername = 'your_username';\n$dbPassword = 'your_password';\n$dbName = 'your_database';\n\n// Connect to database\n$conn = new mysqli($dbHost, $dbUsername, $dbPassword, $dbName);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\nfunction resetPassword() {\n  // Get user ID and token from URL parameters\n  $user_id = $_GET['user_id'];\n  $token = $_GET['token'];\n\n  // Query database to retrieve user's password\n  $query = \"SELECT * FROM users WHERE id=$user_id AND reset_token='$token'\";\n  $result = $conn->query($query);\n\n  if ($result->num_rows > 0) {\n    while($row = $result->fetch_assoc()) {\n      // Hash and store new password in database\n      $new_password = password_hash($_POST['password'], PASSWORD_DEFAULT);\n      $conn->query(\"UPDATE users SET password='$new_password' WHERE id=$user_id\");\n      echo \"Password reset successfully.\";\n    }\n  } else {\n    echo \"Invalid token or user ID.\";\n  }\n}\n\n// Handle form submission\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n  resetPassword();\n}\n?>\n```", null]}
