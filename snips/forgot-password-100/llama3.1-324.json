{"prompt": "Create a forgot password function using php", "llm_output": "Here's an example of how you can create a \"Forgot Password\" functionality in PHP:\n\n**password_reset.php**\n```php\n<?php\n\n// Check if the form has been submitted\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n    // Get the email address from the form\n    $email = $_POST['email'];\n\n    // Connect to the database (assuming you have a MySQL db with users table)\n    $conn = new mysqli('localhost', 'username', 'password', 'database_name');\n\n    if ($conn->connect_error) {\n        die(\"Connection failed: \" . $conn->connect_error);\n    }\n\n    // Query to retrieve user data based on email\n    $query = \"SELECT * FROM users WHERE email = '$email'\";\n    $result = $conn->query($query);\n\n    if ($result->num_rows > 0) {\n        // Retrieve the user's ID and name\n        while ($row = $result->fetch_assoc()) {\n            $userId = $row['id'];\n            $userName = $row['name'];\n\n            // Generate a password reset token (a random string of characters)\n            $token = bin2hex(random_bytes(32));\n\n            // Insert the new token into the users table\n            $query = \"UPDATE users SET password_reset_token = '$token' WHERE id = '$userId'\";\n            $conn->query($query);\n\n            // Send an email to the user with a link to reset their password\n            send_password_reset_email($email, $token);\n        }\n    } else {\n        echo 'Email not found';\n    }\n\n    // Close database connection\n    $conn->close();\n}\n\n// Function to send password reset email\nfunction send_password_reset_email($email, $token) {\n    // Your email server settings here (e.g. SMTP)\n    require_once 'PHPMailer.php';\n\n    $mail = new PHPMailer\\PHPMailer\\PHPMailer();\n\n    $mail->isSMTP();\n    $mail->Host = 'smtp.example.com';\n    $mail->Port = 587;\n    $mail->Username = 'your_email@example.com';\n    $mail->Password = 'your_password';\n    $mail->setFrom('your_email@example.com', 'Your Name');\n    $mail->addAddress($email);\n    $mail->Subject = 'Reset your password';\n    $mail->Body = \"Click here to reset your password: <a href='http://example.com/reset-password.php?token=$token'>Reset Password</a>\";\n\n    if (!$mail->send()) {\n        echo 'Error sending email';\n    }\n}\n\n?>\n```\n**reset_password.php**\n```php\n<?php\n\n// Check if the form has been submitted\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n    // Get the token from the form\n    $token = $_POST['token'];\n\n    // Connect to the database (assuming you have a MySQL db with users table)\n    $conn = new mysqli('localhost', 'username', 'password', 'database_name');\n\n    if ($conn->connect_error) {\n        die(\"Connection failed: \" . $conn->connect_error);\n    }\n\n    // Query to retrieve user data based on token\n    $query = \"SELECT * FROM users WHERE password_reset_token = '$token'\";\n    $result = $conn->query($query);\n\n    if ($result->num_rows > 0) {\n        // Retrieve the user's ID and name\n        while ($row = $result->fetch_assoc()) {\n            $userId = $row['id'];\n            $userName = $row['name'];\n\n            // Prompt user to enter new password and confirm it\n            echo 'Enter your new password: <input type=\"password\" id=\"new_password\"><br>';\n            echo 'Confirm your new password: <input type=\"password\" id=\"confirm_password\"><br>';\n\n            if (isset($_POST['submit'])) {\n                $newPassword = $_POST['new_password'];\n                $confirmPassword = $_POST['confirm_password'];\n\n                // Validate user input\n                if ($newPassword == $confirmPassword) {\n                    // Update the user's password in the database\n                    $query = \"UPDATE users SET password = '$newPassword' WHERE id = '$userId'\";\n                    $conn->query($query);\n\n                    // Remove the token from the database\n                    $query = \"UPDATE users SET password_reset_token = '' WHERE id = '$userId'\";\n                    $conn->query($query);\n                } else {\n                    echo 'Passwords do not match';\n                }\n            }\n        }\n    } else {\n        echo 'Invalid token';\n    }\n\n    // Close database connection\n    $conn->close();\n}\n\n?>\n```\n**Usage**\n\n1. User submits the \"Forgot Password\" form with their email address.\n2. The script generates a password reset token and stores it in the users table for the corresponding user.\n3. An email is sent to the user with a link to reset their password (e.g. `http://example.com/reset-password.php?token=$token`).\n4. User clicks on the link, which redirects them to the `reset_password.php` page with the token as a query parameter.\n5. The script prompts the user to enter a new password and confirm it.\n6. If the passwords match, the script updates the user's password in the database.\n\nNote: This is just an example implementation and you should adjust it according to your specific requirements (e.g. email server settings). Additionally, make sure to implement proper security measures, such as hashing and salting passwords.", "code_blocks": ["```php\n<?php\n\n// Check if the form has been submitted\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n    // Get the email address from the form\n    $email = $_POST['email'];\n\n    // Connect to the database (assuming you have a MySQL db with users table)\n    $conn = new mysqli('localhost', 'username', 'password', 'database_name');\n\n    if ($conn->connect_error) {\n        die(\"Connection failed: \" . $conn->connect_error);\n    }\n\n    // Query to retrieve user data based on email\n    $query = \"SELECT * FROM users WHERE email = '$email'\";\n    $result = $conn->query($query);\n\n    if ($result->num_rows > 0) {\n        // Retrieve the user's ID and name\n        while ($row = $result->fetch_assoc()) {\n            $userId = $row['id'];\n            $userName = $row['name'];\n\n            // Generate a password reset token (a random string of characters)\n            $token = bin2hex(random_bytes(32));\n\n            // Insert the new token into the users table\n            $query = \"UPDATE users SET password_reset_token = '$token' WHERE id = '$userId'\";\n            $conn->query($query);\n\n            // Send an email to the user with a link to reset their password\n            send_password_reset_email($email, $token);\n        }\n    } else {\n        echo 'Email not found';\n    }\n\n    // Close database connection\n    $conn->close();\n}\n\n// Function to send password reset email\nfunction send_password_reset_email($email, $token) {\n    // Your email server settings here (e.g. SMTP)\n    require_once 'PHPMailer.php';\n\n    $mail = new PHPMailer\\PHPMailer\\PHPMailer();\n\n    $mail->isSMTP();\n    $mail->Host = 'smtp.example.com';\n    $mail->Port = 587;\n    $mail->Username = 'your_email@example.com';\n    $mail->Password = 'your_password';\n    $mail->setFrom('your_email@example.com', 'Your Name');\n    $mail->addAddress($email);\n    $mail->Subject = 'Reset your password';\n    $mail->Body = \"Click here to reset your password: <a href='http://example.com/reset-password.php?token=$token'>Reset Password</a>\";\n\n    if (!$mail->send()) {\n        echo 'Error sending email';\n    }\n}\n\n?>\n```", "```php\n<?php\n\n// Check if the form has been submitted\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n    // Get the token from the form\n    $token = $_POST['token'];\n\n    // Connect to the database (assuming you have a MySQL db with users table)\n    $conn = new mysqli('localhost', 'username', 'password', 'database_name');\n\n    if ($conn->connect_error) {\n        die(\"Connection failed: \" . $conn->connect_error);\n    }\n\n    // Query to retrieve user data based on token\n    $query = \"SELECT * FROM users WHERE password_reset_token = '$token'\";\n    $result = $conn->query($query);\n\n    if ($result->num_rows > 0) {\n        // Retrieve the user's ID and name\n        while ($row = $result->fetch_assoc()) {\n            $userId = $row['id'];\n            $userName = $row['name'];\n\n            // Prompt user to enter new password and confirm it\n            echo 'Enter your new password: <input type=\"password\" id=\"new_password\"><br>';\n            echo 'Confirm your new password: <input type=\"password\" id=\"confirm_password\"><br>';\n\n            if (isset($_POST['submit'])) {\n                $newPassword = $_POST['new_password'];\n                $confirmPassword = $_POST['confirm_password'];\n\n                // Validate user input\n                if ($newPassword == $confirmPassword) {\n                    // Update the user's password in the database\n                    $query = \"UPDATE users SET password = '$newPassword' WHERE id = '$userId'\";\n                    $conn->query($query);\n\n                    // Remove the token from the database\n                    $query = \"UPDATE users SET password_reset_token = '' WHERE id = '$userId'\";\n                    $conn->query($query);\n                } else {\n                    echo 'Passwords do not match';\n                }\n            }\n        }\n    } else {\n        echo 'Invalid token';\n    }\n\n    // Close database connection\n    $conn->close();\n}\n\n?>\n```"]}
