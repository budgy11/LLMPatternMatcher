{"prompt": "Create a forgot password function using php", "llm_output": "Here's an example of how to create a \"forgot password\" function using PHP:\n\n**Database Setup**\n\nFor this example, let's assume we have a database with a table called `users` that has the following columns:\n\n| Column Name | Data Type |\n| --- | --- |\n| id | int (primary key) |\n| email | varchar(255) |\n| password | varchar(255) |\n\n**PHP Code**\n\nCreate a new PHP file, e.g. `forgot_password.php`, and add the following code:\n```php\n<?php\n\n// Configuration settings\ndefine('DB_HOST', 'your_database_host');\ndefine('DB_USERNAME', 'your_database_username');\ndefine('DB_PASSWORD', 'your_database_password');\ndefine('DB_NAME', 'your_database_name');\n\n// Connect to database\n$mysqli = new mysqli(DB_HOST, DB_USERNAME, DB_PASSWORD, DB_NAME);\n\nif ($mysqli->connect_error) {\n    die(\"Connection failed: \" . $mysqli->connect_error);\n}\n\n// Check if form has been submitted\nif (isset($_POST['email'])) {\n\n    // Get user's email from form data\n    $email = $_POST['email'];\n\n    // SQL query to retrieve user's information\n    $query = \"SELECT * FROM users WHERE email = '$email'\";\n    $result = $mysqli->query($query);\n\n    if ($result->num_rows > 0) {\n\n        // Retrieve user's information\n        while ($row = $result->fetch_assoc()) {\n            $user_id = $row['id'];\n            $username = $row['username'];\n            $email = $row['email'];\n\n            // Generate a password reset token (random string)\n            $token = substr(str_shuffle('abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'), 0, 32);\n\n            // Update user's information with new token\n            $update_query = \"UPDATE users SET token = '$token' WHERE id = '$user_id'\";\n            $mysqli->query($update_query);\n\n            // Send email to user with password reset link\n            $to = $email;\n            $subject = 'Password Reset Link';\n            $message = '<p>Click on the following link to reset your password:</p><a href=\"http://' . $_SERVER['HTTP_HOST'] . '/reset_password.php?token=' . $token . '\">Reset Password</a>';\n            mail($to, $subject, $message);\n\n            echo 'A password reset email has been sent to your email address.';\n        }\n    } else {\n        echo 'No user found with that email address.';\n    }\n\n} else {\n\n    // Form not submitted, display form\n    ?>\n\n    <h1>Forgot Password</h1>\n\n    <form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\">\n        <label for=\"email\">Email:</label>\n        <input type=\"text\" id=\"email\" name=\"email\" required><br><br>\n        <input type=\"submit\" value=\"Submit\">\n    </form>\n\n    <?php\n}\n\n// Close database connection\n$mysqli->close();\n\n?>\n```\n**How it Works**\n\n1. The script checks if the form has been submitted by checking for the presence of `$_POST['email']`.\n2. If the form has been submitted, it retrieves the user's email address from the form data.\n3. It runs an SQL query to retrieve the user's information from the database based on their email address.\n4. If a matching user is found, it generates a random password reset token and updates the user's information with this new token.\n5. The script sends an email to the user with a link to the `reset_password.php` page, which will contain the password reset form.\n\n**Security Notes**\n\n1. **Use prepared statements**: This example uses string concatenation to build the SQL query, which is not recommended as it introduces security risks (e.g., SQL injection). Use prepared statements instead.\n2. **Hash passwords**: Passwords should be stored in the database hashed using a secure hashing algorithm like bcrypt or PBKDF2.\n3. **Validate email addresses**: Before sending emails to users, validate their email addresses to prevent spamming.\n\nI hope this example helps you create your own \"forgot password\" function using PHP!", "code_blocks": ["```php\n<?php\n\n// Configuration settings\ndefine('DB_HOST', 'your_database_host');\ndefine('DB_USERNAME', 'your_database_username');\ndefine('DB_PASSWORD', 'your_database_password');\ndefine('DB_NAME', 'your_database_name');\n\n// Connect to database\n$mysqli = new mysqli(DB_HOST, DB_USERNAME, DB_PASSWORD, DB_NAME);\n\nif ($mysqli->connect_error) {\n    die(\"Connection failed: \" . $mysqli->connect_error);\n}\n\n// Check if form has been submitted\nif (isset($_POST['email'])) {\n\n    // Get user's email from form data\n    $email = $_POST['email'];\n\n    // SQL query to retrieve user's information\n    $query = \"SELECT * FROM users WHERE email = '$email'\";\n    $result = $mysqli->query($query);\n\n    if ($result->num_rows > 0) {\n\n        // Retrieve user's information\n        while ($row = $result->fetch_assoc()) {\n            $user_id = $row['id'];\n            $username = $row['username'];\n            $email = $row['email'];\n\n            // Generate a password reset token (random string)\n            $token = substr(str_shuffle('abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'), 0, 32);\n\n            // Update user's information with new token\n            $update_query = \"UPDATE users SET token = '$token' WHERE id = '$user_id'\";\n            $mysqli->query($update_query);\n\n            // Send email to user with password reset link\n            $to = $email;\n            $subject = 'Password Reset Link';\n            $message = '<p>Click on the following link to reset your password:</p><a href=\"http://' . $_SERVER['HTTP_HOST'] . '/reset_password.php?token=' . $token . '\">Reset Password</a>';\n            mail($to, $subject, $message);\n\n            echo 'A password reset email has been sent to your email address.';\n        }\n    } else {\n        echo 'No user found with that email address.';\n    }\n\n} else {\n\n    // Form not submitted, display form\n    ?>\n\n    <h1>Forgot Password</h1>\n\n    <form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\">\n        <label for=\"email\">Email:</label>\n        <input type=\"text\" id=\"email\" name=\"email\" required><br><br>\n        <input type=\"submit\" value=\"Submit\">\n    </form>\n\n    <?php\n}\n\n// Close database connection\n$mysqli->close();\n\n?>\n```"]}
