{"prompt": "Create a forgot password function using php", "llm_output": "Here's an example of how to create a \"Forgot Password\" function in PHP:\n\n**Database Structure**\n\nFirst, we need to create a database table to store user information. Let's assume we have the following columns:\n\n* `id` (primary key)\n* `username`\n* `email`\n* `password` (hashed using a library like `password_hash`)\n* `reset_token`\n\nCreate a new PHP file called `forgot_password.php` and add the following code:\n```php\n<?php\n\n// Configuration\n$db_host = 'localhost';\n$db_username = 'your_username';\n$db_password = 'your_password';\n$db_name = 'your_database';\n\n// Connect to database\n$conn = mysqli_connect($db_host, $db_username, $db_password, $db_name);\n\nif (!$conn) {\n    die('Connection failed: ' . mysqli_error($conn));\n}\n\nfunction generateRandomToken() {\n    return substr(bin2hex(random_bytes(32)), 0, 40);\n}\n\nfunction sendResetEmail($email, $token) {\n    // Email settings\n    $subject = \"Reset your password\";\n    $body = \"Click this link to reset your password: <a href='http://example.com/reset_password.php?token=$token'>Reset Password</a>\";\n\n    // Send email using a library like SwiftMailer or PHPMailer\n}\n\nfunction forgotPassword($email) {\n    global $conn;\n\n    // Check if user exists\n    $query = \"SELECT * FROM users WHERE email='$email'\";\n    $result = mysqli_query($conn, $query);\n\n    if (mysqli_num_rows($result) > 0) {\n        // Get user ID\n        $row = mysqli_fetch_assoc($result);\n        $userId = $row['id'];\n\n        // Generate reset token\n        $resetToken = generateRandomToken();\n\n        // Update password reset token in database\n        $query = \"UPDATE users SET reset_token='$resetToken' WHERE id=$userId\";\n        mysqli_query($conn, $query);\n\n        // Send email with reset link\n        sendResetEmail($email, $resetToken);\n    }\n\n    return true;\n}\n\n// Handle form submission\nif (isset($_POST['forgot_password'])) {\n    $email = $_POST['email'];\n    forgotPassword($email);\n}\n\n?>\n```\n**Explanation**\n\n1. We connect to the database using `mysqli_connect`.\n2. The `generateRandomToken` function generates a random token using `random_bytes`.\n3. The `sendResetEmail` function sends an email with a reset link to the user.\n4. The `forgotPassword` function checks if the user exists, generates a reset token, updates it in the database, and sends an email with the reset link.\n5. We handle form submission by checking if the `forgot_password` button was clicked, and if so, we call the `forgotPassword` function.\n\n**Front-end Code**\n\nCreate an HTML file called `forget_password.html` with the following code:\n```html\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Forgot Password</title>\n</head>\n<body>\n\n<h1>Forgot Password</h1>\n\n<form action=\"forgot_password.php\" method=\"post\">\n    Email: <input type=\"email\" name=\"email\"><br><br>\n    <button type=\"submit\" name=\"forgot_password\">Send Reset Link</button>\n</form>\n\n</body>\n</html>\n```\n**Reset Password Page**\n\nCreate an HTML file called `reset_password.php` with the following code:\n```php\n<?php\n\n// Configuration\n$db_host = 'localhost';\n$db_username = 'your_username';\n$db_password = 'your_password';\n$db_name = 'your_database';\n\n// Connect to database\n$conn = mysqli_connect($db_host, $db_username, $db_password, $db_name);\n\nif (!$conn) {\n    die('Connection failed: ' . mysqli_error($conn));\n}\n\nfunction resetPassword($token, $newPassword) {\n    global $conn;\n\n    // Check if token is valid\n    $query = \"SELECT * FROM users WHERE reset_token='$token'\";\n    $result = mysqli_query($conn, $query);\n\n    if (mysqli_num_rows($result) > 0) {\n        // Get user ID\n        $row = mysqli_fetch_assoc($result);\n        $userId = $row['id'];\n\n        // Update password in database\n        $query = \"UPDATE users SET password=PASSWORD('$newPassword') WHERE id=$userId\";\n        mysqli_query($conn, $query);\n\n        // Delete reset token from database\n        $query = \"DELETE FROM users WHERE reset_token='$token'\";\n        mysqli_query($conn, $query);\n    }\n\n    return true;\n}\n\n// Handle form submission\nif (isset($_POST['reset_password'])) {\n    $token = $_GET['token'];\n    $newPassword = $_POST['password'];\n\n    // Validate token and password\n    if (!empty($token) && !empty($newPassword)) {\n        resetPassword($token, $newPassword);\n    }\n}\n\n?>\n```\n**Explanation**\n\n1. We connect to the database using `mysqli_connect`.\n2. The `resetPassword` function checks if the token is valid, updates the password in the database, and deletes the reset token.\n3. We handle form submission by checking if the `reset_password` button was clicked, and if so, we call the `resetPassword` function.\n\nNote: This is a basic example and you should adapt it to your specific needs. Make sure to use secure practices such as hashing and salting passwords, and use a library like `password_hash` to generate password hashes. Additionally, you may want to add additional validation and security measures to prevent abuse of the reset password feature.", "code_blocks": ["```php\n<?php\n\n// Configuration\n$db_host = 'localhost';\n$db_username = 'your_username';\n$db_password = 'your_password';\n$db_name = 'your_database';\n\n// Connect to database\n$conn = mysqli_connect($db_host, $db_username, $db_password, $db_name);\n\nif (!$conn) {\n    die('Connection failed: ' . mysqli_error($conn));\n}\n\nfunction generateRandomToken() {\n    return substr(bin2hex(random_bytes(32)), 0, 40);\n}\n\nfunction sendResetEmail($email, $token) {\n    // Email settings\n    $subject = \"Reset your password\";\n    $body = \"Click this link to reset your password: <a href='http://example.com/reset_password.php?token=$token'>Reset Password</a>\";\n\n    // Send email using a library like SwiftMailer or PHPMailer\n}\n\nfunction forgotPassword($email) {\n    global $conn;\n\n    // Check if user exists\n    $query = \"SELECT * FROM users WHERE email='$email'\";\n    $result = mysqli_query($conn, $query);\n\n    if (mysqli_num_rows($result) > 0) {\n        // Get user ID\n        $row = mysqli_fetch_assoc($result);\n        $userId = $row['id'];\n\n        // Generate reset token\n        $resetToken = generateRandomToken();\n\n        // Update password reset token in database\n        $query = \"UPDATE users SET reset_token='$resetToken' WHERE id=$userId\";\n        mysqli_query($conn, $query);\n\n        // Send email with reset link\n        sendResetEmail($email, $resetToken);\n    }\n\n    return true;\n}\n\n// Handle form submission\nif (isset($_POST['forgot_password'])) {\n    $email = $_POST['email'];\n    forgotPassword($email);\n}\n\n?>\n```", null, "```php\n<?php\n\n// Configuration\n$db_host = 'localhost';\n$db_username = 'your_username';\n$db_password = 'your_password';\n$db_name = 'your_database';\n\n// Connect to database\n$conn = mysqli_connect($db_host, $db_username, $db_password, $db_name);\n\nif (!$conn) {\n    die('Connection failed: ' . mysqli_error($conn));\n}\n\nfunction resetPassword($token, $newPassword) {\n    global $conn;\n\n    // Check if token is valid\n    $query = \"SELECT * FROM users WHERE reset_token='$token'\";\n    $result = mysqli_query($conn, $query);\n\n    if (mysqli_num_rows($result) > 0) {\n        // Get user ID\n        $row = mysqli_fetch_assoc($result);\n        $userId = $row['id'];\n\n        // Update password in database\n        $query = \"UPDATE users SET password=PASSWORD('$newPassword') WHERE id=$userId\";\n        mysqli_query($conn, $query);\n\n        // Delete reset token from database\n        $query = \"DELETE FROM users WHERE reset_token='$token'\";\n        mysqli_query($conn, $query);\n    }\n\n    return true;\n}\n\n// Handle form submission\nif (isset($_POST['reset_password'])) {\n    $token = $_GET['token'];\n    $newPassword = $_POST['password'];\n\n    // Validate token and password\n    if (!empty($token) && !empty($newPassword)) {\n        resetPassword($token, $newPassword);\n    }\n}\n\n?>\n```"]}
