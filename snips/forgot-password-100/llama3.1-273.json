{"prompt": "Create a forgot password function using php", "llm_output": "Here's an example of how to create a forgot password function in PHP:\n\n**Database Schema**\n\nFirst, let's assume we have a database table called `users` with the following columns:\n\n| Column Name | Data Type |\n| --- | --- |\n| id | int (primary key) |\n| email | varchar(255) |\n| password | varchar(255) |\n| reset_token | varchar(255) |\n\n**Forgot Password Function**\n\nCreate a PHP file called `forgot_password.php` and add the following code:\n```php\n<?php\n\nrequire_once 'database.php'; // assuming you have a database connection script\n\nif (isset($_POST['email'])) {\n    $email = $_POST['email'];\n    \n    // Check if email exists in the database\n    $query = \"SELECT * FROM users WHERE email = '$email'\";\n    $result = mysqli_query($db, $query);\n    \n    if ($result && mysqli_num_rows($result) > 0) {\n        // Email found, generate a reset token and send an email with a link to reset the password\n        \n        $user_data = mysqli_fetch_assoc($result);\n        \n        // Generate a random reset token\n        $reset_token = bin2hex(random_bytes(32));\n        \n        // Update the user data in the database with the new reset token\n        $update_query = \"UPDATE users SET reset_token = '$reset_token' WHERE email = '$email'\";\n        mysqli_query($db, $update_query);\n        \n        // Send an email to the user with a link to reset their password\n        $subject = 'Reset your password';\n        $message = \"Click here to reset your password: <a href='\" . $_SERVER['HTTP_HOST'] . \"/reset_password.php?email=$email&token=$reset_token'>Reset Password</a>\";\n        mail($email, $subject, $message);\n        \n        echo \"A link has been sent to your email to reset your password.\";\n    } else {\n        echo \"Email not found in our database. Please try again with a different email.\";\n    }\n} else {\n    // Display the forgot password form\n    ?>\n    <form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\">\n        <label>Email:</label>\n        <input type=\"email\" name=\"email\" required />\n        <button type=\"submit\">Send Reset Link</button>\n    </form>\n    <?php\n}\n```\n**Reset Password Function**\n\nCreate another PHP file called `reset_password.php` and add the following code:\n```php\n<?php\n\nrequire_once 'database.php'; // assuming you have a database connection script\n\nif (isset($_GET['email']) && isset($_GET['token'])) {\n    $email = $_GET['email'];\n    $token = $_GET['token'];\n    \n    // Check if the token is valid and not expired\n    $query = \"SELECT * FROM users WHERE email = '$email' AND reset_token = '$token'\";\n    $result = mysqli_query($db, $query);\n    \n    if ($result && mysqli_num_rows($result) > 0) {\n        // Token is valid, allow user to reset their password\n        \n        $user_data = mysqli_fetch_assoc($result);\n        \n        // Display the reset password form\n        ?>\n        <form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\">\n            <label>New Password:</label>\n            <input type=\"password\" name=\"new_password\" required />\n            <label>Confirm New Password:</label>\n            <input type=\"password\" name=\"confirm_new_password\" required />\n            <button type=\"submit\">Reset Password</button>\n        </form>\n        <?php\n        \n    } else {\n        echo \"Invalid token or expired. Please try again with a different link.\";\n    }\n} elseif (isset($_POST['new_password']) && isset($_POST['confirm_new_password'])) {\n    // User submitted the reset password form\n    \n    $new_password = $_POST['new_password'];\n    $confirm_new_password = $_POST['confirm_new_password'];\n    \n    if ($new_password === $confirm_new_password) {\n        // Update the user's password in the database\n        $update_query = \"UPDATE users SET password = '$new_password' WHERE email = '\" . $_GET['email'] . \"'\";\n        mysqli_query($db, $update_query);\n        \n        echo \"Password reset successfully!\";\n    } else {\n        echo \"Passwords do not match. Please try again.\";\n    }\n}\n```\n**Security Notes**\n\n* Make sure to hash and store passwords securely using a library like `password_hash` and `password_verify`.\n* Use prepared statements or parameterized queries to prevent SQL injection attacks.\n* Limit the number of attempts to reset password to prevent brute-force attacks.\n\nThis is a basic example, you should adapt it to your specific needs and security requirements.", "code_blocks": ["```php\n<?php\n\nrequire_once 'database.php'; // assuming you have a database connection script\n\nif (isset($_POST['email'])) {\n    $email = $_POST['email'];\n    \n    // Check if email exists in the database\n    $query = \"SELECT * FROM users WHERE email = '$email'\";\n    $result = mysqli_query($db, $query);\n    \n    if ($result && mysqli_num_rows($result) > 0) {\n        // Email found, generate a reset token and send an email with a link to reset the password\n        \n        $user_data = mysqli_fetch_assoc($result);\n        \n        // Generate a random reset token\n        $reset_token = bin2hex(random_bytes(32));\n        \n        // Update the user data in the database with the new reset token\n        $update_query = \"UPDATE users SET reset_token = '$reset_token' WHERE email = '$email'\";\n        mysqli_query($db, $update_query);\n        \n        // Send an email to the user with a link to reset their password\n        $subject = 'Reset your password';\n        $message = \"Click here to reset your password: <a href='\" . $_SERVER['HTTP_HOST'] . \"/reset_password.php?email=$email&token=$reset_token'>Reset Password</a>\";\n        mail($email, $subject, $message);\n        \n        echo \"A link has been sent to your email to reset your password.\";\n    } else {\n        echo \"Email not found in our database. Please try again with a different email.\";\n    }\n} else {\n    // Display the forgot password form\n    ?>\n    <form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\">\n        <label>Email:</label>\n        <input type=\"email\" name=\"email\" required />\n        <button type=\"submit\">Send Reset Link</button>\n    </form>\n    <?php\n}\n```", "```php\n<?php\n\nrequire_once 'database.php'; // assuming you have a database connection script\n\nif (isset($_GET['email']) && isset($_GET['token'])) {\n    $email = $_GET['email'];\n    $token = $_GET['token'];\n    \n    // Check if the token is valid and not expired\n    $query = \"SELECT * FROM users WHERE email = '$email' AND reset_token = '$token'\";\n    $result = mysqli_query($db, $query);\n    \n    if ($result && mysqli_num_rows($result) > 0) {\n        // Token is valid, allow user to reset their password\n        \n        $user_data = mysqli_fetch_assoc($result);\n        \n        // Display the reset password form\n        ?>\n        <form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\">\n            <label>New Password:</label>\n            <input type=\"password\" name=\"new_password\" required />\n            <label>Confirm New Password:</label>\n            <input type=\"password\" name=\"confirm_new_password\" required />\n            <button type=\"submit\">Reset Password</button>\n        </form>\n        <?php\n        \n    } else {\n        echo \"Invalid token or expired. Please try again with a different link.\";\n    }\n} elseif (isset($_POST['new_password']) && isset($_POST['confirm_new_password'])) {\n    // User submitted the reset password form\n    \n    $new_password = $_POST['new_password'];\n    $confirm_new_password = $_POST['confirm_new_password'];\n    \n    if ($new_password === $confirm_new_password) {\n        // Update the user's password in the database\n        $update_query = \"UPDATE users SET password = '$new_password' WHERE email = '\" . $_GET['email'] . \"'\";\n        mysqli_query($db, $update_query);\n        \n        echo \"Password reset successfully!\";\n    } else {\n        echo \"Passwords do not match. Please try again.\";\n    }\n}\n```"]}
