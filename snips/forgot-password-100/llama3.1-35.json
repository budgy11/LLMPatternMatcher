{"prompt": "Create a forgot password function using php", "llm_output": "Here's an example of how you can create a \"Forgot Password\" function using PHP. This example assumes that you have a MySQL database and are storing user passwords securely (hashed) using the `password_hash()` function.\n\n**Database Schema**\n\nFirst, let's create a simple table to store user credentials:\n\n```sql\nCREATE TABLE users (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  username VARCHAR(255),\n  email VARCHAR(255),\n  passwordHash VARCHAR(255)\n);\n```\n\n**PHP Function to Send Reset Password Link**\n\nCreate a new PHP file (e.g., `forgot_password.php`) and add the following code:\n\n```php\n<?php\n\n// Configuration settings\ndefine('SITE_URL', 'http://example.com');\ndefine('SECRET_KEY', 'your_secret_key_here');\n\nrequire_once 'db_connect.php'; // assume this is your database connection script\n\nif (isset($_POST['username'])) {\n  $username = $_POST['username'];\n  $email = $_POST['email'];\n\n  // Check if the user exists\n  $query = \"SELECT id FROM users WHERE username = '$username' AND email = '$email'\";\n  $result = mysqli_query($conn, $query);\n\n  if (mysqli_num_rows($result) > 0) {\n    // Generate a random token and store it in the database\n    $token = bin2hex(random_bytes(32));\n    $updateQuery = \"UPDATE users SET resetToken = '$token' WHERE username = '$username'\";\n    mysqli_query($conn, $updateQuery);\n\n    // Send password reset email to the user's email address\n    sendPasswordResetEmail($email, $token);\n  } else {\n    echo 'Error: User not found';\n  }\n} else {\n  ?>\n\n  <form action=\"\" method=\"post\">\n    <label for=\"username\">Username:</label>\n    <input type=\"text\" id=\"username\" name=\"username\"><br><br>\n    <label for=\"email\">Email:</label>\n    <input type=\"email\" id=\"email\" name=\"email\"><br><br>\n    <button type=\"submit\" name=\"submit\">Send Reset Link</button>\n  </form>\n\n  <?php\n}\n\nfunction sendPasswordResetEmail($email, $token) {\n  $subject = 'Reset Your Password';\n  $body = \"Click on the following link to reset your password: <a href='\" . SITE_URL . \"/reset_password.php?token=$token'>$siteUrl/reset_password.php?token=$token</a>\";\n  mail($email, $subject, $body);\n}\n```\n\n**PHP Function for Reset Password**\n\nCreate another PHP file (e.g., `reset_password.php`) and add the following code:\n\n```php\n<?php\n\nrequire_once 'db_connect.php'; // assume this is your database connection script\n\nif (isset($_GET['token'])) {\n  $token = $_GET['token'];\n\n  // Check if the token exists in the database\n  $query = \"SELECT id FROM users WHERE resetToken = '$token'\";\n  $result = mysqli_query($conn, $query);\n\n  if (mysqli_num_rows($result) > 0) {\n    // Get the user's data from the database\n    $userQuery = \"SELECT * FROM users WHERE resetToken = '$token'\";\n    $userData = mysqli_fetch_assoc(mysqli_query($conn, $userQuery));\n\n    // Allow the user to reset their password\n    echo 'Enter your new password: ';\n    echo '<input type=\"password\" id=\"newPassword\" name=\"newPassword\"><br><br>';\n    echo '<button type=\"submit\" name=\"reset\">Reset Password</button>';\n\n    if (isset($_POST['reset'])) {\n      $newPassword = $_POST['newPassword'];\n      $hashedPassword = password_hash($newPassword, PASSWORD_DEFAULT);\n\n      // Update the user's password in the database\n      $updateQuery = \"UPDATE users SET passwordHash = '$hashedPassword' WHERE resetToken = '$token'\";\n      mysqli_query($conn, $updateQuery);\n\n      echo 'Your password has been successfully updated!';\n    }\n  } else {\n    echo 'Error: Invalid token';\n  }\n}\n?>\n```\n\n**How it Works**\n\n1. The user visits the \"Forgot Password\" page and enters their username and email address.\n2. If the user exists in the database, a random token is generated and stored in the database alongside the user's data.\n3. An email with a password reset link is sent to the user's email address. The link contains the `token` that was just generated.\n4. When the user clicks on the password reset link, they are taken to a new page where they can enter their new password.\n5. If the token is valid, the user's password is updated in the database with the new hashed password.\n\nPlease note that this is a basic example and you should adjust it according to your specific needs and security requirements.", "code_blocks": [null, "```php\n<?php\n\n// Configuration settings\ndefine('SITE_URL', 'http://example.com');\ndefine('SECRET_KEY', 'your_secret_key_here');\n\nrequire_once 'db_connect.php'; // assume this is your database connection script\n\nif (isset($_POST['username'])) {\n  $username = $_POST['username'];\n  $email = $_POST['email'];\n\n  // Check if the user exists\n  $query = \"SELECT id FROM users WHERE username = '$username' AND email = '$email'\";\n  $result = mysqli_query($conn, $query);\n\n  if (mysqli_num_rows($result) > 0) {\n    // Generate a random token and store it in the database\n    $token = bin2hex(random_bytes(32));\n    $updateQuery = \"UPDATE users SET resetToken = '$token' WHERE username = '$username'\";\n    mysqli_query($conn, $updateQuery);\n\n    // Send password reset email to the user's email address\n    sendPasswordResetEmail($email, $token);\n  } else {\n    echo 'Error: User not found';\n  }\n} else {\n  ?>\n\n  <form action=\"\" method=\"post\">\n    <label for=\"username\">Username:</label>\n    <input type=\"text\" id=\"username\" name=\"username\"><br><br>\n    <label for=\"email\">Email:</label>\n    <input type=\"email\" id=\"email\" name=\"email\"><br><br>\n    <button type=\"submit\" name=\"submit\">Send Reset Link</button>\n  </form>\n\n  <?php\n}\n\nfunction sendPasswordResetEmail($email, $token) {\n  $subject = 'Reset Your Password';\n  $body = \"Click on the following link to reset your password: <a href='\" . SITE_URL . \"/reset_password.php?token=$token'>$siteUrl/reset_password.php?token=$token</a>\";\n  mail($email, $subject, $body);\n}\n```", "```php\n<?php\n\nrequire_once 'db_connect.php'; // assume this is your database connection script\n\nif (isset($_GET['token'])) {\n  $token = $_GET['token'];\n\n  // Check if the token exists in the database\n  $query = \"SELECT id FROM users WHERE resetToken = '$token'\";\n  $result = mysqli_query($conn, $query);\n\n  if (mysqli_num_rows($result) > 0) {\n    // Get the user's data from the database\n    $userQuery = \"SELECT * FROM users WHERE resetToken = '$token'\";\n    $userData = mysqli_fetch_assoc(mysqli_query($conn, $userQuery));\n\n    // Allow the user to reset their password\n    echo 'Enter your new password: ';\n    echo '<input type=\"password\" id=\"newPassword\" name=\"newPassword\"><br><br>';\n    echo '<button type=\"submit\" name=\"reset\">Reset Password</button>';\n\n    if (isset($_POST['reset'])) {\n      $newPassword = $_POST['newPassword'];\n      $hashedPassword = password_hash($newPassword, PASSWORD_DEFAULT);\n\n      // Update the user's password in the database\n      $updateQuery = \"UPDATE users SET passwordHash = '$hashedPassword' WHERE resetToken = '$token'\";\n      mysqli_query($conn, $updateQuery);\n\n      echo 'Your password has been successfully updated!';\n    }\n  } else {\n    echo 'Error: Invalid token';\n  }\n}\n?>\n```"]}
