{"prompt": "Create a forgot password function using php", "llm_output": "Here is an example of how you can create a \"forgot password\" functionality using PHP:\n\n**Database Schema**\n\nFor this example, we'll assume that we have a table called `users` with the following structure:\n```sql\nCREATE TABLE users (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  email VARCHAR(255) NOT NULL UNIQUE,\n  password VARCHAR(255) NOT NULL,\n  reset_token VARCHAR(255)\n);\n```\n**PHP Code**\n\nWe'll create a PHP script that handles the forgot password functionality. Save this code in a file called `forgot_password.php`:\n```php\n<?php\n\n// Configuration settings\n$site_name = \"Example Website\";\n$reset_link_expires_in = 3600; // 1 hour\n\n// Database connection settings\n$host = 'localhost';\n$username = 'your_username';\n$password = 'your_password';\n$dbname = 'your_database';\n\n// Connect to database\n$conn = new mysqli($host, $username, $password, $dbname);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\nfunction send_reset_link($email, $reset_token)\n{\n    // Generate reset link URL\n    $reset_link_url = \"http://\" . $_SERVER['HTTP_HOST'] . \"/reset-password.php?token=\" . $reset_token;\n\n    // Send email with reset link\n    $to = $email;\n    $subject = \"Reset Password for $site_name\";\n    $message = \"\n        Dear User,\n\n        Please click the following link to reset your password:\n\n        $reset_link_url\n\n        If you did not request a password reset, please ignore this email.\n\n        Best regards,\n        $site_name\n    \";\n\n    mail($to, $subject, $message);\n}\n\nfunction reset_password()\n{\n    // Get POST variables\n    $email = $_POST['email'];\n\n    // Check if user exists\n    $query = \"SELECT * FROM users WHERE email = '$email'\";\n    $result = $conn->query($query);\n\n    if ($result->num_rows > 0) {\n        // Generate reset token\n        $reset_token = bin2hex(random_bytes(16));\n\n        // Update user with new reset token\n        $update_query = \"UPDATE users SET reset_token = '$reset_token' WHERE email = '$email'\";\n        $conn->query($update_query);\n\n        // Send reset link to user's email\n        send_reset_link($email, $reset_token);\n    } else {\n        echo \"Error: User not found.\";\n    }\n}\n\nif (isset($_POST['submit'])) {\n    reset_password();\n} else {\n    ?>\n    <form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\">\n        <input type=\"text\" name=\"email\" placeholder=\"Email\">\n        <button type=\"submit\" name=\"submit\">Send Reset Link</button>\n    </form>\n    <?php\n}\n?>\n```\n**How it Works**\n\n1. When the user submits the form, the `reset_password()` function is called with their email address.\n2. The function checks if a user exists in the database with the provided email address.\n3. If the user exists, a new reset token is generated and stored in the user's record in the database.\n4. A reset link is sent to the user's email with the reset token as a parameter.\n5. The user can then click on the reset link to access a page where they can enter their new password.\n\n**Example Usage**\n\nTo test this code, create a new file called `reset-password.php` and save it in the same directory as the `forgot_password.php` file:\n```php\n<?php\n\n// Connect to database\n$conn = new mysqli('localhost', 'your_username', 'your_password', 'your_database');\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Get reset token from URL parameter\n$reset_token = $_GET['token'];\n\n// Check if user has a valid reset token\n$query = \"SELECT * FROM users WHERE reset_token = '$reset_token'\";\n$result = $conn->query($query);\n\nif ($result->num_rows > 0) {\n    // User has a valid reset token, display password form\n    ?>\n    <form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\">\n        <input type=\"password\" name=\"new_password\">\n        <button type=\"submit\">Reset Password</button>\n    </form>\n    <?php\n} else {\n    // User does not have a valid reset token, display error message\n    echo \"Error: Invalid reset token.\";\n}\n?>\n```\nTo test the code, submit the form in `forgot_password.php` with a valid email address. You should receive an email with a reset link. Click on the link to access the password form in `reset-password.php`. Enter your new password and click Submit to update your password.\n\nNote: This is just a basic example and you should modify it to fit your specific needs. Additionally, this code does not include any error handling or security measures that you may want to add to your production environment.", "code_blocks": [null, "```php\n<?php\n\n// Configuration settings\n$site_name = \"Example Website\";\n$reset_link_expires_in = 3600; // 1 hour\n\n// Database connection settings\n$host = 'localhost';\n$username = 'your_username';\n$password = 'your_password';\n$dbname = 'your_database';\n\n// Connect to database\n$conn = new mysqli($host, $username, $password, $dbname);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\nfunction send_reset_link($email, $reset_token)\n{\n    // Generate reset link URL\n    $reset_link_url = \"http://\" . $_SERVER['HTTP_HOST'] . \"/reset-password.php?token=\" . $reset_token;\n\n    // Send email with reset link\n    $to = $email;\n    $subject = \"Reset Password for $site_name\";\n    $message = \"\n        Dear User,\n\n        Please click the following link to reset your password:\n\n        $reset_link_url\n\n        If you did not request a password reset, please ignore this email.\n\n        Best regards,\n        $site_name\n    \";\n\n    mail($to, $subject, $message);\n}\n\nfunction reset_password()\n{\n    // Get POST variables\n    $email = $_POST['email'];\n\n    // Check if user exists\n    $query = \"SELECT * FROM users WHERE email = '$email'\";\n    $result = $conn->query($query);\n\n    if ($result->num_rows > 0) {\n        // Generate reset token\n        $reset_token = bin2hex(random_bytes(16));\n\n        // Update user with new reset token\n        $update_query = \"UPDATE users SET reset_token = '$reset_token' WHERE email = '$email'\";\n        $conn->query($update_query);\n\n        // Send reset link to user's email\n        send_reset_link($email, $reset_token);\n    } else {\n        echo \"Error: User not found.\";\n    }\n}\n\nif (isset($_POST['submit'])) {\n    reset_password();\n} else {\n    ?>\n    <form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\">\n        <input type=\"text\" name=\"email\" placeholder=\"Email\">\n        <button type=\"submit\" name=\"submit\">Send Reset Link</button>\n    </form>\n    <?php\n}\n?>\n```", "```php\n<?php\n\n// Connect to database\n$conn = new mysqli('localhost', 'your_username', 'your_password', 'your_database');\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Get reset token from URL parameter\n$reset_token = $_GET['token'];\n\n// Check if user has a valid reset token\n$query = \"SELECT * FROM users WHERE reset_token = '$reset_token'\";\n$result = $conn->query($query);\n\nif ($result->num_rows > 0) {\n    // User has a valid reset token, display password form\n    ?>\n    <form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\">\n        <input type=\"password\" name=\"new_password\">\n        <button type=\"submit\">Reset Password</button>\n    </form>\n    <?php\n} else {\n    // User does not have a valid reset token, display error message\n    echo \"Error: Invalid reset token.\";\n}\n?>\n```"]}
