{"prompt": "Create a forgot password function using php", "llm_output": "Here is an example of a simple \"Forgot Password\" function in PHP:\n\n**Database Structure**\n\nAssuming you have a database table `users` with the following structure:\n```sql\nCREATE TABLE users (\n  id INT PRIMARY KEY,\n  email VARCHAR(255) UNIQUE,\n  password VARCHAR(255),\n  reset_token VARCHAR(255)\n);\n```\n**PHP Code**\n```php\n<?php\n\n// Configuration\n$db_host = 'localhost';\n$db_username = 'your_username';\n$db_password = 'your_password';\n$db_name = 'your_database';\n\n// Connect to database\n$conn = new mysqli($db_host, $db_username, $db_password, $db_name);\n\nif ($conn->connect_error) {\n  die(\"Connection failed: \" . $conn->connect_error);\n}\n\nfunction forgot_password($email)\n{\n  global $conn;\n\n  // Check if email exists in the database\n  $query = \"SELECT * FROM users WHERE email = '$email'\";\n  $result = $conn->query($query);\n\n  if ($result->num_rows > 0) {\n    // Generate a reset token and store it in the database\n    $token = bin2hex(random_bytes(32));\n    $query = \"UPDATE users SET reset_token = '$token' WHERE email = '$email'\";\n    $conn->query($query);\n\n    // Send an email to the user with the reset link\n    send_email($email, $token);\n  } else {\n    echo 'Email not found';\n  }\n}\n\nfunction send_email($email, $token)\n{\n  // Use a library like SwiftMailer or PHPMailer to send an email\n  // For simplicity, we'll just use PHP's mail function\n  $subject = \"Reset Password\";\n  $body = \"Click this link to reset your password: http://example.com/reset_password?token=$token\";\n\n  if (mail($email, $subject, $body)) {\n    echo 'Email sent';\n  } else {\n    echo 'Failed to send email';\n  }\n}\n\n// Handle form submission\nif (isset($_POST['submit'])) {\n  forgot_password($_POST['email']);\n}\n\n?>\n```\n**HTML Form**\n```html\n<form action=\"\" method=\"post\">\n  <input type=\"text\" name=\"email\" placeholder=\"Email\">\n  <button type=\"submit\" name=\"submit\">Send Reset Link</button>\n</form>\n```\n**How it Works**\n\n1. The user submits the form with their email address.\n2. The `forgot_password()` function is called with the email address as an argument.\n3. The function checks if the email exists in the database and generates a random reset token if it does.\n4. The reset token is stored in the database for that user's email address.\n5. An email is sent to the user with a link to reset their password, including the reset token.\n\n**Security Notes**\n\n* This code assumes you have a secure way of storing passwords (e.g., using bcrypt or Argon2).\n* The `reset_token` column in the database should be set to expire after a certain amount of time (e.g., 1 hour) to prevent brute-force attacks.\n* You should use a more secure method of sending emails, such as using a library like SwiftMailer or PHPMailer.", "code_blocks": [null, "```php\n<?php\n\n// Configuration\n$db_host = 'localhost';\n$db_username = 'your_username';\n$db_password = 'your_password';\n$db_name = 'your_database';\n\n// Connect to database\n$conn = new mysqli($db_host, $db_username, $db_password, $db_name);\n\nif ($conn->connect_error) {\n  die(\"Connection failed: \" . $conn->connect_error);\n}\n\nfunction forgot_password($email)\n{\n  global $conn;\n\n  // Check if email exists in the database\n  $query = \"SELECT * FROM users WHERE email = '$email'\";\n  $result = $conn->query($query);\n\n  if ($result->num_rows > 0) {\n    // Generate a reset token and store it in the database\n    $token = bin2hex(random_bytes(32));\n    $query = \"UPDATE users SET reset_token = '$token' WHERE email = '$email'\";\n    $conn->query($query);\n\n    // Send an email to the user with the reset link\n    send_email($email, $token);\n  } else {\n    echo 'Email not found';\n  }\n}\n\nfunction send_email($email, $token)\n{\n  // Use a library like SwiftMailer or PHPMailer to send an email\n  // For simplicity, we'll just use PHP's mail function\n  $subject = \"Reset Password\";\n  $body = \"Click this link to reset your password: http://example.com/reset_password?token=$token\";\n\n  if (mail($email, $subject, $body)) {\n    echo 'Email sent';\n  } else {\n    echo 'Failed to send email';\n  }\n}\n\n// Handle form submission\nif (isset($_POST['submit'])) {\n  forgot_password($_POST['email']);\n}\n\n?>\n```", null]}
