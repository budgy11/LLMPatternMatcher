{"prompt": "Create a forgot password function using php", "llm_output": "Here is an example of how you can create a \"forgot password\" functionality in PHP:\n\n**Database Schema**\n\nFirst, let's assume that we have the following database schema:\n```sql\nCREATE TABLE users (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  email VARCHAR(255) NOT NULL UNIQUE,\n  password VARCHAR(255) NOT NULL\n);\n```\nWe will store the reset token and expiration time in a separate table:\n```sql\nCREATE TABLE reset_tokens (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  user_id INT NOT NULL,\n  token VARCHAR(255) NOT NULL,\n  expires_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP + INTERVAL 1 HOUR\n);\n```\n**PHP Code**\n\nCreate the following PHP file (e.g., `forgot_password.php`) and include it in your project:\n```php\n<?php\n\n// Configuration\n$databaseHost = 'localhost';\n$databaseName = 'mydb';\n$databaseUsername = 'root';\n$databasePassword = '';\n\n// Connect to database\n$conn = new mysqli($databaseHost, $databaseUsername, $databasePassword, $databaseName);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Function to send password reset email\nfunction send_password_reset_email($email, $token) {\n    // Mail configuration (e.g., SMTP settings)\n    $mail = new PHPMailer();\n    $mail->isSMTP();\n    $mail->Host = 'smtp.example.com';\n    $mail->Port = 587;\n    $mail->SMTPSecure = 'tls';\n    $mail->SMTPAuth = true;\n    $mail->Username = 'your_email@example.com';\n    $mail->Password = 'your_password';\n\n    // Set sender and recipient email addresses\n    $mail->setFrom('your_email@example.com', 'Your Name');\n    $mail->addAddress($email);\n\n    // Set password reset token and expiration time (1 hour)\n    $reset_link = 'http://example.com/reset-password.php?token=' . $token;\n\n    // Email body\n    $body = '\n        <h2>Password Reset Request</h2>\n        <p>Hello!</p>\n        <p>You are receiving this email because we received a password reset request for your account.</p>\n        <p>To reset your password, click the following link:</p>\n        <p><a href=\"' . $reset_link . '\">Reset Password</a></p>\n        <p>Expiration time: 1 hour</p>';\n\n    // Send email\n    $mail->isHTML(true);\n    $mail->Subject = 'Password Reset Request';\n    $mail->Body = $body;\n    if (!$mail->send()) {\n        echo 'Error sending email: ';\n        print_r($mail->ErrorInfo);\n    }\n}\n\n// Forgot password form handler\nif ($_SERVER['REQUEST_METHOD'] === 'POST') {\n    $email = $_POST['email'];\n\n    // Validate email address (e.g., using regular expression)\n    if (!preg_match('/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$/', $email)) {\n        echo 'Invalid email address';\n        exit;\n    }\n\n    // Check if user exists\n    $query = \"SELECT * FROM users WHERE email = '$email'\";\n    $result = $conn->query($query);\n    if ($result->num_rows === 0) {\n        echo 'User not found';\n        exit;\n    }\n\n    // Generate random reset token and expiration time (1 hour)\n    $token = bin2hex(random_bytes(32));\n    $expires_at = date('Y-m-d H:i:s', strtotime('+1 hour'));\n\n    // Store reset token in database\n    $query = \"INSERT INTO reset_tokens (user_id, token, expires_at) VALUES ((SELECT id FROM users WHERE email = '$email'), '$token', '$expires_at')\";\n    $conn->query($query);\n\n    // Send password reset email\n    send_password_reset_email($email, $token);\n}\n\n// Close database connection\n$conn->close();\n\n?>\n```\n**Reset Password Form**\n\nCreate the following HTML form (e.g., `reset-password.php`) to handle password resets:\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Reset Password</title>\n</head>\n<body>\n\n<form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\">\n    <label for=\"email\">Email Address:</label>\n    <input type=\"email\" id=\"email\" name=\"email\" required>\n    <button type=\"submit\">Submit</button>\n</form>\n\n<?php if (isset($_GET['token'])) { ?>\n    <h2>Reset Password</h2>\n    <p>You are about to reset your password. Please enter a new password and confirm it.</p>\n    <form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\">\n        <input type=\"hidden\" name=\"reset_token\" value=\"<?php echo $_GET['token']; ?>\">\n        <label for=\"password\">New Password:</label>\n        <input type=\"password\" id=\"password\" name=\"password\" required>\n        <label for=\"confirm_password\">Confirm Password:</label>\n        <input type=\"password\" id=\"confirm_password\" name=\"confirm_password\" required>\n        <button type=\"submit\">Reset Password</button>\n    </form>\n<?php } ?>\n\n</body>\n</html>\n```\nThis is a basic example of how you can create a forgot password functionality in PHP. Note that this code does not include any error handling, security measures (e.g., hashing passwords), or email verification. You should consider implementing these features to make your application more secure.\n\nTo use this code, replace the placeholders with your own values:\n\n* Database connection details\n* Email configuration settings\n* Mailer class (e.g., PHPMailer)\n* Password reset token expiration time", "code_blocks": [null, null, "```php\n<?php\n\n// Configuration\n$databaseHost = 'localhost';\n$databaseName = 'mydb';\n$databaseUsername = 'root';\n$databasePassword = '';\n\n// Connect to database\n$conn = new mysqli($databaseHost, $databaseUsername, $databasePassword, $databaseName);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Function to send password reset email\nfunction send_password_reset_email($email, $token) {\n    // Mail configuration (e.g., SMTP settings)\n    $mail = new PHPMailer();\n    $mail->isSMTP();\n    $mail->Host = 'smtp.example.com';\n    $mail->Port = 587;\n    $mail->SMTPSecure = 'tls';\n    $mail->SMTPAuth = true;\n    $mail->Username = 'your_email@example.com';\n    $mail->Password = 'your_password';\n\n    // Set sender and recipient email addresses\n    $mail->setFrom('your_email@example.com', 'Your Name');\n    $mail->addAddress($email);\n\n    // Set password reset token and expiration time (1 hour)\n    $reset_link = 'http://example.com/reset-password.php?token=' . $token;\n\n    // Email body\n    $body = '\n        <h2>Password Reset Request</h2>\n        <p>Hello!</p>\n        <p>You are receiving this email because we received a password reset request for your account.</p>\n        <p>To reset your password, click the following link:</p>\n        <p><a href=\"' . $reset_link . '\">Reset Password</a></p>\n        <p>Expiration time: 1 hour</p>';\n\n    // Send email\n    $mail->isHTML(true);\n    $mail->Subject = 'Password Reset Request';\n    $mail->Body = $body;\n    if (!$mail->send()) {\n        echo 'Error sending email: ';\n        print_r($mail->ErrorInfo);\n    }\n}\n\n// Forgot password form handler\nif ($_SERVER['REQUEST_METHOD'] === 'POST') {\n    $email = $_POST['email'];\n\n    // Validate email address (e.g., using regular expression)\n    if (!preg_match('/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$/', $email)) {\n        echo 'Invalid email address';\n        exit;\n    }\n\n    // Check if user exists\n    $query = \"SELECT * FROM users WHERE email = '$email'\";\n    $result = $conn->query($query);\n    if ($result->num_rows === 0) {\n        echo 'User not found';\n        exit;\n    }\n\n    // Generate random reset token and expiration time (1 hour)\n    $token = bin2hex(random_bytes(32));\n    $expires_at = date('Y-m-d H:i:s', strtotime('+1 hour'));\n\n    // Store reset token in database\n    $query = \"INSERT INTO reset_tokens (user_id, token, expires_at) VALUES ((SELECT id FROM users WHERE email = '$email'), '$token', '$expires_at')\";\n    $conn->query($query);\n\n    // Send password reset email\n    send_password_reset_email($email, $token);\n}\n\n// Close database connection\n$conn->close();\n\n?>\n```", null]}
