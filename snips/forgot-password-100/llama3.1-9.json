{"prompt": "Create a forgot password function using php", "llm_output": "Here's an example of a simple \"forgot password\" function in PHP. This function will send a reset password email to the user with a link that allows them to reset their password.\n\n**Please note:**\n\n*   You'll need a database (e.g., MySQL) and a PHP web server for this example.\n*   We assume you have basic knowledge of PHP, HTML, CSS, and SQL.\n*   This is a basic implementation. In production environments, consider additional security measures like validation, sanitization, and hashing.\n\n**Database Setup:**\n\n```sql\nCREATE TABLE users (\n    id INT AUTO_INCREMENT,\n    email VARCHAR(255),\n    password VARCHAR(255) NOT NULL DEFAULT '',\n    PRIMARY KEY (id)\n);\n```\n\n**PHP Code (includes sending reset link):**\n\n### forgot_password.php\n\n```php\n<?php\n\n// Configuration\ndefine('SITE_URL', 'http://example.com/'); // replace with your site URL\ndefine('EMAIL_ADDRESS', 'admin@example.com'); // your email address for reset emails\n\nrequire_once 'db_connection.php'; // Your database connection script\n\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n    $email = $_POST['email'];\n\n    if (empty($email)) {\n        echo \"Email is required.\";\n        exit;\n    }\n\n    $sql = \"SELECT * FROM users WHERE email = '$email'\";\n    $result = mysqli_query($conn, $sql);\n\n    if (mysqli_num_rows($result) == 0) {\n        echo \"Email not found. Please check your email and try again.\";\n        exit;\n    } else {\n        // Get the user's ID\n        $row = mysqli_fetch_assoc($result);\n        $userId = $row['id'];\n\n        // Generate a random token for password reset\n        $token = bin2hex(random_bytes(32));\n\n        // Store the token in the database\n        $sql = \"UPDATE users SET password_reset_token = '$token' WHERE id = '$userId'\";\n        mysqli_query($conn, $sql);\n\n        // Send email with reset link\n        sendResetEmail($email, $token);\n    }\n}\n\nfunction sendResetEmail($email, $token) {\n    $subject = 'Reset Your Password';\n    $body = '\n        <p>Dear user,</p>\n        <p>To reset your password, please click on this link:</p>\n        <a href=\"' . SITE_URL . 'reset_password.php?token=' . $token . '\">Reset Your Password</a>\n        <p>Best regards,</p>\n    ';\n\n    mail($email, $subject, $body);\n}\n\n?>\n```\n\n### reset_password.php\n\n```php\n<?php\n\nrequire_once 'db_connection.php'; // Your database connection script\n\nif ($_SERVER['REQUEST_METHOD'] == 'GET') {\n    $token = $_GET['token'];\n\n    if (empty($token)) {\n        echo \"Invalid request.\";\n        exit;\n    }\n\n    $sql = \"SELECT * FROM users WHERE password_reset_token = '$token'\";\n    $result = mysqli_query($conn, $sql);\n\n    if (mysqli_num_rows($result) == 0) {\n        echo \"Token is invalid or has expired. Please try resetting your password again.\";\n        exit;\n    } else {\n        // The user's data is available here\n        // You can create a form for the new password and store it in the database.\n\n        ?>\n        <form action=\"update_password.php\" method=\"post\">\n            <label>Enter New Password:</label>\n            <input type=\"password\" name=\"new_password\"><br><br>\n            <input type=\"submit\" value=\"Change Password\">\n        </form>\n\n        <?php\n    }\n}\n\n?>\n```\n\n### update_password.php\n\n```php\n<?php\n\nrequire_once 'db_connection.php'; // Your database connection script\n\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n    $newPassword = $_POST['new_password'];\n\n    if (empty($newPassword)) {\n        echo \"New password is required.\";\n        exit;\n    }\n\n    $token = $_GET['token'];\n    $sql = \"UPDATE users SET password_reset_token = '', password = '$newPassword' WHERE password_reset_token = '$token'\";\n    mysqli_query($conn, $sql);\n\n    echo \"Your password has been updated successfully!\";\n}\n\n?>\n```\n\n### db_connection.php\n\n```php\n<?php\n$conn = new mysqli('localhost', 'username', 'password', 'database');\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n?>\n```\n\nThis example will send an email with a reset link when you visit the `forgot_password.php` page and provide your email. Once you click on this link, it will lead you to a form where you can enter your new password.\n\n**Note:** Make sure to replace `'http://example.com/'`, `'admin@example.com'`, `'localhost'`, `'username'`, `'password'`, and `'database'` with the actual values from your database and server settings. Also, ensure proper handling of email sending, form validation, and security measures (like hashing passwords) according to your requirements.\n\nFor a complete solution, consider using prepared statements for SQL queries and hash password functions (`password_hash()` in PHP 5.5+) to add an extra layer of security.", "code_blocks": [null, "```php\n<?php\n\n// Configuration\ndefine('SITE_URL', 'http://example.com/'); // replace with your site URL\ndefine('EMAIL_ADDRESS', 'admin@example.com'); // your email address for reset emails\n\nrequire_once 'db_connection.php'; // Your database connection script\n\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n    $email = $_POST['email'];\n\n    if (empty($email)) {\n        echo \"Email is required.\";\n        exit;\n    }\n\n    $sql = \"SELECT * FROM users WHERE email = '$email'\";\n    $result = mysqli_query($conn, $sql);\n\n    if (mysqli_num_rows($result) == 0) {\n        echo \"Email not found. Please check your email and try again.\";\n        exit;\n    } else {\n        // Get the user's ID\n        $row = mysqli_fetch_assoc($result);\n        $userId = $row['id'];\n\n        // Generate a random token for password reset\n        $token = bin2hex(random_bytes(32));\n\n        // Store the token in the database\n        $sql = \"UPDATE users SET password_reset_token = '$token' WHERE id = '$userId'\";\n        mysqli_query($conn, $sql);\n\n        // Send email with reset link\n        sendResetEmail($email, $token);\n    }\n}\n\nfunction sendResetEmail($email, $token) {\n    $subject = 'Reset Your Password';\n    $body = '\n        <p>Dear user,</p>\n        <p>To reset your password, please click on this link:</p>\n        <a href=\"' . SITE_URL . 'reset_password.php?token=' . $token . '\">Reset Your Password</a>\n        <p>Best regards,</p>\n    ';\n\n    mail($email, $subject, $body);\n}\n\n?>\n```", "```php\n<?php\n\nrequire_once 'db_connection.php'; // Your database connection script\n\nif ($_SERVER['REQUEST_METHOD'] == 'GET') {\n    $token = $_GET['token'];\n\n    if (empty($token)) {\n        echo \"Invalid request.\";\n        exit;\n    }\n\n    $sql = \"SELECT * FROM users WHERE password_reset_token = '$token'\";\n    $result = mysqli_query($conn, $sql);\n\n    if (mysqli_num_rows($result) == 0) {\n        echo \"Token is invalid or has expired. Please try resetting your password again.\";\n        exit;\n    } else {\n        // The user's data is available here\n        // You can create a form for the new password and store it in the database.\n\n        ?>\n        <form action=\"update_password.php\" method=\"post\">\n            <label>Enter New Password:</label>\n            <input type=\"password\" name=\"new_password\"><br><br>\n            <input type=\"submit\" value=\"Change Password\">\n        </form>\n\n        <?php\n    }\n}\n\n?>\n```", "```php\n<?php\n\nrequire_once 'db_connection.php'; // Your database connection script\n\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n    $newPassword = $_POST['new_password'];\n\n    if (empty($newPassword)) {\n        echo \"New password is required.\";\n        exit;\n    }\n\n    $token = $_GET['token'];\n    $sql = \"UPDATE users SET password_reset_token = '', password = '$newPassword' WHERE password_reset_token = '$token'\";\n    mysqli_query($conn, $sql);\n\n    echo \"Your password has been updated successfully!\";\n}\n\n?>\n```", "```php\n<?php\n$conn = new mysqli('localhost', 'username', 'password', 'database');\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n?>\n```"]}
