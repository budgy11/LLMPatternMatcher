{"prompt": "Create a forgot password function using php", "llm_output": "Here's an example of a forgotten password function in PHP. This will allow users to reset their passwords by entering their username and email address, which will then be checked against the database.\n\n**Note:** For this example, we'll use MySQL as our database management system.\n\n**Database Setup:**\n```sql\nCREATE TABLE users (\n    id INT PRIMARY KEY AUTO_INCREMENT,\n    username VARCHAR(255) NOT NULL,\n    password_hash CHAR(128),\n    email VARCHAR(255) NOT NULL,\n    reset_token VARCHAR(255),\n    reset_expires TIMESTAMP\n);\n```\n\n**php script (reset_password.php):**\n```php\n<?php\n\n// Configuration\n$db_host = 'localhost';\n$db_username = 'your_username';\n$db_password = 'your_password';\n$db_name = 'your_database';\n\n// Connect to database\n$conn = new mysqli($db_host, $db_username, $db_password, $db_name);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\nfunction resetPassword() {\n    global $conn;\n\n    // Retrieve data from request\n    $username = $_POST['username'];\n    $email = $_POST['email'];\n\n    // Check if username and email are set\n    if (empty($username) || empty($email)) {\n        echo \"Error: Username and Email must be filled in.\";\n        return false;\n    }\n\n    // Query to retrieve user data\n    $query = \"SELECT * FROM users WHERE username='\" . $username . \"' AND email='\" . $email . \"'\";\n    $result = $conn->query($query);\n\n    if ($result->num_rows == 0) {\n        echo \"Error: Username or Email not found.\";\n        return false;\n    }\n\n    // Retrieve user data\n    while ($row = $result->fetch_assoc()) {\n        $user_data = $row;\n\n        // Generate a reset token\n        $reset_token = bin2hex(random_bytes(32));\n        $reset_expires = time() + (30 * 60); // expires in 30 minutes\n\n        // Update user data with new reset token and expiration time\n        $query = \"UPDATE users SET reset_token='\" . $reset_token . \"', reset_expires='\" . $reset_expires . \"' WHERE username='\" . $username . \"'\";\n        $conn->query($query);\n\n        // Send email to user with link to reset password\n        sendEmail($user_data, $reset_token);\n    }\n}\n\nfunction sendEmail($data, $reset_token) {\n    // Email configuration (use PHPMailer or similar library)\n    $mail = new PHPMailer(true);\n\n    try {\n        // Email settings\n        $mail->CharSet = 'UTF-8';\n        $mail->isHTML();\n        $mail->addAddress($data['email']);\n        $mail->setFrom('your_email@example.com', 'Your Name');\n        $mail->Subject = \"Reset Password\";\n\n        // Email body (replace with your own template)\n        $body = \"\n            <h1>Password Reset</h1>\n            <p>To reset your password, click on this link:</p>\n            <a href='http://your-site.com/reset_password.php?reset_token=\" . $reset_token . \"'>Reset Password</a>\n        \";\n\n        // Send email\n        $mail->msgHTML($body);\n        $mail->send();\n    } catch (Exception $e) {\n        echo \"Error: Email not sent. \" . $mail->ErrorInfo;\n    }\n}\n\nif (isset($_POST['reset_password'])) {\n    resetPassword();\n}\n?>\n\n<form action=\"\" method=\"post\">\n    <label for=\"username\">Username:</label>\n    <input type=\"text\" id=\"username\" name=\"username\"><br><br>\n    <label for=\"email\">Email:</label>\n    <input type=\"text\" id=\"email\" name=\"email\"><br><br>\n    <button type=\"submit\" name=\"reset_password\">Reset Password</button>\n</form>\n\n<?php\n$conn->close();\n?>\n```\n\n**Explanation:**\n\nThis script performs the following actions:\n\n1. Checks if both `username` and `email` are provided by the user.\n2. If both fields are filled, it checks for a matching entry in the database using a SQL query.\n3. If an entry is found, it generates a random reset token, updates the user's data with this new token and expiration time (30 minutes).\n4. The script then sends an email to the user containing a link to reset their password.\n\n**Reset Password Link:**\n```php\nhttp://your-site.com/reset_password.php?reset_token=generated_reset_token\n```\n\nWhen the user clicks on the link, they will be directed to the `reset_password.php` file where they can enter their new password and submit it. We'll add a PHP script for this later.", "code_blocks": [null, "```php\n<?php\n\n// Configuration\n$db_host = 'localhost';\n$db_username = 'your_username';\n$db_password = 'your_password';\n$db_name = 'your_database';\n\n// Connect to database\n$conn = new mysqli($db_host, $db_username, $db_password, $db_name);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\nfunction resetPassword() {\n    global $conn;\n\n    // Retrieve data from request\n    $username = $_POST['username'];\n    $email = $_POST['email'];\n\n    // Check if username and email are set\n    if (empty($username) || empty($email)) {\n        echo \"Error: Username and Email must be filled in.\";\n        return false;\n    }\n\n    // Query to retrieve user data\n    $query = \"SELECT * FROM users WHERE username='\" . $username . \"' AND email='\" . $email . \"'\";\n    $result = $conn->query($query);\n\n    if ($result->num_rows == 0) {\n        echo \"Error: Username or Email not found.\";\n        return false;\n    }\n\n    // Retrieve user data\n    while ($row = $result->fetch_assoc()) {\n        $user_data = $row;\n\n        // Generate a reset token\n        $reset_token = bin2hex(random_bytes(32));\n        $reset_expires = time() + (30 * 60); // expires in 30 minutes\n\n        // Update user data with new reset token and expiration time\n        $query = \"UPDATE users SET reset_token='\" . $reset_token . \"', reset_expires='\" . $reset_expires . \"' WHERE username='\" . $username . \"'\";\n        $conn->query($query);\n\n        // Send email to user with link to reset password\n        sendEmail($user_data, $reset_token);\n    }\n}\n\nfunction sendEmail($data, $reset_token) {\n    // Email configuration (use PHPMailer or similar library)\n    $mail = new PHPMailer(true);\n\n    try {\n        // Email settings\n        $mail->CharSet = 'UTF-8';\n        $mail->isHTML();\n        $mail->addAddress($data['email']);\n        $mail->setFrom('your_email@example.com', 'Your Name');\n        $mail->Subject = \"Reset Password\";\n\n        // Email body (replace with your own template)\n        $body = \"\n            <h1>Password Reset</h1>\n            <p>To reset your password, click on this link:</p>\n            <a href='http://your-site.com/reset_password.php?reset_token=\" . $reset_token . \"'>Reset Password</a>\n        \";\n\n        // Send email\n        $mail->msgHTML($body);\n        $mail->send();\n    } catch (Exception $e) {\n        echo \"Error: Email not sent. \" . $mail->ErrorInfo;\n    }\n}\n\nif (isset($_POST['reset_password'])) {\n    resetPassword();\n}\n?>\n\n<form action=\"\" method=\"post\">\n    <label for=\"username\">Username:</label>\n    <input type=\"text\" id=\"username\" name=\"username\"><br><br>\n    <label for=\"email\">Email:</label>\n    <input type=\"text\" id=\"email\" name=\"email\"><br><br>\n    <button type=\"submit\" name=\"reset_password\">Reset Password</button>\n</form>\n\n<?php\n$conn->close();\n?>\n```", "```php\nhttp://your-site.com/reset_password.php?reset_token=generated_reset_token\n```"]}
