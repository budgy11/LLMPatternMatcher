{"prompt": "Create a forgot password function using php", "llm_output": "Here is an example of how you can create a \"Forgot Password\" function using PHP:\n\n**Database Schema**\n\nFor this example, we'll assume that your database has the following schema:\n```sql\nCREATE TABLE users (\n  id INT PRIMARY KEY,\n  email VARCHAR(255) NOT NULL,\n  password_hash VARCHAR(255) NOT NULL\n);\n```\n**PHP Code**\n\nCreate a new file called `forgot_password.php` and add the following code:\n```php\n<?php\n\n// Configuration\n$secret_key = 'your_secret_key_here';\n\n// Check if form has been submitted\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n  // Get email from POST data\n  $email = $_POST['email'];\n\n  // Validate email address\n  if (!filter_var($email, FILTER_VALIDATE_EMAIL)) {\n    echo 'Invalid email address';\n    exit;\n  }\n\n  // Query database for user with matching email\n  $query = \"SELECT * FROM users WHERE email = '$email'\";\n  $result = mysqli_query($connection, $query);\n\n  // Check if user exists\n  if (mysqli_num_rows($result) == 0) {\n    echo 'No account found with this email address';\n    exit;\n  }\n\n  // Get user ID and password hash from database\n  $row = mysqli_fetch_assoc($result);\n  $user_id = $row['id'];\n  $password_hash = $row['password_hash'];\n\n  // Generate random reset token (UUID)\n  $reset_token = bin2hex(random_bytes(32));\n\n  // Insert reset token into database\n  $query = \"INSERT INTO password_resets (user_id, reset_token) VALUES ('$user_id', '$reset_token')\";\n  mysqli_query($connection, $query);\n\n  // Send email with password reset link\n  send_password_reset_email($email, $reset_token);\n\n  echo 'Password reset link sent to your email address';\n} else {\n  // Display form if not submitted\n  ?>\n  <h1>Forgot Password</h1>\n  <form action=\"\" method=\"post\">\n    <label for=\"email\">Email:</label>\n    <input type=\"email\" id=\"email\" name=\"email\"><br><br>\n    <button type=\"submit\">Submit</button>\n  </form>\n  <?php\n}\n\n// Function to send password reset email\nfunction send_password_reset_email($email, $reset_token) {\n  // Send email using your preferred mail library (e.g. PHPMailer)\n  // For simplicity, this example uses built-in mail() function\n  $subject = 'Reset Password';\n  $body = \"Click on the following link to reset your password:\\n\\n\";\n  $body .= '<a href=\"http://your-website.com/reset-password?token=' . $reset_token . '\">Reset Password</a>';\n  mail($email, $subject, $body);\n}\n\n?>\n```\n**How it Works**\n\n1. The user submits the form with their email address.\n2. The script checks if the email address is valid using `filter_var`.\n3. If valid, the script queries the database for a user with matching email.\n4. If no user exists, the script displays an error message and exits.\n5. If a user exists, the script generates a random reset token (UUID) and stores it in the `password_resets` table associated with the user's ID.\n6. The script sends an email to the user with a password reset link containing the reset token.\n\n**Security Notes**\n\n* Make sure to store the secret key securely on your server, as it is used to generate random reset tokens.\n* Use a secure method to store and send passwords (e.g. bcrypt).\n* Always validate user input data using `filter_var` or other validation methods.\n\nThis example should give you a basic idea of how to implement a \"Forgot Password\" function using PHP. Remember to modify the code according to your specific database schema and email sending requirements.", "code_blocks": [null, "```php\n<?php\n\n// Configuration\n$secret_key = 'your_secret_key_here';\n\n// Check if form has been submitted\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n  // Get email from POST data\n  $email = $_POST['email'];\n\n  // Validate email address\n  if (!filter_var($email, FILTER_VALIDATE_EMAIL)) {\n    echo 'Invalid email address';\n    exit;\n  }\n\n  // Query database for user with matching email\n  $query = \"SELECT * FROM users WHERE email = '$email'\";\n  $result = mysqli_query($connection, $query);\n\n  // Check if user exists\n  if (mysqli_num_rows($result) == 0) {\n    echo 'No account found with this email address';\n    exit;\n  }\n\n  // Get user ID and password hash from database\n  $row = mysqli_fetch_assoc($result);\n  $user_id = $row['id'];\n  $password_hash = $row['password_hash'];\n\n  // Generate random reset token (UUID)\n  $reset_token = bin2hex(random_bytes(32));\n\n  // Insert reset token into database\n  $query = \"INSERT INTO password_resets (user_id, reset_token) VALUES ('$user_id', '$reset_token')\";\n  mysqli_query($connection, $query);\n\n  // Send email with password reset link\n  send_password_reset_email($email, $reset_token);\n\n  echo 'Password reset link sent to your email address';\n} else {\n  // Display form if not submitted\n  ?>\n  <h1>Forgot Password</h1>\n  <form action=\"\" method=\"post\">\n    <label for=\"email\">Email:</label>\n    <input type=\"email\" id=\"email\" name=\"email\"><br><br>\n    <button type=\"submit\">Submit</button>\n  </form>\n  <?php\n}\n\n// Function to send password reset email\nfunction send_password_reset_email($email, $reset_token) {\n  // Send email using your preferred mail library (e.g. PHPMailer)\n  // For simplicity, this example uses built-in mail() function\n  $subject = 'Reset Password';\n  $body = \"Click on the following link to reset your password:\\n\\n\";\n  $body .= '<a href=\"http://your-website.com/reset-password?token=' . $reset_token . '\">Reset Password</a>';\n  mail($email, $subject, $body);\n}\n\n?>\n```"]}
