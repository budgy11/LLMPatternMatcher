{"prompt": "Create a forgot password function using php", "llm_output": "Here's an example of how you can create a \"Forgot Password\" function using PHP:\n\n**Database Setup**\n\nAssuming that your database is set up with the following table structure for user authentication:\n```sql\nCREATE TABLE users (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  username VARCHAR(255),\n  password_hash VARCHAR(255)\n);\n```\n**PHP Code**\n```php\n<?php\n\nrequire_once 'config.php'; // database connection settings\n\n// Define constants\ndefine('SECURITY_SALT', 'your_security_salt_here');\ndefine('PASSWORD_RESET_TOKEN_EXPIRE_HOURS', 1); // token expiration time in hours\n\n// Function to send password reset email\nfunction send_password_reset_email($username, $token) {\n    $to = \"$username@example.com\"; // user's email address\n    $subject = \"Reset Your Password\";\n    $body = \"\n        Dear $username,\n        \n        Click the following link to reset your password:\n        <a href='http://yourwebsite.com/reset-password.php?token=$token'>\n            Reset Password\n        </a>\n        \n        If you did not request a password reset, please ignore this email.\n    \";\n\n    // Send email using PHPMailer or your preferred email library\n    $mailer = new PHPMailer();\n    $mailer->isSMTP();\n    $mailer->Host = 'smtp.example.com';\n    $mailer->Username = 'your_email@example.com';\n    $mailer->Password = 'your_password';\n    $mailer->SMTPSecure = 'tls';\n    $mailer->Port = 587;\n    $mailer->setFrom('your_email@example.com', 'Your Website');\n    $mailer->addAddress($to);\n    $mailer->Subject = $subject;\n    $mailer->Body = $body;\n    if ($mailer->send()) {\n        echo \"Email sent successfully!\";\n    } else {\n        echo \"Error sending email: \";\n        print_r($mailer->ErrorInfo);\n    }\n}\n\n// Function to generate password reset token\nfunction generate_password_reset_token() {\n    return bin2hex(random_bytes(32));\n}\n\n// Forgot Password Form Handler\nif (isset($_POST['forgot-password'])) {\n    $username = $_POST['username'];\n    $email = $_POST['email'];\n\n    // Check if user exists in database\n    $query = \"SELECT * FROM users WHERE username='$username' AND email='$email'\";\n    $result = mysqli_query($conn, $query);\n    if (mysqli_num_rows($result) > 0) {\n        // User found, generate password reset token and send email\n        $token = generate_password_reset_token();\n        insert_password_reset_token_into_database($token, $username);\n\n        send_password_reset_email($username, $token);\n        echo \"Password reset email sent successfully!\";\n    } else {\n        echo \"User not found.\";\n    }\n}\n\n// Function to insert password reset token into database\nfunction insert_password_reset_token_into_database($token, $username) {\n    $query = \"\n        INSERT INTO password_reset_tokens (\n            token,\n            username,\n            expiration_time\n        )\n        VALUES (\n            '$token',\n            '$username',\n            NOW() + INTERVAL \" . PASSWORD_RESET_TOKEN_EXPIRE_HOURS . \" HOUR\n        )\n    \";\n    mysqli_query($conn, $query);\n}\n\n?>\n```\n**Usage**\n\n1. Create a form for users to enter their username and email address.\n2. Handle the form submission using the `forgot-password` POST request.\n3. Use the functions above to send a password reset email with a unique token.\n\n**Notes**\n\n* Make sure to replace placeholders (e.g., `your_website.com`, `your_email@example.com`) with your actual website and email credentials.\n* You'll need to configure PHPMailer or your preferred email library for sending emails.\n* This example assumes you're using MySQLi for database interactions. Adjust accordingly if you're using a different database system.\n* Consider implementing additional security measures, such as CAPTCHA protection, to prevent abuse of the \"Forgot Password\" feature.\n\nI hope this helps! Let me know if you have any questions or need further assistance.", "code_blocks": [null, "```php\n<?php\n\nrequire_once 'config.php'; // database connection settings\n\n// Define constants\ndefine('SECURITY_SALT', 'your_security_salt_here');\ndefine('PASSWORD_RESET_TOKEN_EXPIRE_HOURS', 1); // token expiration time in hours\n\n// Function to send password reset email\nfunction send_password_reset_email($username, $token) {\n    $to = \"$username@example.com\"; // user's email address\n    $subject = \"Reset Your Password\";\n    $body = \"\n        Dear $username,\n        \n        Click the following link to reset your password:\n        <a href='http://yourwebsite.com/reset-password.php?token=$token'>\n            Reset Password\n        </a>\n        \n        If you did not request a password reset, please ignore this email.\n    \";\n\n    // Send email using PHPMailer or your preferred email library\n    $mailer = new PHPMailer();\n    $mailer->isSMTP();\n    $mailer->Host = 'smtp.example.com';\n    $mailer->Username = 'your_email@example.com';\n    $mailer->Password = 'your_password';\n    $mailer->SMTPSecure = 'tls';\n    $mailer->Port = 587;\n    $mailer->setFrom('your_email@example.com', 'Your Website');\n    $mailer->addAddress($to);\n    $mailer->Subject = $subject;\n    $mailer->Body = $body;\n    if ($mailer->send()) {\n        echo \"Email sent successfully!\";\n    } else {\n        echo \"Error sending email: \";\n        print_r($mailer->ErrorInfo);\n    }\n}\n\n// Function to generate password reset token\nfunction generate_password_reset_token() {\n    return bin2hex(random_bytes(32));\n}\n\n// Forgot Password Form Handler\nif (isset($_POST['forgot-password'])) {\n    $username = $_POST['username'];\n    $email = $_POST['email'];\n\n    // Check if user exists in database\n    $query = \"SELECT * FROM users WHERE username='$username' AND email='$email'\";\n    $result = mysqli_query($conn, $query);\n    if (mysqli_num_rows($result) > 0) {\n        // User found, generate password reset token and send email\n        $token = generate_password_reset_token();\n        insert_password_reset_token_into_database($token, $username);\n\n        send_password_reset_email($username, $token);\n        echo \"Password reset email sent successfully!\";\n    } else {\n        echo \"User not found.\";\n    }\n}\n\n// Function to insert password reset token into database\nfunction insert_password_reset_token_into_database($token, $username) {\n    $query = \"\n        INSERT INTO password_reset_tokens (\n            token,\n            username,\n            expiration_time\n        )\n        VALUES (\n            '$token',\n            '$username',\n            NOW() + INTERVAL \" . PASSWORD_RESET_TOKEN_EXPIRE_HOURS . \" HOUR\n        )\n    \";\n    mysqli_query($conn, $query);\n}\n\n?>\n```"]}
