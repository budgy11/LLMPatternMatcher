{"prompt": "Create a forgot password function using php", "llm_output": "Here is an example of how to create a \"Forgot Password\" function in PHP:\n\n**Database Table Structure**\n\nLet's assume we have a database table called `users` with the following structure:\n```sql\nCREATE TABLE users (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  username VARCHAR(50) NOT NULL,\n  email VARCHAR(100) NOT NULL,\n  password_hash VARCHAR(255) NOT NULL\n);\n```\n**Forgot Password Function**\n\nWe will create a PHP function called `forgot_password()` that takes three parameters: `$email`, `$username`, and `$new_password`. The function will send an email to the user with instructions on how to reset their password.\n```php\nfunction forgot_password($email, $username, $new_password) {\n  // Connect to database\n  $conn = mysqli_connect(\"localhost\", \"username\", \"password\", \"database\");\n\n  // Check if user exists\n  $query = \"SELECT * FROM users WHERE email='$email' AND username='$username'\";\n  $result = mysqli_query($conn, $query);\n  if (mysqli_num_rows($result) == 0) {\n    return array(\"error\" => \"User not found\");\n  }\n\n  // Generate a reset password token\n  $token = substr(hash('sha256', microtime(true)), 0, 32);\n\n  // Update user record with reset password token\n  $query = \"UPDATE users SET password_reset_token='$token' WHERE email='$email'\";\n  mysqli_query($conn, $query);\n\n  // Send email to user with instructions on how to reset their password\n  $subject = \"Reset Your Password\";\n  $body = \"\n    Dear $username,\n\n    Click the following link to reset your password: <a href='http://yourwebsite.com/reset-password?token=$token'>Reset Password</a>\n\n    Best regards,\n    Your Website Team\";\n\n  // Send email using PHPMailer or mail function\n  send_email($email, $subject, $body);\n\n  return array(\"success\" => \"Email sent with instructions on how to reset your password\");\n}\n```\n**Send Email Function**\n\nWe will create a separate function called `send_email()` that takes three parameters: `$to`, `$subject`, and `$body`.\n```php\nfunction send_email($to, $subject, $body) {\n  // Use PHPMailer or mail function to send email\n  if (isset($_ENV[\"SMTP_SERVER\"])) {\n    require_once 'PHPMailer/src/PHPMailer.php';\n    require_once 'PHPMailer/src/SMTP.php';\n\n    $mail = new PHPMailer\\PHPMailer\\PHPMailer();\n    $mail->isSMTP();\n    $mail->Host = $_ENV[\"SMTP_SERVER\"];\n    $mail->Username = $_ENV[\"SMTP_USERNAME\"];\n    $mail->Password = $_ENV[\"SMTP_PASSWORD\"];\n    $mail->Port = 587;\n    $mail->SMTPAuth = true;\n\n    $mail->setFrom($_ENV[\"FROM_EMAIL\"], \"Your Website Team\");\n    $mail->addAddress($to);\n    $mail->Subject = $subject;\n    $mail->Body = $body;\n\n    if (!$mail->send()) {\n      return array(\"error\" => \"Email not sent\");\n    }\n  } else {\n    mail($to, $subject, $body);\n  }\n\n  return array(\"success\" => \"Email sent\");\n}\n```\n**Reset Password Function**\n\nWe will create a function called `reset_password()` that takes one parameter: `$token`.\n```php\nfunction reset_password($token) {\n  // Connect to database\n  $conn = mysqli_connect(\"localhost\", \"username\", \"password\", \"database\");\n\n  // Check if token is valid\n  $query = \"SELECT * FROM users WHERE password_reset_token='$token'\";\n  $result = mysqli_query($conn, $query);\n  if (mysqli_num_rows($result) == 0) {\n    return array(\"error\" => \"Invalid token\");\n  }\n\n  // Get user data from database\n  $user_data = mysqli_fetch_assoc($result);\n\n  // Update user record with new password\n  $new_password_hash = password_hash($token, PASSWORD_DEFAULT);\n  $query = \"UPDATE users SET password='$new_password_hash' WHERE id='{$user_data['id']}'\";\n  mysqli_query($conn, $query);\n\n  return array(\"success\" => \"Password reset successfully\");\n}\n```\n**Example Usage**\n\nTo use these functions, you can create a form that submits the user's email address and username when they click the \"Forgot Password\" button. The form should submit to a PHP script that calls the `forgot_password()` function.\n```php\n<form action=\"forgot-password.php\" method=\"post\">\n  <input type=\"email\" name=\"email\" placeholder=\"Enter your email address\">\n  <input type=\"text\" name=\"username\" placeholder=\"Enter your username\">\n  <button type=\"submit\">Forgot Password</button>\n</form>\n\n<?php\nif (isset($_POST[\"email\"]) && isset($_POST[\"username\"])) {\n  $result = forgot_password($_POST[\"email\"], $_POST[\"username\"]);\n  if ($result[\"error\"]) {\n    echo \"Error: \" . $result[\"error\"];\n  } else {\n    echo \"Email sent with instructions on how to reset your password\";\n  }\n}\n?>\n```\nAfter the user submits their email address and username, they should receive an email with a link to reset their password. The link will contain a token that is used to verify the user's identity when resetting their password.\n\nNote: This example uses MySQLi for database operations, but you can use any other database library or framework as long as it supports PHP.\n\nAlso, make sure to replace `http://yourwebsite.com/reset-password` with your actual website URL in the email body.", "code_blocks": [null, "```php\nfunction forgot_password($email, $username, $new_password) {\n  // Connect to database\n  $conn = mysqli_connect(\"localhost\", \"username\", \"password\", \"database\");\n\n  // Check if user exists\n  $query = \"SELECT * FROM users WHERE email='$email' AND username='$username'\";\n  $result = mysqli_query($conn, $query);\n  if (mysqli_num_rows($result) == 0) {\n    return array(\"error\" => \"User not found\");\n  }\n\n  // Generate a reset password token\n  $token = substr(hash('sha256', microtime(true)), 0, 32);\n\n  // Update user record with reset password token\n  $query = \"UPDATE users SET password_reset_token='$token' WHERE email='$email'\";\n  mysqli_query($conn, $query);\n\n  // Send email to user with instructions on how to reset their password\n  $subject = \"Reset Your Password\";\n  $body = \"\n    Dear $username,\n\n    Click the following link to reset your password: <a href='http://yourwebsite.com/reset-password?token=$token'>Reset Password</a>\n\n    Best regards,\n    Your Website Team\";\n\n  // Send email using PHPMailer or mail function\n  send_email($email, $subject, $body);\n\n  return array(\"success\" => \"Email sent with instructions on how to reset your password\");\n}\n```", "```php\nfunction send_email($to, $subject, $body) {\n  // Use PHPMailer or mail function to send email\n  if (isset($_ENV[\"SMTP_SERVER\"])) {\n    require_once 'PHPMailer/src/PHPMailer.php';\n    require_once 'PHPMailer/src/SMTP.php';\n\n    $mail = new PHPMailer\\PHPMailer\\PHPMailer();\n    $mail->isSMTP();\n    $mail->Host = $_ENV[\"SMTP_SERVER\"];\n    $mail->Username = $_ENV[\"SMTP_USERNAME\"];\n    $mail->Password = $_ENV[\"SMTP_PASSWORD\"];\n    $mail->Port = 587;\n    $mail->SMTPAuth = true;\n\n    $mail->setFrom($_ENV[\"FROM_EMAIL\"], \"Your Website Team\");\n    $mail->addAddress($to);\n    $mail->Subject = $subject;\n    $mail->Body = $body;\n\n    if (!$mail->send()) {\n      return array(\"error\" => \"Email not sent\");\n    }\n  } else {\n    mail($to, $subject, $body);\n  }\n\n  return array(\"success\" => \"Email sent\");\n}\n```", "```php\nfunction reset_password($token) {\n  // Connect to database\n  $conn = mysqli_connect(\"localhost\", \"username\", \"password\", \"database\");\n\n  // Check if token is valid\n  $query = \"SELECT * FROM users WHERE password_reset_token='$token'\";\n  $result = mysqli_query($conn, $query);\n  if (mysqli_num_rows($result) == 0) {\n    return array(\"error\" => \"Invalid token\");\n  }\n\n  // Get user data from database\n  $user_data = mysqli_fetch_assoc($result);\n\n  // Update user record with new password\n  $new_password_hash = password_hash($token, PASSWORD_DEFAULT);\n  $query = \"UPDATE users SET password='$new_password_hash' WHERE id='{$user_data['id']}'\";\n  mysqli_query($conn, $query);\n\n  return array(\"success\" => \"Password reset successfully\");\n}\n```", "```php\n<form action=\"forgot-password.php\" method=\"post\">\n  <input type=\"email\" name=\"email\" placeholder=\"Enter your email address\">\n  <input type=\"text\" name=\"username\" placeholder=\"Enter your username\">\n  <button type=\"submit\">Forgot Password</button>\n</form>\n\n<?php\nif (isset($_POST[\"email\"]) && isset($_POST[\"username\"])) {\n  $result = forgot_password($_POST[\"email\"], $_POST[\"username\"]);\n  if ($result[\"error\"]) {\n    echo \"Error: \" . $result[\"error\"];\n  } else {\n    echo \"Email sent with instructions on how to reset your password\";\n  }\n}\n?>\n```"]}
