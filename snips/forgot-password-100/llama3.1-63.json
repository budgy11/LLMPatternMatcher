{"prompt": "Create a forgot password function using php", "llm_output": "Here is an example of how you can create a \"forgot password\" function using PHP. This will send an email to the user's registered email address with a link to reset their password.\n\n**Database Schema**\n\nFirst, we need to update our database schema to store the user's email and password hash. Let's assume we have a table named `users` with the following columns:\n\n| Column Name | Data Type |\n| --- | --- |\n| id | int (primary key) |\n| username | varchar(255) |\n| email | varchar(255) |\n| password_hash | varchar(255) |\n\n**Forgot Password Function**\n\nHere is the PHP code for the forgot password function:\n```php\n// Forgot Password Function\nfunction forgot_password($email) {\n  // Connect to database\n  $conn = mysqli_connect(\"localhost\", \"username\", \"password\", \"database_name\");\n\n  // Check if email exists in database\n  $query = \"SELECT * FROM users WHERE email = '$email'\";\n  $result = mysqli_query($conn, $query);\n  $num_rows = mysqli_num_rows($result);\n\n  if ($num_rows == 0) {\n    echo \"Email not found.\";\n    return false;\n  }\n\n  // Generate a random password\n  $password = substr(md5(uniqid(rand(), true)), 0, 8);\n  $password_hash = hash('sha256', $password);\n\n  // Update user's password in database\n  $query = \"UPDATE users SET password_hash = '$password_hash' WHERE email = '$email'\";\n  mysqli_query($conn, $query);\n\n  // Send email with reset link\n  send_reset_email($email, $password);\n}\n\n// Function to send reset email\nfunction send_reset_email($email, $password) {\n  $subject = \"Reset Password\";\n  $body = \"Click here to reset your password: <a href='http://example.com/reset_password?email=$email&password=$password'>Reset Password</a>\";\n  mail($email, $subject, $body);\n}\n```\n**Reset Password Function**\n\nNext, we need to create a function that handles the password reset process. This will be triggered when the user clicks on the link in their email.\n\n```php\n// Reset Password Function\nfunction reset_password() {\n  // Check if user has submitted form data\n  if (!isset($_POST['email']) || !isset($_POST['password'])) {\n    echo \"Invalid request.\";\n    return false;\n  }\n\n  // Connect to database\n  $conn = mysqli_connect(\"localhost\", \"username\", \"password\", \"database_name\");\n\n  // Get email and password from form data\n  $email = $_POST['email'];\n  $password = $_POST['password'];\n\n  // Check if user's email matches the one in the reset link\n  $query = \"SELECT * FROM users WHERE email = '$email'\";\n  $result = mysqli_query($conn, $query);\n  $num_rows = mysqli_num_rows($result);\n\n  if ($num_rows == 0) {\n    echo \"Email not found.\";\n    return false;\n  }\n\n  // Update user's password in database\n  $query = \"UPDATE users SET password_hash = '$password' WHERE email = '$email'\";\n  mysqli_query($conn, $query);\n}\n```\n**Example Use Case**\n\nTo test the forgot password function, we can create a simple form that submits the user's email to the `forgot_password` function.\n\n```php\n// Example use case: forgot password form\necho \"<form action='forget_password.php' method='post'>\";\necho \"Email: <input type='text' name='email'>\";\necho \"<button type='submit'>Submit</button>\";\necho \"</form>\";\n\nif (isset($_POST['email'])) {\n  $email = $_POST['email'];\n  forgot_password($email);\n}\n```\n**Security Note**\n\nPlease note that this is a basic example and should not be used in production without proper security measures. In particular, we should never store passwords in plain text or use the `md5` function to generate passwords (it's been deprecated). We should also use a secure hash like bcrypt instead of SHA256.\n\nAdditionally, you may want to consider using a library like `phpass` for password hashing and verification.\n\nI hope this helps! Let me know if you have any questions or need further assistance.", "code_blocks": ["```php\n// Forgot Password Function\nfunction forgot_password($email) {\n  // Connect to database\n  $conn = mysqli_connect(\"localhost\", \"username\", \"password\", \"database_name\");\n\n  // Check if email exists in database\n  $query = \"SELECT * FROM users WHERE email = '$email'\";\n  $result = mysqli_query($conn, $query);\n  $num_rows = mysqli_num_rows($result);\n\n  if ($num_rows == 0) {\n    echo \"Email not found.\";\n    return false;\n  }\n\n  // Generate a random password\n  $password = substr(md5(uniqid(rand(), true)), 0, 8);\n  $password_hash = hash('sha256', $password);\n\n  // Update user's password in database\n  $query = \"UPDATE users SET password_hash = '$password_hash' WHERE email = '$email'\";\n  mysqli_query($conn, $query);\n\n  // Send email with reset link\n  send_reset_email($email, $password);\n}\n\n// Function to send reset email\nfunction send_reset_email($email, $password) {\n  $subject = \"Reset Password\";\n  $body = \"Click here to reset your password: <a href='http://example.com/reset_password?email=$email&password=$password'>Reset Password</a>\";\n  mail($email, $subject, $body);\n}\n```", "```php\n// Reset Password Function\nfunction reset_password() {\n  // Check if user has submitted form data\n  if (!isset($_POST['email']) || !isset($_POST['password'])) {\n    echo \"Invalid request.\";\n    return false;\n  }\n\n  // Connect to database\n  $conn = mysqli_connect(\"localhost\", \"username\", \"password\", \"database_name\");\n\n  // Get email and password from form data\n  $email = $_POST['email'];\n  $password = $_POST['password'];\n\n  // Check if user's email matches the one in the reset link\n  $query = \"SELECT * FROM users WHERE email = '$email'\";\n  $result = mysqli_query($conn, $query);\n  $num_rows = mysqli_num_rows($result);\n\n  if ($num_rows == 0) {\n    echo \"Email not found.\";\n    return false;\n  }\n\n  // Update user's password in database\n  $query = \"UPDATE users SET password_hash = '$password' WHERE email = '$email'\";\n  mysqli_query($conn, $query);\n}\n```", "```php\n// Example use case: forgot password form\necho \"<form action='forget_password.php' method='post'>\";\necho \"Email: <input type='text' name='email'>\";\necho \"<button type='submit'>Submit</button>\";\necho \"</form>\";\n\nif (isset($_POST['email'])) {\n  $email = $_POST['email'];\n  forgot_password($email);\n}\n```"]}
