{"prompt": "Create a forgot password function using php", "llm_output": "Here is an example of how you can create a \"forgot password\" function using PHP:\n\n**Database Setup**\n\nFirst, let's assume we have a table called `users` with the following columns:\n\n* `id` (primary key)\n* `username`\n* `email`\n* `password` (hashed)\n\nCreate the database and insert some dummy data:\n```sql\nCREATE TABLE users (\n  id INT PRIMARY KEY,\n  username VARCHAR(255),\n  email VARCHAR(255),\n  password VARCHAR(255)\n);\n\nINSERT INTO users (id, username, email, password) VALUES\n  (1, 'john', 'john@example.com', '$2y$10$hVf3Tt9nQg6zNq7wM8S5e'),\n  (2, 'jane', 'jane@example.com', '$2y$10$LsG9dL4JiAa4DvLkHbI2P');\n```\n**Forgot Password Function**\n\nCreate a new PHP file called `forgot_password.php`:\n```php\n<?php\n\n// Database connection settings\n$db_host = 'localhost';\n$db_username = 'root';\n$db_password = '';\n$db_name = 'mydatabase';\n\n// Connect to database\n$conn = mysqli_connect($db_host, $db_username, $db_password, $db_name);\n\nif (!$conn) {\n  die(\"Connection failed: \" . mysqli_connect_error());\n}\n\n// Get input from user\n$usernameOrEmail = $_POST['username_or_email'];\n$token = md5(uniqid(rand(), true));\n\n// Check if username or email exists in database\n$query = \"SELECT * FROM users WHERE (username = '$usernameOrEmail' OR email = '$usernameOr Email') AND password IS NOT NULL\";\n$result = mysqli_query($conn, $query);\n\nif ($result) {\n  while ($row = mysqli_fetch_assoc($result)) {\n    // Send reset link to user\n    $to = $row['email'];\n    $subject = 'Reset Your Password';\n    $message = \"Hi \" . $row['username'] . \",\\n\\nClick on the following link to reset your password:\\n\\n<a href='http://example.com/reset_password.php?token=$token'>Reset Password</a>\\n\\nBest regards,\\nThe Admin\";\n    mail($to, $subject, $message);\n\n    // Update token in database\n    $updateQuery = \"UPDATE users SET forgot_token = '$token' WHERE id = '\" . $row['id'] . \"'\";\n    mysqli_query($conn, $updateQuery);\n  }\n} else {\n  echo \"Username or email not found.\";\n}\n\n// Close connection\nmysqli_close($conn);\n\n?>\n```\n**Reset Password Function**\n\nCreate a new PHP file called `reset_password.php`:\n```php\n<?php\n\n// Database connection settings\n$db_host = 'localhost';\n$db_username = 'root';\n$db_password = '';\n$db_name = 'mydatabase';\n\n// Connect to database\n$conn = mysqli_connect($db_host, $db_username, $db_password, $db_name);\n\nif (!$conn) {\n  die(\"Connection failed: \" . mysqli_connect_error());\n}\n\n// Get input from user\n$token = $_GET['token'];\n$newPassword = $_POST['new_password'];\n\n// Check if token exists in database\n$query = \"SELECT * FROM users WHERE forgot_token = '$token'\";\n$result = mysqli_query($conn, $query);\n\nif ($result) {\n  while ($row = mysqli_fetch_assoc($result)) {\n    // Update password in database\n    $updateQuery = \"UPDATE users SET password = '$newPassword' WHERE id = '\" . $row['id'] . \"'\";\n    mysqli_query($conn, $updateQuery);\n    \n    // Reset forgot token\n    $resetQuery = \"UPDATE users SET forgot_token = NULL WHERE id = '\" . $row['id'] . \"'\";\n    mysqli_query($conn, $resetQuery);\n  }\n} else {\n  echo \"Invalid token.\";\n}\n\n// Close connection\nmysqli_close($conn);\n\n?>\n```\n**HTML Form**\n\nCreate an HTML form to submit the username or email:\n```html\n<form action=\"forgot_password.php\" method=\"post\">\n  <input type=\"text\" name=\"username_or_email\" placeholder=\"Username or Email\">\n  <button type=\"submit\">Send Reset Link</button>\n</form>\n```\n**Explanation**\n\n1. The `forgot_password.php` script checks if the username or email exists in the database. If it does, it generates a random token and sends an email to the user with a link to reset their password.\n2. The email contains a link to the `reset_password.php` script, which takes the token as a GET parameter.\n3. When the user clicks on the link, they are taken to the `reset_password.php` script, which checks if the token exists in the database.\n4. If the token is valid, it updates the password for the corresponding user account.\n5. After updating the password, it resets the forgot token for that user.\n\nNote: This is a basic example and you should consider implementing additional security measures such as:\n\n* Using a secure password hashing algorithm (e.g. bcrypt)\n* Validating input data to prevent SQL injection attacks\n* Using HTTPS to encrypt the communication between the client and server\n* Limiting the number of attempts to reset passwords\n* Adding CAPTCHA or other anti-spam measures", "code_blocks": [null, "```php\n<?php\n\n// Database connection settings\n$db_host = 'localhost';\n$db_username = 'root';\n$db_password = '';\n$db_name = 'mydatabase';\n\n// Connect to database\n$conn = mysqli_connect($db_host, $db_username, $db_password, $db_name);\n\nif (!$conn) {\n  die(\"Connection failed: \" . mysqli_connect_error());\n}\n\n// Get input from user\n$usernameOrEmail = $_POST['username_or_email'];\n$token = md5(uniqid(rand(), true));\n\n// Check if username or email exists in database\n$query = \"SELECT * FROM users WHERE (username = '$usernameOrEmail' OR email = '$usernameOr Email') AND password IS NOT NULL\";\n$result = mysqli_query($conn, $query);\n\nif ($result) {\n  while ($row = mysqli_fetch_assoc($result)) {\n    // Send reset link to user\n    $to = $row['email'];\n    $subject = 'Reset Your Password';\n    $message = \"Hi \" . $row['username'] . \",\\n\\nClick on the following link to reset your password:\\n\\n<a href='http://example.com/reset_password.php?token=$token'>Reset Password</a>\\n\\nBest regards,\\nThe Admin\";\n    mail($to, $subject, $message);\n\n    // Update token in database\n    $updateQuery = \"UPDATE users SET forgot_token = '$token' WHERE id = '\" . $row['id'] . \"'\";\n    mysqli_query($conn, $updateQuery);\n  }\n} else {\n  echo \"Username or email not found.\";\n}\n\n// Close connection\nmysqli_close($conn);\n\n?>\n```", "```php\n<?php\n\n// Database connection settings\n$db_host = 'localhost';\n$db_username = 'root';\n$db_password = '';\n$db_name = 'mydatabase';\n\n// Connect to database\n$conn = mysqli_connect($db_host, $db_username, $db_password, $db_name);\n\nif (!$conn) {\n  die(\"Connection failed: \" . mysqli_connect_error());\n}\n\n// Get input from user\n$token = $_GET['token'];\n$newPassword = $_POST['new_password'];\n\n// Check if token exists in database\n$query = \"SELECT * FROM users WHERE forgot_token = '$token'\";\n$result = mysqli_query($conn, $query);\n\nif ($result) {\n  while ($row = mysqli_fetch_assoc($result)) {\n    // Update password in database\n    $updateQuery = \"UPDATE users SET password = '$newPassword' WHERE id = '\" . $row['id'] . \"'\";\n    mysqli_query($conn, $updateQuery);\n    \n    // Reset forgot token\n    $resetQuery = \"UPDATE users SET forgot_token = NULL WHERE id = '\" . $row['id'] . \"'\";\n    mysqli_query($conn, $resetQuery);\n  }\n} else {\n  echo \"Invalid token.\";\n}\n\n// Close connection\nmysqli_close($conn);\n\n?>\n```", null]}
