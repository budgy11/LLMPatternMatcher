{"prompt": "Create a forgot password function using php", "llm_output": "Here is an example of how to create a \"Forgot Password\" function using PHP. This example assumes that you are using a MySQL database and that the passwords are stored in a hashed format.\n\n**Database Schema:**\n\nFirst, let's assume we have a table called `users` with the following structure:\n```sql\nCREATE TABLE users (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  username VARCHAR(255),\n  password_hash VARCHAR(255)\n);\n```\n**PHP Code:**\n```php\n<?php\n\n// Configuration\n$mysql_host = 'localhost';\n$mysql_username = 'root';\n$mysql_password = '';\n$mysql_database = 'mydatabase';\n\n// Connect to database\n$conn = new mysqli($mysql_host, $mysql_username, $mysql_password, $mysql_database);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\nfunction forgotPassword() {\n  // Get the username from the form input\n  if (isset($_POST['username'])) {\n      $username = $_POST['username'];\n  } else {\n      echo \"Error: No username provided.\";\n      exit;\n  }\n\n  // Query database for user\n  $sql = \"SELECT * FROM users WHERE username = '$username'\";\n  $result = $conn->query($sql);\n\n  if ($result->num_rows == 0) {\n    echo \"Error: User not found.\";\n    exit;\n  } else {\n      // Get the user's email address from the database\n      while($row = $result->fetch_assoc()) {\n          $email = $row['email'];\n      }\n\n      // Generate a random password and hash it\n      $password = substr(str_shuffle('0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ'), 0, 12);\n      $hashed_password = password_hash($password, PASSWORD_DEFAULT);\n\n      // Update the user's password in the database\n      $sql = \"UPDATE users SET password_hash = '$hashed_password' WHERE username = '$username'\";\n      if ($conn->query($sql) === TRUE) {\n          echo \"Email sent with new password.\";\n          sendEmail($email, $password);\n      } else {\n          echo \"Error updating user's password: \" . $conn->error;\n      }\n  }\n}\n\nfunction sendEmail($to_email, $new_password) {\n    // Your email sending code here\n    // For example using PHPMailer:\n    require_once 'PHPMailer/PHPMailerAutoload.php';\n    $mail = new PHPMailer(true);\n\n    try {\n        $mail->isSMTP();\n        $mail->Host       = 'smtp.example.com';\n        $mail->SMTPAuth   = true;\n        $mail->Username   = 'your-email@example.com';\n        $mail->Password   = 'your-password';\n        $mail->Port       = 587;\n\n        // Send the email\n        $mail->setFrom('your-email@example.com', 'Your Name');\n        $mail->addAddress($to_email);\n        $mail->Subject    = 'New Password';\n        $mail->Body       = \"Your new password is: $new_password\";\n        $mail->AltBody    = '';\n\n        $mail->send();\n    } catch (Exception $e) {\n        echo 'Message could not be sent. Mailer Error: ', $mail->ErrorInfo;\n    }\n}\n\n// Check if the form has been submitted\nif (isset($_POST['submit'])) {\n    forgotPassword();\n}\n?>\n\n<form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\">\n  <label for=\"username\">Username:</label>\n  <input type=\"text\" id=\"username\" name=\"username\"><br><br>\n  <input type=\"submit\" name=\"submit\" value=\"Reset Password\">\n</form>\n```\nThis code will:\n\n1. Check if the form has been submitted.\n2. Get the username from the form input.\n3. Query the database for the user with the provided username.\n4. If the user exists, generate a random password and hash it using `password_hash()`.\n5. Update the user's password in the database.\n6. Send an email to the user with their new password.\n\nPlease note that you should replace `'smtp.example.com'`, `'your-email@example.com'`, and `'your-password'` with your actual email settings. Also, make sure to secure your database credentials and never store them directly in your code.", "code_blocks": [null, "```php\n<?php\n\n// Configuration\n$mysql_host = 'localhost';\n$mysql_username = 'root';\n$mysql_password = '';\n$mysql_database = 'mydatabase';\n\n// Connect to database\n$conn = new mysqli($mysql_host, $mysql_username, $mysql_password, $mysql_database);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\nfunction forgotPassword() {\n  // Get the username from the form input\n  if (isset($_POST['username'])) {\n      $username = $_POST['username'];\n  } else {\n      echo \"Error: No username provided.\";\n      exit;\n  }\n\n  // Query database for user\n  $sql = \"SELECT * FROM users WHERE username = '$username'\";\n  $result = $conn->query($sql);\n\n  if ($result->num_rows == 0) {\n    echo \"Error: User not found.\";\n    exit;\n  } else {\n      // Get the user's email address from the database\n      while($row = $result->fetch_assoc()) {\n          $email = $row['email'];\n      }\n\n      // Generate a random password and hash it\n      $password = substr(str_shuffle('0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ'), 0, 12);\n      $hashed_password = password_hash($password, PASSWORD_DEFAULT);\n\n      // Update the user's password in the database\n      $sql = \"UPDATE users SET password_hash = '$hashed_password' WHERE username = '$username'\";\n      if ($conn->query($sql) === TRUE) {\n          echo \"Email sent with new password.\";\n          sendEmail($email, $password);\n      } else {\n          echo \"Error updating user's password: \" . $conn->error;\n      }\n  }\n}\n\nfunction sendEmail($to_email, $new_password) {\n    // Your email sending code here\n    // For example using PHPMailer:\n    require_once 'PHPMailer/PHPMailerAutoload.php';\n    $mail = new PHPMailer(true);\n\n    try {\n        $mail->isSMTP();\n        $mail->Host       = 'smtp.example.com';\n        $mail->SMTPAuth   = true;\n        $mail->Username   = 'your-email@example.com';\n        $mail->Password   = 'your-password';\n        $mail->Port       = 587;\n\n        // Send the email\n        $mail->setFrom('your-email@example.com', 'Your Name');\n        $mail->addAddress($to_email);\n        $mail->Subject    = 'New Password';\n        $mail->Body       = \"Your new password is: $new_password\";\n        $mail->AltBody    = '';\n\n        $mail->send();\n    } catch (Exception $e) {\n        echo 'Message could not be sent. Mailer Error: ', $mail->ErrorInfo;\n    }\n}\n\n// Check if the form has been submitted\nif (isset($_POST['submit'])) {\n    forgotPassword();\n}\n?>\n\n<form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\">\n  <label for=\"username\">Username:</label>\n  <input type=\"text\" id=\"username\" name=\"username\"><br><br>\n  <input type=\"submit\" name=\"submit\" value=\"Reset Password\">\n</form>\n```"]}
