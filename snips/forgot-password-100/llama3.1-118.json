{"prompt": "Create a forgot password function using php", "llm_output": "Here is an example of how you can create a \"Forgot Password\" function in PHP:\n\n**Database Setup**\n\nFirst, let's assume that we have a database table named `users` with the following structure:\n```sql\nCREATE TABLE users (\n  id INT PRIMARY KEY,\n  email VARCHAR(255) NOT NULL,\n  password_hash VARCHAR(255) NOT NULL\n);\n```\nWe'll use the `password_hash` function to store hashed passwords.\n\n**PHP Code**\n\nCreate a new file named `forgot_password.php` and add the following code:\n```php\n<?php\n\n// Database connection settings\n$db_host = 'localhost';\n$db_username = 'your_username';\n$db_password = 'your_password';\n$db_name = 'your_database';\n\n// Connect to database\n$conn = mysqli_connect($db_host, $db_username, $db_password, $db_name);\n\nif (!$conn) {\n    die(\"Connection failed: \" . mysqli_connect_error());\n}\n\n// Function to send email with password reset link\nfunction send_email($email, $token) {\n    // Email settings\n    $subject = 'Reset Your Password';\n    $body = 'Click on this link to reset your password: <a href=\"http://yourwebsite.com/reset_password.php?token=' . $token . '\">Reset Password</a>';\n    $from = 'your_email@example.com';\n\n    // Send email using PHPMailer or mail() function\n    // ...\n\n    return true; // Return true if email is sent successfully\n}\n\n// Function to generate password reset token\nfunction generate_token($email) {\n    $token = bin2hex(random_bytes(16));\n    return $token;\n}\n\n// Forgot Password Form Handling\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n    // Get email from form\n    $email = $_POST['email'];\n\n    // Check if email exists in database\n    $query = \"SELECT * FROM users WHERE email = '$email'\";\n    $result = mysqli_query($conn, $query);\n\n    if (mysqli_num_rows($result) > 0) {\n        // Get user data from database\n        $row = mysqli_fetch_assoc($result);\n        $user_id = $row['id'];\n\n        // Generate password reset token\n        $token = generate_token($email);\n\n        // Update token in database\n        $query = \"UPDATE users SET token = '$token' WHERE id = '$user_id'\";\n        mysqli_query($conn, $query);\n\n        // Send email with password reset link\n        send_email($email, $token);\n    } else {\n        echo 'Email not found.';\n    }\n} else {\n    // Display forgot password form\n    ?>\n    <form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\">\n        Email: <input type=\"text\" name=\"email\"><br>\n        <input type=\"submit\" value=\"Send Password Reset Link\">\n    </form>\n    <?php\n}\n\n?>\n```\n**How it Works**\n\n1. When the user clicks on the \"Forgot Password\" link, they are taken to a form with an email input field.\n2. When the form is submitted, PHP checks if the email exists in the database.\n3. If the email exists, PHP generates a password reset token and stores it in the `token` column of the corresponding user record.\n4. PHP sends an email to the user's registered email address with a link to reset their password.\n\n**Reset Password Function**\n\nTo complete this example, you'll need to create another file named `reset_password.php`. Here's some sample code:\n```php\n<?php\n\n// Database connection settings\n$db_host = 'localhost';\n$db_username = 'your_username';\n$db_password = 'your_password';\n$db_name = 'your_database';\n\n// Connect to database\n$conn = mysqli_connect($db_host, $db_username, $db_password, $db_name);\n\nif (!$conn) {\n    die(\"Connection failed: \" . mysqli_connect_error());\n}\n\n// Get token from URL\n$token = $_GET['token'];\n\n// Check if token exists in database\n$query = \"SELECT * FROM users WHERE token = '$token'\";\n$result = mysqli_query($conn, $query);\n\nif (mysqli_num_rows($result) > 0) {\n    // Get user data from database\n    $row = mysqli_fetch_assoc($result);\n    $user_id = $row['id'];\n\n    // Display password reset form\n    ?>\n    <form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\">\n        New Password: <input type=\"password\" name=\"new_password\"><br>\n        Confirm Password: <input type=\"password\" name=\"confirm_password\"><br>\n        <input type=\"submit\" value=\"Reset Password\">\n    </form>\n    <?php\n} else {\n    echo 'Invalid token.';\n}\n\n?>\n```\nThis code assumes that you have a `reset_password.php` file with the above code. When the user clicks on the password reset link sent in the email, they are taken to this page.\n\n**Note**\n\n* Make sure to replace `your_username`, `your_password`, and `your_database` with your actual database credentials.\n* You should also implement proper error handling and security measures (e.g., validating user input, preventing SQL injection).\n* This example uses a simple password reset token. In a real-world application, you would want to use a more secure method of generating tokens, such as HMAC or JWT.\n\nI hope this helps! Let me know if you have any questions or need further assistance.", "code_blocks": [null, "```php\n<?php\n\n// Database connection settings\n$db_host = 'localhost';\n$db_username = 'your_username';\n$db_password = 'your_password';\n$db_name = 'your_database';\n\n// Connect to database\n$conn = mysqli_connect($db_host, $db_username, $db_password, $db_name);\n\nif (!$conn) {\n    die(\"Connection failed: \" . mysqli_connect_error());\n}\n\n// Function to send email with password reset link\nfunction send_email($email, $token) {\n    // Email settings\n    $subject = 'Reset Your Password';\n    $body = 'Click on this link to reset your password: <a href=\"http://yourwebsite.com/reset_password.php?token=' . $token . '\">Reset Password</a>';\n    $from = 'your_email@example.com';\n\n    // Send email using PHPMailer or mail() function\n    // ...\n\n    return true; // Return true if email is sent successfully\n}\n\n// Function to generate password reset token\nfunction generate_token($email) {\n    $token = bin2hex(random_bytes(16));\n    return $token;\n}\n\n// Forgot Password Form Handling\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n    // Get email from form\n    $email = $_POST['email'];\n\n    // Check if email exists in database\n    $query = \"SELECT * FROM users WHERE email = '$email'\";\n    $result = mysqli_query($conn, $query);\n\n    if (mysqli_num_rows($result) > 0) {\n        // Get user data from database\n        $row = mysqli_fetch_assoc($result);\n        $user_id = $row['id'];\n\n        // Generate password reset token\n        $token = generate_token($email);\n\n        // Update token in database\n        $query = \"UPDATE users SET token = '$token' WHERE id = '$user_id'\";\n        mysqli_query($conn, $query);\n\n        // Send email with password reset link\n        send_email($email, $token);\n    } else {\n        echo 'Email not found.';\n    }\n} else {\n    // Display forgot password form\n    ?>\n    <form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\">\n        Email: <input type=\"text\" name=\"email\"><br>\n        <input type=\"submit\" value=\"Send Password Reset Link\">\n    </form>\n    <?php\n}\n\n?>\n```", "```php\n<?php\n\n// Database connection settings\n$db_host = 'localhost';\n$db_username = 'your_username';\n$db_password = 'your_password';\n$db_name = 'your_database';\n\n// Connect to database\n$conn = mysqli_connect($db_host, $db_username, $db_password, $db_name);\n\nif (!$conn) {\n    die(\"Connection failed: \" . mysqli_connect_error());\n}\n\n// Get token from URL\n$token = $_GET['token'];\n\n// Check if token exists in database\n$query = \"SELECT * FROM users WHERE token = '$token'\";\n$result = mysqli_query($conn, $query);\n\nif (mysqli_num_rows($result) > 0) {\n    // Get user data from database\n    $row = mysqli_fetch_assoc($result);\n    $user_id = $row['id'];\n\n    // Display password reset form\n    ?>\n    <form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\">\n        New Password: <input type=\"password\" name=\"new_password\"><br>\n        Confirm Password: <input type=\"password\" name=\"confirm_password\"><br>\n        <input type=\"submit\" value=\"Reset Password\">\n    </form>\n    <?php\n} else {\n    echo 'Invalid token.';\n}\n\n?>\n```"]}
