{"prompt": "Create a forgot password function using php", "llm_output": "Here is an example of how to create a \"Forgot Password\" function in PHP:\n\n**Database Table Structure**\n\nAssuming you have a `users` table with the following structure:\n```sql\nCREATE TABLE users (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  email VARCHAR(255) NOT NULL,\n  password_hash VARCHAR(255) NOT NULL\n);\n```\n**PHP Code**\n```php\n<?php\n\n// Configuration\n$db_host = 'localhost';\n$db_username = 'root';\n$db_password = '';\n$db_name = 'mydatabase';\n\n// Connect to database\n$conn = new mysqli($db_host, $db_username, $db_password, $db_name);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Function to send password reset link via email\nfunction send_reset_link($email) {\n  // Generate a random token for the user\n  $token = bin2hex(random_bytes(32));\n\n  // Insert token into database with user ID and expiration time (e.g. 30 minutes)\n  $query = \"INSERT INTO password_reset_tokens (user_id, token, expires_at) VALUES ((SELECT id FROM users WHERE email = '$email'), '$token', DATE_ADD(NOW(), INTERVAL 30 MINUTE))\";\n  if (!$conn->query($query)) {\n    echo \"Error inserting token into database: \" . $conn->error;\n    return false;\n  }\n\n  // Send password reset link via email\n  $subject = \"Reset your password for [Your Website Name]\";\n  $body = \"\n  <p>Hello, you have requested to reset your password.</p>\n  <p>Click on the following link to reset your password:</p>\n  <a href='http://yourwebsite.com/reset-password?token=$token'>Reset Password</a>\n  \";\n  mail($email, $subject, $body);\n\n  return true;\n}\n\n// Function to verify and update user's password\nfunction verify_and_update_password($token, $new_password) {\n  // Get the user ID from the token\n  $query = \"SELECT user_id FROM password_reset_tokens WHERE token = '$token' AND expires_at > NOW()\";\n  if (!$result = $conn->query($query)) {\n    echo \"Error retrieving user ID: \" . $conn->error;\n    return false;\n  }\n\n  // If no matching token is found, return false\n  if ($result->num_rows == 0) {\n    return false;\n  }\n\n  // Update the user's password\n  $user_id = $result->fetch_assoc()['user_id'];\n  $query = \"UPDATE users SET password_hash = PASSWORD('$new_password') WHERE id = '$user_id'\";\n  if (!$conn->query($query)) {\n    echo \"Error updating user's password: \" . $conn->error;\n    return false;\n  }\n\n  // Delete the token from the database\n  $query = \"DELETE FROM password_reset_tokens WHERE token = '$token'\";\n  if (!$conn->query($query)) {\n    echo \"Error deleting token: \" . $conn->error;\n    return false;\n  }\n\n  return true;\n}\n\n// Handle forgot password form submission\nif (isset($_POST['email'])) {\n  // Validate email address\n  if (!filter_var($_POST['email'], FILTER_VALIDATE_EMAIL)) {\n    echo 'Invalid email address';\n    exit();\n  }\n\n  // Check if user exists and send reset link\n  $query = \"SELECT id FROM users WHERE email = '\".$_POST['email'].\"'\";\n  if ($result = $conn->query($query)) {\n    if ($result->num_rows == 1) {\n      send_reset_link($_POST['email']);\n      echo 'Reset link sent to your email';\n    } else {\n      echo 'Email not found in our records';\n    }\n  } else {\n    echo \"Error checking user existence: \" . $conn->error;\n  }\n}\n\n?>\n```\n**Form Code**\n\nCreate an HTML form with a field for the user's email address:\n```html\n<form action=\"\" method=\"post\">\n  <label for=\"email\">Email:</label>\n  <input type=\"text\" name=\"email\" required><br><br>\n  <input type=\"submit\" value=\"Send Reset Link\">\n</form>\n```\n**Reset Password Form Code**\n\nCreate another HTML form with fields for the new password and to verify it:\n```html\n<form action=\"\" method=\"post\">\n  <label for=\"token\">Token:</label>\n  <input type=\"text\" name=\"token\" required><br><br>\n  <label for=\"new_password\">New Password:</label>\n  <input type=\"password\" name=\"new_password\" required><br><br>\n  <label for=\"verify_password\">Verify Password:</label>\n  <input type=\"password\" name=\"verify_password\" required><br><br>\n  <input type=\"submit\" value=\"Reset Password\">\n</form>\n```\nNote that you should replace `http://yourwebsite.com` with your actual website URL. Also, make sure to adjust the database credentials and table structure according to your needs.\n\nThis code is a basic example of how to implement a \"Forgot Password\" function in PHP. You may need to add more security measures, such as salting and hashing passwords, and validating user input to prevent SQL injection attacks.", "code_blocks": [null, "```php\n<?php\n\n// Configuration\n$db_host = 'localhost';\n$db_username = 'root';\n$db_password = '';\n$db_name = 'mydatabase';\n\n// Connect to database\n$conn = new mysqli($db_host, $db_username, $db_password, $db_name);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Function to send password reset link via email\nfunction send_reset_link($email) {\n  // Generate a random token for the user\n  $token = bin2hex(random_bytes(32));\n\n  // Insert token into database with user ID and expiration time (e.g. 30 minutes)\n  $query = \"INSERT INTO password_reset_tokens (user_id, token, expires_at) VALUES ((SELECT id FROM users WHERE email = '$email'), '$token', DATE_ADD(NOW(), INTERVAL 30 MINUTE))\";\n  if (!$conn->query($query)) {\n    echo \"Error inserting token into database: \" . $conn->error;\n    return false;\n  }\n\n  // Send password reset link via email\n  $subject = \"Reset your password for [Your Website Name]\";\n  $body = \"\n  <p>Hello, you have requested to reset your password.</p>\n  <p>Click on the following link to reset your password:</p>\n  <a href='http://yourwebsite.com/reset-password?token=$token'>Reset Password</a>\n  \";\n  mail($email, $subject, $body);\n\n  return true;\n}\n\n// Function to verify and update user's password\nfunction verify_and_update_password($token, $new_password) {\n  // Get the user ID from the token\n  $query = \"SELECT user_id FROM password_reset_tokens WHERE token = '$token' AND expires_at > NOW()\";\n  if (!$result = $conn->query($query)) {\n    echo \"Error retrieving user ID: \" . $conn->error;\n    return false;\n  }\n\n  // If no matching token is found, return false\n  if ($result->num_rows == 0) {\n    return false;\n  }\n\n  // Update the user's password\n  $user_id = $result->fetch_assoc()['user_id'];\n  $query = \"UPDATE users SET password_hash = PASSWORD('$new_password') WHERE id = '$user_id'\";\n  if (!$conn->query($query)) {\n    echo \"Error updating user's password: \" . $conn->error;\n    return false;\n  }\n\n  // Delete the token from the database\n  $query = \"DELETE FROM password_reset_tokens WHERE token = '$token'\";\n  if (!$conn->query($query)) {\n    echo \"Error deleting token: \" . $conn->error;\n    return false;\n  }\n\n  return true;\n}\n\n// Handle forgot password form submission\nif (isset($_POST['email'])) {\n  // Validate email address\n  if (!filter_var($_POST['email'], FILTER_VALIDATE_EMAIL)) {\n    echo 'Invalid email address';\n    exit();\n  }\n\n  // Check if user exists and send reset link\n  $query = \"SELECT id FROM users WHERE email = '\".$_POST['email'].\"'\";\n  if ($result = $conn->query($query)) {\n    if ($result->num_rows == 1) {\n      send_reset_link($_POST['email']);\n      echo 'Reset link sent to your email';\n    } else {\n      echo 'Email not found in our records';\n    }\n  } else {\n    echo \"Error checking user existence: \" . $conn->error;\n  }\n}\n\n?>\n```", null, null]}
