{"prompt": "Create a forgot password function using php", "llm_output": "Here's an example of how you can create a \"forgot password\" function in PHP:\n\n**Database Schema**\n\nLet's assume we have a `users` table with the following columns:\n\n* `id` (primary key, auto-incrementing)\n* `email`\n* `password` (hashed using a library like `password_hash`)\n* `reset_token`\n\n**PHP Code**\n```php\n<?php\n\n// Configuration\ndefine('DB_HOST', 'localhost');\ndefine('DB_USERNAME', 'your_username');\ndefine('DB_PASSWORD', 'your_password');\ndefine('DB_NAME', 'your_database');\n\n// Connect to database\n$conn = new mysqli(DB_HOST, DB_USERNAME, DB_PASSWORD, DB_NAME);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Function to send password reset email\nfunction sendResetEmail($email, $resetToken)\n{\n    // Send email using a library like PHPMailer or SwiftMailer\n    $mail = new PHPMailer();\n    $mail->isSMTP();\n    $mail->Host = 'smtp.example.com';\n    $mail->Port = 587;\n    $mail->SMTPAuth = true;\n    $mail->Username = 'your_email@example.com';\n    $mail->Password = 'your_password';\n    $mail->setFrom('your_email@example.com', 'Your Name');\n    $mail->addAddress($email);\n    $mail->Subject = 'Reset Your Password';\n    $mail->Body = \"Click this link to reset your password: <a href='http://example.com/reset-password?token=$resetToken'>Reset Password</a>\";\n    $mail->send();\n}\n\n// Function to handle forgot password request\nfunction forgotPassword($email)\n{\n    // Check if user exists\n    $query = \"SELECT * FROM users WHERE email = '$email'\";\n    $result = $conn->query($query);\n    if ($result->num_rows == 0) {\n        return array('error' => 'Email not found');\n    }\n\n    // Generate reset token\n    $resetToken = bin2hex(random_bytes(32));\n    $query = \"UPDATE users SET reset_token = '$resetToken' WHERE email = '$email'\";\n    $conn->query($query);\n\n    // Send password reset email\n    sendResetEmail($email, $resetToken);\n}\n\n// Handle forgot password request\nif (isset($_POST['forgot-password'])) {\n    $email = $_POST['email'];\n    $result = forgotPassword($email);\n    if ($result['error']) {\n        echo json_encode(array('message' => $result['error']));\n    } else {\n        echo json_encode(array('message' => 'Email sent'));\n    }\n}\n\n?>\n```\n**Explanation**\n\nThis code defines two functions:\n\n1. `sendResetEmail($email, $resetToken)`: sends a password reset email to the user with a link to reset their password.\n2. `forgotPassword($email)`: handles the forgot password request by checking if the user exists in the database, generating a reset token, and sending a password reset email.\n\nThe code assumes you have a form on your website that submits the email address of the user who wants to reset their password. When the form is submitted, it calls the `forgotPassword($email)` function, which generates a reset token and sends an email with a link to reset the password.\n\n**Security Notes**\n\n* Make sure to store the reset tokens securely (e.g., in a database table) and use them for only one request.\n* Use a secure method to generate the reset tokens (e.g., `random_bytes()`).\n* Do not hard-code sensitive information like email addresses or passwords.\n* Consider using a library like PHPMailer or SwiftMailer to send emails securely.", "code_blocks": ["```php\n<?php\n\n// Configuration\ndefine('DB_HOST', 'localhost');\ndefine('DB_USERNAME', 'your_username');\ndefine('DB_PASSWORD', 'your_password');\ndefine('DB_NAME', 'your_database');\n\n// Connect to database\n$conn = new mysqli(DB_HOST, DB_USERNAME, DB_PASSWORD, DB_NAME);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Function to send password reset email\nfunction sendResetEmail($email, $resetToken)\n{\n    // Send email using a library like PHPMailer or SwiftMailer\n    $mail = new PHPMailer();\n    $mail->isSMTP();\n    $mail->Host = 'smtp.example.com';\n    $mail->Port = 587;\n    $mail->SMTPAuth = true;\n    $mail->Username = 'your_email@example.com';\n    $mail->Password = 'your_password';\n    $mail->setFrom('your_email@example.com', 'Your Name');\n    $mail->addAddress($email);\n    $mail->Subject = 'Reset Your Password';\n    $mail->Body = \"Click this link to reset your password: <a href='http://example.com/reset-password?token=$resetToken'>Reset Password</a>\";\n    $mail->send();\n}\n\n// Function to handle forgot password request\nfunction forgotPassword($email)\n{\n    // Check if user exists\n    $query = \"SELECT * FROM users WHERE email = '$email'\";\n    $result = $conn->query($query);\n    if ($result->num_rows == 0) {\n        return array('error' => 'Email not found');\n    }\n\n    // Generate reset token\n    $resetToken = bin2hex(random_bytes(32));\n    $query = \"UPDATE users SET reset_token = '$resetToken' WHERE email = '$email'\";\n    $conn->query($query);\n\n    // Send password reset email\n    sendResetEmail($email, $resetToken);\n}\n\n// Handle forgot password request\nif (isset($_POST['forgot-password'])) {\n    $email = $_POST['email'];\n    $result = forgotPassword($email);\n    if ($result['error']) {\n        echo json_encode(array('message' => $result['error']));\n    } else {\n        echo json_encode(array('message' => 'Email sent'));\n    }\n}\n\n?>\n```"]}
