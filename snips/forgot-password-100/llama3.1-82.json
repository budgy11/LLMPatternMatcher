{"prompt": "Create a forgot password function using php", "llm_output": "Here is an example of how to create a \"Forgot Password\" function using PHP:\n\n**Database Setup**\n\nFor this example, we'll assume you have a MySQL database with the following table structure:\n```sql\nCREATE TABLE users (\n  id INT PRIMARY KEY,\n  email VARCHAR(255) NOT NULL,\n  password_hash CHAR(60) NOT NULL\n);\n```\n**PHP Code**\n\nCreate a new PHP file called `forgot_password.php` and add the following code:\n```php\n<?php\n\n// Configuration\ndefine('DB_HOST', 'your_database_host');\ndefine('DB_USERNAME', 'your_database_username');\ndefine('DB_PASSWORD', 'your_database_password');\ndefine('DB_NAME', 'your_database_name');\n\n// Connect to database\n$conn = new mysqli(DB_HOST, DB_USERNAME, DB_PASSWORD, DB_NAME);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Define variables\n$email = $_POST['email'];\n\n// Validate email\nif (empty($email)) {\n    echo 'Please enter your email address.';\n    exit;\n}\n\n// Check if user exists\n$sql = \"SELECT * FROM users WHERE email = '$email'\";\n$result = $conn->query($sql);\n\nif ($result->num_rows > 0) {\n    // User found, generate new password and send to email\n    $new_password = bin2hex(random_bytes(32));\n    $sql = \"UPDATE users SET password_hash = SHA2('$new_password', 512) WHERE email = '$email'\";\n    $conn->query($sql);\n\n    // Send email with new password\n    $to = $email;\n    $subject = 'Your new password is: ' . $new_password;\n    $message = 'Your new password is: ' . $new_password;\n    $headers = 'From: your_email@example.com' . \"\\r\\n\" .\n        'Reply-To: your_email@example.com' . \"\\r\\n\" .\n        'X-Mailer: PHP/' . phpversion();\n    mail($to, $subject, $message, $headers);\n\n    echo 'Your new password has been sent to ' . $email;\n} else {\n    echo 'User not found.';\n}\n\n$conn->close();\n\n?>\n```\n**Explanation**\n\nThis code does the following:\n\n1. Connects to the database using the `mysqli` extension.\n2. Validates the email address entered by the user.\n3. Checks if a user with the provided email exists in the database.\n4. If a user is found, generates a new password (as a SHA-256 hash) and updates the user's password in the database.\n5. Sends an email to the user with their new password.\n\n**Security Notes**\n\n* Make sure to store the `DB_HOST`, `DB_USERNAME`, `DB_PASSWORD`, and `DB_NAME` values securely, such as in a `.env` file or environment variables.\n* Use prepared statements instead of concatenating SQL queries for better security.\n* Store passwords using a secure hashing algorithm (e.g. Argon2, Bcrypt) instead of SHA-256.\n\n**HTML Form**\n\nCreate an HTML form to submit the user's email address:\n```html\n<form action=\"forgot_password.php\" method=\"post\">\n  <input type=\"email\" name=\"email\" placeholder=\"Enter your email address\">\n  <button type=\"submit\">Submit</button>\n</form>\n```\nNote that this is a basic example and should be adapted to fit your specific use case. Additionally, you may want to add additional security measures, such as rate limiting or CAPTCHA challenges, to prevent abuse.", "code_blocks": [null, "```php\n<?php\n\n// Configuration\ndefine('DB_HOST', 'your_database_host');\ndefine('DB_USERNAME', 'your_database_username');\ndefine('DB_PASSWORD', 'your_database_password');\ndefine('DB_NAME', 'your_database_name');\n\n// Connect to database\n$conn = new mysqli(DB_HOST, DB_USERNAME, DB_PASSWORD, DB_NAME);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Define variables\n$email = $_POST['email'];\n\n// Validate email\nif (empty($email)) {\n    echo 'Please enter your email address.';\n    exit;\n}\n\n// Check if user exists\n$sql = \"SELECT * FROM users WHERE email = '$email'\";\n$result = $conn->query($sql);\n\nif ($result->num_rows > 0) {\n    // User found, generate new password and send to email\n    $new_password = bin2hex(random_bytes(32));\n    $sql = \"UPDATE users SET password_hash = SHA2('$new_password', 512) WHERE email = '$email'\";\n    $conn->query($sql);\n\n    // Send email with new password\n    $to = $email;\n    $subject = 'Your new password is: ' . $new_password;\n    $message = 'Your new password is: ' . $new_password;\n    $headers = 'From: your_email@example.com' . \"\\r\\n\" .\n        'Reply-To: your_email@example.com' . \"\\r\\n\" .\n        'X-Mailer: PHP/' . phpversion();\n    mail($to, $subject, $message, $headers);\n\n    echo 'Your new password has been sent to ' . $email;\n} else {\n    echo 'User not found.';\n}\n\n$conn->close();\n\n?>\n```", null]}
