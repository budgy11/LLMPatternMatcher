{"prompt": "Create a forgot password function using php", "llm_output": "Here is an example of how to create a forgot password function in PHP:\n\n**Database Schema**\n\nFirst, let's assume we have the following database schema for our users table:\n```sql\nCREATE TABLE users (\n  id INT PRIMARY KEY,\n  email VARCHAR(255),\n  password_hash VARCHAR(255)\n);\n```\n**Forgot Password Function**\n\nWe will use the following PHP code to create a forgot password function. This script will send an email to the user with a reset link.\n```php\n<?php\n\n// Config variables\ndefine('SITE_EMAIL', 'your@email.com');\ndefine('PASSWORD_RESET_LINK_EXPIRATION_TIME', 3600); // 1 hour\n\n// Function to send password reset link via email\nfunction sendPasswordResetEmail($email) {\n    $query = \"SELECT * FROM users WHERE email = '$email'\";\n    $result = mysqli_query($conn, $query);\n    \n    if (mysqli_num_rows($result) > 0) {\n        // Get the user's data\n        $row = mysqli_fetch_assoc($result);\n        \n        // Generate a random password reset token\n        $token = bin2hex(random_bytes(32));\n        \n        // Insert the token into the database with expiration time\n        $query = \"INSERT INTO password_reset_tokens (user_id, token, created_at) VALUES ('$row[id]', '$token', NOW())\";\n        mysqli_query($conn, $query);\n        \n        // Send email to user with reset link\n        $to = $email;\n        $subject = 'Reset your password';\n        $body = \"Click on the following link to reset your password: <a href='\" . SITE_URL . \"/reset-password.php?token=$token'>Reset Password</a>\";\n        mail($to, $subject, $body);\n        \n        echo \"Email sent successfully!\";\n    } else {\n        echo \"User not found.\";\n    }\n}\n\n// Forgot password form handler\nif (isset($_POST['forgot_password'])) {\n    $email = $_POST['email'];\n    \n    if (!empty($email)) {\n        sendPasswordResetEmail($email);\n    } else {\n        echo \"Please enter your email address.\";\n    }\n} ?>\n```\n**Reset Password Function**\n\nTo reset the password, we will create another PHP script that checks the token and allows the user to set a new password.\n```php\n<?php\n\n// Check if the token is valid\nif (isset($_GET['token'])) {\n    $query = \"SELECT * FROM password_reset_tokens WHERE token = '\".$_GET['token'].\"'\";\n    $result = mysqli_query($conn, $query);\n    \n    if (mysqli_num_rows($result) > 0) {\n        // Get the user's data\n        $row = mysqli_fetch_assoc($result);\n        \n        // Check if the token has expired\n        if (time() - strtotime($row['created_at']) < PASSWORD_RESET_LINK_EXPIRATION_TIME) {\n            // Display password reset form\n            echo \"Enter new password: <input type='password' name='new_password'><br><br>\";\n            echo \"<button name='reset_password'>Reset Password</button>\";\n            \n            if (isset($_POST['reset_password'])) {\n                $new_password = $_POST['new_password'];\n                \n                // Hash the new password\n                $hashed_password = password_hash($new_password, PASSWORD_DEFAULT);\n                \n                // Update the user's password in database\n                $query = \"UPDATE users SET password_hash = '$hashed_password' WHERE id = '$row[id]'\";\n                mysqli_query($conn, $query);\n                \n                echo \"Password reset successfully!\";\n            }\n        } else {\n            echo \"Token has expired. Please request a new token.\";\n        }\n    } else {\n        echo \"Invalid token.\";\n    }\n} ?>\n```\n**Security Notes**\n\n* Always use prepared statements to prevent SQL injection attacks.\n* Use password hashing and salting to store passwords securely in the database.\n* Use email validation to ensure that only valid email addresses can be used for resetting passwords.\n\nThis is a basic example of how you can implement a forgot password function using PHP. However, please note that this is just an example and should not be used in production without further security enhancements and testing.", "code_blocks": [null, "```php\n<?php\n\n// Config variables\ndefine('SITE_EMAIL', 'your@email.com');\ndefine('PASSWORD_RESET_LINK_EXPIRATION_TIME', 3600); // 1 hour\n\n// Function to send password reset link via email\nfunction sendPasswordResetEmail($email) {\n    $query = \"SELECT * FROM users WHERE email = '$email'\";\n    $result = mysqli_query($conn, $query);\n    \n    if (mysqli_num_rows($result) > 0) {\n        // Get the user's data\n        $row = mysqli_fetch_assoc($result);\n        \n        // Generate a random password reset token\n        $token = bin2hex(random_bytes(32));\n        \n        // Insert the token into the database with expiration time\n        $query = \"INSERT INTO password_reset_tokens (user_id, token, created_at) VALUES ('$row[id]', '$token', NOW())\";\n        mysqli_query($conn, $query);\n        \n        // Send email to user with reset link\n        $to = $email;\n        $subject = 'Reset your password';\n        $body = \"Click on the following link to reset your password: <a href='\" . SITE_URL . \"/reset-password.php?token=$token'>Reset Password</a>\";\n        mail($to, $subject, $body);\n        \n        echo \"Email sent successfully!\";\n    } else {\n        echo \"User not found.\";\n    }\n}\n\n// Forgot password form handler\nif (isset($_POST['forgot_password'])) {\n    $email = $_POST['email'];\n    \n    if (!empty($email)) {\n        sendPasswordResetEmail($email);\n    } else {\n        echo \"Please enter your email address.\";\n    }\n} ?>\n```", "```php\n<?php\n\n// Check if the token is valid\nif (isset($_GET['token'])) {\n    $query = \"SELECT * FROM password_reset_tokens WHERE token = '\".$_GET['token'].\"'\";\n    $result = mysqli_query($conn, $query);\n    \n    if (mysqli_num_rows($result) > 0) {\n        // Get the user's data\n        $row = mysqli_fetch_assoc($result);\n        \n        // Check if the token has expired\n        if (time() - strtotime($row['created_at']) < PASSWORD_RESET_LINK_EXPIRATION_TIME) {\n            // Display password reset form\n            echo \"Enter new password: <input type='password' name='new_password'><br><br>\";\n            echo \"<button name='reset_password'>Reset Password</button>\";\n            \n            if (isset($_POST['reset_password'])) {\n                $new_password = $_POST['new_password'];\n                \n                // Hash the new password\n                $hashed_password = password_hash($new_password, PASSWORD_DEFAULT);\n                \n                // Update the user's password in database\n                $query = \"UPDATE users SET password_hash = '$hashed_password' WHERE id = '$row[id]'\";\n                mysqli_query($conn, $query);\n                \n                echo \"Password reset successfully!\";\n            }\n        } else {\n            echo \"Token has expired. Please request a new token.\";\n        }\n    } else {\n        echo \"Invalid token.\";\n    }\n} ?>\n```"]}
