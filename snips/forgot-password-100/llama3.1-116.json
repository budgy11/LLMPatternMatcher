{"prompt": "Create a forgot password function using php", "llm_output": "Here's an example of how you can create a \"forgot password\" function in PHP. This script will email the user a link to reset their password.\n\n**password_recovery.php**\n```php\n<?php\nrequire_once 'config.php';\n\n// Define variables\n$recovery_email = $_POST['email'] ?? '';\n$password_recovery_link = '';\n\n// Check if email is provided\nif (empty($recovery_email)) {\n    header('Location: index.php?error=Email+is+required');\n    exit;\n}\n\n// Query to check if user exists\n$stmt = $db->prepare(\"SELECT * FROM users WHERE email = ?\");\n$stmt->execute([$recovery_email]);\n$user_data = $stmt->fetch();\n\n// Check if user exists\nif (!$user_data) {\n    header('Location: index.php?error=Email+not+found');\n    exit;\n}\n\n// Generate password recovery link\n$token = bin2hex(random_bytes(16));\n$password_recovery_link = 'http://example.com/reset-password.php?email=' . $recovery_email . '&token=' . $token;\n\n// Update user token in database\n$stmt = $db->prepare(\"UPDATE users SET recovery_token = ? WHERE email = ?\");\n$stmt->execute([$token, $recovery_email]);\n\n// Send password recovery email\nrequire_once 'send_email.php';\nsend_email($recovery_email, 'Reset Your Password', $password_recovery_link);\n\nheader('Location: index.php?success=Email+sent.+Check+your+inbox.');\nexit;\n```\n\n**reset-password.php**\n```php\n<?php\nrequire_once 'config.php';\n\n// Define variables\n$token = $_GET['token'] ?? '';\n$email = $_GET['email'] ?? '';\n\n// Check if token and email are provided\nif (empty($token) || empty($email)) {\n    header('Location: index.php?error=Invalid+link');\n    exit;\n}\n\n// Query to check if user exists\n$stmt = $db->prepare(\"SELECT * FROM users WHERE email = ? AND recovery_token = ?\");\n$stmt->execute([$email, $token]);\n$user_data = $stmt->fetch();\n\n// Check if user exists and token is valid\nif (!$user_data) {\n    header('Location: index.php?error=Invalid+link');\n    exit;\n}\n\n// Get new password from user\n$new_password = $_POST['new_password'] ?? '';\n$confirm_new_password = $_POST['confirm_new_password'] ?? '';\n\n// Check if passwords match\nif ($new_password !== $confirm_new_password) {\n    header('Location: index.php?error=Passwords+do+not+match');\n    exit;\n}\n\n// Update user password in database\n$stmt = $db->prepare(\"UPDATE users SET password = ? WHERE email = ?\");\n$stmt->execute([$new_password, $email]);\n\n// Delete recovery token from database\n$stmt = $db->prepare(\"UPDATE users SET recovery_token = NULL WHERE email = ?\");\n$stmt->execute([$email]);\n\nheader('Location: index.php?success=Password+updated.');\nexit;\n```\n\n**config.php**\n```php\n<?php\ndefine('DB_HOST', 'your_host');\ndefine('DB_USER', 'your_username');\ndefine('DB_PASSWORD', 'your_password');\ndefine('DB_NAME', 'your_database');\n\n$db = new PDO(\"mysql:host=\" . DB_HOST . \";dbname=\" . DB_NAME, DB_USER, DB_PASSWORD);\n```\n\n**send_email.php**\n```php\n<?php\nrequire_once 'config.php';\n\nfunction send_email($to_email, $subject, $body) {\n    $headers = \"From: your_email@example.com\\r\\n\";\n    $headers .= \"Content-type:text/html; charset=iso-8859-1\\r\\n\";\n\n    mail($to_email, $subject, $body, $headers);\n}\n```\n\nThis script requires a database connection to be set up in the `config.php` file. It also assumes that you have PHP's email functions enabled.\n\nTo use this script, simply navigate to `password_recovery.php`, enter your email address, and click \"Submit\". This will send an email with a link to reset your password. Clicking on this link will take you to `reset-password.php`, where you can enter a new password and confirm it.\n\nNote: This is a basic example of how to create a forgot password function in PHP. You should consider implementing additional security measures, such as hashing passwords and using two-factor authentication.", "code_blocks": ["```php\n<?php\nrequire_once 'config.php';\n\n// Define variables\n$recovery_email = $_POST['email'] ?? '';\n$password_recovery_link = '';\n\n// Check if email is provided\nif (empty($recovery_email)) {\n    header('Location: index.php?error=Email+is+required');\n    exit;\n}\n\n// Query to check if user exists\n$stmt = $db->prepare(\"SELECT * FROM users WHERE email = ?\");\n$stmt->execute([$recovery_email]);\n$user_data = $stmt->fetch();\n\n// Check if user exists\nif (!$user_data) {\n    header('Location: index.php?error=Email+not+found');\n    exit;\n}\n\n// Generate password recovery link\n$token = bin2hex(random_bytes(16));\n$password_recovery_link = 'http://example.com/reset-password.php?email=' . $recovery_email . '&token=' . $token;\n\n// Update user token in database\n$stmt = $db->prepare(\"UPDATE users SET recovery_token = ? WHERE email = ?\");\n$stmt->execute([$token, $recovery_email]);\n\n// Send password recovery email\nrequire_once 'send_email.php';\nsend_email($recovery_email, 'Reset Your Password', $password_recovery_link);\n\nheader('Location: index.php?success=Email+sent.+Check+your+inbox.');\nexit;\n```", "```php\n<?php\nrequire_once 'config.php';\n\n// Define variables\n$token = $_GET['token'] ?? '';\n$email = $_GET['email'] ?? '';\n\n// Check if token and email are provided\nif (empty($token) || empty($email)) {\n    header('Location: index.php?error=Invalid+link');\n    exit;\n}\n\n// Query to check if user exists\n$stmt = $db->prepare(\"SELECT * FROM users WHERE email = ? AND recovery_token = ?\");\n$stmt->execute([$email, $token]);\n$user_data = $stmt->fetch();\n\n// Check if user exists and token is valid\nif (!$user_data) {\n    header('Location: index.php?error=Invalid+link');\n    exit;\n}\n\n// Get new password from user\n$new_password = $_POST['new_password'] ?? '';\n$confirm_new_password = $_POST['confirm_new_password'] ?? '';\n\n// Check if passwords match\nif ($new_password !== $confirm_new_password) {\n    header('Location: index.php?error=Passwords+do+not+match');\n    exit;\n}\n\n// Update user password in database\n$stmt = $db->prepare(\"UPDATE users SET password = ? WHERE email = ?\");\n$stmt->execute([$new_password, $email]);\n\n// Delete recovery token from database\n$stmt = $db->prepare(\"UPDATE users SET recovery_token = NULL WHERE email = ?\");\n$stmt->execute([$email]);\n\nheader('Location: index.php?success=Password+updated.');\nexit;\n```", "```php\n<?php\ndefine('DB_HOST', 'your_host');\ndefine('DB_USER', 'your_username');\ndefine('DB_PASSWORD', 'your_password');\ndefine('DB_NAME', 'your_database');\n\n$db = new PDO(\"mysql:host=\" . DB_HOST . \";dbname=\" . DB_NAME, DB_USER, DB_PASSWORD);\n```", "```php\n<?php\nrequire_once 'config.php';\n\nfunction send_email($to_email, $subject, $body) {\n    $headers = \"From: your_email@example.com\\r\\n\";\n    $headers .= \"Content-type:text/html; charset=iso-8859-1\\r\\n\";\n\n    mail($to_email, $subject, $body, $headers);\n}\n```"]}
