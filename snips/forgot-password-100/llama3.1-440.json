{"prompt": "Create a forgot password function using php", "llm_output": "Here is an example of a \"Forgot Password\" functionality using PHP, which includes:\n\n1.  Sending a reset link to the user's email\n2.  Validating the token in the URL and updating the password\n\n**Note:** This is a basic implementation and you should consider implementing additional security measures such as hashing and salting passwords, validating user input, etc.\n\n### Database Schema\n\nWe'll assume we have a `users` table with columns `id`, `email`, `password`, and `token`.\n\n```sql\nCREATE TABLE users (\n    id INT PRIMARY KEY,\n    email VARCHAR(255) NOT NULL,\n    password VARCHAR(255),\n    token VARCHAR(255)\n);\n```\n\n### PHP Code\n\n**`forgot_password.php`**\n```php\n<?php\n\n// Configuration\ndefine('RESET_LINK_EXPIRATION', 3600); // 1 hour\n\n// Database connection\nrequire_once 'db_config.php';\n$conn = mysqli_connect($servername, $username, $password, $dbname);\n\nif (!$conn) {\n    die(\"Connection failed: \" . mysqli_error($conn));\n}\n\nfunction sendResetLink($email)\n{\n    global $conn;\n\n    // Generate token and store it in the database\n    $token = bin2hex(random_bytes(32));\n    $query = \"UPDATE users SET token='$token' WHERE email='$email'\";\n    if (!mysqli_query($conn, $query)) {\n        echo \"Error updating user: \" . mysqli_error($conn);\n    }\n\n    // Send reset link via email\n    $subject = 'Reset Password Link';\n    $message = \"<a href='\" . $_SERVER['HTTP_HOST'] . \"/reset_password.php?token=$token'>Click here to reset your password</a>\";\n    mail($email, $subject, $message);\n\n    echo \"Reset link sent successfully!\";\n}\n\nfunction validateTokenAndUpdatePassword()\n{\n    global $conn;\n\n    // Get token from URL\n    if (!isset($_GET['token'])) {\n        header('Location: forgot_password.php');\n        exit;\n    }\n\n    $token = $_GET['token'];\n\n    // Validate token and update password\n    $query = \"SELECT * FROM users WHERE token='$token'\";\n    $result = mysqli_query($conn, $query);\n    if (!$result) {\n        echo \"Error validating user: \" . mysqli_error($conn);\n    }\n\n    if (mysqli_num_rows($result) > 0) {\n        // Update password\n        $newPassword = $_POST['new_password'];\n        $confirmNewPassword = $_POST['confirm_new_password'];\n\n        if ($newPassword !== $confirmNewPassword) {\n            echo \"Passwords do not match!\";\n        } else {\n            $query = \"UPDATE users SET password='$newPassword' WHERE token='$token'\";\n            if (!mysqli_query($conn, $query)) {\n                echo \"Error updating user: \" . mysqli_error($conn);\n            }\n        }\n    }\n\n    // Clear token\n    $query = \"UPDATE users SET token='' WHERE token='$token'\";\n    if (!mysqli_query($conn, $query)) {\n        echo \"Error clearing token: \" . mysqli_error($conn);\n    }\n\n    header('Location: login.php');\n}\n\nif (isset($_POST['email'])) {\n    sendResetLink($_POST['email']);\n} elseif (isset($_GET['token'])) {\n    validateTokenAndUpdatePassword();\n}\n```\n\n**`reset_password.php`**\n```php\n<?php\n\nrequire_once 'forgot_password.php';\n\n?>\n\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Reset Password</title>\n</head>\n<body>\n\n<?php if (isset($_GET['token'])) { ?>\n\n    <form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\">\n        <input type=\"hidden\" name=\"new_password\" id=\"new_password\">\n        <label for=\"new_password\">New Password:</label><br>\n        <input type=\"password\" id=\"new_password\" name=\"new_password\"><br>\n\n        <label for=\"confirm_new_password\">Confirm New Password:</label><br>\n        <input type=\"password\" id=\"confirm_new_password\" name=\"confirm_new_password\"><br>\n\n        <button type=\"submit\">Update Password</button>\n    </form>\n\n<?php } else { ?>\n\n    <h1>Forgot Password?</h1>\n    <p>Please enter your email address to reset your password.</p>\n\n    <form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\">\n        <label for=\"email\">Email:</label><br>\n        <input type=\"email\" id=\"email\" name=\"email\"><br>\n\n        <button type=\"submit\">Send Reset Link</button>\n    </form>\n\n<?php } ?>\n\n</body>\n</html>\n```\n\n**`login.php`**\n```php\n<?php\n\nrequire_once 'db_config.php';\n$conn = mysqli_connect($servername, $username, $password, $dbname);\n\nif (!$conn) {\n    die(\"Connection failed: \" . mysqli_error($conn));\n}\n\n?>\n\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Login</title>\n</head>\n<body>\n\n<h1>Login</h1>\n\n<form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\">\n    <label for=\"email\">Email:</label><br>\n    <input type=\"email\" id=\"email\" name=\"email\"><br>\n\n    <label for=\"password\">Password:</label><br>\n    <input type=\"password\" id=\"password\" name=\"password\"><br>\n\n    <button type=\"submit\">Login</button>\n</form>\n\n<?php\n\nif (isset($_POST['email']) && isset($_POST['password'])) {\n    $email = $_POST['email'];\n    $password = $_POST['password'];\n\n    // Validate user credentials\n    $query = \"SELECT * FROM users WHERE email='$email' AND password=PASSWORD('$password')\";\n    $result = mysqli_query($conn, $query);\n    if (!$result) {\n        echo \"Error validating user: \" . mysqli_error($conn);\n    }\n\n    if (mysqli_num_rows($result) > 0) {\n        // Login successful\n        header('Location: dashboard.php');\n        exit;\n    } else {\n        echo \"Invalid email or password!\";\n    }\n}\n\n?>\n</body>\n</html>\n```\n\nThis code provides a basic implementation of a \"Forgot Password\" functionality. It includes:\n\n1.  Sending a reset link to the user's email using PHP's `mail()` function.\n2.  Validating the token in the URL and updating the password when the user clicks on the reset link.\n\nPlease note that this is a simplified example, you should consider implementing additional security measures such as hashing and salting passwords, validating user input, etc.\n\nAlso, ensure to configure your database connection settings in `db_config.php` file.\n\nMake sure to test this code thoroughly before deploying it to production.", "code_blocks": [null, "```php\n<?php\n\n// Configuration\ndefine('RESET_LINK_EXPIRATION', 3600); // 1 hour\n\n// Database connection\nrequire_once 'db_config.php';\n$conn = mysqli_connect($servername, $username, $password, $dbname);\n\nif (!$conn) {\n    die(\"Connection failed: \" . mysqli_error($conn));\n}\n\nfunction sendResetLink($email)\n{\n    global $conn;\n\n    // Generate token and store it in the database\n    $token = bin2hex(random_bytes(32));\n    $query = \"UPDATE users SET token='$token' WHERE email='$email'\";\n    if (!mysqli_query($conn, $query)) {\n        echo \"Error updating user: \" . mysqli_error($conn);\n    }\n\n    // Send reset link via email\n    $subject = 'Reset Password Link';\n    $message = \"<a href='\" . $_SERVER['HTTP_HOST'] . \"/reset_password.php?token=$token'>Click here to reset your password</a>\";\n    mail($email, $subject, $message);\n\n    echo \"Reset link sent successfully!\";\n}\n\nfunction validateTokenAndUpdatePassword()\n{\n    global $conn;\n\n    // Get token from URL\n    if (!isset($_GET['token'])) {\n        header('Location: forgot_password.php');\n        exit;\n    }\n\n    $token = $_GET['token'];\n\n    // Validate token and update password\n    $query = \"SELECT * FROM users WHERE token='$token'\";\n    $result = mysqli_query($conn, $query);\n    if (!$result) {\n        echo \"Error validating user: \" . mysqli_error($conn);\n    }\n\n    if (mysqli_num_rows($result) > 0) {\n        // Update password\n        $newPassword = $_POST['new_password'];\n        $confirmNewPassword = $_POST['confirm_new_password'];\n\n        if ($newPassword !== $confirmNewPassword) {\n            echo \"Passwords do not match!\";\n        } else {\n            $query = \"UPDATE users SET password='$newPassword' WHERE token='$token'\";\n            if (!mysqli_query($conn, $query)) {\n                echo \"Error updating user: \" . mysqli_error($conn);\n            }\n        }\n    }\n\n    // Clear token\n    $query = \"UPDATE users SET token='' WHERE token='$token'\";\n    if (!mysqli_query($conn, $query)) {\n        echo \"Error clearing token: \" . mysqli_error($conn);\n    }\n\n    header('Location: login.php');\n}\n\nif (isset($_POST['email'])) {\n    sendResetLink($_POST['email']);\n} elseif (isset($_GET['token'])) {\n    validateTokenAndUpdatePassword();\n}\n```", "```php\n<?php\n\nrequire_once 'forgot_password.php';\n\n?>\n\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Reset Password</title>\n</head>\n<body>\n\n<?php if (isset($_GET['token'])) { ?>\n\n    <form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\">\n        <input type=\"hidden\" name=\"new_password\" id=\"new_password\">\n        <label for=\"new_password\">New Password:</label><br>\n        <input type=\"password\" id=\"new_password\" name=\"new_password\"><br>\n\n        <label for=\"confirm_new_password\">Confirm New Password:</label><br>\n        <input type=\"password\" id=\"confirm_new_password\" name=\"confirm_new_password\"><br>\n\n        <button type=\"submit\">Update Password</button>\n    </form>\n\n<?php } else { ?>\n\n    <h1>Forgot Password?</h1>\n    <p>Please enter your email address to reset your password.</p>\n\n    <form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\">\n        <label for=\"email\">Email:</label><br>\n        <input type=\"email\" id=\"email\" name=\"email\"><br>\n\n        <button type=\"submit\">Send Reset Link</button>\n    </form>\n\n<?php } ?>\n\n</body>\n</html>\n```", "```php\n<?php\n\nrequire_once 'db_config.php';\n$conn = mysqli_connect($servername, $username, $password, $dbname);\n\nif (!$conn) {\n    die(\"Connection failed: \" . mysqli_error($conn));\n}\n\n?>\n\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Login</title>\n</head>\n<body>\n\n<h1>Login</h1>\n\n<form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\">\n    <label for=\"email\">Email:</label><br>\n    <input type=\"email\" id=\"email\" name=\"email\"><br>\n\n    <label for=\"password\">Password:</label><br>\n    <input type=\"password\" id=\"password\" name=\"password\"><br>\n\n    <button type=\"submit\">Login</button>\n</form>\n\n<?php\n\nif (isset($_POST['email']) && isset($_POST['password'])) {\n    $email = $_POST['email'];\n    $password = $_POST['password'];\n\n    // Validate user credentials\n    $query = \"SELECT * FROM users WHERE email='$email' AND password=PASSWORD('$password')\";\n    $result = mysqli_query($conn, $query);\n    if (!$result) {\n        echo \"Error validating user: \" . mysqli_error($conn);\n    }\n\n    if (mysqli_num_rows($result) > 0) {\n        // Login successful\n        header('Location: dashboard.php');\n        exit;\n    } else {\n        echo \"Invalid email or password!\";\n    }\n}\n\n?>\n</body>\n</html>\n```"]}
