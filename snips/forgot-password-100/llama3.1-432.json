{"prompt": "Create a forgot password function using php", "llm_output": "Here is an example of a \"Forgot Password\" function using PHP, MySQLi, and HTML:\n\n**Database Table Structure**\n\nFirst, let's create a simple database table to store user information. We'll use the following fields: `id`, `username`, `email`, and `password` (hashed with MD5 for simplicity).\n\n```sql\nCREATE TABLE users (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  username VARCHAR(255) NOT NULL,\n  email VARCHAR(255) NOT NULL,\n  password VARCHAR(255) NOT NULL\n);\n```\n\n**HTML Form**\n\nCreate an HTML form to collect the user's email address:\n```html\n<form action=\"forgot-password.php\" method=\"post\">\n  <label for=\"email\">Email Address:</label>\n  <input type=\"email\" id=\"email\" name=\"email\" required>\n\n  <button type=\"submit\" name=\"submit\">Reset Password</button>\n</form>\n```\n\n**PHP Script (forgot-password.php)**\n\nNow, let's create the PHP script to handle the forgot password request:\n```php\n<?php\n// Configuration\n$dbHost = 'localhost';\n$dbUsername = 'your_username';\n$dbPassword = 'your_password';\n$dbName = 'your_database';\n\n// Connect to database\n$conn = new mysqli($dbHost, $dbUsername, $dbPassword, $dbName);\n\n// Check connection\nif ($conn->connect_error) {\n  die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Get user's email address from form submission\n$email = $_POST['email'];\n\n// Query to retrieve user data based on email address\n$query = \"SELECT * FROM users WHERE email = '$email'\";\n$result = $conn->query($query);\n\nif ($result->num_rows > 0) {\n  // User found, generate a reset password link and send it via email\n  while ($row = $result->fetch_assoc()) {\n    $userId = $row['id'];\n    $username = $row['username'];\n\n    // Generate a random token for the reset password link\n    $token = bin2hex(random_bytes(16));\n\n    // Update user's data with new token\n    $updateQuery = \"UPDATE users SET token = '$token' WHERE id = '$userId'\";\n    $conn->query($updateQuery);\n\n    // Send email with reset password link\n    $subject = 'Reset Password for ' . $username;\n    $message = \"Dear $username,\\n\\nTo reset your password, please click the following link:\\n\\n<a href='reset-password.php?token=$token'>Reset Password</a>\\n\\nBest regards,\\nThe System\";\n    $headers = 'From: admin@example.com' . \"\\r\\n\" .\n      'Content-Type: text/html; charset=UTF-8' . \"\\r\\n\" .\n      'MIME-Version: 1.0' . \"\\r\\n\";\n\n    mail($email, $subject, $message, $headers);\n\n    echo \"A reset password link has been sent to your email address.\";\n  }\n} else {\n  echo \"No user found with that email address.\";\n}\n\n$conn->close();\n?>\n```\n\n**Reset Password Page (reset-password.php)**\n\nCreate a new PHP script to handle the password reset request:\n```php\n<?php\n// Configuration\n$dbHost = 'localhost';\n$dbUsername = 'your_username';\n$dbPassword = 'your_password';\n$dbName = 'your_database';\n\n// Connect to database\n$conn = new mysqli($dbHost, $dbUsername, $dbPassword, $dbName);\n\n// Check connection\nif ($conn->connect_error) {\n  die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Get token from URL parameter\n$token = $_GET['token'];\n\n// Query to retrieve user data based on token\n$query = \"SELECT * FROM users WHERE token = '$token'\";\n$result = $conn->query($query);\n\nif ($result->num_rows > 0) {\n  // User found, display password reset form\n  while ($row = $result->fetch_assoc()) {\n    $userId = $row['id'];\n    $username = $row['username'];\n\n    echo \"Reset Password for $username\";\n\n    // Display password reset form\n    ?>\n    <form action=\"reset-password-confirm.php\" method=\"post\">\n      <label for=\"new_password\">New Password:</label>\n      <input type=\"password\" id=\"new_password\" name=\"new_password\">\n\n      <label for=\"confirm_password\">Confirm New Password:</label>\n      <input type=\"password\" id=\"confirm_password\" name=\"confirm_password\">\n\n      <button type=\"submit\" name=\"submit\">Reset Password</button>\n    </form>\n\n    <?php\n  }\n} else {\n  echo \"Invalid token.\";\n}\n\n$conn->close();\n?>\n```\n\n**Confirm Password Reset (reset-password-confirm.php)**\n\nCreate a new PHP script to confirm the password reset:\n```php\n<?php\n// Configuration\n$dbHost = 'localhost';\n$dbUsername = 'your_username';\n$dbPassword = 'your_password';\n$dbName = 'your_database';\n\n// Connect to database\n$conn = new mysqli($dbHost, $dbUsername, $dbPassword, $dbName);\n\n// Check connection\nif ($conn->connect_error) {\n  die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Get user's ID from URL parameter\n$userId = $_GET['id'];\n\n// Get new password and confirm password from form submission\n$new_password = $_POST['new_password'];\n$confirm_password = $_POST['confirm_password'];\n\nif ($new_password == $confirm_password) {\n  // Update user's data with new password\n  $updateQuery = \"UPDATE users SET password = MD5('$new_password') WHERE id = '$userId'\";\n  $conn->query($updateQuery);\n\n  echo \"Password reset successfully.\";\n} else {\n  echo \"Passwords do not match.\";\n}\n\n$conn->close();\n?>\n```\n\n**Note**: This is a basic example and you should consider implementing additional security measures, such as:\n\n* Using a more secure password hashing algorithm (e.g., bcrypt)\n* Implementing email verification for the user\n* Limiting the number of attempts to reset the password\n* Storing the reset token securely in the database", "code_blocks": [null, null, "```php\n<?php\n// Configuration\n$dbHost = 'localhost';\n$dbUsername = 'your_username';\n$dbPassword = 'your_password';\n$dbName = 'your_database';\n\n// Connect to database\n$conn = new mysqli($dbHost, $dbUsername, $dbPassword, $dbName);\n\n// Check connection\nif ($conn->connect_error) {\n  die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Get user's email address from form submission\n$email = $_POST['email'];\n\n// Query to retrieve user data based on email address\n$query = \"SELECT * FROM users WHERE email = '$email'\";\n$result = $conn->query($query);\n\nif ($result->num_rows > 0) {\n  // User found, generate a reset password link and send it via email\n  while ($row = $result->fetch_assoc()) {\n    $userId = $row['id'];\n    $username = $row['username'];\n\n    // Generate a random token for the reset password link\n    $token = bin2hex(random_bytes(16));\n\n    // Update user's data with new token\n    $updateQuery = \"UPDATE users SET token = '$token' WHERE id = '$userId'\";\n    $conn->query($updateQuery);\n\n    // Send email with reset password link\n    $subject = 'Reset Password for ' . $username;\n    $message = \"Dear $username,\\n\\nTo reset your password, please click the following link:\\n\\n<a href='reset-password.php?token=$token'>Reset Password</a>\\n\\nBest regards,\\nThe System\";\n    $headers = 'From: admin@example.com' . \"\\r\\n\" .\n      'Content-Type: text/html; charset=UTF-8' . \"\\r\\n\" .\n      'MIME-Version: 1.0' . \"\\r\\n\";\n\n    mail($email, $subject, $message, $headers);\n\n    echo \"A reset password link has been sent to your email address.\";\n  }\n} else {\n  echo \"No user found with that email address.\";\n}\n\n$conn->close();\n?>\n```", "```php\n<?php\n// Configuration\n$dbHost = 'localhost';\n$dbUsername = 'your_username';\n$dbPassword = 'your_password';\n$dbName = 'your_database';\n\n// Connect to database\n$conn = new mysqli($dbHost, $dbUsername, $dbPassword, $dbName);\n\n// Check connection\nif ($conn->connect_error) {\n  die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Get token from URL parameter\n$token = $_GET['token'];\n\n// Query to retrieve user data based on token\n$query = \"SELECT * FROM users WHERE token = '$token'\";\n$result = $conn->query($query);\n\nif ($result->num_rows > 0) {\n  // User found, display password reset form\n  while ($row = $result->fetch_assoc()) {\n    $userId = $row['id'];\n    $username = $row['username'];\n\n    echo \"Reset Password for $username\";\n\n    // Display password reset form\n    ?>\n    <form action=\"reset-password-confirm.php\" method=\"post\">\n      <label for=\"new_password\">New Password:</label>\n      <input type=\"password\" id=\"new_password\" name=\"new_password\">\n\n      <label for=\"confirm_password\">Confirm New Password:</label>\n      <input type=\"password\" id=\"confirm_password\" name=\"confirm_password\">\n\n      <button type=\"submit\" name=\"submit\">Reset Password</button>\n    </form>\n\n    <?php\n  }\n} else {\n  echo \"Invalid token.\";\n}\n\n$conn->close();\n?>\n```", "```php\n<?php\n// Configuration\n$dbHost = 'localhost';\n$dbUsername = 'your_username';\n$dbPassword = 'your_password';\n$dbName = 'your_database';\n\n// Connect to database\n$conn = new mysqli($dbHost, $dbUsername, $dbPassword, $dbName);\n\n// Check connection\nif ($conn->connect_error) {\n  die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Get user's ID from URL parameter\n$userId = $_GET['id'];\n\n// Get new password and confirm password from form submission\n$new_password = $_POST['new_password'];\n$confirm_password = $_POST['confirm_password'];\n\nif ($new_password == $confirm_password) {\n  // Update user's data with new password\n  $updateQuery = \"UPDATE users SET password = MD5('$new_password') WHERE id = '$userId'\";\n  $conn->query($updateQuery);\n\n  echo \"Password reset successfully.\";\n} else {\n  echo \"Passwords do not match.\";\n}\n\n$conn->close();\n?>\n```"]}
