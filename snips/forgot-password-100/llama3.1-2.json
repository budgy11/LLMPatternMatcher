{"prompt": "Create a forgot password function using php", "llm_output": "Here's an example of how you can create a forgot password function in PHP:\n\n**forgot_password.php**\n```php\n<?php\nrequire_once 'dbconnect.php'; // connect to database\n\nif (isset($_POST['submit'])) {\n  $email = $_POST['email'];\n  \n  if (!filter_var($email, FILTER_VALIDATE_EMAIL)) {\n    echo 'Invalid email address';\n    exit;\n  }\n  \n  $sql = \"SELECT * FROM users WHERE email = '$email'\";\n  $result = mysqli_query($conn, $sql);\n  \n  if (mysqli_num_rows($result) > 0) {\n    while ($row = mysqli_fetch_assoc($result)) {\n      $user_id = $row['id'];\n      $username = $row['username'];\n      \n      // generate reset password token\n      $token = bin2hex(random_bytes(32));\n      $sql = \"UPDATE users SET reset_token = '$token' WHERE id = '$user_id'\";\n      mysqli_query($conn, $sql);\n      \n      // send email with reset link\n      $subject = 'Reset your password';\n      $message = \"Click on the link below to reset your password:\n<a href='http://example.com/reset_password.php?token=$token&email=$email'>Reset Password</a>\";\n      mail($email, $subject, $message);\n      \n      echo 'Password reset email sent. Please check your email for further instructions.';\n    }\n  } else {\n    echo 'Email not found in database';\n  }\n} else {\n?>\n<form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\">\n  <label for=\"email\">Enter your email address:</label>\n  <input type=\"email\" id=\"email\" name=\"email\"><br><br>\n  <button type=\"submit\" name=\"submit\">Send Reset Email</button>\n</form>\n<?php } ?>\n```\n**reset_password.php**\n```php\n<?php\nrequire_once 'dbconnect.php'; // connect to database\n\nif (isset($_GET['token']) && isset($_GET['email'])) {\n  $token = $_GET['token'];\n  $email = $_GET['email'];\n  \n  $sql = \"SELECT * FROM users WHERE email = '$email' AND reset_token = '$token'\";\n  $result = mysqli_query($conn, $sql);\n  \n  if (mysqli_num_rows($result) > 0) {\n    while ($row = mysqli_fetch_assoc($result)) {\n      $user_id = $row['id'];\n      \n      // allow user to change password\n      ?>\n<form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\">\n  <label for=\"new_password\">Enter new password:</label>\n  <input type=\"password\" id=\"new_password\" name=\"new_password\"><br><br>\n  <button type=\"submit\" name=\"submit\">Change Password</button>\n</form>\n<?php\n    }\n  } else {\n    echo 'Invalid token';\n  }\n} else {\n?>\n<form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\">\n  <label for=\"email\">Enter your email address:</label>\n  <input type=\"email\" id=\"email\" name=\"email\"><br><br>\n  <button type=\"submit\" name=\"submit\">Send Reset Email</button>\n</form>\n<?php } ?>\n\n<?php\nif (isset($_POST['submit'])) {\n  $new_password = $_POST['new_password'];\n  \n  if (!preg_match('/^(?=.*[a-zA-Z])(?=.*[0-9]).{8,}$/', $new_password)) {\n    echo 'Password must be at least 8 characters long and contain a letter and a number';\n    exit;\n  }\n  \n  $sql = \"UPDATE users SET password = '$new_password' WHERE id = '$user_id'\";\n  mysqli_query($conn, $sql);\n  \n  echo 'Password changed successfully!';\n}\n?>\n```\n**Explanation**\n\nThis example uses two files: `forgot_password.php` and `reset_password.php`. The first file is for sending a reset email to the user, while the second file is for changing the password.\n\nHere's how it works:\n\n1. When the user clicks on \"Forgot Password\", they are taken to `forgot_password.php`, where they enter their email address.\n2. If the email address is valid, the script generates a random token and stores it in the database along with the user's ID.\n3. The script then sends an email to the user with a link to `reset_password.php`.\n4. When the user clicks on the link, they are taken to `reset_password.php`, where they can enter their new password.\n5. If the token is valid and matches the one stored in the database, the script allows the user to change their password.\n\n**Security Notes**\n\n* The email address is validated using a regular expression.\n* The random token is generated using `random_bytes()` and `bin2hex()`, which provides adequate randomness for this purpose.\n* The email is sent using `mail()`, but you should consider using a more secure method, such as PHPMailer or SwiftMailer.\n* The password is changed using an UPDATE query, which modifies the existing record in the database.\n\n**Example Use Case**\n\n1. User clicks on \"Forgot Password\" and enters their email address: `john@example.com`.\n2. Script generates a random token and stores it in the database along with John's ID.\n3. Script sends an email to John with a link to `reset_password.php?token=abc123&email=john@example.com`.\n4. John clicks on the link and is taken to `reset_password.php`, where he enters his new password: `mysecretpassword`.\n5. Script allows John to change his password, which is stored in the database.\n\nNote that this is a simplified example and you should consider adding more security measures, such as hashing the passwords and salting them.", "code_blocks": ["```php\n<?php\nrequire_once 'dbconnect.php'; // connect to database\n\nif (isset($_POST['submit'])) {\n  $email = $_POST['email'];\n  \n  if (!filter_var($email, FILTER_VALIDATE_EMAIL)) {\n    echo 'Invalid email address';\n    exit;\n  }\n  \n  $sql = \"SELECT * FROM users WHERE email = '$email'\";\n  $result = mysqli_query($conn, $sql);\n  \n  if (mysqli_num_rows($result) > 0) {\n    while ($row = mysqli_fetch_assoc($result)) {\n      $user_id = $row['id'];\n      $username = $row['username'];\n      \n      // generate reset password token\n      $token = bin2hex(random_bytes(32));\n      $sql = \"UPDATE users SET reset_token = '$token' WHERE id = '$user_id'\";\n      mysqli_query($conn, $sql);\n      \n      // send email with reset link\n      $subject = 'Reset your password';\n      $message = \"Click on the link below to reset your password:\n<a href='http://example.com/reset_password.php?token=$token&email=$email'>Reset Password</a>\";\n      mail($email, $subject, $message);\n      \n      echo 'Password reset email sent. Please check your email for further instructions.';\n    }\n  } else {\n    echo 'Email not found in database';\n  }\n} else {\n?>\n<form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\">\n  <label for=\"email\">Enter your email address:</label>\n  <input type=\"email\" id=\"email\" name=\"email\"><br><br>\n  <button type=\"submit\" name=\"submit\">Send Reset Email</button>\n</form>\n<?php } ?>\n```", "```php\n<?php\nrequire_once 'dbconnect.php'; // connect to database\n\nif (isset($_GET['token']) && isset($_GET['email'])) {\n  $token = $_GET['token'];\n  $email = $_GET['email'];\n  \n  $sql = \"SELECT * FROM users WHERE email = '$email' AND reset_token = '$token'\";\n  $result = mysqli_query($conn, $sql);\n  \n  if (mysqli_num_rows($result) > 0) {\n    while ($row = mysqli_fetch_assoc($result)) {\n      $user_id = $row['id'];\n      \n      // allow user to change password\n      ?>\n<form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\">\n  <label for=\"new_password\">Enter new password:</label>\n  <input type=\"password\" id=\"new_password\" name=\"new_password\"><br><br>\n  <button type=\"submit\" name=\"submit\">Change Password</button>\n</form>\n<?php\n    }\n  } else {\n    echo 'Invalid token';\n  }\n} else {\n?>\n<form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\">\n  <label for=\"email\">Enter your email address:</label>\n  <input type=\"email\" id=\"email\" name=\"email\"><br><br>\n  <button type=\"submit\" name=\"submit\">Send Reset Email</button>\n</form>\n<?php } ?>\n\n<?php\nif (isset($_POST['submit'])) {\n  $new_password = $_POST['new_password'];\n  \n  if (!preg_match('/^(?=.*[a-zA-Z])(?=.*[0-9]).{8,}$/', $new_password)) {\n    echo 'Password must be at least 8 characters long and contain a letter and a number';\n    exit;\n  }\n  \n  $sql = \"UPDATE users SET password = '$new_password' WHERE id = '$user_id'\";\n  mysqli_query($conn, $sql);\n  \n  echo 'Password changed successfully!';\n}\n?>\n```"]}
