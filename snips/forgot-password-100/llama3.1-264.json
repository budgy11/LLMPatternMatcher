{"prompt": "Create a forgot password function using php", "llm_output": "Here is an example of how you can create a \"forgot password\" functionality using PHP. This example assumes that you have a database with a table named `users` that has the following structure:\n\n| Field | Type | Description |\n| --- | --- | --- |\n| id | int(11) | Unique identifier for each user |\n| username | varchar(255) | Username chosen by the user |\n| password | varchar(255) | Hashed password of the user |\n| email | varchar(255) | Email address of the user |\n\n**Forgot Password Functionality:**\n\n1. The user submits their email to the \"forgot password\" form.\n2. The PHP script checks if the email exists in the database and retrieves the corresponding username.\n3. An email is sent to the user with a reset link that contains a unique token (e.g., `token`). This token will be used to verify the user's identity when they attempt to change their password.\n4. When the user clicks on the reset link, they are redirected to a page where they can enter a new password and confirm it.\n\n**PHP Code:**\n\n**forgot_password.php**\n```php\n<?php\n\n// Configuration\n$db_host = 'localhost';\n$db_username = 'your_username';\n$db_password = 'your_password';\n$db_name = 'your_database';\n\n// Connect to database\n$conn = mysqli_connect($db_host, $db_username, $db_password, $db_name);\n\nif (!$conn) {\n    die('Could not connect: ' . mysqli_error($conn));\n}\n\nfunction sendResetEmail($email, $token) {\n    // Email configuration\n    $to      = $email;\n    $subject = 'Reset your password';\n    $message = '<p>Hello, please click the link below to reset your password:</p>\n                <a href=\"' . site_url() . '/reset_password?token=' . $token . '\">Reset Password</a>';\n    $headers = 'From: your_email@example.com' . \"\\r\\n\" .\n               'Reply-To: no-reply@example.com' . \"\\r\\n\" .\n               'X-Mailer: PHP/' . phpversion();\n\n    mail($to, $subject, $message, $headers);\n}\n\nfunction resetPassword($token) {\n    // Check if token exists in database\n    $query = \"SELECT * FROM users WHERE token = '$token'\";\n    $result = mysqli_query($conn, $query);\n\n    if (mysqli_num_rows($result) > 0) {\n        // Token exists, retrieve user's data\n        $row = mysqli_fetch_assoc($result);\n        $username = $row['username'];\n        $email = $row['email'];\n\n        // Display reset password form\n        echo '<h1>Reset Password</h1>\n              <form action=\"\" method=\"post\">\n                <input type=\"password\" name=\"new_password\" placeholder=\"Enter new password\">\n                <input type=\"password\" name=\"confirm_password\" placeholder=\"Confirm new password\">\n                <button type=\"submit\">Change Password</button>\n              </form>';\n\n        // Process form submission\n        if ($_SERVER['REQUEST_METHOD'] == 'POST') {\n            $newPassword = $_POST['new_password'];\n            $confirmPassword = $_POST['confirm_password'];\n\n            if ($newPassword === $confirmPassword) {\n                // Update user's password\n                $query = \"UPDATE users SET password = '$newPassword' WHERE token = '$token'\";\n                mysqli_query($conn, $query);\n\n                echo '<p>Password changed successfully!</p>';\n            } else {\n                echo '<p>Passwords do not match.</p>';\n            }\n        }\n\n    } else {\n        // Token does not exist\n        echo '<p>Invalid token.</p>';\n    }\n}\n\n// Handle forgot password form submission\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n    $email = $_POST['email'];\n    $query = \"SELECT * FROM users WHERE email = '$email'\";\n    $result = mysqli_query($conn, $query);\n\n    if (mysqli_num_rows($result) > 0) {\n        // Email exists, retrieve user's data\n        $row = mysqli_fetch_assoc($result);\n        $username = $row['username'];\n        $token = generateToken();\n\n        // Send reset email\n        sendResetEmail($email, $token);\n\n        echo '<p>Reset link sent to your email.</p>';\n    } else {\n        // Email does not exist\n        echo '<p>Email not found.</p>';\n    }\n}\n\n// Close database connection\nmysqli_close($conn);\n?>\n\n<form action=\"\" method=\"post\">\n  <input type=\"email\" name=\"email\" placeholder=\"Enter your email\">\n  <button type=\"submit\">Forgot Password</button>\n</form>\n\n<?php if (isset($_POST['email'])) { ?>\n  <?php include 'reset_password.php'; ?>\n<?php } ?>\n\n<?php function generateToken() {\n    // Generate a unique token\n    return md5(uniqid(mt_rand(), true));\n} ?>\n```\n\n**reset_password.php**\n```php\n<?php\n\n// Handle reset password form submission\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n    $token = $_GET['token'];\n    $newPassword = $_POST['new_password'];\n    $confirmPassword = $_POST['confirm_password'];\n\n    if ($newPassword === $confirmPassword) {\n        // Update user's password\n        $query = \"UPDATE users SET password = '$newPassword' WHERE token = '$token'\";\n        mysqli_query($conn, $query);\n\n        echo '<p>Password changed successfully!</p>';\n    } else {\n        echo '<p>Passwords do not match.</p>';\n    }\n}\n\n?>\n```\n\n**Note:**\n\n* Make sure to replace the placeholders with your actual database credentials and table structure.\n* This example uses a simple token generation mechanism. You may want to consider using a more secure method, such as a library like `php-jwt` or `symfony-security`.\n* Remember to update the email configuration in the `sendResetEmail()` function to use your own email address and settings.\n\nI hope this helps! Let me know if you have any questions or need further clarification.", "code_blocks": ["```php\n<?php\n\n// Configuration\n$db_host = 'localhost';\n$db_username = 'your_username';\n$db_password = 'your_password';\n$db_name = 'your_database';\n\n// Connect to database\n$conn = mysqli_connect($db_host, $db_username, $db_password, $db_name);\n\nif (!$conn) {\n    die('Could not connect: ' . mysqli_error($conn));\n}\n\nfunction sendResetEmail($email, $token) {\n    // Email configuration\n    $to      = $email;\n    $subject = 'Reset your password';\n    $message = '<p>Hello, please click the link below to reset your password:</p>\n                <a href=\"' . site_url() . '/reset_password?token=' . $token . '\">Reset Password</a>';\n    $headers = 'From: your_email@example.com' . \"\\r\\n\" .\n               'Reply-To: no-reply@example.com' . \"\\r\\n\" .\n               'X-Mailer: PHP/' . phpversion();\n\n    mail($to, $subject, $message, $headers);\n}\n\nfunction resetPassword($token) {\n    // Check if token exists in database\n    $query = \"SELECT * FROM users WHERE token = '$token'\";\n    $result = mysqli_query($conn, $query);\n\n    if (mysqli_num_rows($result) > 0) {\n        // Token exists, retrieve user's data\n        $row = mysqli_fetch_assoc($result);\n        $username = $row['username'];\n        $email = $row['email'];\n\n        // Display reset password form\n        echo '<h1>Reset Password</h1>\n              <form action=\"\" method=\"post\">\n                <input type=\"password\" name=\"new_password\" placeholder=\"Enter new password\">\n                <input type=\"password\" name=\"confirm_password\" placeholder=\"Confirm new password\">\n                <button type=\"submit\">Change Password</button>\n              </form>';\n\n        // Process form submission\n        if ($_SERVER['REQUEST_METHOD'] == 'POST') {\n            $newPassword = $_POST['new_password'];\n            $confirmPassword = $_POST['confirm_password'];\n\n            if ($newPassword === $confirmPassword) {\n                // Update user's password\n                $query = \"UPDATE users SET password = '$newPassword' WHERE token = '$token'\";\n                mysqli_query($conn, $query);\n\n                echo '<p>Password changed successfully!</p>';\n            } else {\n                echo '<p>Passwords do not match.</p>';\n            }\n        }\n\n    } else {\n        // Token does not exist\n        echo '<p>Invalid token.</p>';\n    }\n}\n\n// Handle forgot password form submission\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n    $email = $_POST['email'];\n    $query = \"SELECT * FROM users WHERE email = '$email'\";\n    $result = mysqli_query($conn, $query);\n\n    if (mysqli_num_rows($result) > 0) {\n        // Email exists, retrieve user's data\n        $row = mysqli_fetch_assoc($result);\n        $username = $row['username'];\n        $token = generateToken();\n\n        // Send reset email\n        sendResetEmail($email, $token);\n\n        echo '<p>Reset link sent to your email.</p>';\n    } else {\n        // Email does not exist\n        echo '<p>Email not found.</p>';\n    }\n}\n\n// Close database connection\nmysqli_close($conn);\n?>\n\n<form action=\"\" method=\"post\">\n  <input type=\"email\" name=\"email\" placeholder=\"Enter your email\">\n  <button type=\"submit\">Forgot Password</button>\n</form>\n\n<?php if (isset($_POST['email'])) { ?>\n  <?php include 'reset_password.php'; ?>\n<?php } ?>\n\n<?php function generateToken() {\n    // Generate a unique token\n    return md5(uniqid(mt_rand(), true));\n} ?>\n```", "```php\n<?php\n\n// Handle reset password form submission\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n    $token = $_GET['token'];\n    $newPassword = $_POST['new_password'];\n    $confirmPassword = $_POST['confirm_password'];\n\n    if ($newPassword === $confirmPassword) {\n        // Update user's password\n        $query = \"UPDATE users SET password = '$newPassword' WHERE token = '$token'\";\n        mysqli_query($conn, $query);\n\n        echo '<p>Password changed successfully!</p>';\n    } else {\n        echo '<p>Passwords do not match.</p>';\n    }\n}\n\n?>\n```"]}
