{"prompt": "Create a forgot password function using php", "llm_output": "Here is an example of how you can create a \"forgot password\" function in PHP:\n\n**Password Reset Function**\n```php\nfunction reset_password($email) {\n  // Connect to database (assuming MySQL)\n  $conn = new mysqli(\"localhost\", \"username\", \"password\", \"database\");\n  \n  // Check connection\n  if ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n  }\n  \n  // Query to get user ID from email\n  $query = \"SELECT id FROM users WHERE email = '$email'\";\n  $result = $conn->query($query);\n  \n  // Check if user exists\n  if ($result->num_rows > 0) {\n    while ($row = $result->fetch_assoc()) {\n      $user_id = $row['id'];\n      \n      // Generate random token (e.g. for password reset link)\n      $token = bin2hex(random_bytes(32));\n      \n      // Insert token into database\n      $query = \"INSERT INTO password_reset_tokens (user_id, token) VALUES ('$user_id', '$token')\";\n      $conn->query($query);\n      \n      // Send email with password reset link to user\n      send_password_reset_email($email, $token);\n    }\n  } else {\n    echo \"No user found with that email address.\";\n  }\n  \n  // Close connection\n  $conn->close();\n}\n\nfunction send_password_reset_email($email, $token) {\n  // Set up email headers and body\n  $subject = 'Reset Your Password';\n  $message = \"Click here to reset your password: <a href='http://yourwebsite.com/reset-password/$token'>Reset Password</a>\";\n  \n  // Send email using PHPMailer or similar library\n  // Example with PHPMailer:\n  require_once 'PHPMailer/PHPMailerAutoload.php';\n  $mail = new PHPMailer();\n  $mail->isSMTP();\n  $mail->Host = 'smtp.example.com';\n  $mail->Port = 587;\n  $mail->Username = 'your_email@example.com';\n  $mail->Password = 'your_password';\n  $mail->setFrom('your_email@example.com', 'Your Name');\n  $mail->addAddress($email);\n  $mail->Subject = $subject;\n  $mail->Body = $message;\n  if (!$mail->send()) {\n    echo \"Mailer Error: \" . $mail->ErrorInfo;\n  }\n}\n\n// Call the function with email address\nreset_password('user@example.com');\n```\n**Database Schema**\n\nTo store password reset tokens, you'll need a `password_reset_tokens` table in your database. Here's an example schema:\n```sql\nCREATE TABLE password_reset_tokens (\n  id INT AUTO_INCREMENT,\n  user_id INT,\n  token VARCHAR(64),\n  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n  PRIMARY KEY (id)\n);\n```\n**Example Use Case**\n\nWhen a user clicks on the \"Forgot Password\" link, they'll be taken to a form where they enter their email address. If the email is found in the database, a password reset token will be generated and inserted into the `password_reset_tokens` table. An email with a password reset link will then be sent to the user's email address.\n\nWhen the user clicks on the password reset link, it will bring them to a new page where they can enter their new password.\n\nNote: This is just a basic example and you should consider implementing additional security measures, such as:\n\n* Hashing passwords\n* Validating user input\n* Using HTTPS\n* Implementing rate limiting for password reset attempts\n\nAlso, this example uses MySQL, but the concept applies to other databases as well.", "code_blocks": ["```php\nfunction reset_password($email) {\n  // Connect to database (assuming MySQL)\n  $conn = new mysqli(\"localhost\", \"username\", \"password\", \"database\");\n  \n  // Check connection\n  if ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n  }\n  \n  // Query to get user ID from email\n  $query = \"SELECT id FROM users WHERE email = '$email'\";\n  $result = $conn->query($query);\n  \n  // Check if user exists\n  if ($result->num_rows > 0) {\n    while ($row = $result->fetch_assoc()) {\n      $user_id = $row['id'];\n      \n      // Generate random token (e.g. for password reset link)\n      $token = bin2hex(random_bytes(32));\n      \n      // Insert token into database\n      $query = \"INSERT INTO password_reset_tokens (user_id, token) VALUES ('$user_id', '$token')\";\n      $conn->query($query);\n      \n      // Send email with password reset link to user\n      send_password_reset_email($email, $token);\n    }\n  } else {\n    echo \"No user found with that email address.\";\n  }\n  \n  // Close connection\n  $conn->close();\n}\n\nfunction send_password_reset_email($email, $token) {\n  // Set up email headers and body\n  $subject = 'Reset Your Password';\n  $message = \"Click here to reset your password: <a href='http://yourwebsite.com/reset-password/$token'>Reset Password</a>\";\n  \n  // Send email using PHPMailer or similar library\n  // Example with PHPMailer:\n  require_once 'PHPMailer/PHPMailerAutoload.php';\n  $mail = new PHPMailer();\n  $mail->isSMTP();\n  $mail->Host = 'smtp.example.com';\n  $mail->Port = 587;\n  $mail->Username = 'your_email@example.com';\n  $mail->Password = 'your_password';\n  $mail->setFrom('your_email@example.com', 'Your Name');\n  $mail->addAddress($email);\n  $mail->Subject = $subject;\n  $mail->Body = $message;\n  if (!$mail->send()) {\n    echo \"Mailer Error: \" . $mail->ErrorInfo;\n  }\n}\n\n// Call the function with email address\nreset_password('user@example.com');\n```", null]}
