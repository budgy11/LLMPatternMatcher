{"prompt": "Create a forgot password function using php", "llm_output": "Here is an example of how to create a \"Forgot Password\" function using PHP:\n\n**Database Schema**\n\nFor this example, we will assume that you have a database table called `users` with the following columns:\n\n* `username`: The user's username\n* `email`: The user's email address\n* `password_hash`: A hashed version of the user's password (using a library like `password_hash`)\n* `reset_token`: A random token generated when the user requests to reset their password\n\n**PHP Code**\n```php\n<?php\n\n// Configuration variables\ndefine('DB_HOST', 'localhost');\ndefine('DB_USER', 'your_username');\ndefine('DB_PASSWORD', 'your_password');\ndefine('DB_NAME', 'your_database_name');\n\n// Connect to database\n$conn = new mysqli(DB_HOST, DB_USER, DB_PASSWORD, DB_NAME);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Function to generate a reset token\nfunction generateResetToken() {\n    return bin2hex(random_bytes(16));\n}\n\n// Function to send email with reset link\nfunction sendPasswordResetEmail($email, $reset_token) {\n    // Send email using a library like SwiftMailer or PHPMailer\n    $mail = new Mailer();\n    $mail->setFrom('your_email@example.com', 'Your Website');\n    $mail->addAddress($email);\n    $mail->Subject = 'Reset your password';\n    $body = \"Click this link to reset your password: <a href='\" . $_SERVER['HTTP_HOST'] . \"/reset-password?token=\" . $reset_token . \"'>Reset Password</a>\";\n    $mail->Body = $body;\n    return $mail->send();\n}\n\n// Function to update user's password\nfunction updatePassword($username, $new_password) {\n    // Hash the new password using a library like `password_hash`\n    $hashed_password = password_hash($new_password, PASSWORD_DEFAULT);\n    $query = \"UPDATE users SET password_hash = '$hashed_password' WHERE username = '$username'\";\n    $conn->query($query);\n}\n\n// Forgot Password function\nfunction forgotPassword() {\n    if ($_SERVER['REQUEST_METHOD'] == 'POST') {\n        $email = $_POST['email'];\n        $username = $_POST['username'];\n\n        // Check if user exists\n        $query = \"SELECT * FROM users WHERE email = '$email' AND username = '$username'\";\n        $result = $conn->query($query);\n        if ($result->num_rows > 0) {\n            // Generate a reset token\n            $reset_token = generateResetToken();\n\n            // Update user's reset token in database\n            $query = \"UPDATE users SET reset_token = '$reset_token' WHERE email = '$email' AND username = '$username'\";\n            $conn->query($query);\n\n            // Send password reset email\n            sendPasswordResetEmail($email, $reset_token);\n        } else {\n            echo 'User not found';\n        }\n    }\n}\n\n// Display forgot password form\nif (isset($_POST['forgot'])) {\n    forgotPassword();\n} else {\n    ?>\n    <form method=\"post\">\n        <label for=\"username\">Username:</label>\n        <input type=\"text\" id=\"username\" name=\"username\"><br><br>\n        <label for=\"email\">Email:</label>\n        <input type=\"email\" id=\"email\" name=\"email\"><br><br>\n        <button type=\"submit\" name=\"forgot\">Forgot Password</button>\n    </form>\n    <?php\n}\n\n// Close database connection\n$conn->close();\n\n?>\n```\n**How it works**\n\n1. The user submits the forgot password form with their username and email address.\n2. The `forgotPassword()` function checks if the user exists in the database by querying the `users` table.\n3. If the user exists, a reset token is generated using the `generateResetToken()` function.\n4. The reset token is then updated in the database for the corresponding user.\n5. A password reset email is sent to the user's email address with a link to reset their password.\n\n**Security Notes**\n\n* Always use prepared statements and parameterized queries to prevent SQL injection attacks.\n* Use a secure method of generating random tokens, such as `random_bytes()`.\n* Make sure to hash the new password before storing it in the database using a library like `password_hash`.", "code_blocks": ["```php\n<?php\n\n// Configuration variables\ndefine('DB_HOST', 'localhost');\ndefine('DB_USER', 'your_username');\ndefine('DB_PASSWORD', 'your_password');\ndefine('DB_NAME', 'your_database_name');\n\n// Connect to database\n$conn = new mysqli(DB_HOST, DB_USER, DB_PASSWORD, DB_NAME);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Function to generate a reset token\nfunction generateResetToken() {\n    return bin2hex(random_bytes(16));\n}\n\n// Function to send email with reset link\nfunction sendPasswordResetEmail($email, $reset_token) {\n    // Send email using a library like SwiftMailer or PHPMailer\n    $mail = new Mailer();\n    $mail->setFrom('your_email@example.com', 'Your Website');\n    $mail->addAddress($email);\n    $mail->Subject = 'Reset your password';\n    $body = \"Click this link to reset your password: <a href='\" . $_SERVER['HTTP_HOST'] . \"/reset-password?token=\" . $reset_token . \"'>Reset Password</a>\";\n    $mail->Body = $body;\n    return $mail->send();\n}\n\n// Function to update user's password\nfunction updatePassword($username, $new_password) {\n    // Hash the new password using a library like `password_hash`\n    $hashed_password = password_hash($new_password, PASSWORD_DEFAULT);\n    $query = \"UPDATE users SET password_hash = '$hashed_password' WHERE username = '$username'\";\n    $conn->query($query);\n}\n\n// Forgot Password function\nfunction forgotPassword() {\n    if ($_SERVER['REQUEST_METHOD'] == 'POST') {\n        $email = $_POST['email'];\n        $username = $_POST['username'];\n\n        // Check if user exists\n        $query = \"SELECT * FROM users WHERE email = '$email' AND username = '$username'\";\n        $result = $conn->query($query);\n        if ($result->num_rows > 0) {\n            // Generate a reset token\n            $reset_token = generateResetToken();\n\n            // Update user's reset token in database\n            $query = \"UPDATE users SET reset_token = '$reset_token' WHERE email = '$email' AND username = '$username'\";\n            $conn->query($query);\n\n            // Send password reset email\n            sendPasswordResetEmail($email, $reset_token);\n        } else {\n            echo 'User not found';\n        }\n    }\n}\n\n// Display forgot password form\nif (isset($_POST['forgot'])) {\n    forgotPassword();\n} else {\n    ?>\n    <form method=\"post\">\n        <label for=\"username\">Username:</label>\n        <input type=\"text\" id=\"username\" name=\"username\"><br><br>\n        <label for=\"email\">Email:</label>\n        <input type=\"email\" id=\"email\" name=\"email\"><br><br>\n        <button type=\"submit\" name=\"forgot\">Forgot Password</button>\n    </form>\n    <?php\n}\n\n// Close database connection\n$conn->close();\n\n?>\n```"]}
