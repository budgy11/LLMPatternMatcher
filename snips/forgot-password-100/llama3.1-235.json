{"prompt": "Create a forgot password function using php", "llm_output": "Here's an example of how you can create a \"Forgot Password\" function in PHP:\n\n**Database Table**\n\nLet's assume we have a database table `users` with the following columns:\n```sql\n+------------+--------------+---------------------+\n| user_id    | username     | email               |\n+------------+--------------+---------------------+\n```\nWe'll be using the `email` column to send a password reset link to the user.\n\n**Forgot Password PHP Code**\n```php\n<?php\n\n// Include configuration file (e.g., database credentials)\nrequire_once 'config.php';\n\n// Check if form has been submitted\nif ($_SERVER['REQUEST_METHOD'] === 'POST') {\n    // Get form data\n    $email = $_POST['email'];\n\n    // Validate email\n    if (!filter_var($email, FILTER_VALIDATE_EMAIL)) {\n        echo \"Invalid email address.\";\n        exit;\n    }\n\n    // Query database to retrieve user ID\n    $query = \"SELECT * FROM users WHERE email = '$email'\";\n    $result = mysqli_query($conn, $query);\n    if (!$result) {\n        die(\"Database query failed: \" . mysqli_error($conn));\n    }\n    $user_id = mysqli_fetch_assoc($result);\n\n    // If user exists\n    if ($user_id) {\n        // Generate a unique token for password reset\n        $token = bin2hex(random_bytes(16));\n\n        // Update database with new token\n        $query = \"UPDATE users SET token = '$token' WHERE id = '$user_id[id]'\";\n        mysqli_query($conn, $query);\n\n        // Send email with password reset link\n        send_email($email, $token);\n    } else {\n        echo \"No user found with that email address.\";\n    }\n}\n\n// Function to send password reset email\nfunction send_email($email, $token) {\n    // Replace with your own mail server settings\n    $to = $email;\n    $subject = 'Reset Your Password';\n    $body = 'Click here to reset your password: <a href=\"http://example.com/reset-password.php?token=' . $token . '\">Reset Password</a>';\n    $headers = 'From: example@example.com' . \"\\r\\n\" .\n               'Content-Type: text/html; charset=UTF-8' . \"\\r\\n\";\n\n    mail($to, $subject, $body, $headers);\n}\n\n?>\n```\n**reset-password.php**\n```php\n<?php\n\n// Include configuration file (e.g., database credentials)\nrequire_once 'config.php';\n\n// Get token from URL query string\n$token = $_GET['token'];\n\n// Validate token\nif (!$token) {\n    echo \"Invalid or missing token.\";\n    exit;\n}\n\n// Query database to retrieve user ID and username\n$query = \"SELECT * FROM users WHERE token = '$token'\";\n$result = mysqli_query($conn, $query);\nif (!$result) {\n    die(\"Database query failed: \" . mysqli_error($conn));\n}\n$user_id = mysqli_fetch_assoc($result);\n\n// If user exists with matching token\nif ($user_id) {\n    // Display password reset form\n    echo '<h1>Reset Password</h1>';\n    echo '<form action=\"\" method=\"post\">';\n    echo '<input type=\"password\" name=\"new_password\">';\n    echo '<input type=\"submit\" value=\"Submit\">';\n    echo '</form>';\n\n    // If form has been submitted\n    if ($_SERVER['REQUEST_METHOD'] === 'POST') {\n        // Get new password from form data\n        $new_password = $_POST['new_password'];\n\n        // Validate new password\n        if (strlen($new_password) < 8) {\n            echo \"Password must be at least 8 characters.\";\n            exit;\n        }\n\n        // Update database with new password and reset token\n        $query = \"UPDATE users SET password = '$new_password', token = '' WHERE id = '$user_id[id]'\";\n        mysqli_query($conn, $query);\n\n        echo 'Password successfully changed.';\n    }\n} else {\n    echo \"Invalid or expired token.\";\n}\n\n?>\n```\n**Note:**\n\n* This is a basic example and you should consider implementing additional security measures (e.g., password hashing, salt generation).\n* You should also ensure that your email server settings are properly configured to send emails.\n* Always validate user input data to prevent SQL injection attacks.\n\nI hope this helps! Let me know if you have any questions or need further clarification.", "code_blocks": [null, "```php\n<?php\n\n// Include configuration file (e.g., database credentials)\nrequire_once 'config.php';\n\n// Check if form has been submitted\nif ($_SERVER['REQUEST_METHOD'] === 'POST') {\n    // Get form data\n    $email = $_POST['email'];\n\n    // Validate email\n    if (!filter_var($email, FILTER_VALIDATE_EMAIL)) {\n        echo \"Invalid email address.\";\n        exit;\n    }\n\n    // Query database to retrieve user ID\n    $query = \"SELECT * FROM users WHERE email = '$email'\";\n    $result = mysqli_query($conn, $query);\n    if (!$result) {\n        die(\"Database query failed: \" . mysqli_error($conn));\n    }\n    $user_id = mysqli_fetch_assoc($result);\n\n    // If user exists\n    if ($user_id) {\n        // Generate a unique token for password reset\n        $token = bin2hex(random_bytes(16));\n\n        // Update database with new token\n        $query = \"UPDATE users SET token = '$token' WHERE id = '$user_id[id]'\";\n        mysqli_query($conn, $query);\n\n        // Send email with password reset link\n        send_email($email, $token);\n    } else {\n        echo \"No user found with that email address.\";\n    }\n}\n\n// Function to send password reset email\nfunction send_email($email, $token) {\n    // Replace with your own mail server settings\n    $to = $email;\n    $subject = 'Reset Your Password';\n    $body = 'Click here to reset your password: <a href=\"http://example.com/reset-password.php?token=' . $token . '\">Reset Password</a>';\n    $headers = 'From: example@example.com' . \"\\r\\n\" .\n               'Content-Type: text/html; charset=UTF-8' . \"\\r\\n\";\n\n    mail($to, $subject, $body, $headers);\n}\n\n?>\n```", "```php\n<?php\n\n// Include configuration file (e.g., database credentials)\nrequire_once 'config.php';\n\n// Get token from URL query string\n$token = $_GET['token'];\n\n// Validate token\nif (!$token) {\n    echo \"Invalid or missing token.\";\n    exit;\n}\n\n// Query database to retrieve user ID and username\n$query = \"SELECT * FROM users WHERE token = '$token'\";\n$result = mysqli_query($conn, $query);\nif (!$result) {\n    die(\"Database query failed: \" . mysqli_error($conn));\n}\n$user_id = mysqli_fetch_assoc($result);\n\n// If user exists with matching token\nif ($user_id) {\n    // Display password reset form\n    echo '<h1>Reset Password</h1>';\n    echo '<form action=\"\" method=\"post\">';\n    echo '<input type=\"password\" name=\"new_password\">';\n    echo '<input type=\"submit\" value=\"Submit\">';\n    echo '</form>';\n\n    // If form has been submitted\n    if ($_SERVER['REQUEST_METHOD'] === 'POST') {\n        // Get new password from form data\n        $new_password = $_POST['new_password'];\n\n        // Validate new password\n        if (strlen($new_password) < 8) {\n            echo \"Password must be at least 8 characters.\";\n            exit;\n        }\n\n        // Update database with new password and reset token\n        $query = \"UPDATE users SET password = '$new_password', token = '' WHERE id = '$user_id[id]'\";\n        mysqli_query($conn, $query);\n\n        echo 'Password successfully changed.';\n    }\n} else {\n    echo \"Invalid or expired token.\";\n}\n\n?>\n```"]}
