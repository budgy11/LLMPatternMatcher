{"prompt": "Create a forgot password function using php", "llm_output": "Here is an example of how to create a \"forgot password\" function in PHP:\n\n**Database Structure**\n\nLet's assume we have the following database table structure:\n```sql\nCREATE TABLE users (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  username VARCHAR(255) NOT NULL,\n  email VARCHAR(255) NOT NULL,\n  password_hash VARCHAR(255) NOT NULL\n);\n```\n**PHP Code**\n\nWe'll create a function called `forgot_password()` that takes the user's email as input and sends them an email with a link to reset their password.\n\n```php\n<?php\n\n// Configuration\ndefine('SITE_URL', 'https://example.com');\n\nfunction forgot_password($email) {\n  // Check if email is valid\n  if (!filter_var($email, FILTER_VALIDATE_EMAIL)) {\n    return array('error' => 'Invalid email address');\n  }\n\n  // Query database to check if user exists\n  $conn = mysqli_connect(\"localhost\", \"username\", \"password\", \"database\");\n  if (!$conn) {\n    die(\"Connection failed: \" . mysqli_error($conn));\n  }\n  $query = \"SELECT * FROM users WHERE email = '$email'\";\n  $result = mysqli_query($conn, $query);\n  if (mysqli_num_rows($result) == 0) {\n    // User does not exist\n    return array('error' => 'User not found');\n  }\n\n  // Generate reset token and password reset link\n  $token = bin2hex(random_bytes(16));\n  $password_reset_link = SITE_URL . '/reset-password?token=' . $token;\n\n  // Insert token into database for later verification\n  $query = \"INSERT INTO password_resets (email, token) VALUES ('$email', '$token')\";\n  mysqli_query($conn, $query);\n\n  // Send email with password reset link\n  $to = $email;\n  $subject = 'Reset your password';\n  $message = '\n    <p>Dear user,</p>\n    <p>To reset your password, please click the following link:</p>\n    <a href=\"' . $password_reset_link . '\">' . $password_reset_link . '</a>\n  ';\n  mail($to, $subject, $message);\n\n  // Return success message\n  return array('success' => 'Password reset email sent');\n}\n\n?>\n```\n**Example Use Case**\n\nTo use the `forgot_password()` function, simply call it with the user's email address as input:\n```php\n$email = 'user@example.com';\n$response = forgot_password($email);\necho json_encode($response); // Output: {\"success\": \"Password reset email sent\"}\n```\nThis code will send an email to the specified email address with a link to reset their password.\n\n**Security Considerations**\n\n* Make sure to store the reset token securely in the database, using a cryptographically secure hash function (e.g. SHA-256).\n* Use HTTPS to encrypt all communication between the user's browser and your server.\n* Implement rate limiting on the `forgot_password()` function to prevent brute-force attacks.\n\nNote: This is just an example code and you should adapt it to your specific requirements and security considerations.", "code_blocks": [null, "```php\n<?php\n\n// Configuration\ndefine('SITE_URL', 'https://example.com');\n\nfunction forgot_password($email) {\n  // Check if email is valid\n  if (!filter_var($email, FILTER_VALIDATE_EMAIL)) {\n    return array('error' => 'Invalid email address');\n  }\n\n  // Query database to check if user exists\n  $conn = mysqli_connect(\"localhost\", \"username\", \"password\", \"database\");\n  if (!$conn) {\n    die(\"Connection failed: \" . mysqli_error($conn));\n  }\n  $query = \"SELECT * FROM users WHERE email = '$email'\";\n  $result = mysqli_query($conn, $query);\n  if (mysqli_num_rows($result) == 0) {\n    // User does not exist\n    return array('error' => 'User not found');\n  }\n\n  // Generate reset token and password reset link\n  $token = bin2hex(random_bytes(16));\n  $password_reset_link = SITE_URL . '/reset-password?token=' . $token;\n\n  // Insert token into database for later verification\n  $query = \"INSERT INTO password_resets (email, token) VALUES ('$email', '$token')\";\n  mysqli_query($conn, $query);\n\n  // Send email with password reset link\n  $to = $email;\n  $subject = 'Reset your password';\n  $message = '\n    <p>Dear user,</p>\n    <p>To reset your password, please click the following link:</p>\n    <a href=\"' . $password_reset_link . '\">' . $password_reset_link . '</a>\n  ';\n  mail($to, $subject, $message);\n\n  // Return success message\n  return array('success' => 'Password reset email sent');\n}\n\n?>\n```", "```php\n$email = 'user@example.com';\n$response = forgot_password($email);\necho json_encode($response); // Output: {\"success\": \"Password reset email sent\"}\n```"]}
