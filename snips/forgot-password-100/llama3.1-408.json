{"prompt": "Create a forgot password function using php", "llm_output": "Here is an example of how to create a \"Forgot Password\" function in PHP:\n\n**Database Schema:**\n\nLet's assume we have a table called `users` with the following columns:\n\n| Column Name | Data Type |\n| --- | --- |\n| id | int (primary key) |\n| email | varchar(255) |\n| password | varchar(255) |\n\n**Code:**\n```php\n<?php\n\n// Configuration\n$databaseHost = 'localhost';\n$databaseUsername = 'username';\n$databasePassword = 'password';\n$databaseName = 'database_name';\n\n// Connect to database\n$conn = new mysqli($databaseHost, $databaseUsername, $databasePassword, $databaseName);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Function to send password reset email\nfunction send_password_reset_email($email) {\n    // Generate a random token for the user\n    $token = bin2hex(random_bytes(32));\n\n    // Update user's token in database\n    $sql = \"UPDATE users SET token = '$token' WHERE email = '$email'\";\n    if ($conn->query($sql) === TRUE) {\n        // Send email to user with password reset link\n        $to      = $email;\n        $subject = 'Reset Your Password';\n        $message  = '<p>Click this link to reset your password: <a href=\"' . site_url('reset-password/' . $token) . '\">Reset Password</a></p>';\n        $headers[] = 'From: ' . 'your-email@example.com' . \"\\r\\n\";\n        mail($to, $subject, $message, implode(\"\\r\\n\", $headers));\n    } else {\n        echo \"Error updating user's token: \" . $conn->error;\n    }\n}\n\n// Function to check if email exists in database\nfunction email_exists($email) {\n    $sql = \"SELECT * FROM users WHERE email = '$email'\";\n    $result = $conn->query($sql);\n    return ($result->num_rows > 0);\n}\n\n// Handle forgot password form submission\nif (isset($_POST['forgot-password'])) {\n    $email = $_POST['email'];\n    if (email_exists($email)) {\n        send_password_reset_email($email);\n        echo 'Email sent with password reset link';\n    } else {\n        echo 'Email does not exist in our database';\n    }\n}\n\n// Close connection\n$conn->close();\n\n?>\n```\n**Explanation:**\n\n1. The code connects to a MySQL database using the `mysqli` extension.\n2. Two functions are defined:\n\t* `send_password_reset_email()`: generates a random token for the user, updates their token in the database, and sends an email with a password reset link.\n\t* `email_exists()`: checks if an email exists in the database by running a SQL query.\n3. When the \"Forgot Password\" form is submitted (i.e., when `$_POST['forgot-password']` is set), the code checks if the email exists in the database using `email_exists()`. If it does, the `send_password_reset_email()` function is called to send an email with a password reset link.\n\n**HTML Form:**\n```html\n<form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\">\n    <input type=\"text\" name=\"email\" placeholder=\"Enter your email address\">\n    <button type=\"submit\" name=\"forgot-password\">Forgot Password</button>\n</form>\n```\nThis code assumes you have a `site_url()` function that generates the URL for the password reset link. You'll need to modify this function to match your application's routing.\n\nNote: This is a basic example and should not be used in production without proper security measures, such as hashing and salting passwords, secure password reset tokens, etc.", "code_blocks": ["```php\n<?php\n\n// Configuration\n$databaseHost = 'localhost';\n$databaseUsername = 'username';\n$databasePassword = 'password';\n$databaseName = 'database_name';\n\n// Connect to database\n$conn = new mysqli($databaseHost, $databaseUsername, $databasePassword, $databaseName);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Function to send password reset email\nfunction send_password_reset_email($email) {\n    // Generate a random token for the user\n    $token = bin2hex(random_bytes(32));\n\n    // Update user's token in database\n    $sql = \"UPDATE users SET token = '$token' WHERE email = '$email'\";\n    if ($conn->query($sql) === TRUE) {\n        // Send email to user with password reset link\n        $to      = $email;\n        $subject = 'Reset Your Password';\n        $message  = '<p>Click this link to reset your password: <a href=\"' . site_url('reset-password/' . $token) . '\">Reset Password</a></p>';\n        $headers[] = 'From: ' . 'your-email@example.com' . \"\\r\\n\";\n        mail($to, $subject, $message, implode(\"\\r\\n\", $headers));\n    } else {\n        echo \"Error updating user's token: \" . $conn->error;\n    }\n}\n\n// Function to check if email exists in database\nfunction email_exists($email) {\n    $sql = \"SELECT * FROM users WHERE email = '$email'\";\n    $result = $conn->query($sql);\n    return ($result->num_rows > 0);\n}\n\n// Handle forgot password form submission\nif (isset($_POST['forgot-password'])) {\n    $email = $_POST['email'];\n    if (email_exists($email)) {\n        send_password_reset_email($email);\n        echo 'Email sent with password reset link';\n    } else {\n        echo 'Email does not exist in our database';\n    }\n}\n\n// Close connection\n$conn->close();\n\n?>\n```", null]}
