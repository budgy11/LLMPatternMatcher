{"prompt": "Create a forgot password function using php", "llm_output": "Here's an example of how to create a \"Forgot Password\" function in PHP:\n\n**Database Schema**\n\nFor this example, let's assume you have the following database schema:\n```sql\nCREATE TABLE users (\n    id INT PRIMARY KEY AUTO_INCREMENT,\n    email VARCHAR(255) NOT NULL,\n    password_hash VARCHAR(255) NOT NULL,\n    reset_token VARCHAR(255)\n);\n```\n**PHP Code**\n\nCreate a new file called `forgot-password.php` and add the following code:\n```php\n<?php\n\nrequire_once 'database.php';\n\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n    // Handle form submission\n    $email = $_POST['email'];\n\n    // Check if email is in database\n    $stmt = $db->prepare('SELECT * FROM users WHERE email = :email');\n    $stmt->execute([':email' => $email]);\n    $user = $stmt->fetch();\n\n    if ($user) {\n        // Generate reset token\n        $resetToken = bin2hex(random_bytes(32));\n\n        // Update user's reset token\n        $stmt = $db->prepare('UPDATE users SET reset_token = :token WHERE id = :id');\n        $stmt->execute([':token' => $resetToken, ':id' => $user['id']]);\n\n        // Send email with reset link\n        $to = $email;\n        $subject = 'Reset Your Password';\n        $body = '\n            <p>Click the following link to reset your password:</p>\n            <a href=\"' . site_url('reset-password?token=' . $resetToken) . '\">Reset Password</a>\n        ';\n\n        sendEmail($to, $subject, $body);\n\n        echo 'A password reset email has been sent to you. Please check your inbox.';\n    } else {\n        echo 'No account found with that email address.';\n    }\n}\n\nfunction sendEmail($to, $subject, $body) {\n    // Your email sending code here (e.g., using PHPMailer)\n    // For this example, let's assume it sends the email successfully\n}\n\n?>\n```\n**Form**\n\nCreate a simple form in your HTML file (`index.html`) to collect the user's email address:\n```html\n<form action=\"forgot-password.php\" method=\"post\">\n    <input type=\"email\" name=\"email\" placeholder=\"Email Address\">\n    <button type=\"submit\">Submit</button>\n</form>\n```\n**How it Works**\n\nHere's what happens when a user submits the form:\n\n1. The script checks if the email address exists in the database.\n2. If the email is found, a random reset token is generated using `bin2hex(random_bytes(32))`.\n3. The reset token is stored in the user's database record, overwriting any existing reset token.\n4. An email is sent to the user with a link to reset their password. The link includes the reset token as a query parameter (`reset-password?token=...`).\n5. If the email address is not found, an error message is displayed.\n\n**Security Notes**\n\n* This example uses a simple random token for resetting passwords. In production, consider using a more secure method like one-time passwords (OTPs) or password reset tokens with expiration times.\n* Make sure to validate user input on both the client-side and server-side to prevent SQL injection attacks.\n* Use HTTPS to encrypt communication between the client and server.\n\nI hope this helps you create a basic \"Forgot Password\" function in PHP!", "code_blocks": [null, "```php\n<?php\n\nrequire_once 'database.php';\n\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n    // Handle form submission\n    $email = $_POST['email'];\n\n    // Check if email is in database\n    $stmt = $db->prepare('SELECT * FROM users WHERE email = :email');\n    $stmt->execute([':email' => $email]);\n    $user = $stmt->fetch();\n\n    if ($user) {\n        // Generate reset token\n        $resetToken = bin2hex(random_bytes(32));\n\n        // Update user's reset token\n        $stmt = $db->prepare('UPDATE users SET reset_token = :token WHERE id = :id');\n        $stmt->execute([':token' => $resetToken, ':id' => $user['id']]);\n\n        // Send email with reset link\n        $to = $email;\n        $subject = 'Reset Your Password';\n        $body = '\n            <p>Click the following link to reset your password:</p>\n            <a href=\"' . site_url('reset-password?token=' . $resetToken) . '\">Reset Password</a>\n        ';\n\n        sendEmail($to, $subject, $body);\n\n        echo 'A password reset email has been sent to you. Please check your inbox.';\n    } else {\n        echo 'No account found with that email address.';\n    }\n}\n\nfunction sendEmail($to, $subject, $body) {\n    // Your email sending code here (e.g., using PHPMailer)\n    // For this example, let's assume it sends the email successfully\n}\n\n?>\n```", null]}
