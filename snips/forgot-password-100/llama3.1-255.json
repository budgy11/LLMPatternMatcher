{"prompt": "Create a forgot password function using php", "llm_output": "**Forgot Password Function in PHP**\n=====================================\n\nThis is an example of how to create a forgot password function in PHP. This function will send a reset password link to the user's email address.\n\n### Database Schema\n\nWe assume that you have a database table `users` with the following schema:\n\n```sql\nCREATE TABLE users (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  email VARCHAR(255) NOT NULL,\n  password_hash VARCHAR(255) NOT NULL\n);\n```\n\n### PHP Code\n\nCreate a file named `forgot_password.php` and add the following code:\n```php\n<?php\n\n// Configuration\n$host = 'localhost';\n$dbname = 'your_database_name';\n$username = 'your_username';\n$password = 'your_password';\n\n// Connection settings\n$conn = new PDO(\"mysql:host=$host;dbname=$dbname\", $username, $password);\n\n// Function to send reset password link via email\nfunction send_reset_link($email) {\n  // Generate random token for password reset\n  $token = bin2hex(random_bytes(32));\n\n  // Update user's token in database\n  $query = \"UPDATE users SET token = '$token' WHERE email = '$email'\";\n  $conn->exec($query);\n\n  // Send email with reset link\n  $subject = 'Reset Password Link';\n  $body = '<p>Click the following link to reset your password:</p><a href=\"' . $_SERVER['REQUEST_SCHEME'] . '://' . $_SERVER['HTTP_HOST'] . '/reset_password.php?token=' . $token . '\">Reset Password</a>';\n  mail($email, $subject, $body);\n\n  return true;\n}\n\n// Forgot password form handler\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n  // Get user input\n  $email = $_POST['email'];\n\n  // Check if email exists in database\n  $query = \"SELECT * FROM users WHERE email = '$email'\";\n  $result = $conn->query($query);\n  if ($result->rowCount() > 0) {\n    send_reset_link($email);\n    echo 'Reset password link sent to your email.';\n  } else {\n    echo 'Email not found in our records.';\n  }\n} ?>\n\n<form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\">\n  <input type=\"email\" name=\"email\" placeholder=\"Enter your email address\" />\n  <button type=\"submit\">Send Reset Link</button>\n</form>\n```\n### Explanation\n\nThis code does the following:\n\n1. Connects to the database using PDO.\n2. Defines a function `send_reset_link()` that generates a random token for password reset, updates the user's token in the database, and sends an email with a reset link.\n3. Handles the forgot password form submission by checking if the entered email exists in the database and sending the reset link via email if it does.\n\n### Reset Password Link\n\nCreate another file named `reset_password.php` to handle the password reset process:\n```php\n<?php\n\n// Configuration\n$host = 'localhost';\n$dbname = 'your_database_name';\n$username = 'your_username';\n$password = 'your_password';\n\n// Connection settings\n$conn = new PDO(\"mysql:host=$host;dbname=$dbname\", $username, $password);\n\n// Function to update password\nfunction update_password($token) {\n  // Get user's email from token\n  $query = \"SELECT email FROM users WHERE token = '$token'\";\n  $result = $conn->query($query);\n  if ($result->rowCount() > 0) {\n    $email = $result->fetchColumn();\n\n    // Update password (e.g., hash and store new password)\n    $new_password = 'your_new_password'; // Replace with user input\n    $password_hash = password_hash($new_password, PASSWORD_DEFAULT);\n    $query = \"UPDATE users SET password_hash = '$password_hash', token = '' WHERE email = '$email'\";\n    $conn->exec($query);\n\n    return true;\n  }\n\n  return false;\n}\n\n// Reset password form handler\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n  // Get user input\n  $token = $_POST['token'];\n  $new_password = $_POST['password'];\n\n  // Update password\n  if (update_password($token)) {\n    echo 'Password updated successfully.';\n  } else {\n    echo 'Invalid token or email not found in our records.';\n  }\n} ?>\n\n<form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\">\n  <input type=\"hidden\" name=\"token\" value=\"<?php echo $_GET['token']; ?>\" />\n  <label for=\"password\">New Password:</label>\n  <input type=\"password\" id=\"password\" name=\"password\" />\n  <button type=\"submit\">Reset Password</button>\n</form>\n```\nThis code does the following:\n\n1. Connects to the database using PDO.\n2. Defines a function `update_password()` that updates the user's password by hashing and storing the new password, and resets the token in the database.\n3. Handles the reset password form submission by updating the password if the entered token is valid.\n\nNote: This is a basic example to illustrate the concept of forgot password functionality using PHP. You should adapt this code to your specific use case and add additional security measures (e.g., email verification, secure password hashing).", "code_blocks": [null, "```php\n<?php\n\n// Configuration\n$host = 'localhost';\n$dbname = 'your_database_name';\n$username = 'your_username';\n$password = 'your_password';\n\n// Connection settings\n$conn = new PDO(\"mysql:host=$host;dbname=$dbname\", $username, $password);\n\n// Function to send reset password link via email\nfunction send_reset_link($email) {\n  // Generate random token for password reset\n  $token = bin2hex(random_bytes(32));\n\n  // Update user's token in database\n  $query = \"UPDATE users SET token = '$token' WHERE email = '$email'\";\n  $conn->exec($query);\n\n  // Send email with reset link\n  $subject = 'Reset Password Link';\n  $body = '<p>Click the following link to reset your password:</p><a href=\"' . $_SERVER['REQUEST_SCHEME'] . '://' . $_SERVER['HTTP_HOST'] . '/reset_password.php?token=' . $token . '\">Reset Password</a>';\n  mail($email, $subject, $body);\n\n  return true;\n}\n\n// Forgot password form handler\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n  // Get user input\n  $email = $_POST['email'];\n\n  // Check if email exists in database\n  $query = \"SELECT * FROM users WHERE email = '$email'\";\n  $result = $conn->query($query);\n  if ($result->rowCount() > 0) {\n    send_reset_link($email);\n    echo 'Reset password link sent to your email.';\n  } else {\n    echo 'Email not found in our records.';\n  }\n} ?>\n\n<form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\">\n  <input type=\"email\" name=\"email\" placeholder=\"Enter your email address\" />\n  <button type=\"submit\">Send Reset Link</button>\n</form>\n```", "```php\n<?php\n\n// Configuration\n$host = 'localhost';\n$dbname = 'your_database_name';\n$username = 'your_username';\n$password = 'your_password';\n\n// Connection settings\n$conn = new PDO(\"mysql:host=$host;dbname=$dbname\", $username, $password);\n\n// Function to update password\nfunction update_password($token) {\n  // Get user's email from token\n  $query = \"SELECT email FROM users WHERE token = '$token'\";\n  $result = $conn->query($query);\n  if ($result->rowCount() > 0) {\n    $email = $result->fetchColumn();\n\n    // Update password (e.g., hash and store new password)\n    $new_password = 'your_new_password'; // Replace with user input\n    $password_hash = password_hash($new_password, PASSWORD_DEFAULT);\n    $query = \"UPDATE users SET password_hash = '$password_hash', token = '' WHERE email = '$email'\";\n    $conn->exec($query);\n\n    return true;\n  }\n\n  return false;\n}\n\n// Reset password form handler\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n  // Get user input\n  $token = $_POST['token'];\n  $new_password = $_POST['password'];\n\n  // Update password\n  if (update_password($token)) {\n    echo 'Password updated successfully.';\n  } else {\n    echo 'Invalid token or email not found in our records.';\n  }\n} ?>\n\n<form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\">\n  <input type=\"hidden\" name=\"token\" value=\"<?php echo $_GET['token']; ?>\" />\n  <label for=\"password\">New Password:</label>\n  <input type=\"password\" id=\"password\" name=\"password\" />\n  <button type=\"submit\">Reset Password</button>\n</form>\n```"]}
