{"prompt": "Create a user review function using php", "llm_output": "**User Review Function in PHP**\n=====================================\n\nThis is an example of a simple user review system using PHP. It includes the following features:\n\n*   Stores reviews in a database\n*   Allows users to rate and comment on products or services\n*   Displays reviews with average rating and total count\n*   Includes functionality for users to add, edit, and delete their own reviews\n\n### Database Schema\n\nFor this example, we will assume a simple database schema with the following tables:\n\n```sql\nCREATE TABLE users (\n    id INT PRIMARY KEY AUTO_INCREMENT,\n    username VARCHAR(255) NOT NULL,\n    email VARCHAR(255) NOT NULL\n);\n\nCREATE TABLE products (\n    id INT PRIMARY KEY AUTO_INCREMENT,\n    name VARCHAR(255) NOT NULL\n);\n\nCREATE TABLE reviews (\n    id INT PRIMARY KEY AUTO_INCREMENT,\n    user_id INT NOT NULL,\n    product_id INT NOT NULL,\n    rating TINYINT NOT NULL,\n    comment TEXT NOT NULL,\n    FOREIGN KEY (user_id) REFERENCES users(id),\n    FOREIGN KEY (product_id) REFERENCES products(id)\n);\n```\n\n### PHP Code\n\n```php\n// Include database connection file\nrequire_once 'db.php';\n\n// Function to display reviews for a product\nfunction get_reviews($product_id, $limit = 10) {\n    global $conn;\n    \n    // Query to retrieve reviews with average rating and count\n    $query = \"\n        SELECT r.id, u.username, p.name, AVG(r.rating) AS avg_rating, COUNT(r.id) AS total_count\n        FROM reviews r\n        JOIN users u ON r.user_id = u.id\n        JOIN products p ON r.product_id = p.id\n        WHERE r.product_id = $product_id\n        GROUP BY r.id, u.username, p.name\n    \";\n    \n    // Execute query and return results\n    $result = mysqli_query($conn, $query);\n    return mysqli_fetch_all($result, MYSQLI_ASSOC);\n}\n\n// Function to add a review for a product\nfunction add_review($product_id, $user_id, $rating, $comment) {\n    global $conn;\n    \n    // Query to insert new review into database\n    $query = \"\n        INSERT INTO reviews (product_id, user_id, rating, comment)\n        VALUES ($product_id, $user_id, $rating, '$comment')\n    \";\n    \n    // Execute query and return result\n    $result = mysqli_query($conn, $query);\n    return $result ? true : false;\n}\n\n// Function to edit a review for a product\nfunction edit_review($review_id, $new_rating, $new_comment) {\n    global $conn;\n    \n    // Query to update existing review in database\n    $query = \"\n        UPDATE reviews\n        SET rating = $new_rating, comment = '$new_comment'\n        WHERE id = $review_id\n    \";\n    \n    // Execute query and return result\n    $result = mysqli_query($conn, $query);\n    return $result ? true : false;\n}\n\n// Function to delete a review for a product\nfunction delete_review($review_id) {\n    global $conn;\n    \n    // Query to delete existing review from database\n    $query = \"\n        DELETE FROM reviews\n        WHERE id = $review_id\n    \";\n    \n    // Execute query and return result\n    $result = mysqli_query($conn, $query);\n    return $result ? true : false;\n}\n```\n\n### Example Usage\n\n```php\n// Display reviews for a product with ID 1\n$reviews = get_reviews(1);\necho json_encode($reviews);\n\n// Add a new review for product ID 2 from user ID 3\n$result = add_review(2, 3, 5, 'Great product!');\nvar_dump($result); // true or false\n\n// Edit an existing review with ID 4\n$result = edit_review(4, 4, 'Excellent product!');\nvar_dump($result); // true or false\n\n// Delete a review with ID 5\n$result = delete_review(5);\nvar_dump($result); // true or false\n```\n\nRemember to replace the database connection file (`db.php`) with your actual database credentials and configuration.\n\nThis is a basic implementation of a user review system using PHP. You can customize it as per your requirements and add more features such as authentication, authorization, and error handling.", "code_blocks": [null, "```php\n// Include database connection file\nrequire_once 'db.php';\n\n// Function to display reviews for a product\nfunction get_reviews($product_id, $limit = 10) {\n    global $conn;\n    \n    // Query to retrieve reviews with average rating and count\n    $query = \"\n        SELECT r.id, u.username, p.name, AVG(r.rating) AS avg_rating, COUNT(r.id) AS total_count\n        FROM reviews r\n        JOIN users u ON r.user_id = u.id\n        JOIN products p ON r.product_id = p.id\n        WHERE r.product_id = $product_id\n        GROUP BY r.id, u.username, p.name\n    \";\n    \n    // Execute query and return results\n    $result = mysqli_query($conn, $query);\n    return mysqli_fetch_all($result, MYSQLI_ASSOC);\n}\n\n// Function to add a review for a product\nfunction add_review($product_id, $user_id, $rating, $comment) {\n    global $conn;\n    \n    // Query to insert new review into database\n    $query = \"\n        INSERT INTO reviews (product_id, user_id, rating, comment)\n        VALUES ($product_id, $user_id, $rating, '$comment')\n    \";\n    \n    // Execute query and return result\n    $result = mysqli_query($conn, $query);\n    return $result ? true : false;\n}\n\n// Function to edit a review for a product\nfunction edit_review($review_id, $new_rating, $new_comment) {\n    global $conn;\n    \n    // Query to update existing review in database\n    $query = \"\n        UPDATE reviews\n        SET rating = $new_rating, comment = '$new_comment'\n        WHERE id = $review_id\n    \";\n    \n    // Execute query and return result\n    $result = mysqli_query($conn, $query);\n    return $result ? true : false;\n}\n\n// Function to delete a review for a product\nfunction delete_review($review_id) {\n    global $conn;\n    \n    // Query to delete existing review from database\n    $query = \"\n        DELETE FROM reviews\n        WHERE id = $review_id\n    \";\n    \n    // Execute query and return result\n    $result = mysqli_query($conn, $query);\n    return $result ? true : false;\n}\n```", "```php\n// Display reviews for a product with ID 1\n$reviews = get_reviews(1);\necho json_encode($reviews);\n\n// Add a new review for product ID 2 from user ID 3\n$result = add_review(2, 3, 5, 'Great product!');\nvar_dump($result); // true or false\n\n// Edit an existing review with ID 4\n$result = edit_review(4, 4, 'Excellent product!');\nvar_dump($result); // true or false\n\n// Delete a review with ID 5\n$result = delete_review(5);\nvar_dump($result); // true or false\n```"]}
