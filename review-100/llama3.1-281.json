{"prompt": "Create a user review function using php", "llm_output": "Here's an example of how you can create a simple user review system using PHP. This will include creating reviews, displaying reviews, and calculating the average rating.\n\n**Database Schema:**\n\nWe'll assume we have a database with two tables:\n\n1. `users`:\n\t* `id`\n\t* `name`\n2. `reviews`:\n\t* `id`\n\t* `user_id` (foreign key referencing `users.id`)\n\t* `product_id` ( foreign key referencing the product ID)\n\t* `rating` (1-5 scale)\n\t* `review_text`\n\n**PHP Code:**\n\nCreate a new PHP file, e.g. `reviews.php`.\n\n```php\n<?php\n\n// Database connection settings\n$servername = \"localhost\";\n$username = \"your_username\";\n$password = \"your_password\";\n$dbname = \"your_database\";\n\n// Create database connection\n$conn = new mysqli($servername, $username, $password, $dbname);\n\n// Check connection\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\nfunction getReviews() {\n    global $conn;\n    \n    // SQL query to fetch reviews\n    $sql = \"SELECT r.id, u.name, r.product_id, r.rating, r.review_text \n            FROM reviews r \n            INNER JOIN users u ON r.user_id = u.id \n            ORDER BY r.id DESC\";\n    \n    $result = $conn->query($sql);\n    \n    // Check if query was successful\n    if ($result->num_rows > 0) {\n        while($row = $result->fetch_assoc()) {\n            echo \"ID: \" . $row[\"id\"]. \" - Name: \" . $row[\"name\"]. \" - Product ID: \" . $row[\"product_id\"]. \" - Rating: \" . $row[\"rating\"]. \" - Review Text: \" . $row[\"review_text\"]. \"<br>\";\n        }\n    } else {\n        echo \"0 results\";\n    }\n}\n\nfunction getAverageRating($productId) {\n    global $conn;\n    \n    // SQL query to fetch average rating for a product\n    $sql = \"SELECT AVG(r.rating) AS avg_rating \n            FROM reviews r \n            WHERE r.product_id = '$productId'\";\n    \n    $result = $conn->query($sql);\n    \n    // Check if query was successful and return result\n    if ($result->num_rows > 0) {\n        while($row = $result->fetch_assoc()) {\n            return $row[\"avg_rating\"];\n        }\n    } else {\n        return null;\n    }\n}\n\n// Add review function (example: create a form on your page with the following fields)\nfunction addReview($userId, $productId, $rating, $reviewText) {\n    global $conn;\n    \n    // SQL query to insert new review\n    $sql = \"INSERT INTO reviews (user_id, product_id, rating, review_text) \n            VALUES ('$userId', '$productId', '$rating', '$reviewText')\";\n    \n    if ($conn->query($sql) === TRUE) {\n        echo \"Review added successfully\";\n    } else {\n        echo \"Error adding review: \" . $conn->error;\n    }\n}\n\n// Example usage\n$conn->close();\n\n?>\n```\n\n**Note:** \n\n1. This example uses a basic `mysqli` connection for simplicity, but in production you should use prepared statements and parameterized queries to avoid SQL injection attacks.\n\n2. The database schema is minimal; consider adding more fields as needed (e.g., review date).\n\n3. Error handling is simplified here; consider using try-catch blocks or other error handling mechanisms for a real-world application.", "code_blocks": ["```php\n<?php\n\n// Database connection settings\n$servername = \"localhost\";\n$username = \"your_username\";\n$password = \"your_password\";\n$dbname = \"your_database\";\n\n// Create database connection\n$conn = new mysqli($servername, $username, $password, $dbname);\n\n// Check connection\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\nfunction getReviews() {\n    global $conn;\n    \n    // SQL query to fetch reviews\n    $sql = \"SELECT r.id, u.name, r.product_id, r.rating, r.review_text \n            FROM reviews r \n            INNER JOIN users u ON r.user_id = u.id \n            ORDER BY r.id DESC\";\n    \n    $result = $conn->query($sql);\n    \n    // Check if query was successful\n    if ($result->num_rows > 0) {\n        while($row = $result->fetch_assoc()) {\n            echo \"ID: \" . $row[\"id\"]. \" - Name: \" . $row[\"name\"]. \" - Product ID: \" . $row[\"product_id\"]. \" - Rating: \" . $row[\"rating\"]. \" - Review Text: \" . $row[\"review_text\"]. \"<br>\";\n        }\n    } else {\n        echo \"0 results\";\n    }\n}\n\nfunction getAverageRating($productId) {\n    global $conn;\n    \n    // SQL query to fetch average rating for a product\n    $sql = \"SELECT AVG(r.rating) AS avg_rating \n            FROM reviews r \n            WHERE r.product_id = '$productId'\";\n    \n    $result = $conn->query($sql);\n    \n    // Check if query was successful and return result\n    if ($result->num_rows > 0) {\n        while($row = $result->fetch_assoc()) {\n            return $row[\"avg_rating\"];\n        }\n    } else {\n        return null;\n    }\n}\n\n// Add review function (example: create a form on your page with the following fields)\nfunction addReview($userId, $productId, $rating, $reviewText) {\n    global $conn;\n    \n    // SQL query to insert new review\n    $sql = \"INSERT INTO reviews (user_id, product_id, rating, review_text) \n            VALUES ('$userId', '$productId', '$rating', '$reviewText')\";\n    \n    if ($conn->query($sql) === TRUE) {\n        echo \"Review added successfully\";\n    } else {\n        echo \"Error adding review: \" . $conn->error;\n    }\n}\n\n// Example usage\n$conn->close();\n\n?>\n```"]}
