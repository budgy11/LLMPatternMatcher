{"prompt": "Create a user review function using php", "llm_output": "Here is an example of a basic user review system in PHP. This will include the following features:\n\n* Users can leave reviews\n* Reviews are associated with a specific product or item\n* Each review includes a rating (1-5) and a comment\n* The system keeps track of the total number of reviews for each item, as well as the average rating\n\nThis example uses a simple MySQL database to store the data.\n\n**Database Schema**\n```sql\nCREATE TABLE products (\n  id INT PRIMARY KEY,\n  name VARCHAR(255)\n);\n\nCREATE TABLE reviews (\n  id INT PRIMARY KEY,\n  product_id INT,\n  user_id INT,\n  rating INT,\n  comment TEXT,\n  FOREIGN KEY (product_id) REFERENCES products(id),\n  FOREIGN KEY (user_id) REFERENCES users(id)\n);\n```\n**PHP Code**\n```php\n<?php\n\n// Configuration\ndefine('DB_HOST', 'localhost');\ndefine('DB_NAME', 'reviews_db');\ndefine('DB_USER', 'username');\ndefine('DB_PASSWORD', 'password');\n\n// Function to connect to the database\nfunction db_connect() {\n  $conn = new mysqli(DB_HOST, DB_USER, DB_PASSWORD, DB_NAME);\n  if ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n  }\n  return $conn;\n}\n\n// Function to leave a review\nfunction leave_review($product_id, $user_id, $rating, $comment) {\n  $conn = db_connect();\n  $sql = \"INSERT INTO reviews (product_id, user_id, rating, comment)\n          VALUES (?, ?, ?, ?)\";\n  $stmt = $conn->prepare($sql);\n  $stmt->bind_param(\"iiss\", $product_id, $user_id, $rating, $comment);\n  $stmt->execute();\n  $review_id = $conn->insert_id;\n  $conn->close();\n  return $review_id;\n}\n\n// Function to get all reviews for a product\nfunction get_reviews($product_id) {\n  $conn = db_connect();\n  $sql = \"SELECT * FROM reviews WHERE product_id = ?\";\n  $stmt = $conn->prepare($sql);\n  $stmt->bind_param(\"i\", $product_id);\n  $stmt->execute();\n  $reviews = array();\n  while ($row = $stmt->get_result()->fetch_assoc()) {\n    $reviews[] = array(\n      'id' => $row['id'],\n      'rating' => $row['rating'],\n      'comment' => $row['comment']\n    );\n  }\n  $conn->close();\n  return $reviews;\n}\n\n// Function to get average rating for a product\nfunction get_average_rating($product_id) {\n  $conn = db_connect();\n  $sql = \"SELECT AVG(rating) FROM reviews WHERE product_id = ?\";\n  $stmt = $conn->prepare($sql);\n  $stmt->bind_param(\"i\", $product_id);\n  $stmt->execute();\n  $result = $stmt->get_result()->fetch_assoc();\n  $avg_rating = $result['AVG(rating)'] ?: 0;\n  $conn->close();\n  return $avg_rating;\n}\n\n// Example usage\n$product_id = 1;\n$user_id = 1;\n$rating = 4;\n$comment = 'This product is great!';\n\n$review_id = leave_review($product_id, $user_id, $rating, $comment);\nprint \"Review left with ID: $review_id\\n\";\n\n$reviews = get_reviews($product_id);\nprint_r($reviews);\n\n$avg_rating = get_average_rating($product_id);\nprint \"Average rating for product $product_id is: $avg_rating\\n\";\n```\nThis code defines four functions:\n\n* `db_connect()`: Establishes a connection to the database.\n* `leave_review()`: Leaves a new review in the database, including the product ID, user ID, rating, and comment.\n* `get_reviews()`: Retrieves all reviews for a given product ID.\n* `get_average_rating()`: Calculates the average rating for a given product ID.\n\nYou can modify this code to fit your specific needs, such as adding more features or error handling.", "code_blocks": [null, "```php\n<?php\n\n// Configuration\ndefine('DB_HOST', 'localhost');\ndefine('DB_NAME', 'reviews_db');\ndefine('DB_USER', 'username');\ndefine('DB_PASSWORD', 'password');\n\n// Function to connect to the database\nfunction db_connect() {\n  $conn = new mysqli(DB_HOST, DB_USER, DB_PASSWORD, DB_NAME);\n  if ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n  }\n  return $conn;\n}\n\n// Function to leave a review\nfunction leave_review($product_id, $user_id, $rating, $comment) {\n  $conn = db_connect();\n  $sql = \"INSERT INTO reviews (product_id, user_id, rating, comment)\n          VALUES (?, ?, ?, ?)\";\n  $stmt = $conn->prepare($sql);\n  $stmt->bind_param(\"iiss\", $product_id, $user_id, $rating, $comment);\n  $stmt->execute();\n  $review_id = $conn->insert_id;\n  $conn->close();\n  return $review_id;\n}\n\n// Function to get all reviews for a product\nfunction get_reviews($product_id) {\n  $conn = db_connect();\n  $sql = \"SELECT * FROM reviews WHERE product_id = ?\";\n  $stmt = $conn->prepare($sql);\n  $stmt->bind_param(\"i\", $product_id);\n  $stmt->execute();\n  $reviews = array();\n  while ($row = $stmt->get_result()->fetch_assoc()) {\n    $reviews[] = array(\n      'id' => $row['id'],\n      'rating' => $row['rating'],\n      'comment' => $row['comment']\n    );\n  }\n  $conn->close();\n  return $reviews;\n}\n\n// Function to get average rating for a product\nfunction get_average_rating($product_id) {\n  $conn = db_connect();\n  $sql = \"SELECT AVG(rating) FROM reviews WHERE product_id = ?\";\n  $stmt = $conn->prepare($sql);\n  $stmt->bind_param(\"i\", $product_id);\n  $stmt->execute();\n  $result = $stmt->get_result()->fetch_assoc();\n  $avg_rating = $result['AVG(rating)'] ?: 0;\n  $conn->close();\n  return $avg_rating;\n}\n\n// Example usage\n$product_id = 1;\n$user_id = 1;\n$rating = 4;\n$comment = 'This product is great!';\n\n$review_id = leave_review($product_id, $user_id, $rating, $comment);\nprint \"Review left with ID: $review_id\\n\";\n\n$reviews = get_reviews($product_id);\nprint_r($reviews);\n\n$avg_rating = get_average_rating($product_id);\nprint \"Average rating for product $product_id is: $avg_rating\\n\";\n```"]}
