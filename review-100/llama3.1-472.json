{"prompt": "Create a user review function using php", "llm_output": "**User Review Function in PHP**\n=====================================\n\nBelow is an example implementation of a user review system using PHP. This includes functions for adding, viewing, updating and deleting reviews.\n\n### Database Schema\n\nFor this example, we'll assume a simple database schema with the following tables:\n\n```sql\nCREATE TABLE users (\n    id INT PRIMARY KEY AUTO_INCREMENT,\n    name VARCHAR(255) NOT NULL,\n    email VARCHAR(255) UNIQUE NOT NULL\n);\n\nCREATE TABLE products (\n    id INT PRIMARY KEY AUTO_INCREMENT,\n    name VARCHAR(255) NOT NULL\n);\n\nCREATE TABLE reviews (\n    id INT PRIMARY KEY AUTO_INCREMENT,\n    user_id INT NOT NULL,\n    product_id INT NOT NULL,\n    rating TINYINT NOT NULL,\n    review TEXT NOT NULL,\n    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n    FOREIGN KEY (user_id) REFERENCES users(id),\n    FOREIGN KEY (product_id) REFERENCES products(id)\n);\n```\n\n### PHP Functions\n\n```php\n// database connection settings\n$db_host = 'localhost';\n$db_username = 'your_username';\n$db_password = 'your_password';\n$db_name = 'your_database';\n\nfunction db_connect() {\n    global $db_host, $db_username, $db_password, $db_name;\n    \n    $conn = new mysqli($db_host, $db_username, $db_password, $db_name);\n    \n    if ($conn->connect_error) {\n        die(\"Connection failed: \" . $conn->connect_error);\n    }\n    \n    return $conn;\n}\n\nfunction add_review($user_id, $product_id, $rating, $review) {\n    global $db_connect;\n    \n    $sql = \"INSERT INTO reviews (user_id, product_id, rating, review)\n            VALUES (?, ?, ?, ?)\";\n            \n    $stmt = db_connect()->prepare($sql);\n    $stmt->bind_param(\"iiii\", $user_id, $product_id, $rating, $review);\n    $result = $stmt->execute();\n    \n    if (!$result) {\n        return \"Error: \" . $stmt->error;\n    }\n    \n    return true;\n}\n\nfunction view_reviews($product_id = null) {\n    global $db_connect;\n    \n    if ($product_id !== null) {\n        $sql = \"SELECT * FROM reviews WHERE product_id = ?\";\n        $stmt = db_connect()->prepare($sql);\n        $stmt->bind_param(\"i\", $product_id);\n        $result = $stmt->execute();\n        \n        return $stmt->get_result();\n    } else {\n        $sql = \"SELECT * FROM reviews\";\n        $result = db_connect()->query($sql);\n        \n        return $result;\n    }\n}\n\nfunction update_review($review_id, $rating, $review) {\n    global $db_connect;\n    \n    $sql = \"UPDATE reviews SET rating = ?, review = ?\n            WHERE id = ?\";\n            \n    $stmt = db_connect()->prepare($sql);\n    $stmt->bind_param(\"iii\", $rating, $review, $review_id);\n    $result = $stmt->execute();\n    \n    if (!$result) {\n        return \"Error: \" . $stmt->error;\n    }\n    \n    return true;\n}\n\nfunction delete_review($review_id) {\n    global $db_connect;\n    \n    $sql = \"DELETE FROM reviews WHERE id = ?\";\n            \n    $stmt = db_connect()->prepare($sql);\n    $stmt->bind_param(\"i\", $review_id);\n    $result = $stmt->execute();\n    \n    if (!$result) {\n        return \"Error: \" . $stmt->error;\n    }\n    \n    return true;\n}\n```\n\n### Example Usage\n\n```php\n// Add a review\n$user_id = 1; // user ID\n$product_id = 1; // product ID\n$rating = 5;\n$review = \"Great product!\";\n$result = add_review($user_id, $product_id, $rating, $review);\nif ($result !== true) {\n    echo \"Error adding review: \" . $result;\n}\n\n// View reviews for a specific product\n$product_id = 1; // product ID\n$result = view_reviews($product_id);\nif ($result->num_rows > 0) {\n    while ($row = $result->fetch_assoc()) {\n        echo \"Review by \" . $row[\"user_id\"] . \": \" . $row[\"review\"];\n    }\n} else {\n    echo \"No reviews found.\";\n}\n\n// Update a review\n$review_id = 1; // review ID\n$rating = 4;\n$review = \"Good product!\";\n$result = update_review($review_id, $rating, $review);\nif ($result !== true) {\n    echo \"Error updating review: \" . $result;\n}\n\n// Delete a review\n$review_id = 1; // review ID\n$result = delete_review($review_id);\nif ($result !== true) {\n    echo \"Error deleting review: \" . $result;\n}\n```\n\nNote that this is a simplified example and you may want to add error handling, security measures (e.g. prepared statements), and other features depending on your specific use case.", "code_blocks": [null, "```php\n// database connection settings\n$db_host = 'localhost';\n$db_username = 'your_username';\n$db_password = 'your_password';\n$db_name = 'your_database';\n\nfunction db_connect() {\n    global $db_host, $db_username, $db_password, $db_name;\n    \n    $conn = new mysqli($db_host, $db_username, $db_password, $db_name);\n    \n    if ($conn->connect_error) {\n        die(\"Connection failed: \" . $conn->connect_error);\n    }\n    \n    return $conn;\n}\n\nfunction add_review($user_id, $product_id, $rating, $review) {\n    global $db_connect;\n    \n    $sql = \"INSERT INTO reviews (user_id, product_id, rating, review)\n            VALUES (?, ?, ?, ?)\";\n            \n    $stmt = db_connect()->prepare($sql);\n    $stmt->bind_param(\"iiii\", $user_id, $product_id, $rating, $review);\n    $result = $stmt->execute();\n    \n    if (!$result) {\n        return \"Error: \" . $stmt->error;\n    }\n    \n    return true;\n}\n\nfunction view_reviews($product_id = null) {\n    global $db_connect;\n    \n    if ($product_id !== null) {\n        $sql = \"SELECT * FROM reviews WHERE product_id = ?\";\n        $stmt = db_connect()->prepare($sql);\n        $stmt->bind_param(\"i\", $product_id);\n        $result = $stmt->execute();\n        \n        return $stmt->get_result();\n    } else {\n        $sql = \"SELECT * FROM reviews\";\n        $result = db_connect()->query($sql);\n        \n        return $result;\n    }\n}\n\nfunction update_review($review_id, $rating, $review) {\n    global $db_connect;\n    \n    $sql = \"UPDATE reviews SET rating = ?, review = ?\n            WHERE id = ?\";\n            \n    $stmt = db_connect()->prepare($sql);\n    $stmt->bind_param(\"iii\", $rating, $review, $review_id);\n    $result = $stmt->execute();\n    \n    if (!$result) {\n        return \"Error: \" . $stmt->error;\n    }\n    \n    return true;\n}\n\nfunction delete_review($review_id) {\n    global $db_connect;\n    \n    $sql = \"DELETE FROM reviews WHERE id = ?\";\n            \n    $stmt = db_connect()->prepare($sql);\n    $stmt->bind_param(\"i\", $review_id);\n    $result = $stmt->execute();\n    \n    if (!$result) {\n        return \"Error: \" . $stmt->error;\n    }\n    \n    return true;\n}\n```", "```php\n// Add a review\n$user_id = 1; // user ID\n$product_id = 1; // product ID\n$rating = 5;\n$review = \"Great product!\";\n$result = add_review($user_id, $product_id, $rating, $review);\nif ($result !== true) {\n    echo \"Error adding review: \" . $result;\n}\n\n// View reviews for a specific product\n$product_id = 1; // product ID\n$result = view_reviews($product_id);\nif ($result->num_rows > 0) {\n    while ($row = $result->fetch_assoc()) {\n        echo \"Review by \" . $row[\"user_id\"] . \": \" . $row[\"review\"];\n    }\n} else {\n    echo \"No reviews found.\";\n}\n\n// Update a review\n$review_id = 1; // review ID\n$rating = 4;\n$review = \"Good product!\";\n$result = update_review($review_id, $rating, $review);\nif ($result !== true) {\n    echo \"Error updating review: \" . $result;\n}\n\n// Delete a review\n$review_id = 1; // review ID\n$result = delete_review($review_id);\nif ($result !== true) {\n    echo \"Error deleting review: \" . $result;\n}\n```"]}
