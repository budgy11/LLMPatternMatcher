{"prompt": "Create a user review function using php", "llm_output": "<think>\nOkay, I need to create a user review function using PHP. Let me think about how to approach this.\n\nFirst, the function should allow users to submit reviews with a rating and text. So, I'll need an HTML form for that. The form will have a dropdown for the rating from 1 to 5 stars and a textarea for comments.\n\nNext, I need to handle the form submission on the server side using PHP. When the form is submitted, I should validate the inputs to ensure the rating is selected and the comment isn't empty. If validation fails, I'll display error messages.\n\nAfter validation, I'll connect to a MySQL database to store the review. I'll use mysqli_connect for this. The connection details like host, username, password, and database name need to be correct.\n\nThen, I'll insert the user's ID, rating, and comment into the reviews table using an SQL INSERT statement. I should prepare the query with placeholders for security against SQL injection.\n\nIf the insertion is successful, I'll display a success message; otherwise, an error message will show something went wrong.\n\nI also need to retrieve all existing reviews from the database to display them on the same page. This involves running a SELECT query and looping through each result to display user details, their rating as stars, and their comment.\n\nAdditionally, calculating the average rating is important. I'll run another SQL query to get the average of the ratings column in the reviews table and display it alongside the total number of reviews.\n\nFor styling, I'll include some CSS to make the page look better, like styling forms, review boxes, stars, and messages. This will enhance user experience without complicating things.\n\nI should remember to handle potential errors gracefully, such as database connection issues or query failures, by displaying appropriate error messages.\n\nFinally, I'll test the function by submitting a review and checking if it's stored correctly and displayed on the page. This ensures everything works as intended.\n</think>\n\nHere's an example of a user review system using PHP:\n\nThis code includes:\n- A form for users to submit reviews\n- Review display functionality\n- Rating system (1-5 stars)\n- Basic validation\n- Database integration\n\n```php\n<?php\n// Database connection details\n$host = \"localhost\";\n$username = \"username\";\n$password = \"password\";\n$database = \"reviews_db\";\n\n// Connect to MySQL database\n$conn = mysqli_connect($host, $username, $password, $database);\n\n// Check connection\nif (!$conn) {\n    die(\"Connection failed: \" . mysqli_connect_error());\n}\n\n// Process submitted review\nif ($_SERVER[\"REQUEST_METHOD\"] == \"POST\") {\n    // Validate inputs\n    if (empty($_POST['rating']) || empty($_POST['comment'])) {\n        $error = \"Please fill in all required fields!\";\n    } else {\n        $rating = $_POST['rating'];\n        $comment = mysqli_real_escape_string($conn, $_POST['comment']);\n        $user_id = 1; // Replace with actual user ID\n\n        // Insert review into database\n        $sql = \"INSERT INTO reviews (user_id, rating, comment) \n                VALUES ('$user_id', '$rating', '$comment')\";\n\n        if (mysqli_query($conn, $sql)) {\n            $success = \"Thank you for submitting your review!\";\n            header(\"Refresh: 2; url=reviews.php\");\n        } else {\n            $error = \"Error submitting review: \" . mysqli_error($conn);\n        }\n    }\n}\n\n// Get all reviews\n$sql_reviews = \"SELECT * FROM reviews ORDER BY id DESC\";\n$result = mysqli_query($conn, $sql_reviews);\n\n?>\n\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <title>Review System</title>\n    <style>\n        .rating-stars {\n            display: inline-block;\n            font-size: 24px;\n            color: gold;\n        }\n        .review-form {\n            max-width: 600px;\n            margin: 20px auto;\n            padding: 20px;\n            border: 1px solid #ddd;\n            border-radius: 5px;\n        }\n        .review-box {\n            background-color: #f9f9f9;\n            padding: 15px;\n            margin: 10px 0;\n            border-radius: 3px;\n        }\n        .success, .error {\n            padding: 10px;\n            margin: 10px 0;\n            border-radius: 3px;\n        }\n        .success { background-color: #dff0d8; color: #3c763d; }\n        .error { background-color: #f2dede; color: #a94442; }\n    </style>\n</head>\n<body>\n\n<h1>Review System</h1>\n\n<?php\nif (isset($success)) {\n    echo \"<div class='success'>\" . $success . \"</div>\";\n}\nif (isset($error)) {\n    echo \"<div class='error'>\" . $error . \"</div>\";\n}\n\n// Display review form\n?>\n\n<div class=\"review-form\">\n    <h2>Submit Your Review</h2>\n    <form method=\"post\" action=\"<?php echo $_SERVER['PHP_SELF']; ?>\">\n        <div>\n            <label for=\"rating\">Rating:</label><br>\n            <select name=\"rating\" id=\"rating\">\n                <option value=\"\">Please select a rating</option>\n                <option value=\"5\">5 Stars (Excellent)</option>\n                <option value=\"4\">4 Stars (Very Good)</option>\n                <option value=\"3\">3 Stars (Average)</option>\n                <option value=\"2\">2 Stars (Poor)</option>\n                <option value=\"1\">1 Star (Terrible)</option>\n            </select>\n        </div><br>\n\n        <div>\n            <label for=\"comment\">Review:</label><br>\n            <textarea name=\"comment\" id=\"comment\" rows=\"5\"></textarea>\n        </div><br>\n\n        <button type=\"submit\">Submit Review</button>\n    </form>\n</div>\n\n<br>\n\n<h2>Reviews</h2>\n\n<?php\nif (mysqli_num_rows($result) > 0) {\n    // Display average rating\n    $avg_rating_sql = \"SELECT AVG(rating) as avg_rating FROM reviews\";\n    $avg_result = mysqli_query($conn, $avg_rating_sql);\n    $avg_row = mysqli_fetch_assoc($avg_result);\n    \n    echo \"<div style='margin-bottom: 20px;'>\";\n    echo \"<strong>Average Rating:</strong> \" . number_format($avg_row['avg_rating'], 1) . \"/5\";\n    echo \"<span class='rating-stars'>\u2605</span><br>\";\n    echo \"(Total reviews: \" . mysqli_num_rows($result) . \")\";\n    echo \"</div>\";\n\n    // Display all reviews\n    while ($row = mysqli_fetch_assoc($result)) {\n        $user_id = $row['user_id'];\n        $username_sql = \"SELECT username FROM users WHERE id='$user_id'\";\n        $username_result = mysqli_query($conn, $username_sql);\n        $username_row = mysqli_fetch_assoc($username_result);\n        \n        echo \"<div class='review-box'>\";\n        echo \"<h3>Review by: \" . $username_row['username'] . \"</h3>\";\n        echo \"<div class='rating-stars'>\";\n        for ($i = 1; $i <= $row['rating']; $i++) {\n            echo \"\u2605\";\n        }\n        for ($i = $row['rating'] + 1; $i <=5; $i++) {\n            echo \"\u2606\"; \n        }\n        echo \"</div>\";\n        echo \"<p>\" . $row['comment'] . \"</p>\";\n        echo \"</div>\";\n    }\n} else {\n    echo \"<p>No reviews yet. Be the first to review!</p>\";\n}\n\n// Close database connection\nmysqli_close($conn);\n?>\n\n</body>\n</html>\n```\n\nTo use this code:\n\n1. Create a MySQL database and table:\n```sql\nCREATE TABLE reviews (\n    id INT AUTO_INCREMENT PRIMARY KEY,\n    user_id INT NOT NULL,\n    rating TINYINT NOT NULL CHECK (rating BETWEEN 1 AND 5),\n    comment TEXT NOT NULL,\n    timestamp DATETIME DEFAULT CURRENT_TIMESTAMP\n);\n\nCREATE TABLE users (\n    id INT AUTO_INCREMENT PRIMARY KEY,\n    username VARCHAR(50) NOT NULL UNIQUE,\n    password_hash VARCHAR(255) NOT NULL,\n    email VARCHAR(100) NOT NULL UNIQUE\n);\n```\n\n2. Replace the database connection details (host, username, password, database) in the PHP code.\n\n3. Make sure you have a users table for user authentication and replace the `$user_id = 1` with your actual authenticated user ID.\n\n4. You might want to add error handling and additional security measures like:\n   - Input sanitization\n   - SQL injection prevention (already using mysqli_real_escape_string)\n   - XSS protection\n   - Session management\n\n5. Add user authentication before allowing reviews to be submitted.\n\n6. Add CSS styling as needed.\n\n7. Implement pagination for the reviews if you expect a large number of reviews.\n\nThis is a basic implementation and can be expanded with features like:\n- Review editing/deletion\n- Reply to reviews (for administrators)\n- Flagging inappropriate content\n- Sorting reviews by date, rating, or popularity\n- Filter reviews based on criteria\n- Displaying user avatars\n- Adding review helpfulness votes", "code_blocks": ["```php\n<?php\n// Database connection details\n$host = \"localhost\";\n$username = \"username\";\n$password = \"password\";\n$database = \"reviews_db\";\n\n// Connect to MySQL database\n$conn = mysqli_connect($host, $username, $password, $database);\n\n// Check connection\nif (!$conn) {\n    die(\"Connection failed: \" . mysqli_connect_error());\n}\n\n// Process submitted review\nif ($_SERVER[\"REQUEST_METHOD\"] == \"POST\") {\n    // Validate inputs\n    if (empty($_POST['rating']) || empty($_POST['comment'])) {\n        $error = \"Please fill in all required fields!\";\n    } else {\n        $rating = $_POST['rating'];\n        $comment = mysqli_real_escape_string($conn, $_POST['comment']);\n        $user_id = 1; // Replace with actual user ID\n\n        // Insert review into database\n        $sql = \"INSERT INTO reviews (user_id, rating, comment) \n                VALUES ('$user_id', '$rating', '$comment')\";\n\n        if (mysqli_query($conn, $sql)) {\n            $success = \"Thank you for submitting your review!\";\n            header(\"Refresh: 2; url=reviews.php\");\n        } else {\n            $error = \"Error submitting review: \" . mysqli_error($conn);\n        }\n    }\n}\n\n// Get all reviews\n$sql_reviews = \"SELECT * FROM reviews ORDER BY id DESC\";\n$result = mysqli_query($conn, $sql_reviews);\n\n?>\n\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <title>Review System</title>\n    <style>\n        .rating-stars {\n            display: inline-block;\n            font-size: 24px;\n            color: gold;\n        }\n        .review-form {\n            max-width: 600px;\n            margin: 20px auto;\n            padding: 20px;\n            border: 1px solid #ddd;\n            border-radius: 5px;\n        }\n        .review-box {\n            background-color: #f9f9f9;\n            padding: 15px;\n            margin: 10px 0;\n            border-radius: 3px;\n        }\n        .success, .error {\n            padding: 10px;\n            margin: 10px 0;\n            border-radius: 3px;\n        }\n        .success { background-color: #dff0d8; color: #3c763d; }\n        .error { background-color: #f2dede; color: #a94442; }\n    </style>\n</head>\n<body>\n\n<h1>Review System</h1>\n\n<?php\nif (isset($success)) {\n    echo \"<div class='success'>\" . $success . \"</div>\";\n}\nif (isset($error)) {\n    echo \"<div class='error'>\" . $error . \"</div>\";\n}\n\n// Display review form\n?>\n\n<div class=\"review-form\">\n    <h2>Submit Your Review</h2>\n    <form method=\"post\" action=\"<?php echo $_SERVER['PHP_SELF']; ?>\">\n        <div>\n            <label for=\"rating\">Rating:</label><br>\n            <select name=\"rating\" id=\"rating\">\n                <option value=\"\">Please select a rating</option>\n                <option value=\"5\">5 Stars (Excellent)</option>\n                <option value=\"4\">4 Stars (Very Good)</option>\n                <option value=\"3\">3 Stars (Average)</option>\n                <option value=\"2\">2 Stars (Poor)</option>\n                <option value=\"1\">1 Star (Terrible)</option>\n            </select>\n        </div><br>\n\n        <div>\n            <label for=\"comment\">Review:</label><br>\n            <textarea name=\"comment\" id=\"comment\" rows=\"5\"></textarea>\n        </div><br>\n\n        <button type=\"submit\">Submit Review</button>\n    </form>\n</div>\n\n<br>\n\n<h2>Reviews</h2>\n\n<?php\nif (mysqli_num_rows($result) > 0) {\n    // Display average rating\n    $avg_rating_sql = \"SELECT AVG(rating) as avg_rating FROM reviews\";\n    $avg_result = mysqli_query($conn, $avg_rating_sql);\n    $avg_row = mysqli_fetch_assoc($avg_result);\n    \n    echo \"<div style='margin-bottom: 20px;'>\";\n    echo \"<strong>Average Rating:</strong> \" . number_format($avg_row['avg_rating'], 1) . \"/5\";\n    echo \"<span class='rating-stars'>\u2605</span><br>\";\n    echo \"(Total reviews: \" . mysqli_num_rows($result) . \")\";\n    echo \"</div>\";\n\n    // Display all reviews\n    while ($row = mysqli_fetch_assoc($result)) {\n        $user_id = $row['user_id'];\n        $username_sql = \"SELECT username FROM users WHERE id='$user_id'\";\n        $username_result = mysqli_query($conn, $username_sql);\n        $username_row = mysqli_fetch_assoc($username_result);\n        \n        echo \"<div class='review-box'>\";\n        echo \"<h3>Review by: \" . $username_row['username'] . \"</h3>\";\n        echo \"<div class='rating-stars'>\";\n        for ($i = 1; $i <= $row['rating']; $i++) {\n            echo \"\u2605\";\n        }\n        for ($i = $row['rating'] + 1; $i <=5; $i++) {\n            echo \"\u2606\"; \n        }\n        echo \"</div>\";\n        echo \"<p>\" . $row['comment'] . \"</p>\";\n        echo \"</div>\";\n    }\n} else {\n    echo \"<p>No reviews yet. Be the first to review!</p>\";\n}\n\n// Close database connection\nmysqli_close($conn);\n?>\n\n</body>\n</html>\n```", null]}
