{"prompt": "Create a user review function using php", "llm_output": "Here is an example of a simple \"review\" system that includes the following features:\n\n* Users can create reviews\n* Reviews are associated with a product\n* Each review has a rating (out of 5) and a text comment\n* The system keeps track of the average rating for each product\n\n**Database Schema**\n```sql\nCREATE TABLE users (\n  id INT PRIMARY KEY,\n  username VARCHAR(255),\n  email VARCHAR(255)\n);\n\nCREATE TABLE products (\n  id INT PRIMARY KEY,\n  name VARCHAR(255),\n  description TEXT\n);\n\nCREATE TABLE reviews (\n  id INT PRIMARY KEY,\n  user_id INT,\n  product_id INT,\n  rating INT CHECK (rating BETWEEN 1 AND 5),\n  comment TEXT,\n  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n  FOREIGN KEY (user_id) REFERENCES users(id),\n  FOREIGN KEY (product_id) REFERENCES products(id)\n);\n```\n\n**PHP Code**\n```php\n// Connect to the database\n$mysqli = new mysqli(\"localhost\", \"username\", \"password\", \"database\");\n\n// Function to get all reviews for a product\nfunction getReviews($productId, $userId = null) {\n  global $mysqli;\n  if ($userId !== null) {\n    // Get user's own reviews\n    $query = \"SELECT * FROM reviews WHERE product_id = ? AND user_id = ?\";\n    $stmt = $mysqli->prepare($query);\n    $stmt->bind_param(\"ii\", $productId, $userId);\n    $stmt->execute();\n  } else {\n    // Get all reviews for the product\n    $query = \"SELECT * FROM reviews WHERE product_id = ?\";\n    $stmt = $mysqli->prepare($query);\n    $stmt->bind_param(\"i\", $productId);\n    $stmt->execute();\n  }\n  return $stmt->get_result()->fetch_all(MYSQLI_ASSOC);\n}\n\n// Function to create a new review\nfunction createReview($product_id, $user_id, $rating, $comment) {\n  global $mysqli;\n  $query = \"INSERT INTO reviews (product_id, user_id, rating, comment) VALUES (?, ?, ?, ?)\";\n  $stmt = $mysqli->prepare($query);\n  $stmt->bind_param(\"iiss\", $product_id, $user_id, $rating, $comment);\n  return $stmt->execute();\n}\n\n// Function to update a product's average rating\nfunction updateProductRating($productId) {\n  global $mysqli;\n  $query = \"UPDATE products SET avg_rating = (SELECT AVG(rating) FROM reviews WHERE product_id = ?)\";\n  $stmt = $mysqli->prepare($query);\n  $stmt->bind_param(\"i\", $productId);\n  return $stmt->execute();\n}\n\n// Example usage\n$userId = 1; // user ID\n$productID = 1; // product ID\n\n// Get all reviews for the product\n$reviews = getReviews($productID, $userId);\nprint_r($reviews);\n\n// Create a new review\ncreateReview($productID, $userId, 4, \"Good product!\");\n\n// Update the product's average rating\nupdateProductRating($productID);\n```\n\nThis is a very basic implementation and doesn't include any validation or error checking. In a real-world application you would want to add those features.\n\nAlso, this example uses MySQLi for database interactions, but you could use PDO (PHP Data Objects) or other PHP extensions if needed.", "code_blocks": [null, "```php\n// Connect to the database\n$mysqli = new mysqli(\"localhost\", \"username\", \"password\", \"database\");\n\n// Function to get all reviews for a product\nfunction getReviews($productId, $userId = null) {\n  global $mysqli;\n  if ($userId !== null) {\n    // Get user's own reviews\n    $query = \"SELECT * FROM reviews WHERE product_id = ? AND user_id = ?\";\n    $stmt = $mysqli->prepare($query);\n    $stmt->bind_param(\"ii\", $productId, $userId);\n    $stmt->execute();\n  } else {\n    // Get all reviews for the product\n    $query = \"SELECT * FROM reviews WHERE product_id = ?\";\n    $stmt = $mysqli->prepare($query);\n    $stmt->bind_param(\"i\", $productId);\n    $stmt->execute();\n  }\n  return $stmt->get_result()->fetch_all(MYSQLI_ASSOC);\n}\n\n// Function to create a new review\nfunction createReview($product_id, $user_id, $rating, $comment) {\n  global $mysqli;\n  $query = \"INSERT INTO reviews (product_id, user_id, rating, comment) VALUES (?, ?, ?, ?)\";\n  $stmt = $mysqli->prepare($query);\n  $stmt->bind_param(\"iiss\", $product_id, $user_id, $rating, $comment);\n  return $stmt->execute();\n}\n\n// Function to update a product's average rating\nfunction updateProductRating($productId) {\n  global $mysqli;\n  $query = \"UPDATE products SET avg_rating = (SELECT AVG(rating) FROM reviews WHERE product_id = ?)\";\n  $stmt = $mysqli->prepare($query);\n  $stmt->bind_param(\"i\", $productId);\n  return $stmt->execute();\n}\n\n// Example usage\n$userId = 1; // user ID\n$productID = 1; // product ID\n\n// Get all reviews for the product\n$reviews = getReviews($productID, $userId);\nprint_r($reviews);\n\n// Create a new review\ncreateReview($productID, $userId, 4, \"Good product!\");\n\n// Update the product's average rating\nupdateProductRating($productID);\n```"]}
