{"prompt": "Create a user review function using php", "llm_output": "<think>\nAlright, the user wants to create a user review function using PHP. I need to figure out what that entails. \n\nFirst, I should consider the main components of such a system. Reviews typically involve users leaving feedback on products or services, so I'll need a way for users to submit their reviews. That means creating a form where they can input their name, email, rating, and comments.\n\nNext, I have to store these reviews somewhere. Using a database makes sense because it allows easy retrieval and management. So, I'll set up a MySQL table with fields like review_id, product_id, user_name, user_email, rating, comment, and timestamp.\n\nNow, handling the form submission is crucial. I'll need to write PHP code that takes the input from the form and inserts it into the database. But I should also make sure to sanitize the inputs to prevent SQL injection and other security issues. Maybe using prepared statements with mysqli would be a good approach here.\n\nDisplaying the reviews is another important part. Users will want to see what others have said. So, I'll create a function that fetches all reviews from the database for a specific product and displays them on the webpage. This function should also calculate the average rating to show an overall score.\n\nI should also think about user experience. Allowing users to rate using stars would be more intuitive than a numeric input. So, in the form, I'll include radio buttons with star representations for each rating level.\n\nSecurity is a big concern. I need to protect against SQL injection by sanitizing inputs and possibly using prepared statements. Also, ensuring that only authenticated users can leave reviews might be necessary, but since the user didn't specify, I'll note it as an optional step.\n\nValidation of the form inputs is essential too. Checking if all required fields are filled and that the email format is correct will help maintain data integrity.\n\nI should structure the code into functions for better organization. Functions like display_review_form(), submit_review(), and display_reviews() can handle different parts of the process, making the code easier to manage.\n\nTesting each part step by step is important. I'll make sure that submitting a review correctly adds it to the database and that displaying reviews shows all entries without errors. Also, checking that the average rating calculation works as expected.\n\nFinally, providing clear instructions on how to use the functions and integrate them into a web page will help the user implement the system effectively. Including notes on security practices and possible extensions, like allowing only registered users or handling deletions, adds value for someone looking to expand the functionality later.\n</think>\n\nHere's an example of a user review function using PHP. This code includes a form for submitting reviews and displays existing reviews from a MySQL database:\n\n```php\n<?php\n// Database connection details\n$host = 'localhost';\n$username = 'root';\n$password = '';\n$database = 'reviews_db';\n\n// Connect to MySQL database\n$conn = mysqli_connect($host, $username, $password, $database);\n\n// Check connection\nif (!$conn) {\n    die(\"Connection failed: \" . mysqli_connect_error());\n}\n\n// Function to submit a new review\nfunction submit_review($product_id, $user_name, $user_email, $rating, $comment) {\n    global $conn;\n\n    // Sanitize input data\n    $product_id = mysqli_real_escape_string($conn, $product_id);\n    $user_name = mysqli_real_escape_string($conn, $user_name);\n    $user_email = mysqli_real_escape_string($conn, $user_email);\n    $rating = intval($rating);\n    $comment = mysqli_real_escape_string($conn, $comment);\n\n    // Insert review into database\n    $sql = \"INSERT INTO reviews (product_id, user_name, user_email, rating, comment) \n            VALUES ('$product_id', '$user_name', '$user_email', '$rating', '$comment')\";\n    \n    if (mysqli_query($conn, $sql)) {\n        return true;\n    } else {\n        return false;\n    }\n}\n\n// Function to display reviews for a product\nfunction display_reviews($product_id) {\n    global $conn;\n\n    // Get all reviews for this product\n    $sql = \"SELECT * FROM reviews WHERE product_id = '$product_id' ORDER BY review_date DESC\";\n    $result = mysqli_query($conn, $sql);\n\n    if (mysqli_num_rows($result) > 0) {\n        // Calculate average rating\n        $total_rating = 0;\n        while ($row = mysqli_fetch_assoc($result)) {\n            $total_rating += $row['rating'];\n        }\n        $average_rating = number_format(($total_rating / mysqli_num_rows($result)), 1, '.', '');\n\n        echo \"<div class='reviews'>\";\n        echo \"<h3>Product Reviews</h3>\";\n        echo \"<p>Average Rating: $average_rating stars</p>\";\n\n        // Reset result pointer to display reviews\n        mysqli_data_seek($result, 0);\n\n        while ($row = mysqli_fetch_assoc($result)) {\n            $user_name = $row['user_name'];\n            $rating = $row['rating'];\n            $comment = $row['comment'];\n            $date = date('F j, Y', strtotime($row['review_date']));\n\n            echo \"<div class='review'>\";\n            echo \"<h4>$user_name</h4>\";\n            echo \"<p>Rating: $rating stars</p>\";\n            echo \"<p>$comment</p>\";\n            echo \"<small>Posted on $date</small>\";\n            echo \"</div>\";\n        }\n        echo \"</div>\";\n    } else {\n        echo \"No reviews available for this product.\";\n    }\n}\n\n// Function to display review form\nfunction display_review_form($product_id) {\n    echo \"<form method='post' action='submit_review.php'>\";\n    echo \"<input type='hidden' name='product_id' value='$product_id'>\";\n    echo \"<div class='form-group'>\";\n    echo \"<label for='user_name'>Name:</label>\";\n    echo \"<input type='text' id='user_name' name='user_name' required>\";\n    echo \"</div>\";\n    \n    echo \"<div class='form-group'>\";\n    echo \"<label for='user_email'>Email:</label>\";\n    echo \"<input type='email' id='user_email' name='user_email' required>\";\n    echo \"</div>\";\n    \n    echo \"<div class='form-group'>\";\n    echo \"<label for='rating'>Rating:</label><br>\";\n    echo \"<input type='radio' name='rating' value='5' required> 5 stars<br>\";\n    echo \"<input type='radio' name='rating' value='4'> 4 stars<br>\";\n    echo \"<input type='radio' name='rating' value='3'> 3 stars<br>\";\n    echo \"<input type='radio' name='rating' value='2'> 2 stars<br>\";\n    echo \"<input type='radio' name='rating' value='1'> 1 star\";\n    echo \"</div>\";\n    \n    echo \"<div class='form-group'>\";\n    echo \"<label for='comment'>Comment:</label>\";\n    echo \"<textarea id='comment' name='comment' rows='5' required></textarea>\";\n    echo \"</div>\";\n    \n    echo \"<button type='submit' name='submit_review'>Submit Review</button>\";\n    echo \"</form>\";\n}\n\n// Close database connection\nmysqli_close($conn);\n?>\n\n```\n\nThis code provides:\n\n1. A database connection setup\n2. Functions to:\n   - Submit a new review\n   - Display existing reviews for a product\n   - Display the review form\n\nTo use this code, you'll need to:\n\n1. Create a MySQL database and table named 'reviews' with the following structure:\n```sql\nCREATE TABLE reviews (\n    review_id INT AUTO_INCREMENT PRIMARY KEY,\n    product_id INT NOT NULL,\n    user_name VARCHAR(255) NOT NULL,\n    user_email VARCHAR(255) NOT NULL,\n    rating INT NOT NULL,\n    comment TEXT NOT NULL,\n    review_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n);\n```\n\n2. Replace the database connection details (host, username, password, and database name)\n\n3. Include this file in your PHP project\n\n4. Use the functions as follows:\n\nTo display the review form for a product:\n```php\ndisplay_review_form($product_id);\n```\n\nTo display existing reviews for a product:\n```php\ndisplay_reviews($product_id);\n```\n\nThe code includes basic security measures like input sanitization and SQL injection prevention, but you might want to add additional security features depending on your specific needs.\n\nYou can also customize the output by modifying the HTML structure in the `display_review_form()` and `display_reviews()` functions.", "code_blocks": ["```php\n<?php\n// Database connection details\n$host = 'localhost';\n$username = 'root';\n$password = '';\n$database = 'reviews_db';\n\n// Connect to MySQL database\n$conn = mysqli_connect($host, $username, $password, $database);\n\n// Check connection\nif (!$conn) {\n    die(\"Connection failed: \" . mysqli_connect_error());\n}\n\n// Function to submit a new review\nfunction submit_review($product_id, $user_name, $user_email, $rating, $comment) {\n    global $conn;\n\n    // Sanitize input data\n    $product_id = mysqli_real_escape_string($conn, $product_id);\n    $user_name = mysqli_real_escape_string($conn, $user_name);\n    $user_email = mysqli_real_escape_string($conn, $user_email);\n    $rating = intval($rating);\n    $comment = mysqli_real_escape_string($conn, $comment);\n\n    // Insert review into database\n    $sql = \"INSERT INTO reviews (product_id, user_name, user_email, rating, comment) \n            VALUES ('$product_id', '$user_name', '$user_email', '$rating', '$comment')\";\n    \n    if (mysqli_query($conn, $sql)) {\n        return true;\n    } else {\n        return false;\n    }\n}\n\n// Function to display reviews for a product\nfunction display_reviews($product_id) {\n    global $conn;\n\n    // Get all reviews for this product\n    $sql = \"SELECT * FROM reviews WHERE product_id = '$product_id' ORDER BY review_date DESC\";\n    $result = mysqli_query($conn, $sql);\n\n    if (mysqli_num_rows($result) > 0) {\n        // Calculate average rating\n        $total_rating = 0;\n        while ($row = mysqli_fetch_assoc($result)) {\n            $total_rating += $row['rating'];\n        }\n        $average_rating = number_format(($total_rating / mysqli_num_rows($result)), 1, '.', '');\n\n        echo \"<div class='reviews'>\";\n        echo \"<h3>Product Reviews</h3>\";\n        echo \"<p>Average Rating: $average_rating stars</p>\";\n\n        // Reset result pointer to display reviews\n        mysqli_data_seek($result, 0);\n\n        while ($row = mysqli_fetch_assoc($result)) {\n            $user_name = $row['user_name'];\n            $rating = $row['rating'];\n            $comment = $row['comment'];\n            $date = date('F j, Y', strtotime($row['review_date']));\n\n            echo \"<div class='review'>\";\n            echo \"<h4>$user_name</h4>\";\n            echo \"<p>Rating: $rating stars</p>\";\n            echo \"<p>$comment</p>\";\n            echo \"<small>Posted on $date</small>\";\n            echo \"</div>\";\n        }\n        echo \"</div>\";\n    } else {\n        echo \"No reviews available for this product.\";\n    }\n}\n\n// Function to display review form\nfunction display_review_form($product_id) {\n    echo \"<form method='post' action='submit_review.php'>\";\n    echo \"<input type='hidden' name='product_id' value='$product_id'>\";\n    echo \"<div class='form-group'>\";\n    echo \"<label for='user_name'>Name:</label>\";\n    echo \"<input type='text' id='user_name' name='user_name' required>\";\n    echo \"</div>\";\n    \n    echo \"<div class='form-group'>\";\n    echo \"<label for='user_email'>Email:</label>\";\n    echo \"<input type='email' id='user_email' name='user_email' required>\";\n    echo \"</div>\";\n    \n    echo \"<div class='form-group'>\";\n    echo \"<label for='rating'>Rating:</label><br>\";\n    echo \"<input type='radio' name='rating' value='5' required> 5 stars<br>\";\n    echo \"<input type='radio' name='rating' value='4'> 4 stars<br>\";\n    echo \"<input type='radio' name='rating' value='3'> 3 stars<br>\";\n    echo \"<input type='radio' name='rating' value='2'> 2 stars<br>\";\n    echo \"<input type='radio' name='rating' value='1'> 1 star\";\n    echo \"</div>\";\n    \n    echo \"<div class='form-group'>\";\n    echo \"<label for='comment'>Comment:</label>\";\n    echo \"<textarea id='comment' name='comment' rows='5' required></textarea>\";\n    echo \"</div>\";\n    \n    echo \"<button type='submit' name='submit_review'>Submit Review</button>\";\n    echo \"</form>\";\n}\n\n// Close database connection\nmysqli_close($conn);\n?>\n\n```", null, "```php\ndisplay_review_form($product_id);\n```", "```php\ndisplay_reviews($product_id);\n```"]}
