{"prompt": "Create a user review function using php", "llm_output": "Here is an example of a simple user review function in PHP:\n\n**Function:** `addReview($product_id, $rating, $review_text)`\n\nThis function will add a new review for the specified product.\n\n```php\nfunction addReview($product_id, $rating, $review_text) {\n    // Check if the user is logged in\n    if (!isset($_SESSION['user_id'])) {\n        echo \"You must be logged in to leave a review.\";\n        return;\n    }\n\n    // Connect to the database\n    $db = connectToDatabase();\n\n    // Insert the new review into the reviews table\n    $query = \"INSERT INTO reviews (product_id, user_id, rating, review_text) VALUES ('$product_id', '\" . $_SESSION['user_id'] . \"', '$rating', '$review_text')\";\n    $result = mysqli_query($db, $query);\n\n    // Check if the review was added successfully\n    if (!$result) {\n        echo \"Error adding review: \" . mysqli_error($db);\n        return;\n    }\n\n    // Close the database connection\n    mysqli_close($db);\n\n    // Update the average rating for the product\n    updateAverageRating($product_id);\n\n    // Redirect the user to the product page\n    header(\"Location: /products/$product_id\");\n}\n```\n\n**Function:** `getReviews($product_id, $limit = 10)`\n\nThis function will retrieve a list of reviews for the specified product.\n\n```php\nfunction getReviews($product_id, $limit = 10) {\n    // Connect to the database\n    $db = connectToDatabase();\n\n    // Select all reviews from the reviews table where product_id matches the given ID\n    $query = \"SELECT * FROM reviews WHERE product_id = '$product_id' ORDER BY id DESC LIMIT $limit\";\n    $result = mysqli_query($db, $query);\n\n    // Fetch and store each review in an array\n    $reviews = array();\n    while ($row = mysqli_fetch_assoc($result)) {\n        $reviews[] = array(\n            'id' => $row['id'],\n            'rating' => $row['rating'],\n            'review_text' => $row['review_text']\n        );\n    }\n\n    // Close the database connection\n    mysqli_close($db);\n\n    // Return the list of reviews\n    return $reviews;\n}\n```\n\n**Function:** `updateAverageRating($product_id)`\n\nThis function will update the average rating for the specified product.\n\n```php\nfunction updateAverageRating($product_id) {\n    // Connect to the database\n    $db = connectToDatabase();\n\n    // Calculate the sum of all ratings for the product\n    $query = \"SELECT SUM(rating) as total FROM reviews WHERE product_id = '$product_id'\";\n    $result = mysqli_query($db, $query);\n    $row = mysqli_fetch_assoc($result);\n    $total_rating = $row['total'];\n\n    // Calculate the average rating by dividing the sum of ratings by the number of reviews\n    $num_reviews = count(getReviews($product_id));\n    if ($num_reviews > 0) {\n        $average_rating = $total_rating / $num_reviews;\n    } else {\n        $average_rating = 0;\n    }\n\n    // Update the average rating in the products table\n    $query = \"UPDATE products SET average_rating = '$average_rating' WHERE id = '$product_id'\";\n    mysqli_query($db, $query);\n\n    // Close the database connection\n    mysqli_close($db);\n}\n```\n\n**Example usage:**\n\n```php\n// Add a new review for product 123 with rating 5 and review text \"This is a great product!\"\naddReview(123, 5, 'This is a great product!');\n\n// Get all reviews for product 123\n$reviews = getReviews(123);\n\n// Update the average rating for product 123\nupdateAverageRating(123);\n```\n\nNote that this is just an example and you should adjust it to fit your specific needs. Also, this code assumes that you are using MySQL as your database management system and PHP's built-in `mysqli` extension to interact with the database.", "code_blocks": ["```php\nfunction addReview($product_id, $rating, $review_text) {\n    // Check if the user is logged in\n    if (!isset($_SESSION['user_id'])) {\n        echo \"You must be logged in to leave a review.\";\n        return;\n    }\n\n    // Connect to the database\n    $db = connectToDatabase();\n\n    // Insert the new review into the reviews table\n    $query = \"INSERT INTO reviews (product_id, user_id, rating, review_text) VALUES ('$product_id', '\" . $_SESSION['user_id'] . \"', '$rating', '$review_text')\";\n    $result = mysqli_query($db, $query);\n\n    // Check if the review was added successfully\n    if (!$result) {\n        echo \"Error adding review: \" . mysqli_error($db);\n        return;\n    }\n\n    // Close the database connection\n    mysqli_close($db);\n\n    // Update the average rating for the product\n    updateAverageRating($product_id);\n\n    // Redirect the user to the product page\n    header(\"Location: /products/$product_id\");\n}\n```", "```php\nfunction getReviews($product_id, $limit = 10) {\n    // Connect to the database\n    $db = connectToDatabase();\n\n    // Select all reviews from the reviews table where product_id matches the given ID\n    $query = \"SELECT * FROM reviews WHERE product_id = '$product_id' ORDER BY id DESC LIMIT $limit\";\n    $result = mysqli_query($db, $query);\n\n    // Fetch and store each review in an array\n    $reviews = array();\n    while ($row = mysqli_fetch_assoc($result)) {\n        $reviews[] = array(\n            'id' => $row['id'],\n            'rating' => $row['rating'],\n            'review_text' => $row['review_text']\n        );\n    }\n\n    // Close the database connection\n    mysqli_close($db);\n\n    // Return the list of reviews\n    return $reviews;\n}\n```", "```php\nfunction updateAverageRating($product_id) {\n    // Connect to the database\n    $db = connectToDatabase();\n\n    // Calculate the sum of all ratings for the product\n    $query = \"SELECT SUM(rating) as total FROM reviews WHERE product_id = '$product_id'\";\n    $result = mysqli_query($db, $query);\n    $row = mysqli_fetch_assoc($result);\n    $total_rating = $row['total'];\n\n    // Calculate the average rating by dividing the sum of ratings by the number of reviews\n    $num_reviews = count(getReviews($product_id));\n    if ($num_reviews > 0) {\n        $average_rating = $total_rating / $num_reviews;\n    } else {\n        $average_rating = 0;\n    }\n\n    // Update the average rating in the products table\n    $query = \"UPDATE products SET average_rating = '$average_rating' WHERE id = '$product_id'\";\n    mysqli_query($db, $query);\n\n    // Close the database connection\n    mysqli_close($db);\n}\n```", "```php\n// Add a new review for product 123 with rating 5 and review text \"This is a great product!\"\naddReview(123, 5, 'This is a great product!');\n\n// Get all reviews for product 123\n$reviews = getReviews(123);\n\n// Update the average rating for product 123\nupdateAverageRating(123);\n```"]}
