{"prompt": "Create a user review function using php", "llm_output": "Here's an example of a simple user review system written in PHP. This system includes the following features:\n\n* Users can create reviews\n* Reviews are associated with a particular product or item\n* Each review has a rating (out of 5) and text\n* Users can edit their own reviews\n* Users can delete their own reviews\n\nThis example uses a MySQL database to store data. You will need to modify the connection settings and table structure to match your specific needs.\n\n**Database Structure**\n\nCreate a database with the following tables:\n\n```sql\nCREATE TABLE users (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  name VARCHAR(255),\n  email VARCHAR(255)\n);\n\nCREATE TABLE products (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  name VARCHAR(255),\n  description TEXT\n);\n\nCREATE TABLE reviews (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  user_id INT,\n  product_id INT,\n  rating TINYINT,\n  text TEXT,\n  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n  FOREIGN KEY (user_id) REFERENCES users(id),\n  FOREIGN KEY (product_id) REFERENCES products(id)\n);\n```\n\n**PHP Code**\n\nCreate a new PHP file called `review.php` and add the following code:\n\n```php\n<?php\n\n// Database connection settings\n$host = 'localhost';\n$dbname = 'reviews';\n$username = 'your_username';\n$password = 'your_password';\n\n// Connect to database\n$conn = new PDO(\"mysql:host=$host;dbname=$dbname\", $username, $password);\n\n// Function to display reviews for a product\nfunction displayReviews($product_id) {\n  global $conn;\n  \n  $stmt = $conn->prepare('SELECT * FROM reviews WHERE product_id = ?');\n  $stmt->execute([$product_id]);\n  \n  $reviews = $stmt->fetchAll();\n  \n  foreach ($reviews as $review) {\n    echo '<p>Rating: ' . $review['rating'] . '/5</p>';\n    echo '<p>' . $review['text'] . '</p>';\n    echo '<p>Created by ' . getUserName($review['user_id']) . '</p>';\n  }\n}\n\n// Function to display user's own reviews\nfunction displayUserReviews($user_id) {\n  global $conn;\n  \n  $stmt = $conn->prepare('SELECT * FROM reviews WHERE user_id = ?');\n  $stmt->execute([$user_id]);\n  \n  $reviews = $stmt->fetchAll();\n  \n  foreach ($reviews as $review) {\n    echo '<p>Rating: ' . $review['rating'] . '/5</p>';\n    echo '<p>' . $review['text'] . '</p>';\n    echo '<p>Created for product ' . getProductNames($review['product_id']) . '</p>';\n  }\n}\n\n// Function to create a new review\nfunction createReview() {\n  global $conn;\n  \n  if (isset($_POST['create-review'])) {\n    $user_id = $_SESSION['id'];\n    $product_id = $_POST['product_id'];\n    $rating = $_POST['rating'];\n    $text = $_POST['text'];\n    \n    $stmt = $conn->prepare('INSERT INTO reviews (user_id, product_id, rating, text) VALUES (?, ?, ?, ?)');\n    $stmt->execute([$user_id, $product_id, $rating, $text]);\n    \n    header('Location: index.php');\n  }\n}\n\n// Function to edit a review\nfunction editReview() {\n  global $conn;\n  \n  if (isset($_POST['edit-review'])) {\n    $review_id = $_POST['review_id'];\n    $new_rating = $_POST['rating'];\n    $new_text = $_POST['text'];\n    \n    $stmt = $conn->prepare('UPDATE reviews SET rating = ?, text = ? WHERE id = ?');\n    $stmt->execute([$new_rating, $new_text, $review_id]);\n  }\n}\n\n// Function to delete a review\nfunction deleteReview() {\n  global $conn;\n  \n  if (isset($_POST['delete-review'])) {\n    $review_id = $_POST['review_id'];\n    \n    $stmt = $conn->prepare('DELETE FROM reviews WHERE id = ?');\n    $stmt->execute([$review_id]);\n  }\n}\n\n// Function to get the name of a user\nfunction getUserName($user_id) {\n  global $conn;\n  \n  $stmt = $conn->prepare('SELECT * FROM users WHERE id = ?');\n  $stmt->execute([$user_id]);\n  \n  return $stmt->fetch()['name'];\n}\n\n// Function to get the name(s) of a product\nfunction getProductNames($product_id) {\n  global $conn;\n  \n  $stmt = $conn->prepare('SELECT name FROM products WHERE id = ?');\n  $stmt->execute([$product_id]);\n  \n  return $stmt->fetch()['name'];\n}\n\n?>\n```\n\nThis code assumes that you have already set up a session to store the user's ID, and that you are using a framework like PHP-FPM or Apache with mod_php.\n\nYou can use the following functions in your `index.php` file:\n\n```php\n// Display reviews for a product\ndisplayReviews(1);\n\n// Display user's own reviews\ndisplayUserReviews($_SESSION['id']);\n\n// Create a new review\ncreateReview();\n\n// Edit a review\neditReview();\n\n// Delete a review\ndeleteReview();\n```\n\nYou will also need to create a form in `index.php` that allows users to submit reviews, edit their existing reviews, and delete reviews.\n\nNote: This is just a basic example. You should add error checking, validation, and security measures as needed to protect your database from malicious input.", "code_blocks": [null, "```php\n<?php\n\n// Database connection settings\n$host = 'localhost';\n$dbname = 'reviews';\n$username = 'your_username';\n$password = 'your_password';\n\n// Connect to database\n$conn = new PDO(\"mysql:host=$host;dbname=$dbname\", $username, $password);\n\n// Function to display reviews for a product\nfunction displayReviews($product_id) {\n  global $conn;\n  \n  $stmt = $conn->prepare('SELECT * FROM reviews WHERE product_id = ?');\n  $stmt->execute([$product_id]);\n  \n  $reviews = $stmt->fetchAll();\n  \n  foreach ($reviews as $review) {\n    echo '<p>Rating: ' . $review['rating'] . '/5</p>';\n    echo '<p>' . $review['text'] . '</p>';\n    echo '<p>Created by ' . getUserName($review['user_id']) . '</p>';\n  }\n}\n\n// Function to display user's own reviews\nfunction displayUserReviews($user_id) {\n  global $conn;\n  \n  $stmt = $conn->prepare('SELECT * FROM reviews WHERE user_id = ?');\n  $stmt->execute([$user_id]);\n  \n  $reviews = $stmt->fetchAll();\n  \n  foreach ($reviews as $review) {\n    echo '<p>Rating: ' . $review['rating'] . '/5</p>';\n    echo '<p>' . $review['text'] . '</p>';\n    echo '<p>Created for product ' . getProductNames($review['product_id']) . '</p>';\n  }\n}\n\n// Function to create a new review\nfunction createReview() {\n  global $conn;\n  \n  if (isset($_POST['create-review'])) {\n    $user_id = $_SESSION['id'];\n    $product_id = $_POST['product_id'];\n    $rating = $_POST['rating'];\n    $text = $_POST['text'];\n    \n    $stmt = $conn->prepare('INSERT INTO reviews (user_id, product_id, rating, text) VALUES (?, ?, ?, ?)');\n    $stmt->execute([$user_id, $product_id, $rating, $text]);\n    \n    header('Location: index.php');\n  }\n}\n\n// Function to edit a review\nfunction editReview() {\n  global $conn;\n  \n  if (isset($_POST['edit-review'])) {\n    $review_id = $_POST['review_id'];\n    $new_rating = $_POST['rating'];\n    $new_text = $_POST['text'];\n    \n    $stmt = $conn->prepare('UPDATE reviews SET rating = ?, text = ? WHERE id = ?');\n    $stmt->execute([$new_rating, $new_text, $review_id]);\n  }\n}\n\n// Function to delete a review\nfunction deleteReview() {\n  global $conn;\n  \n  if (isset($_POST['delete-review'])) {\n    $review_id = $_POST['review_id'];\n    \n    $stmt = $conn->prepare('DELETE FROM reviews WHERE id = ?');\n    $stmt->execute([$review_id]);\n  }\n}\n\n// Function to get the name of a user\nfunction getUserName($user_id) {\n  global $conn;\n  \n  $stmt = $conn->prepare('SELECT * FROM users WHERE id = ?');\n  $stmt->execute([$user_id]);\n  \n  return $stmt->fetch()['name'];\n}\n\n// Function to get the name(s) of a product\nfunction getProductNames($product_id) {\n  global $conn;\n  \n  $stmt = $conn->prepare('SELECT name FROM products WHERE id = ?');\n  $stmt->execute([$product_id]);\n  \n  return $stmt->fetch()['name'];\n}\n\n?>\n```", "```php\n// Display reviews for a product\ndisplayReviews(1);\n\n// Display user's own reviews\ndisplayUserReviews($_SESSION['id']);\n\n// Create a new review\ncreateReview();\n\n// Edit a review\neditReview();\n\n// Delete a review\ndeleteReview();\n```"]}
