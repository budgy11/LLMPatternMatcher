{"prompt": "Create a user review function using php", "llm_output": "Here's an example of how you can create a simple user review system in PHP:\n\n**Database schema**\n\nWe'll assume that we have two tables: `users` and `reviews`. The `users` table has the following columns:\n\n* `id` (primary key)\n* `name`\n* `email`\n\nThe `reviews` table has the following columns:\n\n* `id` (primary key)\n* `user_id` (foreign key referencing the `users` table)\n* `product_name`\n* `review_text`\n* `rating` (an integer between 1 and 5)\n\n**PHP code**\n\n```php\n<?php\n\n// Connect to database (replace with your own connection method)\n$conn = new mysqli(\"localhost\", \"username\", \"password\", \"database\");\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\nfunction addReview($data) {\n    global $conn;\n    \n    // Insert review into database\n    $sql = \"INSERT INTO reviews (user_id, product_name, review_text, rating)\n            VALUES (?, ?, ?, ?)\";\n    $stmt = $conn->prepare($sql);\n    $stmt->bind_param(\"isss\", $data['user_id'], $data['product_name'], $data['review_text'], $data['rating']);\n    if ($stmt->execute()) {\n        return true;\n    } else {\n        return false;\n    }\n}\n\nfunction getReviews() {\n    global $conn;\n    \n    // Retrieve reviews from database\n    $sql = \"SELECT * FROM reviews\";\n    $result = $conn->query($sql);\n    $reviews = array();\n    while ($row = $result->fetch_assoc()) {\n        $reviews[] = array(\n            'id' => $row['id'],\n            'user_id' => $row['user_id'],\n            'product_name' => $row['product_name'],\n            'review_text' => $row['review_text'],\n            'rating' => $row['rating']\n        );\n    }\n    return $reviews;\n}\n\nfunction getUserReviews($userId) {\n    global $conn;\n    \n    // Retrieve reviews from database for a specific user\n    $sql = \"SELECT * FROM reviews WHERE user_id = ?\";\n    $stmt = $conn->prepare($sql);\n    $stmt->bind_param(\"i\", $userId);\n    if ($stmt->execute()) {\n        $result = $stmt->get_result();\n        $reviews = array();\n        while ($row = $result->fetch_assoc()) {\n            $reviews[] = array(\n                'id' => $row['id'],\n                'product_name' => $row['product_name'],\n                'review_text' => $row['review_text'],\n                'rating' => $row['rating']\n            );\n        }\n        return $reviews;\n    } else {\n        return false;\n    }\n}\n\nfunction getAverageRating($userId) {\n    global $conn;\n    \n    // Retrieve average rating for a specific user\n    $sql = \"SELECT AVG(rating) AS avg_rating FROM reviews WHERE user_id = ?\";\n    $stmt = $conn->prepare($sql);\n    $stmt->bind_param(\"i\", $userId);\n    if ($stmt->execute()) {\n        $result = $stmt->get_result();\n        $row = $result->fetch_assoc();\n        return $row['avg_rating'];\n    } else {\n        return false;\n    }\n}\n\n// Example usage:\n$data = array(\n    'user_id' => 1,\n    'product_name' => 'Product X',\n    'review_text' => 'This product is great!',\n    'rating' => 5\n);\naddReview($data);\n\n$reviews = getReviews();\nprint_r($reviews);\n\n$userReviews = getUserReviews(1);\nprint_r($userReviews);\n\n$averageRating = getAverageRating(1);\necho $averageRating;\n\n?>\n```\n\n**Explanation**\n\nThis code includes four functions:\n\n* `addReview`: Inserts a new review into the database.\n* `getReviews`: Retrieves all reviews from the database.\n* `getUserReviews`: Retrieves reviews for a specific user.\n* `getAverageRating`: Calculates the average rating for a specific user.\n\nNote that this is just a simple example, and you should consider implementing additional security measures (e.g. input validation, sanitization) to prevent SQL injection attacks.\n\nAlso, please replace `\"localhost\"`, `\"username\"`, `\"password\"`, and `\"database\"` with your actual database connection details.", "code_blocks": ["```php\n<?php\n\n// Connect to database (replace with your own connection method)\n$conn = new mysqli(\"localhost\", \"username\", \"password\", \"database\");\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\nfunction addReview($data) {\n    global $conn;\n    \n    // Insert review into database\n    $sql = \"INSERT INTO reviews (user_id, product_name, review_text, rating)\n            VALUES (?, ?, ?, ?)\";\n    $stmt = $conn->prepare($sql);\n    $stmt->bind_param(\"isss\", $data['user_id'], $data['product_name'], $data['review_text'], $data['rating']);\n    if ($stmt->execute()) {\n        return true;\n    } else {\n        return false;\n    }\n}\n\nfunction getReviews() {\n    global $conn;\n    \n    // Retrieve reviews from database\n    $sql = \"SELECT * FROM reviews\";\n    $result = $conn->query($sql);\n    $reviews = array();\n    while ($row = $result->fetch_assoc()) {\n        $reviews[] = array(\n            'id' => $row['id'],\n            'user_id' => $row['user_id'],\n            'product_name' => $row['product_name'],\n            'review_text' => $row['review_text'],\n            'rating' => $row['rating']\n        );\n    }\n    return $reviews;\n}\n\nfunction getUserReviews($userId) {\n    global $conn;\n    \n    // Retrieve reviews from database for a specific user\n    $sql = \"SELECT * FROM reviews WHERE user_id = ?\";\n    $stmt = $conn->prepare($sql);\n    $stmt->bind_param(\"i\", $userId);\n    if ($stmt->execute()) {\n        $result = $stmt->get_result();\n        $reviews = array();\n        while ($row = $result->fetch_assoc()) {\n            $reviews[] = array(\n                'id' => $row['id'],\n                'product_name' => $row['product_name'],\n                'review_text' => $row['review_text'],\n                'rating' => $row['rating']\n            );\n        }\n        return $reviews;\n    } else {\n        return false;\n    }\n}\n\nfunction getAverageRating($userId) {\n    global $conn;\n    \n    // Retrieve average rating for a specific user\n    $sql = \"SELECT AVG(rating) AS avg_rating FROM reviews WHERE user_id = ?\";\n    $stmt = $conn->prepare($sql);\n    $stmt->bind_param(\"i\", $userId);\n    if ($stmt->execute()) {\n        $result = $stmt->get_result();\n        $row = $result->fetch_assoc();\n        return $row['avg_rating'];\n    } else {\n        return false;\n    }\n}\n\n// Example usage:\n$data = array(\n    'user_id' => 1,\n    'product_name' => 'Product X',\n    'review_text' => 'This product is great!',\n    'rating' => 5\n);\naddReview($data);\n\n$reviews = getReviews();\nprint_r($reviews);\n\n$userReviews = getUserReviews(1);\nprint_r($userReviews);\n\n$averageRating = getAverageRating(1);\necho $averageRating;\n\n?>\n```"]}
