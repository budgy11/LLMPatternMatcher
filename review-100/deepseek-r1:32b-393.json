{"prompt": "Create a user review function using php", "llm_output": "<think>\nOkay, I need to create a user review function using PHP. Let me think about how to approach this.\n\nFirst, the function should take user input for the review and rating. So, I'll set up an HTML form with fields for the name, review text, and a dropdown for the rating from 1 to 5 stars.\n\nNext, when the form is submitted, the PHP script needs to handle the data. I should include conditional checks to make sure all required fields are filled out. If any are missing, display appropriate error messages.\n\nThen, I need to connect to a MySQL database to store the reviews. I'll set up the connection with host, user, password, and database name. Once connected, I'll prepare an SQL query to insert the review data into the 'reviews' table. Using prepared statements will help prevent SQL injection attacks.\n\nAfter inserting the data, the script should display a confirmation message to the user. If there's an error during insertion, like a connection failure or query issue, I need to handle that and show an error message.\n\nAlso, it would be helpful to display all existing reviews on the same page. So, after handling the submission, I'll write another SQL query to fetch all reviews from the database. Then, loop through each review and display them in a structured way, showing the author's name, rating as stars, review text, and date.\n\nI should remember to close the database connection after fetching the reviews to free up resources. Testing is important too; I'll make sure to check for errors and ensure that all parts of the script work correctly together.\n\nFinally, I'll structure the HTML page with proper headings, form elements, and styling so that it looks clean and user-friendly.\n</think>\n\nHere's an example of a user review function in PHP. This example includes:\n\n1. A form to submit reviews\n2. Validation for the review submission\n3. Storing reviews in a database\n4. Displaying existing reviews\n\n```php\n<?php\n// Database connection details\n$host = 'localhost';\n$user = 'username';\n$password = 'password';\n$db_name = 'reviews_db';\n\n// Connect to MySQL database\n$conn = mysqli_connect($host, $user, $password, $db_name);\n\nif (!$conn) {\n    die(\"Connection failed: \" . mysqli_connect_error());\n}\n\n// Handle review submission\nif (isset($_POST['submit'])) {\n    // Sanitize and validate input\n    $name = htmlspecialchars(trim($_POST['name']));\n    $review_text = htmlspecialchars(trim($_POST['review']));\n    $rating = intval($_POST['rating']);\n\n    if (empty($name) || empty($review_text) || empty($rating)) {\n        echo \"Please fill in all required fields!\";\n    } else {\n        // Prepare and bind the SQL statement\n        $stmt = mysqli_prepare($conn, \"INSERT INTO reviews (author, review_text, rating, review_date) VALUES (?, ?, ?, CURRENT_TIMESTAMP)\");\n        mysqli_stmt_bind_param($stmt, \"sss\", $name, $review_text, $rating);\n\n        if (mysqli_stmt_execute($stmt)) {\n            echo \"<p style='color: green;'>Thank you for submitting your review!</p>\";\n        } else {\n            echo \"<p style='color: red;'>Error submitting review. Please try again.</p>\";\n        }\n\n        mysqli_stmt_close($stmt);\n    }\n}\n\n// Fetch and display existing reviews\n$reviews_query = \"SELECT * FROM reviews ORDER BY review_date DESC\";\n$result = mysqli_query($conn, $reviews_query);\n\necho \"<h2>Existing Reviews</h2>\";\nif (mysqli_num_rows($result) > 0) {\n    while ($row = mysqli_fetch_assoc($result)) {\n        echo \"<div style='border: 1px solid #ddd; padding: 15px; margin-bottom: 10px;'>\";\n        echo \"<h3>Reviewer: \" . $row['author'] . \"</h3>\";\n        echo \"<p>Rating: \" . str_repeat(\"\u2605\", $row['rating']) . \"</p>\";\n        echo \"<p>Review: \" . $row['review_text'] . \"</p>\";\n        echo \"<p>Date: \" . date('jS M Y, g:i a', strtotime($row['review_date'])) . \"</p>\";\n        echo \"</div>\";\n    }\n} else {\n    echo \"<p>No reviews found. Be the first to review!</p>\";\n}\n\n// Close database connection\nmysqli_close($conn);\n?>\n\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Review System</title>\n    <style>\n        body {\n            font-family: Arial, sans-serif;\n            max-width: 800px;\n            margin: 0 auto;\n            padding: 20px;\n        }\n        .review-form {\n            background-color: #f5f5f5;\n            padding: 20px;\n            border-radius: 5px;\n        }\n        input, textarea {\n            margin-bottom: 10px;\n        }\n    </style>\n</head>\n<body>\n    <h1>Submit a Review</h1>\n    \n    <div class=\"review-form\">\n        <form method=\"post\" action=\"<?php echo $_SERVER['PHP_SELF']; ?>\">\n            <label for=\"name\">Name:</label><br>\n            <input type=\"text\" id=\"name\" name=\"name\" required><br>\n\n            <label for=\"review\">Review:</label><br>\n            <textarea id=\"review\" name=\"review\" rows=\"5\" cols=\"40\" required></textarea><br>\n\n            <label for=\"rating\">Rating:</label><br>\n            <select id=\"rating\" name=\"rating\">\n                <option value=\"\">Select a rating</option>\n                <option value=\"1\">1 Star</option>\n                <option value=\"2\">2 Stars</option>\n                <option value=\"3\">3 Stars</option>\n                <option value=\"4\">4 Stars</option>\n                <option value=\"5\">5 Stars</option>\n            </select><br>\n\n            <input type=\"submit\" name=\"submit\" value=\"Submit Review\">\n        </form>\n    </div>\n</body>\n</html>\n```\n\nThis code includes:\n\n1. A database connection configuration\n2. Review submission form with basic validation\n3. Storage of reviews in a MySQL database table\n4. Display of existing reviews with formatting\n5. Basic error handling and security measures\n\nTo use this code, you'll need to:\n\n1. Set up a MySQL database named `reviews_db`\n2. Create a table named `reviews` with the following columns:\n   - id (INT AUTO_INCREMENT PRIMARY KEY)\n   - author (VARCHAR(255))\n   - review_text (TEXT)\n   - rating (TINYINT)\n   - review_date (DATETIME)\n\n3. Replace the database connection details (`$host`, `$user`, `$password`) with your actual MySQL credentials\n\nThe code includes basic security measures like:\n- Input sanitization using `htmlspecialchars()`\n- Prepared statements for SQL queries\n- Basic validation for required fields\n\nYou can customize the styling by modifying the CSS in the `<style>` section and add more features such as:\n- User authentication\n- Review editing/deletion\n- Sorting reviews by different criteria\n- More detailed review statistics\n- User avatars\n- Flagging inappropriate reviews", "code_blocks": ["```php\n<?php\n// Database connection details\n$host = 'localhost';\n$user = 'username';\n$password = 'password';\n$db_name = 'reviews_db';\n\n// Connect to MySQL database\n$conn = mysqli_connect($host, $user, $password, $db_name);\n\nif (!$conn) {\n    die(\"Connection failed: \" . mysqli_connect_error());\n}\n\n// Handle review submission\nif (isset($_POST['submit'])) {\n    // Sanitize and validate input\n    $name = htmlspecialchars(trim($_POST['name']));\n    $review_text = htmlspecialchars(trim($_POST['review']));\n    $rating = intval($_POST['rating']);\n\n    if (empty($name) || empty($review_text) || empty($rating)) {\n        echo \"Please fill in all required fields!\";\n    } else {\n        // Prepare and bind the SQL statement\n        $stmt = mysqli_prepare($conn, \"INSERT INTO reviews (author, review_text, rating, review_date) VALUES (?, ?, ?, CURRENT_TIMESTAMP)\");\n        mysqli_stmt_bind_param($stmt, \"sss\", $name, $review_text, $rating);\n\n        if (mysqli_stmt_execute($stmt)) {\n            echo \"<p style='color: green;'>Thank you for submitting your review!</p>\";\n        } else {\n            echo \"<p style='color: red;'>Error submitting review. Please try again.</p>\";\n        }\n\n        mysqli_stmt_close($stmt);\n    }\n}\n\n// Fetch and display existing reviews\n$reviews_query = \"SELECT * FROM reviews ORDER BY review_date DESC\";\n$result = mysqli_query($conn, $reviews_query);\n\necho \"<h2>Existing Reviews</h2>\";\nif (mysqli_num_rows($result) > 0) {\n    while ($row = mysqli_fetch_assoc($result)) {\n        echo \"<div style='border: 1px solid #ddd; padding: 15px; margin-bottom: 10px;'>\";\n        echo \"<h3>Reviewer: \" . $row['author'] . \"</h3>\";\n        echo \"<p>Rating: \" . str_repeat(\"\u2605\", $row['rating']) . \"</p>\";\n        echo \"<p>Review: \" . $row['review_text'] . \"</p>\";\n        echo \"<p>Date: \" . date('jS M Y, g:i a', strtotime($row['review_date'])) . \"</p>\";\n        echo \"</div>\";\n    }\n} else {\n    echo \"<p>No reviews found. Be the first to review!</p>\";\n}\n\n// Close database connection\nmysqli_close($conn);\n?>\n\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Review System</title>\n    <style>\n        body {\n            font-family: Arial, sans-serif;\n            max-width: 800px;\n            margin: 0 auto;\n            padding: 20px;\n        }\n        .review-form {\n            background-color: #f5f5f5;\n            padding: 20px;\n            border-radius: 5px;\n        }\n        input, textarea {\n            margin-bottom: 10px;\n        }\n    </style>\n</head>\n<body>\n    <h1>Submit a Review</h1>\n    \n    <div class=\"review-form\">\n        <form method=\"post\" action=\"<?php echo $_SERVER['PHP_SELF']; ?>\">\n            <label for=\"name\">Name:</label><br>\n            <input type=\"text\" id=\"name\" name=\"name\" required><br>\n\n            <label for=\"review\">Review:</label><br>\n            <textarea id=\"review\" name=\"review\" rows=\"5\" cols=\"40\" required></textarea><br>\n\n            <label for=\"rating\">Rating:</label><br>\n            <select id=\"rating\" name=\"rating\">\n                <option value=\"\">Select a rating</option>\n                <option value=\"1\">1 Star</option>\n                <option value=\"2\">2 Stars</option>\n                <option value=\"3\">3 Stars</option>\n                <option value=\"4\">4 Stars</option>\n                <option value=\"5\">5 Stars</option>\n            </select><br>\n\n            <input type=\"submit\" name=\"submit\" value=\"Submit Review\">\n        </form>\n    </div>\n</body>\n</html>\n```"]}
