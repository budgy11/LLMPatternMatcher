{"prompt": "Create a user review function using php", "llm_output": "**User Review Function in PHP**\n=====================================\n\nBelow is an example of how you can create a user review function in PHP. This function will handle creating, updating, and deleting reviews.\n\n### Database Setup\n\nFirst, you need to set up your database with the following tables:\n\n```sql\nCREATE TABLE users (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  name VARCHAR(255) NOT NULL,\n  email VARCHAR(255) NOT NULL UNIQUE\n);\n\nCREATE TABLE products (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  name VARCHAR(255) NOT NULL,\n  description TEXT NOT NULL\n);\n\nCREATE TABLE reviews (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  user_id INT NOT NULL,\n  product_id INT NOT NULL,\n  rating TINYINT NOT NULL,\n  review TEXT NOT NULL,\n  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n);\n```\n\n### PHP Function\n\n```php\n// config.php\n$database = array(\n    'host' => 'localhost',\n    'username' => 'your_username',\n    'password' => 'your_password',\n    'name' => 'your_database'\n);\n\n$conn = new mysqli($database['host'], $database['username'], $database['password'], $database['name']);\n\nfunction createReview($product_id, $rating, $review) {\n    global $conn;\n    \n    // Check if user is logged in\n    if (isset($_SESSION['user_id'])) {\n        $query = \"INSERT INTO reviews (user_id, product_id, rating, review)\n                  VALUES (?, ?, ?, ?)\";\n        $stmt = $conn->prepare($query);\n        $stmt->bind_param(\"iis\", $_SESSION['user_id'], $product_id, $rating, $review);\n        if ($stmt->execute()) {\n            return true;\n        } else {\n            return false;\n        }\n    } else {\n        return 'You must be logged in to create a review.';\n    }\n}\n\nfunction updateReview($id, $new_rating, $new_review) {\n    global $conn;\n    \n    // Check if user is allowed to update the review\n    $query = \"SELECT * FROM reviews WHERE id = ?\";\n    $stmt = $conn->prepare($query);\n    $stmt->bind_param(\"i\", $id);\n    $stmt->execute();\n    $result = $stmt->get_result();\n    \n    if ($result && $result->fetch_assoc()['user_id'] == $_SESSION['user_id']) {\n        // Update review\n        $query = \"UPDATE reviews SET rating = ?, review = ?\n                  WHERE id = ?\";\n        $stmt = $conn->prepare($query);\n        $stmt->bind_param(\"iis\", $new_rating, $new_review, $id);\n        if ($stmt->execute()) {\n            return true;\n        } else {\n            return false;\n        }\n    } else {\n        return 'You are not allowed to update this review.';\n    }\n}\n\nfunction deleteReview($id) {\n    global $conn;\n    \n    // Check if user is allowed to delete the review\n    $query = \"SELECT * FROM reviews WHERE id = ?\";\n    $stmt = $conn->prepare($query);\n    $stmt->bind_param(\"i\", $id);\n    $stmt->execute();\n    $result = $stmt->get_result();\n    \n    if ($result && $result->fetch_assoc()['user_id'] == $_SESSION['user_id']) {\n        // Delete review\n        $query = \"DELETE FROM reviews WHERE id = ?\";\n        $stmt = $conn->prepare($query);\n        $stmt->bind_param(\"i\", $id);\n        if ($stmt->execute()) {\n            return true;\n        } else {\n            return false;\n        }\n    } else {\n        return 'You are not allowed to delete this review.';\n    }\n}\n\nfunction getReviewsForProduct($product_id) {\n    global $conn;\n    \n    // Get reviews for product\n    $query = \"SELECT * FROM reviews WHERE product_id = ?\";\n    $stmt = $conn->prepare($query);\n    $stmt->bind_param(\"i\", $product_id);\n    $stmt->execute();\n    return $stmt->get_result();\n}\n\n// Example usage:\nif (isset($_POST['create_review'])) {\n    $result = createReview($_POST['product_id'], $_POST['rating'], $_POST['review']);\n    echo json_encode($result);\n} elseif (isset($_POST['update_review'])) {\n    $result = updateReview($_POST['id'], $_POST['new_rating'], $_POST['new_review']);\n    echo json_encode($result);\n} elseif (isset($_POST['delete_review'])) {\n    $result = deleteReview($_POST['id']);\n    echo json_encode($result);\n}\n```\n\n### Notes\n\n*   This code uses prepared statements to prevent SQL injection attacks.\n*   The `createReview` function checks if the user is logged in before creating a new review. If not, it returns an error message.\n*   The `updateReview` and `deleteReview` functions check if the user has permission to update or delete the review by checking the `user_id` of the review. If not, they return an error message.\n*   The `getReviewsForProduct` function retrieves all reviews for a given product ID.\n\nMake sure to replace the placeholders (`your_username`, `your_password`, and `your_database`) with your actual database credentials.\n\nAlso note that this is just an example code snippet and should be modified according to your specific requirements.", "code_blocks": [null, "```php\n// config.php\n$database = array(\n    'host' => 'localhost',\n    'username' => 'your_username',\n    'password' => 'your_password',\n    'name' => 'your_database'\n);\n\n$conn = new mysqli($database['host'], $database['username'], $database['password'], $database['name']);\n\nfunction createReview($product_id, $rating, $review) {\n    global $conn;\n    \n    // Check if user is logged in\n    if (isset($_SESSION['user_id'])) {\n        $query = \"INSERT INTO reviews (user_id, product_id, rating, review)\n                  VALUES (?, ?, ?, ?)\";\n        $stmt = $conn->prepare($query);\n        $stmt->bind_param(\"iis\", $_SESSION['user_id'], $product_id, $rating, $review);\n        if ($stmt->execute()) {\n            return true;\n        } else {\n            return false;\n        }\n    } else {\n        return 'You must be logged in to create a review.';\n    }\n}\n\nfunction updateReview($id, $new_rating, $new_review) {\n    global $conn;\n    \n    // Check if user is allowed to update the review\n    $query = \"SELECT * FROM reviews WHERE id = ?\";\n    $stmt = $conn->prepare($query);\n    $stmt->bind_param(\"i\", $id);\n    $stmt->execute();\n    $result = $stmt->get_result();\n    \n    if ($result && $result->fetch_assoc()['user_id'] == $_SESSION['user_id']) {\n        // Update review\n        $query = \"UPDATE reviews SET rating = ?, review = ?\n                  WHERE id = ?\";\n        $stmt = $conn->prepare($query);\n        $stmt->bind_param(\"iis\", $new_rating, $new_review, $id);\n        if ($stmt->execute()) {\n            return true;\n        } else {\n            return false;\n        }\n    } else {\n        return 'You are not allowed to update this review.';\n    }\n}\n\nfunction deleteReview($id) {\n    global $conn;\n    \n    // Check if user is allowed to delete the review\n    $query = \"SELECT * FROM reviews WHERE id = ?\";\n    $stmt = $conn->prepare($query);\n    $stmt->bind_param(\"i\", $id);\n    $stmt->execute();\n    $result = $stmt->get_result();\n    \n    if ($result && $result->fetch_assoc()['user_id'] == $_SESSION['user_id']) {\n        // Delete review\n        $query = \"DELETE FROM reviews WHERE id = ?\";\n        $stmt = $conn->prepare($query);\n        $stmt->bind_param(\"i\", $id);\n        if ($stmt->execute()) {\n            return true;\n        } else {\n            return false;\n        }\n    } else {\n        return 'You are not allowed to delete this review.';\n    }\n}\n\nfunction getReviewsForProduct($product_id) {\n    global $conn;\n    \n    // Get reviews for product\n    $query = \"SELECT * FROM reviews WHERE product_id = ?\";\n    $stmt = $conn->prepare($query);\n    $stmt->bind_param(\"i\", $product_id);\n    $stmt->execute();\n    return $stmt->get_result();\n}\n\n// Example usage:\nif (isset($_POST['create_review'])) {\n    $result = createReview($_POST['product_id'], $_POST['rating'], $_POST['review']);\n    echo json_encode($result);\n} elseif (isset($_POST['update_review'])) {\n    $result = updateReview($_POST['id'], $_POST['new_rating'], $_POST['new_review']);\n    echo json_encode($result);\n} elseif (isset($_POST['delete_review'])) {\n    $result = deleteReview($_POST['id']);\n    echo json_encode($result);\n}\n```"]}
