{"prompt": "Create a user review function using php", "llm_output": "Here's an example of how you can create a basic user review system in PHP:\n\n**Database Schema:**\n```sql\nCREATE TABLE users (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  name VARCHAR(255) NOT NULL,\n  email VARCHAR(255) NOT NULL UNIQUE\n);\n\nCREATE TABLE products (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  name VARCHAR(255) NOT NULL,\n  description TEXT\n);\n\nCREATE TABLE reviews (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  user_id INT NOT NULL,\n  product_id INT NOT NULL,\n  rating TINYINT(1) NOT NULL CHECK (rating BETWEEN 1 AND 5),\n  review TEXT NOT NULL,\n  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n);\n\nCREATE TABLE ratings (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  product_id INT NOT NULL,\n  user_id INT NOT NULL,\n  rating TINYINT(1) NOT NULL CHECK (rating BETWEEN 1 AND 5)\n);\n```\n**PHP Code:**\n```php\n// config.php\n$db_host = 'your_database_host';\n$db_username = 'your_database_username';\n$db_password = 'your_database_password';\n$db_name = 'your_database_name';\n\n$conn = new PDO(\"mysql:host=$db_host;dbname=$db_name\", $db_username, $db_password);\n```\n\n```php\n// review.php (user review form)\n<?php\nrequire_once 'config.php';\n\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n  // User has submitted a review\n  $userId = $_SESSION['user_id'];\n  $productId = $_POST['product_id'];\n  $rating = $_POST['rating'];\n  $review = $_POST['review'];\n\n  try {\n    $stmt = $conn->prepare(\"INSERT INTO reviews (user_id, product_id, rating, review) VALUES (:user_id, :product_id, :rating, :review)\");\n    $stmt->bindParam(':user_id', $userId);\n    $stmt->bindParam(':product_id', $productId);\n    $stmt->bindParam(':rating', $rating);\n    $stmt->bindParam(':review', $review);\n    $stmt->execute();\n\n    // Get the review ID\n    $reviewId = $conn->lastInsertId();\n\n    // Add rating to ratings table\n    $stmt = $conn->prepare(\"INSERT INTO ratings (product_id, user_id, rating) VALUES (:product_id, :user_id, :rating)\");\n    $stmt->bindParam(':product_id', $productId);\n    $stmt->bindParam(':user_id', $userId);\n    $stmt->bindParam(':rating', $rating);\n    $stmt->execute();\n\n    echo \"Review submitted successfully!\";\n  } catch (PDOException $e) {\n    echo \"Error submitting review: \" . $e->getMessage();\n  }\n}\n\n?>\n```\n\n```php\n// review_list.php (list of reviews for a product)\n<?php\nrequire_once 'config.php';\n\n$productId = $_GET['product_id'];\n\n$stmt = $conn->prepare(\"SELECT r.id, u.name, p.name AS product_name, r.rating, r.review FROM reviews r JOIN users u ON r.user_id = u.id JOIN products p ON r.product_id = p.id WHERE r.product_id = :product_id ORDER BY r.created_at DESC\");\n$stmt->bindParam(':product_id', $productId);\n$stmt->execute();\n\n$reviews = $stmt->fetchAll();\n\n?>\n```\n\n**Example Use Cases:**\n\n1. User submits a review for a product:\n```php\n<form action=\"review.php\" method=\"post\">\n  <input type=\"hidden\" name=\"product_id\" value=\"<?php echo $product['id']; ?>\">\n  <textarea name=\"review\"></textarea>\n  <select name=\"rating\">\n    <?php foreach (array(1, 2, 3, 4, 5) as $rating): ?>\n      <option value=\"<?php echo $rating; ?>\"><?php echo $rating . \"/5\"; ?></option>\n    <?php endforeach; ?>\n  </select>\n  <button type=\"submit\">Submit Review</button>\n</form>\n```\n2. List reviews for a product:\n```php\n<h1>Reviews for <?php echo $product['name']; ?></h1>\n\n<ul>\n  <?php foreach ($reviews as $review): ?>\n    <li>\n      <strong><?php echo $review['name']; ?></strong>\n      - <?php echo $review['rating'] . \"/5\"; ?> stars\n      - <?php echo $review['review']; ?>\n    </li>\n  <?php endforeach; ?>\n</ul>\n```\nNote that this is a basic example and you should consider adding validation, error handling, and security measures to your production code.", "code_blocks": [null, "```php\n// config.php\n$db_host = 'your_database_host';\n$db_username = 'your_database_username';\n$db_password = 'your_database_password';\n$db_name = 'your_database_name';\n\n$conn = new PDO(\"mysql:host=$db_host;dbname=$db_name\", $db_username, $db_password);\n```", "```php\n// review.php (user review form)\n<?php\nrequire_once 'config.php';\n\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n  // User has submitted a review\n  $userId = $_SESSION['user_id'];\n  $productId = $_POST['product_id'];\n  $rating = $_POST['rating'];\n  $review = $_POST['review'];\n\n  try {\n    $stmt = $conn->prepare(\"INSERT INTO reviews (user_id, product_id, rating, review) VALUES (:user_id, :product_id, :rating, :review)\");\n    $stmt->bindParam(':user_id', $userId);\n    $stmt->bindParam(':product_id', $productId);\n    $stmt->bindParam(':rating', $rating);\n    $stmt->bindParam(':review', $review);\n    $stmt->execute();\n\n    // Get the review ID\n    $reviewId = $conn->lastInsertId();\n\n    // Add rating to ratings table\n    $stmt = $conn->prepare(\"INSERT INTO ratings (product_id, user_id, rating) VALUES (:product_id, :user_id, :rating)\");\n    $stmt->bindParam(':product_id', $productId);\n    $stmt->bindParam(':user_id', $userId);\n    $stmt->bindParam(':rating', $rating);\n    $stmt->execute();\n\n    echo \"Review submitted successfully!\";\n  } catch (PDOException $e) {\n    echo \"Error submitting review: \" . $e->getMessage();\n  }\n}\n\n?>\n```", "```php\n// review_list.php (list of reviews for a product)\n<?php\nrequire_once 'config.php';\n\n$productId = $_GET['product_id'];\n\n$stmt = $conn->prepare(\"SELECT r.id, u.name, p.name AS product_name, r.rating, r.review FROM reviews r JOIN users u ON r.user_id = u.id JOIN products p ON r.product_id = p.id WHERE r.product_id = :product_id ORDER BY r.created_at DESC\");\n$stmt->bindParam(':product_id', $productId);\n$stmt->execute();\n\n$reviews = $stmt->fetchAll();\n\n?>\n```", "```php\n<form action=\"review.php\" method=\"post\">\n  <input type=\"hidden\" name=\"product_id\" value=\"<?php echo $product['id']; ?>\">\n  <textarea name=\"review\"></textarea>\n  <select name=\"rating\">\n    <?php foreach (array(1, 2, 3, 4, 5) as $rating): ?>\n      <option value=\"<?php echo $rating; ?>\"><?php echo $rating . \"/5\"; ?></option>\n    <?php endforeach; ?>\n  </select>\n  <button type=\"submit\">Submit Review</button>\n</form>\n```", "```php\n<h1>Reviews for <?php echo $product['name']; ?></h1>\n\n<ul>\n  <?php foreach ($reviews as $review): ?>\n    <li>\n      <strong><?php echo $review['name']; ?></strong>\n      - <?php echo $review['rating'] . \"/5\"; ?> stars\n      - <?php echo $review['review']; ?>\n    </li>\n  <?php endforeach; ?>\n</ul>\n```"]}
