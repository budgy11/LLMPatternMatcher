{"prompt": "Create a user review function using php", "llm_output": "Here's an example of a simple user review system in PHP:\n\n**Database Schema:**\n\nWe'll assume you have a `reviews` table with the following columns:\n\n| Column Name | Data Type | Description |\n| --- | --- | --- |\n| id | int | Unique identifier for each review |\n| product_id | int | Foreign key referencing the `products` table |\n| user_id | int | Foreign key referencing the `users` table |\n| rating | tinyint | Rating given by the user (1-5) |\n| review_text | text | Text of the review written by the user |\n\n**User Review Function:**\n\nCreate a new PHP file, e.g. `review.php`, and add the following code:\n```php\n<?php\n\n// Include database connection script\nrequire_once 'db_connection.php';\n\n// Check if user is logged in\nif (!isset($_SESSION['user_id'])) {\n    header('Location: login.php');\n    exit;\n}\n\nfunction display_reviews($product_id) {\n    global $conn;\n\n    // Get all reviews for the product\n    $query = \"SELECT * FROM reviews WHERE product_id = :product_id\";\n    $stmt = $conn->prepare($query);\n    $stmt->bindParam(':product_id', $product_id);\n    $stmt->execute();\n    $reviews = $stmt->fetchAll();\n\n    // Display reviews\n    foreach ($reviews as $review) {\n        echo '<div class=\"review\">';\n        echo '<h2>Rating: ' . $review['rating'] . '/5</h2>';\n        echo '<p>' . nl2br($review['review_text']) . '</p>';\n        echo '<p>Posted by User ID: ' . $review['user_id'] . '</p>';\n        echo '</div>';\n    }\n}\n\nfunction add_review($product_id, $rating, $review_text) {\n    global $conn;\n\n    // Check if user is logged in\n    if (!isset($_SESSION['user_id'])) {\n        header('Location: login.php');\n        exit;\n    }\n\n    try {\n        // Insert new review into database\n        $query = \"INSERT INTO reviews (product_id, user_id, rating, review_text) VALUES (:product_id, :user_id, :rating, :review_text)\";\n        $stmt = $conn->prepare($query);\n        $stmt->bindParam(':product_id', $product_id);\n        $stmt->bindParam(':user_id', $_SESSION['user_id']);\n        $stmt->bindParam(':rating', $rating);\n        $stmt->bindParam(':review_text', $review_text);\n        $stmt->execute();\n    } catch (PDOException $e) {\n        echo 'Error adding review: ' . $e->getMessage();\n    }\n}\n\n?>\n```\n**Usage Examples:**\n\nTo display reviews for a product, call the `display_reviews()` function:\n```php\n<div class=\"product-reviews\">\n    <?php display_reviews(123); ?>\n</div>\n```\nReplace `123` with the actual ID of the product you want to display reviews for.\n\nTo add a new review, call the `add_review()` function:\n```php\n<form method=\"post\" action=\"review.php\">\n    <input type=\"hidden\" name=\"product_id\" value=\"123\">\n    <label>Rating:</label>\n    <select name=\"rating\">\n        <option value=\"1\">1/5</option>\n        <option value=\"2\">2/5</option>\n        <!-- ... -->\n        <option value=\"5\">5/5</option>\n    </select>\n\n    <label>Review Text:</label>\n    <textarea name=\"review_text\"></textarea>\n\n    <button type=\"submit\" name=\"add_review\">Add Review</button>\n</form>\n```\nIn the form, replace `123` with the actual ID of the product you want to add a review for.\n\n**Security Note:**\n\nRemember to validate and sanitize user input data before inserting it into your database. This example assumes that the `review_text` field is HTML-escaped using `nl2br()` function.", "code_blocks": ["```php\n<?php\n\n// Include database connection script\nrequire_once 'db_connection.php';\n\n// Check if user is logged in\nif (!isset($_SESSION['user_id'])) {\n    header('Location: login.php');\n    exit;\n}\n\nfunction display_reviews($product_id) {\n    global $conn;\n\n    // Get all reviews for the product\n    $query = \"SELECT * FROM reviews WHERE product_id = :product_id\";\n    $stmt = $conn->prepare($query);\n    $stmt->bindParam(':product_id', $product_id);\n    $stmt->execute();\n    $reviews = $stmt->fetchAll();\n\n    // Display reviews\n    foreach ($reviews as $review) {\n        echo '<div class=\"review\">';\n        echo '<h2>Rating: ' . $review['rating'] . '/5</h2>';\n        echo '<p>' . nl2br($review['review_text']) . '</p>';\n        echo '<p>Posted by User ID: ' . $review['user_id'] . '</p>';\n        echo '</div>';\n    }\n}\n\nfunction add_review($product_id, $rating, $review_text) {\n    global $conn;\n\n    // Check if user is logged in\n    if (!isset($_SESSION['user_id'])) {\n        header('Location: login.php');\n        exit;\n    }\n\n    try {\n        // Insert new review into database\n        $query = \"INSERT INTO reviews (product_id, user_id, rating, review_text) VALUES (:product_id, :user_id, :rating, :review_text)\";\n        $stmt = $conn->prepare($query);\n        $stmt->bindParam(':product_id', $product_id);\n        $stmt->bindParam(':user_id', $_SESSION['user_id']);\n        $stmt->bindParam(':rating', $rating);\n        $stmt->bindParam(':review_text', $review_text);\n        $stmt->execute();\n    } catch (PDOException $e) {\n        echo 'Error adding review: ' . $e->getMessage();\n    }\n}\n\n?>\n```", "```php\n<div class=\"product-reviews\">\n    <?php display_reviews(123); ?>\n</div>\n```", "```php\n<form method=\"post\" action=\"review.php\">\n    <input type=\"hidden\" name=\"product_id\" value=\"123\">\n    <label>Rating:</label>\n    <select name=\"rating\">\n        <option value=\"1\">1/5</option>\n        <option value=\"2\">2/5</option>\n        <!-- ... -->\n        <option value=\"5\">5/5</option>\n    </select>\n\n    <label>Review Text:</label>\n    <textarea name=\"review_text\"></textarea>\n\n    <button type=\"submit\" name=\"add_review\">Add Review</button>\n</form>\n```"]}
