{"prompt": "Create a user review function using php", "llm_output": "Here is an example of a simple user review system implemented in PHP. This system will allow users to submit reviews, store them in a database, and display the average rating.\n\n**Database Schema:**\n\nWe'll assume we're using MySQL for our database. Here's what the schema might look like:\n```sql\nCREATE TABLE products (\n  id INT PRIMARY KEY,\n  name VARCHAR(255),\n  description TEXT\n);\n\nCREATE TABLE reviews (\n  id INT PRIMARY KEY,\n  product_id INT,\n  user_id INT,\n  rating TINYINT,\n  review TEXT,\n  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n  FOREIGN KEY (product_id) REFERENCES products(id)\n);\n```\n**PHP Code:**\n\nHere's the PHP code to create the functionality:\n```php\n<?php\n\n// Configuration\ndefine('DB_HOST', 'localhost');\ndefine('DB_USERNAME', 'root');\ndefine('DB_PASSWORD', '');\ndefine('DB_NAME', 'reviews');\n\n// Connect to database\n$mysqli = new mysqli(DB_HOST, DB_USERNAME, DB_PASSWORD, DB_NAME);\n\n// Function to add review\nfunction addReview($productId, $userId, $rating, $review) {\n  global $mysqli;\n  \n  // Prepare and execute query\n  $stmt = $mysqli->prepare(\"INSERT INTO reviews (product_id, user_id, rating, review) VALUES (?, ?, ?, ?)\");\n  $stmt->bind_param(\"iiis\", $productId, $userId, $rating, $review);\n  $stmt->execute();\n  \n  // Get the review ID\n  $reviewId = $mysqli->insert_id;\n  \n  return $reviewId;\n}\n\n// Function to get average rating\nfunction getAverageRating($productId) {\n  global $mysqli;\n  \n  // Prepare and execute query\n  $stmt = $mysqli->prepare(\"SELECT AVG(rating) AS avg_rating FROM reviews WHERE product_id = ?\");\n  $stmt->bind_param(\"i\", $productId);\n  $stmt->execute();\n  \n  // Fetch the result\n  $result = $stmt->get_result();\n  $row = $result->fetch_assoc();\n  \n  return isset($row['avg_rating']) ? $row['avg_rating'] : null;\n}\n\n// Function to get reviews for a product\nfunction getReviewsForProduct($productId) {\n  global $mysqli;\n  \n  // Prepare and execute query\n  $stmt = $mysqli->prepare(\"SELECT r.id, u.username, r.rating, r.review FROM reviews r JOIN users u ON r.user_id = u.id WHERE r.product_id = ?\");\n  $stmt->bind_param(\"i\", $productId);\n  $stmt->execute();\n  \n  // Fetch the results\n  $result = $stmt->get_result();\n  $reviews = array();\n  \n  while ($row = $result->fetch_assoc()) {\n    $reviews[] = array(\n      'id' => $row['id'],\n      'username' => $row['username'],\n      'rating' => $row['rating'],\n      'review' => $row['review']\n    );\n  }\n  \n  return $reviews;\n}\n\n// Example usage\nif ($_SERVER['REQUEST_METHOD'] === 'POST') {\n  // Add review\n  $productId = $_POST['product_id'];\n  $userId = $_POST['user_id'];\n  $rating = $_POST['rating'];\n  $review = $_POST['review'];\n  \n  addReview($productId, $userId, $rating, $review);\n}\n\n// Get reviews for a product\n$productId = 1; // Replace with actual product ID\n$reviews = getReviewsForProduct($productId);\n\n?>\n```\n**Explanation:**\n\nThis code provides three main functions:\n\n* `addReview()`: adds a new review to the database.\n* `getAverageRating()`: returns the average rating for a given product.\n* `getReviewsForProduct()`: returns an array of reviews for a given product.\n\nThe example usage at the end shows how to add a new review when submitting a form, and how to retrieve reviews for a product using the `getReviewsForProduct()` function.", "code_blocks": [null, "```php\n<?php\n\n// Configuration\ndefine('DB_HOST', 'localhost');\ndefine('DB_USERNAME', 'root');\ndefine('DB_PASSWORD', '');\ndefine('DB_NAME', 'reviews');\n\n// Connect to database\n$mysqli = new mysqli(DB_HOST, DB_USERNAME, DB_PASSWORD, DB_NAME);\n\n// Function to add review\nfunction addReview($productId, $userId, $rating, $review) {\n  global $mysqli;\n  \n  // Prepare and execute query\n  $stmt = $mysqli->prepare(\"INSERT INTO reviews (product_id, user_id, rating, review) VALUES (?, ?, ?, ?)\");\n  $stmt->bind_param(\"iiis\", $productId, $userId, $rating, $review);\n  $stmt->execute();\n  \n  // Get the review ID\n  $reviewId = $mysqli->insert_id;\n  \n  return $reviewId;\n}\n\n// Function to get average rating\nfunction getAverageRating($productId) {\n  global $mysqli;\n  \n  // Prepare and execute query\n  $stmt = $mysqli->prepare(\"SELECT AVG(rating) AS avg_rating FROM reviews WHERE product_id = ?\");\n  $stmt->bind_param(\"i\", $productId);\n  $stmt->execute();\n  \n  // Fetch the result\n  $result = $stmt->get_result();\n  $row = $result->fetch_assoc();\n  \n  return isset($row['avg_rating']) ? $row['avg_rating'] : null;\n}\n\n// Function to get reviews for a product\nfunction getReviewsForProduct($productId) {\n  global $mysqli;\n  \n  // Prepare and execute query\n  $stmt = $mysqli->prepare(\"SELECT r.id, u.username, r.rating, r.review FROM reviews r JOIN users u ON r.user_id = u.id WHERE r.product_id = ?\");\n  $stmt->bind_param(\"i\", $productId);\n  $stmt->execute();\n  \n  // Fetch the results\n  $result = $stmt->get_result();\n  $reviews = array();\n  \n  while ($row = $result->fetch_assoc()) {\n    $reviews[] = array(\n      'id' => $row['id'],\n      'username' => $row['username'],\n      'rating' => $row['rating'],\n      'review' => $row['review']\n    );\n  }\n  \n  return $reviews;\n}\n\n// Example usage\nif ($_SERVER['REQUEST_METHOD'] === 'POST') {\n  // Add review\n  $productId = $_POST['product_id'];\n  $userId = $_POST['user_id'];\n  $rating = $_POST['rating'];\n  $review = $_POST['review'];\n  \n  addReview($productId, $userId, $rating, $review);\n}\n\n// Get reviews for a product\n$productId = 1; // Replace with actual product ID\n$reviews = getReviewsForProduct($productId);\n\n?>\n```"]}
