{"prompt": "Create a user review function using php", "llm_output": "Here is an example of a user review function in PHP:\n\n**Database Schema**\n```sql\nCREATE TABLE reviews (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  product_id INT,\n  user_id INT,\n  rating TINYINT(1) CHECK (rating BETWEEN 1 AND 5),\n  title VARCHAR(255),\n  content TEXT,\n  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n);\n\nCREATE TABLE products (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  name VARCHAR(255),\n  description TEXT\n);\n```\n**PHP Code**\n```php\n// Review model class\nclass Review {\n  private $db;\n\n  public function __construct($db) {\n    $this->db = $db;\n  }\n\n  public function createReview($product_id, $user_id, $rating, $title, $content) {\n    // Insert review into database\n    $query = \"INSERT INTO reviews (product_id, user_id, rating, title, content)\n              VALUES (?, ?, ?, ?, ?)\";\n    $stmt = $this->db->prepare($query);\n    $stmt->execute([$product_id, $user_id, $rating, $title, $content]);\n    return $this->db->lastInsertId();\n  }\n\n  public function getReviews($product_id) {\n    // Retrieve reviews for a specific product\n    $query = \"SELECT * FROM reviews WHERE product_id = ?\";\n    $stmt = $this->db->prepare($query);\n    $stmt->execute([$product_id]);\n    return $stmt->fetchAll(PDO::FETCH_ASSOC);\n  }\n\n  public function getAverageRating($product_id) {\n    // Retrieve average rating for a specific product\n    $query = \"SELECT AVG(rating) AS avg_rating FROM reviews WHERE product_id = ?\";\n    $stmt = $this->db->prepare($query);\n    $stmt->execute([$product_id]);\n    return $stmt->fetchColumn();\n  }\n\n  public function getReviewCount($product_id) {\n    // Retrieve count of reviews for a specific product\n    $query = \"SELECT COUNT(*) AS review_count FROM reviews WHERE product_id = ?\";\n    $stmt = $this->db->prepare($query);\n    $stmt->execute([$product_id]);\n    return $stmt->fetchColumn();\n  }\n}\n\n// Example usage:\n$db = new PDO('mysql:host=localhost;dbname=mydatabase', 'username', 'password');\n$reviewModel = new Review($db);\n\n$product_id = 123;\n$user_id = 456;\n\n$title = \"Great product!\";\n$content = \"I love this product!\";\n\n$rating = 5;\n\n$reviewId = $reviewModel->createReview($product_id, $user_id, $rating, $title, $content);\necho \"Review created with ID: $reviewId\\n\";\n\n$reviews = $reviewModel->getReviews($product_id);\nprint_r($reviews);\n\n$averageRating = $reviewModel->getAverageRating($product_id);\necho \"Average rating: $averageRating\\n\";\n\n$reviewCount = $reviewModel->getReviewCount($product_id);\necho \"Number of reviews: $reviewCount\\n\";\n```\nThis code defines a `Review` model class that interacts with the database to create, retrieve and aggregate reviews for a specific product. The `createReview()` method inserts a new review into the database, while the `getReviews()`, `getAverageRating()` and `getReviewCount()` methods retrieve reviews for a specific product, calculate the average rating and count of reviews respectively.\n\nNote that this is just an example code and you should modify it to fit your specific use case. Also, make sure to replace the placeholders with actual database credentials and schema.", "code_blocks": [null, "```php\n// Review model class\nclass Review {\n  private $db;\n\n  public function __construct($db) {\n    $this->db = $db;\n  }\n\n  public function createReview($product_id, $user_id, $rating, $title, $content) {\n    // Insert review into database\n    $query = \"INSERT INTO reviews (product_id, user_id, rating, title, content)\n              VALUES (?, ?, ?, ?, ?)\";\n    $stmt = $this->db->prepare($query);\n    $stmt->execute([$product_id, $user_id, $rating, $title, $content]);\n    return $this->db->lastInsertId();\n  }\n\n  public function getReviews($product_id) {\n    // Retrieve reviews for a specific product\n    $query = \"SELECT * FROM reviews WHERE product_id = ?\";\n    $stmt = $this->db->prepare($query);\n    $stmt->execute([$product_id]);\n    return $stmt->fetchAll(PDO::FETCH_ASSOC);\n  }\n\n  public function getAverageRating($product_id) {\n    // Retrieve average rating for a specific product\n    $query = \"SELECT AVG(rating) AS avg_rating FROM reviews WHERE product_id = ?\";\n    $stmt = $this->db->prepare($query);\n    $stmt->execute([$product_id]);\n    return $stmt->fetchColumn();\n  }\n\n  public function getReviewCount($product_id) {\n    // Retrieve count of reviews for a specific product\n    $query = \"SELECT COUNT(*) AS review_count FROM reviews WHERE product_id = ?\";\n    $stmt = $this->db->prepare($query);\n    $stmt->execute([$product_id]);\n    return $stmt->fetchColumn();\n  }\n}\n\n// Example usage:\n$db = new PDO('mysql:host=localhost;dbname=mydatabase', 'username', 'password');\n$reviewModel = new Review($db);\n\n$product_id = 123;\n$user_id = 456;\n\n$title = \"Great product!\";\n$content = \"I love this product!\";\n\n$rating = 5;\n\n$reviewId = $reviewModel->createReview($product_id, $user_id, $rating, $title, $content);\necho \"Review created with ID: $reviewId\\n\";\n\n$reviews = $reviewModel->getReviews($product_id);\nprint_r($reviews);\n\n$averageRating = $reviewModel->getAverageRating($product_id);\necho \"Average rating: $averageRating\\n\";\n\n$reviewCount = $reviewModel->getReviewCount($product_id);\necho \"Number of reviews: $reviewCount\\n\";\n```"]}
