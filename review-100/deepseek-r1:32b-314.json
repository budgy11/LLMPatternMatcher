{"prompt": "Create a user review function using php", "llm_output": "<think>\nOkay, the user asked to create a user review function using PHP. I need to figure out what they really need. They might be building a website where users can leave reviews for products or services.\n\nFirst, I should outline the main components of such a system. There needs to be a way for users to submit reviews, so an HTML form with fields like name, email, rating, and comment. Then, the PHP script will handle saving these reviews into a database.\n\nI'll need to consider security aspects. For example, sanitizing inputs to prevent SQL injection or XSS attacks. Also, validating that all required fields are filled out before inserting them into the database.\n\nNext, I should think about how to display the reviews. Maybe fetching them from the database and displaying each one with the user's name, date, rating stars, and comment. Including an average rating would be helpful too.\n\nI'll structure the answer by first showing the HTML form for submission. Then, the PHP functions for sanitizing inputs, handling submissions, retrieving reviews, calculating average ratings, displaying stars, and formatting the output.\n\nIt's important to mention dependencies like having a database connection set up with mysqli or PDO. Also, noting that this is a basic implementation and suggesting additional features like user authentication or email verification could be useful.\n\nFinally, I'll include an example of how to use these functions on a webpage, showing both the form for submitting reviews and the section displaying existing reviews.\n</think>\n\nHere's an example of a PHP function for creating a user review system. This includes submission validation, storage in a database, and display:\n\n```php\n<?php\n// Database connection (replace with your actual connection details)\n$host = 'localhost';\n$user = 'username';\n$pass = 'password';\n$dbname = 'reviews';\n\n$conn = new mysqli($host, $user, $pass, $dbname);\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Function to sanitize input\nfunction sanitizeInput($data) {\n    return htmlspecialchars(trim($data));\n}\n\n// Function to handle review submission\nfunction submitReview($name, $email, $rating, $comment, $conn) {\n    // Sanitize inputs\n    $name = sanitizeInput($name);\n    $email = sanitizeInput($email);\n    $rating = intval($rating);\n    $comment = sanitizeInput($comment);\n\n    // Validate inputs\n    if (empty($name) || empty($email) || empty($rating) || empty($comment)) {\n        return \"All fields are required!\";\n    }\n\n    if ($rating < 1 || $rating > 5) {\n        return \"Rating must be between 1 and 5!\";\n    }\n\n    // Insert into database\n    $sql = \"INSERT INTO reviews (name, email, rating, comment, review_date)\n            VALUES (?, ?, ?, ?, NOW())\";\n    \n    if ($stmt = $conn->prepare($sql)) {\n        $stmt->bind_param(\"ssis\", $name, $email, $rating, $comment);\n        $stmt->execute();\n        $stmt->close();\n        return \"Review submitted successfully!\";\n    } else {\n        return \"Error: \" . $conn->error;\n    }\n}\n\n// Function to get reviews\nfunction getReviews($conn) {\n    $sql = \"SELECT * FROM reviews ORDER BY review_date DESC\";\n    $result = $conn->query($sql);\n    \n    if ($result->num_rows > 0) {\n        return $result;\n    } else {\n        return false;\n    }\n}\n\n// Function to calculate average rating\nfunction getAverageRating($conn) {\n    $sql = \"SELECT AVG(rating) as average FROM reviews\";\n    $result = $conn->query($sql);\n    $row = $result->fetch_assoc();\n    \n    if ($row['average'] > 0) {\n        return round($row['average'], 1);\n    } else {\n        return 0;\n    }\n}\n\n// Function to display stars\nfunction displayStars($rating) {\n    $stars = '';\n    for ($i = 1; $i <= 5; $i++) {\n        if ($i <= $rating) {\n            $stars .= '<span class=\"star filled\">\u2605</span>';\n        } else {\n            $stars .= '<span class=\"star empty\">\u2606</span>';\n        }\n    }\n    return $stars;\n}\n\n// Function to display reviews\nfunction displayReview($review) {\n    echo \"<div class='review'>\";\n    echo \"<h3>\" . htmlspecialchars($review['name']) . \"</h3>\";\n    echo \"<p class='date'>\" . $review['review_date'] . \"</p>\";\n    echo displayStars($review['rating']);\n    echo \"<p class='comment'>\" . nl2br(htmlspecialchars($review['comment'])) . \"</p>\";\n    echo \"</div>\";\n}\n?>\n```\n\nThis code includes:\n\n1. Database connection setup\n2. Input sanitization function\n3. Review submission function\n4. Review retrieval functions\n5. Average rating calculation\n6. Star display function\n7. Review display function\n\nTo use this, you'll need to create a table in your database:\n\n```sql\nCREATE TABLE reviews (\n    id INT AUTO_INCREMENT PRIMARY KEY,\n    name VARCHAR(100) NOT NULL,\n    email VARCHAR(100) NOT NULL,\n    rating INT NOT NULL,\n    comment TEXT NOT NULL,\n    review_date DATETIME DEFAULT CURRENT_TIMESTAMP\n);\n```\n\nHere's an example of how to use the functions in your HTML/PHP page:\n\n```php\n<!DOCTYPE html>\n<html>\n<head>\n    <style>\n        .review {\n            border: 1px solid #ddd;\n            padding: 20px;\n            margin-bottom: 20px;\n        }\n        .star {\n            font-size: 24px;\n            margin-right: 5px;\n        }\n        .filled { color: gold; }\n        .empty { color: #ccc; }\n    </style>\n</head>\n<body>\n\n<?php\n// Show review form if user is submitting\nif ($_SERVER[\"REQUEST_METHOD\"] == \"POST\") {\n    $message = submitReview($_POST['name'], $_POST['email'], $_POST['rating'], $_POST['comment'], $conn);\n    echo \"<p>$message</p>\";\n}\n\n// Display average rating\n$averageRating = getAverageRating($conn);\necho \"<h2>Reviews (Average: $averageRating)</h2>\";\n\n// Display all reviews\n$result = getReviews($conn);\nif ($result) {\n    while ($row = $result->fetch_assoc()) {\n        displayReview($row);\n    }\n}\n?>\n\n<!-- Review submission form -->\n<form method=\"post\" action=\"<?php echo htmlspecialchars($_SERVER[\"PHP_SELF\"]);?>\">\n    <div>\n        <label for=\"name\">Name:</label><br>\n        <input type=\"text\" id=\"name\" name=\"name\" required>\n    </div>\n    \n    <div>\n        <label for=\"email\">Email:</label><br>\n        <input type=\"email\" id=\"email\" name=\"email\" required>\n    </div>\n    \n    <div>\n        <label for=\"rating\">Rating:</label><br>\n        <select id=\"rating\" name=\"rating\" required>\n            <option value=\"\">Choose rating</option>\n            <option value=\"1\">1</option>\n            <option value=\"2\">2</option>\n            <option value=\"3\">3</option>\n            <option value=\"4\">4</option>\n            <option value=\"5\">5</option>\n        </select>\n    </div>\n    \n    <div>\n        <label for=\"comment\">Comment:</label><br>\n        <textarea id=\"comment\" name=\"comment\" required></textarea>\n    </div>\n    \n    <input type=\"submit\" value=\"Submit Review\">\n</form>\n\n<?php\n$conn->close();\n?>\n\n</body>\n</html>\n```\n\nThis implementation includes:\n\n- Basic input validation and sanitization\n- Secure database queries using prepared statements\n- Star rating display\n- Average rating calculation\n- Responsive design for reviews\n- Error handling for submissions\n\nRemember to:\n1. Replace the database connection details with your actual database information\n2. Create the `reviews` table in your database\n3. Add proper error handling and security measures as needed\n4. Style the review form and display according to your website's design\n\nYou can also enhance this basic implementation by adding features like:\n- User authentication before submitting reviews\n- Email verification\n- Review approval system\n- Voting or reporting system for reviews\n- Sorting and filtering options\n- Pagination for large numbers of reviews", "code_blocks": ["```php\n<?php\n// Database connection (replace with your actual connection details)\n$host = 'localhost';\n$user = 'username';\n$pass = 'password';\n$dbname = 'reviews';\n\n$conn = new mysqli($host, $user, $pass, $dbname);\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Function to sanitize input\nfunction sanitizeInput($data) {\n    return htmlspecialchars(trim($data));\n}\n\n// Function to handle review submission\nfunction submitReview($name, $email, $rating, $comment, $conn) {\n    // Sanitize inputs\n    $name = sanitizeInput($name);\n    $email = sanitizeInput($email);\n    $rating = intval($rating);\n    $comment = sanitizeInput($comment);\n\n    // Validate inputs\n    if (empty($name) || empty($email) || empty($rating) || empty($comment)) {\n        return \"All fields are required!\";\n    }\n\n    if ($rating < 1 || $rating > 5) {\n        return \"Rating must be between 1 and 5!\";\n    }\n\n    // Insert into database\n    $sql = \"INSERT INTO reviews (name, email, rating, comment, review_date)\n            VALUES (?, ?, ?, ?, NOW())\";\n    \n    if ($stmt = $conn->prepare($sql)) {\n        $stmt->bind_param(\"ssis\", $name, $email, $rating, $comment);\n        $stmt->execute();\n        $stmt->close();\n        return \"Review submitted successfully!\";\n    } else {\n        return \"Error: \" . $conn->error;\n    }\n}\n\n// Function to get reviews\nfunction getReviews($conn) {\n    $sql = \"SELECT * FROM reviews ORDER BY review_date DESC\";\n    $result = $conn->query($sql);\n    \n    if ($result->num_rows > 0) {\n        return $result;\n    } else {\n        return false;\n    }\n}\n\n// Function to calculate average rating\nfunction getAverageRating($conn) {\n    $sql = \"SELECT AVG(rating) as average FROM reviews\";\n    $result = $conn->query($sql);\n    $row = $result->fetch_assoc();\n    \n    if ($row['average'] > 0) {\n        return round($row['average'], 1);\n    } else {\n        return 0;\n    }\n}\n\n// Function to display stars\nfunction displayStars($rating) {\n    $stars = '';\n    for ($i = 1; $i <= 5; $i++) {\n        if ($i <= $rating) {\n            $stars .= '<span class=\"star filled\">\u2605</span>';\n        } else {\n            $stars .= '<span class=\"star empty\">\u2606</span>';\n        }\n    }\n    return $stars;\n}\n\n// Function to display reviews\nfunction displayReview($review) {\n    echo \"<div class='review'>\";\n    echo \"<h3>\" . htmlspecialchars($review['name']) . \"</h3>\";\n    echo \"<p class='date'>\" . $review['review_date'] . \"</p>\";\n    echo displayStars($review['rating']);\n    echo \"<p class='comment'>\" . nl2br(htmlspecialchars($review['comment'])) . \"</p>\";\n    echo \"</div>\";\n}\n?>\n```", null, "```php\n<!DOCTYPE html>\n<html>\n<head>\n    <style>\n        .review {\n            border: 1px solid #ddd;\n            padding: 20px;\n            margin-bottom: 20px;\n        }\n        .star {\n            font-size: 24px;\n            margin-right: 5px;\n        }\n        .filled { color: gold; }\n        .empty { color: #ccc; }\n    </style>\n</head>\n<body>\n\n<?php\n// Show review form if user is submitting\nif ($_SERVER[\"REQUEST_METHOD\"] == \"POST\") {\n    $message = submitReview($_POST['name'], $_POST['email'], $_POST['rating'], $_POST['comment'], $conn);\n    echo \"<p>$message</p>\";\n}\n\n// Display average rating\n$averageRating = getAverageRating($conn);\necho \"<h2>Reviews (Average: $averageRating)</h2>\";\n\n// Display all reviews\n$result = getReviews($conn);\nif ($result) {\n    while ($row = $result->fetch_assoc()) {\n        displayReview($row);\n    }\n}\n?>\n\n<!-- Review submission form -->\n<form method=\"post\" action=\"<?php echo htmlspecialchars($_SERVER[\"PHP_SELF\"]);?>\">\n    <div>\n        <label for=\"name\">Name:</label><br>\n        <input type=\"text\" id=\"name\" name=\"name\" required>\n    </div>\n    \n    <div>\n        <label for=\"email\">Email:</label><br>\n        <input type=\"email\" id=\"email\" name=\"email\" required>\n    </div>\n    \n    <div>\n        <label for=\"rating\">Rating:</label><br>\n        <select id=\"rating\" name=\"rating\" required>\n            <option value=\"\">Choose rating</option>\n            <option value=\"1\">1</option>\n            <option value=\"2\">2</option>\n            <option value=\"3\">3</option>\n            <option value=\"4\">4</option>\n            <option value=\"5\">5</option>\n        </select>\n    </div>\n    \n    <div>\n        <label for=\"comment\">Comment:</label><br>\n        <textarea id=\"comment\" name=\"comment\" required></textarea>\n    </div>\n    \n    <input type=\"submit\" value=\"Submit Review\">\n</form>\n\n<?php\n$conn->close();\n?>\n\n</body>\n</html>\n```"]}
