{"prompt": "Create a user review function using php", "llm_output": "Here is an example of how you can create a simple user review system in PHP. This will include creating a form for users to submit reviews, displaying all the reviews on a page, and calculating ratings.\n\n**Database setup**\n\nFirst, let's assume we have two tables in our database: `users` and `reviews`. The `reviews` table has the following structure:\n\n```sql\nCREATE TABLE reviews (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  user_id INT,\n  title VARCHAR(255),\n  review TEXT,\n  rating DECIMAL(3,2) CHECK (rating >= 0 AND rating <= 5),\n  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n);\n```\n\n**PHP code**\n\nLet's assume we have the following PHP files: `reviews.php` for displaying reviews and `add_review.php` for adding new reviews.\n\n### reviews.php\n\n```php\n<?php\n// include database connection\ninclude_once 'db_connection.php';\n\n// retrieve all reviews from database\n$query = \"SELECT r.id, u.username, r.title, r.review, r.rating FROM reviews r JOIN users u ON r.user_id=u.id ORDER BY created_at DESC\";\n$reviews = mysqli_query($conn, $query);\n\n?>\n```\n\n```php\n<!-- display form to add new review -->\n<form action=\"add_review.php\" method=\"post\">\n  <h2>Add a Review</h2>\n  <label for=\"title\">Title:</label><br>\n  <input type=\"text\" id=\"title\" name=\"title\"><br>\n  <label for=\"review\">Review:</label><br>\n  <textarea id=\"review\" name=\"review\"></textarea><br>\n  <label for=\"rating\">Rating (out of 5):</label><br>\n  <input type=\"number\" id=\"rating\" name=\"rating\" min=\"0\" max=\"5\"><br><br>\n  <button type=\"submit\" class=\"btn btn-primary\">Submit Review</button>\n</form>\n\n<!-- display all reviews -->\n<h2>Reviews:</h2>\n<ul>\n  <?php\n    while ($review = mysqli_fetch_assoc($reviews)) {\n      echo '<li>';\n      echo 'Title: <strong>' . $review['title'] . '</strong><br>';\n      echo 'Review: ' . $review['review'] . '<br>';\n      echo 'Rating: ' . $review['rating'] . '/5 stars<br>';\n      echo 'User: ' . $review['username'];\n      if ($_SESSION['user_id'] == $review['user_id']) {\n        echo ' | <a href=\"edit_review.php?id=' . $review['id'] . '\">Edit Review</a> | <a href=\"delete_review.php?id=' . $review['id'] . '\">Delete Review</a>';\n      }\n      echo '</li>';\n    }\n  ?>\n</ul>\n```\n\n### add_review.php\n\n```php\n<?php\n// include database connection\ninclude_once 'db_connection.php';\n\n// retrieve form data\n$title = $_POST['title'];\n$review = $_POST['review'];\n$rating = $_POST['rating'];\n\n// insert review into database\n$query = \"INSERT INTO reviews (user_id, title, review, rating) VALUES ('\" . $_SESSION['user_id'] . \"', '$title', '$review', '$rating')\";\nmysqli_query($conn, $query);\n\nheader('Location: reviews.php');\nexit;\n?>\n```\n\n### edit_review.php\n\n```php\n<?php\n// include database connection\ninclude_once 'db_connection.php';\n\n// retrieve review ID from URL parameter\n$id = $_GET['id'];\n\n// retrieve review data from database\n$query = \"SELECT * FROM reviews WHERE id=$id\";\n$review = mysqli_query($conn, $query);\n$review = mysqli_fetch_assoc($review);\n\n// display form to edit review\n?>\n<form action=\"update_review.php\" method=\"post\">\n  <h2>Edit Review</h2>\n  <label for=\"title\">Title:</label><br>\n  <input type=\"text\" id=\"title\" name=\"title\" value=\"<?php echo $review['title']; ?>\"><br>\n  <label for=\"review\">Review:</label><br>\n  <textarea id=\"review\" name=\"review\"><?php echo $review['review']; ?></textarea><br>\n  <label for=\"rating\">Rating (out of 5):</label><br>\n  <input type=\"number\" id=\"rating\" name=\"rating\" value=\"<?php echo $review['rating']; ?>\" min=\"0\" max=\"5\"><br><br>\n  <button type=\"submit\" class=\"btn btn-primary\">Update Review</button>\n  <input type=\"hidden\" name=\"id\" value=\"<?php echo $id; ?>\">\n</form>\n```\n\n### update_review.php\n\n```php\n<?php\n// include database connection\ninclude_once 'db_connection.php';\n\n// retrieve form data and ID from URL parameter\n$id = $_POST['id'];\n$title = $_POST['title'];\n$review = $_POST['review'];\n$rating = $_POST['rating'];\n\n// update review in database\n$query = \"UPDATE reviews SET title='$title', review='$review', rating=$rating WHERE id=$id\";\nmysqli_query($conn, $query);\n\nheader('Location: reviews.php');\nexit;\n?>\n```\n\n### delete_review.php\n\n```php\n<?php\n// include database connection\ninclude_once 'db_connection.php';\n\n// retrieve ID from URL parameter\n$id = $_GET['id'];\n\n// delete review from database\n$query = \"DELETE FROM reviews WHERE id=$id\";\nmysqli_query($conn, $query);\n\nheader('Location: reviews.php');\nexit;\n?>\n```\n\nNote that this is a very basic example and does not include any error checking or validation. You should add these features to make your code more secure.\n\nAlso note that you need to replace `db_connection.php` with the actual file name of your database connection script, which includes the database credentials.", "code_blocks": [null, "```php\n<?php\n// include database connection\ninclude_once 'db_connection.php';\n\n// retrieve all reviews from database\n$query = \"SELECT r.id, u.username, r.title, r.review, r.rating FROM reviews r JOIN users u ON r.user_id=u.id ORDER BY created_at DESC\";\n$reviews = mysqli_query($conn, $query);\n\n?>\n```", "```php\n<!-- display form to add new review -->\n<form action=\"add_review.php\" method=\"post\">\n  <h2>Add a Review</h2>\n  <label for=\"title\">Title:</label><br>\n  <input type=\"text\" id=\"title\" name=\"title\"><br>\n  <label for=\"review\">Review:</label><br>\n  <textarea id=\"review\" name=\"review\"></textarea><br>\n  <label for=\"rating\">Rating (out of 5):</label><br>\n  <input type=\"number\" id=\"rating\" name=\"rating\" min=\"0\" max=\"5\"><br><br>\n  <button type=\"submit\" class=\"btn btn-primary\">Submit Review</button>\n</form>\n\n<!-- display all reviews -->\n<h2>Reviews:</h2>\n<ul>\n  <?php\n    while ($review = mysqli_fetch_assoc($reviews)) {\n      echo '<li>';\n      echo 'Title: <strong>' . $review['title'] . '</strong><br>';\n      echo 'Review: ' . $review['review'] . '<br>';\n      echo 'Rating: ' . $review['rating'] . '/5 stars<br>';\n      echo 'User: ' . $review['username'];\n      if ($_SESSION['user_id'] == $review['user_id']) {\n        echo ' | <a href=\"edit_review.php?id=' . $review['id'] . '\">Edit Review</a> | <a href=\"delete_review.php?id=' . $review['id'] . '\">Delete Review</a>';\n      }\n      echo '</li>';\n    }\n  ?>\n</ul>\n```", "```php\n<?php\n// include database connection\ninclude_once 'db_connection.php';\n\n// retrieve form data\n$title = $_POST['title'];\n$review = $_POST['review'];\n$rating = $_POST['rating'];\n\n// insert review into database\n$query = \"INSERT INTO reviews (user_id, title, review, rating) VALUES ('\" . $_SESSION['user_id'] . \"', '$title', '$review', '$rating')\";\nmysqli_query($conn, $query);\n\nheader('Location: reviews.php');\nexit;\n?>\n```", "```php\n<?php\n// include database connection\ninclude_once 'db_connection.php';\n\n// retrieve review ID from URL parameter\n$id = $_GET['id'];\n\n// retrieve review data from database\n$query = \"SELECT * FROM reviews WHERE id=$id\";\n$review = mysqli_query($conn, $query);\n$review = mysqli_fetch_assoc($review);\n\n// display form to edit review\n?>\n<form action=\"update_review.php\" method=\"post\">\n  <h2>Edit Review</h2>\n  <label for=\"title\">Title:</label><br>\n  <input type=\"text\" id=\"title\" name=\"title\" value=\"<?php echo $review['title']; ?>\"><br>\n  <label for=\"review\">Review:</label><br>\n  <textarea id=\"review\" name=\"review\"><?php echo $review['review']; ?></textarea><br>\n  <label for=\"rating\">Rating (out of 5):</label><br>\n  <input type=\"number\" id=\"rating\" name=\"rating\" value=\"<?php echo $review['rating']; ?>\" min=\"0\" max=\"5\"><br><br>\n  <button type=\"submit\" class=\"btn btn-primary\">Update Review</button>\n  <input type=\"hidden\" name=\"id\" value=\"<?php echo $id; ?>\">\n</form>\n```", "```php\n<?php\n// include database connection\ninclude_once 'db_connection.php';\n\n// retrieve form data and ID from URL parameter\n$id = $_POST['id'];\n$title = $_POST['title'];\n$review = $_POST['review'];\n$rating = $_POST['rating'];\n\n// update review in database\n$query = \"UPDATE reviews SET title='$title', review='$review', rating=$rating WHERE id=$id\";\nmysqli_query($conn, $query);\n\nheader('Location: reviews.php');\nexit;\n?>\n```", "```php\n<?php\n// include database connection\ninclude_once 'db_connection.php';\n\n// retrieve ID from URL parameter\n$id = $_GET['id'];\n\n// delete review from database\n$query = \"DELETE FROM reviews WHERE id=$id\";\nmysqli_query($conn, $query);\n\nheader('Location: reviews.php');\nexit;\n?>\n```"]}
