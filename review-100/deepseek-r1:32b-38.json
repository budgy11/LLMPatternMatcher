{"prompt": "Create a user review function using php", "llm_output": "<think>\nAlright, the user asked to create a user review function using PHP. I need to figure out what exactly they're looking for. Maybe they want a simple way to display reviews on their website.\n\nFirst, I should consider how reviews are stored. Using a database makes sense because it's scalable and easy to manage. So, I'll go with MySQL since it's commonly used.\n\nI'll outline the basic structure: connecting to the database, fetching reviews, displaying them, handling form submission for new reviews, and validating input to prevent issues like SQL injection or empty fields.\n\nNext, I need to set up the HTML form. It should include a textarea for comments and a select dropdown for rating from 1 to 5 stars. That way, users can easily rate their experience.\n\nFor displaying the reviews, I'll fetch all entries from the database, loop through them, and print each review with the author's name, date, comment, and stars. Using emojis for stars makes it visually appealing.\n\nValidation is crucial. I'll check if the form is submitted, ensure both name and comment are provided, and that the rating is selected. If any are missing, display an error message.\n\nSecurity-wise, using mysqli_real_escape_string will help prevent SQL injection. It's a basic step but important for safety.\n\nI should also include placeholders for database credentials\u2014username, password, host, and database name. The user will need to replace these with their actual details.\n\nFinally, I'll add some CSS styling to make the page look nice, like a clean layout and centered content. This makes the reviews more readable and visually appealing.\n\nPutting it all together, the function connects to the database, handles form submission, validates input, fetches and displays reviews, and includes necessary security measures. The user can then integrate this into their website as needed.\n</think>\n\nHere's an example of a user review function in PHP that allows users to submit and display reviews:\n\n```php\n<?php\n// Database connection details\n$servername = \"localhost\";\n$username = \"username\";\n$password = \"password\";\n$dbname = \"review_db\";\n\n// Connect to database\n$conn = mysqli_connect($servername, $username, $password, $dbname);\n\nif (!$conn) {\n    die(\"Connection failed: \" . mysqli_connect_error());\n}\n\n// Function to display reviews\nfunction display_reviews() {\n    global $conn;\n    \n    // SQL query to fetch reviews\n    $sql = \"SELECT * FROM reviews ORDER BY review_id DESC\";\n    $result = mysqli_query($conn, $sql);\n    \n    if (mysqli_num_rows($result) > 0) {\n        while ($row = mysqli_fetch_assoc($result)) {\n            echo \"<div class='review'>\";\n            echo \"<h3>\" . htmlspecialchars($row['author']) . \"</h3>\";\n            echo \"<p>Rating: \" . str_repeat(\"\u2605\", $row['rating']) . \"</p>\";\n            echo \"<p>Date: \" . htmlspecialchars($row['date']) . \"</p>\";\n            echo \"<p>Comment: \" . htmlspecialchars($row['comment']) . \"</p>\";\n            echo \"</div>\";\n        }\n    } else {\n        echo \"No reviews found.\";\n    }\n}\n\n// Function to add new review\nfunction add_review($author, $rating, $comment) {\n    global $conn;\n    \n    // SQL injection prevention\n    $author = mysqli_real_escape_string($conn, htmlspecialchars($author));\n    $rating = intval($rating);\n    $comment = mysqli_real_escape_string($conn, htmlspecialchars($comment));\n    $date = date(\"Y-m-d H:i:s\");\n    \n    // Insert into database\n    $sql = \"INSERT INTO reviews (author, rating, comment, date) VALUES ('$author', '$rating', '$comment', '$date')\";\n    \n    if (mysqli_query($conn, $sql)) {\n        echo \"Thank you for your review!\";\n    } else {\n        echo \"Error: \" . mysqli_error($conn);\n    }\n}\n\n// Handle form submission\nif ($_SERVER[\"REQUEST_METHOD\"] == \"POST\") {\n    $author = $_POST['author'];\n    $rating = $_POST['rating'];\n    $comment = $_POST['comment'];\n    \n    // Validate input\n    if (empty($author) || empty($comment)) {\n        echo \"Please fill in all required fields.\";\n    } else {\n        add_review($author, $rating, $comment);\n    }\n}\n\n// Close database connection\nmysqli_close($conn);\n?>\n\n<!DOCTYPE html>\n<html>\n<head>\n    <title>User Reviews</title>\n    <style>\n        .review {\n            border: 1px solid #ddd;\n            padding: 15px;\n            margin: 10px 0;\n            background-color: #f9f9f9;\n            border-radius: 5px;\n        }\n        form {\n            max-width: 600px;\n            margin: 20px auto;\n            padding: 20px;\n            border: 1px solid #ddd;\n            background-color: #fff;\n            border-radius: 5px;\n        }\n        input, textarea {\n            margin-bottom: 10px;\n            width: 100%;\n            padding: 8px;\n            box-sizing: border-box;\n        }\n    </style>\n</head>\n<body>\n    <h2>Leave a Review</h2>\n    \n    <form method=\"post\" action=\"<?php echo htmlspecialchars($_SERVER[\"PHP_SELF\"]); ?>\">\n        <input type=\"text\" name=\"author\" placeholder=\"Your Name\" required><br>\n        <select name=\"rating\" required>\n            <option value=\"\">Select Rating</option>\n            <option value=\"5\">5 Stars</option>\n            <option value=\"4\">4 Stars</option>\n            <option value=\"3\">3 Stars</option>\n            <option value=\"2\">2 Stars</option>\n            <option value=\"1\">1 Star</option>\n        </select><br>\n        <textarea name=\"comment\" placeholder=\"Your Review\" rows=\"5\" required></textarea><br>\n        <input type=\"submit\" value=\"Submit Review\">\n    </form>\n\n    <?php display_reviews(); ?>\n</body>\n</html>\n```\n\nThis PHP script includes the following features:\n\n1. A form for users to submit reviews with:\n   - Author name\n   - Rating (1-5 stars)\n   - Comment/Feedback\n\n2. Input validation and security measures:\n   - SQL injection prevention using `mysqli_real_escape_string()`\n   - Data sanitization using `htmlspecialchars()`\n   - Required fields enforced\n\n3. Display of existing reviews in a clean format:\n   - Author name\n   - Rating (displayed as stars)\n   - Comment text\n   - Date posted\n\n4. Database connectivity:\n   - Uses MySQLi extension\n   - Connection handling\n   - Data insertion and retrieval\n\nTo use this script:\n\n1. Create a database named `review_db` with the following table structure:\n\n```sql\nCREATE TABLE reviews (\n    review_id INT AUTO_INCREMENT PRIMARY KEY,\n    author VARCHAR(255) NOT NULL,\n    rating INT NOT NULL,\n    comment TEXT NOT NULL,\n    date DATETIME NOT NULL\n);\n```\n\n2. Replace the database connection details (`$username`, `$password`, etc.) with your actual database credentials.\n\n3. Save this script as an PHP file (e.g., `reviews.php`) and upload it to your web server.\n\n4. Access the page through a web browser to use the review system.\n\nThe reviews will be stored in the database and displayed below the submission form. Each review shows the author's name, rating (as stars), comment, and the date/time it was submitted.\n\nNote: Make sure to secure your database connection and consider adding additional security measures like prepared statements for production environments.", "code_blocks": ["```php\n<?php\n// Database connection details\n$servername = \"localhost\";\n$username = \"username\";\n$password = \"password\";\n$dbname = \"review_db\";\n\n// Connect to database\n$conn = mysqli_connect($servername, $username, $password, $dbname);\n\nif (!$conn) {\n    die(\"Connection failed: \" . mysqli_connect_error());\n}\n\n// Function to display reviews\nfunction display_reviews() {\n    global $conn;\n    \n    // SQL query to fetch reviews\n    $sql = \"SELECT * FROM reviews ORDER BY review_id DESC\";\n    $result = mysqli_query($conn, $sql);\n    \n    if (mysqli_num_rows($result) > 0) {\n        while ($row = mysqli_fetch_assoc($result)) {\n            echo \"<div class='review'>\";\n            echo \"<h3>\" . htmlspecialchars($row['author']) . \"</h3>\";\n            echo \"<p>Rating: \" . str_repeat(\"\u2605\", $row['rating']) . \"</p>\";\n            echo \"<p>Date: \" . htmlspecialchars($row['date']) . \"</p>\";\n            echo \"<p>Comment: \" . htmlspecialchars($row['comment']) . \"</p>\";\n            echo \"</div>\";\n        }\n    } else {\n        echo \"No reviews found.\";\n    }\n}\n\n// Function to add new review\nfunction add_review($author, $rating, $comment) {\n    global $conn;\n    \n    // SQL injection prevention\n    $author = mysqli_real_escape_string($conn, htmlspecialchars($author));\n    $rating = intval($rating);\n    $comment = mysqli_real_escape_string($conn, htmlspecialchars($comment));\n    $date = date(\"Y-m-d H:i:s\");\n    \n    // Insert into database\n    $sql = \"INSERT INTO reviews (author, rating, comment, date) VALUES ('$author', '$rating', '$comment', '$date')\";\n    \n    if (mysqli_query($conn, $sql)) {\n        echo \"Thank you for your review!\";\n    } else {\n        echo \"Error: \" . mysqli_error($conn);\n    }\n}\n\n// Handle form submission\nif ($_SERVER[\"REQUEST_METHOD\"] == \"POST\") {\n    $author = $_POST['author'];\n    $rating = $_POST['rating'];\n    $comment = $_POST['comment'];\n    \n    // Validate input\n    if (empty($author) || empty($comment)) {\n        echo \"Please fill in all required fields.\";\n    } else {\n        add_review($author, $rating, $comment);\n    }\n}\n\n// Close database connection\nmysqli_close($conn);\n?>\n\n<!DOCTYPE html>\n<html>\n<head>\n    <title>User Reviews</title>\n    <style>\n        .review {\n            border: 1px solid #ddd;\n            padding: 15px;\n            margin: 10px 0;\n            background-color: #f9f9f9;\n            border-radius: 5px;\n        }\n        form {\n            max-width: 600px;\n            margin: 20px auto;\n            padding: 20px;\n            border: 1px solid #ddd;\n            background-color: #fff;\n            border-radius: 5px;\n        }\n        input, textarea {\n            margin-bottom: 10px;\n            width: 100%;\n            padding: 8px;\n            box-sizing: border-box;\n        }\n    </style>\n</head>\n<body>\n    <h2>Leave a Review</h2>\n    \n    <form method=\"post\" action=\"<?php echo htmlspecialchars($_SERVER[\"PHP_SELF\"]); ?>\">\n        <input type=\"text\" name=\"author\" placeholder=\"Your Name\" required><br>\n        <select name=\"rating\" required>\n            <option value=\"\">Select Rating</option>\n            <option value=\"5\">5 Stars</option>\n            <option value=\"4\">4 Stars</option>\n            <option value=\"3\">3 Stars</option>\n            <option value=\"2\">2 Stars</option>\n            <option value=\"1\">1 Star</option>\n        </select><br>\n        <textarea name=\"comment\" placeholder=\"Your Review\" rows=\"5\" required></textarea><br>\n        <input type=\"submit\" value=\"Submit Review\">\n    </form>\n\n    <?php display_reviews(); ?>\n</body>\n</html>\n```", null]}
