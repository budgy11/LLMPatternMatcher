{"prompt": "Create a user review function using php", "llm_output": "<think>\nAlright, the user asked to create a user review function using PHP. I need to figure out what exactly they're looking for. It could be a simple script or something more complex with a database.\n\nFirst, I'll consider the basic structure. A review system typically involves displaying reviews, allowing users to submit new ones, and maybe even editing or deleting theirs. Since it's a function, I should make it modular.\n\nI'll start by setting up a connection to a MySQL database because that's common and straightforward. The function will need parameters like review ID, user ID, rating, comment, etc. But wait, if the user is just submitting a new review, maybe they don't have an ID yet. So I should handle both inserting and updating reviews.\n\nNext, I'll outline the steps: connect to the database, sanitize inputs to prevent SQL injection, check for existing reviews by the same user on that item, then decide whether to insert or update. After that, fetch all reviews for display.\n\nI should include error handling so if something goes wrong, like a connection failure or invalid input, it shows an appropriate message. Also, limiting the comment length makes sense to keep things concise.\n\nFor displaying reviews, I'll calculate the average rating and list each review with details. Adding some basic HTML styling will make it look decent on the page.\n\nI realize this is a starting point. The user might need more features like pagination or user authentication, but for now, I'll provide a solid foundation they can build upon.\n</think>\n\nHere's an example of a user review function using PHP that allows users to submit and display reviews:\n\n```php\n<?php\n// Database configuration\n$host = 'localhost';\n$username = 'username';\n$password = 'password';\n$database = 'reviews';\n\n// Connect to database\n$conn = mysqli_connect($host, $username, $password, $database);\nif (!$conn) {\n    die(\"Connection failed: \" . mysqli_connect_error());\n}\n\n// Function to handle user reviews\nfunction handleReview($productId, $userId, $rating, $comment) {\n    global $conn;\n\n    // Sanitize inputs\n    $productId = mysqli_real_escape_string($conn, $productId);\n    $userId = mysqli_real_escape_string($conn, $userId);\n    $rating = mysqli_real_escape_string($conn, $rating);\n    $comment = mysqli_real_escape_string($conn, $comment);\n\n    // Check if user has already reviewed this product\n    $checkQuery = \"SELECT id FROM reviews WHERE product_id = '$productId' AND user_id = '$userId'\";\n    $result = mysqli_query($conn, $checkQuery);\n\n    if (mysqli_num_rows($result) > 0) {\n        // User already reviewed - update the review\n        $updateQuery = \"UPDATE reviews SET rating = '$rating', comment = '$comment' WHERE product_id = '$productId' AND user_id = '$userId'\";\n        mysqli_query($conn, $updateQuery);\n    } else {\n        // Insert new review\n        $insertQuery = \"INSERT INTO reviews (product_id, user_id, rating, comment) VALUES ('$productId', '$userId', '$rating', '$comment')\";\n        mysqli_query($conn, $insertQuery);\n    }\n\n    // Display all reviews for the product\n    displayReviews($productId);\n}\n\n// Function to display reviews\nfunction displayReviews($productId) {\n    global $conn;\n\n    $productId = mysqli_real_escape_string($conn, $productId);\n\n    $reviewsQuery = \"SELECT * FROM reviews WHERE product_id = '$productId'\";\n    $result = mysqli_query($conn, $reviewsQuery);\n\n    if (mysqli_num_rows($result) > 0) {\n        // Calculate average rating\n        $averageRating = mysqli_fetch_assoc(mysqli_query($conn, \"SELECT AVG(rating) as avg_rating FROM reviews WHERE product_id = '$productId'\"));\n        echo \"<h3>Product Reviews</h3>\";\n        echo \"<p>Average Rating: \" . round($averageRating['avg_rating'], 1) . \"/5</p>\";\n        \n        // Display each review\n        while ($row = mysqli_fetch_assoc($result)) {\n            $ratingStars = str_repeat(\"\u2605\", $row['rating']) . str_repeat(\"\u2606\", 5 - $row['rating']);\n            echo \"<div class='review'>\";\n            echo \"<p><strong>Rating:</strong> \" . $ratingStars . \"</p>\";\n            echo \"<p><strong>Comment:</strong> \" . $row['comment'] . \"</p>\";\n            echo \"</div>\";\n        }\n    } else {\n        echo \"No reviews available yet.\";\n    }\n}\n\n// Example usage:\n$product_id = 1;\n$user_id = 1;\n$rating = 4; // Scale of 1-5\n$comment = \"This is a great product!\";\n\nhandleReview($product_id, $user_id, $rating, $comment);\n\n?>\n```\n\nThis code includes:\n\n1. A database connection setup\n2. A `handleReview` function that:\n   - Takes parameters for product ID, user ID, rating, and comment\n   - Sanitizes input to prevent SQL injection\n   - Checks if the user has already reviewed the product\n   - Updates or inserts the review accordingly\n3. A `displayReviews` function that:\n   - Displays all reviews for a specific product\n   - Shows average rating\n   - Formats ratings as stars (\u2605)\n4. Example usage showing how to call the functions\n\nTo use this code:\n\n1. Set up your database with a table named `reviews` containing columns: `id`, `product_id`, `user_id`, `rating`, and `comment`\n2. Replace the database configuration values (`host`, `username`, `password`, `database`) with your actual database credentials\n3. Call the `handleReview` function when users submit reviews\n4. Use the `displayReviews` function to show reviews on your product pages\n\nNote: This is a basic example and you might want to add additional features such as:\n\n- User authentication\n- Validation for required fields\n- More robust error handling\n- Display of user names or avatars\n- Ability to edit or delete reviews\n- Sorting and filtering options\n- Pagination for large numbers of reviews\n\nYou could also enhance the display by adding CSS styling for better visual presentation.", "code_blocks": ["```php\n<?php\n// Database configuration\n$host = 'localhost';\n$username = 'username';\n$password = 'password';\n$database = 'reviews';\n\n// Connect to database\n$conn = mysqli_connect($host, $username, $password, $database);\nif (!$conn) {\n    die(\"Connection failed: \" . mysqli_connect_error());\n}\n\n// Function to handle user reviews\nfunction handleReview($productId, $userId, $rating, $comment) {\n    global $conn;\n\n    // Sanitize inputs\n    $productId = mysqli_real_escape_string($conn, $productId);\n    $userId = mysqli_real_escape_string($conn, $userId);\n    $rating = mysqli_real_escape_string($conn, $rating);\n    $comment = mysqli_real_escape_string($conn, $comment);\n\n    // Check if user has already reviewed this product\n    $checkQuery = \"SELECT id FROM reviews WHERE product_id = '$productId' AND user_id = '$userId'\";\n    $result = mysqli_query($conn, $checkQuery);\n\n    if (mysqli_num_rows($result) > 0) {\n        // User already reviewed - update the review\n        $updateQuery = \"UPDATE reviews SET rating = '$rating', comment = '$comment' WHERE product_id = '$productId' AND user_id = '$userId'\";\n        mysqli_query($conn, $updateQuery);\n    } else {\n        // Insert new review\n        $insertQuery = \"INSERT INTO reviews (product_id, user_id, rating, comment) VALUES ('$productId', '$userId', '$rating', '$comment')\";\n        mysqli_query($conn, $insertQuery);\n    }\n\n    // Display all reviews for the product\n    displayReviews($productId);\n}\n\n// Function to display reviews\nfunction displayReviews($productId) {\n    global $conn;\n\n    $productId = mysqli_real_escape_string($conn, $productId);\n\n    $reviewsQuery = \"SELECT * FROM reviews WHERE product_id = '$productId'\";\n    $result = mysqli_query($conn, $reviewsQuery);\n\n    if (mysqli_num_rows($result) > 0) {\n        // Calculate average rating\n        $averageRating = mysqli_fetch_assoc(mysqli_query($conn, \"SELECT AVG(rating) as avg_rating FROM reviews WHERE product_id = '$productId'\"));\n        echo \"<h3>Product Reviews</h3>\";\n        echo \"<p>Average Rating: \" . round($averageRating['avg_rating'], 1) . \"/5</p>\";\n        \n        // Display each review\n        while ($row = mysqli_fetch_assoc($result)) {\n            $ratingStars = str_repeat(\"\u2605\", $row['rating']) . str_repeat(\"\u2606\", 5 - $row['rating']);\n            echo \"<div class='review'>\";\n            echo \"<p><strong>Rating:</strong> \" . $ratingStars . \"</p>\";\n            echo \"<p><strong>Comment:</strong> \" . $row['comment'] . \"</p>\";\n            echo \"</div>\";\n        }\n    } else {\n        echo \"No reviews available yet.\";\n    }\n}\n\n// Example usage:\n$product_id = 1;\n$user_id = 1;\n$rating = 4; // Scale of 1-5\n$comment = \"This is a great product!\";\n\nhandleReview($product_id, $user_id, $rating, $comment);\n\n?>\n```"]}
