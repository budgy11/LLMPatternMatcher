{"prompt": "Create a purchase functionality using php", "llm_output": "Here is an example of a basic purchase functionality using PHP, including user authentication and database interaction. This example assumes you have a database setup with the necessary tables (users, products, orders).\n\n**Database Schema:**\n\n```sql\nCREATE TABLE users (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  username VARCHAR(50) NOT NULL,\n  password VARCHAR(255) NOT NULL,\n  email VARCHAR(100) NOT NULL\n);\n\nCREATE TABLE products (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  name VARCHAR(100) NOT NULL,\n  description TEXT,\n  price DECIMAL(10,2)\n);\n\nCREATE TABLE orders (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  user_id INT NOT NULL,\n  order_date DATE NOT NULL DEFAULT CURRENT_DATE,\n  total DECIMAL(10,2) NOT NULL\n);\n```\n\n**PHP Code:**\n\n**`config.php`:**\n\n```php\n<?php\ndefine('DB_HOST', 'localhost');\ndefine('DB_USERNAME', 'your_username');\ndefine('DB_PASSWORD', 'your_password');\ndefine('DB_NAME', 'your_database_name');\n\n$mysqli = new mysqli(DB_HOST, DB_USERNAME, DB_PASSWORD, DB_NAME);\n\nif ($mysqli->connect_errno) {\n    die(\"Connection failed: \" . $mysqli->connect_error);\n}\n```\n\n**`functions.php`:**\n\n```php\n<?php\n\nfunction authenticateUser($username, $password) {\n    global $mysqli;\n    \n    $query = \"SELECT * FROM users WHERE username = '$username'\";\n    $result = $mysqli->query($query);\n    \n    if ($result->num_rows > 0) {\n        $user = $result->fetch_assoc();\n        \n        if (password_verify($password, $user['password'])) {\n            return true;\n        } else {\n            echo \"Incorrect password\";\n        }\n    } else {\n        echo \"User not found\";\n    }\n    \n    return false;\n}\n\nfunction purchaseProduct($productId, $quantity) {\n    global $mysqli;\n    \n    // Check if product exists\n    $query = \"SELECT * FROM products WHERE id = '$productId'\";\n    $result = $mysqli->query($query);\n    \n    if ($result->num_rows > 0) {\n        $product = $result->fetch_assoc();\n        \n        // Calculate total price\n        $totalPrice = $product['price'] * $quantity;\n        \n        // Insert order into database\n        $query = \"INSERT INTO orders (user_id, order_date, total) VALUES ('1', NOW(), '$totalPrice')\";\n        $mysqli->query($query);\n        \n        // Update product quantity in stock\n        $query = \"UPDATE products SET quantity_in_stock = quantity_in_stock - '$quantity' WHERE id = '$productId'\";\n        $mysqli->query($query);\n        \n        echo \"Purchase successful\";\n    } else {\n        echo \"Product not found\";\n    }\n}\n\nfunction login() {\n    global $mysqli;\n    \n    if (isset($_POST['username']) && isset($_POST['password'])) {\n        $username = $_POST['username'];\n        $password = $_POST['password'];\n        \n        if (authenticateUser($username, $password)) {\n            echo \"Login successful\";\n        }\n    } else {\n        echo \"Invalid login credentials\";\n    }\n}\n\nfunction purchase() {\n    global $mysqli;\n    \n    if (isset($_POST['product_id']) && isset($_POST['quantity'])) {\n        $productId = $_POST['product_id'];\n        $quantity = $_POST['quantity'];\n        \n        purchaseProduct($productId, $quantity);\n    } else {\n        echo \"Invalid product or quantity\";\n    }\n}\n\n?>\n```\n\n**`index.php`:**\n\n```php\n<?php\ninclude 'config.php';\ninclude 'functions.php';\n\nif (isset($_POST['login'])) {\n    login();\n} elseif (isset($_POST['purchase'])) {\n    purchase();\n}\n?>\n\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Purchase Product</title>\n</head>\n<body>\n\n<form action=\"\" method=\"post\">\n    <input type=\"text\" name=\"username\" placeholder=\"Username\">\n    <br>\n    <input type=\"password\" name=\"password\" placeholder=\"Password\">\n    <br>\n    <button type=\"submit\" name=\"login\">Login</button>\n</form>\n\n<br>\n\n<form action=\"\" method=\"post\">\n    <select name=\"product_id\">\n        <?php\n            $query = \"SELECT * FROM products\";\n            $result = $mysqli->query($query);\n            \n            while ($row = $result->fetch_assoc()) {\n                echo '<option value=\"' . $row['id'] . '\">' . $row['name'] . '</option>';\n            }\n        ?>\n    </select>\n    <br>\n    <input type=\"number\" name=\"quantity\" placeholder=\"Quantity\">\n    <br>\n    <button type=\"submit\" name=\"purchase\">Purchase</button>\n</form>\n\n</body>\n</html>\n```\n\n**How it works:**\n\n1. The user is prompted to login with their username and password.\n2. If the user's credentials are correct, they can proceed to purchase a product.\n3. The user selects a product from the dropdown list and enters the quantity they wish to purchase.\n4. When the user clicks \"Purchase\", the `purchaseProduct` function is called, which inserts an order into the database with the current date and total price of the products purchased.\n5. If there are enough products in stock, the product's quantity in stock is updated accordingly.\n\nNote: This is a basic example and does not include any error checking or validation for security purposes. In a real-world application, you would want to add more robust checks and balances to prevent potential security vulnerabilities.", "code_blocks": [null, "```php\n<?php\ndefine('DB_HOST', 'localhost');\ndefine('DB_USERNAME', 'your_username');\ndefine('DB_PASSWORD', 'your_password');\ndefine('DB_NAME', 'your_database_name');\n\n$mysqli = new mysqli(DB_HOST, DB_USERNAME, DB_PASSWORD, DB_NAME);\n\nif ($mysqli->connect_errno) {\n    die(\"Connection failed: \" . $mysqli->connect_error);\n}\n```", "```php\n<?php\n\nfunction authenticateUser($username, $password) {\n    global $mysqli;\n    \n    $query = \"SELECT * FROM users WHERE username = '$username'\";\n    $result = $mysqli->query($query);\n    \n    if ($result->num_rows > 0) {\n        $user = $result->fetch_assoc();\n        \n        if (password_verify($password, $user['password'])) {\n            return true;\n        } else {\n            echo \"Incorrect password\";\n        }\n    } else {\n        echo \"User not found\";\n    }\n    \n    return false;\n}\n\nfunction purchaseProduct($productId, $quantity) {\n    global $mysqli;\n    \n    // Check if product exists\n    $query = \"SELECT * FROM products WHERE id = '$productId'\";\n    $result = $mysqli->query($query);\n    \n    if ($result->num_rows > 0) {\n        $product = $result->fetch_assoc();\n        \n        // Calculate total price\n        $totalPrice = $product['price'] * $quantity;\n        \n        // Insert order into database\n        $query = \"INSERT INTO orders (user_id, order_date, total) VALUES ('1', NOW(), '$totalPrice')\";\n        $mysqli->query($query);\n        \n        // Update product quantity in stock\n        $query = \"UPDATE products SET quantity_in_stock = quantity_in_stock - '$quantity' WHERE id = '$productId'\";\n        $mysqli->query($query);\n        \n        echo \"Purchase successful\";\n    } else {\n        echo \"Product not found\";\n    }\n}\n\nfunction login() {\n    global $mysqli;\n    \n    if (isset($_POST['username']) && isset($_POST['password'])) {\n        $username = $_POST['username'];\n        $password = $_POST['password'];\n        \n        if (authenticateUser($username, $password)) {\n            echo \"Login successful\";\n        }\n    } else {\n        echo \"Invalid login credentials\";\n    }\n}\n\nfunction purchase() {\n    global $mysqli;\n    \n    if (isset($_POST['product_id']) && isset($_POST['quantity'])) {\n        $productId = $_POST['product_id'];\n        $quantity = $_POST['quantity'];\n        \n        purchaseProduct($productId, $quantity);\n    } else {\n        echo \"Invalid product or quantity\";\n    }\n}\n\n?>\n```", "```php\n<?php\ninclude 'config.php';\ninclude 'functions.php';\n\nif (isset($_POST['login'])) {\n    login();\n} elseif (isset($_POST['purchase'])) {\n    purchase();\n}\n?>\n\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Purchase Product</title>\n</head>\n<body>\n\n<form action=\"\" method=\"post\">\n    <input type=\"text\" name=\"username\" placeholder=\"Username\">\n    <br>\n    <input type=\"password\" name=\"password\" placeholder=\"Password\">\n    <br>\n    <button type=\"submit\" name=\"login\">Login</button>\n</form>\n\n<br>\n\n<form action=\"\" method=\"post\">\n    <select name=\"product_id\">\n        <?php\n            $query = \"SELECT * FROM products\";\n            $result = $mysqli->query($query);\n            \n            while ($row = $result->fetch_assoc()) {\n                echo '<option value=\"' . $row['id'] . '\">' . $row['name'] . '</option>';\n            }\n        ?>\n    </select>\n    <br>\n    <input type=\"number\" name=\"quantity\" placeholder=\"Quantity\">\n    <br>\n    <button type=\"submit\" name=\"purchase\">Purchase</button>\n</form>\n\n</body>\n</html>\n```"]}
