{"prompt": "Create a purchase functionality using php", "llm_output": "Here is an example of how you can create a basic purchase functionality using PHP:\n\n**Database Schema**\n\nFirst, we need to set up our database schema. We will use MySQL for this example.\n\n```sql\nCREATE TABLE users (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  username VARCHAR(255),\n  email VARCHAR(255)\n);\n\nCREATE TABLE products (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  name VARCHAR(255),\n  price DECIMAL(10,2),\n  description TEXT\n);\n\nCREATE TABLE orders (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  user_id INT,\n  order_date DATE,\n  total DECIMAL(10,2),\n  status ENUM('pending', 'shipped', 'delivered'),\n  FOREIGN KEY (user_id) REFERENCES users(id)\n);\n\nCREATE TABLE order_items (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  order_id INT,\n  product_id INT,\n  quantity INT,\n  FOREIGN KEY (order_id) REFERENCES orders(id),\n  FOREIGN KEY (product_id) REFERENCES products(id)\n);\n```\n\n**PHP Code**\n\nNext, we will create the PHP code to handle user authentication and purchase functionality.\n\n```php\n// db.php - database connection settings\n\n$dbHost = 'localhost';\n$dbUsername = 'root';\n$dbPassword = '';\n$dbName = 'store';\n\n// Connect to database\n$conn = new mysqli($dbHost, $dbUsername, $dbPassword, $dbName);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// functions.php - purchase functionality\n\nfunction authenticateUser($username, $password) {\n  // Check if user exists and password is correct\n  $query = \"SELECT * FROM users WHERE username='$username' AND password=PASSWORD('$password')\";\n  $result = $conn->query($query);\n\n  if ($result->num_rows > 0) {\n    return true;\n  } else {\n    return false;\n  }\n}\n\nfunction addProductToOrder($order_id, $product_id, $quantity) {\n  // Check if product is available\n  $query = \"SELECT * FROM products WHERE id='$product_id'\";\n  $result = $conn->query($query);\n\n  if ($result->num_rows > 0) {\n    $row = $result->fetch_assoc();\n    if ($row['quantity'] >= $quantity) {\n      // Add product to order\n      $query = \"INSERT INTO order_items (order_id, product_id, quantity) VALUES ('$order_id', '$product_id', '$quantity')\";\n      $conn->query($query);\n\n      // Update product quantity\n      $query = \"UPDATE products SET quantity=quantity-$quantity WHERE id='$product_id'\";\n      $conn->query($query);\n    } else {\n      echo 'Product is not available';\n    }\n  } else {\n    echo 'Product does not exist';\n  }\n}\n\nfunction createOrder($user_id, $total) {\n  // Create new order\n  $query = \"INSERT INTO orders (user_id, total, status) VALUES ('$user_id', '$total', 'pending')\";\n  $conn->query($query);\n\n  return $conn->insert_id;\n}\n\nfunction processPayment($order_id, $payment_method, $amount_paid) {\n  // Update order status\n  $query = \"UPDATE orders SET status='shipped' WHERE id='$order_id'\";\n  $conn->query($query);\n}\n```\n\n**Purchase Form**\n\nNow we can create a simple purchase form to test our functionality.\n\n```php\n// index.php - purchase form\n\nif (isset($_POST['username']) && isset($_POST['password'])) {\n  if (authenticateUser($_POST['username'], $_POST['password'])) {\n    $user_id = get_user_id($conn, $_POST['username']);\n\n    // Get products\n    $query = \"SELECT * FROM products\";\n    $result = $conn->query($query);\n\n    echo '<h1>Purchase Form</h1>';\n\n    while ($row = $result->fetch_assoc()) {\n      echo '<form action=\"\" method=\"post\">\n        <input type=\"hidden\" name=\"product_id\" value=\"' . $row['id'] . '\">\n        <label>Product:</label>\n        <span>' . $row['name'] . '</span><br>\n        <label>Quantity:</label>\n        <input type=\"number\" name=\"quantity\" required><br>\n        <button type=\"submit\">Add to Cart</button>\n      </form>';\n    }\n  } else {\n    echo 'Invalid username or password';\n  }\n} else {\n  // Display login form\n}\n```\n\n**Adding Products to Order**\n\nWhen the user clicks the \"Add to Cart\" button, we can use JavaScript to send a request to our server to add the product to their order.\n\n```javascript\n// script.js - add product to cart\n\ndocument.querySelectorAll('form').forEach(function(form) {\n  form.addEventListener('submit', function(e) {\n    e.preventDefault();\n\n    const formData = new FormData(this);\n    fetch('/add-to-cart', {\n      method: 'POST',\n      body: formData\n    })\n    .then(response => response.json())\n    .then(data => console.log(data))\n    .catch(error => console.error(error));\n  });\n});\n```\n\n**Displaying Order Summary**\n\nFinally, we can display a summary of the user's order.\n\n```php\n// index.php - display order summary\n\nif (isset($_SESSION['order_id'])) {\n  // Get order details\n  $query = \"SELECT * FROM orders WHERE id='\".$_SESSION['order_id'].\"'\";\n  $result = $conn->query($query);\n\n  if ($result->num_rows > 0) {\n    $row = $result->fetch_assoc();\n\n    echo '<h1>Order Summary</h1>';\n\n    // Display order items\n    $query = \"SELECT * FROM order_items WHERE order_id='\".$_SESSION['order_id'].\"'\";\n    $result = $conn->query($query);\n\n    while ($row_item = $result->fetch_assoc()) {\n      echo 'Product: ' . $row_item['product_name'] . ', Quantity: ' . $row_item['quantity'] . '<br>';\n    }\n  }\n}\n```\n\nThis is a basic example of how you can create a purchase functionality using PHP. Note that this code is not secure and should be modified to use prepared statements and other security measures to prevent SQL injection attacks.\n\nAlso, this is a simplified version of the code and does not include features such as payment processing, order confirmation emails, etc. You will need to add these features depending on your specific requirements.", "code_blocks": [null, "```php\n// db.php - database connection settings\n\n$dbHost = 'localhost';\n$dbUsername = 'root';\n$dbPassword = '';\n$dbName = 'store';\n\n// Connect to database\n$conn = new mysqli($dbHost, $dbUsername, $dbPassword, $dbName);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// functions.php - purchase functionality\n\nfunction authenticateUser($username, $password) {\n  // Check if user exists and password is correct\n  $query = \"SELECT * FROM users WHERE username='$username' AND password=PASSWORD('$password')\";\n  $result = $conn->query($query);\n\n  if ($result->num_rows > 0) {\n    return true;\n  } else {\n    return false;\n  }\n}\n\nfunction addProductToOrder($order_id, $product_id, $quantity) {\n  // Check if product is available\n  $query = \"SELECT * FROM products WHERE id='$product_id'\";\n  $result = $conn->query($query);\n\n  if ($result->num_rows > 0) {\n    $row = $result->fetch_assoc();\n    if ($row['quantity'] >= $quantity) {\n      // Add product to order\n      $query = \"INSERT INTO order_items (order_id, product_id, quantity) VALUES ('$order_id', '$product_id', '$quantity')\";\n      $conn->query($query);\n\n      // Update product quantity\n      $query = \"UPDATE products SET quantity=quantity-$quantity WHERE id='$product_id'\";\n      $conn->query($query);\n    } else {\n      echo 'Product is not available';\n    }\n  } else {\n    echo 'Product does not exist';\n  }\n}\n\nfunction createOrder($user_id, $total) {\n  // Create new order\n  $query = \"INSERT INTO orders (user_id, total, status) VALUES ('$user_id', '$total', 'pending')\";\n  $conn->query($query);\n\n  return $conn->insert_id;\n}\n\nfunction processPayment($order_id, $payment_method, $amount_paid) {\n  // Update order status\n  $query = \"UPDATE orders SET status='shipped' WHERE id='$order_id'\";\n  $conn->query($query);\n}\n```", "```php\n// index.php - purchase form\n\nif (isset($_POST['username']) && isset($_POST['password'])) {\n  if (authenticateUser($_POST['username'], $_POST['password'])) {\n    $user_id = get_user_id($conn, $_POST['username']);\n\n    // Get products\n    $query = \"SELECT * FROM products\";\n    $result = $conn->query($query);\n\n    echo '<h1>Purchase Form</h1>';\n\n    while ($row = $result->fetch_assoc()) {\n      echo '<form action=\"\" method=\"post\">\n        <input type=\"hidden\" name=\"product_id\" value=\"' . $row['id'] . '\">\n        <label>Product:</label>\n        <span>' . $row['name'] . '</span><br>\n        <label>Quantity:</label>\n        <input type=\"number\" name=\"quantity\" required><br>\n        <button type=\"submit\">Add to Cart</button>\n      </form>';\n    }\n  } else {\n    echo 'Invalid username or password';\n  }\n} else {\n  // Display login form\n}\n```", null, "```php\n// index.php - display order summary\n\nif (isset($_SESSION['order_id'])) {\n  // Get order details\n  $query = \"SELECT * FROM orders WHERE id='\".$_SESSION['order_id'].\"'\";\n  $result = $conn->query($query);\n\n  if ($result->num_rows > 0) {\n    $row = $result->fetch_assoc();\n\n    echo '<h1>Order Summary</h1>';\n\n    // Display order items\n    $query = \"SELECT * FROM order_items WHERE order_id='\".$_SESSION['order_id'].\"'\";\n    $result = $conn->query($query);\n\n    while ($row_item = $result->fetch_assoc()) {\n      echo 'Product: ' . $row_item['product_name'] . ', Quantity: ' . $row_item['quantity'] . '<br>';\n    }\n  }\n}\n```"]}
