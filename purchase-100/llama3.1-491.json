{"prompt": "Create a purchase functionality using php", "llm_output": "Here's an example of a basic purchase functionality in PHP. This will include creating a database to store products and orders, as well as a simple form for users to place orders.\n\n**Note:** This is just a simplified example and doesn't cover all aspects of a real-world e-commerce system (e.g., security, payment gateways).\n\n### Database Setup\n\nFirst, you'll need to create a database with the following tables:\n\n```sql\n-- Create products table\nCREATE TABLE products (\n    id INT PRIMARY KEY AUTO_INCREMENT,\n    name VARCHAR(255),\n    price DECIMAL(10,2)\n);\n\n-- Create orders table\nCREATE TABLE orders (\n    id INT PRIMARY KEY AUTO_INCREMENT,\n    customer_name VARCHAR(255),\n    order_date DATE,\n    total DECIMAL(10,2)\n);\n\n-- Create order items table (many-to-many relationship between orders and products)\nCREATE TABLE order_items (\n    id INT PRIMARY KEY AUTO_INCREMENT,\n    order_id INT,\n    product_id INT,\n    quantity INT,\n    FOREIGN KEY (order_id) REFERENCES orders(id),\n    FOREIGN KEY (product_id) REFERENCES products(id)\n);\n```\n\n### PHP Code\n\nCreate a new file called `purchase.php` and add the following code:\n\n```php\n<?php\n// Include database connection script\nrequire_once 'db.php';\n\n// Function to display products\nfunction displayProducts() {\n    global $conn;\n    $query = \"SELECT * FROM products\";\n    $result = mysqli_query($conn, $query);\n    while ($row = mysqli_fetch_assoc($result)) {\n        echo \"<p>\" . $row['name'] . \": $\" . $row['price'] . \"</p>\";\n    }\n}\n\n// Function to process order\nfunction processOrder() {\n    global $conn;\n    // Retrieve form data\n    $customerName = $_POST['customer_name'];\n    $orderDate = date(\"Y-m-d\");\n    $total = 0;\n\n    // Calculate total\n    foreach ($_SESSION['cart'] as $item) {\n        $productQuery = \"SELECT price FROM products WHERE id=\" . $item;\n        $result = mysqli_query($conn, $productQuery);\n        $row = mysqli_fetch_assoc($result);\n        $total += $row['price'];\n    }\n\n    // Insert order into database\n    $query = \"INSERT INTO orders (customer_name, order_date, total) VALUES ('$customerName', '$orderDate', '$total')\";\n    mysqli_query($conn, $query);\n\n    // Get the ID of the newly inserted order\n    $orderId = mysqli_insert_id($conn);\n\n    // Insert order items into database\n    foreach ($_SESSION['cart'] as $item) {\n        $query = \"INSERT INTO order_items (order_id, product_id, quantity) VALUES ('$orderId', '$item', 1)\";\n        mysqli_query($conn, $query);\n    }\n\n    // Clear cart\n    unset($_SESSION['cart']);\n\n    // Display confirmation message\n    echo \"<p>Order placed successfully!</p>\";\n}\n\n// Check if form has been submitted\nif (isset($_POST['submit'])) {\n    processOrder();\n} else {\n    displayProducts();\n\n    // If the user wants to add a product to their cart, retrieve its ID and quantity\n    if (isset($_GET['add_to_cart'])) {\n        $productId = $_GET['add_to_cart'];\n        $_SESSION['cart'][] = $productId;\n    }\n}\n?>\n```\n\n### Form\n\nCreate a simple form using HTML:\n\n```html\n<form action=\"purchase.php\" method=\"post\">\n    <p>Customer Name: <input type=\"text\" name=\"customer_name\"></p>\n    <input type=\"submit\" value=\"Place Order\">\n</form>\n\n<!-- Add product to cart link -->\n<a href=\"?add_to_cart=<?php echo $productId; ?>\">Add to Cart</a>\n```\n\n### Example Usage\n\n1. Include the `db.php` file, which contains your database connection settings.\n2. Set up a session array called `cart` to store the IDs of products added to the cart.\n3. Navigate to `purchase.php` and click on an \"Add to Cart\" link next to each product.\n4. Once you've added all desired products to your cart, fill in the customer name field and submit the form.\n\nThis example assumes that you have a basic understanding of PHP, MySQL, and HTML. You should always sanitize user input data and handle potential SQL injection attacks when working with databases in production environments.", "code_blocks": [null, "```php\n<?php\n// Include database connection script\nrequire_once 'db.php';\n\n// Function to display products\nfunction displayProducts() {\n    global $conn;\n    $query = \"SELECT * FROM products\";\n    $result = mysqli_query($conn, $query);\n    while ($row = mysqli_fetch_assoc($result)) {\n        echo \"<p>\" . $row['name'] . \": $\" . $row['price'] . \"</p>\";\n    }\n}\n\n// Function to process order\nfunction processOrder() {\n    global $conn;\n    // Retrieve form data\n    $customerName = $_POST['customer_name'];\n    $orderDate = date(\"Y-m-d\");\n    $total = 0;\n\n    // Calculate total\n    foreach ($_SESSION['cart'] as $item) {\n        $productQuery = \"SELECT price FROM products WHERE id=\" . $item;\n        $result = mysqli_query($conn, $productQuery);\n        $row = mysqli_fetch_assoc($result);\n        $total += $row['price'];\n    }\n\n    // Insert order into database\n    $query = \"INSERT INTO orders (customer_name, order_date, total) VALUES ('$customerName', '$orderDate', '$total')\";\n    mysqli_query($conn, $query);\n\n    // Get the ID of the newly inserted order\n    $orderId = mysqli_insert_id($conn);\n\n    // Insert order items into database\n    foreach ($_SESSION['cart'] as $item) {\n        $query = \"INSERT INTO order_items (order_id, product_id, quantity) VALUES ('$orderId', '$item', 1)\";\n        mysqli_query($conn, $query);\n    }\n\n    // Clear cart\n    unset($_SESSION['cart']);\n\n    // Display confirmation message\n    echo \"<p>Order placed successfully!</p>\";\n}\n\n// Check if form has been submitted\nif (isset($_POST['submit'])) {\n    processOrder();\n} else {\n    displayProducts();\n\n    // If the user wants to add a product to their cart, retrieve its ID and quantity\n    if (isset($_GET['add_to_cart'])) {\n        $productId = $_GET['add_to_cart'];\n        $_SESSION['cart'][] = $productId;\n    }\n}\n?>\n```", null]}
