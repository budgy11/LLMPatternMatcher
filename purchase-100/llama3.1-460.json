{"prompt": "Create a purchase functionality using php", "llm_output": "Here is an example of a basic purchase functionality using PHP:\n\n**Database Schema:**\n\nWe will be using a simple database schema to store the products and orders. Create the following tables in your MySQL database:\n```sql\nCREATE TABLE products (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  name VARCHAR(255),\n  price DECIMAL(10,2)\n);\n\nCREATE TABLE orders (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  user_id INT,\n  total DECIMAL(10,2),\n  status ENUM('pending', 'shipped', 'delivered'),\n  FOREIGN KEY (user_id) REFERENCES users(id)\n);\n\nCREATE TABLE order_items (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  order_id INT,\n  product_id INT,\n  quantity INT,\n  FOREIGN KEY (order_id) REFERENCES orders(id),\n  FOREIGN KEY (product_id) REFERENCES products(id)\n);\n```\n**PHP Code:**\n\nWe will be using a simple PHP application to handle the purchase functionality. Create a new file called `purchase.php` and add the following code:\n```php\n<?php\n\n// Configuration\n$db = mysqli_connect('localhost', 'username', 'password', 'database');\n\n// Function to get products from database\nfunction getProducts() {\n  global $db;\n  $query = \"SELECT * FROM products\";\n  $result = mysqli_query($db, $query);\n  return $result;\n}\n\n// Function to add order and order items to database\nfunction placeOrder($user_id, $products) {\n  global $db;\n  // Get total price of order\n  $total = 0;\n  foreach ($products as $product) {\n    $total += $product['price'] * $product['quantity'];\n  }\n  \n  // Insert order into database\n  $query = \"INSERT INTO orders (user_id, total, status) VALUES ('$user_id', '$total', 'pending')\";\n  mysqli_query($db, $query);\n  \n  // Get last inserted order ID\n  $order_id = mysqli_insert_id($db);\n  \n  // Insert order items into database\n  foreach ($products as $product) {\n    $query = \"INSERT INTO order_items (order_id, product_id, quantity) VALUES ('$order_id', '$product[id]', '$product[quantity]')\";\n    mysqli_query($db, $query);\n  }\n}\n\n// Function to update order status in database\nfunction updateOrderStatus($order_id, $status) {\n  global $db;\n  $query = \"UPDATE orders SET status = '$status' WHERE id = '$order_id'\";\n  mysqli_query($db, $query);\n}\n\n// Function to get order details from database\nfunction getOrderDetails($order_id) {\n  global $db;\n  $query = \"SELECT * FROM orders WHERE id = '$order_id'\";\n  $result = mysqli_query($db, $query);\n  return $result;\n}\n\n// Main code\nif (isset($_POST['buy'])) {\n  // Get user ID from session or database\n  $user_id = $_SESSION['id'];\n  \n  // Get products to buy\n  $products = array();\n  foreach ($_POST['products'] as $product) {\n    $products[] = array(\n      'id' => $product,\n      'quantity' => $_POST['quantities'][$product]\n    );\n  }\n  \n  // Place order and add order items to database\n  placeOrder($user_id, $products);\n  \n  // Update order status in database (optional)\n  updateOrderStatus(mysqli_insert_id($db), 'shipped');\n}\n\n// Display products and buy form\n?>\n<html>\n<head>\n  <title>Purchase</title>\n</head>\n<body>\n  <?php\n  $result = getProducts();\n  while ($row = mysqli_fetch_assoc($result)) {\n    ?>\n    <p>\n      <?php echo $row['name']; ?> (<?php echo number_format($row['price'], 2); ?>)\n      <input type=\"checkbox\" name=\"products[]\" value=\"<?php echo $row['id']; ?>\">\n      Quantity: <input type=\"number\" name=\"quantities[<?php echo $row['id']; ?>]\" value=\"1\">\n    </p>\n    <?php\n  }\n  ?>\n  \n  <form action=\"\" method=\"post\">\n    <input type=\"submit\" name=\"buy\" value=\"Buy Now\">\n  </form>\n\n  <?php\n  // Display order details (optional)\n  $order_id = $_SESSION['id'];\n  if (!empty($order_id)) {\n    $result = getOrderDetails($order_id);\n    while ($row = mysqli_fetch_assoc($result)) {\n      ?>\n      <p>Order ID: <?php echo $row['id']; ?></p>\n      <p>Status: <?php echo $row['status']; ?></p>\n      <p>Total: <?php echo number_format($row['total'], 2); ?></p>\n      <?php\n    }\n  }\n  ?>\n</body>\n</html>\n```\n**Explanation:**\n\nThe code above uses a simple MySQL database to store the products and orders. The `purchase.php` file handles the following functionality:\n\n*   Retrieves all products from the database.\n*   Places an order with the specified products and quantities.\n*   Updates the order status in the database (optional).\n*   Displays the products and buy form.\n*   Displays the order details (optional).\n\n**Note:**\n\nThis is a basic example to demonstrate the purchase functionality using PHP. In a real-world scenario, you should implement proper validation, security measures, and error handling to ensure data integrity and prevent potential security vulnerabilities.\n\nAlso, this code assumes that you have already implemented user authentication and session management in your application. If not, you will need to add those features as well.\n\nYou can modify the code to suit your specific requirements and integrate it with other components of your e-commerce platform.", "code_blocks": [null, "```php\n<?php\n\n// Configuration\n$db = mysqli_connect('localhost', 'username', 'password', 'database');\n\n// Function to get products from database\nfunction getProducts() {\n  global $db;\n  $query = \"SELECT * FROM products\";\n  $result = mysqli_query($db, $query);\n  return $result;\n}\n\n// Function to add order and order items to database\nfunction placeOrder($user_id, $products) {\n  global $db;\n  // Get total price of order\n  $total = 0;\n  foreach ($products as $product) {\n    $total += $product['price'] * $product['quantity'];\n  }\n  \n  // Insert order into database\n  $query = \"INSERT INTO orders (user_id, total, status) VALUES ('$user_id', '$total', 'pending')\";\n  mysqli_query($db, $query);\n  \n  // Get last inserted order ID\n  $order_id = mysqli_insert_id($db);\n  \n  // Insert order items into database\n  foreach ($products as $product) {\n    $query = \"INSERT INTO order_items (order_id, product_id, quantity) VALUES ('$order_id', '$product[id]', '$product[quantity]')\";\n    mysqli_query($db, $query);\n  }\n}\n\n// Function to update order status in database\nfunction updateOrderStatus($order_id, $status) {\n  global $db;\n  $query = \"UPDATE orders SET status = '$status' WHERE id = '$order_id'\";\n  mysqli_query($db, $query);\n}\n\n// Function to get order details from database\nfunction getOrderDetails($order_id) {\n  global $db;\n  $query = \"SELECT * FROM orders WHERE id = '$order_id'\";\n  $result = mysqli_query($db, $query);\n  return $result;\n}\n\n// Main code\nif (isset($_POST['buy'])) {\n  // Get user ID from session or database\n  $user_id = $_SESSION['id'];\n  \n  // Get products to buy\n  $products = array();\n  foreach ($_POST['products'] as $product) {\n    $products[] = array(\n      'id' => $product,\n      'quantity' => $_POST['quantities'][$product]\n    );\n  }\n  \n  // Place order and add order items to database\n  placeOrder($user_id, $products);\n  \n  // Update order status in database (optional)\n  updateOrderStatus(mysqli_insert_id($db), 'shipped');\n}\n\n// Display products and buy form\n?>\n<html>\n<head>\n  <title>Purchase</title>\n</head>\n<body>\n  <?php\n  $result = getProducts();\n  while ($row = mysqli_fetch_assoc($result)) {\n    ?>\n    <p>\n      <?php echo $row['name']; ?> (<?php echo number_format($row['price'], 2); ?>)\n      <input type=\"checkbox\" name=\"products[]\" value=\"<?php echo $row['id']; ?>\">\n      Quantity: <input type=\"number\" name=\"quantities[<?php echo $row['id']; ?>]\" value=\"1\">\n    </p>\n    <?php\n  }\n  ?>\n  \n  <form action=\"\" method=\"post\">\n    <input type=\"submit\" name=\"buy\" value=\"Buy Now\">\n  </form>\n\n  <?php\n  // Display order details (optional)\n  $order_id = $_SESSION['id'];\n  if (!empty($order_id)) {\n    $result = getOrderDetails($order_id);\n    while ($row = mysqli_fetch_assoc($result)) {\n      ?>\n      <p>Order ID: <?php echo $row['id']; ?></p>\n      <p>Status: <?php echo $row['status']; ?></p>\n      <p>Total: <?php echo number_format($row['total'], 2); ?></p>\n      <?php\n    }\n  }\n  ?>\n</body>\n</html>\n```"]}
