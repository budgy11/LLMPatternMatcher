{"prompt": "Create a purchase functionality using php", "llm_output": "<think>\nOkay, I need to create a purchase functionality using PHP. Let me think about how to approach this.\n\nFirst, the user mentioned they want a simple example, so I should keep it straightforward without complicating things. They probably have some basic knowledge of PHP and might be looking for a clear starting point.\n\nI should start by outlining the necessary components. There needs to be a way for users to select products, view details, add them to a cart, review the order before purchasing, and then process the payment. So, I'll break it down into these main steps: product display, adding to cart, viewing the cart, checkout, processing payment, and confirming the purchase.\n\nFor the database setup, a simple table structure makes sense. I'll create two tables: one for products with details like ID, name, description, price, and stock. Another table for orders to store each purchase record, including order ID, product ID, user info, quantity, total price, purchase date, and payment status.\n\nNext, the PHP files. The first file will display all available products. I'll fetch data from the products table and list each item with a buy button that adds it to the cart. Using sessions is a good way to keep track of the cart items across different pages.\n\nThen, handling the add to cart functionality. When a user clicks 'Buy Now', the product ID is passed via GET, and the product details are fetched from the database. These are added to the session array for the cart. If the product isn't in stock, an error message should display.\n\nAfter that, displaying the shopping cart. This page will show all items added by the user, with quantities they can adjust. Each item's total is calculated, and there's a subtotal at the bottom. Buttons to update quantities or remove items are essential here.\n\nThe checkout page needs a form for collecting user information like name, email, address, and phone number. The payment method options should include credit card, PayPal, etc., each with their own processing logic if needed. For simplicity, I'll show placeholders where more detailed payment handling can be added later.\n\nProcessing the order involves validating the input data from the checkout form. If there are any errors, they're displayed. Otherwise, the order is inserted into the orders table, and a thank you message is shown with order details.\n\nI should also include some error handling throughout the code to manage issues like invalid product IDs or empty cart situations. Using prepared statements can help prevent SQL injection attacks, which is important for security.\n\nFinally, I'll mention additional features that could be added later, such as user authentication, more payment options, email notifications, and an admin panel. This gives the user ideas on how to expand the functionality beyond the basic setup.\n\nI need to make sure all the code snippets are correctly formatted and explained so the user can follow along easily. Including comments in the code will help them understand each part's purpose. Testing each step is crucial to ensure everything works as intended, from displaying products to processing payments.\n</think>\n\nHere's a simple example of a purchase functionality using PHP. This includes basic steps like viewing products, adding items to cart, checkout, and order processing.\n\n### 1. First, create the database tables:\n\n```sql\n-- Create products table\nCREATE TABLE products (\n    id INT PRIMARY KEY AUTO_INCREMENT,\n    name VARCHAR(255) NOT NULL,\n    description TEXT,\n    price DECIMAL(10, 2) NOT NULL,\n    stock INT DEFAULT 0\n);\n\n-- Create orders table\nCREATE TABLE orders (\n    order_id INT PRIMARY KEY AUTO_INCREMENT,\n    product_id INT,\n    user_name VARCHAR(255),\n    quantity INT DEFAULT 1,\n    total_price DECIMAL(10, 2),\n    purchase_date DATETIME,\n    payment_status ENUM('pending', 'completed') DEFAULT 'pending'\n);\n```\n\n### 2. Create the products display page (`products.php`):\n\n```php\n<?php\nsession_start();\nrequire_once \"db_connection.php\";\n\n// Fetch all products from database\n$products = $conn->query(\"SELECT * FROM products\");\n?>\n\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Products</title>\n</head>\n<body>\n    <h1>Available Products</h1>\n    <?php while ($product = $products->fetch_assoc()): ?>\n        <div style=\"border: 1px solid #ddd; padding: 10px; margin-bottom: 10px;\">\n            <h3><?php echo $product['name']; ?></h3>\n            <p><?php echo $product['description']; ?></p>\n            <p>Price: <?php echo \"$\" . number_format($product['price'], 2); ?></p>\n            <form action=\"add_to_cart.php\" method=\"GET\">\n                <input type=\"hidden\" name=\"id\" value=\"<?php echo $product['id']; ?>\">\n                <?php if ($product['stock'] > 0): ?>\n                    <button type=\"submit\">Buy Now</button>\n                <?php else: ?>\n                    <p>Out of stock</p>\n                <?php endif; ?>\n            </form>\n        </div>\n    <?php endwhile; ?>\n\n    <a href=\"cart.php\">View Cart</a>\n</body>\n</html>\n```\n\n### 3. Add to cart functionality (`add_to_cart.php`):\n\n```php\n<?php\nsession_start();\nrequire_once \"db_connection.php\";\n\nif (isset($_GET['id'])) {\n    $product_id = $_GET['id'];\n    \n    // Fetch product details from database\n    $result = $conn->query(\"SELECT * FROM products WHERE id = $product_id\");\n    if ($product = $result->fetch_assoc()) {\n        // Add to cart\n        $cart_item = array(\n            'id' => $product['id'],\n            'name' => $product['name'],\n            'price' => $product['price'],\n            'quantity' => 1\n        );\n        \n        if (empty($_SESSION['cart'])) {\n            $_SESSION['cart'] = array();\n        }\n        \n        // Add product to cart or increase quantity if already present\n        $found_product = false;\n        foreach ($_SESSION['cart'] as &$item) {\n            if ($item['id'] == $product_id) {\n                $item['quantity']++;\n                $found_product = true;\n                break;\n            }\n        }\n        \n        if (!$found_product) {\n            array_push($_SESSION['cart'], $cart_item);\n        }\n    } else {\n        // Product not found\n        echo \"Product not found!\";\n    }\n}\n\nheader(\"Location: cart.php\");\nexit();\n?>\n```\n\n### 4. Display shopping cart page (`cart.php`):\n\n```php\n<?php\nsession_start();\nrequire_once \"db_connection.php\";\n\n// Calculate subtotal\n$subtotal = 0;\nforeach ($_SESSION['cart'] as $item) {\n    $subtotal += ($item['price'] * $item['quantity']);\n}\n?>\n\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Shopping Cart</title>\n</head>\n<body>\n    <h1>Your Shopping Cart</h1>\n    \n    <?php if (!empty($_SESSION['cart'])): ?>\n        <form action=\"checkout.php\" method=\"POST\">\n            <?php foreach ($_SESSION['cart'] as $item): ?>\n                <div style=\"border: 1px solid #ddd; padding: 10px; margin-bottom: 10px;\">\n                    <h3><?php echo $item['name']; ?></h3>\n                    <p>Price: <?php echo \"$\" . number_format($item['price'], 2); ?></p>\n                    <input type=\"number\" name=\"quantity_<?php echo $item['id']; ?>\" value=\"<?php echo $item['quantity']; ?>\" min=\"1\">\n                    <a href=\"remove_from_cart.php?id=<?php echo $item['id']; ?>\">Remove</a>\n                </div>\n            <?php endforeach; ?>\n            \n            <p>Subtotal: <?php echo \"$\" . number_format($subtotal, 2); ?></p>\n            <button type=\"submit\">Checkout</button>\n        </form>\n    <?php else: ?>\n        <p>Your cart is empty.</p>\n    <?php endif; ?>\n\n    <a href=\"products.php\">Continue Shopping</a>\n</body>\n</html>\n```\n\n### 5. Remove item from cart (`remove_from_cart.php`):\n\n```php\n<?php\nsession_start();\n\nif (isset($_GET['id'])) {\n    $product_id = $_GET['id'];\n    \n    // Remove product from cart\n    foreach ($_SESSION['cart'] as $key => $item) {\n        if ($item['id'] == $product_id) {\n            unset($_SESSION['cart'][$key]);\n            break;\n        }\n    }\n    \n    // Re-index array keys\n    $_SESSION['cart'] = array_values($_SESSION['cart']);\n}\n\nheader(\"Location: cart.php\");\nexit();\n?>\n```\n\n### 6. Checkout page (`checkout.php`):\n\n```php\n<?php\nsession_start();\n\nif (!empty($_POST)) {\n    // Process order\n    $order_details = array(\n        'user_name' => $_POST['name'],\n        'email' => $_POST['email'],\n        'address' => $_POST['address'],\n        'phone' => $_POST['phone']\n    );\n    \n    // Store order details in session for confirmation page\n    $_SESSION['order'] = $order_details;\n    header(\"Location: order_confirmation.php\");\n} else {\n    // Show checkout form\n?>\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Checkout</title>\n</head>\n<body>\n    <h1>Checkout</h1>\n    <form action=\"checkout.php\" method=\"POST\">\n        <div style=\"border: 1px solid #ddd; padding: 20px;\">\n            <label for=\"name\">Name:</label><br>\n            <input type=\"text\" name=\"name\" required><br><br>\n            \n            <label for=\"email\">Email:</label><br>\n            <input type=\"email\" name=\"email\" required><br><br>\n            \n            <label for=\"address\">Address:</label><br>\n            <textarea name=\"address\" rows=\"3\" cols=\"40\" required></textarea><br><br>\n            \n            <label for=\"phone\">Phone Number:</label><br>\n            <input type=\"tel\" name=\"phone\" required><br><br>\n            \n            <h2>Payment Method</h2>\n            <input type=\"radio\" name=\"payment_method\" value=\"credit_card\" checked> Credit Card\n            <input type=\"radio\" name=\"payment_method\" value=\"paypal\"> PayPal<br><br>\n            \n            <!-- Add more payment method fields if needed -->\n        </div>\n        \n        <?php foreach ($_SESSION['cart'] as $item): ?>\n            <p><?php echo $item['name']; ?> x<?php echo $item['quantity']; ?></p>\n        <?php endforeach; ?>\n        \n        <button type=\"submit\">Complete Purchase</button>\n    </form>\n</body>\n</html>\n<?php } // End of POST check\n```\n\n### 7. Order confirmation page (`order_confirmation.php`):\n\n```php\n<?php\nsession_start();\nrequire_once \"db_connection.php\";\n\n// Store order in database\nif (isset($_SESSION['order']) && !empty($_SESSION['cart'])) {\n    $user_name = $_SESSION['order']['user_name'];\n    $email = $_SESSION['order']['email'];\n    $address = $_SESSION['order']['address'];\n    $phone = $_SESSION['order']['phone'];\n    \n    foreach ($_SESSION['cart'] as $item) {\n        // Insert order into orders table\n        $stmt = $conn->prepare(\"INSERT INTO orders (product_id, user_name, quantity, total_price, purchase_date, payment_status) VALUES (?, ?, ?, ?, NOW(), ?)\");\n        $stmt->bind_param(\"iisds\", $item['id'], $user_name, $item['quantity'], ($item['price'] * $item['quantity']), 'completed');\n        $stmt->execute();\n    }\n    \n    // Clear cart\n    unset($_SESSION['cart']);\n}\n\n// Show confirmation message\n?>\n\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Order Confirmation</title>\n</head>\n<body>\n    <h1>Thank you for your purchase!</h1>\n    <?php if (isset($_SESSION['order'])): ?>\n        <p>Your order has been successfully placed.</p>\n        <p>Name: <?php echo $_SESSION['order']['user_name']; ?></p>\n        <p>Email: <?php echo $_SESSION['order']['email']; ?></p>\n        <p>Address: <?php echo $_SESSION['order']['address']; ?></p>\n        <p>Phone Number: <?php echo $_SESSION['order']['phone']; ?></p>\n        \n        <!-- Display order details -->\n        <?php foreach ($_SESSION['cart'] as $item): ?>\n            <div style=\"border: 1px solid #ddd; padding: 10px; margin-bottom: 10px;\">\n                <h3><?php echo $item['name']; ?></h3>\n                <p>Quantity: <?php echo $item['quantity']; ?></p>\n                <p>Total: <?php echo \"$\" . number_format(($item['price'] * $item['quantity']), 2); ?></p>\n            </div>\n        <?php endforeach; ?>\n        \n        <p>Your order will be processed shortly.</p>\n    <?php endif; ?>\n</body>\n</html>\n\n<?php\n// Unset order details after confirmation\nunset($_SESSION['order']);\n?>\n```\n\n### 8. Database connection file (`db_connection.php`):\n\n```php\n<?php\n$servername = \"localhost\";\n$username = \"root\";\n$password = \"\";\n$dbname = \"your_database_name\";\n\n$conn = new mysqli($servername, $username, $password, $dbname);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n?>\n```\n\n### Explanation:\n\n1. **Products Page**: Displays all available products with their details and an option to add them to the cart.\n\n2. **Add to Cart**: Adds selected products to the shopping cart (stored in session).\n\n3. **Shopping Cart**: Shows items added to the cart, allows users to modify quantities or remove items.\n\n4. **Checkout**: Collects user information for processing the order.\n\n5. **Order Confirmation**: Displays a confirmation message after successful purchase and stores the order details in the database.\n\n### Features:\n\n- Simple product display\n- Add/remove items from cart\n- Basic checkout functionality\n- Order confirmation page\n- Database integration\n\nThis is a basic implementation that you can expand upon based on your specific needs. You might want to add features like:\n\n- User authentication\n- More payment options (integration with PayPal, Stripe, etc.)\n- Email notifications for orders\n- Admin panel for managing products and orders\n- Stock management\n- Error handling\n- Security measures (e.g., CSRF protection)\n\nLet me know if you'd like to expand on any of these features or need help with a specific part!", "code_blocks": [null, "```php\n<?php\nsession_start();\nrequire_once \"db_connection.php\";\n\n// Fetch all products from database\n$products = $conn->query(\"SELECT * FROM products\");\n?>\n\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Products</title>\n</head>\n<body>\n    <h1>Available Products</h1>\n    <?php while ($product = $products->fetch_assoc()): ?>\n        <div style=\"border: 1px solid #ddd; padding: 10px; margin-bottom: 10px;\">\n            <h3><?php echo $product['name']; ?></h3>\n            <p><?php echo $product['description']; ?></p>\n            <p>Price: <?php echo \"$\" . number_format($product['price'], 2); ?></p>\n            <form action=\"add_to_cart.php\" method=\"GET\">\n                <input type=\"hidden\" name=\"id\" value=\"<?php echo $product['id']; ?>\">\n                <?php if ($product['stock'] > 0): ?>\n                    <button type=\"submit\">Buy Now</button>\n                <?php else: ?>\n                    <p>Out of stock</p>\n                <?php endif; ?>\n            </form>\n        </div>\n    <?php endwhile; ?>\n\n    <a href=\"cart.php\">View Cart</a>\n</body>\n</html>\n```", "```php\n<?php\nsession_start();\nrequire_once \"db_connection.php\";\n\nif (isset($_GET['id'])) {\n    $product_id = $_GET['id'];\n    \n    // Fetch product details from database\n    $result = $conn->query(\"SELECT * FROM products WHERE id = $product_id\");\n    if ($product = $result->fetch_assoc()) {\n        // Add to cart\n        $cart_item = array(\n            'id' => $product['id'],\n            'name' => $product['name'],\n            'price' => $product['price'],\n            'quantity' => 1\n        );\n        \n        if (empty($_SESSION['cart'])) {\n            $_SESSION['cart'] = array();\n        }\n        \n        // Add product to cart or increase quantity if already present\n        $found_product = false;\n        foreach ($_SESSION['cart'] as &$item) {\n            if ($item['id'] == $product_id) {\n                $item['quantity']++;\n                $found_product = true;\n                break;\n            }\n        }\n        \n        if (!$found_product) {\n            array_push($_SESSION['cart'], $cart_item);\n        }\n    } else {\n        // Product not found\n        echo \"Product not found!\";\n    }\n}\n\nheader(\"Location: cart.php\");\nexit();\n?>\n```", "```php\n<?php\nsession_start();\nrequire_once \"db_connection.php\";\n\n// Calculate subtotal\n$subtotal = 0;\nforeach ($_SESSION['cart'] as $item) {\n    $subtotal += ($item['price'] * $item['quantity']);\n}\n?>\n\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Shopping Cart</title>\n</head>\n<body>\n    <h1>Your Shopping Cart</h1>\n    \n    <?php if (!empty($_SESSION['cart'])): ?>\n        <form action=\"checkout.php\" method=\"POST\">\n            <?php foreach ($_SESSION['cart'] as $item): ?>\n                <div style=\"border: 1px solid #ddd; padding: 10px; margin-bottom: 10px;\">\n                    <h3><?php echo $item['name']; ?></h3>\n                    <p>Price: <?php echo \"$\" . number_format($item['price'], 2); ?></p>\n                    <input type=\"number\" name=\"quantity_<?php echo $item['id']; ?>\" value=\"<?php echo $item['quantity']; ?>\" min=\"1\">\n                    <a href=\"remove_from_cart.php?id=<?php echo $item['id']; ?>\">Remove</a>\n                </div>\n            <?php endforeach; ?>\n            \n            <p>Subtotal: <?php echo \"$\" . number_format($subtotal, 2); ?></p>\n            <button type=\"submit\">Checkout</button>\n        </form>\n    <?php else: ?>\n        <p>Your cart is empty.</p>\n    <?php endif; ?>\n\n    <a href=\"products.php\">Continue Shopping</a>\n</body>\n</html>\n```", "```php\n<?php\nsession_start();\n\nif (isset($_GET['id'])) {\n    $product_id = $_GET['id'];\n    \n    // Remove product from cart\n    foreach ($_SESSION['cart'] as $key => $item) {\n        if ($item['id'] == $product_id) {\n            unset($_SESSION['cart'][$key]);\n            break;\n        }\n    }\n    \n    // Re-index array keys\n    $_SESSION['cart'] = array_values($_SESSION['cart']);\n}\n\nheader(\"Location: cart.php\");\nexit();\n?>\n```", "```php\n<?php\nsession_start();\n\nif (!empty($_POST)) {\n    // Process order\n    $order_details = array(\n        'user_name' => $_POST['name'],\n        'email' => $_POST['email'],\n        'address' => $_POST['address'],\n        'phone' => $_POST['phone']\n    );\n    \n    // Store order details in session for confirmation page\n    $_SESSION['order'] = $order_details;\n    header(\"Location: order_confirmation.php\");\n} else {\n    // Show checkout form\n?>\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Checkout</title>\n</head>\n<body>\n    <h1>Checkout</h1>\n    <form action=\"checkout.php\" method=\"POST\">\n        <div style=\"border: 1px solid #ddd; padding: 20px;\">\n            <label for=\"name\">Name:</label><br>\n            <input type=\"text\" name=\"name\" required><br><br>\n            \n            <label for=\"email\">Email:</label><br>\n            <input type=\"email\" name=\"email\" required><br><br>\n            \n            <label for=\"address\">Address:</label><br>\n            <textarea name=\"address\" rows=\"3\" cols=\"40\" required></textarea><br><br>\n            \n            <label for=\"phone\">Phone Number:</label><br>\n            <input type=\"tel\" name=\"phone\" required><br><br>\n            \n            <h2>Payment Method</h2>\n            <input type=\"radio\" name=\"payment_method\" value=\"credit_card\" checked> Credit Card\n            <input type=\"radio\" name=\"payment_method\" value=\"paypal\"> PayPal<br><br>\n            \n            <!-- Add more payment method fields if needed -->\n        </div>\n        \n        <?php foreach ($_SESSION['cart'] as $item): ?>\n            <p><?php echo $item['name']; ?> x<?php echo $item['quantity']; ?></p>\n        <?php endforeach; ?>\n        \n        <button type=\"submit\">Complete Purchase</button>\n    </form>\n</body>\n</html>\n<?php } // End of POST check\n```", "```php\n<?php\nsession_start();\nrequire_once \"db_connection.php\";\n\n// Store order in database\nif (isset($_SESSION['order']) && !empty($_SESSION['cart'])) {\n    $user_name = $_SESSION['order']['user_name'];\n    $email = $_SESSION['order']['email'];\n    $address = $_SESSION['order']['address'];\n    $phone = $_SESSION['order']['phone'];\n    \n    foreach ($_SESSION['cart'] as $item) {\n        // Insert order into orders table\n        $stmt = $conn->prepare(\"INSERT INTO orders (product_id, user_name, quantity, total_price, purchase_date, payment_status) VALUES (?, ?, ?, ?, NOW(), ?)\");\n        $stmt->bind_param(\"iisds\", $item['id'], $user_name, $item['quantity'], ($item['price'] * $item['quantity']), 'completed');\n        $stmt->execute();\n    }\n    \n    // Clear cart\n    unset($_SESSION['cart']);\n}\n\n// Show confirmation message\n?>\n\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Order Confirmation</title>\n</head>\n<body>\n    <h1>Thank you for your purchase!</h1>\n    <?php if (isset($_SESSION['order'])): ?>\n        <p>Your order has been successfully placed.</p>\n        <p>Name: <?php echo $_SESSION['order']['user_name']; ?></p>\n        <p>Email: <?php echo $_SESSION['order']['email']; ?></p>\n        <p>Address: <?php echo $_SESSION['order']['address']; ?></p>\n        <p>Phone Number: <?php echo $_SESSION['order']['phone']; ?></p>\n        \n        <!-- Display order details -->\n        <?php foreach ($_SESSION['cart'] as $item): ?>\n            <div style=\"border: 1px solid #ddd; padding: 10px; margin-bottom: 10px;\">\n                <h3><?php echo $item['name']; ?></h3>\n                <p>Quantity: <?php echo $item['quantity']; ?></p>\n                <p>Total: <?php echo \"$\" . number_format(($item['price'] * $item['quantity']), 2); ?></p>\n            </div>\n        <?php endforeach; ?>\n        \n        <p>Your order will be processed shortly.</p>\n    <?php endif; ?>\n</body>\n</html>\n\n<?php\n// Unset order details after confirmation\nunset($_SESSION['order']);\n?>\n```", "```php\n<?php\n$servername = \"localhost\";\n$username = \"root\";\n$password = \"\";\n$dbname = \"your_database_name\";\n\n$conn = new mysqli($servername, $username, $password, $dbname);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n?>\n```"]}
