{"prompt": "Create a purchase functionality using php", "llm_output": "Here is an example of a basic purchase functionality using PHP, HTML, and MySQL:\n\n**Database Schema:**\n```sql\nCREATE TABLE products (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  name VARCHAR(255) NOT NULL,\n  price DECIMAL(10,2) NOT NULL\n);\n\nCREATE TABLE orders (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  customer_name VARCHAR(255) NOT NULL,\n  total DECIMAL(10,2) NOT NULL,\n  order_date DATE NOT NULL DEFAULT CURRENT_DATE\n);\n\nCREATE TABLE order_items (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  order_id INT NOT NULL,\n  product_id INT NOT NULL,\n  quantity INT NOT NULL,\n  FOREIGN KEY (order_id) REFERENCES orders(id),\n  FOREIGN KEY (product_id) REFERENCES products(id)\n);\n```\n**PHP Code:**\n```php\n// Connect to database\n$conn = mysqli_connect(\"localhost\", \"username\", \"password\", \"database\");\n\n// Function to add product to cart\nfunction add_to_cart($product_id, $quantity) {\n  global $conn;\n  $query = \"INSERT INTO order_items (order_id, product_id, quantity)\n            VALUES ('', '$product_id', '$quantity')\";\n  mysqli_query($conn, $query);\n}\n\n// Function to checkout and process payment\nfunction checkout() {\n  global $conn;\n  // Get total cost of items in cart\n  $total = 0;\n  $query = \"SELECT SUM(p.price * oi.quantity) as total\n            FROM order_items oi\n            JOIN products p ON oi.product_id = p.id\";\n  $result = mysqli_query($conn, $query);\n  while ($row = mysqli_fetch_assoc($result)) {\n    $total += $row['total'];\n  }\n\n  // Create new order and update order items with new order id\n  $order_id = mysqli_insert_id($conn);\n  $query = \"UPDATE order_items SET order_id = '$order_id' WHERE product_id IN (SELECT id FROM products)\";\n  mysqli_query($conn, $query);\n\n  // Process payment (for demonstration purposes, just saving to database)\n  $payment_method = $_POST['payment_method'];\n  $query = \"INSERT INTO payments (order_id, method) VALUES ('$order_id', '$payment_method')\";\n  mysqli_query($conn, $query);\n}\n\n// Function to display products and cart\nfunction display_products() {\n  global $conn;\n  // Get all products\n  $query = \"SELECT * FROM products\";\n  $result = mysqli_query($conn, $query);\n  while ($row = mysqli_fetch_assoc($result)) {\n    echo \"<p>ID: $row[id], Name: $row[name], Price: $row[price]</p>\";\n  }\n\n  // Get all items in cart\n  $query = \"SELECT * FROM order_items WHERE order_id = ''\";\n  $result = mysqli_query($conn, $query);\n  while ($row = mysqli_fetch_assoc($result)) {\n    echo \"<p>ID: $row[id], Product ID: $row[product_id], Quantity: $row[quantity]</p>\";\n  }\n}\n\n// Function to display checkout page\nfunction display_checkout() {\n  global $conn;\n  // Get total cost of items in cart\n  $total = 0;\n  $query = \"SELECT SUM(p.price * oi.quantity) as total\n            FROM order_items oi\n            JOIN products p ON oi.product_id = p.id\";\n  $result = mysqli_query($conn, $query);\n  while ($row = mysqli_fetch_assoc($result)) {\n    $total += $row['total'];\n  }\n  echo \"<p>Total: $total</p>\";\n}\n\n// Display products and cart\ndisplay_products();\n\n// Add product to cart\nif (isset($_POST['add_to_cart'])) {\n  add_to_cart($_POST['product_id'], $_POST['quantity']);\n}\n\n// Checkout and process payment\nif (isset($_POST['checkout'])) {\n  checkout();\n}\n```\n**HTML Code:**\n```html\n<!-- Display products and cart -->\n<h1>Products</h1>\n<ul>\n  <?php display_products(); ?>\n</ul>\n\n<form action=\"\" method=\"post\">\n  <input type=\"hidden\" name=\"add_to_cart\" value=\"true\">\n  <label for=\"product_id\">Product ID:</label>\n  <input type=\"text\" id=\"product_id\" name=\"product_id\"><br><br>\n  <label for=\"quantity\">Quantity:</label>\n  <input type=\"number\" id=\"quantity\" name=\"quantity\"><br><br>\n  <input type=\"submit\" value=\"Add to Cart\">\n</form>\n\n<!-- Display checkout page -->\n<h1>Checkout</h1>\n<form action=\"\" method=\"post\">\n  <input type=\"hidden\" name=\"checkout\" value=\"true\">\n  <label for=\"payment_method\">Payment Method:</label>\n  <select id=\"payment_method\" name=\"payment_method\">\n    <option value=\"credit_card\">Credit Card</option>\n    <option value=\"paypal\">PayPal</option>\n  </select><br><br>\n  <input type=\"submit\" value=\"Checkout\">\n</form>\n\n<!-- Display total cost of items in cart -->\n<p>Total: <?php echo $total; ?></p>\n```\nThis code allows users to view products and add them to a cart. The cart is stored in the `order_items` table, with each item having a reference to its corresponding product and quantity. When the user clicks \"Checkout\", the total cost of items in the cart is calculated and displayed on the page. If the user chooses to proceed with payment, their selection is saved to the database along with the order details.\n\nPlease note that this is a very basic example and you should consider implementing proper error handling, validation, and security measures in your production code.\n\nAlso, keep in mind that this example uses a simplified database schema for illustration purposes. You may need to modify it to suit your specific requirements.", "code_blocks": [null, "```php\n// Connect to database\n$conn = mysqli_connect(\"localhost\", \"username\", \"password\", \"database\");\n\n// Function to add product to cart\nfunction add_to_cart($product_id, $quantity) {\n  global $conn;\n  $query = \"INSERT INTO order_items (order_id, product_id, quantity)\n            VALUES ('', '$product_id', '$quantity')\";\n  mysqli_query($conn, $query);\n}\n\n// Function to checkout and process payment\nfunction checkout() {\n  global $conn;\n  // Get total cost of items in cart\n  $total = 0;\n  $query = \"SELECT SUM(p.price * oi.quantity) as total\n            FROM order_items oi\n            JOIN products p ON oi.product_id = p.id\";\n  $result = mysqli_query($conn, $query);\n  while ($row = mysqli_fetch_assoc($result)) {\n    $total += $row['total'];\n  }\n\n  // Create new order and update order items with new order id\n  $order_id = mysqli_insert_id($conn);\n  $query = \"UPDATE order_items SET order_id = '$order_id' WHERE product_id IN (SELECT id FROM products)\";\n  mysqli_query($conn, $query);\n\n  // Process payment (for demonstration purposes, just saving to database)\n  $payment_method = $_POST['payment_method'];\n  $query = \"INSERT INTO payments (order_id, method) VALUES ('$order_id', '$payment_method')\";\n  mysqli_query($conn, $query);\n}\n\n// Function to display products and cart\nfunction display_products() {\n  global $conn;\n  // Get all products\n  $query = \"SELECT * FROM products\";\n  $result = mysqli_query($conn, $query);\n  while ($row = mysqli_fetch_assoc($result)) {\n    echo \"<p>ID: $row[id], Name: $row[name], Price: $row[price]</p>\";\n  }\n\n  // Get all items in cart\n  $query = \"SELECT * FROM order_items WHERE order_id = ''\";\n  $result = mysqli_query($conn, $query);\n  while ($row = mysqli_fetch_assoc($result)) {\n    echo \"<p>ID: $row[id], Product ID: $row[product_id], Quantity: $row[quantity]</p>\";\n  }\n}\n\n// Function to display checkout page\nfunction display_checkout() {\n  global $conn;\n  // Get total cost of items in cart\n  $total = 0;\n  $query = \"SELECT SUM(p.price * oi.quantity) as total\n            FROM order_items oi\n            JOIN products p ON oi.product_id = p.id\";\n  $result = mysqli_query($conn, $query);\n  while ($row = mysqli_fetch_assoc($result)) {\n    $total += $row['total'];\n  }\n  echo \"<p>Total: $total</p>\";\n}\n\n// Display products and cart\ndisplay_products();\n\n// Add product to cart\nif (isset($_POST['add_to_cart'])) {\n  add_to_cart($_POST['product_id'], $_POST['quantity']);\n}\n\n// Checkout and process payment\nif (isset($_POST['checkout'])) {\n  checkout();\n}\n```", null]}
