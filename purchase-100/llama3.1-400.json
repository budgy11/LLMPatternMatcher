{"prompt": "Create a purchase functionality using php", "llm_output": "Here's an example of a basic purchase functionality in PHP. This example assumes that you have already set up a database to store the products and customers, and that you have the necessary permissions to execute SQL queries.\n\n**Database Schema**\n\nFor this example, let's assume we have two tables: `products` and `orders`. The `products` table has the following columns:\n\n| Column Name | Data Type |\n| --- | --- |\n| id | int (primary key) |\n| name | varchar(255) |\n| price | decimal(10,2) |\n\nThe `orders` table has the following columns:\n\n| Column Name | Data Type |\n| --- | --- |\n| id | int (primary key) |\n| customer_id | int (foreign key referencing the customers table) |\n| product_id | int (foreign key referencing the products table) |\n| quantity | int |\n| total_cost | decimal(10,2) |\n\n**PHP Code**\n\nCreate a new PHP file called `purchase.php` and add the following code:\n```php\n<?php\n\n// Include database connection script\nrequire_once 'db_connect.php';\n\n// Check if user is logged in\nif (!isset($_SESSION['customer_id'])) {\n    header('Location: login.php');\n    exit;\n}\n\n// Set up form data\n$product_id = isset($_POST['product_id']) ? $_POST['product_id'] : '';\n$quantity = isset($_POST['quantity']) ? $_POST['quantity'] : '';\n\n// Validate form data\nif (empty($product_id) || empty($quantity)) {\n    echo 'Error: Please select a product and quantity.';\n    exit;\n}\n\n// Check if product exists\n$product_query = \"SELECT * FROM products WHERE id = '$product_id'\";\n$product_result = mysqli_query($conn, $product_query);\nif (!$product_result) {\n    echo 'Error: Product not found.';\n    exit;\n}\n$product_data = mysqli_fetch_assoc($product_result);\n\n// Calculate total cost\n$total_cost = $product_data['price'] * $quantity;\n\n// Insert order into database\n$order_query = \"INSERT INTO orders (customer_id, product_id, quantity, total_cost) VALUES ('$customer_id', '$product_id', '$quantity', '$total_cost')\";\n$order_result = mysqli_query($conn, $order_query);\nif (!$order_result) {\n    echo 'Error: Unable to place order.';\n    exit;\n}\n\n// Update product stock\n$stock_query = \"UPDATE products SET stock = stock - $quantity WHERE id = '$product_id'\";\n$stock_result = mysqli_query($conn, $stock_query);\nif (!$stock_result) {\n    echo 'Error: Unable to update stock.';\n    exit;\n}\n\n// Display success message\necho 'Order placed successfully!';\nexit;\n\n?>\n```\n**HTML Form**\n\nCreate an HTML form to collect user input:\n```html\n<form action=\"purchase.php\" method=\"post\">\n  <label for=\"product_id\">Select Product:</label>\n  <select name=\"product_id\" id=\"product_id\">\n    <?php foreach ($products as $product): ?>\n      <option value=\"<?php echo $product['id']; ?>\"><?php echo $product['name']; ?></option>\n    <?php endforeach; ?>\n  </select>\n\n  <label for=\"quantity\">Quantity:</label>\n  <input type=\"number\" name=\"quantity\" id=\"quantity\">\n\n  <button type=\"submit\">Place Order</button>\n</form>\n```\nThis code assumes you have a separate PHP script to handle database connections, and that you are using the `mysqli` extension. You'll need to modify the code to fit your specific needs.\n\nNote: This is a basic example and doesn't include any error handling or security measures (e.g., SQL injection protection). Make sure to add these features in a production environment!", "code_blocks": ["```php\n<?php\n\n// Include database connection script\nrequire_once 'db_connect.php';\n\n// Check if user is logged in\nif (!isset($_SESSION['customer_id'])) {\n    header('Location: login.php');\n    exit;\n}\n\n// Set up form data\n$product_id = isset($_POST['product_id']) ? $_POST['product_id'] : '';\n$quantity = isset($_POST['quantity']) ? $_POST['quantity'] : '';\n\n// Validate form data\nif (empty($product_id) || empty($quantity)) {\n    echo 'Error: Please select a product and quantity.';\n    exit;\n}\n\n// Check if product exists\n$product_query = \"SELECT * FROM products WHERE id = '$product_id'\";\n$product_result = mysqli_query($conn, $product_query);\nif (!$product_result) {\n    echo 'Error: Product not found.';\n    exit;\n}\n$product_data = mysqli_fetch_assoc($product_result);\n\n// Calculate total cost\n$total_cost = $product_data['price'] * $quantity;\n\n// Insert order into database\n$order_query = \"INSERT INTO orders (customer_id, product_id, quantity, total_cost) VALUES ('$customer_id', '$product_id', '$quantity', '$total_cost')\";\n$order_result = mysqli_query($conn, $order_query);\nif (!$order_result) {\n    echo 'Error: Unable to place order.';\n    exit;\n}\n\n// Update product stock\n$stock_query = \"UPDATE products SET stock = stock - $quantity WHERE id = '$product_id'\";\n$stock_result = mysqli_query($conn, $stock_query);\nif (!$stock_result) {\n    echo 'Error: Unable to update stock.';\n    exit;\n}\n\n// Display success message\necho 'Order placed successfully!';\nexit;\n\n?>\n```", null]}
