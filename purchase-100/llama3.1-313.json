{"prompt": "Create a purchase functionality using php", "llm_output": "Here is an example of a simple purchase functionality using PHP, HTML, and MySQL. This example includes user authentication, cart management, and order placement.\n\n**Database Schema**\n\nBefore we start coding, let's define the database schema for our application:\n\n```sql\nCREATE TABLE users (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  username VARCHAR(255),\n  email VARCHAR(255),\n  password VARCHAR(255)\n);\n\nCREATE TABLE products (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  name VARCHAR(255),\n  description TEXT,\n  price DECIMAL(10,2)\n);\n\nCREATE TABLE carts (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  user_id INT,\n  FOREIGN KEY (user_id) REFERENCES users(id)\n);\n\nCREATE TABLE cart_items (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  cart_id INT,\n  product_id INT,\n  quantity INT,\n  FOREIGN KEY (cart_id) REFERENCES carts(id),\n  FOREIGN KEY (product_id) REFERENCES products(id)\n);\n\nCREATE TABLE orders (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  user_id INT,\n  order_date DATE,\n  total DECIMAL(10,2),\n  FOREIGN KEY (user_id) REFERENCES users(id)\n);\n\nCREATE TABLE order_items (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  order_id INT,\n  product_id INT,\n  quantity INT,\n  FOREIGN KEY (order_id) REFERENCES orders(id),\n  FOREIGN KEY (product_id) REFERENCES products(id)\n);\n```\n\n**PHP Code**\n\nNow, let's create the PHP code for our purchase functionality.\n\n**login.php**\n```php\n<?php\nsession_start();\n\nif ($_SERVER[\"REQUEST_METHOD\"] == \"POST\") {\n    $username = $_POST[\"username\"];\n    $password = $_POST[\"password\"];\n\n    // Connect to database\n    $conn = mysqli_connect(\"localhost\", \"root\", \"\", \"store\");\n\n    // Check if user exists and password is correct\n    $query = \"SELECT * FROM users WHERE username = '$username' AND password = '$password'\";\n    $result = mysqli_query($conn, $query);\n\n    if (mysqli_num_rows($result) > 0) {\n        $_SESSION[\"user_id\"] = mysqli_fetch_assoc($result)[\"id\"];\n        header(\"Location: index.php\");\n    } else {\n        echo \"Invalid username or password\";\n    }\n}\n?>\n```\n\n**index.php**\n```php\n<?php\nsession_start();\n\n// Check if user is logged in\nif (!isset($_SESSION[\"user_id\"])) {\n    header(\"Location: login.php\");\n}\n\n// Get user ID from session\n$user_id = $_SESSION[\"user_id\"];\n\n// Connect to database\n$conn = mysqli_connect(\"localhost\", \"root\", \"\", \"store\");\n\n// Display products and cart items\n$query = \"SELECT * FROM products\";\n$result = mysqli_query($conn, $query);\n\n$product_list = \"\";\nwhile ($row = mysqli_fetch_assoc($result)) {\n    $product_list .= \"<li><a href='view_product.php?id=\" . $row[\"id\"] . \"'>\" . $row[\"name\"] . \"</a> - $\" . $row[\"price\"] . \"</li>\";\n}\n\n$query = \"SELECT * FROM cart_items WHERE user_id = '$user_id'\";\n$result = mysqli_query($conn, $query);\n\n$cart_list = \"\";\nwhile ($row = mysqli_fetch_assoc($result)) {\n    $cart_list .= \"<li>\" . $row[\"product_name\"] . \" x \" . $row[\"quantity\"] . \"</li>\";\n}\n\necho \"<h1>Products</h1><ul>$product_list</ul>\";\n\necho \"<h1>Cart</h1><ul>$cart_list</ul>\";\n\n// Display cart and checkout buttons\nif (isset($_SESSION[\"cart_id\"])) {\n    echo \"<a href='checkout.php'>Checkout</a>\";\n} else {\n    echo \"<button onclick='add_to_cart()'>Add to Cart</button>\";\n}\n?>\n```\n\n**view_product.php**\n```php\n<?php\n// Get product ID from URL parameter\n$product_id = $_GET[\"id\"];\n\n// Connect to database\n$conn = mysqli_connect(\"localhost\", \"root\", \"\", \"store\");\n\n// Display product details and add to cart button\n$query = \"SELECT * FROM products WHERE id = '$product_id'\";\n$result = mysqli_query($conn, $query);\n\n$row = mysqli_fetch_assoc($result);\necho \"<h1>\" . $row[\"name\"] . \"</h1><p>\" . $row[\"description\"] . \"</p>\";\n\n// Add to cart button\necho \"<button onclick='add_to_cart(\" . $product_id . \")'>Add to Cart</button>\";\n?>\n```\n\n**cart.php**\n```php\n<?php\n// Get user ID from session\n$user_id = $_SESSION[\"user_id\"];\n\n// Connect to database\n$conn = mysqli_connect(\"localhost\", \"root\", \"\", \"store\");\n\n// Display cart items and checkout button\n$query = \"SELECT * FROM cart_items WHERE user_id = '$user_id'\";\n$result = mysqli_query($conn, $query);\n\n$cart_list = \"\";\nwhile ($row = mysqli_fetch_assoc($result)) {\n    $cart_list .= \"<li>\" . $row[\"product_name\"] . \" x \" . $row[\"quantity\"] . \"</li>\";\n}\n\necho \"<h1>Cart</h1><ul>$cart_list</ul>\";\n\n// Display checkout button\nif (isset($_SESSION[\"cart_id\"])) {\n    echo \"<a href='checkout.php'>Checkout</a>\";\n} else {\n    echo \"<button onclick='add_to_cart()'>Add to Cart</button>\";\n}\n?>\n```\n\n**checkout.php**\n```php\n<?php\n// Get user ID from session\n$user_id = $_SESSION[\"user_id\"];\n\n// Connect to database\n$conn = mysqli_connect(\"localhost\", \"root\", \"\", \"store\");\n\n// Create new order and save cart items\n$query = \"INSERT INTO orders (user_id, total) VALUES ('$user_id', 0)\";\nmysqli_query($conn, $query);\n\n$cart_id = $_SESSION[\"cart_id\"];\n\n$query = \"SELECT * FROM cart_items WHERE cart_id = '$cart_id'\";\n$result = mysqli_query($conn, $query);\n\nwhile ($row = mysqli_fetch_assoc($result)) {\n    $product_id = $row[\"product_id\"];\n    $quantity = $row[\"quantity\"];\n\n    // Update product stock\n    $query = \"UPDATE products SET stock = stock - $quantity WHERE id = '$product_id'\";\n    mysqli_query($conn, $query);\n\n    // Save order item\n    $query = \"INSERT INTO order_items (order_id, product_id, quantity) VALUES (LAST_INSERT_ID(), '$product_id', '$quantity')\";\n    mysqli_query($conn, $query);\n}\n\n// Update cart status to paid\n$query = \"UPDATE carts SET status = 'paid' WHERE id = '$cart_id'\";\nmysqli_query($conn, $query);\n\n// Clear cart and redirect to order summary page\n$_SESSION[\"cart_id\"] = NULL;\nheader(\"Location: ordersummary.php\");\n?>\n```\n\nThis code creates a simple e-commerce application with user authentication, product display, cart management, and checkout functionality. Note that this is just an example and you should adapt it to your specific needs.\n\nAlso note that this example uses MySQLi for database operations, but you may want to use a more modern PHP extension like PDO or a PHP framework like Laravel for production applications.\n\nYou will also need to add JavaScript code to handle the cart functionality (e.g., adding products to cart). This example only includes server-side PHP code.", "code_blocks": [null, "```php\n<?php\nsession_start();\n\nif ($_SERVER[\"REQUEST_METHOD\"] == \"POST\") {\n    $username = $_POST[\"username\"];\n    $password = $_POST[\"password\"];\n\n    // Connect to database\n    $conn = mysqli_connect(\"localhost\", \"root\", \"\", \"store\");\n\n    // Check if user exists and password is correct\n    $query = \"SELECT * FROM users WHERE username = '$username' AND password = '$password'\";\n    $result = mysqli_query($conn, $query);\n\n    if (mysqli_num_rows($result) > 0) {\n        $_SESSION[\"user_id\"] = mysqli_fetch_assoc($result)[\"id\"];\n        header(\"Location: index.php\");\n    } else {\n        echo \"Invalid username or password\";\n    }\n}\n?>\n```", "```php\n<?php\nsession_start();\n\n// Check if user is logged in\nif (!isset($_SESSION[\"user_id\"])) {\n    header(\"Location: login.php\");\n}\n\n// Get user ID from session\n$user_id = $_SESSION[\"user_id\"];\n\n// Connect to database\n$conn = mysqli_connect(\"localhost\", \"root\", \"\", \"store\");\n\n// Display products and cart items\n$query = \"SELECT * FROM products\";\n$result = mysqli_query($conn, $query);\n\n$product_list = \"\";\nwhile ($row = mysqli_fetch_assoc($result)) {\n    $product_list .= \"<li><a href='view_product.php?id=\" . $row[\"id\"] . \"'>\" . $row[\"name\"] . \"</a> - $\" . $row[\"price\"] . \"</li>\";\n}\n\n$query = \"SELECT * FROM cart_items WHERE user_id = '$user_id'\";\n$result = mysqli_query($conn, $query);\n\n$cart_list = \"\";\nwhile ($row = mysqli_fetch_assoc($result)) {\n    $cart_list .= \"<li>\" . $row[\"product_name\"] . \" x \" . $row[\"quantity\"] . \"</li>\";\n}\n\necho \"<h1>Products</h1><ul>$product_list</ul>\";\n\necho \"<h1>Cart</h1><ul>$cart_list</ul>\";\n\n// Display cart and checkout buttons\nif (isset($_SESSION[\"cart_id\"])) {\n    echo \"<a href='checkout.php'>Checkout</a>\";\n} else {\n    echo \"<button onclick='add_to_cart()'>Add to Cart</button>\";\n}\n?>\n```", "```php\n<?php\n// Get product ID from URL parameter\n$product_id = $_GET[\"id\"];\n\n// Connect to database\n$conn = mysqli_connect(\"localhost\", \"root\", \"\", \"store\");\n\n// Display product details and add to cart button\n$query = \"SELECT * FROM products WHERE id = '$product_id'\";\n$result = mysqli_query($conn, $query);\n\n$row = mysqli_fetch_assoc($result);\necho \"<h1>\" . $row[\"name\"] . \"</h1><p>\" . $row[\"description\"] . \"</p>\";\n\n// Add to cart button\necho \"<button onclick='add_to_cart(\" . $product_id . \")'>Add to Cart</button>\";\n?>\n```", "```php\n<?php\n// Get user ID from session\n$user_id = $_SESSION[\"user_id\"];\n\n// Connect to database\n$conn = mysqli_connect(\"localhost\", \"root\", \"\", \"store\");\n\n// Display cart items and checkout button\n$query = \"SELECT * FROM cart_items WHERE user_id = '$user_id'\";\n$result = mysqli_query($conn, $query);\n\n$cart_list = \"\";\nwhile ($row = mysqli_fetch_assoc($result)) {\n    $cart_list .= \"<li>\" . $row[\"product_name\"] . \" x \" . $row[\"quantity\"] . \"</li>\";\n}\n\necho \"<h1>Cart</h1><ul>$cart_list</ul>\";\n\n// Display checkout button\nif (isset($_SESSION[\"cart_id\"])) {\n    echo \"<a href='checkout.php'>Checkout</a>\";\n} else {\n    echo \"<button onclick='add_to_cart()'>Add to Cart</button>\";\n}\n?>\n```", "```php\n<?php\n// Get user ID from session\n$user_id = $_SESSION[\"user_id\"];\n\n// Connect to database\n$conn = mysqli_connect(\"localhost\", \"root\", \"\", \"store\");\n\n// Create new order and save cart items\n$query = \"INSERT INTO orders (user_id, total) VALUES ('$user_id', 0)\";\nmysqli_query($conn, $query);\n\n$cart_id = $_SESSION[\"cart_id\"];\n\n$query = \"SELECT * FROM cart_items WHERE cart_id = '$cart_id'\";\n$result = mysqli_query($conn, $query);\n\nwhile ($row = mysqli_fetch_assoc($result)) {\n    $product_id = $row[\"product_id\"];\n    $quantity = $row[\"quantity\"];\n\n    // Update product stock\n    $query = \"UPDATE products SET stock = stock - $quantity WHERE id = '$product_id'\";\n    mysqli_query($conn, $query);\n\n    // Save order item\n    $query = \"INSERT INTO order_items (order_id, product_id, quantity) VALUES (LAST_INSERT_ID(), '$product_id', '$quantity')\";\n    mysqli_query($conn, $query);\n}\n\n// Update cart status to paid\n$query = \"UPDATE carts SET status = 'paid' WHERE id = '$cart_id'\";\nmysqli_query($conn, $query);\n\n// Clear cart and redirect to order summary page\n$_SESSION[\"cart_id\"] = NULL;\nheader(\"Location: ordersummary.php\");\n?>\n```"]}
