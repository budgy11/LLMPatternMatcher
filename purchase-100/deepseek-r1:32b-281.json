{"prompt": "Create a purchase functionality using php", "llm_output": "<think>\nAlright, the user wants to create a purchase functionality using PHP. I need to figure out how to approach this.\n\nFirst, I should outline what's essential in such a system. It needs a product list so users can see what's available. Then, there should be a way for users to add items to their cart. After that, the checkout process where they review their order and confirm the purchase is crucial. Finally, tracking the purchases makes sense.\n\nI'll start by setting up the database because it's the foundation. I'll create three tables: products, shopping_cart, and purchases. Each with necessary fields like product ID, name, price, user ID, quantity, etc.\n\nNext, connecting to the database in PHP is a must. Using mysqli or PDO for security. Since the example uses mysqli, I'll stick with that but remind the user about prepared statements for safety.\n\nFor adding products, I'll write a function that inserts into the products table. Then, the display_products function will fetch and show all available items. This helps users see what they can buy.\n\nThe add_to_cart function needs to handle adding items to the shopping cart. It should check if the item already exists in the cart for the user. If it does, increment the quantity; otherwise, add a new entry. This prevents duplicate entries and keeps track of quantities accurately.\n\nWhen a user reviews their cart, the get_cart_contents function fetches all items from the shopping cart for that user. It also calculates the total price to display.\n\nProcessing checkout involves moving items from the shopping cart to purchases. The checkout function loops through each item in the cart, inserts them into the purchases table with the current timestamp, and then clears the cart. This ensures the purchase is recorded and the cart is reset.\n\nDisplaying purchase history requires fetching all purchases for a user, showing each product's name, price, quantity, total cost, and date. This gives users a clear view of their past transactions.\n\nI should also consider security aspects like sanitizing inputs to prevent SQL injection. Prepared statements would be better here, but I'll note that for the user to implement.\n\nIn the example usage, I included steps to add products, display them, add items to cart, checkout, and show purchase history. This gives a clear flow of how each function is used in a real scenario.\n\nFinally, I thought about possible enhancements like adding more product details, handling payments, user authentication, and error checking. These are important for a robust application but were beyond the initial scope.\n\nOverall, the code provides a basic structure that the user can build upon, ensuring they have a solid starting point for their purchase functionality.\n</think>\n\nHere's an example of how you can create a simple purchase functionality using PHP. This will include:\n\n1. Product listing\n2. Adding items to cart\n3. Checkout process\n4. Purchase tracking\n\n```php\n<?php\n// Database connection\n$servername = \"localhost\";\n$username = \"username\";\n$password = \"password\";\n$dbname = \"shop\";\n\n$conn = mysqli_connect($servername, $username, $password, $dbname);\nif (!$conn) {\n    die(\"Connection failed: \" . mysqli_connect_error());\n}\n\n// Create products table if not exists\n$sql = \"CREATE TABLE IF NOT EXISTS products (\nid INT AUTO_INCREMENT PRIMARY KEY,\nproduct_name VARCHAR(255),\nprice DECIMAL(10,2)\n)\";\nmysqli_query($conn, $sql);\n\n// Create shopping cart table if not exists\n$sql = \"CREATE TABLE IF NOT EXISTS shopping_cart (\nid INT AUTO_INCREMENT PRIMARY KEY,\nuser_id INT,\nproduct_id INT,\nquantity INT\n)\";\nmysqli_query($conn, $sql);\n\n// Create purchases table if not exists\n$sql = \"CREATE TABLE IF NOT EXISTS purchases (\nid INT AUTO_INCREMENT PRIMARY KEY,\nuser_id INT,\nproduct_id INT,\nquantity INT,\ntotal DECIMAL(10,2),\npurchase_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n)\";\nmysqli_query($conn, $sql);\n\n// Function to add products\nfunction addProduct($name, $price) {\n    global $conn;\n    $sql = \"INSERT INTO products (product_name, price) VALUES ('$name', '$price')\";\n    mysqli_query($conn, $sql);\n}\n\n// Function to display products\nfunction displayProducts() {\n    global $conn;\n    $sql = \"SELECT * FROM products\";\n    $result = mysqli_query($conn, $sql);\n    \n    while ($row = mysqli_fetch_assoc($result)) {\n        echo \"<div>\";\n        echo \"<h3>\".$row['product_name'].\"</h3>\";\n        echo \"<p>Price: $\".$row['price'].\"</p>\";\n        echo \"<a href='add_to_cart.php?id=\".$row['id'].\"'>Add to Cart</a>\";\n        echo \"</div>\";\n    }\n}\n\n// Function to add item to cart\nfunction addToCart($user_id, $product_id) {\n    global $conn;\n    $sql = \"SELECT * FROM shopping_cart WHERE user_id='$user_id' AND product_id='$product_id'\";\n    $result = mysqli_query($conn, $sql);\n    \n    if (mysqli_num_rows($result) > 0) {\n        // Increment quantity\n        $sql = \"UPDATE shopping_cart SET quantity=quantity+1 WHERE user_id='$user_id' AND product_id='$product_id'\";\n        mysqli_query($conn, $sql);\n    } else {\n        // Add new item\n        $sql = \"INSERT INTO shopping_cart (user_id, product_id, quantity) VALUES ('$user_id', '$product_id', '1')\";\n        mysqli_query($conn, $sql);\n    }\n}\n\n// Function to get cart contents\nfunction getCartContents($user_id) {\n    global $conn;\n    $sql = \"SELECT * FROM shopping_cart WHERE user_id='$user_id'\";\n    $result = mysqli_query($conn, $sql);\n    \n    $cart_items = array();\n    while ($row = mysqli_fetch_assoc($result)) {\n        $product_sql = \"SELECT * FROM products WHERE id=\".$row['product_id'];\n        $product_result = mysqli_query($conn, $product_sql);\n        $product_row = mysqli_fetch_assoc($product_result);\n        \n        $item = array(\n            'id' => $row['id'],\n            'product_name' => $product_row['product_name'],\n            'price' => $product_row['price'],\n            'quantity' => $row['quantity']\n        );\n        $cart_items[] = $item;\n    }\n    return $cart_items;\n}\n\n// Function to process checkout\nfunction checkout($user_id) {\n    global $conn;\n    $cart_items = getCartContents($user_id);\n    \n    foreach ($cart_items as $item) {\n        $total = $item['price'] * $item['quantity'];\n        \n        // Insert into purchases table\n        $sql = \"INSERT INTO purchases (user_id, product_id, quantity, total) \n                VALUES ('$user_id', '\".$item['id'].\"', '\".$item['quantity'].\"', '$total')\";\n        mysqli_query($conn, $sql);\n    }\n    \n    // Clear shopping cart\n    $sql = \"DELETE FROM shopping_cart WHERE user_id='$user_id'\";\n    mysqli_query($conn, $sql);\n}\n\n// Function to display purchase history\nfunction displayPurchaseHistory($user_id) {\n    global $conn;\n    $sql = \"SELECT * FROM purchases WHERE user_id='$user_id' ORDER BY purchase_date DESC\";\n    $result = mysqli_query($conn, $sql);\n    \n    while ($row = mysqli_fetch_assoc($result)) {\n        // Get product details\n        $product_sql = \"SELECT * FROM products WHERE id=\".$row['product_id'];\n        $product_result = mysqli_query($conn, $product_sql);\n        $product_row = mysqli_fetch_assoc($product_result);\n        \n        echo \"<div>\";\n        echo \"<h4>\".$product_row['product_name'].\"</h4>\";\n        echo \"<p>Quantity: \".$row['quantity'].\"</p>\";\n        echo \"<p>Price: $\".$row['total'].\"</p>\";\n        echo \"<p>Date: \".date('Y-m-d H:i:s', strtotime($row['purchase_date'])).\"</p>\";\n        echo \"</div>\";\n    }\n}\n?>\n```\n\nThis code provides a basic purchase functionality with the following features:\n\n1. Product management\n2. Shopping cart functionality\n3. Checkout process\n4. Purchase history tracking\n\nTo use this code:\n\n1. Create a database and tables as specified in the code\n2. Add products to your store using `addProduct()` function\n3. Users can add items to their cart using the \"Add to Cart\" link\n4. Display shopping cart contents using `getCartContents()`\n5. Process purchases using `checkout()`\n6. View purchase history using `displayPurchaseHistory()`\n\nExample usage:\n\n```php\n<?php\n// Add some products\naddProduct(\"Laptop\", 999);\naddProduct(\"Smartphone\", 499);\naddProduct(\"Tablet\", 299);\n\n// Display all products\ndisplayProducts();\n\n// Example user ID (you should use actual user authentication)\n$user_id = 1;\n\n// Add item to cart\nif (isset($_GET['id'])) {\n    addToCart($user_id, $_GET['id']);\n}\n\n// Checkout process\nif (isset($_POST['checkout'])) {\n    checkout($user_id);\n}\n\n// Display purchase history\necho \"<h2>Purchase History</h2>\";\ndisplayPurchaseHistory($user_id);\n?>\n```\n\nTo enhance this basic implementation:\n\n1. Add more product details and attributes\n2. Implement a proper user authentication system\n3. Add payment processing (you can integrate with Stripe, PayPal, etc.)\n4. Add error handling and validation\n5. Implement quantity checks before adding to cart\n6. Add order status tracking\n7. Implement a refund system\n8. Add more security measures (like CSRF protection)\n9. Implement database connection pooling\n10. Add logging functionality\n\nRemember to always sanitize your inputs and use prepared statements to prevent SQL injection attacks in real-world applications.\n\nThis is just a basic implementation and you should consider adding more features based on your specific requirements.", "code_blocks": ["```php\n<?php\n// Database connection\n$servername = \"localhost\";\n$username = \"username\";\n$password = \"password\";\n$dbname = \"shop\";\n\n$conn = mysqli_connect($servername, $username, $password, $dbname);\nif (!$conn) {\n    die(\"Connection failed: \" . mysqli_connect_error());\n}\n\n// Create products table if not exists\n$sql = \"CREATE TABLE IF NOT EXISTS products (\nid INT AUTO_INCREMENT PRIMARY KEY,\nproduct_name VARCHAR(255),\nprice DECIMAL(10,2)\n)\";\nmysqli_query($conn, $sql);\n\n// Create shopping cart table if not exists\n$sql = \"CREATE TABLE IF NOT EXISTS shopping_cart (\nid INT AUTO_INCREMENT PRIMARY KEY,\nuser_id INT,\nproduct_id INT,\nquantity INT\n)\";\nmysqli_query($conn, $sql);\n\n// Create purchases table if not exists\n$sql = \"CREATE TABLE IF NOT EXISTS purchases (\nid INT AUTO_INCREMENT PRIMARY KEY,\nuser_id INT,\nproduct_id INT,\nquantity INT,\ntotal DECIMAL(10,2),\npurchase_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n)\";\nmysqli_query($conn, $sql);\n\n// Function to add products\nfunction addProduct($name, $price) {\n    global $conn;\n    $sql = \"INSERT INTO products (product_name, price) VALUES ('$name', '$price')\";\n    mysqli_query($conn, $sql);\n}\n\n// Function to display products\nfunction displayProducts() {\n    global $conn;\n    $sql = \"SELECT * FROM products\";\n    $result = mysqli_query($conn, $sql);\n    \n    while ($row = mysqli_fetch_assoc($result)) {\n        echo \"<div>\";\n        echo \"<h3>\".$row['product_name'].\"</h3>\";\n        echo \"<p>Price: $\".$row['price'].\"</p>\";\n        echo \"<a href='add_to_cart.php?id=\".$row['id'].\"'>Add to Cart</a>\";\n        echo \"</div>\";\n    }\n}\n\n// Function to add item to cart\nfunction addToCart($user_id, $product_id) {\n    global $conn;\n    $sql = \"SELECT * FROM shopping_cart WHERE user_id='$user_id' AND product_id='$product_id'\";\n    $result = mysqli_query($conn, $sql);\n    \n    if (mysqli_num_rows($result) > 0) {\n        // Increment quantity\n        $sql = \"UPDATE shopping_cart SET quantity=quantity+1 WHERE user_id='$user_id' AND product_id='$product_id'\";\n        mysqli_query($conn, $sql);\n    } else {\n        // Add new item\n        $sql = \"INSERT INTO shopping_cart (user_id, product_id, quantity) VALUES ('$user_id', '$product_id', '1')\";\n        mysqli_query($conn, $sql);\n    }\n}\n\n// Function to get cart contents\nfunction getCartContents($user_id) {\n    global $conn;\n    $sql = \"SELECT * FROM shopping_cart WHERE user_id='$user_id'\";\n    $result = mysqli_query($conn, $sql);\n    \n    $cart_items = array();\n    while ($row = mysqli_fetch_assoc($result)) {\n        $product_sql = \"SELECT * FROM products WHERE id=\".$row['product_id'];\n        $product_result = mysqli_query($conn, $product_sql);\n        $product_row = mysqli_fetch_assoc($product_result);\n        \n        $item = array(\n            'id' => $row['id'],\n            'product_name' => $product_row['product_name'],\n            'price' => $product_row['price'],\n            'quantity' => $row['quantity']\n        );\n        $cart_items[] = $item;\n    }\n    return $cart_items;\n}\n\n// Function to process checkout\nfunction checkout($user_id) {\n    global $conn;\n    $cart_items = getCartContents($user_id);\n    \n    foreach ($cart_items as $item) {\n        $total = $item['price'] * $item['quantity'];\n        \n        // Insert into purchases table\n        $sql = \"INSERT INTO purchases (user_id, product_id, quantity, total) \n                VALUES ('$user_id', '\".$item['id'].\"', '\".$item['quantity'].\"', '$total')\";\n        mysqli_query($conn, $sql);\n    }\n    \n    // Clear shopping cart\n    $sql = \"DELETE FROM shopping_cart WHERE user_id='$user_id'\";\n    mysqli_query($conn, $sql);\n}\n\n// Function to display purchase history\nfunction displayPurchaseHistory($user_id) {\n    global $conn;\n    $sql = \"SELECT * FROM purchases WHERE user_id='$user_id' ORDER BY purchase_date DESC\";\n    $result = mysqli_query($conn, $sql);\n    \n    while ($row = mysqli_fetch_assoc($result)) {\n        // Get product details\n        $product_sql = \"SELECT * FROM products WHERE id=\".$row['product_id'];\n        $product_result = mysqli_query($conn, $product_sql);\n        $product_row = mysqli_fetch_assoc($product_result);\n        \n        echo \"<div>\";\n        echo \"<h4>\".$product_row['product_name'].\"</h4>\";\n        echo \"<p>Quantity: \".$row['quantity'].\"</p>\";\n        echo \"<p>Price: $\".$row['total'].\"</p>\";\n        echo \"<p>Date: \".date('Y-m-d H:i:s', strtotime($row['purchase_date'])).\"</p>\";\n        echo \"</div>\";\n    }\n}\n?>\n```", "```php\n<?php\n// Add some products\naddProduct(\"Laptop\", 999);\naddProduct(\"Smartphone\", 499);\naddProduct(\"Tablet\", 299);\n\n// Display all products\ndisplayProducts();\n\n// Example user ID (you should use actual user authentication)\n$user_id = 1;\n\n// Add item to cart\nif (isset($_GET['id'])) {\n    addToCart($user_id, $_GET['id']);\n}\n\n// Checkout process\nif (isset($_POST['checkout'])) {\n    checkout($user_id);\n}\n\n// Display purchase history\necho \"<h2>Purchase History</h2>\";\ndisplayPurchaseHistory($user_id);\n?>\n```"]}
