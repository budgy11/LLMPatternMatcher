{"prompt": "Create a purchase functionality using php", "llm_output": "**Purchase Functionality in PHP**\n=====================================\n\nThis is an example of how to create a basic purchase functionality in PHP. We will use MySQL as the database management system.\n\n### Database Schema\n\nFirst, let's define the database schema for our application.\n```sql\nCREATE TABLE users (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  username VARCHAR(255),\n  password VARCHAR(255)\n);\n\nCREATE TABLE products (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  name VARCHAR(255),\n  price DECIMAL(10,2)\n);\n\nCREATE TABLE orders (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  user_id INT,\n  total DECIMAL(10,2),\n  FOREIGN KEY (user_id) REFERENCES users(id)\n);\n\nCREATE TABLE order_items (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  order_id INT,\n  product_id INT,\n  quantity INT,\n  FOREIGN KEY (order_id) REFERENCES orders(id),\n  FOREIGN KEY (product_id) REFERENCES products(id)\n);\n```\n### PHP Code\n\nNow, let's write the PHP code for our purchase functionality.\n```php\n// config.php\n<?php\n$db_host = 'localhost';\n$db_username = 'root';\n$db_password = '';\n$db_name = 'database';\n\n$conn = new mysqli($db_host, $db_username, $db_password, $db_name);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n?>\n\n// purchase.php\n<?php\nrequire_once 'config.php';\n\n// Function to add a product to the cart\nfunction add_product_to_cart($product_id, $quantity) {\n    global $conn;\n    $sql = \"INSERT INTO order_items (order_id, product_id, quantity)\n            VALUES ((SELECT id FROM orders WHERE user_id = ?), ?, ?)\";\n    $stmt = $conn->prepare($sql);\n    $stmt->bind_param(\"iii\", $_SESSION['user_id'], $product_id, $quantity);\n    $stmt->execute();\n}\n\n// Function to create a new order\nfunction create_order() {\n    global $conn;\n    $sql = \"INSERT INTO orders (user_id, total)\n            VALUES (?, 0)\";\n    $stmt = $conn->prepare($sql);\n    $stmt->bind_param(\"i\", $_SESSION['user_id']);\n    $stmt->execute();\n}\n\n// Function to calculate the total cost of a cart\nfunction calculate_total() {\n    global $conn;\n    $sql = \"SELECT SUM(p.price * oi.quantity) AS total FROM products p\n            JOIN order_items oi ON p.id = oi.product_id\n            WHERE oi.order_id = (SELECT id FROM orders WHERE user_id = ?)\";\n    $stmt = $conn->prepare($sql);\n    $stmt->bind_param(\"i\", $_SESSION['user_id']);\n    $stmt->execute();\n    return $stmt->get_result()->fetch_assoc()['total'];\n}\n\n// Function to complete a purchase\nfunction complete_purchase() {\n    global $conn;\n    create_order();\n    $order_id = $conn->insert_id;\n    $total = calculate_total();\n\n    // Update the total cost of the order\n    $sql = \"UPDATE orders SET total = ? WHERE id = ?\";\n    $stmt = $conn->prepare($sql);\n    $stmt->bind_param(\"di\", $total, $order_id);\n    $stmt->execute();\n\n    // Clear the cart\n    $sql = \"DELETE FROM order_items WHERE order_id = ?\";\n    $stmt = $conn->prepare($sql);\n    $stmt->bind_param(\"i\", $order_id);\n    $stmt->execute();\n}\n\n// If the user is logged in, proceed with the purchase\nif (isset($_SESSION['user_id'])) {\n    // Add product to cart\n    if (isset($_POST['add_to_cart'])) {\n        add_product_to_cart($_POST['product_id'], $_POST['quantity']);\n    }\n\n    // Complete the purchase\n    if (isset($_POST['complete_purchase'])) {\n        complete_purchase();\n    }\n}\n?>\n```\n### Usage\n\nTo use this code, simply include it in your PHP file and follow these steps:\n\n1. Log in to the system with a valid username and password.\n2. Add products to the cart by submitting a form with the `add_to_cart` button.\n3. Once you've added all the desired products to the cart, click the `Complete Purchase` button.\n\nNote that this is a basic implementation of a purchase functionality, and you may want to add additional features such as payment processing, user authentication, and error handling.\n\n### Example Use Case\n\nHere's an example of how to use the code:\n\n```php\n// login.php\n<?php\nrequire_once 'config.php';\n\nif (isset($_POST['username']) && isset($_POST['password'])) {\n    $username = $_POST['username'];\n    $password = $_POST['password'];\n\n    $sql = \"SELECT * FROM users WHERE username = ? AND password = ?\";\n    $stmt = $conn->prepare($sql);\n    $stmt->bind_param(\"ss\", $username, $password);\n    $stmt->execute();\n    $result = $stmt->get_result();\n\n    if ($result->num_rows > 0) {\n        $_SESSION['user_id'] = $result->fetch_assoc()['id'];\n        header('Location: purchase.php');\n        exit;\n    } else {\n        echo 'Invalid username or password';\n    }\n}\n?>\n\n// purchase.php\n<?php\nrequire_once 'config.php';\n\n// Add product to cart\nif (isset($_POST['add_to_cart'])) {\n    add_product_to_cart($_POST['product_id'], $_POST['quantity']);\n}\n\n// Complete the purchase\nif (isset($_POST['complete_purchase'])) {\n    complete_purchase();\n}\n?>\n\n<!-- HTML Form -->\n<form action=\"purchase.php\" method=\"post\">\n    <input type=\"hidden\" name=\"add_to_cart\" value=\"1\">\n    <label>Product ID:</label>\n    <input type=\"text\" name=\"product_id\"><br><br>\n    <label>Quantity:</label>\n    <input type=\"number\" name=\"quantity\"><br><br>\n    <button type=\"submit\">Add to Cart</button>\n</form>\n\n<form action=\"purchase.php\" method=\"post\">\n    <input type=\"hidden\" name=\"complete_purchase\" value=\"1\">\n    <button type=\"submit\">Complete Purchase</button>\n</form>\n```\nThis code assumes that you have already created a login system with valid username and password fields. Once the user logs in, they can add products to their cart by submitting the form with the `add_to_cart` button, and complete the purchase by clicking the `Complete Purchase` button.", "code_blocks": [null, "```php\n// config.php\n<?php\n$db_host = 'localhost';\n$db_username = 'root';\n$db_password = '';\n$db_name = 'database';\n\n$conn = new mysqli($db_host, $db_username, $db_password, $db_name);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n?>\n\n// purchase.php\n<?php\nrequire_once 'config.php';\n\n// Function to add a product to the cart\nfunction add_product_to_cart($product_id, $quantity) {\n    global $conn;\n    $sql = \"INSERT INTO order_items (order_id, product_id, quantity)\n            VALUES ((SELECT id FROM orders WHERE user_id = ?), ?, ?)\";\n    $stmt = $conn->prepare($sql);\n    $stmt->bind_param(\"iii\", $_SESSION['user_id'], $product_id, $quantity);\n    $stmt->execute();\n}\n\n// Function to create a new order\nfunction create_order() {\n    global $conn;\n    $sql = \"INSERT INTO orders (user_id, total)\n            VALUES (?, 0)\";\n    $stmt = $conn->prepare($sql);\n    $stmt->bind_param(\"i\", $_SESSION['user_id']);\n    $stmt->execute();\n}\n\n// Function to calculate the total cost of a cart\nfunction calculate_total() {\n    global $conn;\n    $sql = \"SELECT SUM(p.price * oi.quantity) AS total FROM products p\n            JOIN order_items oi ON p.id = oi.product_id\n            WHERE oi.order_id = (SELECT id FROM orders WHERE user_id = ?)\";\n    $stmt = $conn->prepare($sql);\n    $stmt->bind_param(\"i\", $_SESSION['user_id']);\n    $stmt->execute();\n    return $stmt->get_result()->fetch_assoc()['total'];\n}\n\n// Function to complete a purchase\nfunction complete_purchase() {\n    global $conn;\n    create_order();\n    $order_id = $conn->insert_id;\n    $total = calculate_total();\n\n    // Update the total cost of the order\n    $sql = \"UPDATE orders SET total = ? WHERE id = ?\";\n    $stmt = $conn->prepare($sql);\n    $stmt->bind_param(\"di\", $total, $order_id);\n    $stmt->execute();\n\n    // Clear the cart\n    $sql = \"DELETE FROM order_items WHERE order_id = ?\";\n    $stmt = $conn->prepare($sql);\n    $stmt->bind_param(\"i\", $order_id);\n    $stmt->execute();\n}\n\n// If the user is logged in, proceed with the purchase\nif (isset($_SESSION['user_id'])) {\n    // Add product to cart\n    if (isset($_POST['add_to_cart'])) {\n        add_product_to_cart($_POST['product_id'], $_POST['quantity']);\n    }\n\n    // Complete the purchase\n    if (isset($_POST['complete_purchase'])) {\n        complete_purchase();\n    }\n}\n?>\n```", "```php\n// login.php\n<?php\nrequire_once 'config.php';\n\nif (isset($_POST['username']) && isset($_POST['password'])) {\n    $username = $_POST['username'];\n    $password = $_POST['password'];\n\n    $sql = \"SELECT * FROM users WHERE username = ? AND password = ?\";\n    $stmt = $conn->prepare($sql);\n    $stmt->bind_param(\"ss\", $username, $password);\n    $stmt->execute();\n    $result = $stmt->get_result();\n\n    if ($result->num_rows > 0) {\n        $_SESSION['user_id'] = $result->fetch_assoc()['id'];\n        header('Location: purchase.php');\n        exit;\n    } else {\n        echo 'Invalid username or password';\n    }\n}\n?>\n\n// purchase.php\n<?php\nrequire_once 'config.php';\n\n// Add product to cart\nif (isset($_POST['add_to_cart'])) {\n    add_product_to_cart($_POST['product_id'], $_POST['quantity']);\n}\n\n// Complete the purchase\nif (isset($_POST['complete_purchase'])) {\n    complete_purchase();\n}\n?>\n\n<!-- HTML Form -->\n<form action=\"purchase.php\" method=\"post\">\n    <input type=\"hidden\" name=\"add_to_cart\" value=\"1\">\n    <label>Product ID:</label>\n    <input type=\"text\" name=\"product_id\"><br><br>\n    <label>Quantity:</label>\n    <input type=\"number\" name=\"quantity\"><br><br>\n    <button type=\"submit\">Add to Cart</button>\n</form>\n\n<form action=\"purchase.php\" method=\"post\">\n    <input type=\"hidden\" name=\"complete_purchase\" value=\"1\">\n    <button type=\"submit\">Complete Purchase</button>\n</form>\n```"]}
