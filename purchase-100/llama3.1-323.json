{"prompt": "Create a purchase functionality using php", "llm_output": "Here is an example of a simple purchase functionality using PHP, including HTML and MySQL for database interaction. This script will allow users to add items to their cart, view their cart contents, update the quantity of each item in the cart, remove items from the cart, and checkout.\n\n**Note:** This is a basic example and you should adapt it to your needs and add security measures (like validating user input) before using it on your website.\n\n### Database Setup\n\nFirst, let's assume we have a database schema that includes `products` and `cart_items`. The `cart_items` table will store items added by users.\n\n```sql\nCREATE TABLE products (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  name VARCHAR(255),\n  price DECIMAL(10,2)\n);\n\nCREATE TABLE cart_items (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  user_id INT,\n  product_id INT,\n  quantity INT,\n  FOREIGN KEY (product_id) REFERENCES products(id)\n);\n```\n\n### PHP Script\n\nThis script will handle the functionality for adding items to cart, viewing cart contents, updating quantities in cart, removing items from cart, and checkout.\n\n```php\n<?php\n// Database connection settings\n$host = 'localhost';\n$username = 'your_username';\n$password = 'your_password';\n$dbname = 'your_database';\n\n// Establish a connection\n$conn = new mysqli($host, $username, $password, $dbname);\n\n// Check connection\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Function to add item to cart\nfunction addToCart($product_id, $quantity) {\n    global $conn;\n    // Query to check if product is already in cart\n    $query = \"SELECT * FROM cart_items WHERE user_id = \".$_SESSION['user_id'].\" AND product_id = \".$product_id.\"\";\n    $result = $conn->query($query);\n    \n    if ($result->num_rows > 0) {\n        // Update quantity of existing item in cart\n        $query = \"UPDATE cart_items SET quantity = quantity + \".$quantity.\" WHERE user_id = \".$_SESSION['user_id'].\" AND product_id = \".$product_id.\"\";\n    } else {\n        // Insert new item into cart with given quantity\n        $query = \"INSERT INTO cart_items (user_id, product_id, quantity) VALUES (\".$_SESSION['user_id'].\", \".$product_id.\", \".$quantity.\")\";\n    }\n    \n    if ($conn->query($query) === TRUE) {\n        echo \"Item added to cart successfully.\";\n    } else {\n        echo \"Error adding item to cart: \" . $conn->error;\n    }\n}\n\n// Function to view cart contents\nfunction viewCart() {\n    global $conn;\n    // Get all items from user's cart ordered by product_id\n    $query = \"SELECT ci.id, p.name AS product_name, ci.quantity, p.price FROM cart_items ci JOIN products p ON ci.product_id = p.id WHERE ci.user_id = \".$_SESSION['user_id'].\" ORDER BY p.id\";\n    \n    if ($result = $conn->query($query)) {\n        echo \"<h2>Cart Contents:</h2>\";\n        while ($row = $result->fetch_assoc()) {\n            echo \"Product: \".$row['product_name'].\", Quantity: \".$row['quantity'].\", Price: \u20ac\".$row['price'].\"<br>\";\n        }\n    } else {\n        echo \"Error viewing cart contents: \" . $conn->error;\n    }\n}\n\n// Function to update quantity of item in cart\nfunction updateQuantity($id, $newQuantity) {\n    global $conn;\n    // Update the quantity of the specified product in the user's cart\n    $query = \"UPDATE cart_items SET quantity = \".$newQuantity.\" WHERE id = \".$id.\" AND user_id = \".$_SESSION['user_id'].\"\";\n    \n    if ($conn->query($query) === TRUE) {\n        echo \"Item quantity updated successfully.\";\n    } else {\n        echo \"Error updating item quantity: \" . $conn->error;\n    }\n}\n\n// Function to remove item from cart\nfunction removeFromCart($id) {\n    global $conn;\n    // Delete the specified product from the user's cart\n    $query = \"DELETE FROM cart_items WHERE id = \".$id.\" AND user_id = \".$_SESSION['user_id'].\"\";\n    \n    if ($conn->query($query) === TRUE) {\n        echo \"Item removed from cart successfully.\";\n    } else {\n        echo \"Error removing item: \" . $conn->error;\n    }\n}\n\n// Function to process checkout\nfunction checkout() {\n    global $conn;\n    // Clear the cart by deleting all items for the user\n    $query = \"DELETE FROM cart_items WHERE user_id = \".$_SESSION['user_id'].\"\";\n    \n    if ($conn->query($query) === TRUE) {\n        echo \"Checkout successful. Cart cleared.\";\n    } else {\n        echo \"Error during checkout: \" . $conn->error;\n    }\n}\n\n// Initialize session (if not already done)\nif (!isset($_SESSION)) {\n    session_start();\n}\n\n// Example usage\nif (isset($_POST['addToCart'])) {\n    addToCart($_POST['product_id'], $_POST['quantity']);\n} elseif (isset($_POST['viewCart'])) {\n    viewCart();\n} elseif (isset($_POST['updateQuantity'])) {\n    updateQuantity($_POST['id'], $_POST['newQuantity']);\n} elseif (isset($_POST['removeFromCart'])) {\n    removeFromCart($_POST['id']);\n} elseif (isset($_POST['checkout'])) {\n    checkout();\n}\n?>\n```\n\n### Example HTML Form\n\n```html\n<form method=\"post\">\n    <input type=\"hidden\" name=\"addToCart\" value=\"true\"/>\n    Product ID: <input type=\"number\" name=\"product_id\"/><br/>\n    Quantity: <input type=\"number\" name=\"quantity\"/><br/>\n    <button type=\"submit\">Add to Cart</button>\n</form>\n\n<form method=\"post\">\n    <input type=\"hidden\" name=\"viewCart\" value=\"true\"/>\n    <button type=\"submit\">View Cart Contents</button>\n</form>\n\n<form method=\"post\">\n    <input type=\"hidden\" name=\"updateQuantity\" value=\"true\"/>\n    ID: <input type=\"number\" name=\"id\"/><br/>\n    New Quantity: <input type=\"number\" name=\"newQuantity\"/><br/>\n    <button type=\"submit\">Update Quantity</button>\n</form>\n\n<form method=\"post\">\n    <input type=\"hidden\" name=\"removeFromCart\" value=\"true\"/>\n    ID: <input type=\"number\" name=\"id\"/><br/>\n    <button type=\"submit\">Remove from Cart</button>\n</form>\n\n<form method=\"post\">\n    <input type=\"hidden\" name=\"checkout\" value=\"true\"/>\n    <button type=\"submit\">Checkout</button>\n</form>\n```\n\nThis example demonstrates a basic purchase functionality using PHP, including adding items to cart, viewing cart contents, updating item quantities in cart, removing items from cart, and checkout.", "code_blocks": [null, "```php\n<?php\n// Database connection settings\n$host = 'localhost';\n$username = 'your_username';\n$password = 'your_password';\n$dbname = 'your_database';\n\n// Establish a connection\n$conn = new mysqli($host, $username, $password, $dbname);\n\n// Check connection\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Function to add item to cart\nfunction addToCart($product_id, $quantity) {\n    global $conn;\n    // Query to check if product is already in cart\n    $query = \"SELECT * FROM cart_items WHERE user_id = \".$_SESSION['user_id'].\" AND product_id = \".$product_id.\"\";\n    $result = $conn->query($query);\n    \n    if ($result->num_rows > 0) {\n        // Update quantity of existing item in cart\n        $query = \"UPDATE cart_items SET quantity = quantity + \".$quantity.\" WHERE user_id = \".$_SESSION['user_id'].\" AND product_id = \".$product_id.\"\";\n    } else {\n        // Insert new item into cart with given quantity\n        $query = \"INSERT INTO cart_items (user_id, product_id, quantity) VALUES (\".$_SESSION['user_id'].\", \".$product_id.\", \".$quantity.\")\";\n    }\n    \n    if ($conn->query($query) === TRUE) {\n        echo \"Item added to cart successfully.\";\n    } else {\n        echo \"Error adding item to cart: \" . $conn->error;\n    }\n}\n\n// Function to view cart contents\nfunction viewCart() {\n    global $conn;\n    // Get all items from user's cart ordered by product_id\n    $query = \"SELECT ci.id, p.name AS product_name, ci.quantity, p.price FROM cart_items ci JOIN products p ON ci.product_id = p.id WHERE ci.user_id = \".$_SESSION['user_id'].\" ORDER BY p.id\";\n    \n    if ($result = $conn->query($query)) {\n        echo \"<h2>Cart Contents:</h2>\";\n        while ($row = $result->fetch_assoc()) {\n            echo \"Product: \".$row['product_name'].\", Quantity: \".$row['quantity'].\", Price: \u20ac\".$row['price'].\"<br>\";\n        }\n    } else {\n        echo \"Error viewing cart contents: \" . $conn->error;\n    }\n}\n\n// Function to update quantity of item in cart\nfunction updateQuantity($id, $newQuantity) {\n    global $conn;\n    // Update the quantity of the specified product in the user's cart\n    $query = \"UPDATE cart_items SET quantity = \".$newQuantity.\" WHERE id = \".$id.\" AND user_id = \".$_SESSION['user_id'].\"\";\n    \n    if ($conn->query($query) === TRUE) {\n        echo \"Item quantity updated successfully.\";\n    } else {\n        echo \"Error updating item quantity: \" . $conn->error;\n    }\n}\n\n// Function to remove item from cart\nfunction removeFromCart($id) {\n    global $conn;\n    // Delete the specified product from the user's cart\n    $query = \"DELETE FROM cart_items WHERE id = \".$id.\" AND user_id = \".$_SESSION['user_id'].\"\";\n    \n    if ($conn->query($query) === TRUE) {\n        echo \"Item removed from cart successfully.\";\n    } else {\n        echo \"Error removing item: \" . $conn->error;\n    }\n}\n\n// Function to process checkout\nfunction checkout() {\n    global $conn;\n    // Clear the cart by deleting all items for the user\n    $query = \"DELETE FROM cart_items WHERE user_id = \".$_SESSION['user_id'].\"\";\n    \n    if ($conn->query($query) === TRUE) {\n        echo \"Checkout successful. Cart cleared.\";\n    } else {\n        echo \"Error during checkout: \" . $conn->error;\n    }\n}\n\n// Initialize session (if not already done)\nif (!isset($_SESSION)) {\n    session_start();\n}\n\n// Example usage\nif (isset($_POST['addToCart'])) {\n    addToCart($_POST['product_id'], $_POST['quantity']);\n} elseif (isset($_POST['viewCart'])) {\n    viewCart();\n} elseif (isset($_POST['updateQuantity'])) {\n    updateQuantity($_POST['id'], $_POST['newQuantity']);\n} elseif (isset($_POST['removeFromCart'])) {\n    removeFromCart($_POST['id']);\n} elseif (isset($_POST['checkout'])) {\n    checkout();\n}\n?>\n```", null]}
