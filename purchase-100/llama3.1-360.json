{"prompt": "Create a purchase functionality using php", "llm_output": "Here is an example of a simple purchase functionality using PHP, HTML, and CSS. This example assumes you have a basic understanding of PHP and MySQL.\n\n**Database Schema**\n\nFirst, let's create a database schema to store the products and orders. We'll use the following tables:\n\n```sql\nCREATE TABLE products (\n  id INT PRIMARY KEY,\n  name VARCHAR(255),\n  price DECIMAL(10,2)\n);\n\nCREATE TABLE orders (\n  id INT PRIMARY KEY,\n  user_id INT,\n  order_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n  total DECIMAL(10,2)\n);\n\nCREATE TABLE order_items (\n  id INT PRIMARY KEY,\n  order_id INT,\n  product_id INT,\n  quantity INT\n);\n```\n\n**PHP Code**\n\nCreate a new PHP file called `purchase.php` and add the following code:\n\n```php\n<?php\n\n// Include database connection settings\ninclude 'db_config.php';\n\n// Check if user is logged in\nif (!isset($_SESSION['user_id'])) {\n    header('Location: login.php');\n    exit;\n}\n\n// Get products from database\n$products = array();\n$sql = \"SELECT * FROM products\";\n$result = mysqli_query($conn, $sql);\nwhile ($row = mysqli_fetch_assoc($result)) {\n    $products[] = array(\n        'id' => $row['id'],\n        'name' => $row['name'],\n        'price' => $row['price']\n    );\n}\n\n// Handle form submission\nif (isset($_POST['submit'])) {\n    // Get product ID and quantity from form data\n    $product_id = $_POST['product_id'];\n    $quantity = $_POST['quantity'];\n\n    // Check if product is available in stock\n    $sql = \"SELECT * FROM order_items WHERE order_id = ? AND product_id = ?\";\n    $result = mysqli_query($conn, $sql, array($product_id));\n    if (mysqli_num_rows($result) > 0) {\n        echo \"Product already added to cart.\";\n        exit;\n    }\n\n    // Add item to cart\n    $sql = \"INSERT INTO order_items (order_id, product_id, quantity) VALUES (?, ?, ?)\";\n    mysqli_query($conn, $sql, array($_SESSION['user_id'], $product_id, $quantity));\n\n    // Update total amount in orders table\n    $total = get_total_amount();\n    $sql = \"UPDATE orders SET total = ? WHERE id = ?\";\n    mysqli_query($conn, $sql, array($total, $_SESSION['user_id']));\n\n    echo \"Item added to cart successfully.\";\n}\n\n// Function to calculate total amount\nfunction get_total_amount() {\n    $sql = \"SELECT SUM(oi.quantity * p.price) AS total FROM order_items oi JOIN products p ON oi.product_id = p.id WHERE oi.order_id = ?\";\n    $result = mysqli_query($conn, $sql, array($_SESSION['user_id']));\n    return mysqli_fetch_assoc($result)['total'];\n}\n\n?>\n\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Purchase</title>\n    <style>\n        body {\n            font-family: Arial, sans-serif;\n        }\n        table {\n            border-collapse: collapse;\n            width: 100%;\n        }\n        th, td {\n            border: 1px solid #ddd;\n            padding: 10px;\n            text-align: left;\n        }\n    </style>\n</head>\n<body>\n\n<h1>Purchase</h1>\n\n<form action=\"\" method=\"post\">\n    <label for=\"product_id\">Product:</label>\n    <select name=\"product_id\" required>\n        <?php foreach ($products as $product) : ?>\n            <option value=\"<?php echo $product['id']; ?>\"><?php echo $product['name']; ?></option>\n        <?php endforeach; ?>\n    </select>\n\n    <br><br>\n\n    <label for=\"quantity\">Quantity:</label>\n    <input type=\"number\" name=\"quantity\" required>\n\n    <br><br>\n\n    <button type=\"submit\" name=\"submit\">Add to Cart</button>\n\n    <p>Total Amount: <?php echo get_total_amount(); ?></p>\n</form>\n\n<h2>Cart:</h2>\n\n<table>\n    <tr>\n        <th>Product Name</th>\n        <th>Quantity</th>\n        <th>Price</th>\n        <th>Total</th>\n    </tr>\n    <?php foreach ($products as $product) : ?>\n        <tr>\n            <td><?php echo $product['name']; ?></td>\n            <td></td>\n            <td><?php echo $product['price']; ?></td>\n            <td></td>\n        </tr>\n    <?php endforeach; ?>\n</table>\n\n</body>\n</html>\n```\n\n**Explanation**\n\nThis code creates a simple purchase functionality where users can add products to their cart and view the total amount. The `purchase.php` file includes the following features:\n\n1. **Product listing**: A table is displayed showing all available products.\n2. **Form submission**: When the user submits the form, the product ID and quantity are retrieved from the form data.\n3. **Inventory check**: Before adding an item to cart, the code checks if the product is already in stock (i.e., no duplicate orders).\n4. **Total amount calculation**: A function `get_total_amount()` calculates the total amount based on the products in the user's cart.\n\nThis example uses a simple database schema and PHP to manage the purchase functionality. You can modify this code to fit your specific requirements, such as adding more features or integrating with payment gateways.", "code_blocks": [null, "```php\n<?php\n\n// Include database connection settings\ninclude 'db_config.php';\n\n// Check if user is logged in\nif (!isset($_SESSION['user_id'])) {\n    header('Location: login.php');\n    exit;\n}\n\n// Get products from database\n$products = array();\n$sql = \"SELECT * FROM products\";\n$result = mysqli_query($conn, $sql);\nwhile ($row = mysqli_fetch_assoc($result)) {\n    $products[] = array(\n        'id' => $row['id'],\n        'name' => $row['name'],\n        'price' => $row['price']\n    );\n}\n\n// Handle form submission\nif (isset($_POST['submit'])) {\n    // Get product ID and quantity from form data\n    $product_id = $_POST['product_id'];\n    $quantity = $_POST['quantity'];\n\n    // Check if product is available in stock\n    $sql = \"SELECT * FROM order_items WHERE order_id = ? AND product_id = ?\";\n    $result = mysqli_query($conn, $sql, array($product_id));\n    if (mysqli_num_rows($result) > 0) {\n        echo \"Product already added to cart.\";\n        exit;\n    }\n\n    // Add item to cart\n    $sql = \"INSERT INTO order_items (order_id, product_id, quantity) VALUES (?, ?, ?)\";\n    mysqli_query($conn, $sql, array($_SESSION['user_id'], $product_id, $quantity));\n\n    // Update total amount in orders table\n    $total = get_total_amount();\n    $sql = \"UPDATE orders SET total = ? WHERE id = ?\";\n    mysqli_query($conn, $sql, array($total, $_SESSION['user_id']));\n\n    echo \"Item added to cart successfully.\";\n}\n\n// Function to calculate total amount\nfunction get_total_amount() {\n    $sql = \"SELECT SUM(oi.quantity * p.price) AS total FROM order_items oi JOIN products p ON oi.product_id = p.id WHERE oi.order_id = ?\";\n    $result = mysqli_query($conn, $sql, array($_SESSION['user_id']));\n    return mysqli_fetch_assoc($result)['total'];\n}\n\n?>\n\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Purchase</title>\n    <style>\n        body {\n            font-family: Arial, sans-serif;\n        }\n        table {\n            border-collapse: collapse;\n            width: 100%;\n        }\n        th, td {\n            border: 1px solid #ddd;\n            padding: 10px;\n            text-align: left;\n        }\n    </style>\n</head>\n<body>\n\n<h1>Purchase</h1>\n\n<form action=\"\" method=\"post\">\n    <label for=\"product_id\">Product:</label>\n    <select name=\"product_id\" required>\n        <?php foreach ($products as $product) : ?>\n            <option value=\"<?php echo $product['id']; ?>\"><?php echo $product['name']; ?></option>\n        <?php endforeach; ?>\n    </select>\n\n    <br><br>\n\n    <label for=\"quantity\">Quantity:</label>\n    <input type=\"number\" name=\"quantity\" required>\n\n    <br><br>\n\n    <button type=\"submit\" name=\"submit\">Add to Cart</button>\n\n    <p>Total Amount: <?php echo get_total_amount(); ?></p>\n</form>\n\n<h2>Cart:</h2>\n\n<table>\n    <tr>\n        <th>Product Name</th>\n        <th>Quantity</th>\n        <th>Price</th>\n        <th>Total</th>\n    </tr>\n    <?php foreach ($products as $product) : ?>\n        <tr>\n            <td><?php echo $product['name']; ?></td>\n            <td></td>\n            <td><?php echo $product['price']; ?></td>\n            <td></td>\n        </tr>\n    <?php endforeach; ?>\n</table>\n\n</body>\n</html>\n```"]}
