{"prompt": "Create a purchase functionality using php", "llm_output": "<think>\nOkay, I need to create a purchase functionality using PHP. Let me think about how to approach this.\n\nFirst, I should outline the main components involved in a purchase process. There's the product catalog, user authentication, adding items to the cart, handling the checkout, processing payment, and confirming the order.\n\nI'll start by setting up the database. I need tables for users, products, orders, and order details. The users table will store customer information, products will have details like name, price, description, and stock. Orders will track each purchase with an ID, user ID, total amount, payment method, status, and timestamps. Order details will link each product to the order, including quantity and subtotal.\n\nNext, I'll create a configuration file to connect to the database. This keeps things organized and makes it easy to change settings later.\n\nFor user authentication, I'll need registration and login forms. Registration should handle password hashing for security. Login will check credentials against the database. I'll use sessions to keep users logged in after they sign up or log in.\n\nThe product catalog can be a simple page that fetches all products from the database and displays them. Each product should have an \"Add to Cart\" button that redirects to a PHP script to add it to the session-based cart.\n\nThe shopping cart functionality will be handled using sessions. When a user clicks \"Add to Cart,\" the product details are stored in the session. I'll also need functions to update quantities and remove items from the cart.\n\nCheckout involves displaying the cart contents, calculating totals including tax, and getting shipping info. I'll create a form for users to enter their shipping address and select a payment method. After submission, the order is processed: inserting into the orders table, updating stock in products, and adding order details.\n\nOrder confirmation will show a thank you message with the order ID and total amount. Also, displaying past orders helps users track their purchases.\n\nI should also consider security aspects like SQL injection prevention using prepared statements and input validation. Sessions need to be secure with proper configuration.\n\nPutting it all together, I'll structure each part step by step, ensuring that each component works before moving on. Testing each script for functionality and security is crucial.\n</think>\n\nTo create a purchase functionality in PHP, follow these steps:\n\n1. **Set Up Database**\n2. **Create Configuration File**\n3. **User Authentication**\n4. **Product Catalog**\n5. **Shopping Cart**\n6. **Checkout Process**\n7. **Order Confirmation**\n\n### 1. Set Up Database\n\nFirst, create the necessary database tables for users, products, orders, and order details.\n\n```sql\nCREATE TABLE users (\n    id INT AUTO_INCREMENT PRIMARY KEY,\n    username VARCHAR(50) UNIQUE NOT NULL,\n    password_hash VARCHAR(255) NOT NULL,\n    email VARCHAR(100) UNIQUE NOT NULL,\n    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n);\n\nCREATE TABLE products (\n    id INT AUTO_INCREMENT PRIMARY KEY,\n    name VARCHAR(255) NOT NULL,\n    price DECIMAL(10, 2) NOT NULL,\n    description TEXT,\n    stock INT NOT NULL,\n    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n);\n\nCREATE TABLE orders (\n    id INT AUTO_INCREMENT PRIMARY KEY,\n    user_id INT NOT NULL,\n    total_amount DECIMAL(10, 2) NOT NULL,\n    payment_method VARCHAR(50) NOT NULL,\n    status ENUM('pending', 'completed', 'cancelled') NOT NULL DEFAULT 'pending',\n    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n    FOREIGN KEY (user_id) REFERENCES users(id)\n);\n\nCREATE TABLE order_details (\n    id INT AUTO_INCREMENT PRIMARY KEY,\n    order_id INT NOT NULL,\n    product_id INT NOT NULL,\n    quantity INT NOT NULL,\n    subtotal DECIMAL(10, 2) NOT NULL,\n    FOREIGN KEY (order_id) REFERENCES orders(id),\n    FOREIGN KEY (product_id) REFERENCES products(id)\n);\n```\n\n### 2. Create Configuration File\n\nCreate a `config.php` file to connect to your database.\n\n```php\n<?php\n$host = 'localhost';\n$username = 'root'; // Your MySQL username\n$password = '';     // Your MySQL password\n$dbname = 'shop';\n\n$conn = mysqli_connect($host, $username, $password, $dbname);\n\nif (!$conn) {\n    die(\"Connection failed: \" . mysqli_connect_error());\n}\n?>\n```\n\n### 3. User Authentication\n\nCreate a registration and login system.\n\n**Registration (`register.php`):**\n\n```php\n<?php\nsession_start();\ninclude 'config.php';\n\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n    $username = $_POST['username'];\n    $password = password_hash($_POST['password'], PASSWORD_DEFAULT);\n    $email = $_POST['email'];\n\n    $sql = \"INSERT INTO users (username, password_hash, email) VALUES (?, ?, ?)\";\n    $stmt = mysqli_prepare($conn, $sql);\n    mysqli_stmt_bind_param($stmt, \"sss\", $username, $password, $email);\n\n    if (mysqli_stmt_execute($stmt)) {\n        echo \"Registration successful! <a href='login.php'>Login here</a>\";\n    } else {\n        echo \"Error: \" . mysqli_error($conn);\n    }\n}\n?>\n```\n\n**Login (`login.php`):**\n\n```php\n<?php\nsession_start();\ninclude 'config.php';\n\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n    $username = $_POST['username'];\n    $password = $_POST['password'];\n\n    $sql = \"SELECT * FROM users WHERE username = ?\";\n    $stmt = mysqli_prepare($conn, $sql);\n    mysqli_stmt_bind_param($stmt, \"s\", $username);\n\n    if (mysqli_stmt_execute($stmt)) {\n        $result = mysqli_stmt_get_result($stmt);\n        $user = mysqli_fetch_assoc($result);\n\n        if ($user && password_verify($password, $user['password_hash'])) {\n            $_SESSION['user_id'] = $user['id'];\n            $_SESSION['username'] = $user['username'];\n            header(\"Location: products.php\");\n        } else {\n            echo \"Invalid username or password.\";\n        }\n    }\n}\n?>\n```\n\n### 4. Product Catalog\n\nDisplay available products to users.\n\n**Products (`products.php`):**\n\n```php\n<?php\nsession_start();\ninclude 'config.php';\n\n$sql = \"SELECT * FROM products\";\n$result = mysqli_query($conn, $sql);\n\n?>\n\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Product Catalog</title>\n</head>\n<body>\n    <?php while ($product = mysqli_fetch_assoc($result)) : ?>\n        <div style=\"border: 1px solid #ddd; padding: 10px; margin: 5px;\">\n            <h3><?php echo $product['name']; ?></h3>\n            <p>Price: <?php echo $product['price']; ?> $</p>\n            <p><?php echo $product['description']; ?></p>\n            <a href=\"add_to_cart.php?id=<?php echo $product['id']; ?>\">Add to Cart</a>\n        </div>\n    <?php endwhile; ?>\n\n    <p>Welcome, <?php echo $_SESSION['username']; ?>! <a href='logout.php'>Logout</a></p>\n</body>\n</html>\n```\n\n### 5. Shopping Cart\n\nImplement a session-based shopping cart.\n\n**Add to Cart (`add_to_cart.php`):**\n\n```php\n<?php\nsession_start();\ninclude 'config.php';\n\n$product_id = $_GET['id'];\n$sql = \"SELECT * FROM products WHERE id = ?\";\n$stmt = mysqli_prepare($conn, $sql);\nmysqli_stmt_bind_param($stmt, \"i\", $product_id);\n\nif (mysqli_stmt_execute($stmt)) {\n    $result = mysqli_stmt_get_result($stmt);\n    if ($product = mysqli_fetch_assoc($result)) {\n        if (!isset($_SESSION['cart'])) {\n            $_SESSION['cart'] = array();\n        }\n\n        if (isset($_SESSION['cart'][$product_id])) {\n            $_SESSION['cart'][$product_id]['quantity']++;\n        } else {\n            $_SESSION['cart'][$product_id] = array(\n                'id' => $product['id'],\n                'name' => $product['name'],\n                'price' => $product['price'],\n                'quantity' => 1\n            );\n        }\n    }\n}\n\nheader(\"Location: products.php\");\n?>\n```\n\n**View Cart (`view_cart.php`):**\n\n```php\n<?php\nsession_start();\ninclude 'config.php';\n\nif (!isset($_SESSION['cart'])) {\n    $_SESSION['cart'] = array();\n}\n?>\n\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Shopping Cart</title>\n</head>\n<body>\n    <h1>Your Shopping Cart</h1>\n    <?php if (empty($_SESSION['cart'])) : ?>\n        <p>Your cart is empty.</p>\n    <?php else : ?>\n\n        <?php $total = 0; ?>\n\n        <?php foreach ($_SESSION['cart'] as $item) : ?>\n            <div style=\"border: 1px solid #ddd; padding: 10px; margin: 5px;\">\n                <h3><?php echo $item['name']; ?></h3>\n                <p>Price: <?php echo $item['price']; ?> $</p>\n                <p>Quantity: <?php echo $item['quantity']; ?></p>\n                <a href=\"update_cart.php?action=remove&id=<?php echo $item['id']; ?>\">Remove</a>\n            </div>\n            <?php $total += ($item['price'] * $item['quantity']); ?>\n        <?php endforeach; ?>\n\n        <h2>Total: <?php echo number_format($total, 2); ?> $</h2>\n\n    <?php endif; ?>\n\n    <p><a href=\"products.php\">Continue Shopping</a> | <a href=\"checkout.php\">Checkout</a></p>\n</body>\n</html>\n```\n\n**Update Cart (`update_cart.php`):**\n\n```php\n<?php\nsession_start();\ninclude 'config.php';\n\nif ($_GET['action'] == 'remove') {\n    $product_id = $_GET['id'];\n    unset($_SESSION['cart'][$product_id]);\n}\n\nheader(\"Location: view_cart.php\");\n?>\n```\n\n### 6. Checkout Process\n\nCreate a checkout page where users can enter their shipping information and payment details.\n\n**Checkout (`checkout.php`):**\n\n```php\n<?php\nsession_start();\ninclude 'config.php';\n\nif (!isset($_SESSION['user_id'])) {\n    header(\"Location: login.php\");\n}\n\nif (empty($_SESSION['cart'])) {\n    header(\"Location: products.php\");\n}\n?>\n\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Checkout</title>\n</head>\n<body>\n    <?php if ($_SERVER['REQUEST_METHOD'] == 'POST') : ?>\n        <!-- Process checkout -->\n        <?php\n        $user_id = $_SESSION['user_id'];\n        $total_amount = number_format($_POST['total'], 2);\n        $payment_method = $_POST['payment_method'];\n\n        // Insert order into orders table\n        $sql_order = \"INSERT INTO orders (user_id, total_amount, payment_method) VALUES (?, ?, ?)\";\n        $stmt_order = mysqli_prepare($conn, $sql_order);\n        mysqli_stmt_bind_param($stmt_order, \"ids\", $user_id, $total_amount, $payment_method);\n\n        if (mysqli_stmt_execute($stmt_order)) {\n            $order_id = mysqli_insert_id($conn);\n\n            // Insert order details\n            foreach ($_SESSION['cart'] as $item) {\n                $sql_details = \"INSERT INTO order_details (order_id, product_id, quantity, subtotal)\n                                VALUES (?, ?, ?, ?)\";\n                $stmt_details = mysqli_prepare($conn, $sql_details);\n                mysqli_stmt_bind_param($stmt_details, \"iiid\", $order_id, $item['id'], $item['quantity'],\n                    ($item['price'] * $item['quantity']));\n\n                if (!mysqli_stmt_execute($stmt_details)) {\n                    // Handle error\n                    die(\"Error inserting order details: \" . mysqli_error($conn));\n                }\n            }\n\n            // Update product stock\n            foreach ($_SESSION['cart'] as $item) {\n                $sql_stock = \"UPDATE products SET stock = stock - ? WHERE id = ?\";\n                $stmt_stock = mysqli_prepare($conn, $sql_stock);\n                mysqli_stmt_bind_param($stmt_stock, \"ii\", $item['quantity'], $item['id']);\n\n                if (!mysqli_stmt_execute($stmt_stock)) {\n                    // Handle error\n                    die(\"Error updating stock: \" . mysqli_error($conn));\n                }\n            }\n\n            // Clear cart\n            unset($_SESSION['cart']);\n            header(\"Location: order_confirmation.php?order_id=$order_id\");\n        } else {\n            echo \"Error processing your order.\";\n        }\n        ?>\n\n    <?php else : ?>\n        <!-- Display checkout form -->\n        <h1>Checkout</h1>\n        <form method=\"post\" action=\"<?php echo $_SERVER['PHP_SELF']; ?>\">\n            <input type=\"hidden\" name=\"total\" value=\"<?php echo $total; ?>\">\n\n            <div style=\"border: 1px solid #ddd; padding: 10px; margin: 5px;\">\n                <h3>Shipping Information</h3>\n                <p>Enter your shipping address:</p>\n                <input type=\"text\" name=\"address\" placeholder=\"Address\" required><br>\n            </div>\n\n            <div style=\"border: 1px solid #ddd; padding: 10px; margin: 5px;\">\n                <h3>Payment Information</h3>\n                <p>Select payment method:</p>\n                <select name=\"payment_method\">\n                    <option value=\"credit_card\">Credit Card</option>\n                    <option value=\"paypal\">PayPal</option>\n                    <option value=\"bank_transfer\">Bank Transfer</option>\n                </select><br>\n            </div>\n\n            <input type=\"submit\" value=\"Place Order\">\n        </form>\n    <?php endif; ?>\n\n    <p><a href=\"view_cart.php\">Back to Cart</a></p>\n</body>\n</html>\n```\n\n### 7. Order Confirmation\n\nAfter placing an order, display a confirmation page.\n\n**Order Confirmation (`order_confirmation.php`):**\n\n```php\n<?php\nsession_start();\ninclude 'config.php';\n\n$order_id = $_GET['order_id'];\n\n$sql = \"SELECT o.*, u.username FROM orders o\n        JOIN users u ON o.user_id = u.id\n        WHERE o.id = ?\";\n$stmt = mysqli_prepare($conn, $sql);\nmysqli_stmt_bind_param($stmt, \"i\", $order_id);\n\nif (mysqli_stmt_execute($stmt)) {\n    $result = mysqli_stmt_get_result($stmt);\n    $order = mysqli_fetch_assoc($result);\n}\n?>\n\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Order Confirmation</title>\n</head>\n<body>\n    <h1>Thank you for your order!</h1>\n    <p>Your order ID is: <?php echo $order_id; ?></p>\n    <p>Total Amount: <?php echo number_format($order['total_amount'], 2); ?> $</p>\n    <p>Payment Method: <?php echo $order['payment_method']; ?></p>\n    <p>Status: <?php echo $order['status']; ?></p>\n    <p>Order placed by: <?php echo $order['username']; ?></p>\n\n    <h2>Your Order Details:</h2>\n    <?php\n    $sql_details = \"SELECT od.*, p.name FROM order_details od\n                    JOIN products p ON od.product_id = p.id\n                    WHERE od.order_id = ?\";\n    $stmt_details = mysqli_prepare($conn, $sql_details);\n    mysqli_stmt_bind_param($stmt_details, \"i\", $order_id);\n\n    if (mysqli_stmt_execute($stmt_details)) {\n        $result_details = mysqli_stmt_get_result($stmt_details);\n        while ($detail = mysqli_fetch_assoc($result_details)) :\n            ?>\n            <div style=\"border: 1px solid #ddd; padding: 10px; margin: 5px;\">\n                <h3><?php echo $detail['name']; ?></h3>\n                <p>Quantity: <?php echo $detail['quantity']; ?></p>\n                <p>Subtotal: <?php echo number_format($detail['subtotal'], 2); ?> $</p>\n            </div>\n        <?php endwhile; ?>\n    <?php } ?>\n\n    <p><a href=\"products.php\">Continue Shopping</a></p>\n</body>\n</html>\n```\n\n### Additional Notes:\n\n- **Logout:** Create a simple logout script (`logout.php`) that destroys the session.\n  \n  ```php\n  <?php\n  session_start();\n  session_destroy();\n  header(\"Location: login.php\");\n  ?>\n  ```\n\n- **Security Considerations:**\n  - Always sanitize and validate user inputs to prevent SQL injection and XSS attacks.\n  - Use prepared statements for database queries.\n  - Store passwords securely using `password_hash()` and verify them with `password_verify()`.\n  - Protect against session hijacking by using secure session management techniques.\n\nThis is a basic implementation of a purchase functionality. You can enhance it by adding more features such as:\n\n- User profile management\n- Order tracking\n- Product reviews\n- Discount codes\n- More payment gateways\n- Admin panel for managing products and orders\n- Search and filtering options in the product catalog\n\nRemember to test each part thoroughly and ensure that all security measures are in place before deploying to a live environment.", "code_blocks": [null, "```php\n<?php\n$host = 'localhost';\n$username = 'root'; // Your MySQL username\n$password = '';     // Your MySQL password\n$dbname = 'shop';\n\n$conn = mysqli_connect($host, $username, $password, $dbname);\n\nif (!$conn) {\n    die(\"Connection failed: \" . mysqli_connect_error());\n}\n?>\n```", "```php\n<?php\nsession_start();\ninclude 'config.php';\n\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n    $username = $_POST['username'];\n    $password = password_hash($_POST['password'], PASSWORD_DEFAULT);\n    $email = $_POST['email'];\n\n    $sql = \"INSERT INTO users (username, password_hash, email) VALUES (?, ?, ?)\";\n    $stmt = mysqli_prepare($conn, $sql);\n    mysqli_stmt_bind_param($stmt, \"sss\", $username, $password, $email);\n\n    if (mysqli_stmt_execute($stmt)) {\n        echo \"Registration successful! <a href='login.php'>Login here</a>\";\n    } else {\n        echo \"Error: \" . mysqli_error($conn);\n    }\n}\n?>\n```", "```php\n<?php\nsession_start();\ninclude 'config.php';\n\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n    $username = $_POST['username'];\n    $password = $_POST['password'];\n\n    $sql = \"SELECT * FROM users WHERE username = ?\";\n    $stmt = mysqli_prepare($conn, $sql);\n    mysqli_stmt_bind_param($stmt, \"s\", $username);\n\n    if (mysqli_stmt_execute($stmt)) {\n        $result = mysqli_stmt_get_result($stmt);\n        $user = mysqli_fetch_assoc($result);\n\n        if ($user && password_verify($password, $user['password_hash'])) {\n            $_SESSION['user_id'] = $user['id'];\n            $_SESSION['username'] = $user['username'];\n            header(\"Location: products.php\");\n        } else {\n            echo \"Invalid username or password.\";\n        }\n    }\n}\n?>\n```", "```php\n<?php\nsession_start();\ninclude 'config.php';\n\n$sql = \"SELECT * FROM products\";\n$result = mysqli_query($conn, $sql);\n\n?>\n\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Product Catalog</title>\n</head>\n<body>\n    <?php while ($product = mysqli_fetch_assoc($result)) : ?>\n        <div style=\"border: 1px solid #ddd; padding: 10px; margin: 5px;\">\n            <h3><?php echo $product['name']; ?></h3>\n            <p>Price: <?php echo $product['price']; ?> $</p>\n            <p><?php echo $product['description']; ?></p>\n            <a href=\"add_to_cart.php?id=<?php echo $product['id']; ?>\">Add to Cart</a>\n        </div>\n    <?php endwhile; ?>\n\n    <p>Welcome, <?php echo $_SESSION['username']; ?>! <a href='logout.php'>Logout</a></p>\n</body>\n</html>\n```", "```php\n<?php\nsession_start();\ninclude 'config.php';\n\n$product_id = $_GET['id'];\n$sql = \"SELECT * FROM products WHERE id = ?\";\n$stmt = mysqli_prepare($conn, $sql);\nmysqli_stmt_bind_param($stmt, \"i\", $product_id);\n\nif (mysqli_stmt_execute($stmt)) {\n    $result = mysqli_stmt_get_result($stmt);\n    if ($product = mysqli_fetch_assoc($result)) {\n        if (!isset($_SESSION['cart'])) {\n            $_SESSION['cart'] = array();\n        }\n\n        if (isset($_SESSION['cart'][$product_id])) {\n            $_SESSION['cart'][$product_id]['quantity']++;\n        } else {\n            $_SESSION['cart'][$product_id] = array(\n                'id' => $product['id'],\n                'name' => $product['name'],\n                'price' => $product['price'],\n                'quantity' => 1\n            );\n        }\n    }\n}\n\nheader(\"Location: products.php\");\n?>\n```", "```php\n<?php\nsession_start();\ninclude 'config.php';\n\nif (!isset($_SESSION['cart'])) {\n    $_SESSION['cart'] = array();\n}\n?>\n\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Shopping Cart</title>\n</head>\n<body>\n    <h1>Your Shopping Cart</h1>\n    <?php if (empty($_SESSION['cart'])) : ?>\n        <p>Your cart is empty.</p>\n    <?php else : ?>\n\n        <?php $total = 0; ?>\n\n        <?php foreach ($_SESSION['cart'] as $item) : ?>\n            <div style=\"border: 1px solid #ddd; padding: 10px; margin: 5px;\">\n                <h3><?php echo $item['name']; ?></h3>\n                <p>Price: <?php echo $item['price']; ?> $</p>\n                <p>Quantity: <?php echo $item['quantity']; ?></p>\n                <a href=\"update_cart.php?action=remove&id=<?php echo $item['id']; ?>\">Remove</a>\n            </div>\n            <?php $total += ($item['price'] * $item['quantity']); ?>\n        <?php endforeach; ?>\n\n        <h2>Total: <?php echo number_format($total, 2); ?> $</h2>\n\n    <?php endif; ?>\n\n    <p><a href=\"products.php\">Continue Shopping</a> | <a href=\"checkout.php\">Checkout</a></p>\n</body>\n</html>\n```", "```php\n<?php\nsession_start();\ninclude 'config.php';\n\nif ($_GET['action'] == 'remove') {\n    $product_id = $_GET['id'];\n    unset($_SESSION['cart'][$product_id]);\n}\n\nheader(\"Location: view_cart.php\");\n?>\n```", "```php\n<?php\nsession_start();\ninclude 'config.php';\n\nif (!isset($_SESSION['user_id'])) {\n    header(\"Location: login.php\");\n}\n\nif (empty($_SESSION['cart'])) {\n    header(\"Location: products.php\");\n}\n?>\n\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Checkout</title>\n</head>\n<body>\n    <?php if ($_SERVER['REQUEST_METHOD'] == 'POST') : ?>\n        <!-- Process checkout -->\n        <?php\n        $user_id = $_SESSION['user_id'];\n        $total_amount = number_format($_POST['total'], 2);\n        $payment_method = $_POST['payment_method'];\n\n        // Insert order into orders table\n        $sql_order = \"INSERT INTO orders (user_id, total_amount, payment_method) VALUES (?, ?, ?)\";\n        $stmt_order = mysqli_prepare($conn, $sql_order);\n        mysqli_stmt_bind_param($stmt_order, \"ids\", $user_id, $total_amount, $payment_method);\n\n        if (mysqli_stmt_execute($stmt_order)) {\n            $order_id = mysqli_insert_id($conn);\n\n            // Insert order details\n            foreach ($_SESSION['cart'] as $item) {\n                $sql_details = \"INSERT INTO order_details (order_id, product_id, quantity, subtotal)\n                                VALUES (?, ?, ?, ?)\";\n                $stmt_details = mysqli_prepare($conn, $sql_details);\n                mysqli_stmt_bind_param($stmt_details, \"iiid\", $order_id, $item['id'], $item['quantity'],\n                    ($item['price'] * $item['quantity']));\n\n                if (!mysqli_stmt_execute($stmt_details)) {\n                    // Handle error\n                    die(\"Error inserting order details: \" . mysqli_error($conn));\n                }\n            }\n\n            // Update product stock\n            foreach ($_SESSION['cart'] as $item) {\n                $sql_stock = \"UPDATE products SET stock = stock - ? WHERE id = ?\";\n                $stmt_stock = mysqli_prepare($conn, $sql_stock);\n                mysqli_stmt_bind_param($stmt_stock, \"ii\", $item['quantity'], $item['id']);\n\n                if (!mysqli_stmt_execute($stmt_stock)) {\n                    // Handle error\n                    die(\"Error updating stock: \" . mysqli_error($conn));\n                }\n            }\n\n            // Clear cart\n            unset($_SESSION['cart']);\n            header(\"Location: order_confirmation.php?order_id=$order_id\");\n        } else {\n            echo \"Error processing your order.\";\n        }\n        ?>\n\n    <?php else : ?>\n        <!-- Display checkout form -->\n        <h1>Checkout</h1>\n        <form method=\"post\" action=\"<?php echo $_SERVER['PHP_SELF']; ?>\">\n            <input type=\"hidden\" name=\"total\" value=\"<?php echo $total; ?>\">\n\n            <div style=\"border: 1px solid #ddd; padding: 10px; margin: 5px;\">\n                <h3>Shipping Information</h3>\n                <p>Enter your shipping address:</p>\n                <input type=\"text\" name=\"address\" placeholder=\"Address\" required><br>\n            </div>\n\n            <div style=\"border: 1px solid #ddd; padding: 10px; margin: 5px;\">\n                <h3>Payment Information</h3>\n                <p>Select payment method:</p>\n                <select name=\"payment_method\">\n                    <option value=\"credit_card\">Credit Card</option>\n                    <option value=\"paypal\">PayPal</option>\n                    <option value=\"bank_transfer\">Bank Transfer</option>\n                </select><br>\n            </div>\n\n            <input type=\"submit\" value=\"Place Order\">\n        </form>\n    <?php endif; ?>\n\n    <p><a href=\"view_cart.php\">Back to Cart</a></p>\n</body>\n</html>\n```", "```php\n<?php\nsession_start();\ninclude 'config.php';\n\n$order_id = $_GET['order_id'];\n\n$sql = \"SELECT o.*, u.username FROM orders o\n        JOIN users u ON o.user_id = u.id\n        WHERE o.id = ?\";\n$stmt = mysqli_prepare($conn, $sql);\nmysqli_stmt_bind_param($stmt, \"i\", $order_id);\n\nif (mysqli_stmt_execute($stmt)) {\n    $result = mysqli_stmt_get_result($stmt);\n    $order = mysqli_fetch_assoc($result);\n}\n?>\n\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Order Confirmation</title>\n</head>\n<body>\n    <h1>Thank you for your order!</h1>\n    <p>Your order ID is: <?php echo $order_id; ?></p>\n    <p>Total Amount: <?php echo number_format($order['total_amount'], 2); ?> $</p>\n    <p>Payment Method: <?php echo $order['payment_method']; ?></p>\n    <p>Status: <?php echo $order['status']; ?></p>\n    <p>Order placed by: <?php echo $order['username']; ?></p>\n\n    <h2>Your Order Details:</h2>\n    <?php\n    $sql_details = \"SELECT od.*, p.name FROM order_details od\n                    JOIN products p ON od.product_id = p.id\n                    WHERE od.order_id = ?\";\n    $stmt_details = mysqli_prepare($conn, $sql_details);\n    mysqli_stmt_bind_param($stmt_details, \"i\", $order_id);\n\n    if (mysqli_stmt_execute($stmt_details)) {\n        $result_details = mysqli_stmt_get_result($stmt_details);\n        while ($detail = mysqli_fetch_assoc($result_details)) :\n            ?>\n            <div style=\"border: 1px solid #ddd; padding: 10px; margin: 5px;\">\n                <h3><?php echo $detail['name']; ?></h3>\n                <p>Quantity: <?php echo $detail['quantity']; ?></p>\n                <p>Subtotal: <?php echo number_format($detail['subtotal'], 2); ?> $</p>\n            </div>\n        <?php endwhile; ?>\n    <?php } ?>\n\n    <p><a href=\"products.php\">Continue Shopping</a></p>\n</body>\n</html>\n```"]}
