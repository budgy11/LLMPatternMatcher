{"prompt": "Create a purchase functionality using php", "llm_output": "**Purchase Functionality in PHP**\n=====================================\n\nIn this example, we will create a simple purchase functionality that allows users to add items to their cart and checkout. We'll use PHP as the server-side language and MySQL as the database management system.\n\n**Database Schema**\n------------------\n\nCreate a new MySQL database and execute the following SQL queries:\n```sql\nCREATE TABLE products (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  name VARCHAR(255),\n  price DECIMAL(10,2)\n);\n\nCREATE TABLE cart (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  user_id INT,\n  product_id INT,\n  quantity INT,\n  FOREIGN KEY (user_id) REFERENCES users(id),\n  FOREIGN KEY (product_id) REFERENCES products(id)\n);\n```\n**PHP Code**\n-------------\n\nCreate a new file called `purchase.php` and add the following code:\n```php\n<?php\n\n// Configuration\n$dbHost = 'localhost';\n$dbUsername = 'root';\n$dbPassword = '';\n$dbName = 'store';\n\n// Connect to database\n$conn = new mysqli($dbHost, $dbUsername, $dbPassword, $dbName);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Function to add product to cart\nfunction addProductToCart() {\n  global $conn;\n  \n  if (isset($_POST['product_id']) && isset($_POST['quantity'])) {\n    $productId = $_POST['product_id'];\n    $quantity = $_POST['quantity'];\n    \n    // Check if product exists in database\n    $query = \"SELECT * FROM products WHERE id = '$productId'\";\n    $result = $conn->query($query);\n    \n    if ($result->num_rows > 0) {\n      while ($row = $result->fetch_assoc()) {\n        $productName = $row['name'];\n        $productPrice = $row['price'];\n        \n        // Check if product is already in cart\n        $cartQuery = \"SELECT * FROM cart WHERE user_id = \".$_SESSION['user_id'].\" AND product_id = '$productId'\";\n        $cartResult = $conn->query($cartQuery);\n        \n        if ($cartResult->num_rows > 0) {\n          while ($cartRow = $cartResult->fetch_assoc()) {\n            // Update quantity\n            $newQuantity = $cartRow['quantity'] + $quantity;\n            \n            // Update cart table\n            $updateQuery = \"UPDATE cart SET quantity = '$newQuantity' WHERE id = \".$cartRow['id'];\n            $conn->query($updateQuery);\n          }\n        } else {\n          // Insert new product into cart\n          $insertQuery = \"INSERT INTO cart (user_id, product_id, quantity) VALUES ('\".$_SESSION['user_id'].\"', '$productId', '$quantity')\";\n          $conn->query($insertQuery);\n        }\n      }\n    }\n  }\n}\n\n// Function to display cart contents\nfunction displayCartContents() {\n  global $conn;\n  \n  // Get all products in cart for current user\n  $cartQuery = \"SELECT * FROM cart WHERE user_id = \".$_SESSION['user_id'];\n  $result = $conn->query($cartQuery);\n  \n  if ($result->num_rows > 0) {\n    echo \"<table border='1'>\";\n    while ($row = $result->fetch_assoc()) {\n      $productName = getProductNameFromId($row['product_id']);\n      \n      echo \"<tr>\";\n      echo \"<td>\".$productName.\"</td>\";\n      echo \"<td>Quantity: \".$row['quantity'].\"</td>\";\n      echo \"</tr>\";\n    }\n    echo \"</table>\";\n  } else {\n    echo \"Your cart is empty!\";\n  }\n}\n\n// Function to display checkout form\nfunction displayCheckoutForm() {\n  global $conn;\n  \n  // Get all products in cart for current user\n  $cartQuery = \"SELECT * FROM cart WHERE user_id = \".$_SESSION['user_id'];\n  $result = $conn->query($cartQuery);\n  \n  if ($result->num_rows > 0) {\n    echo \"<h2>Checkout</h2>\";\n    \n    // Get total cost of products in cart\n    $totalCost = 0;\n    while ($row = $result->fetch_assoc()) {\n      $productName = getProductNameFromId($row['product_id']);\n      \n      // Get product price from database\n      $query = \"SELECT * FROM products WHERE id = '$row[product_id]'\";\n      $resultPrice = $conn->query($query);\n      \n      if ($resultPrice->num_rows > 0) {\n        while ($priceRow = $resultPrice->fetch_assoc()) {\n          $totalCost += $priceRow['price'] * $row['quantity'];\n        }\n      }\n    }\n    \n    echo \"<h3>Total cost: $\".number_format($totalCost,2).\"</h3>\";\n    \n    // Display checkout form\n    echo \"<form action='\".$_SERVER['PHP_SELF'].\"' method='post'>\";\n    echo \"Payment method:<br>\";\n    echo \"<input type='radio' name='payment_method' value='paypal'> PayPal<br>\";\n    echo \"<input type='radio' name='payment_method' value='credit_card'> Credit card<br><br>\";\n    echo \"Enter payment information:<br>\";\n    echo \"<textarea name='payment_info' rows='5' cols='30'></textarea><br><br>\";\n    echo \"<input type='submit' value='Submit'>\";\n    echo \"</form>\";\n  }\n}\n\n// Function to get product name from id\nfunction getProductNameFromId($id) {\n  global $conn;\n  \n  $query = \"SELECT * FROM products WHERE id = '$id'\";\n  $result = $conn->query($query);\n  \n  if ($result->num_rows > 0) {\n    while ($row = $result->fetch_assoc()) {\n      return $row['name'];\n    }\n  } else {\n    return \"\";\n  }\n}\n\n// Display cart contents and checkout form\ndisplayCartContents();\ndisplayCheckoutForm();\n\n?>\n```\n**Usage**\n-----\n\n1. Create a new file called `index.php` and add the following code:\n```php\n<?php\nsession_start();\n\n// Include purchase functionality\ninclude 'purchase.php';\n\n// Add product to cart\nif (isset($_POST['add_to_cart'])) {\n  $productId = $_POST['product_id'];\n  $quantity = $_POST['quantity'];\n  \n  // Update session variables\n  $_SESSION['product_id'] = $productId;\n  $_SESSION['quantity'] = $quantity;\n  \n  // Add product to cart using purchase functionality\n  addProductToCart();\n}\n\n// Display products for sale\necho \"<h1>Products for Sale</h1>\";\necho \"<ul>\";\n$query = \"SELECT * FROM products\";\n$result = $conn->query($query);\n\nif ($result->num_rows > 0) {\n  while ($row = $result->fetch_assoc()) {\n    echo \"<li>\".$row['name'].\"</li>\";\n  }\n}\necho \"</ul>\";\n\n?>\n```\n2. Create a new file called `cart.php` and add the following code:\n```php\n<?php\nsession_start();\n\n// Include purchase functionality\ninclude 'purchase.php';\n\n// Display cart contents\ndisplayCartContents();\n?>\n\n<form action='\".$_SERVER['PHP_SELF'].\"' method='post'>\n  <input type='hidden' name='add_to_cart' value='1'>\n  <input type='submit' value='Add to Cart'>\n</form>\n```\n3. Create a new file called `checkout.php` and add the following code:\n```php\n<?php\nsession_start();\n\n// Include purchase functionality\ninclude 'purchase.php';\n\n// Display checkout form\ndisplayCheckoutForm();\n?>\n```\n4. Create a new file called `payment.php` and add the following code:\n```php\n<?php\nsession_start();\n\n// Include purchase functionality\ninclude 'purchase.php';\n\n// Process payment information\nif (isset($_POST['submit'])) {\n  // Update database with payment information\n  $paymentMethod = $_POST['payment_method'];\n  $paymentInfo = $_POST['payment_info'];\n  \n  // Update cart table with payment information\n  $updateQuery = \"UPDATE cart SET payment_method = '$paymentMethod', payment_info = '$paymentInfo' WHERE user_id = \".$_SESSION['user_id'].\"\";\n  $conn->query($updateQuery);\n}\n?>\n```\n5. Create a new file called `thankyou.php` and add the following code:\n```php\n<?php\nsession_start();\n\n// Include purchase functionality\ninclude 'purchase.php';\n\n// Display thank you message\necho \"<h1>Thank You!</h1>\";\necho \"Your payment has been processed successfully!\";\n?>\n```\n**Note**\n----\n\nThis is a basic example of a purchase functionality in PHP. In a real-world scenario, you would need to add more features such as user authentication, product variations, shipping costs, and tax calculations. Additionally, you should use a secure payment gateway like Stripe or PayPal to process payments securely.\n\nAlso, this code assumes that the `products` table has been populated with some sample data. You will need to create your own database schema and populate it with your own products and prices.\n\nPlease test the code in a local environment before deploying it to a production server.", "code_blocks": [null, "```php\n<?php\n\n// Configuration\n$dbHost = 'localhost';\n$dbUsername = 'root';\n$dbPassword = '';\n$dbName = 'store';\n\n// Connect to database\n$conn = new mysqli($dbHost, $dbUsername, $dbPassword, $dbName);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Function to add product to cart\nfunction addProductToCart() {\n  global $conn;\n  \n  if (isset($_POST['product_id']) && isset($_POST['quantity'])) {\n    $productId = $_POST['product_id'];\n    $quantity = $_POST['quantity'];\n    \n    // Check if product exists in database\n    $query = \"SELECT * FROM products WHERE id = '$productId'\";\n    $result = $conn->query($query);\n    \n    if ($result->num_rows > 0) {\n      while ($row = $result->fetch_assoc()) {\n        $productName = $row['name'];\n        $productPrice = $row['price'];\n        \n        // Check if product is already in cart\n        $cartQuery = \"SELECT * FROM cart WHERE user_id = \".$_SESSION['user_id'].\" AND product_id = '$productId'\";\n        $cartResult = $conn->query($cartQuery);\n        \n        if ($cartResult->num_rows > 0) {\n          while ($cartRow = $cartResult->fetch_assoc()) {\n            // Update quantity\n            $newQuantity = $cartRow['quantity'] + $quantity;\n            \n            // Update cart table\n            $updateQuery = \"UPDATE cart SET quantity = '$newQuantity' WHERE id = \".$cartRow['id'];\n            $conn->query($updateQuery);\n          }\n        } else {\n          // Insert new product into cart\n          $insertQuery = \"INSERT INTO cart (user_id, product_id, quantity) VALUES ('\".$_SESSION['user_id'].\"', '$productId', '$quantity')\";\n          $conn->query($insertQuery);\n        }\n      }\n    }\n  }\n}\n\n// Function to display cart contents\nfunction displayCartContents() {\n  global $conn;\n  \n  // Get all products in cart for current user\n  $cartQuery = \"SELECT * FROM cart WHERE user_id = \".$_SESSION['user_id'];\n  $result = $conn->query($cartQuery);\n  \n  if ($result->num_rows > 0) {\n    echo \"<table border='1'>\";\n    while ($row = $result->fetch_assoc()) {\n      $productName = getProductNameFromId($row['product_id']);\n      \n      echo \"<tr>\";\n      echo \"<td>\".$productName.\"</td>\";\n      echo \"<td>Quantity: \".$row['quantity'].\"</td>\";\n      echo \"</tr>\";\n    }\n    echo \"</table>\";\n  } else {\n    echo \"Your cart is empty!\";\n  }\n}\n\n// Function to display checkout form\nfunction displayCheckoutForm() {\n  global $conn;\n  \n  // Get all products in cart for current user\n  $cartQuery = \"SELECT * FROM cart WHERE user_id = \".$_SESSION['user_id'];\n  $result = $conn->query($cartQuery);\n  \n  if ($result->num_rows > 0) {\n    echo \"<h2>Checkout</h2>\";\n    \n    // Get total cost of products in cart\n    $totalCost = 0;\n    while ($row = $result->fetch_assoc()) {\n      $productName = getProductNameFromId($row['product_id']);\n      \n      // Get product price from database\n      $query = \"SELECT * FROM products WHERE id = '$row[product_id]'\";\n      $resultPrice = $conn->query($query);\n      \n      if ($resultPrice->num_rows > 0) {\n        while ($priceRow = $resultPrice->fetch_assoc()) {\n          $totalCost += $priceRow['price'] * $row['quantity'];\n        }\n      }\n    }\n    \n    echo \"<h3>Total cost: $\".number_format($totalCost,2).\"</h3>\";\n    \n    // Display checkout form\n    echo \"<form action='\".$_SERVER['PHP_SELF'].\"' method='post'>\";\n    echo \"Payment method:<br>\";\n    echo \"<input type='radio' name='payment_method' value='paypal'> PayPal<br>\";\n    echo \"<input type='radio' name='payment_method' value='credit_card'> Credit card<br><br>\";\n    echo \"Enter payment information:<br>\";\n    echo \"<textarea name='payment_info' rows='5' cols='30'></textarea><br><br>\";\n    echo \"<input type='submit' value='Submit'>\";\n    echo \"</form>\";\n  }\n}\n\n// Function to get product name from id\nfunction getProductNameFromId($id) {\n  global $conn;\n  \n  $query = \"SELECT * FROM products WHERE id = '$id'\";\n  $result = $conn->query($query);\n  \n  if ($result->num_rows > 0) {\n    while ($row = $result->fetch_assoc()) {\n      return $row['name'];\n    }\n  } else {\n    return \"\";\n  }\n}\n\n// Display cart contents and checkout form\ndisplayCartContents();\ndisplayCheckoutForm();\n\n?>\n```", "```php\n<?php\nsession_start();\n\n// Include purchase functionality\ninclude 'purchase.php';\n\n// Add product to cart\nif (isset($_POST['add_to_cart'])) {\n  $productId = $_POST['product_id'];\n  $quantity = $_POST['quantity'];\n  \n  // Update session variables\n  $_SESSION['product_id'] = $productId;\n  $_SESSION['quantity'] = $quantity;\n  \n  // Add product to cart using purchase functionality\n  addProductToCart();\n}\n\n// Display products for sale\necho \"<h1>Products for Sale</h1>\";\necho \"<ul>\";\n$query = \"SELECT * FROM products\";\n$result = $conn->query($query);\n\nif ($result->num_rows > 0) {\n  while ($row = $result->fetch_assoc()) {\n    echo \"<li>\".$row['name'].\"</li>\";\n  }\n}\necho \"</ul>\";\n\n?>\n```", "```php\n<?php\nsession_start();\n\n// Include purchase functionality\ninclude 'purchase.php';\n\n// Display cart contents\ndisplayCartContents();\n?>\n\n<form action='\".$_SERVER['PHP_SELF'].\"' method='post'>\n  <input type='hidden' name='add_to_cart' value='1'>\n  <input type='submit' value='Add to Cart'>\n</form>\n```", "```php\n<?php\nsession_start();\n\n// Include purchase functionality\ninclude 'purchase.php';\n\n// Display checkout form\ndisplayCheckoutForm();\n?>\n```", "```php\n<?php\nsession_start();\n\n// Include purchase functionality\ninclude 'purchase.php';\n\n// Process payment information\nif (isset($_POST['submit'])) {\n  // Update database with payment information\n  $paymentMethod = $_POST['payment_method'];\n  $paymentInfo = $_POST['payment_info'];\n  \n  // Update cart table with payment information\n  $updateQuery = \"UPDATE cart SET payment_method = '$paymentMethod', payment_info = '$paymentInfo' WHERE user_id = \".$_SESSION['user_id'].\"\";\n  $conn->query($updateQuery);\n}\n?>\n```", "```php\n<?php\nsession_start();\n\n// Include purchase functionality\ninclude 'purchase.php';\n\n// Display thank you message\necho \"<h1>Thank You!</h1>\";\necho \"Your payment has been processed successfully!\";\n?>\n```"]}
