{"prompt": "Create a purchase functionality using php", "llm_output": "Here is an example of a basic purchase functionality using PHP:\n\n**Note:** This example assumes that you have already created a database and set up the necessary tables for storing products, users, and orders.\n\n**database schema:**\n\n```sql\nCREATE TABLE products (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  name VARCHAR(255),\n  price DECIMAL(10,2)\n);\n\nCREATE TABLE users (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  email VARCHAR(255) UNIQUE\n);\n\nCREATE TABLE orders (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  user_id INT,\n  product_id INT,\n  order_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n  total_cost DECIMAL(10,2),\n  FOREIGN KEY (user_id) REFERENCES users(id),\n  FOREIGN KEY (product_id) REFERENCES products(id)\n);\n```\n\n**purchase.php:**\n```php\n<?php\n\n// include database connection settings\nrequire_once 'db_connect.php';\n\n// check if user is logged in\nif (!isset($_SESSION['user_id'])) {\n    // redirect to login page\n    header('Location: login.php');\n    exit;\n}\n\n// retrieve product ID from URL parameter\n$product_id = $_GET['product_id'];\n\n// query database for product details\n$query = \"SELECT * FROM products WHERE id = :product_id\";\n$stmt = $db->prepare($query);\n$stmt->bindParam(':product_id', $product_id);\n$stmt->execute();\n$product = $stmt->fetch();\n\n// validate user input (if any)\nif (isset($_POST['quantity']) && $_POST['quantity'] > 0) {\n    // retrieve quantity from POST variable\n    $quantity = $_POST['quantity'];\n\n    // query database for user details\n    $query = \"SELECT * FROM users WHERE id = :user_id\";\n    $stmt = $db->prepare($query);\n    $stmt->bindParam(':user_id', $_SESSION['user_id']);\n    $stmt->execute();\n    $user = $stmt->fetch();\n\n    // calculate order total cost\n    $order_total = $product['price'] * $quantity;\n\n    // insert new order into database\n    $query = \"INSERT INTO orders (user_id, product_id, total_cost) VALUES (:user_id, :product_id, :total_cost)\";\n    $stmt = $db->prepare($query);\n    $stmt->bindParam(':user_id', $_SESSION['user_id']);\n    $stmt->bindParam(':product_id', $product_id);\n    $stmt->bindParam(':total_cost', $order_total);\n    $stmt->execute();\n\n    // redirect to success page\n    header('Location: success.php');\n    exit;\n} else {\n    // display product details and quantity form\n    ?>\n    <h1>Product Details:</h1>\n    <p>Name: <?php echo $product['name']; ?></p>\n    <p>Price: <?php echo $product['price']; ?></p>\n\n    <form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\">\n        <label for=\"quantity\">Quantity:</label>\n        <input type=\"number\" id=\"quantity\" name=\"quantity\" value=\"1\">\n        <input type=\"hidden\" name=\"product_id\" value=\"<?php echo $product_id; ?>\">\n        <button type=\"submit\">Purchase</button>\n    </form>\n\n<?php\n}\n?>\n```\n\n**success.php:**\n```php\n<?php\n\n// include database connection settings\nrequire_once 'db_connect.php';\n\n// retrieve order ID from session variable\n$order_id = $_SESSION['order_id'];\n\n// query database for order details\n$query = \"SELECT * FROM orders WHERE id = :order_id\";\n$stmt = $db->prepare($query);\n$stmt->bindParam(':order_id', $order_id);\n$stmt->execute();\n$order = $stmt->fetch();\n\n?>\n<h1>Order Successful!</h1>\n<p>Product: <?php echo $order['product_name']; ?></p>\n<p>Quantity: <?php echo $order['quantity']; ?></p>\n<p>Total Cost: <?php echo $order['total_cost']; ?></p>\n\n<?php\nunset($_SESSION['user_id']);\nunset($_SESSION['order_id']);\n\n?>\n```\n\n**db_connect.php:**\n```php\n<?php\n\n// include database connection settings\n$host = 'localhost';\n$dbname = 'your_database_name';\n$username = 'your_username';\n$password = 'your_password';\n\ntry {\n    $db = new PDO(\"mysql:host=$host;dbname=$dbname\", $username, $password);\n} catch (PDOException $e) {\n    echo 'Connection failed: ' . $e->getMessage();\n}\n\n?>\n```\n\nThis is a basic example of how you can implement a purchase functionality using PHP. You will need to modify the code to suit your specific requirements and integrate it with your existing database schema.\n\n**Example Use Case:**\n\n1. User logs in and selects a product from the catalog.\n2. The user clicks on the \"Purchase\" button, which submits a form with the product ID and quantity.\n3. The purchase.php script processes the form data and queries the database to retrieve the product details and calculate the order total cost.\n4. If the quantity is valid (i.e., greater than 0), the script inserts a new order into the database and redirects the user to the success page.\n5. On the success page, the user can view their order details, including the product name, quantity, and total cost.\n\nNote that this example assumes a simple use case where the user is purchasing a single product. You may need to modify the code to handle more complex scenarios, such as handling multiple products or subscriptions.", "code_blocks": [null, "```php\n<?php\n\n// include database connection settings\nrequire_once 'db_connect.php';\n\n// check if user is logged in\nif (!isset($_SESSION['user_id'])) {\n    // redirect to login page\n    header('Location: login.php');\n    exit;\n}\n\n// retrieve product ID from URL parameter\n$product_id = $_GET['product_id'];\n\n// query database for product details\n$query = \"SELECT * FROM products WHERE id = :product_id\";\n$stmt = $db->prepare($query);\n$stmt->bindParam(':product_id', $product_id);\n$stmt->execute();\n$product = $stmt->fetch();\n\n// validate user input (if any)\nif (isset($_POST['quantity']) && $_POST['quantity'] > 0) {\n    // retrieve quantity from POST variable\n    $quantity = $_POST['quantity'];\n\n    // query database for user details\n    $query = \"SELECT * FROM users WHERE id = :user_id\";\n    $stmt = $db->prepare($query);\n    $stmt->bindParam(':user_id', $_SESSION['user_id']);\n    $stmt->execute();\n    $user = $stmt->fetch();\n\n    // calculate order total cost\n    $order_total = $product['price'] * $quantity;\n\n    // insert new order into database\n    $query = \"INSERT INTO orders (user_id, product_id, total_cost) VALUES (:user_id, :product_id, :total_cost)\";\n    $stmt = $db->prepare($query);\n    $stmt->bindParam(':user_id', $_SESSION['user_id']);\n    $stmt->bindParam(':product_id', $product_id);\n    $stmt->bindParam(':total_cost', $order_total);\n    $stmt->execute();\n\n    // redirect to success page\n    header('Location: success.php');\n    exit;\n} else {\n    // display product details and quantity form\n    ?>\n    <h1>Product Details:</h1>\n    <p>Name: <?php echo $product['name']; ?></p>\n    <p>Price: <?php echo $product['price']; ?></p>\n\n    <form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\">\n        <label for=\"quantity\">Quantity:</label>\n        <input type=\"number\" id=\"quantity\" name=\"quantity\" value=\"1\">\n        <input type=\"hidden\" name=\"product_id\" value=\"<?php echo $product_id; ?>\">\n        <button type=\"submit\">Purchase</button>\n    </form>\n\n<?php\n}\n?>\n```", "```php\n<?php\n\n// include database connection settings\nrequire_once 'db_connect.php';\n\n// retrieve order ID from session variable\n$order_id = $_SESSION['order_id'];\n\n// query database for order details\n$query = \"SELECT * FROM orders WHERE id = :order_id\";\n$stmt = $db->prepare($query);\n$stmt->bindParam(':order_id', $order_id);\n$stmt->execute();\n$order = $stmt->fetch();\n\n?>\n<h1>Order Successful!</h1>\n<p>Product: <?php echo $order['product_name']; ?></p>\n<p>Quantity: <?php echo $order['quantity']; ?></p>\n<p>Total Cost: <?php echo $order['total_cost']; ?></p>\n\n<?php\nunset($_SESSION['user_id']);\nunset($_SESSION['order_id']);\n\n?>\n```", "```php\n<?php\n\n// include database connection settings\n$host = 'localhost';\n$dbname = 'your_database_name';\n$username = 'your_username';\n$password = 'your_password';\n\ntry {\n    $db = new PDO(\"mysql:host=$host;dbname=$dbname\", $username, $password);\n} catch (PDOException $e) {\n    echo 'Connection failed: ' . $e->getMessage();\n}\n\n?>\n```"]}
