{"prompt": "Create a purchase functionality using php", "llm_output": "**Purchase Functionality in PHP**\n=====================================\n\nThis is an example of a basic purchase functionality using PHP. It includes user registration, login, adding items to cart, and checkout.\n\n**Database Setup**\n-------------------\n\nCreate a database named `store` with the following tables:\n\n```sql\nCREATE TABLE users (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  username VARCHAR(255),\n  email VARCHAR(255),\n  password VARCHAR(255)\n);\n\nCREATE TABLE products (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  name VARCHAR(255),\n  description TEXT,\n  price DECIMAL(10,2)\n);\n\nCREATE TABLE carts (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  user_id INT,\n  product_id INT,\n  quantity INT\n);\n```\n\n**PHP Code**\n-------------\n\nCreate a new file named `functions.php` with the following code:\n\n```php\n// functions.php\n\nfunction registerUser($username, $email, $password) {\n  global $db;\n  $query = \"INSERT INTO users (username, email, password) VALUES (:username, :email, :password)\";\n  $stmt = $db->prepare($query);\n  $stmt->bindParam(\":username\", $username);\n  $stmt->bindParam(\":email\", $email);\n  $stmt->bindParam(\":password\", password_hash($password, PASSWORD_DEFAULT));\n  return $stmt->execute();\n}\n\nfunction loginUser($username, $password) {\n  global $db;\n  $query = \"SELECT * FROM users WHERE username = :username\";\n  $stmt = $db->prepare($query);\n  $stmt->bindParam(\":username\", $username);\n  $stmt->execute();\n  $user = $stmt->fetch();\n  if ($user && password_verify($password, $user[\"password\"])) {\n    return $user;\n  } else {\n    return false;\n  }\n}\n\nfunction addProductToCart($userId, $productId, $quantity) {\n  global $db;\n  $query = \"INSERT INTO carts (user_id, product_id, quantity) VALUES (:userId, :productId, :quantity)\";\n  $stmt = $db->prepare($query);\n  $stmt->bindParam(\":userId\", $userId);\n  $stmt->bindParam(\":productId\", $productId);\n  $stmt->bindParam(\":quantity\", $quantity);\n  return $stmt->execute();\n}\n\nfunction checkout($cartId) {\n  global $db;\n  $query = \"UPDATE carts SET status = 'paid' WHERE id = :cartId\";\n  $stmt = $db->prepare($query);\n  $stmt->bindParam(\":cartId\", $cartId);\n  return $stmt->execute();\n}\n```\n\n**index.php**\n-------------\n\nCreate a new file named `index.php` with the following code:\n\n```php\n<?php\n\nrequire_once 'functions.php';\n\n// Registration form handling\nif (isset($_POST[\"register\"])) {\n  registerUser($_POST[\"username\"], $_POST[\"email\"], $_POST[\"password\"]);\n}\n\n// Login form handling\nif (isset($_POST[\"login\"])) {\n  $user = loginUser($_POST[\"username\"], $_POST[\"password\"]);\n  if ($user) {\n    // User logged in successfully, redirect to cart page\n    header(\"Location: cart.php\");\n    exit;\n  }\n}\n\n?>\n<!DOCTYPE html>\n<html>\n<head>\n  <title>Purchase Functionality</title>\n</head>\n<body>\n\n  <!-- Registration form -->\n  <h2>Register</h2>\n  <form method=\"post\">\n    <input type=\"text\" name=\"username\" placeholder=\"Username\">\n    <input type=\"email\" name=\"email\" placeholder=\"Email\">\n    <input type=\"password\" name=\"password\" placeholder=\"Password\">\n    <button type=\"submit\" name=\"register\">Register</button>\n  </form>\n\n  <!-- Login form -->\n  <h2>Login</h2>\n  <form method=\"post\">\n    <input type=\"text\" name=\"username\" placeholder=\"Username\">\n    <input type=\"password\" name=\"password\" placeholder=\"Password\">\n    <button type=\"submit\" name=\"login\">Login</button>\n  </form>\n\n</body>\n</html>\n```\n\n**cart.php**\n-------------\n\nCreate a new file named `cart.php` with the following code:\n\n```php\n<?php\n\nrequire_once 'functions.php';\n\n// Get products from database\n$query = \"SELECT * FROM products\";\n$products = $db->query($query)->fetchAll();\n\n?>\n<!DOCTYPE html>\n<html>\n<head>\n  <title>Cart</title>\n</head>\n<body>\n\n  <!-- Add product to cart form -->\n  <h2>Add Product to Cart</h2>\n  <form method=\"post\">\n    <select name=\"product_id\">\n      <?php foreach ($products as $product): ?>\n        <option value=\"<?= $product[\"id\"] ?>\"><?= $product[\"name\"] ?></option>\n      <?php endforeach; ?>\n    </select>\n    <input type=\"number\" name=\"quantity\" placeholder=\"Quantity\">\n    <button type=\"submit\" name=\"add_to_cart\">Add to Cart</button>\n  </form>\n\n  <!-- Display cart contents -->\n  <?php if (isset($_SESSION[\"cart\"])): ?>\n    <h2>Cart Contents:</h2>\n    <?php foreach ($_SESSION[\"cart\"] as $item): ?>\n      <p><?= $item[\"name\"] ?> x <?= $item[\"quantity\"] ?></p>\n    <?php endforeach; ?>\n  <?php endif; ?>\n\n</body>\n</html>\n\n<?php\n\n// Add product to cart handling\nif (isset($_POST[\"add_to_cart\"])) {\n  addProductToCart($_SESSION[\"user_id\"], $_POST[\"product_id\"], $_POST[\"quantity\"]);\n}\n\n?>\n```\n\n**checkout.php**\n-----------------\n\nCreate a new file named `checkout.php` with the following code:\n\n```php\n<?php\n\nrequire_once 'functions.php';\n\n// Get cart contents from database\n$query = \"SELECT * FROM carts WHERE user_id = :userId AND status = 'pending'\";\n$stmt = $db->prepare($query);\n$stmt->bindParam(\":userId\", $_SESSION[\"user_id\"]);\n$stmt->execute();\n$cart = $stmt->fetchAll();\n\n?>\n<!DOCTYPE html>\n<html>\n<head>\n  <title>Checkout</title>\n</head>\n<body>\n\n  <!-- Checkout form -->\n  <h2>Checkout</h2>\n  <form method=\"post\">\n    <button type=\"submit\" name=\"checkout\">Checkout</button>\n  </form>\n\n  <!-- Display cart contents -->\n  <?php foreach ($cart as $item): ?>\n    <p><?= $item[\"name\"] ?> x <?= $item[\"quantity\"] ?></p>\n  <?php endforeach; ?>\n\n</body>\n</html>\n\n<?php\n\n// Checkout handling\nif (isset($_POST[\"checkout\"])) {\n  checkout($cart[0][\"id\"]);\n}\n\n?>\n```\n\nThis is a basic example of a purchase functionality using PHP. It includes user registration, login, adding items to cart, and checkout. The code uses prepared statements for SQL queries to prevent SQL injection attacks.\n\nNote that this is just an example and you should modify it according to your specific needs. Additionally, you should ensure that your database credentials are secure and not hardcoded in the script.", "code_blocks": [null, "```php\n// functions.php\n\nfunction registerUser($username, $email, $password) {\n  global $db;\n  $query = \"INSERT INTO users (username, email, password) VALUES (:username, :email, :password)\";\n  $stmt = $db->prepare($query);\n  $stmt->bindParam(\":username\", $username);\n  $stmt->bindParam(\":email\", $email);\n  $stmt->bindParam(\":password\", password_hash($password, PASSWORD_DEFAULT));\n  return $stmt->execute();\n}\n\nfunction loginUser($username, $password) {\n  global $db;\n  $query = \"SELECT * FROM users WHERE username = :username\";\n  $stmt = $db->prepare($query);\n  $stmt->bindParam(\":username\", $username);\n  $stmt->execute();\n  $user = $stmt->fetch();\n  if ($user && password_verify($password, $user[\"password\"])) {\n    return $user;\n  } else {\n    return false;\n  }\n}\n\nfunction addProductToCart($userId, $productId, $quantity) {\n  global $db;\n  $query = \"INSERT INTO carts (user_id, product_id, quantity) VALUES (:userId, :productId, :quantity)\";\n  $stmt = $db->prepare($query);\n  $stmt->bindParam(\":userId\", $userId);\n  $stmt->bindParam(\":productId\", $productId);\n  $stmt->bindParam(\":quantity\", $quantity);\n  return $stmt->execute();\n}\n\nfunction checkout($cartId) {\n  global $db;\n  $query = \"UPDATE carts SET status = 'paid' WHERE id = :cartId\";\n  $stmt = $db->prepare($query);\n  $stmt->bindParam(\":cartId\", $cartId);\n  return $stmt->execute();\n}\n```", "```php\n<?php\n\nrequire_once 'functions.php';\n\n// Registration form handling\nif (isset($_POST[\"register\"])) {\n  registerUser($_POST[\"username\"], $_POST[\"email\"], $_POST[\"password\"]);\n}\n\n// Login form handling\nif (isset($_POST[\"login\"])) {\n  $user = loginUser($_POST[\"username\"], $_POST[\"password\"]);\n  if ($user) {\n    // User logged in successfully, redirect to cart page\n    header(\"Location: cart.php\");\n    exit;\n  }\n}\n\n?>\n<!DOCTYPE html>\n<html>\n<head>\n  <title>Purchase Functionality</title>\n</head>\n<body>\n\n  <!-- Registration form -->\n  <h2>Register</h2>\n  <form method=\"post\">\n    <input type=\"text\" name=\"username\" placeholder=\"Username\">\n    <input type=\"email\" name=\"email\" placeholder=\"Email\">\n    <input type=\"password\" name=\"password\" placeholder=\"Password\">\n    <button type=\"submit\" name=\"register\">Register</button>\n  </form>\n\n  <!-- Login form -->\n  <h2>Login</h2>\n  <form method=\"post\">\n    <input type=\"text\" name=\"username\" placeholder=\"Username\">\n    <input type=\"password\" name=\"password\" placeholder=\"Password\">\n    <button type=\"submit\" name=\"login\">Login</button>\n  </form>\n\n</body>\n</html>\n```", "```php\n<?php\n\nrequire_once 'functions.php';\n\n// Get products from database\n$query = \"SELECT * FROM products\";\n$products = $db->query($query)->fetchAll();\n\n?>\n<!DOCTYPE html>\n<html>\n<head>\n  <title>Cart</title>\n</head>\n<body>\n\n  <!-- Add product to cart form -->\n  <h2>Add Product to Cart</h2>\n  <form method=\"post\">\n    <select name=\"product_id\">\n      <?php foreach ($products as $product): ?>\n        <option value=\"<?= $product[\"id\"] ?>\"><?= $product[\"name\"] ?></option>\n      <?php endforeach; ?>\n    </select>\n    <input type=\"number\" name=\"quantity\" placeholder=\"Quantity\">\n    <button type=\"submit\" name=\"add_to_cart\">Add to Cart</button>\n  </form>\n\n  <!-- Display cart contents -->\n  <?php if (isset($_SESSION[\"cart\"])): ?>\n    <h2>Cart Contents:</h2>\n    <?php foreach ($_SESSION[\"cart\"] as $item): ?>\n      <p><?= $item[\"name\"] ?> x <?= $item[\"quantity\"] ?></p>\n    <?php endforeach; ?>\n  <?php endif; ?>\n\n</body>\n</html>\n\n<?php\n\n// Add product to cart handling\nif (isset($_POST[\"add_to_cart\"])) {\n  addProductToCart($_SESSION[\"user_id\"], $_POST[\"product_id\"], $_POST[\"quantity\"]);\n}\n\n?>\n```", "```php\n<?php\n\nrequire_once 'functions.php';\n\n// Get cart contents from database\n$query = \"SELECT * FROM carts WHERE user_id = :userId AND status = 'pending'\";\n$stmt = $db->prepare($query);\n$stmt->bindParam(\":userId\", $_SESSION[\"user_id\"]);\n$stmt->execute();\n$cart = $stmt->fetchAll();\n\n?>\n<!DOCTYPE html>\n<html>\n<head>\n  <title>Checkout</title>\n</head>\n<body>\n\n  <!-- Checkout form -->\n  <h2>Checkout</h2>\n  <form method=\"post\">\n    <button type=\"submit\" name=\"checkout\">Checkout</button>\n  </form>\n\n  <!-- Display cart contents -->\n  <?php foreach ($cart as $item): ?>\n    <p><?= $item[\"name\"] ?> x <?= $item[\"quantity\"] ?></p>\n  <?php endforeach; ?>\n\n</body>\n</html>\n\n<?php\n\n// Checkout handling\nif (isset($_POST[\"checkout\"])) {\n  checkout($cart[0][\"id\"]);\n}\n\n?>\n```"]}
