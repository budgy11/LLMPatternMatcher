{"prompt": "Create a purchase functionality using php", "llm_output": "<think>\nOkay, I need to create a purchase functionality using PHP. Let me think about how to approach this.\n\nFirst, I should outline the main components required. There's a product page where users can view items and add them to their cart. Then, a shopping cart page to display selected products, quantities, and prices. Finally, a checkout page where users enter payment details and complete the purchase.\n\nI'll start by setting up the database. I need tables for products, including id, name, description, price, stock, etc. Another table for orders with user info and order status. And an order_items table to link each order to its products and quantities.\n\nNext, I'll create product cards dynamically using PHP. Fetching data from the products table and displaying them in a grid layout. Each card should have an \"Add to Cart\" button that sends the product ID to the cart handling script.\n\nFor the shopping cart functionality, I'll use sessions to store items temporarily. When a user adds a product, it goes into the session array with quantity. On the cart page, I'll display each item's details and allow adjusting quantities or removing items. The total price will be calculated dynamically.\n\nMoving on to checkout, users need to provide their information. I'll create a form that collects first name, last name, email, address, city, state, ZIP, phone, and payment method. Validation is crucial here\u2014each field needs checks to ensure correctness before processing the order.\n\nProcessing the order involves several steps. First, validate all input data to prevent any issues. Then, calculate the total price again. Insert the order into the orders table with user details and status as 'pending'. After that, insert each item in the cart into order_items. Finally, update the product stock by subtracting the purchased quantity.\n\nSecurity is a big concern. I'll use prepared statements to prevent SQL injection. Also, I'll handle errors gracefully and provide feedback to users if something goes wrong.\n\nI should also consider user experience. Clear error messages, success notifications after purchase, and ensuring all pages are responsive and visually appealing.\n\nTesting each part step by step is important. Make sure adding products works, the cart updates correctly, form validation triggers as expected, and database entries are accurate. Handling edge cases like out-of-stock items or invalid payment methods is necessary.\n\nFinally, I'll structure the code into separate files: config for database connection, functions for reusable tasks, and individual pages (products, cart, checkout) linked together with proper navigation.\n</think>\n\nHere's an example of a purchase functionality using PHP. This example includes:\n\n1. Product display\n2. Shopping cart functionality\n3. Checkout process\n4. Order processing\n\n### Step 1: Database Setup\n\nFirst, create a database and tables for products and orders.\n\n```sql\nCREATE TABLE products (\n    id INT PRIMARY KEY AUTO_INCREMENT,\n    name VARCHAR(255),\n    description TEXT,\n    price DECIMAL(10,2),\n    stock INT,\n    image_url VARCHAR(255)\n);\n\nCREATE TABLE orders (\n    id INT PRIMARY KEY AUTO_INCREMENT,\n    user_id INT,\n    total_price DECIMAL(10,2),\n    order_date DATETIME,\n    status ENUM('pending', 'completed', 'cancelled')\n);\n\nCREATE TABLE order_items (\n    id INT PRIMARY KEY AUTO_INCREMENT,\n    order_id INT,\n    product_id INT,\n    quantity INT,\n    price DECIMAL(10,2)\n);\n```\n\n### Step 2: Product Display Page\n\n```php\n<?php\n// config.php - Database connection configuration\n$host = 'localhost';\n$username = 'root';\n$password = '';\n$dbname = 'shopping_cart';\n\n$conn = mysqli_connect($host, $username, $password, $dbname);\n\nif (!$conn) {\n    die(\"Connection failed: \" . mysqli_connect_error());\n}\n?>\n\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Product List</title>\n    <style>\n        .product-card {\n            border: 1px solid #ddd;\n            padding: 20px;\n            margin: 10px;\n            width: 300px;\n            float: left;\n        }\n        .product-image {\n            max-width: 200px;\n        }\n    </style>\n</head>\n<body>\n    <h1>Product List</h1>\n    \n    <?php\n    // Fetch products from database\n    $sql = \"SELECT * FROM products\";\n    $result = mysqli_query($conn, $sql);\n\n    if (mysqli_num_rows($result) > 0) {\n        while ($row = mysqli_fetch_assoc($result)) {\n            echo \"<div class='product-card'>\";\n                echo \"<img src='\" . $row['image_url'] . \"' alt='\" . $row['name'] . \"' class='product-image'>\";\n                echo \"<h3>\" . $row['name'] . \"</h3>\";\n                echo \"<p>Description: \" . $row['description'] . \"</p>\";\n                echo \"<p>Price: $\" . number_format($row['price'], 2) . \"</p>\";\n                echo \"<form action='add_to_cart.php' method='post'>\";\n                    echo \"<input type='hidden' name='product_id' value='\" . $row['id'] . \"'>\";\n                    echo \"<input type='number' name='quantity' min='1' max='\" . $row['stock'] . \"' value='1'>\";\n                    echo \"<button type='submit'>Add to Cart</button>\";\n                echo \"</form>\";\n            echo \"</div>\";\n        }\n    } else {\n        echo \"No products available.\";\n    }\n    \n    mysqli_close($conn);\n    ?>\n</body>\n</html>\n```\n\n### Step 3: Add to Cart Functionality\n\n```php\n<?php\nsession_start();\n\n// Get product details from database\n$product_id = $_POST['product_id'];\n$quantity = $_POST['quantity'];\n\n$conn = mysqli_connect('localhost', 'root', '', 'shopping_cart');\n\n$sql = \"SELECT * FROM products WHERE id = $product_id\";\n$result = mysqli_query($conn, $sql);\n$product = mysqli_fetch_assoc($result);\n\nif ($quantity > $product['stock']) {\n    echo \"<script>alert('Not enough stock!');</script>\";\n} else {\n    // Add to cart\n    if (!isset($_SESSION['cart'])) {\n        $_SESSION['cart'] = array();\n    }\n    \n    $item = array(\n        'id' => $product_id,\n        'name' => $product['name'],\n        'price' => $product['price'],\n        'quantity' => $quantity\n    );\n    \n    $_SESSION['cart'][$product_id] = $item;\n}\n\n// Redirect back to product list\nheader(\"Location: products.php\");\nexit();\n?>\n```\n\n### Step 4: Shopping Cart Page\n\n```php\n<?php\nsession_start();\n\nif (!isset($_SESSION['cart'])) {\n    $_SESSION['cart'] = array();\n}\n?>\n\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Shopping Cart</title>\n    <style>\n        .cart-item {\n            border-bottom: 1px solid #ddd;\n            padding: 10px;\n        }\n    </style>\n</head>\n<body>\n    <h1>Your Shopping Cart</h1>\n    \n    <?php\n    $total = 0;\n    foreach ($_SESSION['cart'] as $item) {\n        echo \"<div class='cart-item'>\";\n            echo \"<p>\" . $item['name'] . \"</p>\";\n            echo \"<p>Quantity: \" . $item['quantity'] . \"</p>\";\n            echo \"<p>Price: $\" . number_format($item['price'], 2) . \"</p>\";\n            $total += $item['price'] * $item['quantity'];\n        echo \"</div>\";\n    }\n    \n    if ($total == 0) {\n        echo \"Your cart is empty.\";\n    } else {\n        echo \"<h3>Total: $\" . number_format($total, 2) . \"</h3>\";\n        echo \"<a href='checkout.php'>Proceed to Checkout</a>\";\n    }\n    ?>\n    \n    <p><a href=\"products.php\">Continue Shopping</a></p>\n</body>\n</html>\n```\n\n### Step 5: Checkout Page\n\n```php\n<?php\nsession_start();\n\nif (empty($_SESSION['cart'])) {\n    header(\"Location: products.php\");\n    exit();\n}\n?>\n\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Checkout</title>\n    <style>\n        .checkout-form {\n            max-width: 600px;\n            margin: 0 auto;\n            padding: 20px;\n        }\n        .form-group {\n            margin-bottom: 15px;\n        }\n    </style>\n</head>\n<body>\n    <h1>Checkout</h1>\n    \n    <?php\n    $total = 0;\n    foreach ($_SESSION['cart'] as $item) {\n        $total += $item['price'] * $item['quantity'];\n    }\n    ?>\n    \n    <div class=\"checkout-form\">\n        <form action=\"process_order.php\" method=\"post\">\n            <h3>Order Details</h3>\n            <p>Total: $\" . number_format($total, 2) . \"</p>\n            \n            <h3>Billing Information</h3>\n            <div class=\"form-group\">\n                <label for=\"first_name\">First Name:</label>\n                <input type=\"text\" id=\"first_name\" name=\"first_name\" required>\n            </div>\n            <div class=\"form-group\">\n                <label for=\"last_name\">Last Name:</label>\n                <input type=\"text\" id=\"last_name\" name=\"last_name\" required>\n            </div>\n            <div class=\"form-group\">\n                <label for=\"email\">Email:</label>\n                <input type=\"email\" id=\"email\" name=\"email\" required>\n            </div>\n            <div class=\"form-group\">\n                <label for=\"address\">Address:</label>\n                <input type=\"text\" id=\"address\" name=\"address\" required>\n            </div>\n            <div class=\"form-group\">\n                <label for=\"city\">City:</label>\n                <input type=\"text\" id=\"city\" name=\"city\" required>\n            </div>\n            <div class=\"form-group\">\n                <label for=\"state\">State:</label>\n                <input type=\"text\" id=\"state\" name=\"state\" required>\n            </div>\n            <div class=\"form-group\">\n                <label for=\"zip_code\">Zip Code:</label>\n                <input type=\"text\" id=\"zip_code\" name=\"zip_code\" required>\n            </div>\n            <div class=\"form-group\">\n                <label for=\"phone\">Phone:</label>\n                <input type=\"tel\" id=\"phone\" name=\"phone\" required>\n            </div>\n            \n            <h3>Payment Information</h3>\n            <div class=\"form-group\">\n                <label for=\"card_number\">Card Number:</label>\n                <input type=\"text\" id=\"card_number\" name=\"card_number\" required>\n            </div>\n            <div class=\"form-group\">\n                <label for=\"expiry_month\">Expiry Month:</label>\n                <select id=\"expiry_month\" name=\"expiry_month\" required>\n                    <?php\n                    for ($i = 1; $i <= 12; $i++) {\n                        echo \"<option value='$i'>\" . sprintf(\"%02d\", $i) . \"</option>\";\n                    }\n                    ?>\n                </select>\n            </div>\n            <div class=\"form-group\">\n                <label for=\"expiry_year\">Expiry Year:</label>\n                <select id=\"expiry_year\" name=\"expiry_year\" required>\n                    <?php\n                    $current_year = date(\"Y\");\n                    for ($i = $current_year; $i <= $current_year + 5; $i++) {\n                        echo \"<option value='$i'>$i</option>\";\n                    }\n                    ?>\n                </select>\n            </div>\n            \n            <button type=\"submit\">Place Order</button>\n        </form>\n    </div>\n</body>\n</html>\n```\n\n### Step 6: Process Order\n\n```php\n<?php\nsession_start();\n\nif (empty($_SESSION['cart'])) {\n    header(\"Location: products.php\");\n    exit();\n}\n\n// Validate form inputs\nforeach ($_POST as $key => $value) {\n    if ($value == \"\") {\n        die(\"Please fill in all required fields.\");\n    }\n}\n\n$conn = mysqli_connect('localhost', 'root', '', 'shopping_cart');\n\n$total_price = 0;\nforeach ($_SESSION['cart'] as $item) {\n    $total_price += $item['price'] * $item['quantity'];\n}\n\n// Insert order\n$sql_order = \"INSERT INTO orders (total_price, order_date, status)\n              VALUES ('$total_price', NOW(), 'pending')\";\nmysqli_query($conn, $sql_order);\n$order_id = mysqli_insert_id($conn);\n\n// Insert order items\nforeach ($_SESSION['cart'] as $item) {\n    $sql_item = \"INSERT INTO order_items (order_id, product_id, quantity, price)\n                 VALUES ('$order_id', '$item[id]', '$item[quantity]', '$item[price]')\";\n    mysqli_query($conn, $sql_item);\n}\n\n// Clear cart\nunset($_SESSION['cart']);\n\nheader(\"Location: thankyou.php\");\nexit();\n?>\n```\n\n### Step 7: Thank You Page\n\n```php\n<?php session_start(); ?>\n\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Thank You</title>\n    <style>\n        .thank-you {\n            text-align: center;\n            padding: 40px;\n            font-size: 24px;\n        }\n    </style>\n</head>\n<body>\n    <div class=\"thank-you\">\n        <h1>Thank You for Your Order!</h1>\n        <p>Your order has been successfully processed.</p>\n        <a href=\"products.php\">Continue Shopping</a>\n    </div>\n</body>\n</html>\n```\n\n### Explanation\n\nThis example provides a basic implementation of a purchase functionality with the following features:\n\n1. **Product Display**: Shows available products in a grid layout.\n2. **Add to Cart**: Allows users to add products to their cart with specified quantities.\n3. **Shopping Cart**: Displays the contents of the user's cart and calculates the total price.\n4. **Checkout Process**: Collects billing and payment information from the user.\n5. **Order Processing**: Validates input, inserts order into the database, and displays a thank you page.\n\n**Important Notes:**\n\n1. **Security Considerations**:\n   - Always sanitize user inputs to prevent SQL injection and XSS attacks.\n   - Use HTTPS for secure transactions.\n   - Implement proper error handling and validation.\n\n2. **Payment Gateway Integration**:\n   - This example uses a simple payment form but does not integrate with an actual payment gateway.\n   - For real-world applications, you should use a reliable payment gateway (e.g., Stripe, PayPal).\n\n3. **Session Management**:\n   - Ensure sessions are properly configured and secured to prevent session hijacking.\n\n4. **Error Handling**:\n   - Add proper error handling for database operations and user inputs.\n\n5. **User Authentication**:\n   - For a complete e-commerce solution, implement user authentication and registration functionality.\n\n6. **Order Status Tracking**:\n   - Implement functions to track order status (e.g., completed, shipped, cancelled).\n\n7. **Email Notifications**:\n   - Add email notifications for order confirmation and updates.\n\nThis is a basic implementation and can be extended with additional features such as:\n\n- User authentication\n- Product categories\n- Search functionality\n- Wishlist feature\n- Order tracking\n- Customer reviews\n- Coupon codes\n- Discount offers\n\nRemember to test each part of the system thoroughly before deploying it in a production environment.", "code_blocks": [null, "```php\n<?php\n// config.php - Database connection configuration\n$host = 'localhost';\n$username = 'root';\n$password = '';\n$dbname = 'shopping_cart';\n\n$conn = mysqli_connect($host, $username, $password, $dbname);\n\nif (!$conn) {\n    die(\"Connection failed: \" . mysqli_connect_error());\n}\n?>\n\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Product List</title>\n    <style>\n        .product-card {\n            border: 1px solid #ddd;\n            padding: 20px;\n            margin: 10px;\n            width: 300px;\n            float: left;\n        }\n        .product-image {\n            max-width: 200px;\n        }\n    </style>\n</head>\n<body>\n    <h1>Product List</h1>\n    \n    <?php\n    // Fetch products from database\n    $sql = \"SELECT * FROM products\";\n    $result = mysqli_query($conn, $sql);\n\n    if (mysqli_num_rows($result) > 0) {\n        while ($row = mysqli_fetch_assoc($result)) {\n            echo \"<div class='product-card'>\";\n                echo \"<img src='\" . $row['image_url'] . \"' alt='\" . $row['name'] . \"' class='product-image'>\";\n                echo \"<h3>\" . $row['name'] . \"</h3>\";\n                echo \"<p>Description: \" . $row['description'] . \"</p>\";\n                echo \"<p>Price: $\" . number_format($row['price'], 2) . \"</p>\";\n                echo \"<form action='add_to_cart.php' method='post'>\";\n                    echo \"<input type='hidden' name='product_id' value='\" . $row['id'] . \"'>\";\n                    echo \"<input type='number' name='quantity' min='1' max='\" . $row['stock'] . \"' value='1'>\";\n                    echo \"<button type='submit'>Add to Cart</button>\";\n                echo \"</form>\";\n            echo \"</div>\";\n        }\n    } else {\n        echo \"No products available.\";\n    }\n    \n    mysqli_close($conn);\n    ?>\n</body>\n</html>\n```", "```php\n<?php\nsession_start();\n\n// Get product details from database\n$product_id = $_POST['product_id'];\n$quantity = $_POST['quantity'];\n\n$conn = mysqli_connect('localhost', 'root', '', 'shopping_cart');\n\n$sql = \"SELECT * FROM products WHERE id = $product_id\";\n$result = mysqli_query($conn, $sql);\n$product = mysqli_fetch_assoc($result);\n\nif ($quantity > $product['stock']) {\n    echo \"<script>alert('Not enough stock!');</script>\";\n} else {\n    // Add to cart\n    if (!isset($_SESSION['cart'])) {\n        $_SESSION['cart'] = array();\n    }\n    \n    $item = array(\n        'id' => $product_id,\n        'name' => $product['name'],\n        'price' => $product['price'],\n        'quantity' => $quantity\n    );\n    \n    $_SESSION['cart'][$product_id] = $item;\n}\n\n// Redirect back to product list\nheader(\"Location: products.php\");\nexit();\n?>\n```", "```php\n<?php\nsession_start();\n\nif (!isset($_SESSION['cart'])) {\n    $_SESSION['cart'] = array();\n}\n?>\n\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Shopping Cart</title>\n    <style>\n        .cart-item {\n            border-bottom: 1px solid #ddd;\n            padding: 10px;\n        }\n    </style>\n</head>\n<body>\n    <h1>Your Shopping Cart</h1>\n    \n    <?php\n    $total = 0;\n    foreach ($_SESSION['cart'] as $item) {\n        echo \"<div class='cart-item'>\";\n            echo \"<p>\" . $item['name'] . \"</p>\";\n            echo \"<p>Quantity: \" . $item['quantity'] . \"</p>\";\n            echo \"<p>Price: $\" . number_format($item['price'], 2) . \"</p>\";\n            $total += $item['price'] * $item['quantity'];\n        echo \"</div>\";\n    }\n    \n    if ($total == 0) {\n        echo \"Your cart is empty.\";\n    } else {\n        echo \"<h3>Total: $\" . number_format($total, 2) . \"</h3>\";\n        echo \"<a href='checkout.php'>Proceed to Checkout</a>\";\n    }\n    ?>\n    \n    <p><a href=\"products.php\">Continue Shopping</a></p>\n</body>\n</html>\n```", "```php\n<?php\nsession_start();\n\nif (empty($_SESSION['cart'])) {\n    header(\"Location: products.php\");\n    exit();\n}\n?>\n\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Checkout</title>\n    <style>\n        .checkout-form {\n            max-width: 600px;\n            margin: 0 auto;\n            padding: 20px;\n        }\n        .form-group {\n            margin-bottom: 15px;\n        }\n    </style>\n</head>\n<body>\n    <h1>Checkout</h1>\n    \n    <?php\n    $total = 0;\n    foreach ($_SESSION['cart'] as $item) {\n        $total += $item['price'] * $item['quantity'];\n    }\n    ?>\n    \n    <div class=\"checkout-form\">\n        <form action=\"process_order.php\" method=\"post\">\n            <h3>Order Details</h3>\n            <p>Total: $\" . number_format($total, 2) . \"</p>\n            \n            <h3>Billing Information</h3>\n            <div class=\"form-group\">\n                <label for=\"first_name\">First Name:</label>\n                <input type=\"text\" id=\"first_name\" name=\"first_name\" required>\n            </div>\n            <div class=\"form-group\">\n                <label for=\"last_name\">Last Name:</label>\n                <input type=\"text\" id=\"last_name\" name=\"last_name\" required>\n            </div>\n            <div class=\"form-group\">\n                <label for=\"email\">Email:</label>\n                <input type=\"email\" id=\"email\" name=\"email\" required>\n            </div>\n            <div class=\"form-group\">\n                <label for=\"address\">Address:</label>\n                <input type=\"text\" id=\"address\" name=\"address\" required>\n            </div>\n            <div class=\"form-group\">\n                <label for=\"city\">City:</label>\n                <input type=\"text\" id=\"city\" name=\"city\" required>\n            </div>\n            <div class=\"form-group\">\n                <label for=\"state\">State:</label>\n                <input type=\"text\" id=\"state\" name=\"state\" required>\n            </div>\n            <div class=\"form-group\">\n                <label for=\"zip_code\">Zip Code:</label>\n                <input type=\"text\" id=\"zip_code\" name=\"zip_code\" required>\n            </div>\n            <div class=\"form-group\">\n                <label for=\"phone\">Phone:</label>\n                <input type=\"tel\" id=\"phone\" name=\"phone\" required>\n            </div>\n            \n            <h3>Payment Information</h3>\n            <div class=\"form-group\">\n                <label for=\"card_number\">Card Number:</label>\n                <input type=\"text\" id=\"card_number\" name=\"card_number\" required>\n            </div>\n            <div class=\"form-group\">\n                <label for=\"expiry_month\">Expiry Month:</label>\n                <select id=\"expiry_month\" name=\"expiry_month\" required>\n                    <?php\n                    for ($i = 1; $i <= 12; $i++) {\n                        echo \"<option value='$i'>\" . sprintf(\"%02d\", $i) . \"</option>\";\n                    }\n                    ?>\n                </select>\n            </div>\n            <div class=\"form-group\">\n                <label for=\"expiry_year\">Expiry Year:</label>\n                <select id=\"expiry_year\" name=\"expiry_year\" required>\n                    <?php\n                    $current_year = date(\"Y\");\n                    for ($i = $current_year; $i <= $current_year + 5; $i++) {\n                        echo \"<option value='$i'>$i</option>\";\n                    }\n                    ?>\n                </select>\n            </div>\n            \n            <button type=\"submit\">Place Order</button>\n        </form>\n    </div>\n</body>\n</html>\n```", "```php\n<?php\nsession_start();\n\nif (empty($_SESSION['cart'])) {\n    header(\"Location: products.php\");\n    exit();\n}\n\n// Validate form inputs\nforeach ($_POST as $key => $value) {\n    if ($value == \"\") {\n        die(\"Please fill in all required fields.\");\n    }\n}\n\n$conn = mysqli_connect('localhost', 'root', '', 'shopping_cart');\n\n$total_price = 0;\nforeach ($_SESSION['cart'] as $item) {\n    $total_price += $item['price'] * $item['quantity'];\n}\n\n// Insert order\n$sql_order = \"INSERT INTO orders (total_price, order_date, status)\n              VALUES ('$total_price', NOW(), 'pending')\";\nmysqli_query($conn, $sql_order);\n$order_id = mysqli_insert_id($conn);\n\n// Insert order items\nforeach ($_SESSION['cart'] as $item) {\n    $sql_item = \"INSERT INTO order_items (order_id, product_id, quantity, price)\n                 VALUES ('$order_id', '$item[id]', '$item[quantity]', '$item[price]')\";\n    mysqli_query($conn, $sql_item);\n}\n\n// Clear cart\nunset($_SESSION['cart']);\n\nheader(\"Location: thankyou.php\");\nexit();\n?>\n```", "```php\n<?php session_start(); ?>\n\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Thank You</title>\n    <style>\n        .thank-you {\n            text-align: center;\n            padding: 40px;\n            font-size: 24px;\n        }\n    </style>\n</head>\n<body>\n    <div class=\"thank-you\">\n        <h1>Thank You for Your Order!</h1>\n        <p>Your order has been successfully processed.</p>\n        <a href=\"products.php\">Continue Shopping</a>\n    </div>\n</body>\n</html>\n```"]}
