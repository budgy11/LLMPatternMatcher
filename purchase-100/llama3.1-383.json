{"prompt": "Create a purchase functionality using php", "llm_output": "Here's an example of how you can create a simple purchase functionality using PHP. This example assumes that we have a database set up with two tables: `products` and `orders`.\n\n**Database Schema**\n\nWe'll use the following database schema for this example:\n\n```sql\nCREATE TABLE products (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  name VARCHAR(255) NOT NULL,\n  price DECIMAL(10,2) NOT NULL\n);\n\nCREATE TABLE orders (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  product_id INT NOT NULL,\n  quantity INT NOT NULL,\n  total_cost DECIMAL(10,2) NOT NULL,\n  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n  FOREIGN KEY (product_id) REFERENCES products(id)\n);\n```\n\n**PHP Code**\n\nHere's the PHP code that implements the purchase functionality:\n\n```php\n// database connection settings\n$db_host = 'localhost';\n$db_username = 'your_username';\n$db_password = 'your_password';\n$db_name = 'your_database';\n\n// connect to database\n$conn = new mysqli($db_host, $db_username, $db_password, $db_name);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// function to get all products from database\nfunction get_products() {\n  global $conn;\n  $query = \"SELECT * FROM products\";\n  $result = $conn->query($query);\n  return $result->fetch_all(MYSQLI_ASSOC);\n}\n\n// function to process purchase\nfunction process_purchase($product_id, $quantity) {\n  global $conn;\n  // check if product exists and has sufficient quantity\n  $query = \"SELECT * FROM products WHERE id = '$product_id'\";\n  $result = $conn->query($query);\n  if ($result->num_rows == 0 || (int)$result->fetch_assoc()['quantity'] < (int)$quantity) {\n    return false;\n  }\n\n  // update product quantity\n  $new_quantity = (int)$result->fetch_assoc()['quantity'] - (int)$quantity;\n  $query = \"UPDATE products SET quantity = '$new_quantity' WHERE id = '$product_id'\";\n  $conn->query($query);\n\n  // insert order into database\n  $total_cost = (int)$quantity * (float)result->fetch_assoc()['price'];\n  $query = \"INSERT INTO orders (product_id, quantity, total_cost) VALUES ('$product_id', '$quantity', '$total_cost')\";\n  $conn->query($query);\n\n  return true;\n}\n\n// function to display cart\nfunction display_cart() {\n  global $conn;\n  $query = \"SELECT * FROM orders\";\n  $result = $conn->query($query);\n  echo \"<h2>Cart</h2>\";\n  foreach ($result->fetch_all(MYSQLI_ASSOC) as $order) {\n    echo \"Product: \" . get_product_name($order['product_id']) . \", Quantity: \" . $order['quantity'] . \", Total Cost: $\" . $order['total_cost'] . \"<br>\";\n  }\n}\n\n// function to display product name\nfunction get_product_name($product_id) {\n  global $conn;\n  $query = \"SELECT name FROM products WHERE id = '$product_id'\";\n  return $conn->query($query)->fetch_assoc()['name'];\n}\n```\n\n**Example Usage**\n\nHere's an example of how you can use this code to implement a simple purchase functionality:\n\n```php\n// get all products\n$products = get_products();\n\n// create cart\n.cart{\n  display_cart();\n}\n\n// add product to cart\nif (isset($_POST['product_id']) && isset($_POST['quantity'])) {\n  $product_id = $_POST['product_id'];\n  $quantity = $_POST['quantity'];\n\n  if (process_purchase($product_id, $quantity)) {\n    echo \"Product added to cart!\";\n  } else {\n    echo \"Error adding product to cart.\";\n  }\n}\n\n// display products\nforeach ($products as $product) {\n  echo \"<p>ID: \" . $product['id'] . \", Name: \" . $product['name'] . \", Price: $\" . $product['price'] . \"</p>\";\n}\n```\n\n**Security Notes**\n\nPlease note that this code is vulnerable to SQL injection attacks. In a production environment, you should use prepared statements or parameterized queries to prevent this type of attack.\n\nAdditionally, this code does not handle errors or exceptions properly. You may want to add error handling and exception handling mechanisms to make the code more robust.", "code_blocks": [null, "```php\n// database connection settings\n$db_host = 'localhost';\n$db_username = 'your_username';\n$db_password = 'your_password';\n$db_name = 'your_database';\n\n// connect to database\n$conn = new mysqli($db_host, $db_username, $db_password, $db_name);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// function to get all products from database\nfunction get_products() {\n  global $conn;\n  $query = \"SELECT * FROM products\";\n  $result = $conn->query($query);\n  return $result->fetch_all(MYSQLI_ASSOC);\n}\n\n// function to process purchase\nfunction process_purchase($product_id, $quantity) {\n  global $conn;\n  // check if product exists and has sufficient quantity\n  $query = \"SELECT * FROM products WHERE id = '$product_id'\";\n  $result = $conn->query($query);\n  if ($result->num_rows == 0 || (int)$result->fetch_assoc()['quantity'] < (int)$quantity) {\n    return false;\n  }\n\n  // update product quantity\n  $new_quantity = (int)$result->fetch_assoc()['quantity'] - (int)$quantity;\n  $query = \"UPDATE products SET quantity = '$new_quantity' WHERE id = '$product_id'\";\n  $conn->query($query);\n\n  // insert order into database\n  $total_cost = (int)$quantity * (float)result->fetch_assoc()['price'];\n  $query = \"INSERT INTO orders (product_id, quantity, total_cost) VALUES ('$product_id', '$quantity', '$total_cost')\";\n  $conn->query($query);\n\n  return true;\n}\n\n// function to display cart\nfunction display_cart() {\n  global $conn;\n  $query = \"SELECT * FROM orders\";\n  $result = $conn->query($query);\n  echo \"<h2>Cart</h2>\";\n  foreach ($result->fetch_all(MYSQLI_ASSOC) as $order) {\n    echo \"Product: \" . get_product_name($order['product_id']) . \", Quantity: \" . $order['quantity'] . \", Total Cost: $\" . $order['total_cost'] . \"<br>\";\n  }\n}\n\n// function to display product name\nfunction get_product_name($product_id) {\n  global $conn;\n  $query = \"SELECT name FROM products WHERE id = '$product_id'\";\n  return $conn->query($query)->fetch_assoc()['name'];\n}\n```", "```php\n// get all products\n$products = get_products();\n\n// create cart\n.cart{\n  display_cart();\n}\n\n// add product to cart\nif (isset($_POST['product_id']) && isset($_POST['quantity'])) {\n  $product_id = $_POST['product_id'];\n  $quantity = $_POST['quantity'];\n\n  if (process_purchase($product_id, $quantity)) {\n    echo \"Product added to cart!\";\n  } else {\n    echo \"Error adding product to cart.\";\n  }\n}\n\n// display products\nforeach ($products as $product) {\n  echo \"<p>ID: \" . $product['id'] . \", Name: \" . $product['name'] . \", Price: $\" . $product['price'] . \"</p>\";\n}\n```"]}
