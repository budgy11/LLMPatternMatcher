{"prompt": "Create a purchase functionality using php", "llm_output": "Here is an example of a basic purchase functionality using PHP, HTML, and MySQL. This code includes:\n\n*   A form to input customer information and select products\n*   A function to process the purchase and update the database\n*   A page to display the order details after successful purchase\n\n**Note:** Please ensure that you have a MySQL server set up on your local machine or hosting environment.\n\n### Database Setup (database.sql)\n\n```sql\nCREATE TABLE customers (\n    id INT PRIMARY KEY AUTO_INCREMENT,\n    name VARCHAR(255) NOT NULL,\n    email VARCHAR(255) NOT NULL\n);\n\nCREATE TABLE products (\n    id INT PRIMARY KEY AUTO_INCREMENT,\n    name VARCHAR(255) NOT NULL,\n    price DECIMAL(10, 2) NOT NULL\n);\n\nCREATE TABLE orders (\n    id INT PRIMARY KEY AUTO_INCREMENT,\n    customer_id INT NOT NULL,\n    FOREIGN KEY (customer_id) REFERENCES customers(id)\n);\n```\n\n### PHP Code\n\n**index.php**\n\n```php\n<?php\nrequire_once 'config.php';\n\nif ($_SERVER['REQUEST_METHOD'] === 'POST') {\n    $customerName = $_POST['name'];\n    $email = $_POST['email'];\n\n    // Process the purchase and update the database\n    purchase($customerName, $email);\n}\n\n?>\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <title>Purchase Functionality</title>\n</head>\n<body>\n\n<form action=\"\" method=\"post\">\n    <label for=\"name\">Name:</label>\n    <input type=\"text\" id=\"name\" name=\"name\"><br><br>\n    <label for=\"email\">Email:</label>\n    <input type=\"email\" id=\"email\" name=\"email\"><br><br>\n\n    <?php\n    $products = getProducts();\n    foreach ($products as $product) {\n        echo \"<p><b>\" . $product['name'] . \":</b> $\" . $product['price'] . \"</p>\";\n    }\n    ?>\n\n    <label for=\"products\">Select products:</label>\n    <?php\n    $selectedProducts = $_POST['products'];\n    if ($selectedProducts) {\n        foreach ($selectedProducts as $selectedProduct) {\n            echo \"<input type='checkbox' name='products[]' value='\" . $selectedProduct . \"'> \" . $product[$selectedProduct]['name'] . \"</p>\";\n        }\n    } else {\n        foreach ($products as $product) {\n            echo \"<input type='checkbox' name='products[]' value='\" . $product['id'] . \"'>\" . $product['name'] . \"</p>\";\n        }\n    }\n    ?>\n\n    <input type=\"submit\" value=\"Purchase\">\n</form>\n\n<?php\nif (isset($_GET['success'])) {\n    echo \"<p style='color: green;'>Order placed successfully!</p>\";\n} elseif (isset($_GET['error'])) {\n    echo \"<p style='color: red;'>An error occurred while processing your order.</p>\";\n}\n?>\n\n</body>\n</html>\n\n<?php\nfunction getProducts() {\n    global $db;\n    $sql = \"SELECT * FROM products\";\n    return mysqli_query($db, $sql)->fetch_all(MYSQLI_ASSOC);\n}\n\nfunction purchase($customerName, $email) {\n    global $db;\n    try {\n        // Insert customer into database if not already existing\n        $sql = \"INSERT INTO customers (name, email) VALUES ('$customerName', '$email')\";\n        mysqli_query($db, $sql);\n\n        // Get the last inserted customer ID\n        $customerId = mysqli_insert_id($db);\n\n        // Get selected products from form data\n        $products = $_POST['products'];\n        if (!$products) {\n            throw new Exception('No products selected');\n        }\n\n        // Insert order into database\n        foreach ($products as $product) {\n            $sql = \"INSERT INTO orders (customer_id, product_id) VALUES ('$customerId', '$product')\";\n            mysqli_query($db, $sql);\n        }\n\n        header('Location: ?success=1');\n    } catch (Exception $e) {\n        echo 'An error occurred while processing your order.';\n        die();\n    }\n}\n\n?>\n```\n\n**config.php**\n\n```php\n<?php\n$db = new mysqli('localhost', 'username', 'password', 'database_name');\n\nif ($db->connect_errno) {\n    exit(\"Could not connect to database\");\n}\n?>\n```\n\nIn this code, the `purchase` function processes the purchase by:\n\n*   Inserting the customer into the database if they don't exist\n*   Retrieving the last inserted customer ID\n*   Getting the selected products from form data\n*   Inserting each product into the orders table with their respective customer IDs\n\nThe `getProducts` function retrieves all available products from the database.\n\n**Note:** This is a basic implementation and doesn't include security measures such as validation, sanitization, or authentication. It's essential to add these features in your production environment for safety reasons.", "code_blocks": [null, "```php\n<?php\nrequire_once 'config.php';\n\nif ($_SERVER['REQUEST_METHOD'] === 'POST') {\n    $customerName = $_POST['name'];\n    $email = $_POST['email'];\n\n    // Process the purchase and update the database\n    purchase($customerName, $email);\n}\n\n?>\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <title>Purchase Functionality</title>\n</head>\n<body>\n\n<form action=\"\" method=\"post\">\n    <label for=\"name\">Name:</label>\n    <input type=\"text\" id=\"name\" name=\"name\"><br><br>\n    <label for=\"email\">Email:</label>\n    <input type=\"email\" id=\"email\" name=\"email\"><br><br>\n\n    <?php\n    $products = getProducts();\n    foreach ($products as $product) {\n        echo \"<p><b>\" . $product['name'] . \":</b> $\" . $product['price'] . \"</p>\";\n    }\n    ?>\n\n    <label for=\"products\">Select products:</label>\n    <?php\n    $selectedProducts = $_POST['products'];\n    if ($selectedProducts) {\n        foreach ($selectedProducts as $selectedProduct) {\n            echo \"<input type='checkbox' name='products[]' value='\" . $selectedProduct . \"'> \" . $product[$selectedProduct]['name'] . \"</p>\";\n        }\n    } else {\n        foreach ($products as $product) {\n            echo \"<input type='checkbox' name='products[]' value='\" . $product['id'] . \"'>\" . $product['name'] . \"</p>\";\n        }\n    }\n    ?>\n\n    <input type=\"submit\" value=\"Purchase\">\n</form>\n\n<?php\nif (isset($_GET['success'])) {\n    echo \"<p style='color: green;'>Order placed successfully!</p>\";\n} elseif (isset($_GET['error'])) {\n    echo \"<p style='color: red;'>An error occurred while processing your order.</p>\";\n}\n?>\n\n</body>\n</html>\n\n<?php\nfunction getProducts() {\n    global $db;\n    $sql = \"SELECT * FROM products\";\n    return mysqli_query($db, $sql)->fetch_all(MYSQLI_ASSOC);\n}\n\nfunction purchase($customerName, $email) {\n    global $db;\n    try {\n        // Insert customer into database if not already existing\n        $sql = \"INSERT INTO customers (name, email) VALUES ('$customerName', '$email')\";\n        mysqli_query($db, $sql);\n\n        // Get the last inserted customer ID\n        $customerId = mysqli_insert_id($db);\n\n        // Get selected products from form data\n        $products = $_POST['products'];\n        if (!$products) {\n            throw new Exception('No products selected');\n        }\n\n        // Insert order into database\n        foreach ($products as $product) {\n            $sql = \"INSERT INTO orders (customer_id, product_id) VALUES ('$customerId', '$product')\";\n            mysqli_query($db, $sql);\n        }\n\n        header('Location: ?success=1');\n    } catch (Exception $e) {\n        echo 'An error occurred while processing your order.';\n        die();\n    }\n}\n\n?>\n```", "```php\n<?php\n$db = new mysqli('localhost', 'username', 'password', 'database_name');\n\nif ($db->connect_errno) {\n    exit(\"Could not connect to database\");\n}\n?>\n```"]}
