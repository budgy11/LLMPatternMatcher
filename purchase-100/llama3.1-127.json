{"prompt": "Create a purchase functionality using php", "llm_output": "Here's an example of a simple e-commerce system with a purchase functionality in PHP. This will include user registration, login, adding items to cart, and making a purchase.\n\n**Database Schema**\n\nFirst, let's create the database schema for our application. We'll need three tables: `users`, `products`, and `cart`.\n\n```sql\nCREATE TABLE users (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  name VARCHAR(255),\n  email VARCHAR(255) UNIQUE,\n  password VARCHAR(255)\n);\n\nCREATE TABLE products (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  name VARCHAR(255),\n  price DECIMAL(10,2)\n);\n\nCREATE TABLE cart (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  user_id INT,\n  product_id INT,\n  quantity INT,\n  FOREIGN KEY (user_id) REFERENCES users(id),\n  FOREIGN KEY (product_id) REFERENCES products(id)\n);\n```\n\n**PHP Code**\n\nNow let's create the PHP code for our application.\n\n```php\n// config.php\n\n<?php\ndefine('DB_HOST', 'localhost');\ndefine('DB_USER', 'root');\ndefine('DB_PASSWORD', '');\ndefine('DB_NAME', 'ecommerce');\n\n$conn = new mysqli(DB_HOST, DB_USER, DB_PASSWORD, DB_NAME);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n?>\n```\n\n```php\n// register.php\n\n<?php\nrequire_once 'config.php';\n\nif (isset($_POST['register'])) {\n  $name = $_POST['name'];\n  $email = $_POST['email'];\n  $password = $_POST['password'];\n\n  $sql = \"INSERT INTO users (name, email, password) VALUES ('$name', '$email', '$password')\";\n  if ($conn->query($sql)) {\n    echo 'User created successfully!';\n  } else {\n    echo 'Error: ' . $sql . '<br />' . $conn->error;\n  }\n}\n?>\n\n<form method=\"post\">\n  <input type=\"text\" name=\"name\" placeholder=\"Name\"><br><br>\n  <input type=\"email\" name=\"email\" placeholder=\"Email\"><br><br>\n  <input type=\"password\" name=\"password\" placeholder=\"Password\"><br><br>\n  <button type=\"submit\" name=\"register\">Register</button>\n</form>\n```\n\n```php\n// login.php\n\n<?php\nrequire_once 'config.php';\n\nif (isset($_POST['login'])) {\n  $email = $_POST['email'];\n  $password = $_POST['password'];\n\n  $sql = \"SELECT * FROM users WHERE email='$email' AND password='$password'\";\n  $result = $conn->query($sql);\n\n  if ($result->num_rows > 0) {\n    while ($row = $result->fetch_assoc()) {\n      session_start();\n      $_SESSION['user_id'] = $row['id'];\n      header('Location: index.php');\n      exit;\n    }\n  } else {\n    echo 'Invalid email or password!';\n  }\n}\n?>\n\n<form method=\"post\">\n  <input type=\"email\" name=\"email\" placeholder=\"Email\"><br><br>\n  <input type=\"password\" name=\"password\" placeholder=\"Password\"><br><br>\n  <button type=\"submit\" name=\"login\">Login</button>\n</form>\n```\n\n```php\n// index.php\n\n<?php\nrequire_once 'config.php';\n\nif (!isset($_SESSION['user_id'])) {\n  header('Location: login.php');\n  exit;\n}\n\n$sql = \"SELECT * FROM products\";\n$result = $conn->query($sql);\n\necho '<h1>Products</h1>';\necho '<ul>';\n\nwhile ($row = $result->fetch_assoc()) {\n  echo '<li><a href=\"#\">' . $row['name'] . '</a></li>';\n}\n\necho '</ul>';\n?>\n\n<form method=\"post\">\n  <input type=\"hidden\" name=\"product_id\" value=\"\">\n  <button type=\"submit\" name=\"add_to_cart\">Add to Cart</button>\n</form>\n```\n\n```php\n// cart.php\n\n<?php\nrequire_once 'config.php';\n\nif (!isset($_SESSION['user_id'])) {\n  header('Location: login.php');\n  exit;\n}\n\n$sql = \"SELECT * FROM products\";\n$result = $conn->query($sql);\n\necho '<h1>Cart</h1>';\necho '<ul>';\n\nwhile ($row = $result->fetch_assoc()) {\n  echo '<li>' . $row['name'] . ' - <span>$' . number_format($row['price'], 2) . '</span></li>';\n}\n\necho '</ul>';\n\nif (isset($_POST['add_to_cart'])) {\n  $product_id = $_POST['product_id'];\n  $quantity = $_POST['quantity'];\n\n  $sql = \"INSERT INTO cart (user_id, product_id, quantity) VALUES ($_SESSION[user_id], '$product_id', '$quantity')\";\n  if ($conn->query($sql)) {\n    echo 'Product added to cart!';\n  } else {\n    echo 'Error: ' . $sql . '<br />' . $conn->error;\n  }\n}\n?>\n\n<form method=\"post\">\n  <input type=\"hidden\" name=\"product_id\" value=\"\">\n  <select name=\"quantity\">\n    <?php for ($i = 1; $i <= 10; $i++) { ?>\n      <option value=\"<?php echo $i; ?>\"><?php echo $i; ?></option>\n    <?php } ?>\n  </select>\n  <button type=\"submit\" name=\"add_to_cart\">Add to Cart</button>\n</form>\n```\n\n```php\n// checkout.php\n\n<?php\nrequire_once 'config.php';\n\nif (!isset($_SESSION['user_id'])) {\n  header('Location: login.php');\n  exit;\n}\n\n$sql = \"SELECT * FROM cart WHERE user_id=$_SESSION[user_id]\";\n$result = $conn->query($sql);\n\necho '<h1>Checkout</h1>';\necho '<ul>';\n\n$total_cost = 0;\n\nwhile ($row = $result->fetch_assoc()) {\n  echo '<li>' . $row['product_name'] . ' - <span>$' . number_format($row['price'], 2) . '</span></li>';\n  $total_cost += $row['price'];\n}\n\necho '</ul>';\n\nif (isset($_POST['checkout'])) {\n  $sql = \"UPDATE users SET balance=balance-$total_cost WHERE id=$_SESSION[user_id]\";\n  if ($conn->query($sql)) {\n    echo 'Payment successful!';\n  } else {\n    echo 'Error: ' . $sql . '<br />' . $conn->error;\n  }\n}\n?>\n\n<form method=\"post\">\n  <button type=\"submit\" name=\"checkout\">Checkout</button>\n</form>\n```\n\nThis is a very basic example of an e-commerce system with a purchase functionality. It doesn't include any security measures, such as password hashing or SQL injection protection.", "code_blocks": [null, "```php\n// config.php\n\n<?php\ndefine('DB_HOST', 'localhost');\ndefine('DB_USER', 'root');\ndefine('DB_PASSWORD', '');\ndefine('DB_NAME', 'ecommerce');\n\n$conn = new mysqli(DB_HOST, DB_USER, DB_PASSWORD, DB_NAME);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n?>\n```", "```php\n// register.php\n\n<?php\nrequire_once 'config.php';\n\nif (isset($_POST['register'])) {\n  $name = $_POST['name'];\n  $email = $_POST['email'];\n  $password = $_POST['password'];\n\n  $sql = \"INSERT INTO users (name, email, password) VALUES ('$name', '$email', '$password')\";\n  if ($conn->query($sql)) {\n    echo 'User created successfully!';\n  } else {\n    echo 'Error: ' . $sql . '<br />' . $conn->error;\n  }\n}\n?>\n\n<form method=\"post\">\n  <input type=\"text\" name=\"name\" placeholder=\"Name\"><br><br>\n  <input type=\"email\" name=\"email\" placeholder=\"Email\"><br><br>\n  <input type=\"password\" name=\"password\" placeholder=\"Password\"><br><br>\n  <button type=\"submit\" name=\"register\">Register</button>\n</form>\n```", "```php\n// login.php\n\n<?php\nrequire_once 'config.php';\n\nif (isset($_POST['login'])) {\n  $email = $_POST['email'];\n  $password = $_POST['password'];\n\n  $sql = \"SELECT * FROM users WHERE email='$email' AND password='$password'\";\n  $result = $conn->query($sql);\n\n  if ($result->num_rows > 0) {\n    while ($row = $result->fetch_assoc()) {\n      session_start();\n      $_SESSION['user_id'] = $row['id'];\n      header('Location: index.php');\n      exit;\n    }\n  } else {\n    echo 'Invalid email or password!';\n  }\n}\n?>\n\n<form method=\"post\">\n  <input type=\"email\" name=\"email\" placeholder=\"Email\"><br><br>\n  <input type=\"password\" name=\"password\" placeholder=\"Password\"><br><br>\n  <button type=\"submit\" name=\"login\">Login</button>\n</form>\n```", "```php\n// index.php\n\n<?php\nrequire_once 'config.php';\n\nif (!isset($_SESSION['user_id'])) {\n  header('Location: login.php');\n  exit;\n}\n\n$sql = \"SELECT * FROM products\";\n$result = $conn->query($sql);\n\necho '<h1>Products</h1>';\necho '<ul>';\n\nwhile ($row = $result->fetch_assoc()) {\n  echo '<li><a href=\"#\">' . $row['name'] . '</a></li>';\n}\n\necho '</ul>';\n?>\n\n<form method=\"post\">\n  <input type=\"hidden\" name=\"product_id\" value=\"\">\n  <button type=\"submit\" name=\"add_to_cart\">Add to Cart</button>\n</form>\n```", "```php\n// cart.php\n\n<?php\nrequire_once 'config.php';\n\nif (!isset($_SESSION['user_id'])) {\n  header('Location: login.php');\n  exit;\n}\n\n$sql = \"SELECT * FROM products\";\n$result = $conn->query($sql);\n\necho '<h1>Cart</h1>';\necho '<ul>';\n\nwhile ($row = $result->fetch_assoc()) {\n  echo '<li>' . $row['name'] . ' - <span>$' . number_format($row['price'], 2) . '</span></li>';\n}\n\necho '</ul>';\n\nif (isset($_POST['add_to_cart'])) {\n  $product_id = $_POST['product_id'];\n  $quantity = $_POST['quantity'];\n\n  $sql = \"INSERT INTO cart (user_id, product_id, quantity) VALUES ($_SESSION[user_id], '$product_id', '$quantity')\";\n  if ($conn->query($sql)) {\n    echo 'Product added to cart!';\n  } else {\n    echo 'Error: ' . $sql . '<br />' . $conn->error;\n  }\n}\n?>\n\n<form method=\"post\">\n  <input type=\"hidden\" name=\"product_id\" value=\"\">\n  <select name=\"quantity\">\n    <?php for ($i = 1; $i <= 10; $i++) { ?>\n      <option value=\"<?php echo $i; ?>\"><?php echo $i; ?></option>\n    <?php } ?>\n  </select>\n  <button type=\"submit\" name=\"add_to_cart\">Add to Cart</button>\n</form>\n```", "```php\n// checkout.php\n\n<?php\nrequire_once 'config.php';\n\nif (!isset($_SESSION['user_id'])) {\n  header('Location: login.php');\n  exit;\n}\n\n$sql = \"SELECT * FROM cart WHERE user_id=$_SESSION[user_id]\";\n$result = $conn->query($sql);\n\necho '<h1>Checkout</h1>';\necho '<ul>';\n\n$total_cost = 0;\n\nwhile ($row = $result->fetch_assoc()) {\n  echo '<li>' . $row['product_name'] . ' - <span>$' . number_format($row['price'], 2) . '</span></li>';\n  $total_cost += $row['price'];\n}\n\necho '</ul>';\n\nif (isset($_POST['checkout'])) {\n  $sql = \"UPDATE users SET balance=balance-$total_cost WHERE id=$_SESSION[user_id]\";\n  if ($conn->query($sql)) {\n    echo 'Payment successful!';\n  } else {\n    echo 'Error: ' . $sql . '<br />' . $conn->error;\n  }\n}\n?>\n\n<form method=\"post\">\n  <button type=\"submit\" name=\"checkout\">Checkout</button>\n</form>\n```"]}
