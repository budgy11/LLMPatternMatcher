{"prompt": "Create a purchase functionality using php", "llm_output": "<think>\nOkay, I need to create a purchase functionality using PHP. Let me think about how to approach this.\n\nFirst, I should outline the main components required. The user needs to select products, view their cart, and proceed to checkout. So, I'll need pages for displaying products, adding them to the cart, viewing the cart, and handling payment.\n\nI'll start by setting up a database. It makes sense to have tables for products, users, orders, order items, and payments. The products table will store details like name, description, price, quantity, and image. Users need their own table with fields like username, email, password, etc. Orders will track each purchase with user ID, total amount, date, and status. Order items will link the order to specific products with quantities and prices. Lastly, payments will store transaction details.\n\nNext, I'll create the product display page. Using PHP, I can fetch data from the database and display products in a grid. Each product should have an \"Add to Cart\" button that sends the product ID to a script. For the cart functionality, I'll use sessions to keep track of items without requiring login. When a user adds an item, the session will store the product details.\n\nThe cart page needs to display all selected items, allow quantity adjustments, and provide options to remove items. Calculating totals like subtotal, tax, and grand total is essential here. I'll make sure these calculations are accurate.\n\nFor checkout, users should be able to enter their shipping and payment info. If they're logged in, pre-filled details would enhance the experience. Otherwise, they can create an account or continue as a guest. I'll need a form that validates all necessary fields.\n\nProcessing the order involves several steps. First, capturing user input from the checkout form and handling any errors. Then, calculating the total amount including tax. If the payment is successful (simulated here), I'll insert the order into the database along with each item in the order items table. Updating product quantities to reflect sales is also important.\n\nI should include a payment simulation since implementing actual payment gateways might be beyond the scope for now. This will allow testing without needing real transactions.\n\nFinally, displaying a thank you message after purchase and clearing the cart session completes the process. Including navigation links on each page ensures users can easily move between sections.\n\nThroughout this process, I'll need to consider security aspects like SQL injection prevention using prepared statements and sanitizing user inputs. Error handling should be robust to catch any issues during form submissions or database operations.\n\nTesting each part step by step is crucial. Starting from product display, adding items to the cart, checking out, and ensuring orders are correctly recorded in the database will help identify any bugs early on.\n\nIn summary, breaking down the problem into manageable parts\u2014database setup, product display, cart management, checkout process, order processing, and payment handling\u2014allows me to build each component systematically. This structured approach ensures that all functionalities work together seamlessly.\n</think>\n\nHere's an example of a purchase functionality using PHP:\n\n1. **Database Setup**:\n   First, create the necessary tables in your database.\n\n```sql\n-- Create products table\nCREATE TABLE products (\n    id INT PRIMARY KEY AUTO_INCREMENT,\n    name VARCHAR(255) NOT NULL,\n    description TEXT,\n    price DECIMAL(10, 2) NOT NULL,\n    quantity INT NOT NULL,\n    image VARCHAR(255)\n);\n\n-- Create users table\nCREATE TABLE users (\n    id INT PRIMARY KEY AUTO_INCREMENT,\n    username VARCHAR(50) UNIQUE NOT NULL,\n    email VARCHAR(100) UNIQUE NOT NULL,\n    password_hash VARCHAR(255) NOT NULL\n);\n\n-- Create orders table\nCREATE TABLE orders (\n    id INT PRIMARY KEY AUTO_INCREMENT,\n    user_id INT,\n    total_amount DECIMAL(10, 2) NOT NULL,\n    order_date DATETIME DEFAULT CURRENT_TIMESTAMP,\n    status ENUM('pending', 'completed', 'cancelled'),\n    FOREIGN KEY (user_id) REFERENCES users(id)\n);\n\n-- Create order_items table\nCREATE TABLE order_items (\n    id INT PRIMARY KEY AUTO_INCREMENT,\n    order_id INT,\n    product_id INT,\n    quantity INT NOT NULL,\n    price DECIMAL(10, 2) NOT NULL,\n    FOREIGN KEY (order_id) REFERENCES orders(id),\n    FOREIGN KEY (product_id) REFERENCES products(id)\n);\n\n-- Create payments table\nCREATE TABLE payments (\n    id INT PRIMARY KEY AUTO_INCREMENT,\n    order_id INT,\n    payment_method ENUM('credit_card', 'paypal') NOT NULL,\n    transaction_id VARCHAR(50) UNIQUE NOT NULL,\n    amount DECIMAL(10, 2) NOT NULL,\n    payment_date DATETIME DEFAULT CURRENT_TIMESTAMP,\n    FOREIGN KEY (order_id) REFERENCES orders(id)\n);\n```\n\n2. **Product Display Page**:\n   Create a page to display products with \"Add to Cart\" button.\n\n```php\n<?php\n// Connect to database\n$host = 'localhost';\n$dbname = 'your_database_name';\n$username = 'your_username';\n$password = 'your_password';\n\ntry {\n    $conn = new PDO(\"mysql:host=$host;dbname=$dbname\", $username, $password);\n    $conn->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);\n} catch (PDOException $e) {\n    echo \"Connection failed: \" . $e->getMessage();\n}\n\n// Fetch products from database\n$stmt = $conn->query(\"SELECT * FROM products\");\n$products = $stmt->fetchAll(PDO::FETCH_ASSOC);\n\n?>\n\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Store</title>\n    <!-- Include your CSS here -->\n    <style>\n        .product-grid {\n            display: grid;\n            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));\n            gap: 20px;\n            padding: 20px;\n        }\n        .product-card {\n            border: 1px solid #ddd;\n            padding: 10px;\n            text-align: center;\n        }\n    </style>\n</head>\n<body>\n    <h1>Welcome to Our Store</h1>\n    <div class=\"product-grid\">\n        <?php foreach ($products as $product): ?>\n            <div class=\"product-card\">\n                <?php if ($product['image']): ?>\n                    <img src=\"<?php echo $product['image']; ?>\" alt=\"<?php echo $product['name']; ?>\" style=\"max-width: 200px;\">\n                <?php endif; ?>\n                <h3><?php echo $product['name']; ?></h3>\n                <p><?php echo $product['description']; ?></p>\n                <p>Price: $<?php echo number_format($product['price'], 2); ?></p>\n                <form action=\"add_to_cart.php\" method=\"post\">\n                    <input type=\"hidden\" name=\"product_id\" value=\"<?php echo $product['id']; ?>\">\n                    <button type=\"submit\">Add to Cart</button>\n                </form>\n            </div>\n        <?php endforeach; ?>\n    </div>\n</body>\n</html>\n```\n\n3. **Add to Cart Functionality**:\n   Create a `add_to_cart.php` file.\n\n```php\n<?php\nsession_start();\n\nif (!isset($_POST['product_id'])) {\n    die(\"Invalid request\");\n}\n\n$product_id = $_POST['product_id'];\n\n// Connect to database\ntry {\n    $conn = new PDO(\"mysql:host=localhost;dbname=your_database_name\", 'username', 'password');\n} catch (PDOException $e) {\n    echo \"Connection failed: \" . $e->getMessage();\n}\n\n$stmt = $conn->prepare(\"SELECT * FROM products WHERE id = ?\");\n$stmt->execute([$product_id]);\n$product = $stmt->fetch(PDO::FETCH_ASSOC);\n\nif (!$product) {\n    die(\"Product not found\");\n}\n\n// Add to cart\n$cart = $_SESSION['cart'] ?? [];\n$cart[$product_id] = [\n    'name' => $product['name'],\n    'price' => $product['price'],\n    'quantity' => 1,\n];\n$_SESSION['cart'] = $cart;\n\nheader(\"Location: cart.php\");\nexit();\n```\n\n4. **Cart Page**:\n   Create a `cart.php` file.\n\n```php\n<?php\nsession_start();\n\n// Connect to database\ntry {\n    $conn = new PDO(\"mysql:host=localhost;dbname=your_database_name\", 'username', 'password');\n} catch (PDOException $e) {\n    echo \"Connection failed: \" . $e->getMessage();\n}\n\n$cart = $_SESSION['cart'] ?? [];\n$total = 0;\n\n?>\n\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Shopping Cart</title>\n    <!-- Include your CSS here -->\n    <style>\n        .cart-table {\n            width: 100%;\n            border-collapse: collapse;\n            margin: 20px;\n        }\n        th, td {\n            padding: 12px;\n            text-align: left;\n            border-bottom: 1px solid #ddd;\n        }\n    </style>\n</head>\n<body>\n    <h1>Your Shopping Cart</h1>\n    <?php if (empty($cart)): ?>\n        <p>Your cart is empty.</p>\n        <a href=\"index.php\">Continue Shopping</a>\n    <?php else: ?>\n        <table class=\"cart-table\">\n            <thead>\n                <tr>\n                    <th>Product</th>\n                    <th>Price</th>\n                    <th>Quantity</th>\n                    <th>Total</th>\n                    <th>Action</th>\n                </tr>\n            </thead>\n            <tbody>\n                <?php foreach ($cart as $product_id => $item): \n                    $total += $item['price'] * $item['quantity'];\n                ?>\n                    <tr>\n                        <td><?php echo $item['name']; ?></td>\n                        <td>$<?php echo number_format($item['price'], 2); ?></td>\n                        <td>\n                            <form action=\"update_cart.php\" method=\"post\">\n                                <input type=\"hidden\" name=\"product_id\" value=\"<?php echo $product_id; ?>\">\n                                <input type=\"number\" name=\"quantity\" min=\"1\" value=\"<?php echo $item['quantity']; ?>\" style=\"width: 50px;\">\n                                <button type=\"submit\">Update</button>\n                            </form>\n                        </td>\n                        <td>$<?php echo number_format($item['price'] * $item['quantity'], 2); ?></td>\n                        <td><a href=\"remove_from_cart.php?product_id=<?php echo $product_id; ?>\">Remove</a></td>\n                    </tr>\n                <?php endforeach; ?>\n            </tbody>\n        </table>\n        <p>Subtotal: $<?php echo number_format($total, 2); ?></p>\n        <p>Tax (10%): $<?php echo number_format($total * 0.10, 2); ?></p>\n        <p>Grand Total: $<?php echo number_format($total * 1.10, 2); ?></p>\n        <a href=\"checkout.php\">Proceed to Checkout</a>\n    <?php endif; ?>\n</body>\n</html>\n```\n\n5. **Update Cart Functionality**:\n   Create a `update_cart.php` file.\n\n```php\n<?php\nsession_start();\n\nif (!isset($_POST['product_id']) || !isset($_POST['quantity'])) {\n    die(\"Invalid request\");\n}\n\n$product_id = $_POST['product_id'];\n$quantity = (int)$_POST['quantity'];\n\nif ($quantity < 1) {\n    die(\"Quantity must be at least 1\");\n}\n\n$cart = $_SESSION['cart'] ?? [];\nif (!isset($cart[$product_id])) {\n    die(\"Product not found in cart\");\n}\n\n$cart[$product_id]['quantity'] = $quantity;\n$_SESSION['cart'] = $cart;\n\nheader(\"Location: cart.php\");\nexit();\n```\n\n6. **Remove from Cart Functionality**:\n   Create a `remove_from_cart.php` file.\n\n```php\n<?php\nsession_start();\n\nif (!isset($_GET['product_id'])) {\n    die(\"Invalid request\");\n}\n\n$product_id = $_GET['product_id'];\n\n$cart = $_SESSION['cart'] ?? [];\nunset($cart[$product_id]);\n$_SESSION['cart'] = $cart;\n\nheader(\"Location: cart.php\");\nexit();\n```\n\n7. **Checkout Page**:\n   Create a `checkout.php` file.\n\n```php\n<?php\nsession_start();\n\nif (empty($_SESSION['cart'])) {\n    header(\"Location: cart.php\");\n    exit();\n}\n\n// Connect to database\ntry {\n    $conn = new PDO(\"mysql:host=localhost;dbname=your_database_name\", 'username', 'password');\n} catch (PDOException $e) {\n    echo \"Connection failed: \" . $e->getMessage();\n}\n\n?>\n\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Checkout</title>\n    <!-- Include your CSS here -->\n    <style>\n        .checkout-form {\n            max-width: 600px;\n            margin: 20px auto;\n            padding: 20px;\n            border: 1px solid #ddd;\n        }\n        .form-group {\n            margin-bottom: 15px;\n        }\n        label {\n            display: block;\n            margin-bottom: 5px;\n        }\n        input, select {\n            width: 100%;\n            padding: 8px;\n            margin-bottom: 10px;\n        }\n    </style>\n</head>\n<body>\n    <h2>Checkout</h2>\n    <div class=\"checkout-form\">\n        <form action=\"process_order.php\" method=\"post\">\n            <div class=\"form-group\">\n                <label for=\"first_name\">First Name:</label>\n                <input type=\"text\" id=\"first_name\" name=\"first_name\" required>\n            </div>\n            <div class=\"form-group\">\n                <label for=\"last_name\">Last Name:</label>\n                <input type=\"text\" id=\"last_name\" name=\"last_name\" required>\n            </div>\n            <div class=\"form-group\">\n                <label for=\"email\">Email:</label>\n                <input type=\"email\" id=\"email\" name=\"email\" required>\n            </div>\n            <div class=\"form-group\">\n                <label for=\"address\">Address:</label>\n                <input type=\"text\" id=\"address\" name=\"address\" required>\n            </div>\n            <div class=\"form-group\">\n                <label for=\"city\">City:</label>\n                <input type=\"text\" id=\"city\" name=\"city\" required>\n            </div>\n            <div class=\"form-group\">\n                <label for=\"state\">State:</label>\n                <select id=\"state\" name=\"state\" required>\n                    <option value=\"\">Select State</option>\n                    <!-- Add states here -->\n                </select>\n            </div>\n            <div class=\"form-group\">\n                <label for=\"zip_code\">Zip Code:</label>\n                <input type=\"text\" id=\"zip_code\" name=\"zip_code\" required>\n            </div>\n            <div class=\"form-group\">\n                <label for=\"payment_method\">Payment Method:</label>\n                <select id=\"payment_method\" name=\"payment_method\" required>\n                    <option value=\"credit_card\">Credit Card</option>\n                    <option value=\"paypal\">PayPal</option>\n                </select>\n            </div>\n            <?php if (isset($_SESSION['user_id'])): ?>\n                <input type=\"hidden\" name=\"user_id\" value=\"<?php echo $_SESSION['user_id']; ?>\">\n            <?php endif; ?>\n            <button type=\"submit\">Place Order</button>\n        </form>\n    </div>\n</body>\n</html>\n```\n\n8. **Order Processing**:\n   Create a `process_order.php` file.\n\n```php\n<?php\nsession_start();\n\nif (empty($_POST)) {\n    die(\"Invalid request\");\n}\n\n// Connect to database\ntry {\n    $conn = new PDO(\"mysql:host=localhost;dbname=your_database_name\", 'username', 'password');\n} catch (PDOException $e) {\n    echo \"Connection failed: \" . $e->getMessage();\n}\n\n// Get user ID if logged in\n$user_id = $_POST['user_id'] ?? null;\n\n// Insert order into orders table\n$stmt = $conn->prepare(\"INSERT INTO orders (user_id, total_amount) VALUES (?, ?)\");\n$total = 0;\nforeach ($_SESSION['cart'] as $item) {\n    $total += $item['price'] * $item['quantity'];\n}\n$amount_with_tax = $total * 1.10; // Assuming 10% tax\n\n$stmt->execute([$user_id, $amount_with_tax]);\n$order_id = $conn->lastInsertId();\n\n// Insert order items\nforeach ($_SESSION['cart'] as $product_id => $item) {\n    $stmt = $conn->prepare(\"INSERT INTO order_items (order_id, product_id, quantity, price) VALUES (?, ?, ?, ?)\");\n    $stmt->execute([$order_id, $product_id, $item['quantity'], $item['price']]);\n}\n\n// Insert payment\n$payment_method = $_POST['payment_method'];\n$stmt = $conn->prepare(\"INSERT INTO payments (order_id, payment_method, amount) VALUES (?, ?, ?)\");\n$stmt->execute([$order_id, $payment_method, $amount_with_tax]);\n\n// Clear cart\nunset($_SESSION['cart']);\n\nheader(\"Location: thank_you.php\");\nexit();\n```\n\n9. **Thank You Page**:\n   Create a `thank_you.php` file.\n\n```php\n<?php\nsession_start();\n\nif (!isset($_SESSION['last_order_id'])) {\n    header(\"Location: index.php\");\n    exit();\n}\n\n?>\n\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Thank You</title>\n    <!-- Include your CSS here -->\n    <style>\n        .thank-you {\n            text-align: center;\n            padding: 40px;\n            font-family: Arial, sans-serif;\n        }\n    </style>\n</head>\n<body>\n    <div class=\"thank-you\">\n        <h1>Thank You for Your Order!</h1>\n        <p>Your order has been received and is being processed.</p>\n        <a href=\"index.php\">Continue Shopping</a>\n    </div>\n</body>\n</html>\n```\n\nThis is a basic implementation of a purchase functionality using PHP. It includes:\n\n- Product display\n- Add to cart functionality\n- Cart management (update quantities, remove items)\n- Checkout process with user information collection\n- Order processing and payment handling\n- Thank you page after purchase\n\nYou can enhance this further by:\n\n1. Adding user authentication/authorization\n2. Implementing a real payment gateway\n3. Adding more error handling\n4. Including product reviews and ratings\n5. Adding a wishlist feature\n6. Implementing search functionality\n7. Adding pagination for products\n8. Including order tracking\n9. Adding email notifications for orders\n10. Implementing an admin panel for managing products and orders\n\nRemember to secure your application by:\n\n- Sanitizing user inputs\n- Using prepared statements to prevent SQL injection\n- Validating all forms\n- Securing sessions\n- Using HTTPS\n- Proper error handling", "code_blocks": [null, "```php\n<?php\n// Connect to database\n$host = 'localhost';\n$dbname = 'your_database_name';\n$username = 'your_username';\n$password = 'your_password';\n\ntry {\n    $conn = new PDO(\"mysql:host=$host;dbname=$dbname\", $username, $password);\n    $conn->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);\n} catch (PDOException $e) {\n    echo \"Connection failed: \" . $e->getMessage();\n}\n\n// Fetch products from database\n$stmt = $conn->query(\"SELECT * FROM products\");\n$products = $stmt->fetchAll(PDO::FETCH_ASSOC);\n\n?>\n\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Store</title>\n    <!-- Include your CSS here -->\n    <style>\n        .product-grid {\n            display: grid;\n            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));\n            gap: 20px;\n            padding: 20px;\n        }\n        .product-card {\n            border: 1px solid #ddd;\n            padding: 10px;\n            text-align: center;\n        }\n    </style>\n</head>\n<body>\n    <h1>Welcome to Our Store</h1>\n    <div class=\"product-grid\">\n        <?php foreach ($products as $product): ?>\n            <div class=\"product-card\">\n                <?php if ($product['image']): ?>\n                    <img src=\"<?php echo $product['image']; ?>\" alt=\"<?php echo $product['name']; ?>\" style=\"max-width: 200px;\">\n                <?php endif; ?>\n                <h3><?php echo $product['name']; ?></h3>\n                <p><?php echo $product['description']; ?></p>\n                <p>Price: $<?php echo number_format($product['price'], 2); ?></p>\n                <form action=\"add_to_cart.php\" method=\"post\">\n                    <input type=\"hidden\" name=\"product_id\" value=\"<?php echo $product['id']; ?>\">\n                    <button type=\"submit\">Add to Cart</button>\n                </form>\n            </div>\n        <?php endforeach; ?>\n    </div>\n</body>\n</html>\n```", "```php\n<?php\nsession_start();\n\nif (!isset($_POST['product_id'])) {\n    die(\"Invalid request\");\n}\n\n$product_id = $_POST['product_id'];\n\n// Connect to database\ntry {\n    $conn = new PDO(\"mysql:host=localhost;dbname=your_database_name\", 'username', 'password');\n} catch (PDOException $e) {\n    echo \"Connection failed: \" . $e->getMessage();\n}\n\n$stmt = $conn->prepare(\"SELECT * FROM products WHERE id = ?\");\n$stmt->execute([$product_id]);\n$product = $stmt->fetch(PDO::FETCH_ASSOC);\n\nif (!$product) {\n    die(\"Product not found\");\n}\n\n// Add to cart\n$cart = $_SESSION['cart'] ?? [];\n$cart[$product_id] = [\n    'name' => $product['name'],\n    'price' => $product['price'],\n    'quantity' => 1,\n];\n$_SESSION['cart'] = $cart;\n\nheader(\"Location: cart.php\");\nexit();\n```", "```php\n<?php\nsession_start();\n\n// Connect to database\ntry {\n    $conn = new PDO(\"mysql:host=localhost;dbname=your_database_name\", 'username', 'password');\n} catch (PDOException $e) {\n    echo \"Connection failed: \" . $e->getMessage();\n}\n\n$cart = $_SESSION['cart'] ?? [];\n$total = 0;\n\n?>\n\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Shopping Cart</title>\n    <!-- Include your CSS here -->\n    <style>\n        .cart-table {\n            width: 100%;\n            border-collapse: collapse;\n            margin: 20px;\n        }\n        th, td {\n            padding: 12px;\n            text-align: left;\n            border-bottom: 1px solid #ddd;\n        }\n    </style>\n</head>\n<body>\n    <h1>Your Shopping Cart</h1>\n    <?php if (empty($cart)): ?>\n        <p>Your cart is empty.</p>\n        <a href=\"index.php\">Continue Shopping</a>\n    <?php else: ?>\n        <table class=\"cart-table\">\n            <thead>\n                <tr>\n                    <th>Product</th>\n                    <th>Price</th>\n                    <th>Quantity</th>\n                    <th>Total</th>\n                    <th>Action</th>\n                </tr>\n            </thead>\n            <tbody>\n                <?php foreach ($cart as $product_id => $item): \n                    $total += $item['price'] * $item['quantity'];\n                ?>\n                    <tr>\n                        <td><?php echo $item['name']; ?></td>\n                        <td>$<?php echo number_format($item['price'], 2); ?></td>\n                        <td>\n                            <form action=\"update_cart.php\" method=\"post\">\n                                <input type=\"hidden\" name=\"product_id\" value=\"<?php echo $product_id; ?>\">\n                                <input type=\"number\" name=\"quantity\" min=\"1\" value=\"<?php echo $item['quantity']; ?>\" style=\"width: 50px;\">\n                                <button type=\"submit\">Update</button>\n                            </form>\n                        </td>\n                        <td>$<?php echo number_format($item['price'] * $item['quantity'], 2); ?></td>\n                        <td><a href=\"remove_from_cart.php?product_id=<?php echo $product_id; ?>\">Remove</a></td>\n                    </tr>\n                <?php endforeach; ?>\n            </tbody>\n        </table>\n        <p>Subtotal: $<?php echo number_format($total, 2); ?></p>\n        <p>Tax (10%): $<?php echo number_format($total * 0.10, 2); ?></p>\n        <p>Grand Total: $<?php echo number_format($total * 1.10, 2); ?></p>\n        <a href=\"checkout.php\">Proceed to Checkout</a>\n    <?php endif; ?>\n</body>\n</html>\n```", "```php\n<?php\nsession_start();\n\nif (!isset($_POST['product_id']) || !isset($_POST['quantity'])) {\n    die(\"Invalid request\");\n}\n\n$product_id = $_POST['product_id'];\n$quantity = (int)$_POST['quantity'];\n\nif ($quantity < 1) {\n    die(\"Quantity must be at least 1\");\n}\n\n$cart = $_SESSION['cart'] ?? [];\nif (!isset($cart[$product_id])) {\n    die(\"Product not found in cart\");\n}\n\n$cart[$product_id]['quantity'] = $quantity;\n$_SESSION['cart'] = $cart;\n\nheader(\"Location: cart.php\");\nexit();\n```", "```php\n<?php\nsession_start();\n\nif (!isset($_GET['product_id'])) {\n    die(\"Invalid request\");\n}\n\n$product_id = $_GET['product_id'];\n\n$cart = $_SESSION['cart'] ?? [];\nunset($cart[$product_id]);\n$_SESSION['cart'] = $cart;\n\nheader(\"Location: cart.php\");\nexit();\n```", "```php\n<?php\nsession_start();\n\nif (empty($_SESSION['cart'])) {\n    header(\"Location: cart.php\");\n    exit();\n}\n\n// Connect to database\ntry {\n    $conn = new PDO(\"mysql:host=localhost;dbname=your_database_name\", 'username', 'password');\n} catch (PDOException $e) {\n    echo \"Connection failed: \" . $e->getMessage();\n}\n\n?>\n\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Checkout</title>\n    <!-- Include your CSS here -->\n    <style>\n        .checkout-form {\n            max-width: 600px;\n            margin: 20px auto;\n            padding: 20px;\n            border: 1px solid #ddd;\n        }\n        .form-group {\n            margin-bottom: 15px;\n        }\n        label {\n            display: block;\n            margin-bottom: 5px;\n        }\n        input, select {\n            width: 100%;\n            padding: 8px;\n            margin-bottom: 10px;\n        }\n    </style>\n</head>\n<body>\n    <h2>Checkout</h2>\n    <div class=\"checkout-form\">\n        <form action=\"process_order.php\" method=\"post\">\n            <div class=\"form-group\">\n                <label for=\"first_name\">First Name:</label>\n                <input type=\"text\" id=\"first_name\" name=\"first_name\" required>\n            </div>\n            <div class=\"form-group\">\n                <label for=\"last_name\">Last Name:</label>\n                <input type=\"text\" id=\"last_name\" name=\"last_name\" required>\n            </div>\n            <div class=\"form-group\">\n                <label for=\"email\">Email:</label>\n                <input type=\"email\" id=\"email\" name=\"email\" required>\n            </div>\n            <div class=\"form-group\">\n                <label for=\"address\">Address:</label>\n                <input type=\"text\" id=\"address\" name=\"address\" required>\n            </div>\n            <div class=\"form-group\">\n                <label for=\"city\">City:</label>\n                <input type=\"text\" id=\"city\" name=\"city\" required>\n            </div>\n            <div class=\"form-group\">\n                <label for=\"state\">State:</label>\n                <select id=\"state\" name=\"state\" required>\n                    <option value=\"\">Select State</option>\n                    <!-- Add states here -->\n                </select>\n            </div>\n            <div class=\"form-group\">\n                <label for=\"zip_code\">Zip Code:</label>\n                <input type=\"text\" id=\"zip_code\" name=\"zip_code\" required>\n            </div>\n            <div class=\"form-group\">\n                <label for=\"payment_method\">Payment Method:</label>\n                <select id=\"payment_method\" name=\"payment_method\" required>\n                    <option value=\"credit_card\">Credit Card</option>\n                    <option value=\"paypal\">PayPal</option>\n                </select>\n            </div>\n            <?php if (isset($_SESSION['user_id'])): ?>\n                <input type=\"hidden\" name=\"user_id\" value=\"<?php echo $_SESSION['user_id']; ?>\">\n            <?php endif; ?>\n            <button type=\"submit\">Place Order</button>\n        </form>\n    </div>\n</body>\n</html>\n```", "```php\n<?php\nsession_start();\n\nif (empty($_POST)) {\n    die(\"Invalid request\");\n}\n\n// Connect to database\ntry {\n    $conn = new PDO(\"mysql:host=localhost;dbname=your_database_name\", 'username', 'password');\n} catch (PDOException $e) {\n    echo \"Connection failed: \" . $e->getMessage();\n}\n\n// Get user ID if logged in\n$user_id = $_POST['user_id'] ?? null;\n\n// Insert order into orders table\n$stmt = $conn->prepare(\"INSERT INTO orders (user_id, total_amount) VALUES (?, ?)\");\n$total = 0;\nforeach ($_SESSION['cart'] as $item) {\n    $total += $item['price'] * $item['quantity'];\n}\n$amount_with_tax = $total * 1.10; // Assuming 10% tax\n\n$stmt->execute([$user_id, $amount_with_tax]);\n$order_id = $conn->lastInsertId();\n\n// Insert order items\nforeach ($_SESSION['cart'] as $product_id => $item) {\n    $stmt = $conn->prepare(\"INSERT INTO order_items (order_id, product_id, quantity, price) VALUES (?, ?, ?, ?)\");\n    $stmt->execute([$order_id, $product_id, $item['quantity'], $item['price']]);\n}\n\n// Insert payment\n$payment_method = $_POST['payment_method'];\n$stmt = $conn->prepare(\"INSERT INTO payments (order_id, payment_method, amount) VALUES (?, ?, ?)\");\n$stmt->execute([$order_id, $payment_method, $amount_with_tax]);\n\n// Clear cart\nunset($_SESSION['cart']);\n\nheader(\"Location: thank_you.php\");\nexit();\n```", "```php\n<?php\nsession_start();\n\nif (!isset($_SESSION['last_order_id'])) {\n    header(\"Location: index.php\");\n    exit();\n}\n\n?>\n\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Thank You</title>\n    <!-- Include your CSS here -->\n    <style>\n        .thank-you {\n            text-align: center;\n            padding: 40px;\n            font-family: Arial, sans-serif;\n        }\n    </style>\n</head>\n<body>\n    <div class=\"thank-you\">\n        <h1>Thank You for Your Order!</h1>\n        <p>Your order has been received and is being processed.</p>\n        <a href=\"index.php\">Continue Shopping</a>\n    </div>\n</body>\n</html>\n```"]}
