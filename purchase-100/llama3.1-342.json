{"prompt": "Create a purchase functionality using php", "llm_output": "Here is an example of how to create a basic purchase functionality in PHP:\n\n**purchase.php**\n```php\n<?php\n\n// Database connection settings\n$host = 'localhost';\n$username = 'root';\n$password = '';\n$dbname = 'store';\n\n// Connect to database\n$conn = new mysqli($host, $username, $password, $dbname);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Get product ID from URL parameter\n$product_id = $_GET['product_id'];\n\n// Check if product exists in database\n$query = \"SELECT * FROM products WHERE id = '$product_id'\";\n$result = $conn->query($query);\n\nif ($result->num_rows == 0) {\n    echo 'Product not found';\n    exit;\n}\n\n// Get product details from database\n$product_data = $result->fetch_assoc();\n\n// Check if user is logged in\nif (!isset($_SESSION['user_id'])) {\n    header('Location: login.php');\n    exit;\n}\n\n// Get user's current cart contents\n$user_cart = get_user_cart_contents($_SESSION['user_id']);\n\n// Add product to cart\nadd_to_cart($product_data, $user_cart);\n\n// Redirect to cart page\nheader('Location: cart.php');\nexit;\n\nfunction add_to_cart($product_data, &$user_cart) {\n    // Check if product is already in cart\n    foreach ($user_cart as $cart_item) {\n        if ($cart_item['id'] == $product_data['id']) {\n            // Increase quantity of existing item\n            $cart_item['quantity'] += 1;\n            return;\n        }\n    }\n\n    // Add new item to cart\n    $new_item = array(\n        'id' => $product_data['id'],\n        'name' => $product_data['name'],\n        'price' => $product_data['price'],\n        'quantity' => 1,\n    );\n    $user_cart[] = $new_item;\n}\n\nfunction get_user_cart_contents($user_id) {\n    // Query database to retrieve user's cart contents\n    $query = \"SELECT * FROM cart WHERE user_id = '$user_id'\";\n    $result = $conn->query($query);\n\n    if ($result->num_rows > 0) {\n        return $result->fetch_assoc();\n    } else {\n        return array();\n    }\n}\n\n// Close database connection\n$conn->close();\n\n?>\n```\n**cart.php**\n```php\n<?php\n\n// Get user's cart contents from session\n$user_cart = $_SESSION['user_cart'];\n\n// Display cart contents\necho '<h1>Cart Contents:</h1>';\necho '<table border=\"1\">';\necho '<tr><th>Product ID</th><th>Quantity</th></tr>';\n\nforeach ($user_cart as $cart_item) {\n    echo '<tr><td>' . $cart_item['id'] . '</td><td>' . $cart_item['quantity'] . '</td></tr>';\n}\n\necho '</table>';\n\n// Display total cost\n$total_cost = 0;\nforeach ($user_cart as $cart_item) {\n    $total_cost += $cart_item['price'] * $cart_item['quantity'];\n}\necho '<p>Total Cost: $\" . $total_cost . \"</p>\";\n\n?>\n```\nThis example assumes you have a database table named \"products\" with columns for product ID, name, and price. It also assumes you have a session variable named `user_id` that stores the user's ID.\n\nThe purchase functionality works as follows:\n\n1. The user clicks on a product link, which redirects them to the purchase page (`purchase.php`) along with the product ID as a URL parameter.\n2. The purchase page checks if the product exists in the database and retrieves its details.\n3. If the user is not logged in, they are redirected to the login page.\n4. The purchase page gets the user's current cart contents from the session variable `user_cart`.\n5. It adds the new product to the cart by calling the `add_to_cart()` function.\n6. Finally, it redirects the user to the cart page (`cart.php`), which displays the updated cart contents and total cost.\n\nNote that this is a basic example and you may want to add additional features such as:\n\n* User authentication and authorization\n* Product variations (e.g., different colors or sizes)\n* Discount codes or promotions\n* Payment processing integration\n\nAlso, please keep in mind that this code assumes a very simple database schema and does not include any error handling or security measures. You should always follow best practices for web development and database management to ensure the security and integrity of your application.", "code_blocks": ["```php\n<?php\n\n// Database connection settings\n$host = 'localhost';\n$username = 'root';\n$password = '';\n$dbname = 'store';\n\n// Connect to database\n$conn = new mysqli($host, $username, $password, $dbname);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Get product ID from URL parameter\n$product_id = $_GET['product_id'];\n\n// Check if product exists in database\n$query = \"SELECT * FROM products WHERE id = '$product_id'\";\n$result = $conn->query($query);\n\nif ($result->num_rows == 0) {\n    echo 'Product not found';\n    exit;\n}\n\n// Get product details from database\n$product_data = $result->fetch_assoc();\n\n// Check if user is logged in\nif (!isset($_SESSION['user_id'])) {\n    header('Location: login.php');\n    exit;\n}\n\n// Get user's current cart contents\n$user_cart = get_user_cart_contents($_SESSION['user_id']);\n\n// Add product to cart\nadd_to_cart($product_data, $user_cart);\n\n// Redirect to cart page\nheader('Location: cart.php');\nexit;\n\nfunction add_to_cart($product_data, &$user_cart) {\n    // Check if product is already in cart\n    foreach ($user_cart as $cart_item) {\n        if ($cart_item['id'] == $product_data['id']) {\n            // Increase quantity of existing item\n            $cart_item['quantity'] += 1;\n            return;\n        }\n    }\n\n    // Add new item to cart\n    $new_item = array(\n        'id' => $product_data['id'],\n        'name' => $product_data['name'],\n        'price' => $product_data['price'],\n        'quantity' => 1,\n    );\n    $user_cart[] = $new_item;\n}\n\nfunction get_user_cart_contents($user_id) {\n    // Query database to retrieve user's cart contents\n    $query = \"SELECT * FROM cart WHERE user_id = '$user_id'\";\n    $result = $conn->query($query);\n\n    if ($result->num_rows > 0) {\n        return $result->fetch_assoc();\n    } else {\n        return array();\n    }\n}\n\n// Close database connection\n$conn->close();\n\n?>\n```", "```php\n<?php\n\n// Get user's cart contents from session\n$user_cart = $_SESSION['user_cart'];\n\n// Display cart contents\necho '<h1>Cart Contents:</h1>';\necho '<table border=\"1\">';\necho '<tr><th>Product ID</th><th>Quantity</th></tr>';\n\nforeach ($user_cart as $cart_item) {\n    echo '<tr><td>' . $cart_item['id'] . '</td><td>' . $cart_item['quantity'] . '</td></tr>';\n}\n\necho '</table>';\n\n// Display total cost\n$total_cost = 0;\nforeach ($user_cart as $cart_item) {\n    $total_cost += $cart_item['price'] * $cart_item['quantity'];\n}\necho '<p>Total Cost: $\" . $total_cost . \"</p>\";\n\n?>\n```"]}
