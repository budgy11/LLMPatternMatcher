{"prompt": "Create a purchase functionality using php", "llm_output": "Here's an example of a simple purchase functionality using PHP. This example assumes you have a database set up to store user information, product information, and order history.\n\n**Database Schema:**\n\nFor this example, we'll use a MySQL database with the following tables:\n\n```sql\nCREATE TABLE users (\n  id INT AUTO_INCREMENT,\n  name VARCHAR(255),\n  email VARCHAR(255),\n  password VARCHAR(255),\n  PRIMARY KEY (id)\n);\n\nCREATE TABLE products (\n  id INT AUTO_INCREMENT,\n  name VARCHAR(255),\n  price DECIMAL(10,2),\n  description TEXT,\n  PRIMARY KEY (id)\n);\n\nCREATE TABLE orders (\n  id INT AUTO_INCREMENT,\n  user_id INT,\n  order_date DATE,\n  total DECIMAL(10,2),\n  status VARCHAR(255),\n  PRIMARY KEY (id)\n);\n\nCREATE TABLE order_items (\n  id INT AUTO_INCREMENT,\n  order_id INT,\n  product_id INT,\n  quantity INT,\n  price DECIMAL(10,2),\n  PRIMARY KEY (id)\n);\n```\n\n**PHP Code:**\n\nCreate a file named `purchase.php` and add the following code:\n\n```php\n<?php\n\n// Include database connection settings\nrequire_once 'db_settings.php';\n\n// Check if user is logged in\nif (!isset($_SESSION['user_id'])) {\n  header('Location: login.php');\n  exit;\n}\n\n// Get product ID from URL parameter\n$productId = $_GET['product_id'];\n\n// Validate product ID\nif (!$productId || !is_numeric($productId)) {\n  echo 'Invalid product ID';\n  exit;\n}\n\n// Query database for product details\n$query = \"SELECT * FROM products WHERE id = '$productId'\";\n$result = mysqli_query($db, $query);\n$product = mysqli_fetch_assoc($result);\n\n// Check if product exists\nif (!$product) {\n  echo 'Product not found';\n  exit;\n}\n\n// Get user's cart contents (assuming cart is stored in session)\n$cartContents = $_SESSION['cart'];\n\n// Calculate total cost of order\n$totalCost = 0;\nforeach ($cartContents as $item) {\n  if ($item['id'] == $productId) {\n    $totalCost += $item['price'] * $item['quantity'];\n  }\n}\n\n// Insert new order into database\n$query = \"INSERT INTO orders (user_id, total, status)\n          VALUES ('{$_SESSION['user_id']}', '$totalCost', 'pending')\";\nmysqli_query($db, $query);\n$order_id = mysqli_insert_id($db);\n\n// Insert new order items into database\nforeach ($cartContents as $item) {\n  if ($item['id'] == $productId) {\n    $query = \"INSERT INTO order_items (order_id, product_id, quantity, price)\n              VALUES ('$order_id', '$item[id]', '{$item['quantity']}','$item[price]')\";\n    mysqli_query($db, $query);\n  }\n}\n\n// Update user's cart contents\nunset($_SESSION['cart'][$productId]);\n\n// Display confirmation message and redirect to success page\necho 'Order placed successfully!';\nheader('Location: success.php');\nexit;\n\n?>\n```\n\n**Example Use Case:**\n\n1. User logs in and views product details.\n2. User clicks \"Add to Cart\" button, which stores the product ID and quantity in a session variable (`$_SESSION['cart']`).\n3. User proceeds to checkout, where the PHP code on this page is executed.\n4. The PHP code queries the database for product details and calculates the total cost of the order.\n5. A new order is inserted into the database, along with new order items.\n6. The user's cart contents are updated by removing the purchased item.\n\nNote that this example assumes a basic understanding of PHP, MySQL, and session management. You should adapt this code to fit your specific use case and security requirements.", "code_blocks": [null, "```php\n<?php\n\n// Include database connection settings\nrequire_once 'db_settings.php';\n\n// Check if user is logged in\nif (!isset($_SESSION['user_id'])) {\n  header('Location: login.php');\n  exit;\n}\n\n// Get product ID from URL parameter\n$productId = $_GET['product_id'];\n\n// Validate product ID\nif (!$productId || !is_numeric($productId)) {\n  echo 'Invalid product ID';\n  exit;\n}\n\n// Query database for product details\n$query = \"SELECT * FROM products WHERE id = '$productId'\";\n$result = mysqli_query($db, $query);\n$product = mysqli_fetch_assoc($result);\n\n// Check if product exists\nif (!$product) {\n  echo 'Product not found';\n  exit;\n}\n\n// Get user's cart contents (assuming cart is stored in session)\n$cartContents = $_SESSION['cart'];\n\n// Calculate total cost of order\n$totalCost = 0;\nforeach ($cartContents as $item) {\n  if ($item['id'] == $productId) {\n    $totalCost += $item['price'] * $item['quantity'];\n  }\n}\n\n// Insert new order into database\n$query = \"INSERT INTO orders (user_id, total, status)\n          VALUES ('{$_SESSION['user_id']}', '$totalCost', 'pending')\";\nmysqli_query($db, $query);\n$order_id = mysqli_insert_id($db);\n\n// Insert new order items into database\nforeach ($cartContents as $item) {\n  if ($item['id'] == $productId) {\n    $query = \"INSERT INTO order_items (order_id, product_id, quantity, price)\n              VALUES ('$order_id', '$item[id]', '{$item['quantity']}','$item[price]')\";\n    mysqli_query($db, $query);\n  }\n}\n\n// Update user's cart contents\nunset($_SESSION['cart'][$productId]);\n\n// Display confirmation message and redirect to success page\necho 'Order placed successfully!';\nheader('Location: success.php');\nexit;\n\n?>\n```"]}
