{"prompt": "Create a purchase functionality using php", "llm_output": "Here is an example of a simple purchase functionality in PHP:\n\n**index.php**\n```php\n<?php\n// database connection settings\n$servername = \"localhost\";\n$username = \"root\";\n$password = \"\";\n$dbname = \"online_store\";\n\n// create connection\n$conn = new mysqli($servername, $username, $password, $dbname);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// get product id from URL\n$product_id = $_GET['product_id'];\n\n// retrieve product details from database\n$query = \"SELECT * FROM products WHERE id = '$product_id'\";\n$result = $conn->query($query);\n\nif ($result->num_rows > 0) {\n    while($row = $result->fetch_assoc()) {\n        // display product details\n        echo \"<h2>Product Details</h2>\";\n        echo \"Name: \" . $row[\"name\"] . \"</br>\";\n        echo \"Price: $\" . $row[\"price\"] . \"</br>\";\n        echo \"Description: \" . $row[\"description\"];\n\n        // create form for purchase\n        ?>\n        <form action=\"process.php\" method=\"post\">\n            <input type=\"hidden\" name=\"product_id\" value=\"<?php echo $product_id; ?>\">\n            <label>Quantity:</label>\n            <input type=\"number\" name=\"quantity\" required></br></br>\n            <button type=\"submit\">Purchase</button>\n        </form>\n\n        <?php\n    }\n} else {\n    echo \"No product found.\";\n}\n\n// close connection\n$conn->close();\n?>\n```\n**process.php**\n```php\n<?php\n// database connection settings\n$servername = \"localhost\";\n$username = \"root\";\n$password = \"\";\n$dbname = \"online_store\";\n\n// create connection\n$conn = new mysqli($servername, $username, $password, $dbname);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// get product id and quantity from form data\n$product_id = $_POST['product_id'];\n$quantity = $_POST['quantity'];\n\n// check if quantity is valid (for example, at least 1)\nif ($quantity < 1) {\n    echo \"Invalid quantity.\";\n} else {\n    // retrieve product details from database\n    $query = \"SELECT * FROM products WHERE id = '$product_id'\";\n    $result = $conn->query($query);\n\n    if ($result->num_rows > 0) {\n        while($row = $result->fetch_assoc()) {\n            // calculate total cost\n            $total_cost = $row[\"price\"] * $quantity;\n\n            // insert purchase record into database\n            $query = \"INSERT INTO purchases (product_id, quantity, total_cost)\n                      VALUES ('$product_id', '$quantity', '$total_cost')\";\n            $conn->query($query);\n\n            // update product stock in database\n            $query = \"UPDATE products SET stock = stock - '$quantity' WHERE id = '$product_id'\";\n            $conn->query($query);\n        }\n    }\n\n    echo \"Purchase successful.\";\n}\n\n// close connection\n$conn->close();\n?>\n```\n**database schema:**\n\n```sql\nCREATE TABLE products (\n  id INT PRIMARY KEY,\n  name VARCHAR(255),\n  price DECIMAL(10,2),\n  description TEXT,\n  stock INT\n);\n\nCREATE TABLE purchases (\n  id INT PRIMARY KEY,\n  product_id INT,\n  quantity INT,\n  total_cost DECIMAL(10,2),\n  FOREIGN KEY (product_id) REFERENCES products(id)\n);\n```\nThis is a basic example and does not include any error handling or security measures. You should consider implementing additional checks and balances to ensure the integrity of your database.\n\n**Note:** This code uses the `mysqli` extension for database interaction. In a real-world application, you would likely want to use a more secure method such as prepared statements to prevent SQL injection attacks.", "code_blocks": ["```php\n<?php\n// database connection settings\n$servername = \"localhost\";\n$username = \"root\";\n$password = \"\";\n$dbname = \"online_store\";\n\n// create connection\n$conn = new mysqli($servername, $username, $password, $dbname);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// get product id from URL\n$product_id = $_GET['product_id'];\n\n// retrieve product details from database\n$query = \"SELECT * FROM products WHERE id = '$product_id'\";\n$result = $conn->query($query);\n\nif ($result->num_rows > 0) {\n    while($row = $result->fetch_assoc()) {\n        // display product details\n        echo \"<h2>Product Details</h2>\";\n        echo \"Name: \" . $row[\"name\"] . \"</br>\";\n        echo \"Price: $\" . $row[\"price\"] . \"</br>\";\n        echo \"Description: \" . $row[\"description\"];\n\n        // create form for purchase\n        ?>\n        <form action=\"process.php\" method=\"post\">\n            <input type=\"hidden\" name=\"product_id\" value=\"<?php echo $product_id; ?>\">\n            <label>Quantity:</label>\n            <input type=\"number\" name=\"quantity\" required></br></br>\n            <button type=\"submit\">Purchase</button>\n        </form>\n\n        <?php\n    }\n} else {\n    echo \"No product found.\";\n}\n\n// close connection\n$conn->close();\n?>\n```", "```php\n<?php\n// database connection settings\n$servername = \"localhost\";\n$username = \"root\";\n$password = \"\";\n$dbname = \"online_store\";\n\n// create connection\n$conn = new mysqli($servername, $username, $password, $dbname);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// get product id and quantity from form data\n$product_id = $_POST['product_id'];\n$quantity = $_POST['quantity'];\n\n// check if quantity is valid (for example, at least 1)\nif ($quantity < 1) {\n    echo \"Invalid quantity.\";\n} else {\n    // retrieve product details from database\n    $query = \"SELECT * FROM products WHERE id = '$product_id'\";\n    $result = $conn->query($query);\n\n    if ($result->num_rows > 0) {\n        while($row = $result->fetch_assoc()) {\n            // calculate total cost\n            $total_cost = $row[\"price\"] * $quantity;\n\n            // insert purchase record into database\n            $query = \"INSERT INTO purchases (product_id, quantity, total_cost)\n                      VALUES ('$product_id', '$quantity', '$total_cost')\";\n            $conn->query($query);\n\n            // update product stock in database\n            $query = \"UPDATE products SET stock = stock - '$quantity' WHERE id = '$product_id'\";\n            $conn->query($query);\n        }\n    }\n\n    echo \"Purchase successful.\";\n}\n\n// close connection\n$conn->close();\n?>\n```", null]}
