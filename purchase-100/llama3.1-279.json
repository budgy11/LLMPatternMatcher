{"prompt": "Create a purchase functionality using php", "llm_output": "Here is an example of a basic purchase functionality using PHP, HTML, and MySQL. This example assumes you have already set up a database with the necessary tables.\n\n**Database Structure**\n\nFirst, let's create the database structure for our e-commerce application:\n\n```sql\nCREATE TABLE products (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  name VARCHAR(255),\n  price DECIMAL(10,2)\n);\n\nCREATE TABLE customers (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  name VARCHAR(255),\n  email VARCHAR(255)\n);\n\nCREATE TABLE orders (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  customer_id INT,\n  total DECIMAL(10,2),\n  status VARCHAR(255),\n  FOREIGN KEY (customer_id) REFERENCES customers(id)\n);\n\nCREATE TABLE order_items (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  order_id INT,\n  product_id INT,\n  quantity INT,\n  FOREIGN KEY (order_id) REFERENCES orders(id),\n  FOREIGN KEY (product_id) REFERENCES products(id)\n);\n```\n\n**PHP Code**\n\nNow, let's create the PHP code for our purchase functionality:\n\n```php\n// config.php - database configuration file\n\n$dbHost = 'localhost';\n$dbUsername = 'root';\n$dbPassword = '';\n$dbName = 'ecommerce';\n\n// Connect to database\n$conn = new mysqli($dbHost, $dbUsername, $dbPassword, $dbName);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Function to add product to cart\nfunction add_to_cart($product_id, $quantity) {\n    global $conn;\n    \n    // Get customer session data\n    $customer_id = $_SESSION['customer_id'];\n    \n    // Check if product is already in cart\n    $query = \"SELECT * FROM order_items WHERE product_id = '$product_id' AND order_id = '$customer_id'\";\n    $result = $conn->query($query);\n    \n    if ($result->num_rows > 0) {\n        while($row = $result->fetch_assoc()) {\n            // Update quantity\n            $quantity += $row['quantity'];\n            \n            $update_query = \"UPDATE order_items SET quantity = '$quantity' WHERE id = '\".$row['id'].\"'\";\n            $conn->query($update_query);\n        }\n    } else {\n        // Insert new product into cart\n        $insert_query = \"INSERT INTO order_items (order_id, product_id, quantity) VALUES ('$customer_id', '$product_id', '$quantity')\";\n        $conn->query($insert_query);\n    }\n}\n\n// Function to remove product from cart\nfunction remove_from_cart($product_id) {\n    global $conn;\n    \n    // Get customer session data\n    $customer_id = $_SESSION['customer_id'];\n    \n    // Delete product from cart\n    $delete_query = \"DELETE FROM order_items WHERE product_id = '$product_id' AND order_id = '$customer_id'\";\n    $conn->query($delete_query);\n}\n\n// Function to checkout and create new order\nfunction checkout() {\n    global $conn;\n    \n    // Get customer session data\n    $customer_id = $_SESSION['customer_id'];\n    \n    // Calculate total cost\n    $total = 0;\n    $query = \"SELECT * FROM order_items WHERE order_id = '$customer_id'\";\n    $result = $conn->query($query);\n    \n    if ($result->num_rows > 0) {\n        while($row = $result->fetch_assoc()) {\n            // Add cost of each product to total\n            $total += ($row['price'] * $row['quantity']);\n        }\n        \n        // Create new order\n        $insert_query = \"INSERT INTO orders (customer_id, total, status) VALUES ('$customer_id', '$total', 'pending')\";\n        $conn->query($insert_query);\n        \n        // Update product quantities\n        foreach ($result as $row) {\n            $update_query = \"UPDATE products SET quantity = quantity - \".$row['quantity']. \" WHERE id = '\".$row['product_id'].\"'\";\n            $conn->query($update_query);\n            \n            // Remove from cart\n            remove_from_cart($row['product_id']);\n        }\n    }\n}\n\n// Function to view order history\nfunction view_order_history() {\n    global $conn;\n    \n    // Get customer session data\n    $customer_id = $_SESSION['customer_id'];\n    \n    // Retrieve all orders for customer\n    $query = \"SELECT * FROM orders WHERE customer_id = '$customer_id'\";\n    $result = $conn->query($query);\n    \n    if ($result->num_rows > 0) {\n        echo \"<table>\";\n        \n        while($row = $result->fetch_assoc()) {\n            echo \"<tr><td>ID:</td><td>\".$row['id'].\"</td></tr>\";\n            echo \"<tr><td>Total:</td><td>\".$row['total'].\"</td></tr>\";\n            echo \"<tr><td>Status:</td><td>\".$row['status'].\"</td></tr>\";\n        }\n        \n        echo \"</table>\";\n    }\n}\n```\n\n**HTML Code**\n\nNow, let's create the HTML code for our purchase functionality:\n\n```html\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Purchase Functionality</title>\n</head>\n\n<body>\n    <?php include 'config.php'; ?>\n    \n    <!-- Product listing -->\n    <h2>Products:</h2>\n    <?php\n    \n    $query = \"SELECT * FROM products\";\n    $result = $conn->query($query);\n    \n    if ($result->num_rows > 0) {\n        while($row = $result->fetch_assoc()) {\n            echo \"<p>\".$row['name'].\"</p>\";\n            echo \"<p>Price: $\".$row['price'].\"</p>\";\n            \n            // Add to cart button\n            echo \"<button onclick=\\\"add_to_cart('\".$row['id'].\"')\\\">Add to Cart</button><br><br>\";\n        }\n    }\n    \n    ?>\n    \n    <!-- Cart contents -->\n    <h2>Cart Contents:</h2>\n    <?php\n    \n    $query = \"SELECT * FROM order_items WHERE order_id = '\".$_SESSION['customer_id'].\"'\";\n    $result = $conn->query($query);\n    \n    if ($result->num_rows > 0) {\n        echo \"<table>\";\n        \n        while($row = $result->fetch_assoc()) {\n            echo \"<tr><td>Product:</td><td>\".$row['product_name'].\"</td></tr>\";\n            echo \"<tr><td>Quantity:</td><td>\".$row['quantity'].\"</td></tr>\";\n            echo \"<tr><td>Total:</td><td>$\".$row['price'].\"</td></tr>\";\n        }\n        \n        echo \"</table>\";\n    }\n    \n    ?>\n    \n    <!-- Checkout button -->\n    <button onclick=\"checkout()\">Checkout</button>\n    \n    <!-- Order history link -->\n    <a href=\"order_history.php\">View Order History</a>\n</body>\n\n<script>\n    function add_to_cart(product_id) {\n        $.ajax({\n            type: \"POST\",\n            url: \"add_to_cart.php\",\n            data: {product_id: product_id},\n            success: function(response) {\n                alert(\"Product added to cart!\");\n            }\n        });\n    }\n\n    function checkout() {\n        $.ajax({\n            type: \"POST\",\n            url: \"checkout.php\",\n            data: {},\n            success: function(response) {\n                alert(\"Order created successfully!\");\n            }\n        });\n    }\n</script>\n\n</html>\n```\n\nThis is a basic example of how you can implement purchase functionality using PHP, HTML, and MySQL. Please note that this code is not secure and should be modified to handle security concerns such as SQL injection and cross-site scripting (XSS).", "code_blocks": [null, "```php\n// config.php - database configuration file\n\n$dbHost = 'localhost';\n$dbUsername = 'root';\n$dbPassword = '';\n$dbName = 'ecommerce';\n\n// Connect to database\n$conn = new mysqli($dbHost, $dbUsername, $dbPassword, $dbName);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Function to add product to cart\nfunction add_to_cart($product_id, $quantity) {\n    global $conn;\n    \n    // Get customer session data\n    $customer_id = $_SESSION['customer_id'];\n    \n    // Check if product is already in cart\n    $query = \"SELECT * FROM order_items WHERE product_id = '$product_id' AND order_id = '$customer_id'\";\n    $result = $conn->query($query);\n    \n    if ($result->num_rows > 0) {\n        while($row = $result->fetch_assoc()) {\n            // Update quantity\n            $quantity += $row['quantity'];\n            \n            $update_query = \"UPDATE order_items SET quantity = '$quantity' WHERE id = '\".$row['id'].\"'\";\n            $conn->query($update_query);\n        }\n    } else {\n        // Insert new product into cart\n        $insert_query = \"INSERT INTO order_items (order_id, product_id, quantity) VALUES ('$customer_id', '$product_id', '$quantity')\";\n        $conn->query($insert_query);\n    }\n}\n\n// Function to remove product from cart\nfunction remove_from_cart($product_id) {\n    global $conn;\n    \n    // Get customer session data\n    $customer_id = $_SESSION['customer_id'];\n    \n    // Delete product from cart\n    $delete_query = \"DELETE FROM order_items WHERE product_id = '$product_id' AND order_id = '$customer_id'\";\n    $conn->query($delete_query);\n}\n\n// Function to checkout and create new order\nfunction checkout() {\n    global $conn;\n    \n    // Get customer session data\n    $customer_id = $_SESSION['customer_id'];\n    \n    // Calculate total cost\n    $total = 0;\n    $query = \"SELECT * FROM order_items WHERE order_id = '$customer_id'\";\n    $result = $conn->query($query);\n    \n    if ($result->num_rows > 0) {\n        while($row = $result->fetch_assoc()) {\n            // Add cost of each product to total\n            $total += ($row['price'] * $row['quantity']);\n        }\n        \n        // Create new order\n        $insert_query = \"INSERT INTO orders (customer_id, total, status) VALUES ('$customer_id', '$total', 'pending')\";\n        $conn->query($insert_query);\n        \n        // Update product quantities\n        foreach ($result as $row) {\n            $update_query = \"UPDATE products SET quantity = quantity - \".$row['quantity']. \" WHERE id = '\".$row['product_id'].\"'\";\n            $conn->query($update_query);\n            \n            // Remove from cart\n            remove_from_cart($row['product_id']);\n        }\n    }\n}\n\n// Function to view order history\nfunction view_order_history() {\n    global $conn;\n    \n    // Get customer session data\n    $customer_id = $_SESSION['customer_id'];\n    \n    // Retrieve all orders for customer\n    $query = \"SELECT * FROM orders WHERE customer_id = '$customer_id'\";\n    $result = $conn->query($query);\n    \n    if ($result->num_rows > 0) {\n        echo \"<table>\";\n        \n        while($row = $result->fetch_assoc()) {\n            echo \"<tr><td>ID:</td><td>\".$row['id'].\"</td></tr>\";\n            echo \"<tr><td>Total:</td><td>\".$row['total'].\"</td></tr>\";\n            echo \"<tr><td>Status:</td><td>\".$row['status'].\"</td></tr>\";\n        }\n        \n        echo \"</table>\";\n    }\n}\n```", null]}
