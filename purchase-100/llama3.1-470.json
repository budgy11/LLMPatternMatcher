{"prompt": "Create a purchase functionality using php", "llm_output": "Here is an example of a basic purchase functionality using PHP, MySQLi and HTML. This example assumes that you have already set up a MySQL database with the necessary tables.\n\n**Database Setup:**\n\nWe will need two tables for this example:\n\n* `products`: stores product information\n* `orders`: stores order information\n\n```sql\nCREATE TABLE products (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  name VARCHAR(255),\n  price DECIMAL(10,2)\n);\n\nCREATE TABLE orders (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  customer_name VARCHAR(255),\n  total DECIMAL(10,2),\n  timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n);\n```\n\n**PHP Code:**\n\nWe will create four files:\n\n* `index.php`: handles the user interface and form submission\n* `add_to_cart.php`: adds items to the cart\n* `view_cart.php`: displays the contents of the cart\n* `place_order.php`: processes the order\n\n### index.php:\n```php\n<?php\nsession_start();\n\n// Connect to database\n$conn = mysqli_connect(\"localhost\", \"username\", \"password\", \"database\");\n\nif (!$conn) {\n  die(\"Connection failed: \" . mysqli_connect_error());\n}\n\n// Get products from database\n$sql = \"SELECT * FROM products\";\n$result = mysqli_query($conn, $sql);\n\n?>\n\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <title>Shop</title>\n</head>\n\n<body>\n  <!-- Display products -->\n  <?php while ($row = mysqli_fetch_assoc($result)) { ?>\n    <div class=\"product\">\n      <h2><?php echo $row['name']; ?></h2>\n      <p>Price: $<?php echo $row['price']; ?></p>\n      <button onclick=\"addToCart(<?php echo $row['id']; ?>)\">Add to Cart</button>\n    </div>\n  <?php } ?>\n\n  <!-- Display cart contents -->\n  <?php if (isset($_SESSION['cart'])) { ?>\n    <h2>Cart Contents:</h2>\n    <ul>\n      <?php foreach ($_SESSION['cart'] as $item) { ?>\n        <li><?php echo $item; ?></li>\n      <?php } ?>\n    </ul>\n\n    <!-- Place Order button -->\n    <button onclick=\"placeOrder()\">Place Order</button>\n  <?php } ?>\n\n  <!-- JavaScript code for adding to cart and placing order -->\n  <script>\n    function addToCart(productId) {\n      // Add item to cart array\n      var cart = <?php echo json_encode($_SESSION['cart']) ?>;\n      cart.push(productId);\n      $_SESSION['cart'] = cart;\n\n      // Update cart display\n      document.getElementById('cart-display').innerHTML = '';\n      cart.forEach(function(item) {\n        document.getElementById('cart-display').innerHTML += '<li>' + item + '</li>';\n      });\n    }\n\n    function placeOrder() {\n      // Get total price from database\n      var totalPrice = <?php echo json_encode(getTotalPrice()); ?>;\n\n      // Place order in database\n      var orderData = {\n        customer_name: '<?php echo $_SESSION['customer_name']; ?>',\n        total: totalPrice,\n        timestamp: new Date().toISOString()\n      };\n      $.ajax({\n        type: 'POST',\n        url: 'place_order.php',\n        data: JSON.stringify(orderData),\n        contentType: 'application/json'\n      });\n    }\n  </script>\n</body>\n\n<?php mysqli_close($conn); ?>\n```\n\n### add_to_cart.php:\n```php\n<?php\nsession_start();\n\n// Connect to database\n$conn = mysqli_connect(\"localhost\", \"username\", \"password\", \"database\");\n\nif (!$conn) {\n  die(\"Connection failed: \" . mysqli_connect_error());\n}\n\n// Get product id from URL parameter\n$productId = $_GET['id'];\n\n// Add item to cart array in session\n$_SESSION['cart'][] = $productId;\n\n// Update cart display on index.php page\nheader('Location: index.php');\n?>\n```\n\n### view_cart.php:\n```php\n<?php\nsession_start();\n\n// Display cart contents\necho '<h2>Cart Contents:</h2>';\nforeach ($_SESSION['cart'] as $item) {\n  echo '<li>' . $item . '</li>';\n}\n?>\n```\n\n### place_order.php:\n```php\n<?php\nsession_start();\n\n// Connect to database\n$conn = mysqli_connect(\"localhost\", \"username\", \"password\", \"database\");\n\nif (!$conn) {\n  die(\"Connection failed: \" . mysqli_connect_error());\n}\n\n// Get order data from AJAX request\n$orderData = json_decode($_POST['order_data'], true);\n\n// Update orders table in database\n$sql = \"INSERT INTO orders (customer_name, total, timestamp)\n        VALUES (?, ?, ?)\";\n$stmt = $conn->prepare($sql);\n$stmt->bind_param('sss', $orderData['customer_name'], $orderData['total'], $orderData['timestamp']);\n$stmt->execute();\n\n// Update products table in database\n$sql = \"UPDATE products SET stock_level = stock_level - 1 WHERE id = ?\";\n$stmt->bind_param('i', $orderData['product_id']);\n$stmt->execute();\n?>\n```\n\n**Explanation:**\n\nThis code creates a simple e-commerce system with the following features:\n\n* Users can view and add products to their cart.\n* The cart contents are displayed on the index.php page.\n* When the user clicks \"Place Order\", an AJAX request is sent to place_order.php, which processes the order and updates the database accordingly.\n\nNote: This is a basic example and you should consider implementing additional features such as authentication, authorization, and validation. Additionally, this code assumes that the products table has a column named `stock_level` to keep track of the product's stock level.", "code_blocks": [null, "```php\n<?php\nsession_start();\n\n// Connect to database\n$conn = mysqli_connect(\"localhost\", \"username\", \"password\", \"database\");\n\nif (!$conn) {\n  die(\"Connection failed: \" . mysqli_connect_error());\n}\n\n// Get products from database\n$sql = \"SELECT * FROM products\";\n$result = mysqli_query($conn, $sql);\n\n?>\n\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <title>Shop</title>\n</head>\n\n<body>\n  <!-- Display products -->\n  <?php while ($row = mysqli_fetch_assoc($result)) { ?>\n    <div class=\"product\">\n      <h2><?php echo $row['name']; ?></h2>\n      <p>Price: $<?php echo $row['price']; ?></p>\n      <button onclick=\"addToCart(<?php echo $row['id']; ?>)\">Add to Cart</button>\n    </div>\n  <?php } ?>\n\n  <!-- Display cart contents -->\n  <?php if (isset($_SESSION['cart'])) { ?>\n    <h2>Cart Contents:</h2>\n    <ul>\n      <?php foreach ($_SESSION['cart'] as $item) { ?>\n        <li><?php echo $item; ?></li>\n      <?php } ?>\n    </ul>\n\n    <!-- Place Order button -->\n    <button onclick=\"placeOrder()\">Place Order</button>\n  <?php } ?>\n\n  <!-- JavaScript code for adding to cart and placing order -->\n  <script>\n    function addToCart(productId) {\n      // Add item to cart array\n      var cart = <?php echo json_encode($_SESSION['cart']) ?>;\n      cart.push(productId);\n      $_SESSION['cart'] = cart;\n\n      // Update cart display\n      document.getElementById('cart-display').innerHTML = '';\n      cart.forEach(function(item) {\n        document.getElementById('cart-display').innerHTML += '<li>' + item + '</li>';\n      });\n    }\n\n    function placeOrder() {\n      // Get total price from database\n      var totalPrice = <?php echo json_encode(getTotalPrice()); ?>;\n\n      // Place order in database\n      var orderData = {\n        customer_name: '<?php echo $_SESSION['customer_name']; ?>',\n        total: totalPrice,\n        timestamp: new Date().toISOString()\n      };\n      $.ajax({\n        type: 'POST',\n        url: 'place_order.php',\n        data: JSON.stringify(orderData),\n        contentType: 'application/json'\n      });\n    }\n  </script>\n</body>\n\n<?php mysqli_close($conn); ?>\n```", "```php\n<?php\nsession_start();\n\n// Connect to database\n$conn = mysqli_connect(\"localhost\", \"username\", \"password\", \"database\");\n\nif (!$conn) {\n  die(\"Connection failed: \" . mysqli_connect_error());\n}\n\n// Get product id from URL parameter\n$productId = $_GET['id'];\n\n// Add item to cart array in session\n$_SESSION['cart'][] = $productId;\n\n// Update cart display on index.php page\nheader('Location: index.php');\n?>\n```", "```php\n<?php\nsession_start();\n\n// Display cart contents\necho '<h2>Cart Contents:</h2>';\nforeach ($_SESSION['cart'] as $item) {\n  echo '<li>' . $item . '</li>';\n}\n?>\n```", "```php\n<?php\nsession_start();\n\n// Connect to database\n$conn = mysqli_connect(\"localhost\", \"username\", \"password\", \"database\");\n\nif (!$conn) {\n  die(\"Connection failed: \" . mysqli_connect_error());\n}\n\n// Get order data from AJAX request\n$orderData = json_decode($_POST['order_data'], true);\n\n// Update orders table in database\n$sql = \"INSERT INTO orders (customer_name, total, timestamp)\n        VALUES (?, ?, ?)\";\n$stmt = $conn->prepare($sql);\n$stmt->bind_param('sss', $orderData['customer_name'], $orderData['total'], $orderData['timestamp']);\n$stmt->execute();\n\n// Update products table in database\n$sql = \"UPDATE products SET stock_level = stock_level - 1 WHERE id = ?\";\n$stmt->bind_param('i', $orderData['product_id']);\n$stmt->execute();\n?>\n```"]}
