{"prompt": "Create a purchase functionality using php", "llm_output": "Here's an example of a simple purchase functionality using PHP, including user authentication and product management. This example will use MySQL as the database.\n\n**Database Structure:**\n\nFirst, let's create the necessary tables in our database:\n\n```sql\nCREATE TABLE users (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  username VARCHAR(255) NOT NULL,\n  password_hash VARCHAR(255) NOT NULL\n);\n\nCREATE TABLE products (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  name VARCHAR(255) NOT NULL,\n  description TEXT NOT NULL,\n  price DECIMAL(10,2) NOT NULL\n);\n\nCREATE TABLE orders (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  user_id INT NOT NULL,\n  product_id INT NOT NULL,\n  total DECIMAL(10,2) NOT NULL,\n  FOREIGN KEY (user_id) REFERENCES users(id),\n  FOREIGN KEY (product_id) REFERENCES products(id)\n);\n```\n\n**PHP Code:**\n\nWe'll use the following PHP code for the purchase functionality:\n\n```php\n// Include database connection file\nrequire_once 'db.php';\n\n// Function to register a new user\nfunction register_user($username, $password) {\n    global $conn;\n    // Hash password before storing it in database\n    $hashed_password = password_hash($password, PASSWORD_DEFAULT);\n    $query = \"INSERT INTO users (username, password_hash) VALUES ('$username', '$hashed_password')\";\n    return mysqli_query($conn, $query);\n}\n\n// Function to login a user\nfunction login_user($username, $password) {\n    global $conn;\n    $query = \"SELECT * FROM users WHERE username = '$username'\";\n    $result = mysqli_query($conn, $query);\n    if (mysqli_num_rows($result) > 0) {\n        // Retrieve the user's details from the database\n        $row = mysqli_fetch_assoc($result);\n        // Check password\n        if (password_verify($password, $row['password_hash'])) {\n            return true; // Login successful\n        } else {\n            return false; // Incorrect password\n        }\n    } else {\n        return false; // User does not exist\n    }\n}\n\n// Function to add a product to the database\nfunction add_product($name, $description, $price) {\n    global $conn;\n    $query = \"INSERT INTO products (name, description, price) VALUES ('$name', '$description', '$price')\";\n    return mysqli_query($conn, $query);\n}\n\n// Function to display all products in the database\nfunction display_products() {\n    global $conn;\n    $query = \"SELECT * FROM products\";\n    $result = mysqli_query($conn, $query);\n    if (mysqli_num_rows($result) > 0) {\n        return mysqli_fetch_all($result, MYSQLI_ASSOC);\n    } else {\n        return array(); // No products found\n    }\n}\n\n// Function to process a purchase\nfunction process_purchase($user_id, $product_id) {\n    global $conn;\n    // Check if user has sufficient balance\n    $query = \"SELECT * FROM orders WHERE user_id = '$user_id' AND product_id = '$product_id'\";\n    $result = mysqli_query($conn, $query);\n    if (mysqli_num_rows($result) > 0) {\n        return false; // User already purchased this product\n    } else {\n        // Calculate total cost of purchase\n        $total = calculate_total();\n        // Update balance in database\n        update_balance($user_id, $total);\n        // Insert order into database\n        insert_order($user_id, $product_id, $total);\n        return true; // Purchase successful\n    }\n}\n\n// Function to calculate the total cost of a purchase\nfunction calculate_total() {\n    global $conn;\n    // For simplicity, let's assume the total is just the product price\n    $query = \"SELECT price FROM products WHERE id = '1'\";\n    $result = mysqli_query($conn, $query);\n    return mysqli_fetch_assoc($result)['price'];\n}\n\n// Function to update a user's balance in the database\nfunction update_balance($user_id, $new_balance) {\n    global $conn;\n    $query = \"UPDATE users SET balance = '$new_balance' WHERE id = '$user_id'\";\n    return mysqli_query($conn, $query);\n}\n\n// Function to insert an order into the database\nfunction insert_order($user_id, $product_id, $total) {\n    global $conn;\n    $query = \"INSERT INTO orders (user_id, product_id, total) VALUES ('$user_id', '$product_id', '$total')\";\n    return mysqli_query($conn, $query);\n}\n```\n\n**Example Usage:**\n\nHere's an example of how you might use the above functions in a simple web application:\n\n```php\n// Register user\n$register_result = register_user('john_doe', 'password123');\necho \"User registered successfully!\" . PHP_EOL;\n\n// Login user\n$login_result = login_user('john_doe', 'password123');\nif ($login_result) {\n    echo \"Login successful!\" . PHP_EOL;\n} else {\n    echo \"Incorrect username or password.\" . PHP_EOL;\n}\n\n// Add product\n$product_id = add_product('Apple iPhone 14', 'The latest Apple iPhone model.', 999.99);\necho \"Product added successfully! ID: $product_id\" . PHP_EOL;\n\n// Display all products\n$products = display_products();\necho \"Products:\" . PHP_EOL;\nforeach ($products as $product) {\n    echo \"- Name: {$product['name']}, Price: {$product['price']} euros\" . PHP_EOL;\n}\n\n// Process purchase\n$purchased = process_purchase(1, 1);\nif ($purchased) {\n    echo \"Purchase successful!\" . PHP_EOL;\n} else {\n    echo \"Failed to process purchase.\" . PHP_EOL;\n}\n```\n\nRemember that in a real-world application, you should never hard-code database credentials or store passwords in plain text. This example is intended for educational purposes only. Also, error checking and input validation are left out of this example for brevity.", "code_blocks": [null, "```php\n// Include database connection file\nrequire_once 'db.php';\n\n// Function to register a new user\nfunction register_user($username, $password) {\n    global $conn;\n    // Hash password before storing it in database\n    $hashed_password = password_hash($password, PASSWORD_DEFAULT);\n    $query = \"INSERT INTO users (username, password_hash) VALUES ('$username', '$hashed_password')\";\n    return mysqli_query($conn, $query);\n}\n\n// Function to login a user\nfunction login_user($username, $password) {\n    global $conn;\n    $query = \"SELECT * FROM users WHERE username = '$username'\";\n    $result = mysqli_query($conn, $query);\n    if (mysqli_num_rows($result) > 0) {\n        // Retrieve the user's details from the database\n        $row = mysqli_fetch_assoc($result);\n        // Check password\n        if (password_verify($password, $row['password_hash'])) {\n            return true; // Login successful\n        } else {\n            return false; // Incorrect password\n        }\n    } else {\n        return false; // User does not exist\n    }\n}\n\n// Function to add a product to the database\nfunction add_product($name, $description, $price) {\n    global $conn;\n    $query = \"INSERT INTO products (name, description, price) VALUES ('$name', '$description', '$price')\";\n    return mysqli_query($conn, $query);\n}\n\n// Function to display all products in the database\nfunction display_products() {\n    global $conn;\n    $query = \"SELECT * FROM products\";\n    $result = mysqli_query($conn, $query);\n    if (mysqli_num_rows($result) > 0) {\n        return mysqli_fetch_all($result, MYSQLI_ASSOC);\n    } else {\n        return array(); // No products found\n    }\n}\n\n// Function to process a purchase\nfunction process_purchase($user_id, $product_id) {\n    global $conn;\n    // Check if user has sufficient balance\n    $query = \"SELECT * FROM orders WHERE user_id = '$user_id' AND product_id = '$product_id'\";\n    $result = mysqli_query($conn, $query);\n    if (mysqli_num_rows($result) > 0) {\n        return false; // User already purchased this product\n    } else {\n        // Calculate total cost of purchase\n        $total = calculate_total();\n        // Update balance in database\n        update_balance($user_id, $total);\n        // Insert order into database\n        insert_order($user_id, $product_id, $total);\n        return true; // Purchase successful\n    }\n}\n\n// Function to calculate the total cost of a purchase\nfunction calculate_total() {\n    global $conn;\n    // For simplicity, let's assume the total is just the product price\n    $query = \"SELECT price FROM products WHERE id = '1'\";\n    $result = mysqli_query($conn, $query);\n    return mysqli_fetch_assoc($result)['price'];\n}\n\n// Function to update a user's balance in the database\nfunction update_balance($user_id, $new_balance) {\n    global $conn;\n    $query = \"UPDATE users SET balance = '$new_balance' WHERE id = '$user_id'\";\n    return mysqli_query($conn, $query);\n}\n\n// Function to insert an order into the database\nfunction insert_order($user_id, $product_id, $total) {\n    global $conn;\n    $query = \"INSERT INTO orders (user_id, product_id, total) VALUES ('$user_id', '$product_id', '$total')\";\n    return mysqli_query($conn, $query);\n}\n```", "```php\n// Register user\n$register_result = register_user('john_doe', 'password123');\necho \"User registered successfully!\" . PHP_EOL;\n\n// Login user\n$login_result = login_user('john_doe', 'password123');\nif ($login_result) {\n    echo \"Login successful!\" . PHP_EOL;\n} else {\n    echo \"Incorrect username or password.\" . PHP_EOL;\n}\n\n// Add product\n$product_id = add_product('Apple iPhone 14', 'The latest Apple iPhone model.', 999.99);\necho \"Product added successfully! ID: $product_id\" . PHP_EOL;\n\n// Display all products\n$products = display_products();\necho \"Products:\" . PHP_EOL;\nforeach ($products as $product) {\n    echo \"- Name: {$product['name']}, Price: {$product['price']} euros\" . PHP_EOL;\n}\n\n// Process purchase\n$purchased = process_purchase(1, 1);\nif ($purchased) {\n    echo \"Purchase successful!\" . PHP_EOL;\n} else {\n    echo \"Failed to process purchase.\" . PHP_EOL;\n}\n```"]}
