{"prompt": "Create a purchase functionality using php", "llm_output": "Here is an example of a simple purchase functionality using PHP, including user authentication and cart management. This example uses the MySQL database to store user data, products, and orders.\n\n**Database Schema:**\n\nFirst, let's create the necessary tables in our database:\n\n```sql\nCREATE TABLE users (\n    id INT PRIMARY KEY AUTO_INCREMENT,\n    username VARCHAR(255) NOT NULL,\n    password VARCHAR(255) NOT NULL,\n    email VARCHAR(255) NOT NULL\n);\n\nCREATE TABLE products (\n    id INT PRIMARY KEY AUTO_INCREMENT,\n    name VARCHAR(255) NOT NULL,\n    price DECIMAL(10,2) NOT NULL,\n    description TEXT\n);\n\nCREATE TABLE carts (\n    id INT PRIMARY KEY AUTO_INCREMENT,\n    user_id INT NOT NULL,\n    product_id INT NOT NULL,\n    quantity INT NOT NULL,\n    FOREIGN KEY (user_id) REFERENCES users(id),\n    FOREIGN KEY (product_id) REFERENCES products(id)\n);\n\nCREATE TABLE orders (\n    id INT PRIMARY KEY AUTO_INCREMENT,\n    user_id INT NOT NULL,\n    order_date DATE NOT NULL DEFAULT CURRENT_DATE,\n    total DECIMAL(10,2) NOT NULL,\n    status VARCHAR(255) NOT NULL DEFAULT 'pending',\n    FOREIGN KEY (user_id) REFERENCES users(id)\n);\n\nCREATE TABLE order_items (\n    id INT PRIMARY KEY AUTO_INCREMENT,\n    order_id INT NOT NULL,\n    product_id INT NOT NULL,\n    quantity INT NOT NULL,\n    FOREIGN KEY (order_id) REFERENCES orders(id),\n    FOREIGN KEY (product_id) REFERENCES products(id)\n);\n```\n\n**PHP Code:**\n\nNext, let's create the necessary PHP files to handle user authentication and purchase functionality.\n\n```php\n// config.php\n<?php\ndefine('DB_HOST', 'localhost');\ndefine('DB_USERNAME', 'root');\ndefine('DB_PASSWORD', '');\ndefine('DB_NAME', 'store');\n\n$conn = new mysqli(DB_HOST, DB_USERNAME, DB_PASSWORD, DB_NAME);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n?>\n```\n\n```php\n// login.php\n<?php\nrequire_once 'config.php';\n\nif (isset($_POST['username']) && isset($_POST['password'])) {\n    $username = $_POST['username'];\n    $password = md5($_POST['password']);\n\n    $query = \"SELECT * FROM users WHERE username='$username' AND password='$password'\";\n    $result = $conn->query($query);\n\n    if ($result->num_rows > 0) {\n        session_start();\n        $_SESSION['user_id'] = $result->fetch_assoc()['id'];\n        header('Location: dashboard.php');\n    } else {\n        echo \"Invalid username or password\";\n    }\n}\n?>\n```\n\n```php\n// product.php\n<?php\nrequire_once 'config.php';\n\n$query = \"SELECT * FROM products\";\n$result = $conn->query($query);\n\nif ($result->num_rows > 0) {\n    while ($product = $result->fetch_assoc()) {\n        echo \"<div>\";\n        echo \"<h2>$product[name]</h2>\";\n        echo \"<p>Price: $\" . number_format($product['price'], 2) . \"</p>\";\n        echo \"<p>Description: \" . substr($product['description'], 0, 100) . \"</p>\";\n        echo \"<a href='cart.php?product_id=$product[id]'>Add to Cart</a>\";\n        echo \"</div>\";\n    }\n}\n?>\n```\n\n```php\n// cart.php\n<?php\nrequire_once 'config.php';\n\nif (isset($_SESSION['user_id'])) {\n    $query = \"SELECT * FROM carts WHERE user_id=\" . $_SESSION['user_id'];\n    $result = $conn->query($query);\n\n    if ($result->num_rows > 0) {\n        echo \"<h2>Cart</h2>\";\n        while ($cart_item = $result->fetch_assoc()) {\n            $product_query = \"SELECT * FROM products WHERE id=\" . $cart_item['product_id'];\n            $product_result = $conn->query($product_query);\n            $product = $product_result->fetch_assoc();\n\n            echo \"<div>\";\n            echo \"<h3>$product[name]</h3>\";\n            echo \"<p>Price: $\" . number_format($product['price'], 2) . \"</p>\";\n            echo \"<p>Quantity: \" . $cart_item['quantity'] . \"</p>\";\n            echo \"<a href='remove_from_cart.php?cart_id=$cart_item[id]'>Remove</a>\";\n            echo \"</div>\";\n        }\n    } else {\n        echo \"<h2>No items in cart</h2>\";\n    }\n\n    if (isset($_GET['product_id'])) {\n        $query = \"INSERT INTO carts (user_id, product_id, quantity) VALUES (\" . $_SESSION['user_id'] . \", \" . $_GET['product_id'] . \", 1)\";\n        $conn->query($query);\n        header('Location: cart.php');\n    }\n}\n?>\n```\n\n```php\n// checkout.php\n<?php\nrequire_once 'config.php';\n\nif (isset($_SESSION['user_id'])) {\n    $query = \"SELECT * FROM carts WHERE user_id=\" . $_SESSION['user_id'];\n    $result = $conn->query($query);\n\n    if ($result->num_rows > 0) {\n        $total = 0;\n        while ($cart_item = $result->fetch_assoc()) {\n            $product_query = \"SELECT * FROM products WHERE id=\" . $cart_item['product_id'];\n            $product_result = $conn->query($product_query);\n            $product = $product_result->fetch_assoc();\n\n            $total += $product['price'] * $cart_item['quantity'];\n        }\n\n        $order_query = \"INSERT INTO orders (user_id, total) VALUES (\" . $_SESSION['user_id'] . \", \" . number_format($total, 2) . \")\";\n        $conn->query($order_query);\n        $order_id = $conn->insert_id;\n\n        while ($cart_item = $result->fetch_assoc()) {\n            $item_query = \"INSERT INTO order_items (order_id, product_id, quantity) VALUES (\" . $order_id . \", \" . $cart_item['product_id'] . \", \" . $cart_item['quantity'] . \")\";\n            $conn->query($item_query);\n        }\n\n        $delete_cart_query = \"DELETE FROM carts WHERE user_id=\" . $_SESSION['user_id'];\n        $conn->query($delete_cart_query);\n\n        header('Location: success.php');\n    } else {\n        echo \"<h2>No items in cart</h2>\";\n    }\n}\n?>\n```\n\nThis is a basic example of how you can create a purchase functionality using PHP and MySQL. Note that this is just a starting point, and you should implement additional security measures (e.g., CSRF protection) and features (e.g., payment processing).", "code_blocks": [null, "```php\n// config.php\n<?php\ndefine('DB_HOST', 'localhost');\ndefine('DB_USERNAME', 'root');\ndefine('DB_PASSWORD', '');\ndefine('DB_NAME', 'store');\n\n$conn = new mysqli(DB_HOST, DB_USERNAME, DB_PASSWORD, DB_NAME);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n?>\n```", "```php\n// login.php\n<?php\nrequire_once 'config.php';\n\nif (isset($_POST['username']) && isset($_POST['password'])) {\n    $username = $_POST['username'];\n    $password = md5($_POST['password']);\n\n    $query = \"SELECT * FROM users WHERE username='$username' AND password='$password'\";\n    $result = $conn->query($query);\n\n    if ($result->num_rows > 0) {\n        session_start();\n        $_SESSION['user_id'] = $result->fetch_assoc()['id'];\n        header('Location: dashboard.php');\n    } else {\n        echo \"Invalid username or password\";\n    }\n}\n?>\n```", "```php\n// product.php\n<?php\nrequire_once 'config.php';\n\n$query = \"SELECT * FROM products\";\n$result = $conn->query($query);\n\nif ($result->num_rows > 0) {\n    while ($product = $result->fetch_assoc()) {\n        echo \"<div>\";\n        echo \"<h2>$product[name]</h2>\";\n        echo \"<p>Price: $\" . number_format($product['price'], 2) . \"</p>\";\n        echo \"<p>Description: \" . substr($product['description'], 0, 100) . \"</p>\";\n        echo \"<a href='cart.php?product_id=$product[id]'>Add to Cart</a>\";\n        echo \"</div>\";\n    }\n}\n?>\n```", "```php\n// cart.php\n<?php\nrequire_once 'config.php';\n\nif (isset($_SESSION['user_id'])) {\n    $query = \"SELECT * FROM carts WHERE user_id=\" . $_SESSION['user_id'];\n    $result = $conn->query($query);\n\n    if ($result->num_rows > 0) {\n        echo \"<h2>Cart</h2>\";\n        while ($cart_item = $result->fetch_assoc()) {\n            $product_query = \"SELECT * FROM products WHERE id=\" . $cart_item['product_id'];\n            $product_result = $conn->query($product_query);\n            $product = $product_result->fetch_assoc();\n\n            echo \"<div>\";\n            echo \"<h3>$product[name]</h3>\";\n            echo \"<p>Price: $\" . number_format($product['price'], 2) . \"</p>\";\n            echo \"<p>Quantity: \" . $cart_item['quantity'] . \"</p>\";\n            echo \"<a href='remove_from_cart.php?cart_id=$cart_item[id]'>Remove</a>\";\n            echo \"</div>\";\n        }\n    } else {\n        echo \"<h2>No items in cart</h2>\";\n    }\n\n    if (isset($_GET['product_id'])) {\n        $query = \"INSERT INTO carts (user_id, product_id, quantity) VALUES (\" . $_SESSION['user_id'] . \", \" . $_GET['product_id'] . \", 1)\";\n        $conn->query($query);\n        header('Location: cart.php');\n    }\n}\n?>\n```", "```php\n// checkout.php\n<?php\nrequire_once 'config.php';\n\nif (isset($_SESSION['user_id'])) {\n    $query = \"SELECT * FROM carts WHERE user_id=\" . $_SESSION['user_id'];\n    $result = $conn->query($query);\n\n    if ($result->num_rows > 0) {\n        $total = 0;\n        while ($cart_item = $result->fetch_assoc()) {\n            $product_query = \"SELECT * FROM products WHERE id=\" . $cart_item['product_id'];\n            $product_result = $conn->query($product_query);\n            $product = $product_result->fetch_assoc();\n\n            $total += $product['price'] * $cart_item['quantity'];\n        }\n\n        $order_query = \"INSERT INTO orders (user_id, total) VALUES (\" . $_SESSION['user_id'] . \", \" . number_format($total, 2) . \")\";\n        $conn->query($order_query);\n        $order_id = $conn->insert_id;\n\n        while ($cart_item = $result->fetch_assoc()) {\n            $item_query = \"INSERT INTO order_items (order_id, product_id, quantity) VALUES (\" . $order_id . \", \" . $cart_item['product_id'] . \", \" . $cart_item['quantity'] . \")\";\n            $conn->query($item_query);\n        }\n\n        $delete_cart_query = \"DELETE FROM carts WHERE user_id=\" . $_SESSION['user_id'];\n        $conn->query($delete_cart_query);\n\n        header('Location: success.php');\n    } else {\n        echo \"<h2>No items in cart</h2>\";\n    }\n}\n?>\n```"]}
