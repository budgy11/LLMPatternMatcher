{"prompt": "Create a purchase functionality using php", "llm_output": "Here is an example of a simple purchase functionality using PHP, HTML, and MySQL:\n\n**Database Setup**\n\nFirst, let's create a table in our database to store the products and their prices.\n\n```sql\nCREATE TABLE products (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  name VARCHAR(255),\n  price DECIMAL(10,2)\n);\n\nCREATE TABLE orders (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  customer_name VARCHAR(255),\n  total_cost DECIMAL(10,2),\n  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n);\n\nCREATE TABLE order_items (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  order_id INT,\n  product_id INT,\n  quantity INT,\n  FOREIGN KEY (order_id) REFERENCES orders(id),\n  FOREIGN KEY (product_id) REFERENCES products(id)\n);\n```\n\n**PHP Code**\n\nWe'll create a `purchase.php` file to handle the purchase functionality.\n\n```php\n<?php\n\n// Configuration\ndefine('DB_HOST', 'localhost');\ndefine('DB_USERNAME', 'your_username');\ndefine('DB_PASSWORD', 'your_password');\ndefine('DB_NAME', 'your_database');\n\n// Connect to database\n$mysqli = new mysqli(DB_HOST, DB_USERNAME, DB_PASSWORD, DB_NAME);\n\n// Check connection\nif ($mysqli->connect_errno) {\n    echo \"Failed to connect to MySQL: (\" . $mysqli->connect_errno . \") \" . $mysqli->connect_error;\n}\n\n// Function to add product to cart\nfunction add_to_cart($product_id, $quantity) {\n    // Get product details\n    $query = \"SELECT price FROM products WHERE id = '$product_id'\";\n    $result = $mysqli->query($query);\n    $row = $result->fetch_assoc();\n    $price = $row['price'];\n\n    // Add to cart\n    $query = \"INSERT INTO order_items (order_id, product_id, quantity) VALUES ('', '$product_id', '$quantity')\";\n    $mysqli->query($query);\n\n    // Update total cost in orders table\n    $query = \"UPDATE orders SET total_cost = total_cost + ($price * $quantity) WHERE id = (SELECT MAX(id) FROM orders)\";\n    $mysqli->query($query);\n}\n\n// Function to checkout\nfunction checkout() {\n    // Get order details\n    $query = \"SELECT * FROM orders WHERE id = (SELECT MAX(id) FROM orders)\";\n    $result = $mysqli->query($query);\n    $row = $result->fetch_assoc();\n\n    // Remove items from cart\n    $query = \"DELETE FROM order_items WHERE order_id = '\" . $row['id'] . \"'\";\n    $mysqli->query($query);\n\n    // Insert new order\n    $query = \"INSERT INTO orders (customer_name, total_cost) VALUES ('\" . $_POST['name'] . \"', \" . $row['total_cost'] . \")\";\n    $mysqli->query($query);\n}\n\n// Add product to cart\nif ($_SERVER['REQUEST_METHOD'] == 'GET') {\n    if (isset($_GET['product_id']) && isset($_GET['quantity'])) {\n        add_to_cart($_GET['product_id'], $_GET['quantity']);\n        header('Location: purchase.php');\n        exit;\n    }\n}\n\n// Checkout\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n    checkout();\n    header('Location: thank_you.php');\n    exit;\n}\n?>\n```\n\n**HTML Code**\n\nWe'll create a `purchase.html` file to display the form for adding products to cart.\n\n```html\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Purchase</title>\n</head>\n<body>\n    <h1>Purchase</h1>\n\n    <?php if (isset($_GET['error'])) { ?>\n        <p style=\"color: red;\"><?php echo $_GET['error']; ?></p>\n    <?php } ?>\n\n    <form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"get\">\n        <label for=\"product_id\">Product ID:</label>\n        <input type=\"text\" id=\"product_id\" name=\"product_id\"><br><br>\n\n        <label for=\"quantity\">Quantity:</label>\n        <input type=\"number\" id=\"quantity\" name=\"quantity\"><br><br>\n\n        <input type=\"submit\" value=\"Add to Cart\">\n    </form>\n\n    <p>Total Cost: <?php echo $_SESSION['total_cost']; ?></p>\n\n    <form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\">\n        <label for=\"name\">Name:</label>\n        <input type=\"text\" id=\"name\" name=\"name\"><br><br>\n\n        <input type=\"submit\" value=\"Checkout\">\n    </form>\n</body>\n</html>\n```\n\n**Note:**\n\n*   This is a basic example of a purchase functionality and may not cover all the edge cases.\n*   You should never directly insert user input into your database queries, but instead use prepared statements to avoid SQL injection attacks.\n*   Always validate user input on both the client-side (using JavaScript) and server-side (using PHP) for additional security.\n\nPlease make sure to replace `your_username`, `your_password` and `your_database` with your actual MySQL credentials. \n\nAlso note that this example does not cover all aspects of a real-world e-commerce system, but it should give you an idea how the purchase functionality could be implemented using PHP and MySQL.", "code_blocks": [null, "```php\n<?php\n\n// Configuration\ndefine('DB_HOST', 'localhost');\ndefine('DB_USERNAME', 'your_username');\ndefine('DB_PASSWORD', 'your_password');\ndefine('DB_NAME', 'your_database');\n\n// Connect to database\n$mysqli = new mysqli(DB_HOST, DB_USERNAME, DB_PASSWORD, DB_NAME);\n\n// Check connection\nif ($mysqli->connect_errno) {\n    echo \"Failed to connect to MySQL: (\" . $mysqli->connect_errno . \") \" . $mysqli->connect_error;\n}\n\n// Function to add product to cart\nfunction add_to_cart($product_id, $quantity) {\n    // Get product details\n    $query = \"SELECT price FROM products WHERE id = '$product_id'\";\n    $result = $mysqli->query($query);\n    $row = $result->fetch_assoc();\n    $price = $row['price'];\n\n    // Add to cart\n    $query = \"INSERT INTO order_items (order_id, product_id, quantity) VALUES ('', '$product_id', '$quantity')\";\n    $mysqli->query($query);\n\n    // Update total cost in orders table\n    $query = \"UPDATE orders SET total_cost = total_cost + ($price * $quantity) WHERE id = (SELECT MAX(id) FROM orders)\";\n    $mysqli->query($query);\n}\n\n// Function to checkout\nfunction checkout() {\n    // Get order details\n    $query = \"SELECT * FROM orders WHERE id = (SELECT MAX(id) FROM orders)\";\n    $result = $mysqli->query($query);\n    $row = $result->fetch_assoc();\n\n    // Remove items from cart\n    $query = \"DELETE FROM order_items WHERE order_id = '\" . $row['id'] . \"'\";\n    $mysqli->query($query);\n\n    // Insert new order\n    $query = \"INSERT INTO orders (customer_name, total_cost) VALUES ('\" . $_POST['name'] . \"', \" . $row['total_cost'] . \")\";\n    $mysqli->query($query);\n}\n\n// Add product to cart\nif ($_SERVER['REQUEST_METHOD'] == 'GET') {\n    if (isset($_GET['product_id']) && isset($_GET['quantity'])) {\n        add_to_cart($_GET['product_id'], $_GET['quantity']);\n        header('Location: purchase.php');\n        exit;\n    }\n}\n\n// Checkout\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n    checkout();\n    header('Location: thank_you.php');\n    exit;\n}\n?>\n```", null]}
