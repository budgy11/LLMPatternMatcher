{"prompt": "Create a purchase functionality using php", "llm_output": "Here is an example of a basic purchase functionality in PHP. This will create a simple shopping cart and allow users to add items, remove items, and check out.\n\n**Note:** This is a simplified version and doesn't include any security measures like authentication or validation for demonstration purposes only.\n\n### Database Schema\n\nLet's assume we have the following database tables:\n\n```sql\nCREATE TABLE products (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  name VARCHAR(255) NOT NULL,\n  price DECIMAL(10,2) NOT NULL\n);\n\nCREATE TABLE carts (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  user_id INT,\n  FOREIGN KEY (user_id) REFERENCES users(id)\n);\n\nCREATE TABLE cart_items (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  cart_id INT,\n  product_id INT,\n  quantity INT DEFAULT 1,\n  FOREIGN KEY (cart_id) REFERENCES carts(id),\n  FOREIGN KEY (product_id) REFERENCES products(id)\n);\n```\n\n### PHP Code\n\n**includes/config.php**\n\n```php\n// Database connection settings\n$db_host = 'localhost';\n$db_username = 'root';\n$db_password = '';\n$db_name = 'shop';\n\n// Connect to database\n$conn = new mysqli($db_host, $db_username, $db_password, $db_name);\n```\n\n**includes/functions.php**\n\n```php\nfunction getProducts() {\n  global $conn;\n  $query = \"SELECT * FROM products\";\n  return $result = $conn->query($query)->fetch_all(MYSQLI_ASSOC);\n}\n\nfunction addProductToCart($product_id, $cart_id) {\n  global $conn;\n  $query = \"INSERT INTO cart_items (product_id, cart_id) VALUES (?, ?)\";\n  return $conn->prepare($query)->execute([$product_id, $cart_id]);\n}\n\nfunction removeItemFromCart($item_id) {\n  global $conn;\n  $query = \"DELETE FROM cart_items WHERE id = ?\";\n  return $conn->prepare($query)->execute([$item_id]);\n}\n```\n\n**index.php**\n\n```php\n<?php include 'includes/config.php'; ?>\n<?php include 'includes/functions.php'; ?>\n\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <title>Shopping Cart</title>\n</head>\n<body>\n\n  <!-- Display products -->\n  <?php foreach (getProducts() as $product) : ?>\n    <p>\n      <a href=\"?add-to-cart=<?= $product['id'] ?>\">\n        <?= $product['name'] ?> ($<?= number_format($product['price'], 2) ?>)\n      </a>\n    </p>\n  <?php endforeach; ?>\n\n  <!-- Display cart -->\n  <?php if (isset($_GET['cart_id'])) : ?>\n    <h2>Shopping Cart</h2>\n\n    <?php $cartId = $_GET['cart_id']; ?>\n    <?php foreach (getProducts() as $product) : ?>\n      <?php $count = count(cartItemsByProduct($product['id'], $cartId)); ?>\n      <?php if ($count > 0) : ?>\n        <p>\n          <?= $product['name'] ?> x<?= $count ?> ($<?= number_format(count($count) * $product['price'], 2) ?>)\n        </p>\n      <?php endif; ?>\n    <?php endforeach; ?>\n\n    <!-- Add to cart form -->\n    <form action=\"\" method=\"post\">\n      <input type=\"hidden\" name=\"cart_id\" value=\"<?= $_GET['cart_id'] ?>\">\n      <select name=\"product_id\">\n        <?php foreach (getProducts() as $product) : ?>\n          <option value=\"<?= $product['id'] ?>\">\n            <?= $product['name'] ?> ($<?= number_format($product['price'], 2) ?>)\n          </option>\n        <?php endforeach; ?>\n      </select>\n      <input type=\"submit\" name=\"add-to-cart\" value=\"Add to Cart\">\n    </form>\n\n    <!-- Remove item form -->\n    <?php if (isset($_GET['remove-item'])) : ?>\n      <p>Removing <?= $_GET['product_id'] ?> from cart...</p>\n      <?php removeItemFromCart($_GET['product_id']); ?>\n    <?php endif; ?>\n\n  <?php endif; ?>\n\n</body>\n</html>\n\n<?php\nif ($_SERVER['REQUEST_METHOD'] === 'POST') {\n  if (isset($_POST['add-to-cart'])) {\n    addProductToCart($_POST['product_id'], $_GET['cart_id']);\n  } elseif (isset($_POST['cart_id'])) {\n    // Create cart if it doesn't exist\n    $query = \"INSERT INTO carts (user_id) VALUES (?)\";\n    $conn->prepare($query)->execute([$_SESSION['user_id']]);\n  }\n}\n```\n\nThis is a basic example and may need to be modified to fit your specific use case.", "code_blocks": [null, "```php\n// Database connection settings\n$db_host = 'localhost';\n$db_username = 'root';\n$db_password = '';\n$db_name = 'shop';\n\n// Connect to database\n$conn = new mysqli($db_host, $db_username, $db_password, $db_name);\n```", "```php\nfunction getProducts() {\n  global $conn;\n  $query = \"SELECT * FROM products\";\n  return $result = $conn->query($query)->fetch_all(MYSQLI_ASSOC);\n}\n\nfunction addProductToCart($product_id, $cart_id) {\n  global $conn;\n  $query = \"INSERT INTO cart_items (product_id, cart_id) VALUES (?, ?)\";\n  return $conn->prepare($query)->execute([$product_id, $cart_id]);\n}\n\nfunction removeItemFromCart($item_id) {\n  global $conn;\n  $query = \"DELETE FROM cart_items WHERE id = ?\";\n  return $conn->prepare($query)->execute([$item_id]);\n}\n```", "```php\n<?php include 'includes/config.php'; ?>\n<?php include 'includes/functions.php'; ?>\n\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <title>Shopping Cart</title>\n</head>\n<body>\n\n  <!-- Display products -->\n  <?php foreach (getProducts() as $product) : ?>\n    <p>\n      <a href=\"?add-to-cart=<?= $product['id'] ?>\">\n        <?= $product['name'] ?> ($<?= number_format($product['price'], 2) ?>)\n      </a>\n    </p>\n  <?php endforeach; ?>\n\n  <!-- Display cart -->\n  <?php if (isset($_GET['cart_id'])) : ?>\n    <h2>Shopping Cart</h2>\n\n    <?php $cartId = $_GET['cart_id']; ?>\n    <?php foreach (getProducts() as $product) : ?>\n      <?php $count = count(cartItemsByProduct($product['id'], $cartId)); ?>\n      <?php if ($count > 0) : ?>\n        <p>\n          <?= $product['name'] ?> x<?= $count ?> ($<?= number_format(count($count) * $product['price'], 2) ?>)\n        </p>\n      <?php endif; ?>\n    <?php endforeach; ?>\n\n    <!-- Add to cart form -->\n    <form action=\"\" method=\"post\">\n      <input type=\"hidden\" name=\"cart_id\" value=\"<?= $_GET['cart_id'] ?>\">\n      <select name=\"product_id\">\n        <?php foreach (getProducts() as $product) : ?>\n          <option value=\"<?= $product['id'] ?>\">\n            <?= $product['name'] ?> ($<?= number_format($product['price'], 2) ?>)\n          </option>\n        <?php endforeach; ?>\n      </select>\n      <input type=\"submit\" name=\"add-to-cart\" value=\"Add to Cart\">\n    </form>\n\n    <!-- Remove item form -->\n    <?php if (isset($_GET['remove-item'])) : ?>\n      <p>Removing <?= $_GET['product_id'] ?> from cart...</p>\n      <?php removeItemFromCart($_GET['product_id']); ?>\n    <?php endif; ?>\n\n  <?php endif; ?>\n\n</body>\n</html>\n\n<?php\nif ($_SERVER['REQUEST_METHOD'] === 'POST') {\n  if (isset($_POST['add-to-cart'])) {\n    addProductToCart($_POST['product_id'], $_GET['cart_id']);\n  } elseif (isset($_POST['cart_id'])) {\n    // Create cart if it doesn't exist\n    $query = \"INSERT INTO carts (user_id) VALUES (?)\";\n    $conn->prepare($query)->execute([$_SESSION['user_id']]);\n  }\n}\n```"]}
