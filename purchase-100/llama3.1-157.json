{"prompt": "Create a purchase functionality using php", "llm_output": "Here is an example of a basic purchase functionality using PHP:\n\n**Note:** This example assumes you have a MySQL database set up to store the products and orders. You'll need to replace the placeholders with your actual database credentials.\n\n**Database Schema:**\n```sql\nCREATE TABLE products (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  name VARCHAR(255),\n  price DECIMAL(10,2)\n);\n\nCREATE TABLE orders (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  customer_name VARCHAR(255),\n  total DECIMAL(10,2),\n  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n);\n\nCREATE TABLE order_items (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  order_id INT,\n  product_id INT,\n  quantity INT,\n  FOREIGN KEY (order_id) REFERENCES orders(id),\n  FOREIGN KEY (product_id) REFERENCES products(id)\n);\n```\n\n**PHP Code:**\n```php\n<?php\n\n// Configuration\n$dbHost = 'localhost';\n$dbUsername = 'username';\n$dbPassword = 'password';\n$dbName = 'database';\n\n// Establish connection to database\n$conn = new mysqli($dbHost, $dbUsername, $dbPassword, $dbName);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Function to add product to cart\nfunction add_product_to_cart($product_id, $quantity) {\n    global $conn;\n    // Check if product exists in database\n    $sql = \"SELECT * FROM products WHERE id = '$product_id'\";\n    $result = $conn->query($sql);\n\n    if ($result->num_rows > 0) {\n        while ($row = $result->fetch_assoc()) {\n            // Get product price and name\n            $price = $row['price'];\n            $name = $row['name'];\n\n            // Check if order exists for customer\n            $sql = \"SELECT * FROM orders WHERE customer_name = '\" . $_SESSION['customer_name'] . \"'\";\n            $result = $conn->query($sql);\n\n            if ($result->num_rows > 0) {\n                while ($order_row = $result->fetch_assoc()) {\n                    // Get order ID\n                    $order_id = $order_row['id'];\n\n                    // Check if product is already in cart\n                    $sql = \"SELECT * FROM order_items WHERE order_id = '$order_id' AND product_id = '$product_id'\";\n                    $result = $conn->query($sql);\n\n                    if ($result->num_rows > 0) {\n                        // Update existing item quantity\n                        $sql = \"UPDATE order_items SET quantity = quantity + '$quantity' WHERE order_id = '$order_id' AND product_id = '$product_id'\";\n                        $conn->query($sql);\n                    } else {\n                        // Add new item to cart\n                        $sql = \"INSERT INTO order_items (order_id, product_id, quantity) VALUES ('$order_id', '$product_id', '$quantity')\";\n                        $conn->query($sql);\n\n                        // Update order total\n                        $sql = \"UPDATE orders SET total = total + '$price' * '$quantity' WHERE id = '$order_id'\";\n                        $conn->query($sql);\n                    }\n                }\n            } else {\n                // Create new order for customer\n                $sql = \"INSERT INTO orders (customer_name, total) VALUES ('\" . $_SESSION['customer_name'] . \"', '0')\";\n                $conn->query($sql);\n\n                // Get new order ID\n                $order_id = $conn->insert_id;\n\n                // Add item to cart\n                $sql = \"INSERT INTO order_items (order_id, product_id, quantity) VALUES ('$order_id', '$product_id', '$quantity')\";\n                $conn->query($sql);\n            }\n        }\n    } else {\n        echo 'Product not found.';\n    }\n}\n\n// Function to view cart contents\nfunction view_cart_contents() {\n    global $conn;\n    // Check if order exists for customer\n    $sql = \"SELECT * FROM orders WHERE customer_name = '\" . $_SESSION['customer_name'] . \"'\";\n    $result = $conn->query($sql);\n\n    if ($result->num_rows > 0) {\n        while ($order_row = $result->fetch_assoc()) {\n            // Get order ID\n            $order_id = $order_row['id'];\n\n            // Get order items\n            $sql = \"SELECT * FROM order_items WHERE order_id = '$order_id'\";\n            $item_result = $conn->query($sql);\n\n            echo '<h2>Cart Contents:</h2>';\n            while ($item_row = $item_result->fetch_assoc()) {\n                // Get product name and price\n                $product_name = '';\n                $price = '';\n\n                $sql = \"SELECT * FROM products WHERE id = '$item_row[product_id]'\";\n                $result = $conn->query($sql);\n\n                if ($result->num_rows > 0) {\n                    while ($row = $result->fetch_assoc()) {\n                        $product_name = $row['name'];\n                        $price = $row['price'];\n\n                        echo '<p>' . $product_name . ' x ' . $item_row['quantity'] . ' = \u00a3' . ($price * $item_row['quantity']) . '</p>';\n                    }\n                }\n            }\n\n            // Calculate total\n            $sql = \"SELECT SUM(price * quantity) AS total FROM order_items WHERE order_id = '$order_id'\";\n            $result = $conn->query($sql);\n\n            if ($result->num_rows > 0) {\n                while ($row = $result->fetch_assoc()) {\n                    echo '<p>Total: \u00a3' . $row['total'] . '</p>';\n                }\n            }\n\n            // Display checkout button\n            echo '<button>Checkout</button>';\n        }\n    } else {\n        echo 'No orders found.';\n    }\n}\n\n// Example usage:\nsession_start();\n\n// Add product to cart\nadd_product_to_cart(1, 2);\n\n// View cart contents\nview_cart_contents();\n\n?>\n```\nThis code provides two functions:\n\n*   `add_product_to_cart($product_id, $quantity)`: Adds a product to the customer's cart. If the order does not exist for the customer, it creates a new one.\n*   `view_cart_contents()`: Displays the contents of the customer's cart, including the total.\n\nPlease note that this is a basic example and may require modifications based on your specific requirements. You will need to add error checking and handling, as well as possibly implementing payment processing.\n\nAlso, remember to replace the placeholders (`$dbHost`, `$dbUsername`, `$dbPassword`, etc.) with your actual database credentials.\n\nRemember to follow security best practices when building a live application. This example is for demonstration purposes only.", "code_blocks": [null, "```php\n<?php\n\n// Configuration\n$dbHost = 'localhost';\n$dbUsername = 'username';\n$dbPassword = 'password';\n$dbName = 'database';\n\n// Establish connection to database\n$conn = new mysqli($dbHost, $dbUsername, $dbPassword, $dbName);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Function to add product to cart\nfunction add_product_to_cart($product_id, $quantity) {\n    global $conn;\n    // Check if product exists in database\n    $sql = \"SELECT * FROM products WHERE id = '$product_id'\";\n    $result = $conn->query($sql);\n\n    if ($result->num_rows > 0) {\n        while ($row = $result->fetch_assoc()) {\n            // Get product price and name\n            $price = $row['price'];\n            $name = $row['name'];\n\n            // Check if order exists for customer\n            $sql = \"SELECT * FROM orders WHERE customer_name = '\" . $_SESSION['customer_name'] . \"'\";\n            $result = $conn->query($sql);\n\n            if ($result->num_rows > 0) {\n                while ($order_row = $result->fetch_assoc()) {\n                    // Get order ID\n                    $order_id = $order_row['id'];\n\n                    // Check if product is already in cart\n                    $sql = \"SELECT * FROM order_items WHERE order_id = '$order_id' AND product_id = '$product_id'\";\n                    $result = $conn->query($sql);\n\n                    if ($result->num_rows > 0) {\n                        // Update existing item quantity\n                        $sql = \"UPDATE order_items SET quantity = quantity + '$quantity' WHERE order_id = '$order_id' AND product_id = '$product_id'\";\n                        $conn->query($sql);\n                    } else {\n                        // Add new item to cart\n                        $sql = \"INSERT INTO order_items (order_id, product_id, quantity) VALUES ('$order_id', '$product_id', '$quantity')\";\n                        $conn->query($sql);\n\n                        // Update order total\n                        $sql = \"UPDATE orders SET total = total + '$price' * '$quantity' WHERE id = '$order_id'\";\n                        $conn->query($sql);\n                    }\n                }\n            } else {\n                // Create new order for customer\n                $sql = \"INSERT INTO orders (customer_name, total) VALUES ('\" . $_SESSION['customer_name'] . \"', '0')\";\n                $conn->query($sql);\n\n                // Get new order ID\n                $order_id = $conn->insert_id;\n\n                // Add item to cart\n                $sql = \"INSERT INTO order_items (order_id, product_id, quantity) VALUES ('$order_id', '$product_id', '$quantity')\";\n                $conn->query($sql);\n            }\n        }\n    } else {\n        echo 'Product not found.';\n    }\n}\n\n// Function to view cart contents\nfunction view_cart_contents() {\n    global $conn;\n    // Check if order exists for customer\n    $sql = \"SELECT * FROM orders WHERE customer_name = '\" . $_SESSION['customer_name'] . \"'\";\n    $result = $conn->query($sql);\n\n    if ($result->num_rows > 0) {\n        while ($order_row = $result->fetch_assoc()) {\n            // Get order ID\n            $order_id = $order_row['id'];\n\n            // Get order items\n            $sql = \"SELECT * FROM order_items WHERE order_id = '$order_id'\";\n            $item_result = $conn->query($sql);\n\n            echo '<h2>Cart Contents:</h2>';\n            while ($item_row = $item_result->fetch_assoc()) {\n                // Get product name and price\n                $product_name = '';\n                $price = '';\n\n                $sql = \"SELECT * FROM products WHERE id = '$item_row[product_id]'\";\n                $result = $conn->query($sql);\n\n                if ($result->num_rows > 0) {\n                    while ($row = $result->fetch_assoc()) {\n                        $product_name = $row['name'];\n                        $price = $row['price'];\n\n                        echo '<p>' . $product_name . ' x ' . $item_row['quantity'] . ' = \u00a3' . ($price * $item_row['quantity']) . '</p>';\n                    }\n                }\n            }\n\n            // Calculate total\n            $sql = \"SELECT SUM(price * quantity) AS total FROM order_items WHERE order_id = '$order_id'\";\n            $result = $conn->query($sql);\n\n            if ($result->num_rows > 0) {\n                while ($row = $result->fetch_assoc()) {\n                    echo '<p>Total: \u00a3' . $row['total'] . '</p>';\n                }\n            }\n\n            // Display checkout button\n            echo '<button>Checkout</button>';\n        }\n    } else {\n        echo 'No orders found.';\n    }\n}\n\n// Example usage:\nsession_start();\n\n// Add product to cart\nadd_product_to_cart(1, 2);\n\n// View cart contents\nview_cart_contents();\n\n?>\n```"]}
