{"prompt": "Create a purchase functionality using php", "llm_output": "Here's an example of how to create a basic purchase functionality in PHP. This will be a simplified version and you should consider implementing additional security measures like input validation, error handling, and database sanitization.\n\n**Database Setup**\n\nWe'll assume you have a MySQL database with the following schema:\n\n```sql\nCREATE TABLE products (\n    id INT PRIMARY KEY AUTO_INCREMENT,\n    name VARCHAR(255),\n    price DECIMAL(10, 2)\n);\n\nCREATE TABLE orders (\n    id INT PRIMARY KEY AUTO_INCREMENT,\n    customer_name VARCHAR(255),\n    order_date DATE,\n    total DECIMAL(10, 2)\n);\n\nCREATE TABLE order_items (\n    id INT PRIMARY KEY AUTO_INCREMENT,\n    order_id INT,\n    product_id INT,\n    quantity INT,\n    FOREIGN KEY (order_id) REFERENCES orders(id),\n    FOREIGN KEY (product_id) REFERENCES products(id)\n);\n```\n\n**PHP Code**\n\nCreate a new PHP file `purchase.php` in your project directory.\n\n```php\n<?php\n\n// Configuration\n$db_host = 'localhost';\n$db_username = 'your_username';\n$db_password = 'your_password';\n$db_name = 'your_database';\n\n// Connect to the database\n$conn = new mysqli($db_host, $db_username, $db_password, $db_name);\n\n// Check connection\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Function to add product to order\nfunction addProductToOrder($order_id, $product_id, $quantity) {\n    global $conn;\n    // Insert into order_items table\n    $sql = \"INSERT INTO order_items (order_id, product_id, quantity) VALUES (?, ?, ?)\";\n    $stmt = $conn->prepare($sql);\n    $stmt->bind_param(\"iii\", $order_id, $product_id, $quantity);\n    $stmt->execute();\n}\n\n// Function to calculate total\nfunction calculateTotal($order_id) {\n    global $conn;\n    // Calculate the total cost of the order\n    $sql = \"SELECT SUM(oi.quantity * p.price) AS total FROM order_items oi INNER JOIN products p ON oi.product_id = p.id WHERE oi.order_id = ?\";\n    $stmt = $conn->prepare($sql);\n    $stmt->bind_param(\"i\", $order_id);\n    $stmt->execute();\n    $result = $stmt->get_result();\n    return $result->fetch_assoc()[\"total\"];\n}\n\n// Function to place an order\nfunction placeOrder() {\n    global $conn;\n    // Get the customer details from the form\n    $customer_name = $_POST[\"customer_name\"];\n    $order_date = date(\"Y-m-d\");\n    \n    // Calculate the total cost of the order\n    $total = calculateTotal($_POST[\"order_id\"]);\n    \n    // Insert into orders table\n    $sql = \"INSERT INTO orders (customer_name, order_date, total) VALUES (?, ?, ?)\";\n    $stmt = $conn->prepare($sql);\n    $stmt->bind_param(\"ssd\", $customer_name, $order_date, $total);\n    $stmt->execute();\n    \n    // Get the ID of the newly inserted order\n    $new_order_id = $conn->insert_id;\n    \n    // Insert products into order_items table\n    foreach ($_POST[\"product_ids\"] as $key => $value) {\n        addProductToOrder($new_order_id, $value, $_POST[\"quantities\"][$key]);\n    }\n}\n\n// Handle form submission\nif (isset($_POST[\"place_order\"])) {\n    placeOrder();\n}\n\n?>\n```\n\n**HTML Form**\n\nCreate a new file `purchase.html` in your project directory.\n\n```html\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Purchase</title>\n</head>\n<body>\n    <h1>Purchase</h1>\n    \n    <form action=\"purchase.php\" method=\"post\">\n        <label>Customer Name:</label>\n        <input type=\"text\" name=\"customer_name\"><br><br>\n        \n        <label>Order ID:</label>\n        <input type=\"hidden\" name=\"order_id\" value=\"1\"> <!-- This can be a dropdown or input field -->\n        \n        <h2>Products:</h2>\n        <?php\n            // Fetch products from database\n            $sql = \"SELECT * FROM products\";\n            $result = $conn->query($sql);\n            while ($row = $result->fetch_assoc()) {\n                echo \"<input type='hidden' name='product_ids[]' value='\" . $row[\"id\"] . \"'>\";\n                echo \"<label>\" . $row[\"name\"] . \":</label>\";\n                echo \"<input type='number' name='quantities[]' min='1' value='1'>\";\n                echo \"<br><br>\";\n            }\n        ?>\n        \n        <button type=\"submit\" name=\"place_order\">Place Order</button>\n    </form>\n</body>\n</html>\n```\n\nThis code will allow users to select products, enter their customer details, and place an order. The order will be inserted into the database along with the corresponding order items.\n\nPlease note that this is a basic example and should not be used in production without proper security measures, error handling, and input validation.", "code_blocks": [null, "```php\n<?php\n\n// Configuration\n$db_host = 'localhost';\n$db_username = 'your_username';\n$db_password = 'your_password';\n$db_name = 'your_database';\n\n// Connect to the database\n$conn = new mysqli($db_host, $db_username, $db_password, $db_name);\n\n// Check connection\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Function to add product to order\nfunction addProductToOrder($order_id, $product_id, $quantity) {\n    global $conn;\n    // Insert into order_items table\n    $sql = \"INSERT INTO order_items (order_id, product_id, quantity) VALUES (?, ?, ?)\";\n    $stmt = $conn->prepare($sql);\n    $stmt->bind_param(\"iii\", $order_id, $product_id, $quantity);\n    $stmt->execute();\n}\n\n// Function to calculate total\nfunction calculateTotal($order_id) {\n    global $conn;\n    // Calculate the total cost of the order\n    $sql = \"SELECT SUM(oi.quantity * p.price) AS total FROM order_items oi INNER JOIN products p ON oi.product_id = p.id WHERE oi.order_id = ?\";\n    $stmt = $conn->prepare($sql);\n    $stmt->bind_param(\"i\", $order_id);\n    $stmt->execute();\n    $result = $stmt->get_result();\n    return $result->fetch_assoc()[\"total\"];\n}\n\n// Function to place an order\nfunction placeOrder() {\n    global $conn;\n    // Get the customer details from the form\n    $customer_name = $_POST[\"customer_name\"];\n    $order_date = date(\"Y-m-d\");\n    \n    // Calculate the total cost of the order\n    $total = calculateTotal($_POST[\"order_id\"]);\n    \n    // Insert into orders table\n    $sql = \"INSERT INTO orders (customer_name, order_date, total) VALUES (?, ?, ?)\";\n    $stmt = $conn->prepare($sql);\n    $stmt->bind_param(\"ssd\", $customer_name, $order_date, $total);\n    $stmt->execute();\n    \n    // Get the ID of the newly inserted order\n    $new_order_id = $conn->insert_id;\n    \n    // Insert products into order_items table\n    foreach ($_POST[\"product_ids\"] as $key => $value) {\n        addProductToOrder($new_order_id, $value, $_POST[\"quantities\"][$key]);\n    }\n}\n\n// Handle form submission\nif (isset($_POST[\"place_order\"])) {\n    placeOrder();\n}\n\n?>\n```", null]}
