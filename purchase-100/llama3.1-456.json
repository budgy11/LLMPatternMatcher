{"prompt": "Create a purchase functionality using php", "llm_output": "Here is an example of a basic purchase functionality in PHP:\n\n**purchase.php**\n```php\n<?php\n\n// Configuration settings\n$databaseHost = 'localhost';\n$databaseName = 'e-commerce';\n$databaseUsername = 'root';\n$databasePassword = '';\n\n// Connect to database\n$conn = new mysqli($databaseHost, $databaseUsername, $databasePassword, $databaseName);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Function to add product to cart\nfunction addToCart($productId, $quantity) {\n    global $conn;\n    \n    // Check if product exists in database\n    $query = \"SELECT * FROM products WHERE id = '$productId'\";\n    $result = $conn->query($query);\n    \n    if ($result->num_rows > 0) {\n        // Get product details\n        $productDetails = $result->fetch_assoc();\n        \n        // Check if product is already in cart\n        $cartQuery = \"SELECT * FROM cart WHERE productId = '$productId' AND userId = '\".$_SESSION['userId'].\"'\";\n        $cartResult = $conn->query($cartQuery);\n        \n        if ($cartResult->num_rows > 0) {\n            // Update quantity in cart\n            $updateQuantity = \"UPDATE cart SET quantity = quantity + '$quantity' WHERE productId = '$productId' AND userId = '\".$_SESSION['userId'].\"'\";\n            $conn->query($updateQuantity);\n        } else {\n            // Add product to cart\n            $addProductToCart = \"INSERT INTO cart (productId, userId, quantity) VALUES ('$productId', '\".$_SESSION['userId'].\"', '$quantity')\";\n            $conn->query($addProductToCart);\n        }\n    }\n}\n\n// Function to remove product from cart\nfunction removeFromCart($productId) {\n    global $conn;\n    \n    // Check if product exists in database\n    $query = \"SELECT * FROM products WHERE id = '$productId'\";\n    $result = $conn->query($query);\n    \n    if ($result->num_rows > 0) {\n        // Get product details\n        $productDetails = $result->fetch_assoc();\n        \n        // Check if product is in cart\n        $cartQuery = \"SELECT * FROM cart WHERE productId = '$productId' AND userId = '\".$_SESSION['userId'].\"'\";\n        $cartResult = $conn->query($cartQuery);\n        \n        if ($cartResult->num_rows > 0) {\n            // Remove product from cart\n            $removeProductFromCart = \"DELETE FROM cart WHERE productId = '$productId' AND userId = '\".$_SESSION['userId'].\"'\";\n            $conn->query($removeProductFromCart);\n        }\n    }\n}\n\n// Function to checkout\nfunction checkout() {\n    global $conn;\n    \n    // Get user ID from session\n    $userId = $_SESSION['userId'];\n    \n    // Check if cart is not empty\n    $cartQuery = \"SELECT * FROM cart WHERE userId = '$userId'\";\n    $cartResult = $conn->query($cartQuery);\n    \n    if ($cartResult->num_rows > 0) {\n        // Get product details from database\n        while ($row = $cartResult->fetch_assoc()) {\n            $productId = $row['productId'];\n            $quantity = $row['quantity'];\n            \n            // Update stock in products table\n            $updateStockQuery = \"UPDATE products SET quantity = quantity - '$quantity' WHERE id = '$productId'\";\n            $conn->query($updateStockQuery);\n        }\n        \n        // Insert order into database\n        $insertOrderQuery = \"INSERT INTO orders (userId, totalPrice) VALUES ('$userId', '0')\";\n        $conn->query($insertOrderQuery);\n        \n        // Get order ID from database\n        $orderIDQuery = \"SELECT id FROM orders WHERE userId = '$userId' ORDER BY id DESC LIMIT 1\";\n        $orderResult = $conn->query($orderIDQuery);\n        $orderID = $orderResult->fetch_assoc()['id'];\n        \n        // Insert order items into database\n        while ($row = $cartResult->fetch_assoc()) {\n            $productId = $row['productId'];\n            $quantity = $row['quantity'];\n            \n            $insertOrderItemQuery = \"INSERT INTO order_items (orderId, productId, quantity) VALUES ('$orderID', '$productId', '$quantity')\";\n            $conn->query($insertOrderItemQuery);\n        }\n        \n        // Update cart to reflect new status\n        $updateCartStatusQuery = \"UPDATE cart SET status = 'paid' WHERE userId = '$userId'\";\n        $conn->query($updateCartStatusQuery);\n    }\n}\n\n// Example usage\nif (isset($_POST['add_to_cart'])) {\n    $productId = $_POST['product_id'];\n    $quantity = $_POST['quantity'];\n    \n    addToCart($productId, $quantity);\n} elseif (isset($_POST['remove_from_cart'])) {\n    $productId = $_POST['product_id'];\n    \n    removeFromCart($productId);\n} elseif (isset($_POST['checkout'])) {\n    checkout();\n}\n\n?>\n```\n**Note:** This is a basic example and you should modify it to fit your specific requirements. You will also need to create the necessary database tables and populate them with data.\n\nThis code defines three functions:\n\n*   `addToCart($productId, $quantity)`: Adds a product to the cart or updates the quantity of an existing product in the cart.\n*   `removeFromCart($productId)`: Removes a product from the cart.\n*   `checkout()`: Processes the checkout functionality, including updating stock levels and inserting orders into the database.\n\nYou can call these functions by submitting the following form data:\n\n```php\n<form action=\"purchase.php\" method=\"post\">\n    <input type=\"hidden\" name=\"add_to_cart\" value=\"true\">\n    <input type=\"hidden\" name=\"product_id\" value=\"<?php echo $productId; ?>\">\n    <input type=\"hidden\" name=\"quantity\" value=\"<?php echo $quantity; ?>\">\n</form>\n```\n\n```php\n<form action=\"purchase.php\" method=\"post\">\n    <input type=\"hidden\" name=\"remove_from_cart\" value=\"true\">\n    <input type=\"hidden\" name=\"product_id\" value=\"<?php echo $productId; ?>\">\n</form>\n```\n\n```php\n<form action=\"purchase.php\" method=\"post\">\n    <input type=\"hidden\" name=\"checkout\" value=\"true\">\n</form>\n```\n\nRemember to replace `$productId` and `$quantity` with the actual values from your database.", "code_blocks": ["```php\n<?php\n\n// Configuration settings\n$databaseHost = 'localhost';\n$databaseName = 'e-commerce';\n$databaseUsername = 'root';\n$databasePassword = '';\n\n// Connect to database\n$conn = new mysqli($databaseHost, $databaseUsername, $databasePassword, $databaseName);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Function to add product to cart\nfunction addToCart($productId, $quantity) {\n    global $conn;\n    \n    // Check if product exists in database\n    $query = \"SELECT * FROM products WHERE id = '$productId'\";\n    $result = $conn->query($query);\n    \n    if ($result->num_rows > 0) {\n        // Get product details\n        $productDetails = $result->fetch_assoc();\n        \n        // Check if product is already in cart\n        $cartQuery = \"SELECT * FROM cart WHERE productId = '$productId' AND userId = '\".$_SESSION['userId'].\"'\";\n        $cartResult = $conn->query($cartQuery);\n        \n        if ($cartResult->num_rows > 0) {\n            // Update quantity in cart\n            $updateQuantity = \"UPDATE cart SET quantity = quantity + '$quantity' WHERE productId = '$productId' AND userId = '\".$_SESSION['userId'].\"'\";\n            $conn->query($updateQuantity);\n        } else {\n            // Add product to cart\n            $addProductToCart = \"INSERT INTO cart (productId, userId, quantity) VALUES ('$productId', '\".$_SESSION['userId'].\"', '$quantity')\";\n            $conn->query($addProductToCart);\n        }\n    }\n}\n\n// Function to remove product from cart\nfunction removeFromCart($productId) {\n    global $conn;\n    \n    // Check if product exists in database\n    $query = \"SELECT * FROM products WHERE id = '$productId'\";\n    $result = $conn->query($query);\n    \n    if ($result->num_rows > 0) {\n        // Get product details\n        $productDetails = $result->fetch_assoc();\n        \n        // Check if product is in cart\n        $cartQuery = \"SELECT * FROM cart WHERE productId = '$productId' AND userId = '\".$_SESSION['userId'].\"'\";\n        $cartResult = $conn->query($cartQuery);\n        \n        if ($cartResult->num_rows > 0) {\n            // Remove product from cart\n            $removeProductFromCart = \"DELETE FROM cart WHERE productId = '$productId' AND userId = '\".$_SESSION['userId'].\"'\";\n            $conn->query($removeProductFromCart);\n        }\n    }\n}\n\n// Function to checkout\nfunction checkout() {\n    global $conn;\n    \n    // Get user ID from session\n    $userId = $_SESSION['userId'];\n    \n    // Check if cart is not empty\n    $cartQuery = \"SELECT * FROM cart WHERE userId = '$userId'\";\n    $cartResult = $conn->query($cartQuery);\n    \n    if ($cartResult->num_rows > 0) {\n        // Get product details from database\n        while ($row = $cartResult->fetch_assoc()) {\n            $productId = $row['productId'];\n            $quantity = $row['quantity'];\n            \n            // Update stock in products table\n            $updateStockQuery = \"UPDATE products SET quantity = quantity - '$quantity' WHERE id = '$productId'\";\n            $conn->query($updateStockQuery);\n        }\n        \n        // Insert order into database\n        $insertOrderQuery = \"INSERT INTO orders (userId, totalPrice) VALUES ('$userId', '0')\";\n        $conn->query($insertOrderQuery);\n        \n        // Get order ID from database\n        $orderIDQuery = \"SELECT id FROM orders WHERE userId = '$userId' ORDER BY id DESC LIMIT 1\";\n        $orderResult = $conn->query($orderIDQuery);\n        $orderID = $orderResult->fetch_assoc()['id'];\n        \n        // Insert order items into database\n        while ($row = $cartResult->fetch_assoc()) {\n            $productId = $row['productId'];\n            $quantity = $row['quantity'];\n            \n            $insertOrderItemQuery = \"INSERT INTO order_items (orderId, productId, quantity) VALUES ('$orderID', '$productId', '$quantity')\";\n            $conn->query($insertOrderItemQuery);\n        }\n        \n        // Update cart to reflect new status\n        $updateCartStatusQuery = \"UPDATE cart SET status = 'paid' WHERE userId = '$userId'\";\n        $conn->query($updateCartStatusQuery);\n    }\n}\n\n// Example usage\nif (isset($_POST['add_to_cart'])) {\n    $productId = $_POST['product_id'];\n    $quantity = $_POST['quantity'];\n    \n    addToCart($productId, $quantity);\n} elseif (isset($_POST['remove_from_cart'])) {\n    $productId = $_POST['product_id'];\n    \n    removeFromCart($productId);\n} elseif (isset($_POST['checkout'])) {\n    checkout();\n}\n\n?>\n```", "```php\n<form action=\"purchase.php\" method=\"post\">\n    <input type=\"hidden\" name=\"add_to_cart\" value=\"true\">\n    <input type=\"hidden\" name=\"product_id\" value=\"<?php echo $productId; ?>\">\n    <input type=\"hidden\" name=\"quantity\" value=\"<?php echo $quantity; ?>\">\n</form>\n```", "```php\n<form action=\"purchase.php\" method=\"post\">\n    <input type=\"hidden\" name=\"remove_from_cart\" value=\"true\">\n    <input type=\"hidden\" name=\"product_id\" value=\"<?php echo $productId; ?>\">\n</form>\n```", "```php\n<form action=\"purchase.php\" method=\"post\">\n    <input type=\"hidden\" name=\"checkout\" value=\"true\">\n</form>\n```"]}
