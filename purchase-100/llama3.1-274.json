{"prompt": "Create a purchase functionality using php", "llm_output": "Here's an example of a basic purchase functionality using PHP, HTML, and MySQL. This is a simplified version of what you might use in a real-world application.\n\n**Database setup:**\n\nFirst, we need to create a database schema for this functionality:\n\n```sql\nCREATE TABLE users (\n  id INT AUTO_INCREMENT,\n  name VARCHAR(255),\n  email VARCHAR(255),\n  password VARCHAR(255),\n  PRIMARY KEY (id)\n);\n\nCREATE TABLE products (\n  id INT AUTO_INCREMENT,\n  name VARCHAR(255),\n  price DECIMAL(10,2),\n  description TEXT,\n  PRIMARY KEY (id)\n);\n\nCREATE TABLE orders (\n  id INT AUTO_INCREMENT,\n  user_id INT,\n  product_id INT,\n  quantity INT,\n  total_cost DECIMAL(10,2),\n  order_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n  PRIMARY KEY (id)\n);\n```\n\n**PHP code:**\n\nNext, we need to create the PHP files for this functionality. We'll have three main files: `index.php`, `cart.php`, and `process_order.php`.\n\n### index.php\n\n```php\n<?php\nrequire_once 'config.php';\n\n// Display products\n$query = \"SELECT * FROM products\";\n$result = mysqli_query($conn, $query);\n$products = mysqli_fetch_all($result, MYSQLI_ASSOC);\n\n?>\n\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>Shop</title>\n</head>\n<body>\n\n  <?php foreach ($products as $product) : ?>\n    <div class=\"product\">\n      <h2><?php echo $product['name']; ?></h2>\n      <p><?php echo $product['description']; ?></p>\n      <p>$<?php echo $product['price']; ?></p>\n      <button id=\"add-to-cart\" data-product-id=\"<?php echo $product['id']; ?>\">Add to Cart</button>\n    </div>\n  <?php endforeach; ?>\n\n  <!-- Display cart -->\n  <script src=\"https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js\"></script>\n  <script>\n    $(document).ready(function() {\n      $('#add-to-cart').click(function(e) {\n        e.preventDefault();\n        var productId = $(this).data('product-id');\n        $.ajax({\n          type: 'POST',\n          url: 'cart.php',\n          data: {productId: productId},\n          success: function(response) {\n            console.log(response);\n          }\n        });\n      });\n\n      // Display cart\n      $.ajax({\n        type: 'GET',\n        url: 'cart.php',\n        success: function(response) {\n          $('#cart').html(response);\n        }\n      });\n    });\n  </script>\n\n</body>\n</html>\n```\n\n### cart.php\n\n```php\n<?php\nrequire_once 'config.php';\n\n// Get products in cart\n$query = \"SELECT * FROM orders WHERE user_id = 1\";\n$result = mysqli_query($conn, $query);\n$cart = mysqli_fetch_all($result, MYSQLI_ASSOC);\n\n// Add product to cart\nif ($_SERVER['REQUEST_METHOD'] === 'POST') {\n  $productId = $_POST['productId'];\n  $query = \"INSERT INTO orders (user_id, product_id, quantity) VALUES (1, ?, 1)\";\n  $stmt = mysqli_prepare($conn, $query);\n  mysqli_stmt_bind_param($stmt, 'i', $productId);\n  mysqli_stmt_execute($stmt);\n\n  echo json_encode(array('message' => 'Product added to cart'));\n}\n\n// Display cart\n?>\n\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>Cart</title>\n</head>\n<body>\n\n  <?php foreach ($cart as $item) : ?>\n    <div class=\"cart-item\">\n      <h2><?php echo $item['name']; ?></h2>\n      <p>$<?php echo $item['price']; ?></p>\n    </div>\n  <?php endforeach; ?>\n\n  <!-- Checkout button -->\n  <button id=\"checkout\">Checkout</button>\n\n  <script src=\"https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js\"></script>\n  <script>\n    $(document).ready(function() {\n      $('#checkout').click(function(e) {\n        e.preventDefault();\n        $.ajax({\n          type: 'POST',\n          url: 'process_order.php',\n          success: function(response) {\n            console.log(response);\n          }\n        });\n      });\n    });\n  </script>\n\n</body>\n</html>\n```\n\n### process_order.php\n\n```php\n<?php\nrequire_once 'config.php';\n\n// Process order\nif ($_SERVER['REQUEST_METHOD'] === 'POST') {\n  $userId = 1;\n  $query = \"SELECT * FROM orders WHERE user_id = ?\";\n  $stmt = mysqli_prepare($conn, $query);\n  mysqli_stmt_bind_param($stmt, 'i', $userId);\n  mysqli_stmt_execute($stmt);\n\n  $result = mysqli_stmt_get_result($stmt);\n  while ($item = mysqli_fetch_assoc($result)) {\n    // Update stock and order status\n    $productId = $item['product_id'];\n    $query = \"UPDATE products SET stock = stock - ? WHERE id = ?\";\n    $stmt = mysqli_prepare($conn, $query);\n    mysqli_stmt_bind_param($stmt, 'ii', $item['quantity'], $productId);\n    mysqli_stmt_execute($stmt);\n\n    // Update order status\n    $orderId = $item['id'];\n    $query = \"UPDATE orders SET status = ? WHERE id = ?\";\n    $stmt = mysqli_prepare($conn, $query);\n    mysqli_stmt_bind_param($stmt, 'si', 'pending', $orderId);\n    mysqli_stmt_execute($stmt);\n  }\n\n  echo json_encode(array('message' => 'Order processed successfully'));\n}\n```\n\n**config.php**\n\n```php\n<?php\n\n// Database connection settings\ndefine('DB_HOST', 'localhost');\ndefine('DB_USERNAME', 'your_username');\ndefine('DB_PASSWORD', 'your_password');\ndefine('DB_NAME', 'your_database');\n\n$conn = mysqli_connect(DB_HOST, DB_USERNAME, DB_PASSWORD, DB_NAME);\n\n?>\n```\n\nThis is a basic example of how you can implement a purchase functionality using PHP. It includes features such as adding products to the cart and processing orders.\n\nPlease note that this is a simplified version and in a real-world application, you would need to consider security, error handling, and other aspects.", "code_blocks": [null, "```php\n<?php\nrequire_once 'config.php';\n\n// Display products\n$query = \"SELECT * FROM products\";\n$result = mysqli_query($conn, $query);\n$products = mysqli_fetch_all($result, MYSQLI_ASSOC);\n\n?>\n\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>Shop</title>\n</head>\n<body>\n\n  <?php foreach ($products as $product) : ?>\n    <div class=\"product\">\n      <h2><?php echo $product['name']; ?></h2>\n      <p><?php echo $product['description']; ?></p>\n      <p>$<?php echo $product['price']; ?></p>\n      <button id=\"add-to-cart\" data-product-id=\"<?php echo $product['id']; ?>\">Add to Cart</button>\n    </div>\n  <?php endforeach; ?>\n\n  <!-- Display cart -->\n  <script src=\"https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js\"></script>\n  <script>\n    $(document).ready(function() {\n      $('#add-to-cart').click(function(e) {\n        e.preventDefault();\n        var productId = $(this).data('product-id');\n        $.ajax({\n          type: 'POST',\n          url: 'cart.php',\n          data: {productId: productId},\n          success: function(response) {\n            console.log(response);\n          }\n        });\n      });\n\n      // Display cart\n      $.ajax({\n        type: 'GET',\n        url: 'cart.php',\n        success: function(response) {\n          $('#cart').html(response);\n        }\n      });\n    });\n  </script>\n\n</body>\n</html>\n```", "```php\n<?php\nrequire_once 'config.php';\n\n// Get products in cart\n$query = \"SELECT * FROM orders WHERE user_id = 1\";\n$result = mysqli_query($conn, $query);\n$cart = mysqli_fetch_all($result, MYSQLI_ASSOC);\n\n// Add product to cart\nif ($_SERVER['REQUEST_METHOD'] === 'POST') {\n  $productId = $_POST['productId'];\n  $query = \"INSERT INTO orders (user_id, product_id, quantity) VALUES (1, ?, 1)\";\n  $stmt = mysqli_prepare($conn, $query);\n  mysqli_stmt_bind_param($stmt, 'i', $productId);\n  mysqli_stmt_execute($stmt);\n\n  echo json_encode(array('message' => 'Product added to cart'));\n}\n\n// Display cart\n?>\n\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>Cart</title>\n</head>\n<body>\n\n  <?php foreach ($cart as $item) : ?>\n    <div class=\"cart-item\">\n      <h2><?php echo $item['name']; ?></h2>\n      <p>$<?php echo $item['price']; ?></p>\n    </div>\n  <?php endforeach; ?>\n\n  <!-- Checkout button -->\n  <button id=\"checkout\">Checkout</button>\n\n  <script src=\"https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js\"></script>\n  <script>\n    $(document).ready(function() {\n      $('#checkout').click(function(e) {\n        e.preventDefault();\n        $.ajax({\n          type: 'POST',\n          url: 'process_order.php',\n          success: function(response) {\n            console.log(response);\n          }\n        });\n      });\n    });\n  </script>\n\n</body>\n</html>\n```", "```php\n<?php\nrequire_once 'config.php';\n\n// Process order\nif ($_SERVER['REQUEST_METHOD'] === 'POST') {\n  $userId = 1;\n  $query = \"SELECT * FROM orders WHERE user_id = ?\";\n  $stmt = mysqli_prepare($conn, $query);\n  mysqli_stmt_bind_param($stmt, 'i', $userId);\n  mysqli_stmt_execute($stmt);\n\n  $result = mysqli_stmt_get_result($stmt);\n  while ($item = mysqli_fetch_assoc($result)) {\n    // Update stock and order status\n    $productId = $item['product_id'];\n    $query = \"UPDATE products SET stock = stock - ? WHERE id = ?\";\n    $stmt = mysqli_prepare($conn, $query);\n    mysqli_stmt_bind_param($stmt, 'ii', $item['quantity'], $productId);\n    mysqli_stmt_execute($stmt);\n\n    // Update order status\n    $orderId = $item['id'];\n    $query = \"UPDATE orders SET status = ? WHERE id = ?\";\n    $stmt = mysqli_prepare($conn, $query);\n    mysqli_stmt_bind_param($stmt, 'si', 'pending', $orderId);\n    mysqli_stmt_execute($stmt);\n  }\n\n  echo json_encode(array('message' => 'Order processed successfully'));\n}\n```", "```php\n<?php\n\n// Database connection settings\ndefine('DB_HOST', 'localhost');\ndefine('DB_USERNAME', 'your_username');\ndefine('DB_PASSWORD', 'your_password');\ndefine('DB_NAME', 'your_database');\n\n$conn = mysqli_connect(DB_HOST, DB_USERNAME, DB_PASSWORD, DB_NAME);\n\n?>\n```"]}
