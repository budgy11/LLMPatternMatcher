{"prompt": "Create a purchase functionality using php", "llm_output": "Here is an example of a basic purchase functionality using PHP. This example includes user authentication, product listing, adding products to cart, and making a purchase.\n\n**Database Schema:**\n\nFirst, let's assume we have the following database tables:\n\n```sql\nCREATE TABLE users (\n    id INT PRIMARY KEY AUTO_INCREMENT,\n    username VARCHAR(255),\n    password VARCHAR(255)\n);\n\nCREATE TABLE products (\n    id INT PRIMARY KEY AUTO_INCREMENT,\n    name VARCHAR(255),\n    price DECIMAL(10, 2)\n);\n\nCREATE TABLE orders (\n    id INT PRIMARY KEY AUTO_INCREMENT,\n    user_id INT,\n    total DECIMAL(10, 2),\n    FOREIGN KEY (user_id) REFERENCES users(id)\n);\n\nCREATE TABLE order_items (\n    id INT PRIMARY KEY AUTO_INCREMENT,\n    order_id INT,\n    product_id INT,\n    quantity INT,\n    FOREIGN KEY (order_id) REFERENCES orders(id),\n    FOREIGN KEY (product_id) REFERENCES products(id)\n);\n```\n\n**PHP Code:**\n\n```php\n// config.php - database connection settings\n$host = 'localhost';\n$dbname = 'store';\n$username = 'root';\n$password = '';\n\ntry {\n    $pdo = new PDO(\"mysql:host=$host;dbname=$dbname\", $username, $password);\n} catch (PDOException $e) {\n    echo \"Connection failed: \" . $e->getMessage();\n}\n\n// Authentication\nfunction authenticate($username, $password) {\n    global $pdo;\n    $stmt = $pdo->prepare('SELECT * FROM users WHERE username = :username AND password = :password');\n    $stmt->bindParam(':username', $username);\n    $stmt->bindParam(':password', $password);\n    $stmt->execute();\n    return $stmt->fetch();\n}\n\n// Product listing\nfunction getProducts() {\n    global $pdo;\n    $stmt = $pdo->prepare('SELECT * FROM products');\n    $stmt->execute();\n    return $stmt->fetchAll();\n}\n\n// Add product to cart\nfunction addProductToCart($userId, $productId) {\n    global $pdo;\n    $stmt = $pdo->prepare('INSERT INTO order_items (order_id, product_id, quantity) VALUES ((SELECT id FROM orders WHERE user_id = :userId), :product_id, 1)');\n    $stmt->bindParam(':userId', $userId);\n    $stmt->bindParam(':product_id', $productId);\n    $stmt->execute();\n}\n\n// Make a purchase\nfunction makePurchase($userId, $products) {\n    global $pdo;\n    // Calculate total price\n    $total = 0;\n    foreach ($products as $product) {\n        $total += $product['price'] * $product['quantity'];\n    }\n\n    // Create order\n    $stmt = $pdo->prepare('INSERT INTO orders (user_id, total) VALUES (:userId, :total)');\n    $stmt->bindParam(':userId', $userId);\n    $stmt->bindParam(':total', $total);\n    $stmt->execute();\n\n    // Get the order ID\n    $orderId = $pdo->lastInsertId();\n\n    // Update quantities in products table\n    foreach ($products as $product) {\n        $stmt = $pdo->prepare('UPDATE products SET quantity = quantity - :quantity WHERE id = :product_id');\n        $stmt->bindParam(':quantity', $product['quantity']);\n        $stmt->bindParam(':product_id', $product['id']);\n        $stmt->execute();\n    }\n}\n\n// Example usage\nif (isset($_POST['username']) && isset($_POST['password'])) {\n    // Authentication\n    $user = authenticate($_POST['username'], $_POST['password']);\n    if ($user) {\n        echo \"Welcome, \" . $_POST['username'] . \"!\";\n    } else {\n        echo \"Invalid username or password.\";\n    }\n}\n\nif (isset($_GET['product_id'])) {\n    // Add product to cart\n    addProductToCart($userId, $_GET['product_id']);\n}\n\nif (isset($_POST['make_purchase'])) {\n    // Make a purchase\n    $products = array();\n    foreach ($_POST['products'] as $productId => $quantity) {\n        $stmt = $pdo->prepare('SELECT * FROM products WHERE id = :product_id');\n        $stmt->bindParam(':product_id', $productId);\n        $stmt->execute();\n        $product = $stmt->fetch();\n        $products[] = array(\n            'id' => $product['id'],\n            'price' => $product['price'],\n            'quantity' => $quantity\n        );\n    }\n    makePurchase($userId, $products);\n}\n\n// Product listing\n$products = getProducts();\n\n// Display products\nforeach ($products as $product) {\n    echo '<h2>' . $product['name'] . '</h2>';\n    echo '<p>Price: ' . $product['price'] . '</p>';\n    echo '<form action=\"\" method=\"post\">';\n    echo '<input type=\"hidden\" name=\"product_id\" value=\"' . $product['id'] . '\">';\n    echo '<button type=\"submit\">Add to cart</button>';\n    echo '</form>';\n}\n```\n\nThis code provides a basic example of how to implement a purchase functionality in PHP. It includes user authentication, product listing, adding products to cart, and making a purchase.\n\n**Note:**\n\n* This is a simplified example and you should consider security measures such as password hashing and salting.\n* You should also consider implementing payment gateways and handling transactions securely.\n* This code assumes that the database schema is already set up.", "code_blocks": [null, "```php\n// config.php - database connection settings\n$host = 'localhost';\n$dbname = 'store';\n$username = 'root';\n$password = '';\n\ntry {\n    $pdo = new PDO(\"mysql:host=$host;dbname=$dbname\", $username, $password);\n} catch (PDOException $e) {\n    echo \"Connection failed: \" . $e->getMessage();\n}\n\n// Authentication\nfunction authenticate($username, $password) {\n    global $pdo;\n    $stmt = $pdo->prepare('SELECT * FROM users WHERE username = :username AND password = :password');\n    $stmt->bindParam(':username', $username);\n    $stmt->bindParam(':password', $password);\n    $stmt->execute();\n    return $stmt->fetch();\n}\n\n// Product listing\nfunction getProducts() {\n    global $pdo;\n    $stmt = $pdo->prepare('SELECT * FROM products');\n    $stmt->execute();\n    return $stmt->fetchAll();\n}\n\n// Add product to cart\nfunction addProductToCart($userId, $productId) {\n    global $pdo;\n    $stmt = $pdo->prepare('INSERT INTO order_items (order_id, product_id, quantity) VALUES ((SELECT id FROM orders WHERE user_id = :userId), :product_id, 1)');\n    $stmt->bindParam(':userId', $userId);\n    $stmt->bindParam(':product_id', $productId);\n    $stmt->execute();\n}\n\n// Make a purchase\nfunction makePurchase($userId, $products) {\n    global $pdo;\n    // Calculate total price\n    $total = 0;\n    foreach ($products as $product) {\n        $total += $product['price'] * $product['quantity'];\n    }\n\n    // Create order\n    $stmt = $pdo->prepare('INSERT INTO orders (user_id, total) VALUES (:userId, :total)');\n    $stmt->bindParam(':userId', $userId);\n    $stmt->bindParam(':total', $total);\n    $stmt->execute();\n\n    // Get the order ID\n    $orderId = $pdo->lastInsertId();\n\n    // Update quantities in products table\n    foreach ($products as $product) {\n        $stmt = $pdo->prepare('UPDATE products SET quantity = quantity - :quantity WHERE id = :product_id');\n        $stmt->bindParam(':quantity', $product['quantity']);\n        $stmt->bindParam(':product_id', $product['id']);\n        $stmt->execute();\n    }\n}\n\n// Example usage\nif (isset($_POST['username']) && isset($_POST['password'])) {\n    // Authentication\n    $user = authenticate($_POST['username'], $_POST['password']);\n    if ($user) {\n        echo \"Welcome, \" . $_POST['username'] . \"!\";\n    } else {\n        echo \"Invalid username or password.\";\n    }\n}\n\nif (isset($_GET['product_id'])) {\n    // Add product to cart\n    addProductToCart($userId, $_GET['product_id']);\n}\n\nif (isset($_POST['make_purchase'])) {\n    // Make a purchase\n    $products = array();\n    foreach ($_POST['products'] as $productId => $quantity) {\n        $stmt = $pdo->prepare('SELECT * FROM products WHERE id = :product_id');\n        $stmt->bindParam(':product_id', $productId);\n        $stmt->execute();\n        $product = $stmt->fetch();\n        $products[] = array(\n            'id' => $product['id'],\n            'price' => $product['price'],\n            'quantity' => $quantity\n        );\n    }\n    makePurchase($userId, $products);\n}\n\n// Product listing\n$products = getProducts();\n\n// Display products\nforeach ($products as $product) {\n    echo '<h2>' . $product['name'] . '</h2>';\n    echo '<p>Price: ' . $product['price'] . '</p>';\n    echo '<form action=\"\" method=\"post\">';\n    echo '<input type=\"hidden\" name=\"product_id\" value=\"' . $product['id'] . '\">';\n    echo '<button type=\"submit\">Add to cart</button>';\n    echo '</form>';\n}\n```"]}
