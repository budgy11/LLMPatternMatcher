{"prompt": "Create a purchase functionality using php", "llm_output": "Here's an example of a basic purchase functionality using PHP, including form validation and database interaction. This example assumes you have a MySQL database setup for the product table with columns `id`, `name`, `price`, and `quantity`.\n\n**Database Setup:**\n\n```sql\nCREATE TABLE products (\n    id INT AUTO_INCREMENT PRIMARY KEY,\n    name VARCHAR(255),\n    price DECIMAL(10, 2),\n    quantity INT\n);\n```\n\n**PHP Code ( purchase.php ):**\n\n```php\n<?php\n\n// Configuration\n$db_host = 'localhost';\n$db_username = 'your_username';\n$db_password = 'your_password';\n$db_name = 'your_database';\n\n// Connect to database\n$conn = new mysqli($db_host, $db_username, $db_password, $db_name);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Function to display products\nfunction displayProducts() {\n    global $conn;\n    \n    $sql = \"SELECT * FROM products\";\n    $result = $conn->query($sql);\n    \n    if ($result->num_rows > 0) {\n        echo \"<table border='1'>\";\n        while ($row = $result->fetch_assoc()) {\n            echo \"<tr>\";\n            echo \"<td>\" . $row['name'] . \"</td>\";\n            echo \"<td>Price: $\" . $row['price'] . \"</td>\";\n            echo \"<td>Quantity: \" . $row['quantity'] . \"</td>\";\n            echo \"<td><button type='button' class='btn btn-primary' onclick=\\\"addToCart(\" . $row['id'] . \");\\\">Add to Cart</button></td>\";\n            echo \"</tr>\";\n        }\n        echo \"</table>\";\n    } else {\n        echo \"No products available.\";\n    }\n}\n\n// Function to add product to cart\nfunction addToCart($pid) {\n    global $conn;\n    \n    // Retrieve user's current cart contents ( assume session-based)\n    if (isset($_SESSION['cart'])) {\n        $_SESSION['cart'][$pid]++;\n    } else {\n        $_SESSION['cart'] = array($pid => 1);\n    }\n}\n\n// Function to purchase products in cart\nfunction purchaseProducts() {\n    global $conn;\n    \n    // Retrieve user's current cart contents ( assume session-based)\n    if (isset($_SESSION['cart'])) {\n        \n        // Validate and process each product\n        foreach ($_SESSION['cart'] as $pid => $quantity) {\n            // Retrieve product details from database\n            $sql = \"SELECT * FROM products WHERE id=\" . intval($pid);\n            $result = $conn->query($sql);\n            \n            if ($result->num_rows > 0) {\n                $product = $result->fetch_assoc();\n                \n                // Validate quantity and update stock (simulated)\n                if ($quantity <= $product['quantity']) {\n                    echo \"Product \" . $pid . \" successfully added to cart.\";\n                    \n                    // Update product stock\n                    $sql = \"UPDATE products SET quantity=quantity-\" . intval($quantity) . \" WHERE id=\" . intval($pid);\n                    $conn->query($sql);\n                } else {\n                    echo \"Insufficient quantity for product \" . $pid . \".\";\n                }\n            } else {\n                echo \"Product not found.\";\n            }\n        }\n        \n        // Clear cart\n        unset($_SESSION['cart']);\n    }\n}\n\n// Display products and form to purchase\n?>\n\n<form action=\"\" method=\"post\">\n    <input type=\"submit\" name=\"purchase\" value=\"Purchase Selected Products\">\n</form>\n\n<!-- Form to display selected products and allow user to input quantity -->\n<div id=\"selected-products\"></div>\n<script>\n    function addToCart(pid) {\n        // Simulate adding product to cart (not actual database update)\n        let cart = <?php echo json_encode($_SESSION['cart']); ?>;\n        \n        if (!cart[pid]) {\n            cart[pid] = 1;\n        } else {\n            cart[pid]++;\n        }\n        \n        document.getElementById('selected-products').innerHTML = '';\n        \n        for (let pid in cart) {\n            let product = <?php echo json_encode($conn->query(\"SELECT * FROM products WHERE id=\" . intval(pid))->fetch_assoc()); ?>;\n            \n            let html = \"<p>Product: \" + product.name + \"</p>\";\n            html += \"<p>Price: $\" + product.price + \"</p>\";\n            html += \"<input type='number' value='\" + cart[pid] + \"' min='1'>\";\n            document.getElementById('selected-products').innerHTML += html;\n        }\n    }\n\n    if (document.querySelector('button[type=\"button\"]')) {\n        let buttons = document.querySelectorAll('button[type=\"button\"]');\n        \n        for (let button of buttons) {\n            button.addEventListener('click', function() {\n                addToCart(button.parentNode.parentNode.rowIndex - 1);\n            });\n        }\n    }\n</script>\n```\n\n**HTML Output:**\n\n```html\n<table border='1'>\n  <tr>\n    <td>Product Name</td>\n    <td>Price</td>\n    <td>Quantity</td>\n    <td>Add to Cart</td>\n  </tr>\n  <!-- Product rows will be populated dynamically -->\n</table>\n\n<!-- Form to purchase selected products -->\n<form action=\"\" method=\"post\">\n  <input type=\"submit\" name=\"purchase\" value=\"Purchase Selected Products\">\n</form>\n\n<!-- Display selected products and quantity inputs -->\n<div id=\"selected-products\"></div>\n```\n\n**Example Usage:**\n\n1. User views product list page.\n2. User selects one or more products by clicking the \"Add to Cart\" button for each product.\n3. Product details are displayed along with a quantity input, allowing user to specify how many of each product they wish to purchase.\n4. User submits the form to purchase selected products.\n\n**Security Notes:**\n\n* The above example is simplified and not suitable for production use without proper security measures in place (e.g., authentication, authorization).\n* This example assumes that user's cart contents are stored in a session variable (`$_SESSION['cart']`).\n* It's essential to validate user input and prevent SQL injection attacks when interacting with the database.", "code_blocks": [null, "```php\n<?php\n\n// Configuration\n$db_host = 'localhost';\n$db_username = 'your_username';\n$db_password = 'your_password';\n$db_name = 'your_database';\n\n// Connect to database\n$conn = new mysqli($db_host, $db_username, $db_password, $db_name);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Function to display products\nfunction displayProducts() {\n    global $conn;\n    \n    $sql = \"SELECT * FROM products\";\n    $result = $conn->query($sql);\n    \n    if ($result->num_rows > 0) {\n        echo \"<table border='1'>\";\n        while ($row = $result->fetch_assoc()) {\n            echo \"<tr>\";\n            echo \"<td>\" . $row['name'] . \"</td>\";\n            echo \"<td>Price: $\" . $row['price'] . \"</td>\";\n            echo \"<td>Quantity: \" . $row['quantity'] . \"</td>\";\n            echo \"<td><button type='button' class='btn btn-primary' onclick=\\\"addToCart(\" . $row['id'] . \");\\\">Add to Cart</button></td>\";\n            echo \"</tr>\";\n        }\n        echo \"</table>\";\n    } else {\n        echo \"No products available.\";\n    }\n}\n\n// Function to add product to cart\nfunction addToCart($pid) {\n    global $conn;\n    \n    // Retrieve user's current cart contents ( assume session-based)\n    if (isset($_SESSION['cart'])) {\n        $_SESSION['cart'][$pid]++;\n    } else {\n        $_SESSION['cart'] = array($pid => 1);\n    }\n}\n\n// Function to purchase products in cart\nfunction purchaseProducts() {\n    global $conn;\n    \n    // Retrieve user's current cart contents ( assume session-based)\n    if (isset($_SESSION['cart'])) {\n        \n        // Validate and process each product\n        foreach ($_SESSION['cart'] as $pid => $quantity) {\n            // Retrieve product details from database\n            $sql = \"SELECT * FROM products WHERE id=\" . intval($pid);\n            $result = $conn->query($sql);\n            \n            if ($result->num_rows > 0) {\n                $product = $result->fetch_assoc();\n                \n                // Validate quantity and update stock (simulated)\n                if ($quantity <= $product['quantity']) {\n                    echo \"Product \" . $pid . \" successfully added to cart.\";\n                    \n                    // Update product stock\n                    $sql = \"UPDATE products SET quantity=quantity-\" . intval($quantity) . \" WHERE id=\" . intval($pid);\n                    $conn->query($sql);\n                } else {\n                    echo \"Insufficient quantity for product \" . $pid . \".\";\n                }\n            } else {\n                echo \"Product not found.\";\n            }\n        }\n        \n        // Clear cart\n        unset($_SESSION['cart']);\n    }\n}\n\n// Display products and form to purchase\n?>\n\n<form action=\"\" method=\"post\">\n    <input type=\"submit\" name=\"purchase\" value=\"Purchase Selected Products\">\n</form>\n\n<!-- Form to display selected products and allow user to input quantity -->\n<div id=\"selected-products\"></div>\n<script>\n    function addToCart(pid) {\n        // Simulate adding product to cart (not actual database update)\n        let cart = <?php echo json_encode($_SESSION['cart']); ?>;\n        \n        if (!cart[pid]) {\n            cart[pid] = 1;\n        } else {\n            cart[pid]++;\n        }\n        \n        document.getElementById('selected-products').innerHTML = '';\n        \n        for (let pid in cart) {\n            let product = <?php echo json_encode($conn->query(\"SELECT * FROM products WHERE id=\" . intval(pid))->fetch_assoc()); ?>;\n            \n            let html = \"<p>Product: \" + product.name + \"</p>\";\n            html += \"<p>Price: $\" + product.price + \"</p>\";\n            html += \"<input type='number' value='\" + cart[pid] + \"' min='1'>\";\n            document.getElementById('selected-products').innerHTML += html;\n        }\n    }\n\n    if (document.querySelector('button[type=\"button\"]')) {\n        let buttons = document.querySelectorAll('button[type=\"button\"]');\n        \n        for (let button of buttons) {\n            button.addEventListener('click', function() {\n                addToCart(button.parentNode.parentNode.rowIndex - 1);\n            });\n        }\n    }\n</script>\n```", null]}
