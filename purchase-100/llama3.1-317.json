{"prompt": "Create a purchase functionality using php", "llm_output": "Here is an example of how to create a basic purchase functionality using PHP. This example assumes you have a database setup with the following tables:\n\n**Table: `users`**\n\n| Column Name | Data Type |\n| --- | --- |\n| id | int |\n| name | varchar(255) |\n| email | varchar(255) |\n\n**Table: `products`**\n\n| Column Name | Data Type |\n| --- | --- |\n| id | int |\n| name | varchar(255) |\n| price | decimal(10, 2) |\n| description | text |\n\n**Table: `orders`**\n\n| Column Name | Data Type |\n| --- | --- |\n| id | int |\n| user_id | int |\n| order_date | date |\n| total_cost | decimal(10, 2) |\n\n**Table: `order_items`**\n\n| Column Name | Data Type |\n| --- | --- |\n| id | int |\n| order_id | int |\n| product_id | int |\n| quantity | int |\n\nHere is the PHP code for creating a purchase functionality:\n\n**purchase.php**\n```php\n<?php\n\n// Include database connection settings\nrequire_once 'db_connection.php';\n\n// Check if user is logged in\nif (!isset($_SESSION['user_id'])) {\n    header('Location: login.php');\n    exit;\n}\n\n// Get current user's ID\n$user_id = $_SESSION['user_id'];\n\n// Get all products from database\n$products_query = \"SELECT * FROM products\";\n$products_result = mysqli_query($conn, $products_query);\n$products = array();\nwhile ($product = mysqli_fetch_assoc($products_result)) {\n    $products[] = $product;\n}\n\n// Process form submission (if any)\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n    // Get order items from form\n    $order_items = $_POST['order_items'];\n\n    // Validate order items\n    if (empty($order_items) || !is_array($order_items)) {\n        echo \"Error: Invalid order items\";\n        exit;\n    }\n\n    // Create new order\n    $order_query = \"INSERT INTO orders (user_id, total_cost) VALUES ('$user_id', 0)\";\n    mysqli_query($conn, $order_query);\n    $order_id = mysqli_insert_id($conn);\n\n    // Add each item to the order\n    foreach ($order_items as $item) {\n        $product_id = $item['product_id'];\n        $quantity = $item['quantity'];\n\n        // Update product quantity in stock\n        $product_query = \"UPDATE products SET quantity = quantity - $quantity WHERE id = '$product_id'\";\n        mysqli_query($conn, $product_query);\n\n        // Add item to order_items table\n        $order_item_query = \"INSERT INTO order_items (order_id, product_id, quantity) VALUES ('$order_id', '$product_id', '$quantity')\";\n        mysqli_query($conn, $order_item_query);\n    }\n\n    // Update total cost of the order\n    $total_cost_query = \"UPDATE orders SET total_cost = 0 WHERE id = '$order_id'\";\n    mysqli_query($conn, $total_cost_query);\n\n    echo \"Order created successfully!\";\n}\n\n?>\n\n<!-- Display products and add to cart form -->\n<h1>Purchase Products</h1>\n\n<form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\">\n    <table>\n        <?php foreach ($products as $product): ?>\n            <tr>\n                <td><?php echo $product['name']; ?></td>\n                <td>$<?php echo number_format($product['price'], 2); ?></td>\n                <td>\n                    <input type=\"number\" name=\"order_items[]\" value=\"<?php echo $product['id']; ?>\" hidden>\n                    <button type=\"button\" class=\"btn btn-primary\" onclick=\"add_to_cart(<?php echo $product['id']; ?>)\">Add to Cart</button>\n                </td>\n            </tr>\n        <?php endforeach; ?>\n    </table>\n\n    <!-- Display cart contents and checkout button -->\n    <h2>Cart Contents:</h2>\n    <ul id=\"cart-contents\">\n        <?php foreach ($order_items as $item): ?>\n            <li><?php echo $item['product_name']; ?> x<?php echo $item['quantity']; ?></li>\n        <?php endforeach; ?>\n    </ul>\n\n    <button type=\"submit\" class=\"btn btn-primary\">Checkout</button>\n</form>\n\n<script>\n    function add_to_cart(product_id) {\n        var quantity = prompt(\"Enter quantity:\", \"\");\n        if (quantity != null && !isNaN(quantity)) {\n            // Update cart contents and send AJAX request to update product stock\n            document.getElementById('cart-contents').innerHTML += '<li>' + product_name + ' x' + quantity + '</li>';\n            $.ajax({\n                type: 'POST',\n                url: '<?php echo $_SERVER['PHP_SELF']; ?>',\n                data: { order_items[]: { product_id: product_id, quantity: quantity } },\n                success: function(data) {\n                    alert(\"Product added to cart!\");\n                }\n            });\n        }\n    }\n</script>\n```\nThis code assumes you have a `db_connection.php` file that contains the database connection settings. You can modify this code to fit your specific needs.\n\n**Important Notes**\n\n* This is a basic example and should not be used in production without proper security measures (e.g., SQL injection protection).\n* You will need to modify the table schema to suit your specific use case.\n* The `order_items` array is not persisted between page reloads, so you may want to consider using sessions or cookies to store the cart contents.\n\nI hope this helps! Let me know if you have any questions or need further assistance.", "code_blocks": ["```php\n<?php\n\n// Include database connection settings\nrequire_once 'db_connection.php';\n\n// Check if user is logged in\nif (!isset($_SESSION['user_id'])) {\n    header('Location: login.php');\n    exit;\n}\n\n// Get current user's ID\n$user_id = $_SESSION['user_id'];\n\n// Get all products from database\n$products_query = \"SELECT * FROM products\";\n$products_result = mysqli_query($conn, $products_query);\n$products = array();\nwhile ($product = mysqli_fetch_assoc($products_result)) {\n    $products[] = $product;\n}\n\n// Process form submission (if any)\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n    // Get order items from form\n    $order_items = $_POST['order_items'];\n\n    // Validate order items\n    if (empty($order_items) || !is_array($order_items)) {\n        echo \"Error: Invalid order items\";\n        exit;\n    }\n\n    // Create new order\n    $order_query = \"INSERT INTO orders (user_id, total_cost) VALUES ('$user_id', 0)\";\n    mysqli_query($conn, $order_query);\n    $order_id = mysqli_insert_id($conn);\n\n    // Add each item to the order\n    foreach ($order_items as $item) {\n        $product_id = $item['product_id'];\n        $quantity = $item['quantity'];\n\n        // Update product quantity in stock\n        $product_query = \"UPDATE products SET quantity = quantity - $quantity WHERE id = '$product_id'\";\n        mysqli_query($conn, $product_query);\n\n        // Add item to order_items table\n        $order_item_query = \"INSERT INTO order_items (order_id, product_id, quantity) VALUES ('$order_id', '$product_id', '$quantity')\";\n        mysqli_query($conn, $order_item_query);\n    }\n\n    // Update total cost of the order\n    $total_cost_query = \"UPDATE orders SET total_cost = 0 WHERE id = '$order_id'\";\n    mysqli_query($conn, $total_cost_query);\n\n    echo \"Order created successfully!\";\n}\n\n?>\n\n<!-- Display products and add to cart form -->\n<h1>Purchase Products</h1>\n\n<form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\">\n    <table>\n        <?php foreach ($products as $product): ?>\n            <tr>\n                <td><?php echo $product['name']; ?></td>\n                <td>$<?php echo number_format($product['price'], 2); ?></td>\n                <td>\n                    <input type=\"number\" name=\"order_items[]\" value=\"<?php echo $product['id']; ?>\" hidden>\n                    <button type=\"button\" class=\"btn btn-primary\" onclick=\"add_to_cart(<?php echo $product['id']; ?>)\">Add to Cart</button>\n                </td>\n            </tr>\n        <?php endforeach; ?>\n    </table>\n\n    <!-- Display cart contents and checkout button -->\n    <h2>Cart Contents:</h2>\n    <ul id=\"cart-contents\">\n        <?php foreach ($order_items as $item): ?>\n            <li><?php echo $item['product_name']; ?> x<?php echo $item['quantity']; ?></li>\n        <?php endforeach; ?>\n    </ul>\n\n    <button type=\"submit\" class=\"btn btn-primary\">Checkout</button>\n</form>\n\n<script>\n    function add_to_cart(product_id) {\n        var quantity = prompt(\"Enter quantity:\", \"\");\n        if (quantity != null && !isNaN(quantity)) {\n            // Update cart contents and send AJAX request to update product stock\n            document.getElementById('cart-contents').innerHTML += '<li>' + product_name + ' x' + quantity + '</li>';\n            $.ajax({\n                type: 'POST',\n                url: '<?php echo $_SERVER['PHP_SELF']; ?>',\n                data: { order_items[]: { product_id: product_id, quantity: quantity } },\n                success: function(data) {\n                    alert(\"Product added to cart!\");\n                }\n            });\n        }\n    }\n</script>\n```"]}
