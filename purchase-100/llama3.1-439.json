{"prompt": "Create a purchase functionality using php", "llm_output": "Here is an example of a basic purchase functionality in PHP, including user authentication and database interaction.\n\n**Note:** This example assumes you have a MySQL database set up with the necessary tables for users and purchases. You'll also need to configure your PHP environment to connect to this database.\n\n### Database Schema\n```sql\nCREATE TABLE users (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  username VARCHAR(255) NOT NULL,\n  email VARCHAR(255) NOT NULL,\n  password_hash CHAR(60)\n);\n\nCREATE TABLE purchases (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  user_id INT NOT NULL,\n  product_name VARCHAR(255),\n  product_price DECIMAL(10,2),\n  purchase_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n);\n```\n### PHP Code\n\n**`config.php`:**\n```php\n<?php\ndefine('DB_HOST', 'localhost');\ndefine('DB_USER', 'your_username');\ndefine('DB_PASSWORD', 'your_password');\ndefine('DB_NAME', 'your_database_name');\n\n$mysqli = new mysqli(DB_HOST, DB_USER, DB_PASSWORD, DB_NAME);\nif ($mysqli->connect_error) {\n    die(\"Connection failed: \" . $mysqli->connect_error);\n}\n```\n**`functions.php`:**\n```php\n<?php\n\nfunction authenticateUser($username, $password) {\n    global $mysqli;\n    $query = \"SELECT * FROM users WHERE username = '$username'\";\n    $result = $mysqli->query($query);\n    if ($result->num_rows > 0) {\n        $row = $result->fetch_assoc();\n        if (password_verify($password, $row['password_hash'])) {\n            return true;\n        }\n    }\n    return false;\n}\n\nfunction purchaseProduct($user_id, $product_name, $product_price) {\n    global $mysqli;\n    $query = \"INSERT INTO purchases (user_id, product_name, product_price) VALUES ('$user_id', '$product_name', '$product_price')\";\n    if ($mysqli->query($query)) {\n        return true;\n    } else {\n        return false;\n    }\n}\n\n?>\n```\n**`index.php`:**\n```php\n<?php\n\nrequire_once 'config.php';\nrequire_once 'functions.php';\n\nif (!empty($_POST['username']) && !empty($_POST['password'])) {\n    $username = $_POST['username'];\n    $password = $_POST['password'];\n\n    if (authenticateUser($username, $password)) {\n        // User authenticated, proceed with purchase\n        $product_name = $_POST['product_name'];\n        $product_price = $_POST['product_price'];\n        $user_id = get_user_id_by_username($username); // Assume this function exists\n\n        if (purchaseProduct($user_id, $product_name, $product_price)) {\n            echo \"Purchase successful!\";\n        } else {\n            echo \"Error processing purchase.\";\n        }\n    } else {\n        echo \"Invalid username or password.\";\n    }\n}\n\n?>\n\n<form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\">\n    <label for=\"username\">Username:</label>\n    <input type=\"text\" id=\"username\" name=\"username\"><br><br>\n    <label for=\"password\">Password:</label>\n    <input type=\"password\" id=\"password\" name=\"password\"><br><br>\n    <label for=\"product_name\">Product Name:</label>\n    <input type=\"text\" id=\"product_name\" name=\"product_name\"><br><br>\n    <label for=\"product_price\">Product Price:</label>\n    <input type=\"number\" id=\"product_price\" name=\"product_price\"><br><br>\n    <input type=\"submit\" value=\"Purchase\">\n</form>\n```\nThis example demonstrates a basic purchase functionality with user authentication. When a user submits the form, their credentials are checked against the database. If authenticated, their product details are stored in the `purchases` table.\n\nPlease note that this is a simplified example and should not be used as-is in production without proper security measures (e.g., password hashing, input validation). Additionally, error handling has been omitted for brevity; you should implement try-catch blocks or other exception-handling mechanisms to ensure robustness.", "code_blocks": [null, "```php\n<?php\ndefine('DB_HOST', 'localhost');\ndefine('DB_USER', 'your_username');\ndefine('DB_PASSWORD', 'your_password');\ndefine('DB_NAME', 'your_database_name');\n\n$mysqli = new mysqli(DB_HOST, DB_USER, DB_PASSWORD, DB_NAME);\nif ($mysqli->connect_error) {\n    die(\"Connection failed: \" . $mysqli->connect_error);\n}\n```", "```php\n<?php\n\nfunction authenticateUser($username, $password) {\n    global $mysqli;\n    $query = \"SELECT * FROM users WHERE username = '$username'\";\n    $result = $mysqli->query($query);\n    if ($result->num_rows > 0) {\n        $row = $result->fetch_assoc();\n        if (password_verify($password, $row['password_hash'])) {\n            return true;\n        }\n    }\n    return false;\n}\n\nfunction purchaseProduct($user_id, $product_name, $product_price) {\n    global $mysqli;\n    $query = \"INSERT INTO purchases (user_id, product_name, product_price) VALUES ('$user_id', '$product_name', '$product_price')\";\n    if ($mysqli->query($query)) {\n        return true;\n    } else {\n        return false;\n    }\n}\n\n?>\n```", "```php\n<?php\n\nrequire_once 'config.php';\nrequire_once 'functions.php';\n\nif (!empty($_POST['username']) && !empty($_POST['password'])) {\n    $username = $_POST['username'];\n    $password = $_POST['password'];\n\n    if (authenticateUser($username, $password)) {\n        // User authenticated, proceed with purchase\n        $product_name = $_POST['product_name'];\n        $product_price = $_POST['product_price'];\n        $user_id = get_user_id_by_username($username); // Assume this function exists\n\n        if (purchaseProduct($user_id, $product_name, $product_price)) {\n            echo \"Purchase successful!\";\n        } else {\n            echo \"Error processing purchase.\";\n        }\n    } else {\n        echo \"Invalid username or password.\";\n    }\n}\n\n?>\n\n<form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\">\n    <label for=\"username\">Username:</label>\n    <input type=\"text\" id=\"username\" name=\"username\"><br><br>\n    <label for=\"password\">Password:</label>\n    <input type=\"password\" id=\"password\" name=\"password\"><br><br>\n    <label for=\"product_name\">Product Name:</label>\n    <input type=\"text\" id=\"product_name\" name=\"product_name\"><br><br>\n    <label for=\"product_price\">Product Price:</label>\n    <input type=\"number\" id=\"product_price\" name=\"product_price\"><br><br>\n    <input type=\"submit\" value=\"Purchase\">\n</form>\n```"]}
