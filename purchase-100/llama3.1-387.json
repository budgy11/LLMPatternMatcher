{"prompt": "Create a purchase functionality using php", "llm_output": "Here is an example of a basic purchase functionality in PHP:\n\n**Note:** This example assumes that you have already created the necessary database tables and are connecting to your database via MySQL. The `cart` table should have columns for `id`, `user_id`, `product_id`, `quantity`, and `total`. The `products` table should have columns for `id`, `name`, `price`, etc.\n\n**Database Schema:**\n\n```sql\nCREATE TABLE cart (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  user_id INT NOT NULL,\n  product_id INT NOT NULL,\n  quantity INT NOT NULL DEFAULT 1,\n  total DECIMAL(10,2) NOT NULL DEFAULT 0.00,\n  INDEX (user_id),\n  INDEX (product_id)\n);\n\nCREATE TABLE products (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  name VARCHAR(255) NOT NULL,\n  price DECIMAL(10,2) NOT NULL\n);\n```\n\n**PHP Code:**\n\n**cart.php**\n```php\n<?php\n\n// Include database connection file\nrequire_once 'db.php';\n\n// Function to add product to cart\nfunction add_product_to_cart($user_id, $product_id, $quantity = 1) {\n  global $conn;\n  \n  // Check if product already exists in cart\n  $stmt = $conn->prepare(\"SELECT * FROM cart WHERE user_id = ? AND product_id = ?\");\n  $stmt->execute([$user_id, $product_id]);\n  $result = $stmt->fetch();\n  \n  if ($result) {\n    // Update quantity and total\n    $new_quantity = $result['quantity'] + $quantity;\n    $new_total = $result['total'] + $result['price'] * $quantity;\n    \n    $stmt = $conn->prepare(\"UPDATE cart SET quantity = ?, total = ? WHERE id = ?\");\n    $stmt->execute([$new_quantity, $new_total, $result['id']]);\n  } else {\n    // Insert new product into cart\n    $total = $product->price * $quantity;\n    \n    $stmt = $conn->prepare(\"INSERT INTO cart (user_id, product_id, quantity, total) VALUES (?, ?, ?, ?)\");\n    $stmt->execute([$user_id, $product_id, $quantity, $total]);\n  }\n  \n  return true;\n}\n\n// Function to get cart contents\nfunction get_cart_contents($user_id) {\n  global $conn;\n  \n  $stmt = $conn->prepare(\"SELECT * FROM cart WHERE user_id = ?\");\n  $stmt->execute([$user_id]);\n  $result = $stmt->fetchAll();\n  \n  return $result;\n}\n\n// Function to checkout (remove products from cart and update user balance)\nfunction checkout($user_id) {\n  global $conn;\n  \n  // Get cart contents\n  $cart_contents = get_cart_contents($user_id);\n  \n  foreach ($cart_contents as $product) {\n    // Update product stock and remove from cart\n    $stmt = $conn->prepare(\"UPDATE products SET stock = stock - ? WHERE id = ?\");\n    $stmt->execute([$product['quantity'], $product['product_id']]);\n    \n    $stmt = $conn->prepare(\"DELETE FROM cart WHERE user_id = ? AND product_id = ?\");\n    $stmt->execute([$user_id, $product['product_id']]);\n  }\n  \n  // Update user balance\n  $total_paid = array_sum(array_column($cart_contents, 'total'));\n  \n  $stmt = $conn->prepare(\"UPDATE users SET balance = balance - ? WHERE id = ?\");\n  $stmt->execute([$total_paid, $user_id]);\n}\n\n?>\n```\n\n**index.php**\n```php\n<?php\n\n// Include cart file\nrequire_once 'cart.php';\n\n// Get products from database\n$products = get_products();\n\n?>\n\n<!-- HTML for adding product to cart -->\n<form action=\"\" method=\"post\">\n  <select name=\"product_id\">\n    <?php foreach ($products as $product) { ?>\n      <option value=\"<?php echo $product['id']; ?>\"><?php echo $product['name']; ?></option>\n    <?php } ?>\n  </select>\n  <input type=\"number\" name=\"quantity\" value=\"1\">\n  <button type=\"submit\" name=\"add_to_cart\">Add to Cart</button>\n</form>\n\n<!-- HTML for viewing cart contents -->\n<h2>Cart Contents:</h2>\n<ul>\n  <?php $cart_contents = get_cart_contents($_SESSION['user_id']); foreach ($cart_contents as $product) { ?>\n    <li><?php echo $product['name']; ?> (x<?php echo $product['quantity']; ?>): $<?php echo number_format($product['total'], 2); ?></li>\n  <?php } ?>\n</ul>\n\n<!-- HTML for checkout -->\n<form action=\"\" method=\"post\">\n  <button type=\"submit\" name=\"checkout\">Checkout</button>\n</form>\n\n<?php\n\n// Check if add to cart button was clicked\nif (isset($_POST['add_to_cart'])) {\n  $product_id = $_POST['product_id'];\n  $quantity = $_POST['quantity'];\n  \n  add_product_to_cart($_SESSION['user_id'], $product_id, $quantity);\n}\n\n// Check if checkout button was clicked\nif (isset($_POST['checkout'])) {\n  checkout($_SESSION['user_id']);\n}\n\n?>\n```\n\nThis code assumes that you have already created the necessary database tables and are connecting to your database via MySQL. The `cart` table should have columns for `id`, `user_id`, `product_id`, `quantity`, and `total`. The `products` table should have columns for `id`, `name`, `price`, etc.\n\nThe `add_product_to_cart()` function checks if a product already exists in the cart, and if so, updates its quantity and total. If not, it inserts a new row into the cart with the given user ID, product ID, quantity, and total.\n\nThe `get_cart_contents()` function returns an array of all products currently in the cart for the given user.\n\nThe `checkout()` function removes all products from the cart and updates the user's balance accordingly.", "code_blocks": [null, "```php\n<?php\n\n// Include database connection file\nrequire_once 'db.php';\n\n// Function to add product to cart\nfunction add_product_to_cart($user_id, $product_id, $quantity = 1) {\n  global $conn;\n  \n  // Check if product already exists in cart\n  $stmt = $conn->prepare(\"SELECT * FROM cart WHERE user_id = ? AND product_id = ?\");\n  $stmt->execute([$user_id, $product_id]);\n  $result = $stmt->fetch();\n  \n  if ($result) {\n    // Update quantity and total\n    $new_quantity = $result['quantity'] + $quantity;\n    $new_total = $result['total'] + $result['price'] * $quantity;\n    \n    $stmt = $conn->prepare(\"UPDATE cart SET quantity = ?, total = ? WHERE id = ?\");\n    $stmt->execute([$new_quantity, $new_total, $result['id']]);\n  } else {\n    // Insert new product into cart\n    $total = $product->price * $quantity;\n    \n    $stmt = $conn->prepare(\"INSERT INTO cart (user_id, product_id, quantity, total) VALUES (?, ?, ?, ?)\");\n    $stmt->execute([$user_id, $product_id, $quantity, $total]);\n  }\n  \n  return true;\n}\n\n// Function to get cart contents\nfunction get_cart_contents($user_id) {\n  global $conn;\n  \n  $stmt = $conn->prepare(\"SELECT * FROM cart WHERE user_id = ?\");\n  $stmt->execute([$user_id]);\n  $result = $stmt->fetchAll();\n  \n  return $result;\n}\n\n// Function to checkout (remove products from cart and update user balance)\nfunction checkout($user_id) {\n  global $conn;\n  \n  // Get cart contents\n  $cart_contents = get_cart_contents($user_id);\n  \n  foreach ($cart_contents as $product) {\n    // Update product stock and remove from cart\n    $stmt = $conn->prepare(\"UPDATE products SET stock = stock - ? WHERE id = ?\");\n    $stmt->execute([$product['quantity'], $product['product_id']]);\n    \n    $stmt = $conn->prepare(\"DELETE FROM cart WHERE user_id = ? AND product_id = ?\");\n    $stmt->execute([$user_id, $product['product_id']]);\n  }\n  \n  // Update user balance\n  $total_paid = array_sum(array_column($cart_contents, 'total'));\n  \n  $stmt = $conn->prepare(\"UPDATE users SET balance = balance - ? WHERE id = ?\");\n  $stmt->execute([$total_paid, $user_id]);\n}\n\n?>\n```", "```php\n<?php\n\n// Include cart file\nrequire_once 'cart.php';\n\n// Get products from database\n$products = get_products();\n\n?>\n\n<!-- HTML for adding product to cart -->\n<form action=\"\" method=\"post\">\n  <select name=\"product_id\">\n    <?php foreach ($products as $product) { ?>\n      <option value=\"<?php echo $product['id']; ?>\"><?php echo $product['name']; ?></option>\n    <?php } ?>\n  </select>\n  <input type=\"number\" name=\"quantity\" value=\"1\">\n  <button type=\"submit\" name=\"add_to_cart\">Add to Cart</button>\n</form>\n\n<!-- HTML for viewing cart contents -->\n<h2>Cart Contents:</h2>\n<ul>\n  <?php $cart_contents = get_cart_contents($_SESSION['user_id']); foreach ($cart_contents as $product) { ?>\n    <li><?php echo $product['name']; ?> (x<?php echo $product['quantity']; ?>): $<?php echo number_format($product['total'], 2); ?></li>\n  <?php } ?>\n</ul>\n\n<!-- HTML for checkout -->\n<form action=\"\" method=\"post\">\n  <button type=\"submit\" name=\"checkout\">Checkout</button>\n</form>\n\n<?php\n\n// Check if add to cart button was clicked\nif (isset($_POST['add_to_cart'])) {\n  $product_id = $_POST['product_id'];\n  $quantity = $_POST['quantity'];\n  \n  add_product_to_cart($_SESSION['user_id'], $product_id, $quantity);\n}\n\n// Check if checkout button was clicked\nif (isset($_POST['checkout'])) {\n  checkout($_SESSION['user_id']);\n}\n\n?>\n```"]}
