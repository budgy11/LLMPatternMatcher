{"prompt": "Create a purchase functionality using php", "llm_output": "Here's an example of a basic purchase functionality in PHP, using MySQL as the database. This example includes user registration, login, and shopping cart features.\n\n**Database Setup:**\n\nFirstly, create a MySQL database with the following tables:\n\n```sql\nCREATE TABLE users (\n    id INT PRIMARY KEY AUTO_INCREMENT,\n    username VARCHAR(50) NOT NULL,\n    email VARCHAR(100) NOT NULL,\n    password VARCHAR(255) NOT NULL\n);\n\nCREATE TABLE products (\n    id INT PRIMARY KEY AUTO_INCREMENT,\n    name VARCHAR(100) NOT NULL,\n    price DECIMAL(10,2) NOT NULL\n);\n\nCREATE TABLE orders (\n    id INT PRIMARY KEY AUTO_INCREMENT,\n    user_id INT NOT NULL,\n    total DECIMAL(10,2) NOT NULL,\n    status ENUM('pending', 'shipped', 'delivered') NOT NULL DEFAULT 'pending',\n    FOREIGN KEY (user_id) REFERENCES users(id)\n);\n\nCREATE TABLE order_items (\n    id INT PRIMARY KEY AUTO_INCREMENT,\n    order_id INT NOT NULL,\n    product_id INT NOT NULL,\n    quantity INT NOT NULL,\n    FOREIGN KEY (order_id) REFERENCES orders(id),\n    FOREIGN KEY (product_id) REFERENCES products(id)\n);\n```\n\n**PHP Code:**\n\nCreate a file named `config.php` to store database credentials and other constants:\n\n```php\n<?php\n\ndefine('DB_HOST', 'localhost');\ndefine('DB_USERNAME', 'your_username');\ndefine('DB_PASSWORD', 'your_password');\ndefine('DB_NAME', 'your_database_name');\n\n?>\n```\n\nCreate a file named `functions.php` to store common functions used across the application:\n\n```php\n<?php\n\nfunction getProducts() {\n    $conn = mysqli_connect(DB_HOST, DB_USERNAME, DB_PASSWORD, DB_NAME);\n    if (!$conn) {\n        die(\"Connection failed: \" . mysqli_connect_error());\n    }\n    \n    $query = \"SELECT * FROM products\";\n    $result = mysqli_query($conn, $query);\n    \n    while ($row = mysqli_fetch_assoc($result)) {\n        echo \"<div>\" . $row['name'] . \": $\" . $row['price'] . \"</div>\";\n    }\n    \n    mysqli_close($conn);\n}\n\nfunction getUserOrders() {\n    $conn = mysqli_connect(DB_HOST, DB_USERNAME, DB_PASSWORD, DB_NAME);\n    if (!$conn) {\n        die(\"Connection failed: \" . mysqli_connect_error());\n    }\n    \n    $query = \"SELECT * FROM orders WHERE user_id = '\" . $_SESSION['id'] . \"'\";\n    $result = mysqli_query($conn, $query);\n    \n    while ($row = mysqli_fetch_assoc($result)) {\n        echo \"<div>\" . $row['total'] . \"</div>\";\n    }\n    \n    mysqli_close($conn);\n}\n\nfunction addProductToCart() {\n    if (isset($_SESSION['cart'])) {\n        $_SESSION['cart'][] = array('product_id' => $_POST['product_id'], 'quantity' => $_POST['quantity']);\n    } else {\n        $_SESSION['cart'] = array(array('product_id' => $_POST['product_id'], 'quantity' => $_POST['quantity']));\n    }\n}\n\nfunction checkout() {\n    if (!isset($_SESSION['id'])) {\n        echo \"Please login to checkout.\";\n        return;\n    }\n    \n    $conn = mysqli_connect(DB_HOST, DB_USERNAME, DB_PASSWORD, DB_NAME);\n    if (!$conn) {\n        die(\"Connection failed: \" . mysqli_connect_error());\n    }\n    \n    $query = \"INSERT INTO orders (user_id, total) VALUES ('\" . $_SESSION['id'] . \"', '\" . $_POST['total'] . \"')\";\n    mysqli_query($conn, $query);\n    \n    $order_id = mysqli_insert_id($conn);\n    \n    foreach ($_SESSION['cart'] as $item) {\n        $query = \"INSERT INTO order_items (order_id, product_id, quantity) VALUES ('\" . $order_id . \"', '\" . $item['product_id'] . \"', '\" . $item['quantity'] . \"')\";\n        mysqli_query($conn, $query);\n    }\n    \n    unset($_SESSION['cart']);\n    \n    echo \"Order placed successfully.\";\n    \n    mysqli_close($conn);\n}\n\n?>\n```\n\nCreate a file named `index.php` to handle user registration and login:\n\n```php\n<?php\n\nrequire_once 'config.php';\nrequire_once 'functions.php';\n\nif (isset($_POST['register'])) {\n    $username = $_POST['username'];\n    $email = $_POST['email'];\n    $password = password_hash($_POST['password'], PASSWORD_DEFAULT);\n    \n    $conn = mysqli_connect(DB_HOST, DB_USERNAME, DB_PASSWORD, DB_NAME);\n    if (!$conn) {\n        die(\"Connection failed: \" . mysqli_connect_error());\n    }\n    \n    $query = \"INSERT INTO users (username, email, password) VALUES ('\" . $username . \"', '\" . $email . \"', '\" . $password . \"')\";\n    mysqli_query($conn, $query);\n    \n    echo \"User registered successfully.\";\n}\n\nif (isset($_POST['login'])) {\n    $username = $_POST['username'];\n    $password = $_POST['password'];\n    \n    $conn = mysqli_connect(DB_HOST, DB_USERNAME, DB_PASSWORD, DB_NAME);\n    if (!$conn) {\n        die(\"Connection failed: \" . mysqli_connect_error());\n    }\n    \n    $query = \"SELECT * FROM users WHERE username = '\" . $username . \"'\";\n    $result = mysqli_query($conn, $query);\n    \n    while ($row = mysqli_fetch_assoc($result)) {\n        if (password_verify($password, $row['password'])) {\n            $_SESSION['id'] = $row['id'];\n        }\n    }\n}\n\n?>\n\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Shop</title>\n</head>\n<body>\n\n<h1>Register</h1>\n\n<form action=\"\" method=\"post\">\n    <input type=\"text\" name=\"username\" placeholder=\"Username\"><br><br>\n    <input type=\"email\" name=\"email\" placeholder=\"Email\"><br><br>\n    <input type=\"password\" name=\"password\" placeholder=\"Password\"><br><br>\n    <button type=\"submit\" name=\"register\">Register</button>\n</form>\n\n<h1>Login</h1>\n\n<form action=\"\" method=\"post\">\n    <input type=\"text\" name=\"username\" placeholder=\"Username\"><br><br>\n    <input type=\"password\" name=\"password\" placeholder=\"Password\"><br><br>\n    <button type=\"submit\" name=\"login\">Login</button>\n</form>\n\n<?php\n\nif (isset($_SESSION['id'])) {\n    echo \"<h1>Welcome \" . $_SESSION['username'] . \"</h1>\";\n}\n\n?>\n\n<h1>Products</h1>\n\n<div id=\"products\"></div>\n\n<script>\n    fetch('getProducts.php')\n        .then(response => response.text())\n        .then(data => document.getElementById('products').innerHTML = data);\n</script>\n\n<?php\n\nif (isset($_SESSION['id'])) {\n    echo \"<button onclick='location.href=\\\"cart.php\\\"'>View Cart</button>\";\n}\n\n?>\n\n</body>\n</html>\n```\n\nCreate a file named `cart.php` to handle user cart:\n\n```php\n<?php\n\nrequire_once 'config.php';\nrequire_once 'functions.php';\n\n?>\n\n<h1>Cart</h1>\n\n<div id=\"cart\"></div>\n\n<script>\n    fetch('getCart.php')\n        .then(response => response.text())\n        .then(data => document.getElementById('cart').innerHTML = data);\n    \n    function addProductToCart(product_id, quantity) {\n        fetch('addProductToCart.php', {\n            method: 'POST',\n            headers: {\n                'Content-Type': 'application/json'\n            },\n            body: JSON.stringify({\n                product_id,\n                quantity\n            })\n        })\n        .then(response => response.text())\n        .then(data => document.getElementById('cart').innerHTML = data);\n    }\n</script>\n\n<?php\n\nif (isset($_SESSION['id'])) {\n    echo \"<button onclick='location.href=\\\"checkout.php\\\"'>Checkout</button>\";\n}\n\n?>\n\n</body>\n</html>\n```\n\nCreate a file named `checkout.php` to handle user checkout:\n\n```php\n<?php\n\nrequire_once 'config.php';\nrequire_once 'functions.php';\n\nif (isset($_POST['place_order'])) {\n    $total = $_POST['total'];\n    \n    checkout();\n}\n\n?>\n\n<h1>Checkout</h1>\n\n<form action=\"\" method=\"post\">\n    <input type=\"hidden\" name=\"total\" value=\"<?php echo $_SESSION['cart_total']; ?>\">\n    <button type=\"submit\" name=\"place_order\">Place Order</button>\n</form>\n\n<?php\n\nif (isset($_SESSION['id'])) {\n    echo \"<button onclick='location.href=\\\"cart.php\\\"'>View Cart</button>\";\n}\n\n?>\n\n</body>\n</html>\n```\n\n**Add Product to Cart Functionality:**\n\nCreate a file named `addProductToCart.php` to handle adding products to the cart:\n\n```php\n<?php\n\nrequire_once 'config.php';\nrequire_once 'functions.php';\n\nif (isset($_POST['product_id']) && isset($_POST['quantity'])) {\n    addProductToCart();\n}\n\n?>\n```\n\n**Get Cart Functionality:**\n\nCreate a file named `getCart.php` to handle displaying the cart:\n\n```php\n<?php\n\nrequire_once 'config.php';\nrequire_once 'functions.php';\n\nif (isset($_SESSION['cart'])) {\n    $cart_total = 0;\n    \n    foreach ($_SESSION['cart'] as $item) {\n        $query = \"SELECT price FROM products WHERE id = '\" . $item['product_id'] . \"'\";\n        $result = mysqli_query($conn, $query);\n        \n        while ($row = mysqli_fetch_assoc($result)) {\n            $cart_total += $row['price'] * $item['quantity'];\n        }\n    }\n    \n    echo \"Cart Total: $\" . $cart_total;\n} else {\n    echo \"No products in cart.\";\n}\n\n?>\n```\n\nThis is a basic example of a purchase functionality using PHP and MySQL. You can expand upon this by adding more features, such as product variations, shipping options, and payment gateways.\n\nRemember to replace the placeholders (`your_username`, `your_password`, `your_database_name`) with your actual database credentials.", "code_blocks": [null, "```php\n<?php\n\ndefine('DB_HOST', 'localhost');\ndefine('DB_USERNAME', 'your_username');\ndefine('DB_PASSWORD', 'your_password');\ndefine('DB_NAME', 'your_database_name');\n\n?>\n```", "```php\n<?php\n\nfunction getProducts() {\n    $conn = mysqli_connect(DB_HOST, DB_USERNAME, DB_PASSWORD, DB_NAME);\n    if (!$conn) {\n        die(\"Connection failed: \" . mysqli_connect_error());\n    }\n    \n    $query = \"SELECT * FROM products\";\n    $result = mysqli_query($conn, $query);\n    \n    while ($row = mysqli_fetch_assoc($result)) {\n        echo \"<div>\" . $row['name'] . \": $\" . $row['price'] . \"</div>\";\n    }\n    \n    mysqli_close($conn);\n}\n\nfunction getUserOrders() {\n    $conn = mysqli_connect(DB_HOST, DB_USERNAME, DB_PASSWORD, DB_NAME);\n    if (!$conn) {\n        die(\"Connection failed: \" . mysqli_connect_error());\n    }\n    \n    $query = \"SELECT * FROM orders WHERE user_id = '\" . $_SESSION['id'] . \"'\";\n    $result = mysqli_query($conn, $query);\n    \n    while ($row = mysqli_fetch_assoc($result)) {\n        echo \"<div>\" . $row['total'] . \"</div>\";\n    }\n    \n    mysqli_close($conn);\n}\n\nfunction addProductToCart() {\n    if (isset($_SESSION['cart'])) {\n        $_SESSION['cart'][] = array('product_id' => $_POST['product_id'], 'quantity' => $_POST['quantity']);\n    } else {\n        $_SESSION['cart'] = array(array('product_id' => $_POST['product_id'], 'quantity' => $_POST['quantity']));\n    }\n}\n\nfunction checkout() {\n    if (!isset($_SESSION['id'])) {\n        echo \"Please login to checkout.\";\n        return;\n    }\n    \n    $conn = mysqli_connect(DB_HOST, DB_USERNAME, DB_PASSWORD, DB_NAME);\n    if (!$conn) {\n        die(\"Connection failed: \" . mysqli_connect_error());\n    }\n    \n    $query = \"INSERT INTO orders (user_id, total) VALUES ('\" . $_SESSION['id'] . \"', '\" . $_POST['total'] . \"')\";\n    mysqli_query($conn, $query);\n    \n    $order_id = mysqli_insert_id($conn);\n    \n    foreach ($_SESSION['cart'] as $item) {\n        $query = \"INSERT INTO order_items (order_id, product_id, quantity) VALUES ('\" . $order_id . \"', '\" . $item['product_id'] . \"', '\" . $item['quantity'] . \"')\";\n        mysqli_query($conn, $query);\n    }\n    \n    unset($_SESSION['cart']);\n    \n    echo \"Order placed successfully.\";\n    \n    mysqli_close($conn);\n}\n\n?>\n```", "```php\n<?php\n\nrequire_once 'config.php';\nrequire_once 'functions.php';\n\nif (isset($_POST['register'])) {\n    $username = $_POST['username'];\n    $email = $_POST['email'];\n    $password = password_hash($_POST['password'], PASSWORD_DEFAULT);\n    \n    $conn = mysqli_connect(DB_HOST, DB_USERNAME, DB_PASSWORD, DB_NAME);\n    if (!$conn) {\n        die(\"Connection failed: \" . mysqli_connect_error());\n    }\n    \n    $query = \"INSERT INTO users (username, email, password) VALUES ('\" . $username . \"', '\" . $email . \"', '\" . $password . \"')\";\n    mysqli_query($conn, $query);\n    \n    echo \"User registered successfully.\";\n}\n\nif (isset($_POST['login'])) {\n    $username = $_POST['username'];\n    $password = $_POST['password'];\n    \n    $conn = mysqli_connect(DB_HOST, DB_USERNAME, DB_PASSWORD, DB_NAME);\n    if (!$conn) {\n        die(\"Connection failed: \" . mysqli_connect_error());\n    }\n    \n    $query = \"SELECT * FROM users WHERE username = '\" . $username . \"'\";\n    $result = mysqli_query($conn, $query);\n    \n    while ($row = mysqli_fetch_assoc($result)) {\n        if (password_verify($password, $row['password'])) {\n            $_SESSION['id'] = $row['id'];\n        }\n    }\n}\n\n?>\n\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Shop</title>\n</head>\n<body>\n\n<h1>Register</h1>\n\n<form action=\"\" method=\"post\">\n    <input type=\"text\" name=\"username\" placeholder=\"Username\"><br><br>\n    <input type=\"email\" name=\"email\" placeholder=\"Email\"><br><br>\n    <input type=\"password\" name=\"password\" placeholder=\"Password\"><br><br>\n    <button type=\"submit\" name=\"register\">Register</button>\n</form>\n\n<h1>Login</h1>\n\n<form action=\"\" method=\"post\">\n    <input type=\"text\" name=\"username\" placeholder=\"Username\"><br><br>\n    <input type=\"password\" name=\"password\" placeholder=\"Password\"><br><br>\n    <button type=\"submit\" name=\"login\">Login</button>\n</form>\n\n<?php\n\nif (isset($_SESSION['id'])) {\n    echo \"<h1>Welcome \" . $_SESSION['username'] . \"</h1>\";\n}\n\n?>\n\n<h1>Products</h1>\n\n<div id=\"products\"></div>\n\n<script>\n    fetch('getProducts.php')\n        .then(response => response.text())\n        .then(data => document.getElementById('products').innerHTML = data);\n</script>\n\n<?php\n\nif (isset($_SESSION['id'])) {\n    echo \"<button onclick='location.href=\\\"cart.php\\\"'>View Cart</button>\";\n}\n\n?>\n\n</body>\n</html>\n```", "```php\n<?php\n\nrequire_once 'config.php';\nrequire_once 'functions.php';\n\n?>\n\n<h1>Cart</h1>\n\n<div id=\"cart\"></div>\n\n<script>\n    fetch('getCart.php')\n        .then(response => response.text())\n        .then(data => document.getElementById('cart').innerHTML = data);\n    \n    function addProductToCart(product_id, quantity) {\n        fetch('addProductToCart.php', {\n            method: 'POST',\n            headers: {\n                'Content-Type': 'application/json'\n            },\n            body: JSON.stringify({\n                product_id,\n                quantity\n            })\n        })\n        .then(response => response.text())\n        .then(data => document.getElementById('cart').innerHTML = data);\n    }\n</script>\n\n<?php\n\nif (isset($_SESSION['id'])) {\n    echo \"<button onclick='location.href=\\\"checkout.php\\\"'>Checkout</button>\";\n}\n\n?>\n\n</body>\n</html>\n```", "```php\n<?php\n\nrequire_once 'config.php';\nrequire_once 'functions.php';\n\nif (isset($_POST['place_order'])) {\n    $total = $_POST['total'];\n    \n    checkout();\n}\n\n?>\n\n<h1>Checkout</h1>\n\n<form action=\"\" method=\"post\">\n    <input type=\"hidden\" name=\"total\" value=\"<?php echo $_SESSION['cart_total']; ?>\">\n    <button type=\"submit\" name=\"place_order\">Place Order</button>\n</form>\n\n<?php\n\nif (isset($_SESSION['id'])) {\n    echo \"<button onclick='location.href=\\\"cart.php\\\"'>View Cart</button>\";\n}\n\n?>\n\n</body>\n</html>\n```", "```php\n<?php\n\nrequire_once 'config.php';\nrequire_once 'functions.php';\n\nif (isset($_POST['product_id']) && isset($_POST['quantity'])) {\n    addProductToCart();\n}\n\n?>\n```", "```php\n<?php\n\nrequire_once 'config.php';\nrequire_once 'functions.php';\n\nif (isset($_SESSION['cart'])) {\n    $cart_total = 0;\n    \n    foreach ($_SESSION['cart'] as $item) {\n        $query = \"SELECT price FROM products WHERE id = '\" . $item['product_id'] . \"'\";\n        $result = mysqli_query($conn, $query);\n        \n        while ($row = mysqli_fetch_assoc($result)) {\n            $cart_total += $row['price'] * $item['quantity'];\n        }\n    }\n    \n    echo \"Cart Total: $\" . $cart_total;\n} else {\n    echo \"No products in cart.\";\n}\n\n?>\n```"]}
