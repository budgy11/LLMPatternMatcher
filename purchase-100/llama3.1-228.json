{"prompt": "Create a purchase functionality using php", "llm_output": "Here's an example of how you can create a simple purchase functionality using PHP:\n\n**Database Schema**\n```sql\nCREATE TABLE users (\n  id INT PRIMARY KEY,\n  name VARCHAR(255),\n  email VARCHAR(255)\n);\n\nCREATE TABLE products (\n  id INT PRIMARY KEY,\n  name VARCHAR(255),\n  price DECIMAL(10,2)\n);\n\nCREATE TABLE orders (\n  id INT PRIMARY KEY,\n  user_id INT,\n  order_date DATE,\n  total_cost DECIMAL(10,2)\n);\n\nCREATE TABLE order_items (\n  id INT PRIMARY KEY,\n  order_id INT,\n  product_id INT,\n  quantity INT\n);\n```\n**PHP Code**\n```php\n<?php\n\n// Configuration\n$db_host = 'localhost';\n$db_username = 'username';\n$db_password = 'password';\n$db_name = 'database';\n\n// Connect to database\n$conn = mysqli_connect($db_host, $db_username, $db_password, $db_name);\n\nif (!$conn) {\n    die(\"Connection failed: \" . mysqli_connect_error());\n}\n\n// Function to add user\nfunction addUser($name, $email) {\n  global $conn;\n  $query = \"INSERT INTO users (name, email) VALUES ('$name', '$email')\";\n  return mysqli_query($conn, $query);\n}\n\n// Function to get product by ID\nfunction getProductById($id) {\n  global $conn;\n  $query = \"SELECT * FROM products WHERE id = '$id'\";\n  $result = mysqli_query($conn, $query);\n  if (mysqli_num_rows($result) > 0) {\n    return mysqli_fetch_assoc($result);\n  } else {\n    return null;\n  }\n}\n\n// Function to add product to cart\nfunction addToCart($user_id, $product_id, $quantity) {\n  global $conn;\n  $query = \"INSERT INTO order_items (order_id, product_id, quantity) VALUES ('$user_id', '$product_id', '$quantity')\";\n  return mysqli_query($conn, $query);\n}\n\n// Function to checkout\nfunction checkout() {\n  global $conn;\n  // Get user ID and cart contents\n  $user_id = $_SESSION['user_id'];\n  $cart_contents = getOrderItemsForUser($user_id);\n\n  // Calculate total cost\n  $total_cost = 0;\n  foreach ($cart_contents as $item) {\n    $product_price = getProductById($item['product_id'])['price'];\n    $total_cost += $product_price * $item['quantity'];\n  }\n\n  // Create new order\n  $order_date = date('Y-m-d');\n  $query = \"INSERT INTO orders (user_id, order_date, total_cost) VALUES ('$user_id', '$order_date', '$total_cost')\";\n  mysqli_query($conn, $query);\n\n  // Update cart contents to mark as ordered\n  foreach ($cart_contents as $item) {\n    $query = \"UPDATE order_items SET is_ordered = '1' WHERE id = '$item['id']'\";\n    mysqli_query($conn, $query);\n  }\n\n  // Return success message\n  return array('message' => 'Order created successfully!', 'order_id' => mysqli_insert_id($conn));\n}\n\n// Function to get cart contents for user\nfunction getOrderItemsForUser($user_id) {\n  global $conn;\n  $query = \"SELECT * FROM order_items WHERE user_id = '$user_id'\";\n  return mysqli_query($conn, $query);\n}\n\n?>\n```\n**Example Usage**\n\n```php\n<?php\n\n// Assume we have a form with the following fields:\n// - name (for new user)\n// - email (for new user)\n// - product_id (for adding to cart)\n// - quantity (for adding to cart)\n\nif (isset($_POST['submit'])) {\n  // Add new user\n  addUser($_POST['name'], $_POST['email']);\n\n  // Get product details\n  $product = getProductById($_POST['product_id']);\n  if ($product) {\n    // Add product to cart\n    addToCart($_SESSION['user_id'], $_POST['product_id'], $_POST['quantity']);\n  }\n}\n\n// Checkout functionality\nif (isset($_POST['checkout'])) {\n  $result = checkout();\n  print_r($result);\n}\n?>\n\n<form method=\"post\">\n  <input type=\"text\" name=\"name\" placeholder=\"Name\">\n  <input type=\"email\" name=\"email\" placeholder=\"Email\">\n  <select name=\"product_id\">\n    <?php foreach (getProducts() as $product) { ?>\n      <option value=\"<?php echo $product['id']; ?>\"><?php echo $product['name']; ?></option>\n    <?php } ?>\n  </select>\n  <input type=\"number\" name=\"quantity\" placeholder=\"Quantity\">\n  <button type=\"submit\" name=\"submit\">Add to Cart</button>\n\n  <form method=\"post\">\n    <button type=\"submit\" name=\"checkout\">Checkout</button>\n  </form>\n</form>\n```\nNote that this is a very basic implementation and you should add proper validation, error handling and security measures (e.g., prepared statements) before using it in production.\n\nAlso, the `getProducts()` function is not implemented here, but you would need to create a similar function to retrieve all products from the database.", "code_blocks": [null, "```php\n<?php\n\n// Configuration\n$db_host = 'localhost';\n$db_username = 'username';\n$db_password = 'password';\n$db_name = 'database';\n\n// Connect to database\n$conn = mysqli_connect($db_host, $db_username, $db_password, $db_name);\n\nif (!$conn) {\n    die(\"Connection failed: \" . mysqli_connect_error());\n}\n\n// Function to add user\nfunction addUser($name, $email) {\n  global $conn;\n  $query = \"INSERT INTO users (name, email) VALUES ('$name', '$email')\";\n  return mysqli_query($conn, $query);\n}\n\n// Function to get product by ID\nfunction getProductById($id) {\n  global $conn;\n  $query = \"SELECT * FROM products WHERE id = '$id'\";\n  $result = mysqli_query($conn, $query);\n  if (mysqli_num_rows($result) > 0) {\n    return mysqli_fetch_assoc($result);\n  } else {\n    return null;\n  }\n}\n\n// Function to add product to cart\nfunction addToCart($user_id, $product_id, $quantity) {\n  global $conn;\n  $query = \"INSERT INTO order_items (order_id, product_id, quantity) VALUES ('$user_id', '$product_id', '$quantity')\";\n  return mysqli_query($conn, $query);\n}\n\n// Function to checkout\nfunction checkout() {\n  global $conn;\n  // Get user ID and cart contents\n  $user_id = $_SESSION['user_id'];\n  $cart_contents = getOrderItemsForUser($user_id);\n\n  // Calculate total cost\n  $total_cost = 0;\n  foreach ($cart_contents as $item) {\n    $product_price = getProductById($item['product_id'])['price'];\n    $total_cost += $product_price * $item['quantity'];\n  }\n\n  // Create new order\n  $order_date = date('Y-m-d');\n  $query = \"INSERT INTO orders (user_id, order_date, total_cost) VALUES ('$user_id', '$order_date', '$total_cost')\";\n  mysqli_query($conn, $query);\n\n  // Update cart contents to mark as ordered\n  foreach ($cart_contents as $item) {\n    $query = \"UPDATE order_items SET is_ordered = '1' WHERE id = '$item['id']'\";\n    mysqli_query($conn, $query);\n  }\n\n  // Return success message\n  return array('message' => 'Order created successfully!', 'order_id' => mysqli_insert_id($conn));\n}\n\n// Function to get cart contents for user\nfunction getOrderItemsForUser($user_id) {\n  global $conn;\n  $query = \"SELECT * FROM order_items WHERE user_id = '$user_id'\";\n  return mysqli_query($conn, $query);\n}\n\n?>\n```", "```php\n<?php\n\n// Assume we have a form with the following fields:\n// - name (for new user)\n// - email (for new user)\n// - product_id (for adding to cart)\n// - quantity (for adding to cart)\n\nif (isset($_POST['submit'])) {\n  // Add new user\n  addUser($_POST['name'], $_POST['email']);\n\n  // Get product details\n  $product = getProductById($_POST['product_id']);\n  if ($product) {\n    // Add product to cart\n    addToCart($_SESSION['user_id'], $_POST['product_id'], $_POST['quantity']);\n  }\n}\n\n// Checkout functionality\nif (isset($_POST['checkout'])) {\n  $result = checkout();\n  print_r($result);\n}\n?>\n\n<form method=\"post\">\n  <input type=\"text\" name=\"name\" placeholder=\"Name\">\n  <input type=\"email\" name=\"email\" placeholder=\"Email\">\n  <select name=\"product_id\">\n    <?php foreach (getProducts() as $product) { ?>\n      <option value=\"<?php echo $product['id']; ?>\"><?php echo $product['name']; ?></option>\n    <?php } ?>\n  </select>\n  <input type=\"number\" name=\"quantity\" placeholder=\"Quantity\">\n  <button type=\"submit\" name=\"submit\">Add to Cart</button>\n\n  <form method=\"post\">\n    <button type=\"submit\" name=\"checkout\">Checkout</button>\n  </form>\n</form>\n```"]}
