{"prompt": "Create a purchase functionality using php", "llm_output": "**Purchase Functionality in PHP**\n=====================================\n\nThis example demonstrates a basic purchase functionality using PHP, including user authentication and order processing. We'll use a simple database to store users and orders.\n\n**Database Setup**\n-------------------\n\nFirst, create a database named `shop` with the following tables:\n\n```sql\nCREATE TABLE users (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  name VARCHAR(255),\n  email VARCHAR(255) UNIQUE,\n  password VARCHAR(255)\n);\n\nCREATE TABLE orders (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  user_id INT,\n  product_name VARCHAR(255),\n  quantity INT,\n  total DECIMAL(10, 2),\n  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n);\n```\n\n**User Authentication**\n-----------------------\n\nCreate a `login.php` file to handle user authentication:\n\n```php\n<?php\n\n// Database connection settings\n$host = 'localhost';\n$username = 'root';\n$password = '';\n$dbname = 'shop';\n\n// Establish database connection\n$conn = new mysqli($host, $username, $password, $dbname);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Process login form submission\nif (isset($_POST['submit'])) {\n    $email = $_POST['email'];\n    $password = $_POST['password'];\n\n    // Query database for user credentials\n    $query = \"SELECT * FROM users WHERE email = '$email'\";\n    $result = $conn->query($query);\n\n    if ($result->num_rows > 0) {\n        while ($row = $result->fetch_assoc()) {\n            if (password_verify($password, $row['password'])) {\n                // Login successful\n                session_start();\n                $_SESSION['user_id'] = $row['id'];\n                header('Location: products.php');\n                exit;\n            }\n        }\n    }\n\n    echo \"Invalid email or password\";\n}\n\n// Close database connection\n$conn->close();\n\n?>\n```\n\n**Products**\n-------------\n\nCreate a `products.php` file to display available products:\n\n```php\n<?php\n\n// Retrieve product data from database\n$query = \"SELECT * FROM products\";\n$result = $conn->query($query);\n\n?>\n\n<h1>Available Products</h1>\n\n<ul>\n    <?php while ($row = $result->fetch_assoc()) { ?>\n        <li>\n            <?php echo $row['name']; ?> (<?php echo $row['price']; ?>)\n            <a href=\"cart.php?product_id=<?php echo $row['id']; ?>\">Add to Cart</a>\n        </li>\n    <?php } ?>\n</ul>\n\n<?php\n$conn->close();\n?>\n```\n\n**Cart**\n---------\n\nCreate a `cart.php` file to handle product additions:\n\n```php\n<?php\n\n// Retrieve cart data from session\nif (isset($_SESSION['user_id'])) {\n    $user_id = $_SESSION['user_id'];\n\n    // Query database for cart items\n    $query = \"SELECT * FROM cart WHERE user_id = '$user_id'\";\n    $result = $conn->query($query);\n\n    if ($result->num_rows > 0) {\n        while ($row = $result->fetch_assoc()) {\n            echo \"Product: \" . $row['product_name'] . \", Quantity: \" . $row['quantity'];\n        }\n    }\n}\n\n// Add product to cart\nif (isset($_GET['product_id'])) {\n    $product_id = $_GET['product_id'];\n\n    // Update cart database with new item\n    $query = \"INSERT INTO cart (user_id, product_id) VALUES ('$user_id', '$product_id')\";\n    $conn->query($query);\n\n    echo \"Product added to cart!\";\n}\n\n// Close database connection\n$conn->close();\n\n?>\n```\n\n**Checkout**\n-------------\n\nCreate a `checkout.php` file to process order creation:\n\n```php\n<?php\n\n// Retrieve user ID from session\n$user_id = $_SESSION['user_id'];\n\n// Query database for total cost\n$query = \"SELECT SUM(quantity * price) AS total FROM cart WHERE user_id = '$user_id'\";\n$result = $conn->query($query);\n\nif ($result->num_rows > 0) {\n    while ($row = $result->fetch_assoc()) {\n        $total = $row['total'];\n    }\n}\n\n// Create order in database\n$query = \"INSERT INTO orders (user_id, total) VALUES ('$user_id', '$total')\";\n$conn->query($query);\n\necho \"Order created!\";\n\n// Empty cart and close connection\n$query = \"DELETE FROM cart WHERE user_id = '$user_id'\";\n$conn->query($query);\n$conn->close();\n\n?>\n```\n\n**Final Notes**\n---------------\n\nThis is a basic implementation of purchase functionality in PHP. You'll need to expand upon this example to accommodate your specific requirements, such as:\n\n* Validating user input\n* Handling payment gateways (e.g., PayPal)\n* Implementing inventory management for products\n* Adding security measures (e.g., SSL certificates)\n\nRemember to always follow secure coding practices and keep your code up-to-date with the latest PHP versions and security patches.", "code_blocks": [null, "```php\n<?php\n\n// Database connection settings\n$host = 'localhost';\n$username = 'root';\n$password = '';\n$dbname = 'shop';\n\n// Establish database connection\n$conn = new mysqli($host, $username, $password, $dbname);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Process login form submission\nif (isset($_POST['submit'])) {\n    $email = $_POST['email'];\n    $password = $_POST['password'];\n\n    // Query database for user credentials\n    $query = \"SELECT * FROM users WHERE email = '$email'\";\n    $result = $conn->query($query);\n\n    if ($result->num_rows > 0) {\n        while ($row = $result->fetch_assoc()) {\n            if (password_verify($password, $row['password'])) {\n                // Login successful\n                session_start();\n                $_SESSION['user_id'] = $row['id'];\n                header('Location: products.php');\n                exit;\n            }\n        }\n    }\n\n    echo \"Invalid email or password\";\n}\n\n// Close database connection\n$conn->close();\n\n?>\n```", "```php\n<?php\n\n// Retrieve product data from database\n$query = \"SELECT * FROM products\";\n$result = $conn->query($query);\n\n?>\n\n<h1>Available Products</h1>\n\n<ul>\n    <?php while ($row = $result->fetch_assoc()) { ?>\n        <li>\n            <?php echo $row['name']; ?> (<?php echo $row['price']; ?>)\n            <a href=\"cart.php?product_id=<?php echo $row['id']; ?>\">Add to Cart</a>\n        </li>\n    <?php } ?>\n</ul>\n\n<?php\n$conn->close();\n?>\n```", "```php\n<?php\n\n// Retrieve cart data from session\nif (isset($_SESSION['user_id'])) {\n    $user_id = $_SESSION['user_id'];\n\n    // Query database for cart items\n    $query = \"SELECT * FROM cart WHERE user_id = '$user_id'\";\n    $result = $conn->query($query);\n\n    if ($result->num_rows > 0) {\n        while ($row = $result->fetch_assoc()) {\n            echo \"Product: \" . $row['product_name'] . \", Quantity: \" . $row['quantity'];\n        }\n    }\n}\n\n// Add product to cart\nif (isset($_GET['product_id'])) {\n    $product_id = $_GET['product_id'];\n\n    // Update cart database with new item\n    $query = \"INSERT INTO cart (user_id, product_id) VALUES ('$user_id', '$product_id')\";\n    $conn->query($query);\n\n    echo \"Product added to cart!\";\n}\n\n// Close database connection\n$conn->close();\n\n?>\n```", "```php\n<?php\n\n// Retrieve user ID from session\n$user_id = $_SESSION['user_id'];\n\n// Query database for total cost\n$query = \"SELECT SUM(quantity * price) AS total FROM cart WHERE user_id = '$user_id'\";\n$result = $conn->query($query);\n\nif ($result->num_rows > 0) {\n    while ($row = $result->fetch_assoc()) {\n        $total = $row['total'];\n    }\n}\n\n// Create order in database\n$query = \"INSERT INTO orders (user_id, total) VALUES ('$user_id', '$total')\";\n$conn->query($query);\n\necho \"Order created!\";\n\n// Empty cart and close connection\n$query = \"DELETE FROM cart WHERE user_id = '$user_id'\";\n$conn->query($query);\n$conn->close();\n\n?>\n```"]}
