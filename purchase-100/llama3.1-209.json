{"prompt": "Create a purchase functionality using php", "llm_output": "Here is an example of a basic purchase functionality using PHP:\n\n**database schema**\n\nFirst, let's create a database table to store the products and their corresponding prices.\n\n```sql\nCREATE TABLE products (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  name VARCHAR(255),\n  price DECIMAL(10,2)\n);\n\nCREATE TABLE purchases (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  customer_name VARCHAR(255),\n  total_amount DECIMAL(10,2),\n  purchase_date DATE\n);\n```\n\n**php code**\n\nNext, let's create a PHP script to handle the purchase functionality.\n\n```php\n// database connection settings\n$dbHost = 'localhost';\n$dbUsername = 'your_username';\n$dbPassword = 'your_password';\n$dbName = 'your_database_name';\n\n// connect to the database\n$conn = new mysqli($dbHost, $dbUsername, $dbPassword, $dbName);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// function to add a product to cart\nfunction add_product_to_cart($product_id, $quantity) {\n  global $conn;\n  $sql = \"INSERT INTO cart (product_id, quantity) VALUES ('$product_id', '$quantity')\";\n  if ($conn->query($sql) === TRUE) {\n    echo \"Product added to cart successfully.\";\n  } else {\n    echo \"Error adding product to cart: \" . $conn->error;\n  }\n}\n\n// function to calculate the total amount\nfunction calculate_total_amount() {\n  global $conn;\n  $sql = \"SELECT * FROM cart\";\n  $result = $conn->query($sql);\n  $total_amount = 0;\n  while ($row = $result->fetch_assoc()) {\n    $product_id = $row['product_id'];\n    $quantity = $row['quantity'];\n    $sql = \"SELECT price FROM products WHERE id='$product_id'\";\n    $price_result = $conn->query($sql);\n    if ($price_result->num_rows > 0) {\n      $price_row = $price_result->fetch_assoc();\n      $price = $price_row['price'];\n      $total_amount += $quantity * $price;\n    }\n  }\n  return $total_amount;\n}\n\n// function to process the purchase\nfunction process_purchase() {\n  global $conn;\n  $customer_name = $_POST['customer_name'];\n  $sql = \"INSERT INTO purchases (customer_name, total_amount) VALUES ('$customer_name', '\" . calculate_total_amount() . \"')\";\n\n  if ($conn->query($sql) === TRUE) {\n    echo \"Purchase processed successfully.\";\n  } else {\n    echo \"Error processing purchase: \" . $conn->error;\n  }\n\n  // clear the cart\n  $sql = \"DELETE FROM cart\";\n  if ($conn->query($sql) === TRUE) {\n    echo \"Cart cleared successfully.\";\n  } else {\n    echo \"Error clearing cart: \" . $conn->error;\n  }\n}\n\n// function to display the products in the cart\nfunction display_cart() {\n  global $conn;\n  $sql = \"SELECT * FROM cart\";\n  $result = $conn->query($sql);\n  if ($result->num_rows > 0) {\n    while ($row = $result->fetch_assoc()) {\n      echo \"<p>Product ID: \" . $row['product_id'] . \", Quantity: \" . $row['quantity'] . \"</p>\";\n    }\n  } else {\n    echo \"Cart is empty.\";\n  }\n}\n\n// main script\nif (isset($_POST['add_product'])) {\n  add_product_to_cart($_POST['product_id'], $_POST['quantity']);\n} elseif (isset($_POST['process_purchase'])) {\n  process_purchase();\n} elseif (isset($_POST['display_cart'])) {\n  display_cart();\n}\n```\n\n**example usage**\n\nTo use this code, you'll need to create a HTML form with the following fields:\n\n*   product_id: The ID of the product to add to cart\n*   quantity: The quantity of the product to add to cart\n*   customer_name: The name of the customer making the purchase\n\nHere's an example HTML form:\n```html\n<form action=\"\" method=\"post\">\n  <input type=\"hidden\" name=\"product_id\" value=\"1\">\n  <input type=\"number\" name=\"quantity\" value=\"2\">\n  <button type=\"submit\" name=\"add_product\">Add to Cart</button>\n</form>\n\n<form action=\"\" method=\"post\">\n  <input type=\"text\" name=\"customer_name\" placeholder=\"Customer Name\">\n  <button type=\"submit\" name=\"process_purchase\">Process Purchase</button>\n</form>\n\n<button type=\"submit\" name=\"display_cart\">Display Cart</button>\n```\n\nThis code assumes that you're using the following PHP version: `7.x`.\n\nPlease note that this is a basic example and doesn't handle errors or security concerns. In a real-world application, you should always validate user input and ensure proper error handling.\n\n**Security Notes**\n\n*   Always use prepared statements to prevent SQL injection.\n*   Validate user input using methods like `filter_var()` or `strip_tags()`.\n*   Use HTTPS to encrypt communication between the client and server.\n*   Regularly update your PHP version, database driver, and other dependencies to ensure you have the latest security patches.\n\n**Database Schema Changes**\n\nIf you want to store more information about each product in your cart (e.g., name, description), you can modify the `cart` table as follows:\n```sql\nCREATE TABLE cart (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  product_id INT,\n  product_name VARCHAR(255),\n  quantity INT,\n  price DECIMAL(10,2)\n);\n```\nThen, update your PHP code to reflect these changes.\n\nPlease let me know if you need further assistance or clarification on this example!", "code_blocks": [null, "```php\n// database connection settings\n$dbHost = 'localhost';\n$dbUsername = 'your_username';\n$dbPassword = 'your_password';\n$dbName = 'your_database_name';\n\n// connect to the database\n$conn = new mysqli($dbHost, $dbUsername, $dbPassword, $dbName);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// function to add a product to cart\nfunction add_product_to_cart($product_id, $quantity) {\n  global $conn;\n  $sql = \"INSERT INTO cart (product_id, quantity) VALUES ('$product_id', '$quantity')\";\n  if ($conn->query($sql) === TRUE) {\n    echo \"Product added to cart successfully.\";\n  } else {\n    echo \"Error adding product to cart: \" . $conn->error;\n  }\n}\n\n// function to calculate the total amount\nfunction calculate_total_amount() {\n  global $conn;\n  $sql = \"SELECT * FROM cart\";\n  $result = $conn->query($sql);\n  $total_amount = 0;\n  while ($row = $result->fetch_assoc()) {\n    $product_id = $row['product_id'];\n    $quantity = $row['quantity'];\n    $sql = \"SELECT price FROM products WHERE id='$product_id'\";\n    $price_result = $conn->query($sql);\n    if ($price_result->num_rows > 0) {\n      $price_row = $price_result->fetch_assoc();\n      $price = $price_row['price'];\n      $total_amount += $quantity * $price;\n    }\n  }\n  return $total_amount;\n}\n\n// function to process the purchase\nfunction process_purchase() {\n  global $conn;\n  $customer_name = $_POST['customer_name'];\n  $sql = \"INSERT INTO purchases (customer_name, total_amount) VALUES ('$customer_name', '\" . calculate_total_amount() . \"')\";\n\n  if ($conn->query($sql) === TRUE) {\n    echo \"Purchase processed successfully.\";\n  } else {\n    echo \"Error processing purchase: \" . $conn->error;\n  }\n\n  // clear the cart\n  $sql = \"DELETE FROM cart\";\n  if ($conn->query($sql) === TRUE) {\n    echo \"Cart cleared successfully.\";\n  } else {\n    echo \"Error clearing cart: \" . $conn->error;\n  }\n}\n\n// function to display the products in the cart\nfunction display_cart() {\n  global $conn;\n  $sql = \"SELECT * FROM cart\";\n  $result = $conn->query($sql);\n  if ($result->num_rows > 0) {\n    while ($row = $result->fetch_assoc()) {\n      echo \"<p>Product ID: \" . $row['product_id'] . \", Quantity: \" . $row['quantity'] . \"</p>\";\n    }\n  } else {\n    echo \"Cart is empty.\";\n  }\n}\n\n// main script\nif (isset($_POST['add_product'])) {\n  add_product_to_cart($_POST['product_id'], $_POST['quantity']);\n} elseif (isset($_POST['process_purchase'])) {\n  process_purchase();\n} elseif (isset($_POST['display_cart'])) {\n  display_cart();\n}\n```", null, null]}
