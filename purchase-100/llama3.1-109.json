{"prompt": "Create a purchase functionality using php", "llm_output": "Here is an example of a simple purchase functionality using PHP:\n\n**Database Structure**\n\nFor this example, we will need two tables in our database: `products` and `orders`. The `products` table will store information about the products available for sale, while the `orders` table will store information about each purchase made.\n\n```sql\nCREATE TABLE products (\n  id INT PRIMARY KEY,\n  name VARCHAR(255),\n  price DECIMAL(10,2)\n);\n\nCREATE TABLE orders (\n  id INT PRIMARY KEY,\n  customer_name VARCHAR(255),\n  product_id INT,\n  quantity INT,\n  total_cost DECIMAL(10,2),\n  FOREIGN KEY (product_id) REFERENCES products(id)\n);\n```\n\n**PHP Code**\n\nWe will create a simple PHP script that allows customers to select products and place an order. We will also validate user input to ensure that the customer's information is accurate.\n\n```php\n<?php\n\n// Connect to database\n$conn = mysqli_connect(\"localhost\", \"username\", \"password\", \"database\");\n\n// Check connection\nif (!$conn) {\n  die(\"Connection failed: \" . mysqli_connect_error());\n}\n\n// Function to display products\nfunction displayProducts($conn) {\n  $query = \"SELECT * FROM products\";\n  $result = mysqli_query($conn, $query);\n\n  if (mysqli_num_rows($result) > 0) {\n    echo \"<table>\";\n    while ($row = mysqli_fetch_assoc($result)) {\n      echo \"<tr><td>\" . $row[\"name\"] . \"</td><td>$\" . $row[\"price\"] . \"</td></tr>\";\n    }\n    echo \"</table>\";\n  } else {\n    echo \"No products available.\";\n  }\n}\n\n// Function to handle form submission\nfunction processOrder($conn) {\n  if (isset($_POST['submit'])) {\n    // Validate user input\n    if (!empty($_POST['customer_name']) && !empty($_POST['product_id']) && !empty($_POST['quantity'])) {\n      $customerName = $_POST['customer_name'];\n      $productId = $_POST['product_id'];\n      $quantity = $_POST['quantity'];\n\n      // Retrieve product price from database\n      $query = \"SELECT price FROM products WHERE id=$productId\";\n      $result = mysqli_query($conn, $query);\n      $price = mysqli_fetch_assoc($result)[\"price\"];\n\n      // Calculate total cost\n      $totalCost = $price * $quantity;\n\n      // Insert order into database\n      $query = \"INSERT INTO orders (customer_name, product_id, quantity, total_cost) VALUES ('$customerName', '$productId', '$quantity', '$totalCost')\";\n      mysqli_query($conn, $query);\n\n      echo \"Order placed successfully!\";\n    } else {\n      echo \"Please fill in all fields.\";\n    }\n  }\n}\n\n// Display products and form\ndisplayProducts($conn);\n?>\n<form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\">\n  <label for=\"customer_name\">Customer Name:</label>\n  <input type=\"text\" id=\"customer_name\" name=\"customer_name\"><br><br>\n  <label for=\"product_id\">Select Product:</label>\n  <select id=\"product_id\" name=\"product_id\">\n    <?php\n      $query = \"SELECT * FROM products\";\n      $result = mysqli_query($conn, $query);\n      while ($row = mysqli_fetch_assoc($result)) {\n        echo \"<option value='\" . $row[\"id\"] . \"'>\" . $row[\"name\"] . \"</option>\";\n      }\n    ?>\n  </select><br><br>\n  <label for=\"quantity\">Quantity:</label>\n  <input type=\"number\" id=\"quantity\" name=\"quantity\"><br><br>\n  <input type=\"submit\" name=\"submit\" value=\"Place Order\">\n</form>\n\n<?php\n// Close connection\nmysqli_close($conn);\n?>\n```\n\n**How it Works**\n\n1. The script first connects to the database using `mysqli_connect`.\n2. It then displays a table of products available for sale.\n3. When the customer selects a product and enters their information, the form is submitted to the same PHP script.\n4. The script validates the user input to ensure that all fields are filled in.\n5. If the input is valid, it calculates the total cost of the order by multiplying the quantity by the product price.\n6. It then inserts the order into the `orders` table in the database.\n7. Finally, it displays a success message indicating that the order has been placed.\n\nNote: This is a very basic example and you should always follow best practices for security and validation when handling user input. Additionally, this script assumes that the product prices are stored in the database and retrieved using `mysqli_query`. In a real-world scenario, you would likely use prepared statements to prevent SQL injection attacks.", "code_blocks": [null, "```php\n<?php\n\n// Connect to database\n$conn = mysqli_connect(\"localhost\", \"username\", \"password\", \"database\");\n\n// Check connection\nif (!$conn) {\n  die(\"Connection failed: \" . mysqli_connect_error());\n}\n\n// Function to display products\nfunction displayProducts($conn) {\n  $query = \"SELECT * FROM products\";\n  $result = mysqli_query($conn, $query);\n\n  if (mysqli_num_rows($result) > 0) {\n    echo \"<table>\";\n    while ($row = mysqli_fetch_assoc($result)) {\n      echo \"<tr><td>\" . $row[\"name\"] . \"</td><td>$\" . $row[\"price\"] . \"</td></tr>\";\n    }\n    echo \"</table>\";\n  } else {\n    echo \"No products available.\";\n  }\n}\n\n// Function to handle form submission\nfunction processOrder($conn) {\n  if (isset($_POST['submit'])) {\n    // Validate user input\n    if (!empty($_POST['customer_name']) && !empty($_POST['product_id']) && !empty($_POST['quantity'])) {\n      $customerName = $_POST['customer_name'];\n      $productId = $_POST['product_id'];\n      $quantity = $_POST['quantity'];\n\n      // Retrieve product price from database\n      $query = \"SELECT price FROM products WHERE id=$productId\";\n      $result = mysqli_query($conn, $query);\n      $price = mysqli_fetch_assoc($result)[\"price\"];\n\n      // Calculate total cost\n      $totalCost = $price * $quantity;\n\n      // Insert order into database\n      $query = \"INSERT INTO orders (customer_name, product_id, quantity, total_cost) VALUES ('$customerName', '$productId', '$quantity', '$totalCost')\";\n      mysqli_query($conn, $query);\n\n      echo \"Order placed successfully!\";\n    } else {\n      echo \"Please fill in all fields.\";\n    }\n  }\n}\n\n// Display products and form\ndisplayProducts($conn);\n?>\n<form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\">\n  <label for=\"customer_name\">Customer Name:</label>\n  <input type=\"text\" id=\"customer_name\" name=\"customer_name\"><br><br>\n  <label for=\"product_id\">Select Product:</label>\n  <select id=\"product_id\" name=\"product_id\">\n    <?php\n      $query = \"SELECT * FROM products\";\n      $result = mysqli_query($conn, $query);\n      while ($row = mysqli_fetch_assoc($result)) {\n        echo \"<option value='\" . $row[\"id\"] . \"'>\" . $row[\"name\"] . \"</option>\";\n      }\n    ?>\n  </select><br><br>\n  <label for=\"quantity\">Quantity:</label>\n  <input type=\"number\" id=\"quantity\" name=\"quantity\"><br><br>\n  <input type=\"submit\" name=\"submit\" value=\"Place Order\">\n</form>\n\n<?php\n// Close connection\nmysqli_close($conn);\n?>\n```"]}
