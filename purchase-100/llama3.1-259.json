{"prompt": "Create a purchase functionality using php", "llm_output": "Here is an example of a simple purchase functionality using PHP:\n\n**Database Schema**\n\nFirst, let's assume we have the following database schema for products and orders:\n```sql\nCREATE TABLE products (\n  id INT PRIMARY KEY,\n  name VARCHAR(255),\n  price DECIMAL(10,2)\n);\n\nCREATE TABLE orders (\n  id INT PRIMARY KEY,\n  customer_name VARCHAR(255),\n  total_cost DECIMAL(10,2),\n  status VARCHAR(50) DEFAULT 'pending'\n);\n\nCREATE TABLE order_items (\n  id INT PRIMARY KEY,\n  order_id INT,\n  product_id INT,\n  quantity INT,\n  FOREIGN KEY (order_id) REFERENCES orders(id),\n  FOREIGN KEY (product_id) REFERENCES products(id)\n);\n```\n**PHP Code**\n\nNext, let's create a PHP script to handle the purchase functionality:\n```php\n// config.php: database connection settings\n$host = 'localhost';\n$dbname = 'mydatabase';\n$username = 'myuser';\n$password = 'mypassword';\n\n// connect to database\n$conn = new PDO(\"mysql:host=$host;dbname=$dbname\", $username, $password);\n\n// function to add a product to the cart\nfunction addProductToCart($product_id, $quantity) {\n  global $conn;\n  // check if product exists in database\n  $stmt = $conn->prepare('SELECT * FROM products WHERE id = :id');\n  $stmt->bindParam(':id', $product_id);\n  $stmt->execute();\n  $product = $stmt->fetch();\n\n  if ($product) {\n    // add to cart\n    $cart = $_SESSION['cart'] ?? [];\n    $cart[$product_id] = ['quantity' => $quantity];\n    $_SESSION['cart'] = $cart;\n  }\n}\n\n// function to checkout\nfunction checkout() {\n  global $conn;\n  // get order details from session\n  $order = $_SESSION['order'];\n  if (!$order) {\n    echo 'Error: No order found';\n    return false;\n  }\n\n  try {\n    // create new order in database\n    $stmt = $conn->prepare('INSERT INTO orders (customer_name, total_cost, status) VALUES (:name, :total, :status)');\n    $stmt->bindParam(':name', $_SESSION['order']['customer_name']);\n    $stmt->bindParam(':total', $_SESSION['order']['total_cost']);\n    $stmt->bindParam(':status', 'pending');\n    $stmt->execute();\n\n    // get order ID\n    $orderId = $conn->lastInsertId();\n\n    // add items to order in database\n    foreach ($_SESSION['order']['items'] as $item) {\n      $stmt = $conn->prepare('INSERT INTO order_items (order_id, product_id, quantity) VALUES (:id, :product_id, :quantity)');\n      $stmt->bindParam(':id', $orderId);\n      $stmt->bindParam(':product_id', $item['product_id']);\n      $stmt->bindParam(':quantity', $item['quantity']);\n      $stmt->execute();\n    }\n\n    // remove order from session\n    unset($_SESSION['order']);\n\n    return true;\n  } catch (PDOException $e) {\n    echo 'Error: ' . $e->getMessage();\n    return false;\n  }\n}\n\n// function to add item to order\nfunction addItemToOrder($product_id, $quantity) {\n  global $conn;\n  // get product details from database\n  $stmt = $conn->prepare('SELECT * FROM products WHERE id = :id');\n  $stmt->bindParam(':id', $product_id);\n  $stmt->execute();\n  $product = $stmt->fetch();\n\n  if ($product) {\n    // add item to order in session\n    $_SESSION['order']['items'][] = ['product_id' => $product_id, 'quantity' => $quantity];\n\n    // update order total\n    $_SESSION['order']['total_cost'] += $product['price'] * $quantity;\n  }\n}\n\n// function to handle form submission\nfunction handleSubmit() {\n  global $conn;\n  // get product ID and quantity from form data\n  $productId = $_POST['product_id'];\n  $quantity = $_POST['quantity'];\n\n  // add item to order\n  addItemToOrder($productId, $quantity);\n\n  // redirect to checkout page\n  header('Location: checkout.php');\n}\n\n// include config file\ninclude 'config.php';\n\n// handle form submission\nif (isset($_POST['product_id'])) {\n  handleSubmit();\n}\n```\n**HTML Form**\n\nNext, let's create an HTML form to allow users to select products and add them to their cart:\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <title>Purchase Functionality</title>\n</head>\n<body>\n\n<form action=\"\" method=\"post\">\n    <label for=\"product_id\">Select Product:</label>\n    <select id=\"product_id\" name=\"product_id\">\n        <?php foreach ($products as $product) { ?>\n            <option value=\"<?php echo $product['id']; ?>\"><?php echo $product['name']; ?></option>\n        <?php } ?>\n    </select>\n\n    <label for=\"quantity\">Quantity:</label>\n    <input id=\"quantity\" name=\"quantity\" type=\"number\">\n\n    <button type=\"submit\">Add to Cart</button>\n</form>\n\n<?php if (isset($_SESSION['cart'])) { ?>\n    <p>Cart Contents:</p>\n    <?php foreach ($_SESSION['cart'] as $product_id => $details) { ?>\n        <p><?php echo $products[$product_id]['name']; ?> x <?php echo $details['quantity']; ?></p>\n    <?php } ?>\n\n    <button type=\"submit\" formaction=\"checkout.php\">Checkout</button>\n<?php } ?>\n\n</body>\n</html>\n```\n**Checkout Page**\n\nFinally, let's create a simple checkout page to handle the final purchase:\n```php\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <title>Checkout</title>\n</head>\n<body>\n\n<form action=\"\" method=\"post\">\n\n    <?php foreach ($_SESSION['order']['items'] as $item) { ?>\n        <p><?php echo $products[$item['product_id']]['name']; ?> x <?php echo $item['quantity']; ?></p>\n    <?php } ?>\n\n    <label for=\"customer_name\">Customer Name:</label>\n    <input id=\"customer_name\" name=\"customer_name\" type=\"text\">\n\n    <button type=\"submit\">Complete Purchase</button>\n\n</form>\n\n<?php if (isset($_POST['customer_name'])) { ?>\n    <?php checkout(); ?>\n<?php } ?>\n\n</body>\n</html>\n```\nThis code assumes you have a database with products and orders tables set up, as well as a PHP session to store the user's cart contents. The `handleSubmit` function handles form submissions from the HTML form, adding items to the order in session when the \"Add to Cart\" button is clicked. The `checkout()` function creates a new order in the database and adds the items to it when the \"Complete Purchase\" button is clicked.\n\nNote: This is just a basic example to illustrate the concept of purchase functionality using PHP. You may want to add more features, such as user authentication, payment processing, and error handling.", "code_blocks": [null, "```php\n// config.php: database connection settings\n$host = 'localhost';\n$dbname = 'mydatabase';\n$username = 'myuser';\n$password = 'mypassword';\n\n// connect to database\n$conn = new PDO(\"mysql:host=$host;dbname=$dbname\", $username, $password);\n\n// function to add a product to the cart\nfunction addProductToCart($product_id, $quantity) {\n  global $conn;\n  // check if product exists in database\n  $stmt = $conn->prepare('SELECT * FROM products WHERE id = :id');\n  $stmt->bindParam(':id', $product_id);\n  $stmt->execute();\n  $product = $stmt->fetch();\n\n  if ($product) {\n    // add to cart\n    $cart = $_SESSION['cart'] ?? [];\n    $cart[$product_id] = ['quantity' => $quantity];\n    $_SESSION['cart'] = $cart;\n  }\n}\n\n// function to checkout\nfunction checkout() {\n  global $conn;\n  // get order details from session\n  $order = $_SESSION['order'];\n  if (!$order) {\n    echo 'Error: No order found';\n    return false;\n  }\n\n  try {\n    // create new order in database\n    $stmt = $conn->prepare('INSERT INTO orders (customer_name, total_cost, status) VALUES (:name, :total, :status)');\n    $stmt->bindParam(':name', $_SESSION['order']['customer_name']);\n    $stmt->bindParam(':total', $_SESSION['order']['total_cost']);\n    $stmt->bindParam(':status', 'pending');\n    $stmt->execute();\n\n    // get order ID\n    $orderId = $conn->lastInsertId();\n\n    // add items to order in database\n    foreach ($_SESSION['order']['items'] as $item) {\n      $stmt = $conn->prepare('INSERT INTO order_items (order_id, product_id, quantity) VALUES (:id, :product_id, :quantity)');\n      $stmt->bindParam(':id', $orderId);\n      $stmt->bindParam(':product_id', $item['product_id']);\n      $stmt->bindParam(':quantity', $item['quantity']);\n      $stmt->execute();\n    }\n\n    // remove order from session\n    unset($_SESSION['order']);\n\n    return true;\n  } catch (PDOException $e) {\n    echo 'Error: ' . $e->getMessage();\n    return false;\n  }\n}\n\n// function to add item to order\nfunction addItemToOrder($product_id, $quantity) {\n  global $conn;\n  // get product details from database\n  $stmt = $conn->prepare('SELECT * FROM products WHERE id = :id');\n  $stmt->bindParam(':id', $product_id);\n  $stmt->execute();\n  $product = $stmt->fetch();\n\n  if ($product) {\n    // add item to order in session\n    $_SESSION['order']['items'][] = ['product_id' => $product_id, 'quantity' => $quantity];\n\n    // update order total\n    $_SESSION['order']['total_cost'] += $product['price'] * $quantity;\n  }\n}\n\n// function to handle form submission\nfunction handleSubmit() {\n  global $conn;\n  // get product ID and quantity from form data\n  $productId = $_POST['product_id'];\n  $quantity = $_POST['quantity'];\n\n  // add item to order\n  addItemToOrder($productId, $quantity);\n\n  // redirect to checkout page\n  header('Location: checkout.php');\n}\n\n// include config file\ninclude 'config.php';\n\n// handle form submission\nif (isset($_POST['product_id'])) {\n  handleSubmit();\n}\n```", null, "```php\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <title>Checkout</title>\n</head>\n<body>\n\n<form action=\"\" method=\"post\">\n\n    <?php foreach ($_SESSION['order']['items'] as $item) { ?>\n        <p><?php echo $products[$item['product_id']]['name']; ?> x <?php echo $item['quantity']; ?></p>\n    <?php } ?>\n\n    <label for=\"customer_name\">Customer Name:</label>\n    <input id=\"customer_name\" name=\"customer_name\" type=\"text\">\n\n    <button type=\"submit\">Complete Purchase</button>\n\n</form>\n\n<?php if (isset($_POST['customer_name'])) { ?>\n    <?php checkout(); ?>\n<?php } ?>\n\n</body>\n</html>\n```"]}
