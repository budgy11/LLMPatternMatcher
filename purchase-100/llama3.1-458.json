{"prompt": "Create a purchase functionality using php", "llm_output": "Here's an example of a basic purchase functionality using PHP. This code snippet demonstrates how to create a simple e-commerce system with features like adding items to cart, viewing cart contents, and checking out.\n\n**Database Schema:**\n\nFor this example, we will need the following database tables:\n\n* `products` table:\n\t+ id (primary key)\n\t+ name\n\t+ price\n\t+ description\n* `cart` table:\n\t+ id (primary key)\n\t+ user_id (foreign key referencing users.id)\n\t+ product_id (foreign key referencing products.id)\n\t+ quantity\n\n**PHP Code:**\n\nWe'll use a simple procedural approach here. In a real-world application, you would likely want to refactor this code into an object-oriented design.\n\n### `config.php` (Database connection configuration)\n\n```php\n<?php\ndefine('DB_HOST', 'localhost');\ndefine('DB_USER', 'root');\ndefine('DB_PASSWORD', '');\ndefine('DB_NAME', 'ecommerce');\n\n$connection = new mysqli(DB_HOST, DB_USER, DB_PASSWORD, DB_NAME);\n\nif ($connection->connect_error) {\n    die(\"Connection failed: \" . $connection->connect_error);\n}\n?>\n```\n\n### `functions.php` (Database functions)\n\n```php\n<?php\nfunction addProductToCart($product_id, $quantity) {\n    global $connection;\n    \n    // Check if product exists in cart already\n    $query = \"SELECT * FROM cart WHERE user_id = $_SESSION['user_id'] AND product_id = '$product_id'\";\n    $result = $connection->query($query);\n    \n    if ($result->num_rows > 0) {\n        // Update quantity if item is already in cart\n        $row = $result->fetch_assoc();\n        $newQuantity = $row['quantity'] + $quantity;\n        \n        $updateQuery = \"UPDATE cart SET quantity = '$newQuantity' WHERE id = '$row[id]'\";\n        $connection->query($updateQuery);\n    } else {\n        // Insert new product into cart\n        $insertQuery = \"INSERT INTO cart (user_id, product_id, quantity) VALUES ('$_SESSION[user_id]', '$product_id', '$quantity')\";\n        $connection->query($insertQuery);\n    }\n}\n\nfunction viewCart() {\n    global $connection;\n    \n    // Retrieve all products in user's cart\n    $query = \"SELECT p.name, c.quantity FROM cart c JOIN products p ON c.product_id = p.id WHERE c.user_id = $_SESSION['user_id'] GROUP BY c.product_id\";\n    $result = $connection->query($query);\n    \n    if ($result->num_rows > 0) {\n        return $result;\n    } else {\n        return null;\n    }\n}\n\nfunction checkout() {\n    global $connection;\n    \n    // Clear cart after successful checkout\n    $clearQuery = \"DELETE FROM cart WHERE user_id = $_SESSION['user_id']\";\n    $connection->query($clearQuery);\n}\n?>\n```\n\n### `index.php` (Front-end)\n\n```php\n<?php\nrequire_once 'config.php';\nrequire_once 'functions.php';\n\n// Session management for logged-in users\nif (!isset($_SESSION['user_id'])) {\n    header('Location: login.php');\n    exit;\n}\n\n// Display cart contents\n$cartContents = viewCart();\n?>\n\n<h1>Shopping Cart</h1>\n\n<table>\n    <tr>\n        <th>Product Name</th>\n        <th>Quantity</th>\n        <th>Total Price</th>\n    </tr>\n    \n    <?php foreach ($cartContents as $row) : ?>\n    <tr>\n        <td><?php echo $row['name']; ?></td>\n        <td><?php echo $row['quantity']; ?></td>\n        <td><?php echo $row['quantity'] * 10.99; ?></td> <!-- Assuming price is $10.99 -->\n    </tr>\n    <?php endforeach; ?>\n</table>\n\n<form action=\"checkout.php\" method=\"post\">\n    <input type=\"submit\" value=\"Checkout\" />\n</form>\n```\n\n### `checkout.php` (Checkout page)\n\n```php\n<?php\nrequire_once 'config.php';\nrequire_once 'functions.php';\n\n// Clear cart after successful checkout\ncheckout();\n\nheader('Location: success.php');\nexit;\n?>\n```\n\nThis code snippet provides a basic example of how to implement purchase functionality using PHP. You can customize and expand upon this code as needed for your specific use case.\n\nRemember, this is a simplified representation and doesn't cover security considerations (e.g., validation, authentication), error handling, or more advanced features like payment processing or multiple shipping addresses.", "code_blocks": ["```php\n<?php\ndefine('DB_HOST', 'localhost');\ndefine('DB_USER', 'root');\ndefine('DB_PASSWORD', '');\ndefine('DB_NAME', 'ecommerce');\n\n$connection = new mysqli(DB_HOST, DB_USER, DB_PASSWORD, DB_NAME);\n\nif ($connection->connect_error) {\n    die(\"Connection failed: \" . $connection->connect_error);\n}\n?>\n```", "```php\n<?php\nfunction addProductToCart($product_id, $quantity) {\n    global $connection;\n    \n    // Check if product exists in cart already\n    $query = \"SELECT * FROM cart WHERE user_id = $_SESSION['user_id'] AND product_id = '$product_id'\";\n    $result = $connection->query($query);\n    \n    if ($result->num_rows > 0) {\n        // Update quantity if item is already in cart\n        $row = $result->fetch_assoc();\n        $newQuantity = $row['quantity'] + $quantity;\n        \n        $updateQuery = \"UPDATE cart SET quantity = '$newQuantity' WHERE id = '$row[id]'\";\n        $connection->query($updateQuery);\n    } else {\n        // Insert new product into cart\n        $insertQuery = \"INSERT INTO cart (user_id, product_id, quantity) VALUES ('$_SESSION[user_id]', '$product_id', '$quantity')\";\n        $connection->query($insertQuery);\n    }\n}\n\nfunction viewCart() {\n    global $connection;\n    \n    // Retrieve all products in user's cart\n    $query = \"SELECT p.name, c.quantity FROM cart c JOIN products p ON c.product_id = p.id WHERE c.user_id = $_SESSION['user_id'] GROUP BY c.product_id\";\n    $result = $connection->query($query);\n    \n    if ($result->num_rows > 0) {\n        return $result;\n    } else {\n        return null;\n    }\n}\n\nfunction checkout() {\n    global $connection;\n    \n    // Clear cart after successful checkout\n    $clearQuery = \"DELETE FROM cart WHERE user_id = $_SESSION['user_id']\";\n    $connection->query($clearQuery);\n}\n?>\n```", "```php\n<?php\nrequire_once 'config.php';\nrequire_once 'functions.php';\n\n// Session management for logged-in users\nif (!isset($_SESSION['user_id'])) {\n    header('Location: login.php');\n    exit;\n}\n\n// Display cart contents\n$cartContents = viewCart();\n?>\n\n<h1>Shopping Cart</h1>\n\n<table>\n    <tr>\n        <th>Product Name</th>\n        <th>Quantity</th>\n        <th>Total Price</th>\n    </tr>\n    \n    <?php foreach ($cartContents as $row) : ?>\n    <tr>\n        <td><?php echo $row['name']; ?></td>\n        <td><?php echo $row['quantity']; ?></td>\n        <td><?php echo $row['quantity'] * 10.99; ?></td> <!-- Assuming price is $10.99 -->\n    </tr>\n    <?php endforeach; ?>\n</table>\n\n<form action=\"checkout.php\" method=\"post\">\n    <input type=\"submit\" value=\"Checkout\" />\n</form>\n```", "```php\n<?php\nrequire_once 'config.php';\nrequire_once 'functions.php';\n\n// Clear cart after successful checkout\ncheckout();\n\nheader('Location: success.php');\nexit;\n?>\n```"]}
