{"prompt": "Create a purchase cart functionality using php", "llm_output": "<think>\nAlright, the user wants to create a purchase cart functionality using PHP. I need to figure out how to approach this.\n\nFirst, I should outline the basic features required for a shopping cart. Typically, that includes adding items, displaying the cart, updating quantities, and deleting items. Also, calculating totals is essential.\n\nI'll start by setting up the database. Creating a products table makes sense with fields like id, name, price, description, and image. Then, a cart table to track user sessions, item IDs, quantities, timestamps, and whether the order is completed.\n\nNext, I need to handle adding items to the cart. Checking if the item is already in the cart for the current session is important to avoid duplicates. If it's there, increment the quantity; otherwise, add a new entry.\n\nDisplaying the cart involves fetching all items from the cart table where the session ID matches and the order isn't completed. Calculating subtotal for each item and the total sum will be necessary here.\n\nUpdating quantities should allow users to adjust how many of an item they want. I'll need a form that sends the new quantity to the server, updating the database accordingly.\n\nDeleting items is straightforward\u2014just remove the entry from the cart table based on the item ID and session.\n\nI also need to manage sessions. When a user starts adding items, check if a session exists; if not, create one and store it in the cart table for tracking.\n\nSecurity considerations are important too. I'll include SQL injection prevention by using placeholders in queries and ensure that form inputs are validated and sanitized.\n\nFinally, testing each part step by step will help catch any issues early on. Making sure all CRUD operations work as expected and that totals calculate correctly is crucial before moving to more advanced features.\n</think>\n\nHere's an example of how you can create a purchase cart functionality using PHP:\n\nThis implementation includes the following features:\n1. Adding items to cart\n2. Displaying cart items\n3. Updating cart quantities\n4. Deleting items from cart\n5. Calculating totals\n\n```php\n<?php\n// Database connection\n$host = 'localhost';\n$username = 'root';\n$password = '';\n$dbname = 'cart_db';\n\n$conn = mysqli_connect($host, $username, $password, $dbname);\n\nif (!$conn) {\n    die(\"Connection failed: \" . mysqli_connect_error());\n}\n\n// Create products table if not exists\n$sql = \"CREATE TABLE IF NOT EXISTS products (\n    id INT AUTO_INCREMENT PRIMARY KEY,\n    name VARCHAR(255),\n    price DECIMAL(10, 2),\n    description TEXT,\n    image VARCHAR(255)\n)\";\n\nmysqli_query($conn, $sql);\n\n// Create cart table if not exists\n$sql = \"CREATE TABLE IF NOT EXISTS cart (\n    id INT AUTO_INCREMENT PRIMARY KEY,\n    session_id VARCHAR(255),\n    item_id INT,\n    quantity INT,\n    timestamp DATETIME DEFAULT CURRENT_TIMESTAMP,\n    is_ordered BOOLEAN DEFAULT FALSE\n)\";\n\nmysqli_query($conn, $sql);\n\n// Function to add item to cart\nfunction addToCart($item_id) {\n    global $conn;\n    \n    // Check if the product exists\n    $product_sql = \"SELECT id FROM products WHERE id = ?\";\n    $stmt = mysqli_prepare($conn, $product_sql);\n    mysqli_stmt_bind_param($stmt, \"i\", $item_id);\n    mysqli_stmt_execute($stmt);\n    $result = mysqli_stmt_get_result($stmt);\n    \n    if (mysqli_num_rows($result) == 0) {\n        return false;\n    }\n    \n    // Get current session id\n    $session_id = session_id();\n    \n    // Check if item is already in cart\n    $check_sql = \"SELECT id FROM cart WHERE session_id = ? AND item_id = ? AND is_ordered = FALSE\";\n    $stmt = mysqli_prepare($conn, $check_sql);\n    mysqli_stmt_bind_param($stmt, \"si\", $session_id, $item_id);\n    mysqli_stmt_execute($stmt);\n    $result = mysqli_stmt_get_result($stmt);\n    \n    if (mysqli_num_rows($result) > 0) {\n        // Increment quantity\n        $update_sql = \"UPDATE cart SET quantity = quantity + 1 WHERE session_id = ? AND item_id = ?\";\n        $stmt = mysqli_prepare($conn, $update_sql);\n        mysqli_stmt_bind_param($stmt, \"si\", $session_id, $item_id);\n        mysqli_stmt_execute($stmt);\n    } else {\n        // Add new item\n        $insert_sql = \"INSERT INTO cart (session_id, item_id, quantity) VALUES (?, ?, 1)\";\n        $stmt = mysqli_prepare($conn, $insert_sql);\n        mysqli_stmt_bind_param($stmt, \"si\", $session_id, $item_id);\n        mysqli_stmt_execute($stmt);\n    }\n    \n    return true;\n}\n\n// Function to get cart items\nfunction getCartItems() {\n    global $conn;\n    \n    // Get current session id\n    $session_id = session_id();\n    \n    $sql = \"SELECT c.id AS cart_id, p.*, c.quantity \n            FROM products p \n            JOIN cart c ON p.id = c.item_id \n            WHERE c.session_id = ? AND c.is_ordered = FALSE\";\n            \n    $stmt = mysqli_prepare($conn, $sql);\n    mysqli_stmt_bind_param($stmt, \"s\", $session_id);\n    mysqli_stmt_execute($stmt);\n    $result = mysqli_stmt_get_result($stmt);\n    \n    return $result;\n}\n\n// Function to update cart quantity\nfunction updateCartQuantity($cart_id, $quantity) {\n    global $conn;\n    \n    // Update quantity in cart\n    $sql = \"UPDATE cart SET quantity = ? WHERE id = ?\";\n    $stmt = mysqli_prepare($conn, $sql);\n    mysqli_stmt_bind_param($stmt, \"ii\", $quantity, $cart_id);\n    mysqli_stmt_execute($stmt);\n    \n    return true;\n}\n\n// Function to delete item from cart\nfunction deleteCartItem($cart_id) {\n    global $conn;\n    \n    // Delete item from cart\n    $sql = \"DELETE FROM cart WHERE id = ?\";\n    $stmt = mysqli_prepare($conn, $sql);\n    mysqli_stmt_bind_param($stmt, \"i\", $cart_id);\n    mysqli_stmt_execute($stmt);\n    \n    return true;\n}\n\n// Function to calculate total price\nfunction calculateTotal() {\n    global $conn;\n    \n    // Get current session id\n    $session_id = session_id();\n    \n    $sql = \"SELECT SUM(p.price * c.quantity) AS total \n            FROM products p \n            JOIN cart c ON p.id = c.item_id \n            WHERE c.session_id = ? AND c.is_ordered = FALSE\";\n            \n    $stmt = mysqli_prepare($conn, $sql);\n    mysqli_stmt_bind_param($stmt, \"s\", $session_id);\n    mysqli_stmt_execute($stmt);\n    $result = mysqli_stmt_get_result($stmt);\n    $row = mysqli_fetch_assoc($result);\n    \n    return $row['total'];\n}\n\n// Initialize session\nif (!isset($_SESSION)) {\n    session_start();\n}\n\n// Check if cart table has items for this session, \n// if not, insert a new session into the cart table\n$session_id = session_id();\n\n$sql = \"SELECT id FROM cart WHERE session_id = ?\";\n$stmt = mysqli_prepare($conn, $sql);\nmysqli_stmt_bind_param($stmt, \"s\", $session_id);\nmysqli_stmt_execute($stmt);\n$result = mysqli_stmt_get_result($stmt);\n\nif (mysqli_num_rows($result) == 0) {\n    // Insert new session\n    $insert_sql = \"INSERT INTO cart (session_id) VALUES (?)\";\n    $stmt = mysqli_prepare($conn, $insert_sql);\n    mysqli_stmt_bind_param($stmt, \"s\", $session_id);\n    mysqli_stmt_execute($stmt);\n}\n?>\n```\n\nTo use this code:\n\n1. Create a database and tables using the provided SQL schema\n2. Add products to your `products` table\n3. Include this file in your PHP project\n4. Use the following functions in your application:\n   - `addToCart($item_id)` to add items to cart\n   - `getCartItems()` to display cart items\n   - `updateCartQuantity($cart_id, $quantity)` to update quantities\n   - `deleteCartItem($cart_id)` to remove items from cart\n   - `calculateTotal()` to get the total price\n\nExample usage:\n\n```php\n<?php\nrequire_once 'cart_functions.php';\n\n// Add item to cart\nif (isset($_POST['add_to_cart'])) {\n    addToCart($_POST['product_id']);\n}\n\n// Update quantity\nif (isset($_POST['update_quantity'])) {\n    updateCartQuantity($_POST['cart_id'], $_POST['quantity']);\n}\n\n// Delete item from cart\nif (isset($_GET['delete_item'])) {\n    deleteCartItem($_GET['cart_id']);\n}\n?>\n\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Shopping Cart</title>\n</head>\n<body>\n    <?php if ($result = getCartItems()): ?>\n        <h2>Your Cart</h2>\n        <table border=\"1\">\n            <tr>\n                <th>Product Name</th>\n                <th>Price</th>\n                <th>Quantity</th>\n                <th>Total</th>\n                <th>Action</th>\n            </tr>\n            <?php while ($row = mysqli_fetch_assoc($result)): ?>\n                <tr>\n                    <td><?php echo $row['name']; ?></td>\n                    <td>$<?php echo number_format($row['price'], 2); ?></td>\n                    <td>\n                        <form action=\"\" method=\"post\">\n                            <input type=\"hidden\" name=\"cart_id\" value=\"<?php echo $row['cart_id']; ?>\">\n                            <input type=\"number\" name=\"quantity\" value=\"<?php echo $row['quantity']; ?>\" min=\"1\">\n                            <button type=\"submit\" name=\"update_quantity\">Update</button>\n                        </form>\n                    </td>\n                    <td>$<?php echo number_format($row['price'] * $row['quantity'], 2); ?></td>\n                    <td>\n                        <a href=\"?delete_item=<?php echo $row['cart_id']; ?>\">Delete</a>\n                    </td>\n                </tr>\n            <?php endwhile; ?>\n        </table>\n        <h3>Total: $<?php echo number_format(calculateTotal(), 2); ?></h3>\n    <?php else: ?>\n        <p>Your cart is empty.</p>\n    <?php endif; ?>\n\n    <!-- Add items to cart -->\n    <?php\n    // Fetch products from database\n    $sql = \"SELECT * FROM products\";\n    $result = mysqli_query($conn, $sql);\n    \n    if ($result && mysqli_num_rows($result) > 0):\n    ?>\n        <h2>Products</h2>\n        <div class=\"products\">\n            <?php while ($row = mysqli_fetch_assoc($result)): ?>\n                <div class=\"product-item\">\n                    <img src=\"<?php echo $row['image']; ?>\" alt=\"<?php echo $row['name']; ?>\">\n                    <h3><?php echo $row['name']; ?></h3>\n                    <p>$<?php echo number_format($row['price'], 2); ?></p>\n                    <form action=\"\" method=\"post\">\n                        <input type=\"hidden\" name=\"product_id\" value=\"<?php echo $row['id']; ?>\">\n                        <button type=\"submit\" name=\"add_to_cart\">Add to Cart</button>\n                    </form>\n                </div>\n            <?php endwhile; ?>\n        </div>\n    <?php endif; ?>\n</body>\n</html>\n```\n\nThis code provides a basic shopping cart functionality. You can extend it further by adding features like:\n- User authentication\n- Order history\n- Payment integration\n- Coupon codes\n- Wishlist functionality\n- Product filtering and sorting\n- Search functionality\n\nRemember to secure your application properly by:\n1. Using prepared statements for database queries\n2. Sanitizing user input\n3. Implementing proper error handling\n4. Protecting against common vulnerabilities (SQL injection, XSS, CSRF)\n5. Using HTTPS for sensitive data", "code_blocks": ["```php\n<?php\n// Database connection\n$host = 'localhost';\n$username = 'root';\n$password = '';\n$dbname = 'cart_db';\n\n$conn = mysqli_connect($host, $username, $password, $dbname);\n\nif (!$conn) {\n    die(\"Connection failed: \" . mysqli_connect_error());\n}\n\n// Create products table if not exists\n$sql = \"CREATE TABLE IF NOT EXISTS products (\n    id INT AUTO_INCREMENT PRIMARY KEY,\n    name VARCHAR(255),\n    price DECIMAL(10, 2),\n    description TEXT,\n    image VARCHAR(255)\n)\";\n\nmysqli_query($conn, $sql);\n\n// Create cart table if not exists\n$sql = \"CREATE TABLE IF NOT EXISTS cart (\n    id INT AUTO_INCREMENT PRIMARY KEY,\n    session_id VARCHAR(255),\n    item_id INT,\n    quantity INT,\n    timestamp DATETIME DEFAULT CURRENT_TIMESTAMP,\n    is_ordered BOOLEAN DEFAULT FALSE\n)\";\n\nmysqli_query($conn, $sql);\n\n// Function to add item to cart\nfunction addToCart($item_id) {\n    global $conn;\n    \n    // Check if the product exists\n    $product_sql = \"SELECT id FROM products WHERE id = ?\";\n    $stmt = mysqli_prepare($conn, $product_sql);\n    mysqli_stmt_bind_param($stmt, \"i\", $item_id);\n    mysqli_stmt_execute($stmt);\n    $result = mysqli_stmt_get_result($stmt);\n    \n    if (mysqli_num_rows($result) == 0) {\n        return false;\n    }\n    \n    // Get current session id\n    $session_id = session_id();\n    \n    // Check if item is already in cart\n    $check_sql = \"SELECT id FROM cart WHERE session_id = ? AND item_id = ? AND is_ordered = FALSE\";\n    $stmt = mysqli_prepare($conn, $check_sql);\n    mysqli_stmt_bind_param($stmt, \"si\", $session_id, $item_id);\n    mysqli_stmt_execute($stmt);\n    $result = mysqli_stmt_get_result($stmt);\n    \n    if (mysqli_num_rows($result) > 0) {\n        // Increment quantity\n        $update_sql = \"UPDATE cart SET quantity = quantity + 1 WHERE session_id = ? AND item_id = ?\";\n        $stmt = mysqli_prepare($conn, $update_sql);\n        mysqli_stmt_bind_param($stmt, \"si\", $session_id, $item_id);\n        mysqli_stmt_execute($stmt);\n    } else {\n        // Add new item\n        $insert_sql = \"INSERT INTO cart (session_id, item_id, quantity) VALUES (?, ?, 1)\";\n        $stmt = mysqli_prepare($conn, $insert_sql);\n        mysqli_stmt_bind_param($stmt, \"si\", $session_id, $item_id);\n        mysqli_stmt_execute($stmt);\n    }\n    \n    return true;\n}\n\n// Function to get cart items\nfunction getCartItems() {\n    global $conn;\n    \n    // Get current session id\n    $session_id = session_id();\n    \n    $sql = \"SELECT c.id AS cart_id, p.*, c.quantity \n            FROM products p \n            JOIN cart c ON p.id = c.item_id \n            WHERE c.session_id = ? AND c.is_ordered = FALSE\";\n            \n    $stmt = mysqli_prepare($conn, $sql);\n    mysqli_stmt_bind_param($stmt, \"s\", $session_id);\n    mysqli_stmt_execute($stmt);\n    $result = mysqli_stmt_get_result($stmt);\n    \n    return $result;\n}\n\n// Function to update cart quantity\nfunction updateCartQuantity($cart_id, $quantity) {\n    global $conn;\n    \n    // Update quantity in cart\n    $sql = \"UPDATE cart SET quantity = ? WHERE id = ?\";\n    $stmt = mysqli_prepare($conn, $sql);\n    mysqli_stmt_bind_param($stmt, \"ii\", $quantity, $cart_id);\n    mysqli_stmt_execute($stmt);\n    \n    return true;\n}\n\n// Function to delete item from cart\nfunction deleteCartItem($cart_id) {\n    global $conn;\n    \n    // Delete item from cart\n    $sql = \"DELETE FROM cart WHERE id = ?\";\n    $stmt = mysqli_prepare($conn, $sql);\n    mysqli_stmt_bind_param($stmt, \"i\", $cart_id);\n    mysqli_stmt_execute($stmt);\n    \n    return true;\n}\n\n// Function to calculate total price\nfunction calculateTotal() {\n    global $conn;\n    \n    // Get current session id\n    $session_id = session_id();\n    \n    $sql = \"SELECT SUM(p.price * c.quantity) AS total \n            FROM products p \n            JOIN cart c ON p.id = c.item_id \n            WHERE c.session_id = ? AND c.is_ordered = FALSE\";\n            \n    $stmt = mysqli_prepare($conn, $sql);\n    mysqli_stmt_bind_param($stmt, \"s\", $session_id);\n    mysqli_stmt_execute($stmt);\n    $result = mysqli_stmt_get_result($stmt);\n    $row = mysqli_fetch_assoc($result);\n    \n    return $row['total'];\n}\n\n// Initialize session\nif (!isset($_SESSION)) {\n    session_start();\n}\n\n// Check if cart table has items for this session, \n// if not, insert a new session into the cart table\n$session_id = session_id();\n\n$sql = \"SELECT id FROM cart WHERE session_id = ?\";\n$stmt = mysqli_prepare($conn, $sql);\nmysqli_stmt_bind_param($stmt, \"s\", $session_id);\nmysqli_stmt_execute($stmt);\n$result = mysqli_stmt_get_result($stmt);\n\nif (mysqli_num_rows($result) == 0) {\n    // Insert new session\n    $insert_sql = \"INSERT INTO cart (session_id) VALUES (?)\";\n    $stmt = mysqli_prepare($conn, $insert_sql);\n    mysqli_stmt_bind_param($stmt, \"s\", $session_id);\n    mysqli_stmt_execute($stmt);\n}\n?>\n```", "```php\n<?php\nrequire_once 'cart_functions.php';\n\n// Add item to cart\nif (isset($_POST['add_to_cart'])) {\n    addToCart($_POST['product_id']);\n}\n\n// Update quantity\nif (isset($_POST['update_quantity'])) {\n    updateCartQuantity($_POST['cart_id'], $_POST['quantity']);\n}\n\n// Delete item from cart\nif (isset($_GET['delete_item'])) {\n    deleteCartItem($_GET['cart_id']);\n}\n?>\n\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Shopping Cart</title>\n</head>\n<body>\n    <?php if ($result = getCartItems()): ?>\n        <h2>Your Cart</h2>\n        <table border=\"1\">\n            <tr>\n                <th>Product Name</th>\n                <th>Price</th>\n                <th>Quantity</th>\n                <th>Total</th>\n                <th>Action</th>\n            </tr>\n            <?php while ($row = mysqli_fetch_assoc($result)): ?>\n                <tr>\n                    <td><?php echo $row['name']; ?></td>\n                    <td>$<?php echo number_format($row['price'], 2); ?></td>\n                    <td>\n                        <form action=\"\" method=\"post\">\n                            <input type=\"hidden\" name=\"cart_id\" value=\"<?php echo $row['cart_id']; ?>\">\n                            <input type=\"number\" name=\"quantity\" value=\"<?php echo $row['quantity']; ?>\" min=\"1\">\n                            <button type=\"submit\" name=\"update_quantity\">Update</button>\n                        </form>\n                    </td>\n                    <td>$<?php echo number_format($row['price'] * $row['quantity'], 2); ?></td>\n                    <td>\n                        <a href=\"?delete_item=<?php echo $row['cart_id']; ?>\">Delete</a>\n                    </td>\n                </tr>\n            <?php endwhile; ?>\n        </table>\n        <h3>Total: $<?php echo number_format(calculateTotal(), 2); ?></h3>\n    <?php else: ?>\n        <p>Your cart is empty.</p>\n    <?php endif; ?>\n\n    <!-- Add items to cart -->\n    <?php\n    // Fetch products from database\n    $sql = \"SELECT * FROM products\";\n    $result = mysqli_query($conn, $sql);\n    \n    if ($result && mysqli_num_rows($result) > 0):\n    ?>\n        <h2>Products</h2>\n        <div class=\"products\">\n            <?php while ($row = mysqli_fetch_assoc($result)): ?>\n                <div class=\"product-item\">\n                    <img src=\"<?php echo $row['image']; ?>\" alt=\"<?php echo $row['name']; ?>\">\n                    <h3><?php echo $row['name']; ?></h3>\n                    <p>$<?php echo number_format($row['price'], 2); ?></p>\n                    <form action=\"\" method=\"post\">\n                        <input type=\"hidden\" name=\"product_id\" value=\"<?php echo $row['id']; ?>\">\n                        <button type=\"submit\" name=\"add_to_cart\">Add to Cart</button>\n                    </form>\n                </div>\n            <?php endwhile; ?>\n        </div>\n    <?php endif; ?>\n</body>\n</html>\n```"]}
