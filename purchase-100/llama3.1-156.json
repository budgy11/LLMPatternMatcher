{"prompt": "Create a purchase functionality using php", "llm_output": "Here's an example of a basic purchase functionality using PHP. This will include a form for the user to input their details, a function to process the payment (using Stripe as our payment gateway), and a function to update the order in the database.\n\n**Note:** Before you can use this code, make sure you have the following:\n\n*   A PHP environment set up on your server\n*   The Stripe API keys (API key and secret key) configured for your application\n*   A MySQL database set up with a table called `orders` to store the orders\n\n**purchase.php**\n\n```php\n<?php\n\n// Configuration file\nrequire 'config.php';\n\n// Initialize session\nsession_start();\n\n// Connect to MySQL database\n$conn = new mysqli($servername, $username, $password, $dbname);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Define the payment function using Stripe\nfunction stripePayment($token, $amount) {\n    // Stripe secret key\n    $stripeSecretKey = 'YOUR_STRIPE_SECRET_KEY';\n    \n    \\Stripe\\Stripe::setApiKey($stripeSecretKey);\n\n    try {\n        // Create a charge object to purchase some things (we're going to buy the user's soul!)\n        $charge = array(\n            \"amount\" => $amount * 100, // convert amount from dollars to cents\n            \"currency\" => \"usd\",\n            \"source\" => $token,\n            \"description\" => \"Test Charge\"\n        );\n\n        $customer = \\Stripe\\Customer::create(array(\"email\" => $_SESSION['email']));\n\n        $charge = \\Stripe\\Charge::create($charge);\n\n        // If the payment was successful, create an order in our database\n        if ($charge->status == 'succeeded') {\n            $sql = \"INSERT INTO orders (amount, user_id)\n                    VALUES ('\" . $_POST['amount'] . \"', '\" . $_SESSION['id'] . \"')\";\n\n            if ($conn->query($sql) === TRUE) {\n                echo \"Order created successfully!\";\n            } else {\n                echo \"Error: \" . $sql . \"<br>\" . $conn->error;\n            }\n        } else {\n            echo \"Payment failed.\";\n        }\n\n    } catch (\\Stripe\\Error\\Card $e) {\n        // Since it's a decline, we'll retry by sending the user back to our payment form\n        echo \"Payment declined: \" . $e->getMessage();\n    } catch (Exception $e) {\n        // Something else happened, continue\n        echo 'Unexpected error: ' . $e->getMessage();\n    }\n}\n\n// Define the function to update order in database\nfunction updateOrder() {\n    global $conn;\n    \n    if ($stmt = $conn->prepare(\"INSERT INTO orders (amount, user_id)\n                               VALUES (?, ?)\")) {\n\n        // Bind parameters\n        $stmt->bind_param(\"is\", $_POST['amount'], $_SESSION['id']);\n\n        // Execute query\n        if ($stmt->execute()) {\n            echo \"Order created successfully!\";\n        } else {\n            echo \"Error updating order: \" . $conn->error;\n        }\n\n        // Close statement\n        $stmt->close();\n    }\n}\n\n// Check for POST request and process purchase\nif ($_SERVER[\"REQUEST_METHOD\"] == \"POST\") {\n\n    // Get the amount from the form\n    $amount = $_POST['amount'];\n\n    // Process payment using Stripe\n    stripePayment($_POST['stripeToken'], $amount);\n\n} else {\n    // If not POST, display a simple form to input purchase details\n?>\n\n<html>\n  <head>\n    <title>Make Purchase</title>\n  </head>\n\n  <body>\n    <?php if (isset($_SESSION['logged_in']) && $_SESSION['logged_in'] == true) : ?>\n      <form action=\"<?php echo htmlspecialchars($_SERVER[\"PHP_SELF\"]);?>\" method=\"post\">\n        Amount: <input type=\"number\" name=\"amount\"><br><br>\n        Stripe Token: <input type=\"hidden\" name=\"stripeToken\"><?php echo (isset($_POST['stripeToken'])) ? $_POST['stripeToken'] : ''; ?><br><br>\n\n        <button type=\"submit\">Make Purchase</button>\n      </form>\n\n    <?php else : ?>\n      <h2>You are not logged in!</h2>\n\n    <?php endif; ?>\n\n  </body>\n</html>\n\n<?php\n}\n\n// Close MySQL connection\n$conn->close();\n\n?>\n```\n\n**config.php**\n\n```php\n<?php\n\n// Configuration file for database connection details and Stripe API keys\n$servername = \"localhost\";\n$username = \"root\";\n$password = \"\";\n$dbname = \"mydatabase\";\n\n?>\n```\n\nIn this example, we're using a simple form to input the amount of purchase and the stripe token. When the form is submitted (via POST), the `stripePayment` function processes the payment using Stripe.\n\nThis code assumes that you have already set up a MySQL database with a table called `orders` to store the orders.\n\n**Notes:**\n\n*   Make sure to replace `YOUR_STRIPE_SECRET_KEY` in `purchase.php` with your actual Stripe secret key.\n*   This is a basic example and does not include any error checking or security measures. For production use, you should add checks for things like valid email addresses and amounts, as well as consider using HTTPS and other best practices.\n\n**Remember to replace the `YOUR_STRIPE_SECRET_KEY` with your actual Stripe secret key when deploying this code in a production environment!**", "code_blocks": ["```php\n<?php\n\n// Configuration file\nrequire 'config.php';\n\n// Initialize session\nsession_start();\n\n// Connect to MySQL database\n$conn = new mysqli($servername, $username, $password, $dbname);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Define the payment function using Stripe\nfunction stripePayment($token, $amount) {\n    // Stripe secret key\n    $stripeSecretKey = 'YOUR_STRIPE_SECRET_KEY';\n    \n    \\Stripe\\Stripe::setApiKey($stripeSecretKey);\n\n    try {\n        // Create a charge object to purchase some things (we're going to buy the user's soul!)\n        $charge = array(\n            \"amount\" => $amount * 100, // convert amount from dollars to cents\n            \"currency\" => \"usd\",\n            \"source\" => $token,\n            \"description\" => \"Test Charge\"\n        );\n\n        $customer = \\Stripe\\Customer::create(array(\"email\" => $_SESSION['email']));\n\n        $charge = \\Stripe\\Charge::create($charge);\n\n        // If the payment was successful, create an order in our database\n        if ($charge->status == 'succeeded') {\n            $sql = \"INSERT INTO orders (amount, user_id)\n                    VALUES ('\" . $_POST['amount'] . \"', '\" . $_SESSION['id'] . \"')\";\n\n            if ($conn->query($sql) === TRUE) {\n                echo \"Order created successfully!\";\n            } else {\n                echo \"Error: \" . $sql . \"<br>\" . $conn->error;\n            }\n        } else {\n            echo \"Payment failed.\";\n        }\n\n    } catch (\\Stripe\\Error\\Card $e) {\n        // Since it's a decline, we'll retry by sending the user back to our payment form\n        echo \"Payment declined: \" . $e->getMessage();\n    } catch (Exception $e) {\n        // Something else happened, continue\n        echo 'Unexpected error: ' . $e->getMessage();\n    }\n}\n\n// Define the function to update order in database\nfunction updateOrder() {\n    global $conn;\n    \n    if ($stmt = $conn->prepare(\"INSERT INTO orders (amount, user_id)\n                               VALUES (?, ?)\")) {\n\n        // Bind parameters\n        $stmt->bind_param(\"is\", $_POST['amount'], $_SESSION['id']);\n\n        // Execute query\n        if ($stmt->execute()) {\n            echo \"Order created successfully!\";\n        } else {\n            echo \"Error updating order: \" . $conn->error;\n        }\n\n        // Close statement\n        $stmt->close();\n    }\n}\n\n// Check for POST request and process purchase\nif ($_SERVER[\"REQUEST_METHOD\"] == \"POST\") {\n\n    // Get the amount from the form\n    $amount = $_POST['amount'];\n\n    // Process payment using Stripe\n    stripePayment($_POST['stripeToken'], $amount);\n\n} else {\n    // If not POST, display a simple form to input purchase details\n?>\n\n<html>\n  <head>\n    <title>Make Purchase</title>\n  </head>\n\n  <body>\n    <?php if (isset($_SESSION['logged_in']) && $_SESSION['logged_in'] == true) : ?>\n      <form action=\"<?php echo htmlspecialchars($_SERVER[\"PHP_SELF\"]);?>\" method=\"post\">\n        Amount: <input type=\"number\" name=\"amount\"><br><br>\n        Stripe Token: <input type=\"hidden\" name=\"stripeToken\"><?php echo (isset($_POST['stripeToken'])) ? $_POST['stripeToken'] : ''; ?><br><br>\n\n        <button type=\"submit\">Make Purchase</button>\n      </form>\n\n    <?php else : ?>\n      <h2>You are not logged in!</h2>\n\n    <?php endif; ?>\n\n  </body>\n</html>\n\n<?php\n}\n\n// Close MySQL connection\n$conn->close();\n\n?>\n```", "```php\n<?php\n\n// Configuration file for database connection details and Stripe API keys\n$servername = \"localhost\";\n$username = \"root\";\n$password = \"\";\n$dbname = \"mydatabase\";\n\n?>\n```"]}
