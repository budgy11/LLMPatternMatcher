{"prompt": "Create a purchase functionality using php", "llm_output": "**Purchase Functionality in PHP**\n=====================================\n\nIn this example, we will create a basic purchase functionality using PHP. This example assumes that you have already set up a MySQL database and are familiar with basic PHP concepts.\n\n**Database Schema**\n-------------------\n\nFor the purpose of this example, let's assume we have the following database schema:\n\n```sql\nCREATE TABLE products (\n    id INT PRIMARY KEY AUTO_INCREMENT,\n    name VARCHAR(255),\n    price DECIMAL(10, 2)\n);\n\nCREATE TABLE orders (\n    id INT PRIMARY KEY AUTO_INCREMENT,\n    user_id INT,\n    total DECIMAL(10, 2),\n    status VARCHAR(255) DEFAULT 'pending'\n);\n```\n\n**Purchase Functionality**\n---------------------------\n\nCreate a new PHP file called `purchase.php` and add the following code:\n\n```php\n<?php\n\n// Configuration\ndefine('DB_HOST', 'localhost');\ndefine('DB_USER', 'your_username');\ndefine('DB_PASSWORD', 'your_password');\ndefine('DB_NAME', 'your_database');\n\n// Connect to database\n$conn = new mysqli(DB_HOST, DB_USER, DB_PASSWORD, DB_NAME);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Function to add product to cart\nfunction addProductToCart($product_id, $quantity) {\n    global $conn;\n    \n    // Check if product exists in database\n    $query = \"SELECT * FROM products WHERE id = '$product_id'\";\n    $result = $conn->query($query);\n    \n    if ($result->num_rows > 0) {\n        // Get product details\n        $row = $result->fetch_assoc();\n        \n        // Update cart with new product\n        $query = \"INSERT INTO orders (user_id, total, status) VALUES ('', '\" . $quantity * $row['price'] . \"', 'pending')\";\n        $conn->query($query);\n        \n        echo \"Product added to cart successfully!\";\n    } else {\n        echo \"Product not found in database.\";\n    }\n}\n\n// Function to checkout\nfunction checkout() {\n    global $conn;\n    \n    // Get current user ID (assuming we have a login system)\n    $user_id = $_SESSION['user_id'];\n    \n    // Calculate total cost of products in cart\n    $query = \"SELECT * FROM orders WHERE user_id = '$user_id'\";\n    $result = $conn->query($query);\n    \n    if ($result->num_rows > 0) {\n        $total_cost = 0;\n        \n        while ($row = $result->fetch_assoc()) {\n            $total_cost += $row['total'];\n        }\n        \n        // Update order status to 'completed'\n        $query = \"UPDATE orders SET status = 'completed' WHERE user_id = '$user_id'\";\n        $conn->query($query);\n        \n        echo \"Order completed successfully!\";\n    } else {\n        echo \"No products in cart.\";\n    }\n}\n\n// Process form submission\nif (isset($_POST['add_product'])) {\n    addProductToCart($_POST['product_id'], $_POST['quantity']);\n} elseif (isset($_POST['checkout'])) {\n    checkout();\n}\n\n?>\n```\n\n**HTML Form**\n----------------\n\nCreate an HTML form to display the products and allow users to add them to their cart:\n\n```html\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Purchase Functionality</title>\n</head>\n<body>\n\n<h1>Purchase Functionality</h1>\n\n<form action=\"purchase.php\" method=\"post\">\n    <input type=\"hidden\" name=\"product_id\" value=\"<?php echo $_GET['product_id']; ?>\">\n    <input type=\"hidden\" name=\"quantity\" value=\"<?php echo $_GET['quantity']; ?>\">\n    \n    <label for=\"product_name\">Product Name:</label>\n    <span><?php echo $_GET['product_name']; ?></span><br>\n    \n    <label for=\"price\">Price:</label>\n    <span><?php echo number_format($_GET['price'], 2); ?></span><br>\n    \n    <input type=\"submit\" name=\"add_product\" value=\"Add to Cart\">\n</form>\n\n<form action=\"purchase.php\" method=\"post\">\n    <input type=\"hidden\" name=\"checkout\" value=\"true\">\n    \n    <label for=\"total\">Total:</label>\n    <span><?php echo number_format($total_cost, 2); ?></span><br>\n    \n    <input type=\"submit\" name=\"checkout\" value=\"Checkout\">\n</form>\n\n</body>\n</html>\n```\n\n**Usage**\n------------\n\n1. Call the `purchase.php` file with product ID and quantity as GET parameters:\n```bash\nhttp://example.com/purchase.php?product_id=1&quantity=2&product_name=Product%20Name&price=19.99\n```\n2. Click on \"Add to Cart\" to add the product to cart.\n3. Click on \"Checkout\" to process the order.\n\nNote: This is a basic example and you should modify it according to your specific requirements. Additionally, this code does not handle errors or security issues, so please make sure to add proper error handling and security measures in a real-world application.", "code_blocks": [null, "```php\n<?php\n\n// Configuration\ndefine('DB_HOST', 'localhost');\ndefine('DB_USER', 'your_username');\ndefine('DB_PASSWORD', 'your_password');\ndefine('DB_NAME', 'your_database');\n\n// Connect to database\n$conn = new mysqli(DB_HOST, DB_USER, DB_PASSWORD, DB_NAME);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Function to add product to cart\nfunction addProductToCart($product_id, $quantity) {\n    global $conn;\n    \n    // Check if product exists in database\n    $query = \"SELECT * FROM products WHERE id = '$product_id'\";\n    $result = $conn->query($query);\n    \n    if ($result->num_rows > 0) {\n        // Get product details\n        $row = $result->fetch_assoc();\n        \n        // Update cart with new product\n        $query = \"INSERT INTO orders (user_id, total, status) VALUES ('', '\" . $quantity * $row['price'] . \"', 'pending')\";\n        $conn->query($query);\n        \n        echo \"Product added to cart successfully!\";\n    } else {\n        echo \"Product not found in database.\";\n    }\n}\n\n// Function to checkout\nfunction checkout() {\n    global $conn;\n    \n    // Get current user ID (assuming we have a login system)\n    $user_id = $_SESSION['user_id'];\n    \n    // Calculate total cost of products in cart\n    $query = \"SELECT * FROM orders WHERE user_id = '$user_id'\";\n    $result = $conn->query($query);\n    \n    if ($result->num_rows > 0) {\n        $total_cost = 0;\n        \n        while ($row = $result->fetch_assoc()) {\n            $total_cost += $row['total'];\n        }\n        \n        // Update order status to 'completed'\n        $query = \"UPDATE orders SET status = 'completed' WHERE user_id = '$user_id'\";\n        $conn->query($query);\n        \n        echo \"Order completed successfully!\";\n    } else {\n        echo \"No products in cart.\";\n    }\n}\n\n// Process form submission\nif (isset($_POST['add_product'])) {\n    addProductToCart($_POST['product_id'], $_POST['quantity']);\n} elseif (isset($_POST['checkout'])) {\n    checkout();\n}\n\n?>\n```", null, null]}
