{"prompt": "Create a purchase functionality using php", "llm_output": "Here's an example of how you can create a basic purchase functionality using PHP. This will include features such as user authentication, product management, and order processing.\n\n**Database Schema:**\n\nWe'll use a MySQL database to store the data. The schema would look like this:\n\n```sql\nCREATE TABLE users (\n  id INT AUTO_INCREMENT,\n  username VARCHAR(255) NOT NULL,\n  password VARCHAR(255) NOT NULL,\n  email VARCHAR(255) NOT NULL,\n  PRIMARY KEY (id)\n);\n\nCREATE TABLE products (\n  id INT AUTO_INCREMENT,\n  name VARCHAR(255) NOT NULL,\n  description TEXT,\n  price DECIMAL(10,2) NOT NULL,\n  stock INT NOT NULL DEFAULT 0,\n  PRIMARY KEY (id)\n);\n\nCREATE TABLE orders (\n  id INT AUTO_INCREMENT,\n  user_id INT NOT NULL,\n  order_date DATE NOT NULL DEFAULT CURRENT_DATE,\n  total DECIMAL(10,2) NOT NULL,\n  status VARCHAR(255) NOT NULL DEFAULT 'pending',\n  PRIMARY KEY (id),\n  FOREIGN KEY (user_id) REFERENCES users(id)\n);\n\nCREATE TABLE order_items (\n  id INT AUTO_INCREMENT,\n  order_id INT NOT NULL,\n  product_id INT NOT NULL,\n  quantity INT NOT NULL,\n  price DECIMAL(10,2) NOT NULL,\n  PRIMARY KEY (id),\n  FOREIGN KEY (order_id) REFERENCES orders(id),\n  FOREIGN KEY (product_id) REFERENCES products(id)\n);\n```\n\n**PHP Code:**\n\nCreate a new PHP file called `cart.php` and add the following code:\n\n```php\n<?php\n\n// Database connection settings\n$db_host = 'localhost';\n$db_username = 'root';\n$db_password = '';\n$db_name = 'store';\n\n// Connect to database\n$conn = mysqli_connect($db_host, $db_username, $db_password, $db_name);\n\nif (!$conn) {\n    die(\"Connection failed: \" . mysqli_connect_error());\n}\n\nfunction login() {\n    global $conn;\n    \n    if (isset($_POST['username']) && isset($_POST['password'])) {\n        $username = $_POST['username'];\n        $password = md5($_POST['password']);\n        \n        $query = \"SELECT * FROM users WHERE username='$username' AND password='$password'\";\n        $result = mysqli_query($conn, $query);\n        \n        if (mysqli_num_rows($result) > 0) {\n            session_start();\n            $_SESSION['username'] = $username;\n            header('Location: index.php');\n            exit;\n        } else {\n            echo 'Invalid username or password';\n        }\n    }\n}\n\nfunction logout() {\n    global $conn;\n    \n    session_destroy();\n    header('Location: index.php');\n    exit;\n}\n\nfunction display_cart() {\n    global $conn;\n    \n    if (isset($_SESSION['username'])) {\n        $user_id = $_SESSION['username'];\n        \n        $query = \"SELECT * FROM order_items WHERE user_id='$user_id'\";\n        $result = mysqli_query($conn, $query);\n        \n        echo '<table border=\"1\">';\n        echo '<tr><th>Product Name</th><th>Quantity</th><th>Price</th></tr>';\n        \n        while ($row = mysqli_fetch_assoc($result)) {\n            $product_id = $row['product_id'];\n            $quantity = $row['quantity'];\n            \n            $query = \"SELECT name, price FROM products WHERE id='$product_id'\";\n            $result2 = mysqli_query($conn, $query);\n            \n            $row2 = mysqli_fetch_assoc($result2);\n            echo '<tr><td>' . $row2['name'] . '</td><td>' . $quantity . '</td><td>$' . $row2['price'] * $quantity . '</td></tr>';\n        }\n        \n        echo '</table>';\n    } else {\n        echo 'You are not logged in';\n    }\n}\n\nfunction add_to_cart() {\n    global $conn;\n    \n    if (isset($_SESSION['username'])) {\n        $user_id = $_SESSION['username'];\n        $product_id = $_POST['product_id'];\n        $quantity = $_POST['quantity'];\n        \n        $query = \"SELECT * FROM order_items WHERE user_id='$user_id' AND product_id='$product_id'\";\n        $result = mysqli_query($conn, $query);\n        \n        if (mysqli_num_rows($result) > 0) {\n            // Update quantity\n            $row = mysqli_fetch_assoc($result);\n            $new_quantity = $row['quantity'] + $quantity;\n            \n            $query = \"UPDATE order_items SET quantity='$new_quantity' WHERE id='\" . $row['id'] . \"'\";\n        } else {\n            // Insert new item\n            $query = \"INSERT INTO order_items (user_id, product_id, quantity) VALUES ('$user_id', '$product_id', '$quantity')\";\n        }\n        \n        mysqli_query($conn, $query);\n    }\n}\n\nfunction checkout() {\n    global $conn;\n    \n    if (isset($_SESSION['username'])) {\n        $user_id = $_SESSION['username'];\n        \n        // Get cart contents\n        $query = \"SELECT * FROM order_items WHERE user_id='$user_id'\";\n        $result = mysqli_query($conn, $query);\n        \n        while ($row = mysqli_fetch_assoc($result)) {\n            $product_id = $row['product_id'];\n            $quantity = $row['quantity'];\n            \n            // Update stock\n            $query = \"UPDATE products SET stock=stock-$quantity WHERE id='$product_id'\";\n            mysqli_query($conn, $query);\n        }\n        \n        // Clear cart\n        $query = \"DELETE FROM order_items WHERE user_id='$user_id'\";\n        mysqli_query($conn, $query);\n    }\n}\n\nif (isset($_POST['action']) && $_POST['action'] == 'login') {\n    login();\n} elseif (isset($_POST['action']) && $_POST['action'] == 'logout') {\n    logout();\n} elseif (isset($_GET['action']) && $_GET['action'] == 'add_to_cart') {\n    add_to_cart();\n} elseif (isset($_POST['action']) && $_POST['action'] == 'checkout') {\n    checkout();\n}\n\ndisplay_cart();\n\n?>\n```\n\n**Frontend Code:**\n\nCreate a new file called `index.php` and add the following code:\n\n```php\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Store</title>\n</head>\n<body>\n\n<h1>Welcome to our store!</h1>\n\n<form method=\"post\">\n    <input type=\"hidden\" name=\"action\" value=\"login\">\n    <label>Username:</label>\n    <input type=\"text\" name=\"username\"><br><br>\n    <label>Password:</label>\n    <input type=\"password\" name=\"password\"><br><br>\n    <input type=\"submit\" value=\"Login\">\n</form>\n\n<form method=\"post\">\n    <input type=\"hidden\" name=\"action\" value=\"logout\">\n    <input type=\"submit\" value=\"Logout\">\n</form>\n\n<h1>Cart:</h1>\n\n<table border=\"1\">\n    <tr><th>Product Name</th><th>Quantity</th><th>Price</th></tr>\n    \n<?php\n    \n    if (isset($_SESSION['username'])) {\n        $user_id = $_SESSION['username'];\n        \n        $query = \"SELECT * FROM order_items WHERE user_id='$user_id'\";\n        $result = mysqli_query($conn, $query);\n        \n        while ($row = mysqli_fetch_assoc($result)) {\n            $product_id = $row['product_id'];\n            $quantity = $row['quantity'];\n            \n            $query = \"SELECT name, price FROM products WHERE id='$product_id'\";\n            $result2 = mysqli_query($conn, $query);\n            \n            $row2 = mysqli_fetch_assoc($result2);\n            echo '<tr><td>' . $row2['name'] . '</td><td>' . $quantity . '</td><td>$' . $row2['price'] * $quantity . '</td></tr>';\n        }\n    } else {\n        echo 'You are not logged in';\n    }\n    \n?>\n</table>\n\n<form method=\"post\">\n    <input type=\"hidden\" name=\"action\" value=\"add_to_cart\">\n    <label>Product ID:</label>\n    <input type=\"text\" name=\"product_id\"><br><br>\n    <label>Quantity:</label>\n    <input type=\"text\" name=\"quantity\"><br><br>\n    <input type=\"submit\" value=\"Add to Cart\">\n</form>\n\n<form method=\"post\">\n    <input type=\"hidden\" name=\"action\" value=\"checkout\">\n    <input type=\"submit\" value=\"Checkout\">\n</form>\n\n</body>\n</html>\n```\n\nThis is a basic example of how you can create a purchase functionality using PHP. You will need to adapt this code to fit your specific needs.\n\n**Note:** This code uses the `mysqli` extension, which is a MySQL library for PHP. It's recommended to use prepared statements and parameterized queries instead of string concatenation or using variables directly in your SQL queries to prevent SQL injection attacks.\n\nAlso, remember to replace the database connection settings with your own credentials and adjust the table and column names according to your actual database schema.", "code_blocks": [null, "```php\n<?php\n\n// Database connection settings\n$db_host = 'localhost';\n$db_username = 'root';\n$db_password = '';\n$db_name = 'store';\n\n// Connect to database\n$conn = mysqli_connect($db_host, $db_username, $db_password, $db_name);\n\nif (!$conn) {\n    die(\"Connection failed: \" . mysqli_connect_error());\n}\n\nfunction login() {\n    global $conn;\n    \n    if (isset($_POST['username']) && isset($_POST['password'])) {\n        $username = $_POST['username'];\n        $password = md5($_POST['password']);\n        \n        $query = \"SELECT * FROM users WHERE username='$username' AND password='$password'\";\n        $result = mysqli_query($conn, $query);\n        \n        if (mysqli_num_rows($result) > 0) {\n            session_start();\n            $_SESSION['username'] = $username;\n            header('Location: index.php');\n            exit;\n        } else {\n            echo 'Invalid username or password';\n        }\n    }\n}\n\nfunction logout() {\n    global $conn;\n    \n    session_destroy();\n    header('Location: index.php');\n    exit;\n}\n\nfunction display_cart() {\n    global $conn;\n    \n    if (isset($_SESSION['username'])) {\n        $user_id = $_SESSION['username'];\n        \n        $query = \"SELECT * FROM order_items WHERE user_id='$user_id'\";\n        $result = mysqli_query($conn, $query);\n        \n        echo '<table border=\"1\">';\n        echo '<tr><th>Product Name</th><th>Quantity</th><th>Price</th></tr>';\n        \n        while ($row = mysqli_fetch_assoc($result)) {\n            $product_id = $row['product_id'];\n            $quantity = $row['quantity'];\n            \n            $query = \"SELECT name, price FROM products WHERE id='$product_id'\";\n            $result2 = mysqli_query($conn, $query);\n            \n            $row2 = mysqli_fetch_assoc($result2);\n            echo '<tr><td>' . $row2['name'] . '</td><td>' . $quantity . '</td><td>$' . $row2['price'] * $quantity . '</td></tr>';\n        }\n        \n        echo '</table>';\n    } else {\n        echo 'You are not logged in';\n    }\n}\n\nfunction add_to_cart() {\n    global $conn;\n    \n    if (isset($_SESSION['username'])) {\n        $user_id = $_SESSION['username'];\n        $product_id = $_POST['product_id'];\n        $quantity = $_POST['quantity'];\n        \n        $query = \"SELECT * FROM order_items WHERE user_id='$user_id' AND product_id='$product_id'\";\n        $result = mysqli_query($conn, $query);\n        \n        if (mysqli_num_rows($result) > 0) {\n            // Update quantity\n            $row = mysqli_fetch_assoc($result);\n            $new_quantity = $row['quantity'] + $quantity;\n            \n            $query = \"UPDATE order_items SET quantity='$new_quantity' WHERE id='\" . $row['id'] . \"'\";\n        } else {\n            // Insert new item\n            $query = \"INSERT INTO order_items (user_id, product_id, quantity) VALUES ('$user_id', '$product_id', '$quantity')\";\n        }\n        \n        mysqli_query($conn, $query);\n    }\n}\n\nfunction checkout() {\n    global $conn;\n    \n    if (isset($_SESSION['username'])) {\n        $user_id = $_SESSION['username'];\n        \n        // Get cart contents\n        $query = \"SELECT * FROM order_items WHERE user_id='$user_id'\";\n        $result = mysqli_query($conn, $query);\n        \n        while ($row = mysqli_fetch_assoc($result)) {\n            $product_id = $row['product_id'];\n            $quantity = $row['quantity'];\n            \n            // Update stock\n            $query = \"UPDATE products SET stock=stock-$quantity WHERE id='$product_id'\";\n            mysqli_query($conn, $query);\n        }\n        \n        // Clear cart\n        $query = \"DELETE FROM order_items WHERE user_id='$user_id'\";\n        mysqli_query($conn, $query);\n    }\n}\n\nif (isset($_POST['action']) && $_POST['action'] == 'login') {\n    login();\n} elseif (isset($_POST['action']) && $_POST['action'] == 'logout') {\n    logout();\n} elseif (isset($_GET['action']) && $_GET['action'] == 'add_to_cart') {\n    add_to_cart();\n} elseif (isset($_POST['action']) && $_POST['action'] == 'checkout') {\n    checkout();\n}\n\ndisplay_cart();\n\n?>\n```", "```php\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Store</title>\n</head>\n<body>\n\n<h1>Welcome to our store!</h1>\n\n<form method=\"post\">\n    <input type=\"hidden\" name=\"action\" value=\"login\">\n    <label>Username:</label>\n    <input type=\"text\" name=\"username\"><br><br>\n    <label>Password:</label>\n    <input type=\"password\" name=\"password\"><br><br>\n    <input type=\"submit\" value=\"Login\">\n</form>\n\n<form method=\"post\">\n    <input type=\"hidden\" name=\"action\" value=\"logout\">\n    <input type=\"submit\" value=\"Logout\">\n</form>\n\n<h1>Cart:</h1>\n\n<table border=\"1\">\n    <tr><th>Product Name</th><th>Quantity</th><th>Price</th></tr>\n    \n<?php\n    \n    if (isset($_SESSION['username'])) {\n        $user_id = $_SESSION['username'];\n        \n        $query = \"SELECT * FROM order_items WHERE user_id='$user_id'\";\n        $result = mysqli_query($conn, $query);\n        \n        while ($row = mysqli_fetch_assoc($result)) {\n            $product_id = $row['product_id'];\n            $quantity = $row['quantity'];\n            \n            $query = \"SELECT name, price FROM products WHERE id='$product_id'\";\n            $result2 = mysqli_query($conn, $query);\n            \n            $row2 = mysqli_fetch_assoc($result2);\n            echo '<tr><td>' . $row2['name'] . '</td><td>' . $quantity . '</td><td>$' . $row2['price'] * $quantity . '</td></tr>';\n        }\n    } else {\n        echo 'You are not logged in';\n    }\n    \n?>\n</table>\n\n<form method=\"post\">\n    <input type=\"hidden\" name=\"action\" value=\"add_to_cart\">\n    <label>Product ID:</label>\n    <input type=\"text\" name=\"product_id\"><br><br>\n    <label>Quantity:</label>\n    <input type=\"text\" name=\"quantity\"><br><br>\n    <input type=\"submit\" value=\"Add to Cart\">\n</form>\n\n<form method=\"post\">\n    <input type=\"hidden\" name=\"action\" value=\"checkout\">\n    <input type=\"submit\" value=\"Checkout\">\n</form>\n\n</body>\n</html>\n```"]}
