{"prompt": "Create a purchase functionality using php", "llm_output": "Here is an example of a basic purchase functionality in PHP:\n\n**Note:** This example assumes you have a database set up with the necessary tables to store products and user information. For this example, we will use MySQL.\n\n**Database Schema:**\n\n```sql\nCREATE TABLE products (\n    id INT PRIMARY KEY AUTO_INCREMENT,\n    name VARCHAR(255),\n    price DECIMAL(10,2)\n);\n\nCREATE TABLE users (\n    id INT PRIMARY KEY AUTO_INCREMENT,\n    username VARCHAR(255),\n    email VARCHAR(255)\n);\n\nCREATE TABLE orders (\n    id INT PRIMARY KEY AUTO_INCREMENT,\n    user_id INT,\n    product_id INT,\n    order_date DATE,\n    total DECIMAL(10,2)\n);\n```\n\n**PHP Code:**\n\nWe will create three PHP files for this example:\n\n1. `index.php`: This will be the main page where users can select products and proceed to checkout.\n2. `cart.php`: This will handle the cart functionality, displaying selected products and calculating total cost.\n3. `process_purchase.php`: This will process the purchase when the user submits the order.\n\n**`index.php`:**\n```php\n<?php\n// Include database connection file (e.g., db_connection.php)\nrequire_once 'db_connection.php';\n\n// Get all products from database\n$query = \"SELECT * FROM products\";\n$products = mysqli_query($conn, $query);\n\n?>\n\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Product Selection</title>\n</head>\n<body>\n\n    <!-- Display products -->\n    <?php foreach ($products as $product): ?>\n        <p><?php echo $product['name']; ?> (<?php echo $product['price']; ?>)</p>\n        <form action=\"cart.php\" method=\"post\">\n            <input type=\"hidden\" name=\"product_id\" value=\"<?php echo $product['id']; ?>\">\n            <button type=\"submit\">Add to Cart</button>\n        </form>\n    <?php endforeach; ?>\n\n    <!-- Link to cart -->\n    <a href=\"cart.php\">View Cart</a>\n\n</body>\n</html>\n```\n\n**`cart.php`:**\n```php\n<?php\n// Include database connection file (e.g., db_connection.php)\nrequire_once 'db_connection.php';\n\n// Check if user has submitted the form\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n    // Get product ID from hidden input field\n    $product_id = $_POST['product_id'];\n\n    // Insert product into cart table\n    $query = \"INSERT INTO cart (user_id, product_id) VALUES ('', '$product_id')\";\n    mysqli_query($conn, $query);\n\n    // Redirect to cart page with updated cart content\n    header('Location: cart.php');\n    exit;\n}\n\n// Get all products in user's cart from database\n$query = \"SELECT * FROM cart\";\n$cart_products = mysqli_query($conn, $query);\n\n?>\n\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Cart</title>\n</head>\n<body>\n\n    <!-- Display cart content -->\n    <?php foreach ($cart_products as $product): ?>\n        <p><?php echo $product['name']; ?> (<?php echo $product['price']; ?>)</p>\n        <form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\">\n            <input type=\"hidden\" name=\"remove_product_id\" value=\"<?php echo $product['id']; ?>\">\n            <button type=\"submit\">Remove from Cart</button>\n        </form>\n    <?php endforeach; ?>\n\n    <!-- Display total cost -->\n    <?php\n    // Calculate total cost by summing up all product prices in cart\n    $total_cost = 0;\n    foreach ($cart_products as $product) {\n        $query = \"SELECT price FROM products WHERE id = '$product['product_id']'\";\n        $result = mysqli_query($conn, $query);\n        $price = mysqli_fetch_array($result)['price'];\n        $total_cost += $price;\n    }\n    ?>\n\n    <p>Total Cost: <?php echo $total_cost; ?></p>\n\n    <!-- Form to proceed to checkout -->\n    <form action=\"process_purchase.php\" method=\"post\">\n        <input type=\"hidden\" name=\"user_id\" value=\"<?php echo $_SESSION['user_id']; ?>\">\n        <button type=\"submit\">Proceed to Checkout</button>\n    </form>\n\n</body>\n</html>\n```\n\n**`process_purchase.php`:**\n```php\n<?php\n// Include database connection file (e.g., db_connection.php)\nrequire_once 'db_connection.php';\n\n// Check if user has submitted the form\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n    // Get user ID from hidden input field\n    $user_id = $_POST['user_id'];\n\n    // Create new order in database\n    $query = \"INSERT INTO orders (user_id, product_id) VALUES ('$user_id', '')\";\n    mysqli_query($conn, $query);\n\n    // Update cart table to reflect removed products\n    $query = \"UPDATE cart SET user_id = '', product_id = '' WHERE user_id = '$user_id'\";\n    mysqli_query($conn, $query);\n\n    // Redirect to success page\n    header('Location: success.php');\n    exit;\n}\n\n// Redirect to error page if user has not submitted the form\nheader('Location: error.php');\nexit;\n?>\n```\n\n**Note:** This is a simplified example and does not include any security measures (e.g., sanitizing input, validating user authentication). You should always implement proper security measures when creating a real-world application.\n\nThis example demonstrates the basic functionality of a purchase system using PHP. Users can select products, add them to their cart, view the cart contents, calculate the total cost, and proceed to checkout to complete the purchase.", "code_blocks": [null, "```php\n<?php\n// Include database connection file (e.g., db_connection.php)\nrequire_once 'db_connection.php';\n\n// Get all products from database\n$query = \"SELECT * FROM products\";\n$products = mysqli_query($conn, $query);\n\n?>\n\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Product Selection</title>\n</head>\n<body>\n\n    <!-- Display products -->\n    <?php foreach ($products as $product): ?>\n        <p><?php echo $product['name']; ?> (<?php echo $product['price']; ?>)</p>\n        <form action=\"cart.php\" method=\"post\">\n            <input type=\"hidden\" name=\"product_id\" value=\"<?php echo $product['id']; ?>\">\n            <button type=\"submit\">Add to Cart</button>\n        </form>\n    <?php endforeach; ?>\n\n    <!-- Link to cart -->\n    <a href=\"cart.php\">View Cart</a>\n\n</body>\n</html>\n```", "```php\n<?php\n// Include database connection file (e.g., db_connection.php)\nrequire_once 'db_connection.php';\n\n// Check if user has submitted the form\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n    // Get product ID from hidden input field\n    $product_id = $_POST['product_id'];\n\n    // Insert product into cart table\n    $query = \"INSERT INTO cart (user_id, product_id) VALUES ('', '$product_id')\";\n    mysqli_query($conn, $query);\n\n    // Redirect to cart page with updated cart content\n    header('Location: cart.php');\n    exit;\n}\n\n// Get all products in user's cart from database\n$query = \"SELECT * FROM cart\";\n$cart_products = mysqli_query($conn, $query);\n\n?>\n\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Cart</title>\n</head>\n<body>\n\n    <!-- Display cart content -->\n    <?php foreach ($cart_products as $product): ?>\n        <p><?php echo $product['name']; ?> (<?php echo $product['price']; ?>)</p>\n        <form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\">\n            <input type=\"hidden\" name=\"remove_product_id\" value=\"<?php echo $product['id']; ?>\">\n            <button type=\"submit\">Remove from Cart</button>\n        </form>\n    <?php endforeach; ?>\n\n    <!-- Display total cost -->\n    <?php\n    // Calculate total cost by summing up all product prices in cart\n    $total_cost = 0;\n    foreach ($cart_products as $product) {\n        $query = \"SELECT price FROM products WHERE id = '$product['product_id']'\";\n        $result = mysqli_query($conn, $query);\n        $price = mysqli_fetch_array($result)['price'];\n        $total_cost += $price;\n    }\n    ?>\n\n    <p>Total Cost: <?php echo $total_cost; ?></p>\n\n    <!-- Form to proceed to checkout -->\n    <form action=\"process_purchase.php\" method=\"post\">\n        <input type=\"hidden\" name=\"user_id\" value=\"<?php echo $_SESSION['user_id']; ?>\">\n        <button type=\"submit\">Proceed to Checkout</button>\n    </form>\n\n</body>\n</html>\n```", "```php\n<?php\n// Include database connection file (e.g., db_connection.php)\nrequire_once 'db_connection.php';\n\n// Check if user has submitted the form\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n    // Get user ID from hidden input field\n    $user_id = $_POST['user_id'];\n\n    // Create new order in database\n    $query = \"INSERT INTO orders (user_id, product_id) VALUES ('$user_id', '')\";\n    mysqli_query($conn, $query);\n\n    // Update cart table to reflect removed products\n    $query = \"UPDATE cart SET user_id = '', product_id = '' WHERE user_id = '$user_id'\";\n    mysqli_query($conn, $query);\n\n    // Redirect to success page\n    header('Location: success.php');\n    exit;\n}\n\n// Redirect to error page if user has not submitted the form\nheader('Location: error.php');\nexit;\n?>\n```"]}
