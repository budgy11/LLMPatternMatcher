{"prompt": "Create a purchase functionality using php", "llm_output": "Here's an example of how you can create a simple purchase functionality using PHP. This example will include user authentication and order management.\n\n**Database Schema**\n\nWe'll be using the following database schema:\n\n```sql\nCREATE TABLE users (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  username VARCHAR(255) NOT NULL,\n  email VARCHAR(255) NOT NULL,\n  password VARCHAR(255) NOT NULL\n);\n\nCREATE TABLE products (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  name VARCHAR(255) NOT NULL,\n  price DECIMAL(10,2) NOT NULL\n);\n\nCREATE TABLE orders (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  user_id INT NOT NULL,\n  total DECIMAL(10,2) NOT NULL,\n  FOREIGN KEY (user_id) REFERENCES users(id)\n);\n\nCREATE TABLE order_items (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  order_id INT NOT NULL,\n  product_id INT NOT NULL,\n  quantity INT NOT NULL,\n  FOREIGN KEY (order_id) REFERENCES orders(id),\n  FOREIGN KEY (product_id) REFERENCES products(id)\n);\n```\n\n**PHP Code**\n\n```php\n// database connection settings\n$dbHost = 'localhost';\n$dbUsername = 'root';\n$dbPassword = '';\n$dbName = 'store';\n\n// connect to the database\n$conn = new mysqli($dbHost, $dbUsername, $dbPassword, $dbName);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// register user function\nfunction registerUser($username, $email, $password) {\n    global $conn;\n    \n    // hash the password\n    $hashedPassword = password_hash($password, PASSWORD_DEFAULT);\n    \n    // insert into users table\n    $sql = \"INSERT INTO users (username, email, password) VALUES ('$username', '$email', '$hashedPassword')\";\n    if ($conn->query($sql) === TRUE) {\n        return true;\n    } else {\n        echo \"Error: \" . $sql . \"<br>\" . $conn->error;\n        return false;\n    }\n}\n\n// login function\nfunction loginUser($username, $password) {\n    global $conn;\n    \n    // get user from database\n    $sql = \"SELECT * FROM users WHERE username = '$username'\";\n    $result = $conn->query($sql);\n    \n    if ($result->num_rows > 0) {\n        while ($row = $result->fetch_assoc()) {\n            if (password_verify($password, $row['password'])) {\n                return $row;\n            }\n        }\n    }\n    \n    return null;\n}\n\n// add to cart function\nfunction addToCart($productId, $userId) {\n    global $conn;\n    \n    // check if product already exists in cart\n    $sql = \"SELECT * FROM order_items WHERE product_id = '$productId' AND user_id = '$userId'\";\n    $result = $conn->query($sql);\n    \n    if ($result->num_rows > 0) {\n        return false; // product already exists in cart\n    }\n    \n    // insert into order items table\n    $sql = \"INSERT INTO order_items (order_id, product_id, quantity) VALUES ('NULL', '$productId', '1')\";\n    if ($conn->query($sql) === TRUE) {\n        return true;\n    } else {\n        echo \"Error: \" . $sql . \"<br>\" . $conn->error;\n        return false;\n    }\n}\n\n// checkout function\nfunction checkout($userId, $products) {\n    global $conn;\n    \n    // get order total\n    $orderTotal = 0;\n    foreach ($products as $product) {\n        $orderTotal += $product['price'] * $product['quantity'];\n    }\n    \n    // insert into orders table\n    $sql = \"INSERT INTO orders (user_id, total) VALUES ('$userId', '$orderTotal')\";\n    if ($conn->query($sql) === TRUE) {\n        \n        // update order items with new order id\n        foreach ($products as $product) {\n            $sql = \"UPDATE order_items SET order_id = LAST_INSERT_ID() WHERE product_id = '$product[id]'\";\n            if (!$conn->query($sql)) {\n                echo \"Error: \" . $sql . \"<br>\" . $conn->error;\n            }\n        }\n        \n        return true;\n    } else {\n        echo \"Error: \" . $sql . \"<br>\" . $conn->error;\n        return false;\n    }\n}\n\n// example usage\n$username = 'john';\n$email = 'john@example.com';\n$password = 'password123';\n\nregisterUser($username, $email, $password);\n\n$userId = loginUser($username, $password)['id'];\n\n$product1Id = 1; // product id from database\n$product2Id = 2; // product id from database\n\naddToCart($product1Id, $userId);\naddToCart($product2Id, $userId);\n\n$products = array(\n    array('id' => $product1Id, 'name' => 'Product 1', 'price' => 10.99),\n    array('id' => $product2Id, 'name' => 'Product 2', 'price' => 5.99)\n);\n\ncheckout($userId, $products);\n```\n\nThis code provides basic functions for user authentication and order management:\n\n*   `registerUser`: Registers a new user with the given username, email, and password.\n*   `loginUser`: Logs in an existing user with the given username and password.\n*   `addToCart`: Adds a product to the user's cart with the given product id and user id.\n*   `checkout`: Checks out the user's order and updates the order items with the new order id.\n\nNote that this is a simplified example and does not include error handling, security measures (e.g., password hashing), or other features you might want to include in your actual application.", "code_blocks": [null, "```php\n// database connection settings\n$dbHost = 'localhost';\n$dbUsername = 'root';\n$dbPassword = '';\n$dbName = 'store';\n\n// connect to the database\n$conn = new mysqli($dbHost, $dbUsername, $dbPassword, $dbName);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// register user function\nfunction registerUser($username, $email, $password) {\n    global $conn;\n    \n    // hash the password\n    $hashedPassword = password_hash($password, PASSWORD_DEFAULT);\n    \n    // insert into users table\n    $sql = \"INSERT INTO users (username, email, password) VALUES ('$username', '$email', '$hashedPassword')\";\n    if ($conn->query($sql) === TRUE) {\n        return true;\n    } else {\n        echo \"Error: \" . $sql . \"<br>\" . $conn->error;\n        return false;\n    }\n}\n\n// login function\nfunction loginUser($username, $password) {\n    global $conn;\n    \n    // get user from database\n    $sql = \"SELECT * FROM users WHERE username = '$username'\";\n    $result = $conn->query($sql);\n    \n    if ($result->num_rows > 0) {\n        while ($row = $result->fetch_assoc()) {\n            if (password_verify($password, $row['password'])) {\n                return $row;\n            }\n        }\n    }\n    \n    return null;\n}\n\n// add to cart function\nfunction addToCart($productId, $userId) {\n    global $conn;\n    \n    // check if product already exists in cart\n    $sql = \"SELECT * FROM order_items WHERE product_id = '$productId' AND user_id = '$userId'\";\n    $result = $conn->query($sql);\n    \n    if ($result->num_rows > 0) {\n        return false; // product already exists in cart\n    }\n    \n    // insert into order items table\n    $sql = \"INSERT INTO order_items (order_id, product_id, quantity) VALUES ('NULL', '$productId', '1')\";\n    if ($conn->query($sql) === TRUE) {\n        return true;\n    } else {\n        echo \"Error: \" . $sql . \"<br>\" . $conn->error;\n        return false;\n    }\n}\n\n// checkout function\nfunction checkout($userId, $products) {\n    global $conn;\n    \n    // get order total\n    $orderTotal = 0;\n    foreach ($products as $product) {\n        $orderTotal += $product['price'] * $product['quantity'];\n    }\n    \n    // insert into orders table\n    $sql = \"INSERT INTO orders (user_id, total) VALUES ('$userId', '$orderTotal')\";\n    if ($conn->query($sql) === TRUE) {\n        \n        // update order items with new order id\n        foreach ($products as $product) {\n            $sql = \"UPDATE order_items SET order_id = LAST_INSERT_ID() WHERE product_id = '$product[id]'\";\n            if (!$conn->query($sql)) {\n                echo \"Error: \" . $sql . \"<br>\" . $conn->error;\n            }\n        }\n        \n        return true;\n    } else {\n        echo \"Error: \" . $sql . \"<br>\" . $conn->error;\n        return false;\n    }\n}\n\n// example usage\n$username = 'john';\n$email = 'john@example.com';\n$password = 'password123';\n\nregisterUser($username, $email, $password);\n\n$userId = loginUser($username, $password)['id'];\n\n$product1Id = 1; // product id from database\n$product2Id = 2; // product id from database\n\naddToCart($product1Id, $userId);\naddToCart($product2Id, $userId);\n\n$products = array(\n    array('id' => $product1Id, 'name' => 'Product 1', 'price' => 10.99),\n    array('id' => $product2Id, 'name' => 'Product 2', 'price' => 5.99)\n);\n\ncheckout($userId, $products);\n```"]}
