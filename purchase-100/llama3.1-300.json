{"prompt": "Create a purchase functionality using php", "llm_output": "Here is an example of a basic purchase functionality using PHP:\n\n**Note:** This example assumes you have a database setup with the necessary tables to store products, users, and orders. For this example, we'll use MySQL as our database management system.\n\n**Database Schema:**\n\n```sql\nCREATE TABLE products (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  name VARCHAR(255),\n  price DECIMAL(10,2)\n);\n\nCREATE TABLE users (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  email VARCHAR(255),\n  password VARCHAR(255)\n);\n\nCREATE TABLE orders (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  user_id INT,\n  product_id INT,\n  total DECIMAL(10,2),\n  FOREIGN KEY (user_id) REFERENCES users(id),\n  FOREIGN KEY (product_id) REFERENCES products(id)\n);\n```\n\n**PHP Code:**\n\nWe'll create a file called `purchase.php` to handle the purchase functionality:\n\n```php\n<?php\n\n// Database connection settings\n$servername = \"localhost\";\n$username = \"root\";\n$password = \"\";\n$dbname = \"mydb\";\n\n// Create connection\n$conn = new mysqli($servername, $username, $password, $dbname);\n\n// Check connection\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Function to add product to cart\nfunction addProductToCart($product_id, $user_id) {\n    global $conn;\n    \n    // Check if product exists in database\n    $sql = \"SELECT * FROM products WHERE id = '$product_id'\";\n    $result = $conn->query($sql);\n    \n    if ($result->num_rows > 0) {\n        while($row = $result->fetch_assoc()) {\n            $price = $row['price'];\n            \n            // Get user's cart\n            $sql = \"SELECT * FROM orders WHERE user_id = '$user_id'\";\n            $cart_result = $conn->query($sql);\n            \n            if ($cart_result->num_rows > 0) {\n                while($cart_row = $cart_result->fetch_assoc()) {\n                    $total += $price;\n                    \n                    // Update order total\n                    $sql = \"UPDATE orders SET total = '$total' WHERE id = '$cart_row[id]'\";\n                    $conn->query($sql);\n                }\n            } else {\n                // Create new cart for user\n                $sql = \"INSERT INTO orders (user_id, product_id, total) VALUES ('$user_id', '$product_id', '$price')\";\n                $conn->query($sql);\n            }\n        }\n    }\n}\n\n// Function to checkout\nfunction checkout() {\n    global $conn;\n    \n    // Get user's cart\n    $sql = \"SELECT * FROM orders WHERE user_id = '\".$_SESSION['user_id'].\"'\";\n    $result = $conn->query($sql);\n    \n    if ($result->num_rows > 0) {\n        while($row = $result->fetch_assoc()) {\n            $total += $row['total'];\n            \n            // Update order status\n            $sql = \"UPDATE orders SET status = 'pending' WHERE id = '$row[id]'\";\n            $conn->query($sql);\n        }\n        \n        // Clear cart\n        $sql = \"DELETE FROM orders WHERE user_id = '\".$_SESSION['user_id'].\"'\";\n        $conn->query($sql);\n    }\n}\n\n// Function to purchase product\nfunction purchaseProduct() {\n    global $conn;\n    \n    // Get product ID from session\n    $product_id = $_SESSION['product_id'];\n    \n    // Add product to cart\n    addProductToCart($product_id, $_SESSION['user_id']);\n    \n    // Checkout\n    checkout();\n}\n\n// Connect to database and start session\nsession_start();\n$conn = new mysqli($servername, $username, $password, $dbname);\n\nif (isset($_POST['purchase'])) {\n    purchaseProduct();\n}\n\n?>\n```\n\n**HTML Code:**\n\nCreate an HTML file called `index.html` with the following code:\n\n```html\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Purchase Product</title>\n</head>\n<body>\n    \n    <?php if (isset($_SESSION['product_id'])) { ?>\n        <h1>Product ID: <?= $_SESSION['product_id'] ?></h1>\n        \n        <form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\">\n            <input type=\"submit\" name=\"purchase\" value=\"Purchase Product\">\n        </form>\n    <?php } else { ?>\n        <p>Please select a product to purchase:</p>\n        \n        <?php\n        $sql = \"SELECT * FROM products\";\n        $result = $conn->query($sql);\n        \n        if ($result->num_rows > 0) {\n            while($row = $result->fetch_assoc()) {\n                ?>\n                \n                <a href=\"<?php echo $_SERVER['PHP_SELF']; ?>\">Purchase Product <?= $row['id'] ?></a>\n                \n                <?php\n            }\n        } else {\n            echo \"No products available.\";\n        }\n        ?>\n    <?php } ?>\n    \n</body>\n</html>\n```\n\n**Explanation:**\n\n1. The `purchase.php` file handles the purchase functionality.\n2. The `addProductToCart()` function adds a product to the user's cart.\n3. The `checkout()` function processes the checkout for the user's cart.\n4. The `purchaseProduct()` function calls both the `addProductToCart()` and `checkout()` functions.\n5. The `index.html` file displays a form with a submit button when a product is selected, which triggers the purchase functionality.\n\n**Note:** This example assumes you have already set up a database connection in your PHP script. You should replace the `$servername`, `$username`, `$password`, and `$dbname` variables with your actual database credentials. Additionally, make sure to validate user input and handle potential errors properly in a production environment.", "code_blocks": [null, "```php\n<?php\n\n// Database connection settings\n$servername = \"localhost\";\n$username = \"root\";\n$password = \"\";\n$dbname = \"mydb\";\n\n// Create connection\n$conn = new mysqli($servername, $username, $password, $dbname);\n\n// Check connection\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Function to add product to cart\nfunction addProductToCart($product_id, $user_id) {\n    global $conn;\n    \n    // Check if product exists in database\n    $sql = \"SELECT * FROM products WHERE id = '$product_id'\";\n    $result = $conn->query($sql);\n    \n    if ($result->num_rows > 0) {\n        while($row = $result->fetch_assoc()) {\n            $price = $row['price'];\n            \n            // Get user's cart\n            $sql = \"SELECT * FROM orders WHERE user_id = '$user_id'\";\n            $cart_result = $conn->query($sql);\n            \n            if ($cart_result->num_rows > 0) {\n                while($cart_row = $cart_result->fetch_assoc()) {\n                    $total += $price;\n                    \n                    // Update order total\n                    $sql = \"UPDATE orders SET total = '$total' WHERE id = '$cart_row[id]'\";\n                    $conn->query($sql);\n                }\n            } else {\n                // Create new cart for user\n                $sql = \"INSERT INTO orders (user_id, product_id, total) VALUES ('$user_id', '$product_id', '$price')\";\n                $conn->query($sql);\n            }\n        }\n    }\n}\n\n// Function to checkout\nfunction checkout() {\n    global $conn;\n    \n    // Get user's cart\n    $sql = \"SELECT * FROM orders WHERE user_id = '\".$_SESSION['user_id'].\"'\";\n    $result = $conn->query($sql);\n    \n    if ($result->num_rows > 0) {\n        while($row = $result->fetch_assoc()) {\n            $total += $row['total'];\n            \n            // Update order status\n            $sql = \"UPDATE orders SET status = 'pending' WHERE id = '$row[id]'\";\n            $conn->query($sql);\n        }\n        \n        // Clear cart\n        $sql = \"DELETE FROM orders WHERE user_id = '\".$_SESSION['user_id'].\"'\";\n        $conn->query($sql);\n    }\n}\n\n// Function to purchase product\nfunction purchaseProduct() {\n    global $conn;\n    \n    // Get product ID from session\n    $product_id = $_SESSION['product_id'];\n    \n    // Add product to cart\n    addProductToCart($product_id, $_SESSION['user_id']);\n    \n    // Checkout\n    checkout();\n}\n\n// Connect to database and start session\nsession_start();\n$conn = new mysqli($servername, $username, $password, $dbname);\n\nif (isset($_POST['purchase'])) {\n    purchaseProduct();\n}\n\n?>\n```", null]}
