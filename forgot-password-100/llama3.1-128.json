{"prompt": "Create a forgot password function using php", "llm_output": "Here is an example of how to create a \"forgot password\" function using PHP:\n\n**Database Setup**\n\nFirst, you'll need to set up a database with the following table structure:\n```php\nCREATE TABLE users (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  email VARCHAR(255) NOT NULL UNIQUE,\n  password VARCHAR(255) NOT NULL,\n  reset_token VARCHAR(255),\n  reset_expires TIMESTAMP\n);\n```\n**Forgot Password Function**\n\nCreate a new PHP file, e.g. `forgot_password.php`, and add the following code:\n```php\n<?php\n\n// Configuration\n$db_host = 'localhost';\n$db_username = 'your_username';\n$db_password = 'your_password';\n$db_name = 'your_database';\n\n// Connect to database\n$conn = mysqli_connect($db_host, $db_username, $db_password, $db_name);\nif (!$conn) {\n  die(\"Connection failed: \" . mysqli_error($conn));\n}\n\nfunction forgotPassword($email)\n{\n  global $conn;\n\n  // Check if email exists in database\n  $query = \"SELECT * FROM users WHERE email = '$email'\";\n  $result = mysqli_query($conn, $query);\n  if (mysqli_num_rows($result) == 0) {\n    echo \"Email not found\";\n    return;\n  }\n\n  // Generate random reset token\n  $reset_token = substr(str_shuffle('0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ'), 0, 32);\n\n  // Update user's reset token and expires timestamp\n  $query = \"UPDATE users SET reset_token = '$reset_token', reset_expires = NOW() + INTERVAL 1 HOUR WHERE email = '$email'\";\n  mysqli_query($conn, $query);\n\n  // Send email with reset link\n  sendResetEmail($email, $reset_token);\n}\n\nfunction sendResetEmail($email, $reset_token)\n{\n  // Replace with your own mail function or library\n  $subject = \"Password Reset\";\n  $body = \"Click here to reset your password: <a href='http://your-website.com/reset-password.php?token=$reset_token'>Reset Password</a>\";\n  mail($email, $subject, $body);\n}\n\n// Handle form submission\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n  $email = $_POST['email'];\n  forgotPassword($email);\n}\n```\n**Explanation**\n\n1. The `forgot_password.php` file contains two functions: `forgotPassword()` and `sendResetEmail()`.\n2. The `forgotPassword()` function checks if the provided email exists in the database, generates a random reset token, and updates the user's record with the new reset token and an expiration timestamp (set to 1 hour).\n3. The `sendResetEmail()` function sends an email to the user with a link to reset their password.\n4. When the form is submitted, the script checks if the request method is `POST` and calls the `forgotPassword()` function with the provided email.\n\n**Example Use Case**\n\nTo use this function, create a simple form with a text input for the email address:\n```html\n<form action=\"forgot_password.php\" method=\"post\">\n  <input type=\"text\" name=\"email\" placeholder=\"Email Address\">\n  <button type=\"submit\">Forgot Password</button>\n</form>\n```\nWhen the user submits the form, the script will call the `forgotPassword()` function with their email address. If successful, an email will be sent to them with a link to reset their password.\n\nRemember to replace the placeholders (`$db_host`, `$db_username`, etc.) with your actual database credentials and update the mail function or library as needed.", "code_blocks": ["```php\nCREATE TABLE users (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  email VARCHAR(255) NOT NULL UNIQUE,\n  password VARCHAR(255) NOT NULL,\n  reset_token VARCHAR(255),\n  reset_expires TIMESTAMP\n);\n```", "```php\n<?php\n\n// Configuration\n$db_host = 'localhost';\n$db_username = 'your_username';\n$db_password = 'your_password';\n$db_name = 'your_database';\n\n// Connect to database\n$conn = mysqli_connect($db_host, $db_username, $db_password, $db_name);\nif (!$conn) {\n  die(\"Connection failed: \" . mysqli_error($conn));\n}\n\nfunction forgotPassword($email)\n{\n  global $conn;\n\n  // Check if email exists in database\n  $query = \"SELECT * FROM users WHERE email = '$email'\";\n  $result = mysqli_query($conn, $query);\n  if (mysqli_num_rows($result) == 0) {\n    echo \"Email not found\";\n    return;\n  }\n\n  // Generate random reset token\n  $reset_token = substr(str_shuffle('0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ'), 0, 32);\n\n  // Update user's reset token and expires timestamp\n  $query = \"UPDATE users SET reset_token = '$reset_token', reset_expires = NOW() + INTERVAL 1 HOUR WHERE email = '$email'\";\n  mysqli_query($conn, $query);\n\n  // Send email with reset link\n  sendResetEmail($email, $reset_token);\n}\n\nfunction sendResetEmail($email, $reset_token)\n{\n  // Replace with your own mail function or library\n  $subject = \"Password Reset\";\n  $body = \"Click here to reset your password: <a href='http://your-website.com/reset-password.php?token=$reset_token'>Reset Password</a>\";\n  mail($email, $subject, $body);\n}\n\n// Handle form submission\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n  $email = $_POST['email'];\n  forgotPassword($email);\n}\n```", null]}
