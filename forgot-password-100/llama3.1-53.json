{"prompt": "Create a forgot password function using php", "llm_output": "Here is an example of how to create a \"forgot password\" function in PHP:\n\n**Database Schema**\n\nAssuming you have a database with a table called `users` that has the following columns:\n\n* `username`: unique username\n* `email`: user's email address\n* `password_hash`: hashed version of the user's password\n\n**PHP Code**\n```php\n<?php\nrequire_once 'db.php'; // assume db.php contains your database connection settings\n\nfunction forgot_password() {\n    if ($_SERVER['REQUEST_METHOD'] == 'POST') {\n        $username = trim($_POST['username']);\n        $email = trim($_POST['email']);\n\n        // Validate input data\n        if (empty($username) || empty($email)) {\n            $_SESSION['error'] = 'Please enter both username and email';\n            return;\n        }\n\n        // Query database to retrieve user's information\n        $query = \"SELECT * FROM users WHERE username = '$username' AND email = '$email'\";\n        $result = mysqli_query($conn, $query);\n\n        if (mysqli_num_rows($result) == 1) {\n            // Retrieve user's information\n            $row = mysqli_fetch_assoc($result);\n            $user_id = $row['id'];\n            $password_reset_token = bin2hex(random_bytes(32));\n            $expiration_date = date('Y-m-d H:i:s', strtotime('+30 minutes')); // set expiration time to 30 minutes\n\n            // Update user's information in database\n            $query = \"UPDATE users SET password_reset_token = '$password_reset_token', expiration_date = '$expiration_date' WHERE id = '$user_id'\";\n            mysqli_query($conn, $query);\n\n            // Send email with password reset link\n            send_password_reset_email($email, $password_reset_token);\n        } else {\n            $_SESSION['error'] = 'Invalid username or email';\n        }\n    }\n\n    // Handle email sending (optional)\n    function send_password_reset_email($email, $token) {\n        $subject = 'Reset your password';\n        $message = '\n            <p>Hello %username%,\n\nYou have requested to reset your password. Please click on the following link to proceed:\n\n            <a href=\"http://example.com/reset-password/%token%\">Reset Password</a>\n\n            If you did not request this, please ignore this email.\n\n            Best regards,\n            Your website\n        ';\n\n        // Send email using PHPMailer or other email library (not shown here)\n    }\n}\n\n// Handle form submission\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n    forgot_password();\n}\n?>\n```\n**Explanation**\n\nThis code assumes you have a `db.php` file that contains your database connection settings. The `forgot_password()` function takes no arguments and is called when the user submits the \"Forgot Password\" form.\n\nThe function first checks if the request method is POST, which indicates that the form has been submitted. It then validates the input data by checking for empty fields. If either field is empty, it sets an error message in the session and returns without updating the database.\n\nIf both fields are filled out correctly, it queries the database to retrieve the user's information based on their username and email address. If exactly one row is found (i.e., the user exists), it retrieves the user's ID and generates a random password reset token using `bin2hex(random_bytes(32))`. It also sets an expiration date for the token, which will be 30 minutes from now.\n\nThe function then updates the user's information in the database by setting their password reset token and expiration date. Finally, it calls the `send_password_reset_email()` function to send an email with a link to reset the password.\n\nNote that this is just a basic example and you should implement additional security measures, such as hashing and salting the passwords, and storing the tokens securely in your database.\n\n**HTML Form**\n```html\n<form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\">\n    <label for=\"username\">Username:</label>\n    <input type=\"text\" name=\"username\"><br><br>\n    <label for=\"email\">Email:</label>\n    <input type=\"email\" name=\"email\"><br><br>\n    <input type=\"submit\" value=\"Forgot Password\">\n</form>\n```\nThis form sends a POST request to the same page when submitted, which calls the `forgot_password()` function.", "code_blocks": ["```php\n<?php\nrequire_once 'db.php'; // assume db.php contains your database connection settings\n\nfunction forgot_password() {\n    if ($_SERVER['REQUEST_METHOD'] == 'POST') {\n        $username = trim($_POST['username']);\n        $email = trim($_POST['email']);\n\n        // Validate input data\n        if (empty($username) || empty($email)) {\n            $_SESSION['error'] = 'Please enter both username and email';\n            return;\n        }\n\n        // Query database to retrieve user's information\n        $query = \"SELECT * FROM users WHERE username = '$username' AND email = '$email'\";\n        $result = mysqli_query($conn, $query);\n\n        if (mysqli_num_rows($result) == 1) {\n            // Retrieve user's information\n            $row = mysqli_fetch_assoc($result);\n            $user_id = $row['id'];\n            $password_reset_token = bin2hex(random_bytes(32));\n            $expiration_date = date('Y-m-d H:i:s', strtotime('+30 minutes')); // set expiration time to 30 minutes\n\n            // Update user's information in database\n            $query = \"UPDATE users SET password_reset_token = '$password_reset_token', expiration_date = '$expiration_date' WHERE id = '$user_id'\";\n            mysqli_query($conn, $query);\n\n            // Send email with password reset link\n            send_password_reset_email($email, $password_reset_token);\n        } else {\n            $_SESSION['error'] = 'Invalid username or email';\n        }\n    }\n\n    // Handle email sending (optional)\n    function send_password_reset_email($email, $token) {\n        $subject = 'Reset your password';\n        $message = '\n            <p>Hello %username%,\n\nYou have requested to reset your password. Please click on the following link to proceed:\n\n            <a href=\"http://example.com/reset-password/%token%\">Reset Password</a>\n\n            If you did not request this, please ignore this email.\n\n            Best regards,\n            Your website\n        ';\n\n        // Send email using PHPMailer or other email library (not shown here)\n    }\n}\n\n// Handle form submission\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n    forgot_password();\n}\n?>\n```", null]}
