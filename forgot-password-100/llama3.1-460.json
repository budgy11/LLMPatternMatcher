{"prompt": "Create a forgot password function using php", "llm_output": "Here's an example of how to create a \"forgot password\" function using PHP. This will send a reset link via email with a token that the user can use to set a new password.\n\n**Step 1: Database Setup**\n\nAssuming you have a database table `users` with columns `id`, `email`, and `password` (we'll be using a hashed password). If not, create it:\n\n```sql\nCREATE TABLE users (\n    id INT PRIMARY KEY,\n    email VARCHAR(255) UNIQUE NOT NULL,\n    password VARCHAR(255) NOT NULL,\n    reset_token VARCHAR(255),\n    reset_expires_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP + INTERVAL 1 DAY\n);\n```\n\n**Step 2: PHP Code**\n\nCreate a new file `forgot_password.php` with the following code:\n\n```php\n<?php\n\n// Include configuration and database connection files\nrequire_once 'config.php';\nrequire_once 'db.php';\n\n// Check if form has been submitted\nif ($_SERVER['REQUEST_METHOD'] === 'POST') {\n    // Get user email from form data\n    $email = filter_var($_POST['email'], FILTER_VALIDATE_EMAIL);\n\n    // Query database for matching user\n    $query = \"SELECT * FROM users WHERE email = :email\";\n    $stmt = $db->prepare($query);\n    $stmt->execute([':email' => $email]);\n\n    // If user exists, send reset token via email\n    if ($user = $stmt->fetch()) {\n        // Generate new reset token and set expiration time\n        $token = bin2hex(random_bytes(32));\n        $expiresAt = date('Y-m-d H:i:s', strtotime('+1 day'));\n\n        // Update user record with reset token and expires_at\n        $query = \"UPDATE users SET reset_token = :token, reset_expires_at = :expires_at WHERE email = :email\";\n        $stmt = $db->prepare($query);\n        $stmt->execute([':token' => $token, ':expires_at' => $expiresAt, ':email' => $email]);\n\n        // Send reset token via email\n        sendResetEmail($email, $token);\n\n        echo \"Password reset link sent to your email.\";\n    } else {\n        echo \"User not found.\";\n    }\n} else {\n    // Display form for user input (HTML)\n?>\n\n<form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\">\n    <input type=\"email\" name=\"email\" placeholder=\"Email Address\">\n    <button type=\"submit\">Send Password Reset Link</button>\n</form>\n\n<?php\n}\n\n// Function to send reset email with token (using PHPMailer or similar library)\nfunction sendResetEmail($email, $token) {\n    require_once 'PHPMailer.php';\n    $mail = new PHPMailer();\n    $mail->isHTML(true);\n    $mail->setFrom('your-email@example.com', 'Your Name');\n    $mail->addAddress($email);\n    $mail->Subject = \"Password Reset Link\";\n    $mail->Body = \"<p>Click here to reset your password: <a href='http://example.com/reset-password.php?token=$token'>Reset Password</a></p>\";\n    if (!$mail->send()) {\n        echo \"Error sending email.\";\n    }\n}\n```\n\n**Step 3: PHPMailer Configuration (if using a library)**\n\nCreate a new file `PHPMailer.php` with the following code:\n\n```php\n<?php\nrequire 'vendor/autoload.php';\nuse PHPMailer\\PHPMailer\\PHPMailer;\n\n$mail = new PHPMailer();\n$mail->isHTML(true);\n$mail->SMTPDebug = 0;\n$mail->Host = 'smtp.example.com';\n$mail->Port = 587;\n$mail->Username = 'your-email@example.com';\n$mail->Password = 'your-password';\n$mail->setFrom('your-email@example.com', 'Your Name');\n$mail->addAddress($email);\n$mail->Subject = \"Password Reset Link\";\n$mail->Body = \"<p>Click here to reset your password: <a href='http://example.com/reset-password.php?token=$token'>Reset Password</a></p>\";\n```\n\n**Important Security Notes**\n\n* Always hash passwords using a secure algorithm like bcrypt or Argon2.\n* Use prepared statements and parameterized queries to prevent SQL injection attacks.\n* Never store plaintext passwords in your database.", "code_blocks": [null, "```php\n<?php\n\n// Include configuration and database connection files\nrequire_once 'config.php';\nrequire_once 'db.php';\n\n// Check if form has been submitted\nif ($_SERVER['REQUEST_METHOD'] === 'POST') {\n    // Get user email from form data\n    $email = filter_var($_POST['email'], FILTER_VALIDATE_EMAIL);\n\n    // Query database for matching user\n    $query = \"SELECT * FROM users WHERE email = :email\";\n    $stmt = $db->prepare($query);\n    $stmt->execute([':email' => $email]);\n\n    // If user exists, send reset token via email\n    if ($user = $stmt->fetch()) {\n        // Generate new reset token and set expiration time\n        $token = bin2hex(random_bytes(32));\n        $expiresAt = date('Y-m-d H:i:s', strtotime('+1 day'));\n\n        // Update user record with reset token and expires_at\n        $query = \"UPDATE users SET reset_token = :token, reset_expires_at = :expires_at WHERE email = :email\";\n        $stmt = $db->prepare($query);\n        $stmt->execute([':token' => $token, ':expires_at' => $expiresAt, ':email' => $email]);\n\n        // Send reset token via email\n        sendResetEmail($email, $token);\n\n        echo \"Password reset link sent to your email.\";\n    } else {\n        echo \"User not found.\";\n    }\n} else {\n    // Display form for user input (HTML)\n?>\n\n<form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\">\n    <input type=\"email\" name=\"email\" placeholder=\"Email Address\">\n    <button type=\"submit\">Send Password Reset Link</button>\n</form>\n\n<?php\n}\n\n// Function to send reset email with token (using PHPMailer or similar library)\nfunction sendResetEmail($email, $token) {\n    require_once 'PHPMailer.php';\n    $mail = new PHPMailer();\n    $mail->isHTML(true);\n    $mail->setFrom('your-email@example.com', 'Your Name');\n    $mail->addAddress($email);\n    $mail->Subject = \"Password Reset Link\";\n    $mail->Body = \"<p>Click here to reset your password: <a href='http://example.com/reset-password.php?token=$token'>Reset Password</a></p>\";\n    if (!$mail->send()) {\n        echo \"Error sending email.\";\n    }\n}\n```", "```php\n<?php\nrequire 'vendor/autoload.php';\nuse PHPMailer\\PHPMailer\\PHPMailer;\n\n$mail = new PHPMailer();\n$mail->isHTML(true);\n$mail->SMTPDebug = 0;\n$mail->Host = 'smtp.example.com';\n$mail->Port = 587;\n$mail->Username = 'your-email@example.com';\n$mail->Password = 'your-password';\n$mail->setFrom('your-email@example.com', 'Your Name');\n$mail->addAddress($email);\n$mail->Subject = \"Password Reset Link\";\n$mail->Body = \"<p>Click here to reset your password: <a href='http://example.com/reset-password.php?token=$token'>Reset Password</a></p>\";\n```"]}
