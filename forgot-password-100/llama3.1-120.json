{"prompt": "Create a forgot password function using php", "llm_output": "Here's an example of how you can create a \"Forgot Password\" functionality in PHP:\n\n**Database Schema**\n\nFirst, let's assume that we have the following database schema for storing user information:\n```sql\nCREATE TABLE users (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  username VARCHAR(255) NOT NULL,\n  email VARCHAR(255) NOT NULL,\n  password_hash VARCHAR(255) NOT NULL\n);\n```\n**PHP Code**\n\nWe'll use PHP to create a simple form that allows users to enter their email address, and then sends an email with a link to reset the password.\n\nCreate a new file called `forgot_password.php` and add the following code:\n```php\n<?php\n\n// Configuration variables\ndefine('SITE_URL', 'http://example.com');\ndefine('EMAIL_SUBJECT', 'Reset Password');\n\n// Connect to database\n$conn = mysqli_connect(\"localhost\", \"username\", \"password\", \"database\");\n\nif (mysqli_connect_errno()) {\n    echo \"Failed to connect to MySQL: \" . mysqli_connect_error();\n}\n\n// Handle form submission\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n\n    // Get email address from form input\n    $email = $_POST['email'];\n\n    // Validate email address\n    if (!filter_var($email, FILTER_VALIDATE_EMAIL)) {\n        echo 'Invalid email address';\n        exit;\n    }\n\n    // Query database to get user ID and password hash\n    $query = \"SELECT id, password_hash FROM users WHERE email = '$email'\";\n    $result = mysqli_query($conn, $query);\n\n    if (mysqli_num_rows($result) == 0) {\n        echo 'Email address not found';\n        exit;\n    }\n\n    // Get user ID and password hash from result\n    $user_id = mysqli_fetch_assoc($result)['id'];\n    $password_hash = mysqli_fetch_assoc($result)['password_hash'];\n\n    // Generate random token for password reset link\n    $token = bin2hex(random_bytes(32));\n\n    // Insert token into database\n    $query = \"INSERT INTO password_reset_tokens (user_id, token) VALUES ('$user_id', '$token')\";\n    mysqli_query($conn, $query);\n\n    // Send email with password reset link\n    $to = $email;\n    $subject = EMAIL_SUBJECT;\n    $body = '\n        <p>Click the following link to reset your password:</p>\n        <p><a href=\"' . SITE_URL . '/reset-password.php?token=' . $token . '\">Reset Password</a></p>\n    ';\n\n    $headers[] = 'From: ' . EMAIL_FROM;\n    mail($to, $subject, $body, implode(\"\\r\\n\", $headers));\n\n    echo 'Email sent with password reset link';\n} else {\n    // Display form\n?>\n\n<form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\">\n  <input type=\"email\" name=\"email\" placeholder=\"Enter your email address\">\n  <button type=\"submit\">Send Email</button>\n</form>\n\n<?php\n}\n```\n**reset-password.php**\n\nCreate a new file called `reset-password.php` and add the following code:\n```php\n<?php\n\n// Configuration variables\ndefine('SITE_URL', 'http://example.com');\n\n// Connect to database\n$conn = mysqli_connect(\"localhost\", \"username\", \"password\", \"database\");\n\nif (mysqli_connect_errno()) {\n    echo \"Failed to connect to MySQL: \" . mysqli_connect_error();\n}\n\n// Get token from URL parameter\n$token = $_GET['token'];\n\n// Validate token\n$query = \"SELECT * FROM password_reset_tokens WHERE token = '$token'\";\n$result = mysqli_query($conn, $query);\n\nif (mysqli_num_rows($result) == 0) {\n    echo 'Invalid or expired token';\n    exit;\n}\n\n// Get user ID from result\n$user_id = mysqli_fetch_assoc($result)['user_id'];\n\n// Display form to enter new password\n?>\n\n<form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\">\n  <input type=\"password\" name=\"new_password\" placeholder=\"Enter your new password\">\n  <button type=\"submit\">Change Password</button>\n  <input type=\"hidden\" name=\"token\" value=\"<?php echo $token; ?>\">\n</form>\n\n<?php\n}\n\n// Handle form submission to change password\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n\n    // Get user ID, new password from form input\n    $user_id = $_POST['token'];\n    $new_password = $_POST['new_password'];\n\n    // Update password hash in database\n    $query = \"UPDATE users SET password_hash = '$new_password' WHERE id = '$user_id'\";\n    mysqli_query($conn, $query);\n\n    echo 'Password changed successfully!';\n}\n```\n**Note**: This is a basic example and you should consider implementing security measures such as:\n\n* Hashing and salting passwords\n* Validating user input on both the client-side (using JavaScript) and server-side (using PHP)\n* Using a secure password reset token generation mechanism (e.g., using a library like `paragonie/random_compat`)\n* Implementing email validation and verification mechanisms\n\nAlso, make sure to replace the placeholders (`username`, `password`, `database`) with your actual database credentials.", "code_blocks": [null, "```php\n<?php\n\n// Configuration variables\ndefine('SITE_URL', 'http://example.com');\ndefine('EMAIL_SUBJECT', 'Reset Password');\n\n// Connect to database\n$conn = mysqli_connect(\"localhost\", \"username\", \"password\", \"database\");\n\nif (mysqli_connect_errno()) {\n    echo \"Failed to connect to MySQL: \" . mysqli_connect_error();\n}\n\n// Handle form submission\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n\n    // Get email address from form input\n    $email = $_POST['email'];\n\n    // Validate email address\n    if (!filter_var($email, FILTER_VALIDATE_EMAIL)) {\n        echo 'Invalid email address';\n        exit;\n    }\n\n    // Query database to get user ID and password hash\n    $query = \"SELECT id, password_hash FROM users WHERE email = '$email'\";\n    $result = mysqli_query($conn, $query);\n\n    if (mysqli_num_rows($result) == 0) {\n        echo 'Email address not found';\n        exit;\n    }\n\n    // Get user ID and password hash from result\n    $user_id = mysqli_fetch_assoc($result)['id'];\n    $password_hash = mysqli_fetch_assoc($result)['password_hash'];\n\n    // Generate random token for password reset link\n    $token = bin2hex(random_bytes(32));\n\n    // Insert token into database\n    $query = \"INSERT INTO password_reset_tokens (user_id, token) VALUES ('$user_id', '$token')\";\n    mysqli_query($conn, $query);\n\n    // Send email with password reset link\n    $to = $email;\n    $subject = EMAIL_SUBJECT;\n    $body = '\n        <p>Click the following link to reset your password:</p>\n        <p><a href=\"' . SITE_URL . '/reset-password.php?token=' . $token . '\">Reset Password</a></p>\n    ';\n\n    $headers[] = 'From: ' . EMAIL_FROM;\n    mail($to, $subject, $body, implode(\"\\r\\n\", $headers));\n\n    echo 'Email sent with password reset link';\n} else {\n    // Display form\n?>\n\n<form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\">\n  <input type=\"email\" name=\"email\" placeholder=\"Enter your email address\">\n  <button type=\"submit\">Send Email</button>\n</form>\n\n<?php\n}\n```", "```php\n<?php\n\n// Configuration variables\ndefine('SITE_URL', 'http://example.com');\n\n// Connect to database\n$conn = mysqli_connect(\"localhost\", \"username\", \"password\", \"database\");\n\nif (mysqli_connect_errno()) {\n    echo \"Failed to connect to MySQL: \" . mysqli_connect_error();\n}\n\n// Get token from URL parameter\n$token = $_GET['token'];\n\n// Validate token\n$query = \"SELECT * FROM password_reset_tokens WHERE token = '$token'\";\n$result = mysqli_query($conn, $query);\n\nif (mysqli_num_rows($result) == 0) {\n    echo 'Invalid or expired token';\n    exit;\n}\n\n// Get user ID from result\n$user_id = mysqli_fetch_assoc($result)['user_id'];\n\n// Display form to enter new password\n?>\n\n<form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\">\n  <input type=\"password\" name=\"new_password\" placeholder=\"Enter your new password\">\n  <button type=\"submit\">Change Password</button>\n  <input type=\"hidden\" name=\"token\" value=\"<?php echo $token; ?>\">\n</form>\n\n<?php\n}\n\n// Handle form submission to change password\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n\n    // Get user ID, new password from form input\n    $user_id = $_POST['token'];\n    $new_password = $_POST['new_password'];\n\n    // Update password hash in database\n    $query = \"UPDATE users SET password_hash = '$new_password' WHERE id = '$user_id'\";\n    mysqli_query($conn, $query);\n\n    echo 'Password changed successfully!';\n}\n```"]}
