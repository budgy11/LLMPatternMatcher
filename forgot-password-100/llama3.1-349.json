{"prompt": "Create a forgot password function using php", "llm_output": "Here is an example of how you can create a \"Forgot Password\" function using PHP:\n\n**Database Structure**\n\nAssuming you have a table named `users` with the following structure:\n```php\nCREATE TABLE users (\n  id INT PRIMARY KEY,\n  email VARCHAR(255) NOT NULL,\n  password_hash VARCHAR(255) NOT NULL\n);\n```\n**PHP Code**\n\nCreate a new file called `forgot_password.php` and add the following code:\n```php\n<?php\n\n// Configuration\ndefine('MAX_ATTEMPTS', 5);\n\n// Function to send reset email\nfunction sendResetEmail($email, $token)\n{\n  // Send email with token\n  $subject = 'Reset Password';\n  $body = \"Click this link to reset your password: <a href='http://yourwebsite.com/reset_password.php?token=$token'>Reset Password</a>\";\n  mail($email, $subject, $body);\n}\n\n// Function to handle forgot password form submission\nfunction handleForgotPasswordForm()\n{\n  // Get form data\n  $email = $_POST['email'];\n\n  // Check if email exists in database\n  $query = \"SELECT * FROM users WHERE email = :email\";\n  try {\n    $stmt = $pdo->prepare($query);\n    $stmt->bindParam(':email', $email);\n    $stmt->execute();\n    $user = $stmt->fetch();\n\n    // If user exists, generate reset token and send email\n    if ($user) {\n      $token = bin2hex(random_bytes(32));\n      $query = \"UPDATE users SET password_reset_token = :token WHERE id = :id\";\n      try {\n        $stmt = $pdo->prepare($query);\n        $stmt->bindParam(':token', $token);\n        $stmt->bindParam(':id', $user['id']);\n        $stmt->execute();\n        sendResetEmail($email, $token);\n        echo \"An email has been sent to your email address with a link to reset your password.\";\n      } catch (PDOException $e) {\n        echo \"Error updating user data: \" . $e->getMessage();\n      }\n    } else {\n      echo \"User not found\";\n    }\n  } catch (PDOException $e) {\n    echo \"Error querying database: \" . $e->getMessage();\n  }\n}\n\n// Check if form has been submitted\nif ($_SERVER['REQUEST_METHOD'] === 'POST') {\n  handleForgotPasswordForm();\n} else {\n  // Display forgot password form\n  ?>\n  <form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\">\n    <input type=\"email\" name=\"email\" placeholder=\"Enter your email address\">\n    <button type=\"submit\">Send Reset Email</button>\n  </form>\n  <?php\n}\n?>\n```\n**How it Works**\n\n1. The user submits the forgot password form with their email address.\n2. The `handleForgotPasswordForm()` function is called, which checks if the email exists in the database.\n3. If the email exists, a reset token is generated and stored in the user's record in the database.\n4. An email is sent to the user's email address with a link to reset their password (e.g., `http://yourwebsite.com/reset_password.php?token=$token`).\n5. The user clicks on the link and is taken to the reset password page, where they can enter a new password.\n\n**Note**: This code assumes you have a PDO connection established in your PHP script using the `$pdo` variable. You will need to replace `yourwebsite.com` with your actual website's domain name.\n\nI hope this helps! Let me know if you have any questions or need further assistance.", "code_blocks": ["```php\nCREATE TABLE users (\n  id INT PRIMARY KEY,\n  email VARCHAR(255) NOT NULL,\n  password_hash VARCHAR(255) NOT NULL\n);\n```", "```php\n<?php\n\n// Configuration\ndefine('MAX_ATTEMPTS', 5);\n\n// Function to send reset email\nfunction sendResetEmail($email, $token)\n{\n  // Send email with token\n  $subject = 'Reset Password';\n  $body = \"Click this link to reset your password: <a href='http://yourwebsite.com/reset_password.php?token=$token'>Reset Password</a>\";\n  mail($email, $subject, $body);\n}\n\n// Function to handle forgot password form submission\nfunction handleForgotPasswordForm()\n{\n  // Get form data\n  $email = $_POST['email'];\n\n  // Check if email exists in database\n  $query = \"SELECT * FROM users WHERE email = :email\";\n  try {\n    $stmt = $pdo->prepare($query);\n    $stmt->bindParam(':email', $email);\n    $stmt->execute();\n    $user = $stmt->fetch();\n\n    // If user exists, generate reset token and send email\n    if ($user) {\n      $token = bin2hex(random_bytes(32));\n      $query = \"UPDATE users SET password_reset_token = :token WHERE id = :id\";\n      try {\n        $stmt = $pdo->prepare($query);\n        $stmt->bindParam(':token', $token);\n        $stmt->bindParam(':id', $user['id']);\n        $stmt->execute();\n        sendResetEmail($email, $token);\n        echo \"An email has been sent to your email address with a link to reset your password.\";\n      } catch (PDOException $e) {\n        echo \"Error updating user data: \" . $e->getMessage();\n      }\n    } else {\n      echo \"User not found\";\n    }\n  } catch (PDOException $e) {\n    echo \"Error querying database: \" . $e->getMessage();\n  }\n}\n\n// Check if form has been submitted\nif ($_SERVER['REQUEST_METHOD'] === 'POST') {\n  handleForgotPasswordForm();\n} else {\n  // Display forgot password form\n  ?>\n  <form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\">\n    <input type=\"email\" name=\"email\" placeholder=\"Enter your email address\">\n    <button type=\"submit\">Send Reset Email</button>\n  </form>\n  <?php\n}\n?>\n```"]}
