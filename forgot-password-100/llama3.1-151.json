{"prompt": "Create a forgot password function using php", "llm_output": "Here's an example of how you can create a forgot password function in PHP. This example uses a simple email-based system, where the user enters their username or email address and receives a reset link via email.\n\n**Step 1: Create a database table for users**\n\n```sql\nCREATE TABLE users (\n    id INT PRIMARY KEY AUTO_INCREMENT,\n    username VARCHAR(255) NOT NULL,\n    password_hash CHAR(60) NOT NULL,\n    email VARCHAR(255) UNIQUE NOT NULL\n);\n```\n\n**Step 2: PHP script to handle forgot password request**\n\nCreate a new PHP file called `forgot_password.php`. This script will send an email with a reset link to the user.\n\n```php\n<?php\n\n// Configuration settings\n$site_url = \"http://example.com\"; // Your website URL\n\n// Check if form has been submitted\nif (isset($_POST['submit'])) {\n    $email = $_POST['email'];\n\n    // Connect to database\n    require_once 'db_connect.php';\n    $conn = connect_to_db();\n\n    // Query user data from database\n    $query = \"SELECT * FROM users WHERE email='$email'\";\n    $result = mysqli_query($conn, $query);\n\n    if (mysqli_num_rows($result) > 0) {\n        // Get user data\n        $user_data = mysqli_fetch_assoc($result);\n\n        // Generate random token for password reset\n        $token = bin2hex(random_bytes(16));\n\n        // Update database with new token\n        $update_query = \"UPDATE users SET reset_token='$token' WHERE email='$email'\";\n        mysqli_query($conn, $update_query);\n\n        // Send email to user\n        send_reset_email($user_data['username'], $user_data['email'], $site_url, $token);\n    } else {\n        echo \"Email not found.\";\n    }\n\n    // Close database connection\n    mysqli_close($conn);\n} else {\n    // Display forgot password form\n    ?>\n    <form action=\"\" method=\"post\">\n        Email: <input type=\"text\" name=\"email\"><br>\n        <button type=\"submit\" name=\"submit\">Send Reset Link</button>\n    </form>\n    <?php\n}\n\nfunction send_reset_email($username, $email, $site_url, $token) {\n    // Set email headers\n    $subject = \"Reset Password\";\n    $headers = \"From: no-reply@example.com\\r\\nContent-Type: text/html;\\r\\ncharset=UTF-8\";\n\n    // Set email body\n    $body = \"\n    <p>Hello $username,</p>\n    <p>Click the following link to reset your password:</p>\n    <a href='$site_url/reset_password.php?email=$email&token=$token'>Reset Password</a>\n    \";\n\n    // Send email using mail() function\n    mail($email, $subject, $body, $headers);\n}\n\n?>\n```\n\n**Step 3: PHP script to handle password reset**\n\nCreate a new PHP file called `reset_password.php`. This script will update the user's password in the database.\n\n```php\n<?php\n\n// Configuration settings\n$site_url = \"http://example.com\"; // Your website URL\n\n// Check if form has been submitted\nif (isset($_POST['submit'])) {\n    $email = $_POST['email'];\n    $token = $_POST['token'];\n    $password = $_POST['password'];\n\n    // Connect to database\n    require_once 'db_connect.php';\n    $conn = connect_to_db();\n\n    // Check if token is valid\n    $query = \"SELECT * FROM users WHERE email='$email' AND reset_token='$token'\";\n    $result = mysqli_query($conn, $query);\n\n    if (mysqli_num_rows($result) > 0) {\n        // Update user's password in database\n        $update_query = \"UPDATE users SET password_hash=password('$password') WHERE email='$email'\";\n        mysqli_query($conn, $update_query);\n    } else {\n        echo \"Invalid token.\";\n    }\n\n    // Close database connection\n    mysqli_close($conn);\n\n    // Redirect to login page\n    header('Location: login.php');\n} else {\n    // Display password reset form\n    ?>\n    <form action=\"\" method=\"post\">\n        Email: <input type=\"text\" name=\"email\" readonly value=\"<?php echo $_GET['email']; ?>\"><br>\n        Token: <input type=\"hidden\" name=\"token\" value=\"<?php echo $_GET['token']; ?>\">\n        New Password: <input type=\"password\" name=\"password\"><br>\n        Confirm Password: <input type=\"password\" name=\"confirm_password\"><br>\n        <button type=\"submit\" name=\"submit\">Reset Password</button>\n    </form>\n    <?php\n}\n?>\n```\n\n**Security Note:** This is a basic example and should not be used as-is in production. You should use a secure password hashing library like `password_hash()` to store passwords securely, and also implement additional security measures such as token validation using a secret key.", "code_blocks": [null, "```php\n<?php\n\n// Configuration settings\n$site_url = \"http://example.com\"; // Your website URL\n\n// Check if form has been submitted\nif (isset($_POST['submit'])) {\n    $email = $_POST['email'];\n\n    // Connect to database\n    require_once 'db_connect.php';\n    $conn = connect_to_db();\n\n    // Query user data from database\n    $query = \"SELECT * FROM users WHERE email='$email'\";\n    $result = mysqli_query($conn, $query);\n\n    if (mysqli_num_rows($result) > 0) {\n        // Get user data\n        $user_data = mysqli_fetch_assoc($result);\n\n        // Generate random token for password reset\n        $token = bin2hex(random_bytes(16));\n\n        // Update database with new token\n        $update_query = \"UPDATE users SET reset_token='$token' WHERE email='$email'\";\n        mysqli_query($conn, $update_query);\n\n        // Send email to user\n        send_reset_email($user_data['username'], $user_data['email'], $site_url, $token);\n    } else {\n        echo \"Email not found.\";\n    }\n\n    // Close database connection\n    mysqli_close($conn);\n} else {\n    // Display forgot password form\n    ?>\n    <form action=\"\" method=\"post\">\n        Email: <input type=\"text\" name=\"email\"><br>\n        <button type=\"submit\" name=\"submit\">Send Reset Link</button>\n    </form>\n    <?php\n}\n\nfunction send_reset_email($username, $email, $site_url, $token) {\n    // Set email headers\n    $subject = \"Reset Password\";\n    $headers = \"From: no-reply@example.com\\r\\nContent-Type: text/html;\\r\\ncharset=UTF-8\";\n\n    // Set email body\n    $body = \"\n    <p>Hello $username,</p>\n    <p>Click the following link to reset your password:</p>\n    <a href='$site_url/reset_password.php?email=$email&token=$token'>Reset Password</a>\n    \";\n\n    // Send email using mail() function\n    mail($email, $subject, $body, $headers);\n}\n\n?>\n```", "```php\n<?php\n\n// Configuration settings\n$site_url = \"http://example.com\"; // Your website URL\n\n// Check if form has been submitted\nif (isset($_POST['submit'])) {\n    $email = $_POST['email'];\n    $token = $_POST['token'];\n    $password = $_POST['password'];\n\n    // Connect to database\n    require_once 'db_connect.php';\n    $conn = connect_to_db();\n\n    // Check if token is valid\n    $query = \"SELECT * FROM users WHERE email='$email' AND reset_token='$token'\";\n    $result = mysqli_query($conn, $query);\n\n    if (mysqli_num_rows($result) > 0) {\n        // Update user's password in database\n        $update_query = \"UPDATE users SET password_hash=password('$password') WHERE email='$email'\";\n        mysqli_query($conn, $update_query);\n    } else {\n        echo \"Invalid token.\";\n    }\n\n    // Close database connection\n    mysqli_close($conn);\n\n    // Redirect to login page\n    header('Location: login.php');\n} else {\n    // Display password reset form\n    ?>\n    <form action=\"\" method=\"post\">\n        Email: <input type=\"text\" name=\"email\" readonly value=\"<?php echo $_GET['email']; ?>\"><br>\n        Token: <input type=\"hidden\" name=\"token\" value=\"<?php echo $_GET['token']; ?>\">\n        New Password: <input type=\"password\" name=\"password\"><br>\n        Confirm Password: <input type=\"password\" name=\"confirm_password\"><br>\n        <button type=\"submit\" name=\"submit\">Reset Password</button>\n    </form>\n    <?php\n}\n?>\n```"]}
