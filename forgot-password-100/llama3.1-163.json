{"prompt": "Create a forgot password function using php", "llm_output": "Here is an example of a basic \"forgot password\" function using PHP:\n\n**Database Schema:**\n\nAssuming you have a database table called `users` with the following columns:\n```sql\nCREATE TABLE users (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  email VARCHAR(255) NOT NULL UNIQUE,\n  password_hash VARCHAR(255) NOT NULL\n);\n```\n**PHP Code:**\n```php\n<?php\n\n// Configuration\n$db_host = 'localhost';\n$db_username = 'your_username';\n$db_password = 'your_password';\n$db_name = 'your_database';\n\n// Connect to database\n$conn = new mysqli($db_host, $db_username, $db_password, $db_name);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\nfunction forgotPassword() {\n  // Get user input (email)\n  if (!isset($_POST['email'])) {\n      header('Location: index.php');\n      exit;\n  }\n  $email = $_POST['email'];\n\n  // Query database for user\n  $query = \"SELECT * FROM users WHERE email = '$email'\";\n  $result = $conn->query($query);\n\n  if ($result->num_rows > 0) {\n    // Get user data from result\n    $user_data = $result->fetch_assoc();\n\n    // Generate new password\n    $new_password = bin2hex(random_bytes(16));\n    echo \"New Password: $new_password\";\n\n    // Update database with new password ( encrypted using password_hash )\n    $hashed_new_password = password_hash($new_password, PASSWORD_DEFAULT);\n    $query = \"UPDATE users SET password_hash = '$hashed_new_password' WHERE id = '\".$user_data['id'].\"'\";\n    $result = $conn->query($query);\n\n    if ($result) {\n      // Send email with new password\n      sendEmail($email, $new_password);\n      echo 'Password updated successfully!';\n    } else {\n      echo 'Error updating password: ' . mysqli_error($conn);\n    }\n  } else {\n    echo \"User not found.\";\n  }\n\n  $conn->close();\n}\n\nfunction sendEmail($to_email, $password) {\n  // Email configuration\n  $email_to = $to_email;\n  $email_from = 'your_email@example.com';\n  $email_password = 'your_email_password';\n\n  // Email headers and body\n  $subject = \"New Password for Your Account\";\n  $body = \"Your new password is: $password\";\n\n  // Send email using SMTP\n  require_once 'PHPMailer/PHPMailerAutoload.php';\n  $mail = new PHPMailer();\n  $mail->isSMTP();\n  $mail->Host = 'smtp.example.com';\n  $mail->Port = 587;\n  $mail->SMTPAuth = true;\n  $mail->Username = $email_from;\n  $mail->Password = $email_password;\n  $mail->setFrom($email_from, 'Your Name');\n  $mail->addAddress($to_email);\n  $mail->Subject = $subject;\n  $mail->Body = $body;\n\n  if (!$mail->send()) {\n    echo \"Error sending email: \" . $mail->ErrorInfo;\n  } else {\n    echo \"Email sent successfully!\";\n  }\n}\n\n// Handle forgot password form submission\nif (isset($_POST['forgot_password'])) {\n  forgotPassword();\n} else {\n  // Display forgot password form\n  ?>\n  <form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\">\n    Email: <input type=\"text\" name=\"email\"><br><br>\n    <input type=\"submit\" name=\"forgot_password\" value=\"Reset Password\">\n  </form>\n<?php }\n\n?>\n```\n**How it works:**\n\n1. The user submits the forgot password form with their email address.\n2. The script checks if a user exists in the database with the provided email address.\n3. If a user is found, a new password is generated and stored in the database ( encrypted using `password_hash` ).\n4. An email is sent to the user with the new password.\n\nNote that this is a basic example, and you should consider implementing additional security measures such as:\n\n* Using a secure connection for email sending\n* Implementing rate limiting for password reset requests\n* Storing salted and hashed passwords in the database\n\nAlso, make sure to update the configuration values (e.g. database credentials) with your own values.\n\n**Example Use Case:**\n\n1. The user visits the forgot password page.\n2. They enter their email address and submit the form.\n3. The script checks if a user exists with the provided email address.\n4. If a user is found, a new password is generated and stored in the database ( encrypted using `password_hash` ).\n5. An email is sent to the user with the new password.\n\nNote that this example assumes you have a basic understanding of PHP and database concepts.", "code_blocks": [null, "```php\n<?php\n\n// Configuration\n$db_host = 'localhost';\n$db_username = 'your_username';\n$db_password = 'your_password';\n$db_name = 'your_database';\n\n// Connect to database\n$conn = new mysqli($db_host, $db_username, $db_password, $db_name);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\nfunction forgotPassword() {\n  // Get user input (email)\n  if (!isset($_POST['email'])) {\n      header('Location: index.php');\n      exit;\n  }\n  $email = $_POST['email'];\n\n  // Query database for user\n  $query = \"SELECT * FROM users WHERE email = '$email'\";\n  $result = $conn->query($query);\n\n  if ($result->num_rows > 0) {\n    // Get user data from result\n    $user_data = $result->fetch_assoc();\n\n    // Generate new password\n    $new_password = bin2hex(random_bytes(16));\n    echo \"New Password: $new_password\";\n\n    // Update database with new password ( encrypted using password_hash )\n    $hashed_new_password = password_hash($new_password, PASSWORD_DEFAULT);\n    $query = \"UPDATE users SET password_hash = '$hashed_new_password' WHERE id = '\".$user_data['id'].\"'\";\n    $result = $conn->query($query);\n\n    if ($result) {\n      // Send email with new password\n      sendEmail($email, $new_password);\n      echo 'Password updated successfully!';\n    } else {\n      echo 'Error updating password: ' . mysqli_error($conn);\n    }\n  } else {\n    echo \"User not found.\";\n  }\n\n  $conn->close();\n}\n\nfunction sendEmail($to_email, $password) {\n  // Email configuration\n  $email_to = $to_email;\n  $email_from = 'your_email@example.com';\n  $email_password = 'your_email_password';\n\n  // Email headers and body\n  $subject = \"New Password for Your Account\";\n  $body = \"Your new password is: $password\";\n\n  // Send email using SMTP\n  require_once 'PHPMailer/PHPMailerAutoload.php';\n  $mail = new PHPMailer();\n  $mail->isSMTP();\n  $mail->Host = 'smtp.example.com';\n  $mail->Port = 587;\n  $mail->SMTPAuth = true;\n  $mail->Username = $email_from;\n  $mail->Password = $email_password;\n  $mail->setFrom($email_from, 'Your Name');\n  $mail->addAddress($to_email);\n  $mail->Subject = $subject;\n  $mail->Body = $body;\n\n  if (!$mail->send()) {\n    echo \"Error sending email: \" . $mail->ErrorInfo;\n  } else {\n    echo \"Email sent successfully!\";\n  }\n}\n\n// Handle forgot password form submission\nif (isset($_POST['forgot_password'])) {\n  forgotPassword();\n} else {\n  // Display forgot password form\n  ?>\n  <form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\">\n    Email: <input type=\"text\" name=\"email\"><br><br>\n    <input type=\"submit\" name=\"forgot_password\" value=\"Reset Password\">\n  </form>\n<?php }\n\n?>\n```"]}
