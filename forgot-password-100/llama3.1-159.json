{"prompt": "Create a forgot password function using php", "llm_output": "Here is an example of how to create a \"forgot password\" function using PHP:\n\n**Assumptions:**\n\n* You have a MySQL database set up with a table named `users` that contains the following columns:\n\t+ `id` (primary key, auto-incrementing integer)\n\t+ `email` (unique string representing the user's email address)\n\t+ `password_hash` (string containing the hashed password for the user)\n* You have PHP installed on your server and have access to a database connection.\n* You are using a PHP framework or library that supports password hashing (such as `password_hash()`).\n\n**Database Schema:**\n```sql\nCREATE TABLE users (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  email VARCHAR(255) UNIQUE NOT NULL,\n  password_hash VARCHAR(255) NOT NULL\n);\n```\n**PHP Code:**\n\nCreate a new PHP file named `forgot_password.php` and add the following code:\n```php\n<?php\n\n// Configuration settings\n$database_host = 'localhost';\n$database_username = 'your_database_username';\n$database_password = 'your_database_password';\n$database_name = 'your_database_name';\n\n// Connect to database\n$conn = new mysqli($database_host, $database_username, $database_password, $database_name);\n\n// Check if connection was successful\nif ($conn->connect_error) {\n  die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Function to check user exists and send password reset link\nfunction forgot_password($email) {\n  // SQL query to retrieve user data (check if user exists)\n  $sql = \"SELECT * FROM users WHERE email = '$email'\";\n  $result = $conn->query($sql);\n\n  // Check if user exists\n  if ($result->num_rows == 0) {\n    return false;\n  }\n\n  // Retrieve user ID and password hash from database\n  $row = $result->fetch_assoc();\n  $user_id = $row['id'];\n  $password_hash = $row['password_hash'];\n\n  // Generate random token for password reset link\n  $token = bin2hex(random_bytes(32));\n\n  // Update user's password hash in database with token\n  $sql = \"UPDATE users SET password_hash = '$token' WHERE id = '$user_id'\";\n  $conn->query($sql);\n\n  // Send email to user with password reset link\n  send_password_reset_email($email, $token);\n}\n\n// Function to send password reset email\nfunction send_password_reset_email($email, $token) {\n  // Your email sending code here (e.g. using PHPMailer or SwiftMailer)\n  echo \"Email sent to $email with token: $token\";\n}\n\n// Process form data and call forgot_password function\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n  $email = $_POST['email'];\n  $forgot_password($email);\n} else {\n  // Display form if it's not a POST request\n  echo '<form action=\"\" method=\"post\">';\n  echo '<label for=\"email\">Email:</label>';\n  echo '<input type=\"text\" id=\"email\" name=\"email\"><br><br>';\n  echo '<button type=\"submit\">Send Reset Link</button>';\n  echo '</form>';\n}\n```\n**Explanation:**\n\n1. The code connects to the database using `mysqli`.\n2. The `forgot_password` function takes an email address as input, checks if a user with that email exists in the database, and generates a random token for password reset.\n3. If the user exists, the function updates their password hash in the database with the new token.\n4. The `send_password_reset_email` function sends an email to the user with the password reset link (token).\n5. When the form is submitted (via POST request), the code calls the `forgot_password` function with the input email address.\n\nNote: This example uses a simple `mysqli` connection, but you should consider using prepared statements and parameterized queries for security reasons.\n\n**Example Usage:**\n\n1. Create a new PHP file named `login.php` to display the login form.\n2. Include the `forgot_password.php` file in your login script.\n3. When the user clicks \"Forgot Password\" on the login page, the code will send them an email with a password reset link (token).\n\nThis is just a basic example to get you started. You should consider implementing additional security measures, such as password policy enforcement and secure password hashing.\n\nPlease let me know if you have any questions or need further assistance!", "code_blocks": [null, "```php\n<?php\n\n// Configuration settings\n$database_host = 'localhost';\n$database_username = 'your_database_username';\n$database_password = 'your_database_password';\n$database_name = 'your_database_name';\n\n// Connect to database\n$conn = new mysqli($database_host, $database_username, $database_password, $database_name);\n\n// Check if connection was successful\nif ($conn->connect_error) {\n  die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Function to check user exists and send password reset link\nfunction forgot_password($email) {\n  // SQL query to retrieve user data (check if user exists)\n  $sql = \"SELECT * FROM users WHERE email = '$email'\";\n  $result = $conn->query($sql);\n\n  // Check if user exists\n  if ($result->num_rows == 0) {\n    return false;\n  }\n\n  // Retrieve user ID and password hash from database\n  $row = $result->fetch_assoc();\n  $user_id = $row['id'];\n  $password_hash = $row['password_hash'];\n\n  // Generate random token for password reset link\n  $token = bin2hex(random_bytes(32));\n\n  // Update user's password hash in database with token\n  $sql = \"UPDATE users SET password_hash = '$token' WHERE id = '$user_id'\";\n  $conn->query($sql);\n\n  // Send email to user with password reset link\n  send_password_reset_email($email, $token);\n}\n\n// Function to send password reset email\nfunction send_password_reset_email($email, $token) {\n  // Your email sending code here (e.g. using PHPMailer or SwiftMailer)\n  echo \"Email sent to $email with token: $token\";\n}\n\n// Process form data and call forgot_password function\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n  $email = $_POST['email'];\n  $forgot_password($email);\n} else {\n  // Display form if it's not a POST request\n  echo '<form action=\"\" method=\"post\">';\n  echo '<label for=\"email\">Email:</label>';\n  echo '<input type=\"text\" id=\"email\" name=\"email\"><br><br>';\n  echo '<button type=\"submit\">Send Reset Link</button>';\n  echo '</form>';\n}\n```"]}
