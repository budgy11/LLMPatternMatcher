{"prompt": "Create a forgot password function using php", "llm_output": "Here's an example of how you can create a \"forgot password\" function in PHP:\n\n**Forgot Password Function:**\n\nThis script will send an email to the user with a link that leads them to a page where they can reset their password.\n\n```php\n<?php\nrequire_once 'dbconnect.php'; // database connection file\n\nif (isset($_POST['forgot_password'])) {\n    $email = $_POST['email'];\n\n    // Check if the email is valid and exists in the database\n    $query = \"SELECT * FROM users WHERE email = '$email'\";\n    $result = mysqli_query($conn, $query);\n\n    if (mysqli_num_rows($result) > 0) {\n        // Generate a random token for password reset\n        $token = bin2hex(random_bytes(32));\n\n        // Update the user's record with the new token\n        $update_query = \"UPDATE users SET token = '$token' WHERE email = '$email'\";\n        mysqli_query($conn, $update_query);\n\n        // Send an email to the user with a link to reset their password\n        $subject = 'Reset Your Password';\n        $message = \"\n            <html>\n                <body>\n                    <p>Click on this link to reset your password:</p>\n                    <a href='http://example.com/reset_password.php?token=$token'>Reset Password</a>\n                </body>\n            </html>\n        \";\n\n        // Send the email\n        $headers = 'MIME-Version: 1.0' . \"\\r\\n\";\n        $headers .= 'Content-type: text/html; charset=iso-8859-1' . \"\\r\\n\";\n        $headers .= 'From: no-reply@example.com' . \"\\r\\n\";\n\n        mail($email, $subject, $message, $headers);\n\n        echo '<script>alert(\"Email sent to reset password!\"); window.location.href = \"login.php\";</script>';\n    } else {\n        echo '<script>alert(\"Invalid email or not registered!\"); window.location.href = \"login.php\";</script>';\n    }\n}\n?>\n```\n\n**HTML Form for Forgot Password:**\n\n```html\n<form method=\"post\" action=\"<?php echo $_SERVER['PHP_SELF']; ?>\">\n    <input type=\"email\" name=\"email\" placeholder=\"Email\">\n    <button type=\"submit\" name=\"forgot_password\">Forgot Password</button>\n</form>\n```\n\n**Reset Password Page:**\n\nThis page will contain a form where the user can enter their new password.\n\n```php\n<?php\nrequire_once 'dbconnect.php'; // database connection file\n\nif (isset($_GET['token'])) {\n    $token = $_GET['token'];\n\n    // Check if the token is valid and exists in the database\n    $query = \"SELECT * FROM users WHERE token = '$token'\";\n    $result = mysqli_query($conn, $query);\n\n    if (mysqli_num_rows($result) > 0) {\n        // If the user's record is found, update their password with the new one they entered\n        echo '\n            <form method=\"post\" action=\"<?php echo $_SERVER['PHP_SELF']; ?>\">\n                <input type=\"password\" name=\"new_password\">\n                <button type=\"submit\">Change Password</button>\n            </form>\n        ';\n\n        if (isset($_POST['change_password'])) {\n            $new_password = $_POST['new_password'];\n\n            // Hash the new password and update the user's record\n            $hashed_new_password = password_hash($new_password, PASSWORD_DEFAULT);\n            $update_query = \"UPDATE users SET password = '$hashed_new_password' WHERE token = '$token'\";\n            mysqli_query($conn, $update_query);\n\n            echo '<script>alert(\"Password changed!\"); window.location.href = \"login.php\";</script>';\n        }\n    } else {\n        echo 'Invalid Token';\n    }\n}\n?>\n```\n\n**Database Connection File:**\n\nThis file contains the database connection settings and functions to interact with the database.\n\n```php\n<?php\n$conn = mysqli_connect('localhost', 'username', 'password', 'database_name');\nif (!$conn) {\n    die(\"Connection failed: \" . mysqli_connect_error());\n}\n\nfunction query($query) {\n    global $conn;\n    return mysqli_query($conn, $query);\n}\n?>\n```\n\nThis script will send an email to the user with a link that leads them to a page where they can reset their password. The new password is hashed using `password_hash()` and stored in the database.\n\nPlease note that this script does not include error checking for every possible scenario, but it should give you a good starting point for implementing your own forgot password function.", "code_blocks": ["```php\n<?php\nrequire_once 'dbconnect.php'; // database connection file\n\nif (isset($_POST['forgot_password'])) {\n    $email = $_POST['email'];\n\n    // Check if the email is valid and exists in the database\n    $query = \"SELECT * FROM users WHERE email = '$email'\";\n    $result = mysqli_query($conn, $query);\n\n    if (mysqli_num_rows($result) > 0) {\n        // Generate a random token for password reset\n        $token = bin2hex(random_bytes(32));\n\n        // Update the user's record with the new token\n        $update_query = \"UPDATE users SET token = '$token' WHERE email = '$email'\";\n        mysqli_query($conn, $update_query);\n\n        // Send an email to the user with a link to reset their password\n        $subject = 'Reset Your Password';\n        $message = \"\n            <html>\n                <body>\n                    <p>Click on this link to reset your password:</p>\n                    <a href='http://example.com/reset_password.php?token=$token'>Reset Password</a>\n                </body>\n            </html>\n        \";\n\n        // Send the email\n        $headers = 'MIME-Version: 1.0' . \"\\r\\n\";\n        $headers .= 'Content-type: text/html; charset=iso-8859-1' . \"\\r\\n\";\n        $headers .= 'From: no-reply@example.com' . \"\\r\\n\";\n\n        mail($email, $subject, $message, $headers);\n\n        echo '<script>alert(\"Email sent to reset password!\"); window.location.href = \"login.php\";</script>';\n    } else {\n        echo '<script>alert(\"Invalid email or not registered!\"); window.location.href = \"login.php\";</script>';\n    }\n}\n?>\n```", null, "```php\n<?php\nrequire_once 'dbconnect.php'; // database connection file\n\nif (isset($_GET['token'])) {\n    $token = $_GET['token'];\n\n    // Check if the token is valid and exists in the database\n    $query = \"SELECT * FROM users WHERE token = '$token'\";\n    $result = mysqli_query($conn, $query);\n\n    if (mysqli_num_rows($result) > 0) {\n        // If the user's record is found, update their password with the new one they entered\n        echo '\n            <form method=\"post\" action=\"<?php echo $_SERVER['PHP_SELF']; ?>\">\n                <input type=\"password\" name=\"new_password\">\n                <button type=\"submit\">Change Password</button>\n            </form>\n        ';\n\n        if (isset($_POST['change_password'])) {\n            $new_password = $_POST['new_password'];\n\n            // Hash the new password and update the user's record\n            $hashed_new_password = password_hash($new_password, PASSWORD_DEFAULT);\n            $update_query = \"UPDATE users SET password = '$hashed_new_password' WHERE token = '$token'\";\n            mysqli_query($conn, $update_query);\n\n            echo '<script>alert(\"Password changed!\"); window.location.href = \"login.php\";</script>';\n        }\n    } else {\n        echo 'Invalid Token';\n    }\n}\n?>\n```", "```php\n<?php\n$conn = mysqli_connect('localhost', 'username', 'password', 'database_name');\nif (!$conn) {\n    die(\"Connection failed: \" . mysqli_connect_error());\n}\n\nfunction query($query) {\n    global $conn;\n    return mysqli_query($conn, $query);\n}\n?>\n```"]}
