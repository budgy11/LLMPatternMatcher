{"prompt": "Create a forgot password function using php", "llm_output": "Here's an example of how you can create a \"Forgot Password\" function using PHP. This will send an email to the user with a link that allows them to reset their password.\n\n**Step 1: Create a new table in your database**\n\nFirst, we need to create a new table called `password_reset` (or any other name of your choice) in our database where we can store temporary passwords for users who want to reset their password. The following SQL command will create this table:\n\n```sql\nCREATE TABLE password_reset (\n    id INT AUTO_INCREMENT PRIMARY KEY,\n    email VARCHAR(255),\n    token VARCHAR(255)\n);\n```\n\n**Step 2: Create a PHP script that handles the Forgot Password functionality**\n\nCreate a new file called `forgot_password.php` and add the following code to it:\n\n```php\n<?php\n\n// Include your database connection settings\nrequire_once('config.php');\n\nif (isset($_POST['submit'])) {\n    // Sanitize input\n    $email = filter_var($_POST['email'], FILTER_SANITIZE_EMAIL);\n\n    // Check if email exists in database\n    $query = \"SELECT * FROM users WHERE email = '$email'\";\n    $result = mysqli_query($conn, $query);\n    \n    if (mysqli_num_rows($result) > 0) {\n        // Generate a token and store it in the password_reset table\n        $token = bin2hex(random_bytes(32));\n        $insertQuery = \"INSERT INTO password_reset SET email='$email', token='$token'\";\n        mysqli_query($conn, $insertQuery);\n\n        // Send an email to the user with the link to reset their password\n        sendPasswordResetEmail($email, $token);\n        \n        echo '<div class=\"alert alert-success\">A password reset email has been sent to your email address.</div>';\n    } else {\n        echo '<div class=\"alert alert-danger\">No account found with that email.</div>';\n    }\n}\n\nfunction sendPasswordResetEmail($email, $token) {\n    // Your SMTP settings\n    $smtpServer = 'your-smtp-server';\n    $smtpPort = 587;\n    $fromEmail = 'your-email@gmail.com';\n    $password = 'your-password';\n\n    // Email content\n    $subject = \"Password Reset Link\";\n    $body = \"\n        Hi there,\n        \n        You are receiving this email because we received a password reset request for your account.\n        \n        To reset your password, please click on the following link: \n        <a href='http://your-website.com/reset-password.php?token=$token'>$token</a>\n    \";\n\n    // Send email using SMTP\n    $headers = \"From: $fromEmail\\r\\n\";\n    $headers .= \"Bcc: $email\\r\\n\";\n    $headers .= \"MIME-Version: 1.0\\r\\n\";\n    $headers .= \"Content-Type: text/html; charset=UTF-8\\r\\n\";\n    mail($email, $subject, $body, $headers);\n}\n?>\n```\n\n**Step 3: Create a PHP script that handles the Password Reset functionality**\n\nCreate another file called `reset-password.php` and add the following code to it:\n\n```php\n<?php\n\n// Include your database connection settings\nrequire_once('config.php');\n\nif (isset($_GET['token'])) {\n    // Check if token exists in password_reset table\n    $query = \"SELECT * FROM password_reset WHERE token='\".$_GET['token'].\"'\";\n    $result = mysqli_query($conn, $query);\n    \n    if (mysqli_num_rows($result) > 0) {\n        // Get the email and user ID from the password_reset table\n        $row = mysqli_fetch_assoc($result);\n        $email = $row['email'];\n        \n        // Create a form to ask for new password\n        echo '<form action=\"update-password.php\" method=\"post\">\n            <label>Enter your new password:</label>\n            <input type=\"password\" name=\"new_password\"><br><br>\n            <label>Confirm your new password:</label>\n            <input type=\"password\" name=\"confirm_password\"><br><br>\n            <input type=\"submit\" value=\"Reset Password\">\n        </form>';\n    } else {\n        echo '<div class=\"alert alert-danger\">Invalid token.</div>';\n    }\n}\n?>\n```\n\n**Step 4: Create a PHP script that updates the user's password**\n\nCreate another file called `update-password.php` and add the following code to it:\n\n```php\n<?php\n\n// Include your database connection settings\nrequire_once('config.php');\n\nif (isset($_POST['new_password'])) {\n    // Check if both passwords match\n    if ($_POST['new_password'] == $_POST['confirm_password']) {\n        // Sanitize input\n        $new_password = password_hash($_POST['new_password'], PASSWORD_DEFAULT);\n        \n        // Update the user's password in database\n        $updateQuery = \"UPDATE users SET password='$new_password' WHERE email='\".$_SESSION['email'].\"'\";\n        mysqli_query($conn, $updateQuery);\n        \n        echo '<div class=\"alert alert-success\">Password updated successfully.</div>';\n    } else {\n        echo '<div class=\"alert alert-danger\">Passwords do not match.</div>';\n    }\n}\n?>\n```\n\n**Step 5: Update your database connection settings**\n\nMake sure you update the `config.php` file with your actual database credentials.\n\nThat's it! Now, when a user wants to reset their password, they can click on the \"Forgot Password\" link on your website. This will send an email to their registered email address with a link that allows them to reset their password.\n\nPlease note that this is just a basic example and should be adapted to fit your specific needs. Also, make sure you test it thoroughly before deploying it in production.", "code_blocks": [null, "```php\n<?php\n\n// Include your database connection settings\nrequire_once('config.php');\n\nif (isset($_POST['submit'])) {\n    // Sanitize input\n    $email = filter_var($_POST['email'], FILTER_SANITIZE_EMAIL);\n\n    // Check if email exists in database\n    $query = \"SELECT * FROM users WHERE email = '$email'\";\n    $result = mysqli_query($conn, $query);\n    \n    if (mysqli_num_rows($result) > 0) {\n        // Generate a token and store it in the password_reset table\n        $token = bin2hex(random_bytes(32));\n        $insertQuery = \"INSERT INTO password_reset SET email='$email', token='$token'\";\n        mysqli_query($conn, $insertQuery);\n\n        // Send an email to the user with the link to reset their password\n        sendPasswordResetEmail($email, $token);\n        \n        echo '<div class=\"alert alert-success\">A password reset email has been sent to your email address.</div>';\n    } else {\n        echo '<div class=\"alert alert-danger\">No account found with that email.</div>';\n    }\n}\n\nfunction sendPasswordResetEmail($email, $token) {\n    // Your SMTP settings\n    $smtpServer = 'your-smtp-server';\n    $smtpPort = 587;\n    $fromEmail = 'your-email@gmail.com';\n    $password = 'your-password';\n\n    // Email content\n    $subject = \"Password Reset Link\";\n    $body = \"\n        Hi there,\n        \n        You are receiving this email because we received a password reset request for your account.\n        \n        To reset your password, please click on the following link: \n        <a href='http://your-website.com/reset-password.php?token=$token'>$token</a>\n    \";\n\n    // Send email using SMTP\n    $headers = \"From: $fromEmail\\r\\n\";\n    $headers .= \"Bcc: $email\\r\\n\";\n    $headers .= \"MIME-Version: 1.0\\r\\n\";\n    $headers .= \"Content-Type: text/html; charset=UTF-8\\r\\n\";\n    mail($email, $subject, $body, $headers);\n}\n?>\n```", "```php\n<?php\n\n// Include your database connection settings\nrequire_once('config.php');\n\nif (isset($_GET['token'])) {\n    // Check if token exists in password_reset table\n    $query = \"SELECT * FROM password_reset WHERE token='\".$_GET['token'].\"'\";\n    $result = mysqli_query($conn, $query);\n    \n    if (mysqli_num_rows($result) > 0) {\n        // Get the email and user ID from the password_reset table\n        $row = mysqli_fetch_assoc($result);\n        $email = $row['email'];\n        \n        // Create a form to ask for new password\n        echo '<form action=\"update-password.php\" method=\"post\">\n            <label>Enter your new password:</label>\n            <input type=\"password\" name=\"new_password\"><br><br>\n            <label>Confirm your new password:</label>\n            <input type=\"password\" name=\"confirm_password\"><br><br>\n            <input type=\"submit\" value=\"Reset Password\">\n        </form>';\n    } else {\n        echo '<div class=\"alert alert-danger\">Invalid token.</div>';\n    }\n}\n?>\n```", "```php\n<?php\n\n// Include your database connection settings\nrequire_once('config.php');\n\nif (isset($_POST['new_password'])) {\n    // Check if both passwords match\n    if ($_POST['new_password'] == $_POST['confirm_password']) {\n        // Sanitize input\n        $new_password = password_hash($_POST['new_password'], PASSWORD_DEFAULT);\n        \n        // Update the user's password in database\n        $updateQuery = \"UPDATE users SET password='$new_password' WHERE email='\".$_SESSION['email'].\"'\";\n        mysqli_query($conn, $updateQuery);\n        \n        echo '<div class=\"alert alert-success\">Password updated successfully.</div>';\n    } else {\n        echo '<div class=\"alert alert-danger\">Passwords do not match.</div>';\n    }\n}\n?>\n```"]}
