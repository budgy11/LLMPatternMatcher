{"prompt": "Create a forgot password function using php", "llm_output": "Here's an example of how to create a \"forgot password\" functionality in PHP. This will send a reset password link to the user's email address.\n\n**Database Setup:**\nFirst, let's assume you have a MySQL database with a table named `users` that has the following columns:\n\n```sql\nCREATE TABLE users (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  username VARCHAR(50),\n  password_hash VARCHAR(255),\n  email VARCHAR(100)\n);\n```\n\n**PHP Code:**\nWe'll create two files: `forgot_password.php` and `reset_password.php`.\n\n**forgot_password.php:**\n```php\n<?php\nrequire_once 'db_config.php'; // assuming you have a db_config file for database connection\n\nif ($_SERVER['REQUEST_METHOD'] === 'POST') {\n  $email = $_POST['email'];\n  \n  try {\n    $query = \"SELECT * FROM users WHERE email = '$email'\";\n    $result = mysqli_query($conn, $query);\n    \n    if (mysqli_num_rows($result) > 0) {\n      $row = mysqli_fetch_assoc($result);\n      \n      // Generate a random reset code\n      $reset_code = substr(str_shuffle('abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'), 0, 16);\n      \n      // Update user's reset code in database\n      $update_query = \"UPDATE users SET reset_code = '$reset_code' WHERE email = '$email'\";\n      mysqli_query($conn, $update_query);\n      \n      // Send password reset link to user's email address\n      send_password_reset_link($row['username'], $reset_code, $email);\n    } else {\n      echo \"Email not found.\";\n    }\n  } catch (Exception $e) {\n    echo \"Error: \" . $e->getMessage();\n  }\n} else {\n  // Form for forgot password\n?>\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <title>Forgot Password</title>\n</head>\n<body>\n  <form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\">\n    Email: <input type=\"email\" name=\"email\"><br><br>\n    <button type=\"submit\">Submit</button>\n  </form>\n</body>\n</html>\n<?php\n}\n?>\n\nfunction send_password_reset_link($username, $reset_code, $email) {\n  // SMTP settings for sending email (change these according to your hosting provider)\n  $smtp_server = 'your_smtp_server';\n  $from_email = 'your_from_email@example.com';\n  \n  try {\n    $msg = \"Hello $username,\\n\\nPlease click on the link below to reset your password:\\n\\nhttp://example.com/reset_password.php?email=$email&reset_code=$reset_code\";\n    \n    // Send email using SMTP\n    mail($email, 'Reset Your Password', $msg, \"From: $from_email\");\n  } catch (Exception $e) {\n    echo \"Error sending email: \" . $e->getMessage();\n  }\n}\n```\n\n**reset_password.php:**\n```php\n<?php\nrequire_once 'db_config.php'; // assuming you have a db_config file for database connection\n\nif ($_SERVER['REQUEST_METHOD'] === 'GET') {\n  $email = $_GET['email'];\n  $reset_code = $_GET['reset_code'];\n  \n  try {\n    $query = \"SELECT * FROM users WHERE email = '$email' AND reset_code = '$reset_code'\";\n    $result = mysqli_query($conn, $query);\n    \n    if (mysqli_num_rows($result) > 0) {\n      // User's account exists and has the correct reset code\n      \n      echo \"<h1>Reset Your Password</h1>\";\n      \n      // Form for entering new password\n?>\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <title>Reset Password</title>\n</head>\n<body>\n  <form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\" onsubmit=\"return validatePassword()\">\n    New Password: <input type=\"password\" id=\"new_password\" name=\"new_password\"><br><br>\n    Confirm New Password: <input type=\"password\" id=\"confirm_new_password\" name=\"confirm_new_password\"><br><br>\n    <button type=\"submit\">Submit</button>\n  </form>\n\n  <!-- JavaScript for validating passwords -->\n  <script src=\"https://code.jquery.com/jquery-3.6.0.min.js\"></script>\n  <script>\n  function validatePassword() {\n    var new_password = document.getElementById('new_password').value;\n    var confirm_new_password = document.getElementById('confirm_new_password').value;\n    \n    if (new_password !== confirm_new_password) {\n      alert(\"Passwords don't match!\");\n      return false;\n    }\n    \n    // Update user's password in database\n    $.ajax({\n      type: 'POST',\n      url: 'update_password.php',\n      data: {email: '<?php echo $email; ?>', new_password: new_password, reset_code: '<?php echo $reset_code; ?>'},\n      success: function() {\n        alert(\"Password updated successfully!\");\n        window.location.href = \"login.php\";\n      }\n    });\n    \n    return false;\n  }\n  </script>\n</body>\n</html>\n<?php\n    } else {\n      // Incorrect reset code or email\n      echo \"Incorrect reset code or email.\";\n    }\n  } catch (Exception $e) {\n    echo \"Error: \" . $e->getMessage();\n  }\n} else {\n  // Form for entering new password\n?>\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <title>Reset Password</title>\n</head>\n<body>\n  <form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\" onsubmit=\"return validatePassword()\">\n    New Password: <input type=\"password\" id=\"new_password\" name=\"new_password\"><br><br>\n    Confirm New Password: <input type=\"password\" id=\"confirm_new_password\" name=\"confirm_new_password\"><br><br>\n    <button type=\"submit\">Submit</button>\n  </form>\n\n  <!-- JavaScript for validating passwords -->\n  <script src=\"https://code.jquery.com/jquery-3.6.0.min.js\"></script>\n  <script>\n  function validatePassword() {\n    var new_password = document.getElementById('new_password').value;\n    var confirm_new_password = document.getElementById('confirm_new_password').value;\n    \n    if (new_password !== confirm_new_password) {\n      alert(\"Passwords don't match!\");\n      return false;\n    }\n    \n    // Update user's password in database\n    $.ajax({\n      type: 'POST',\n      url: 'update_password.php',\n      data: {email: '<?php echo $email; ?>', new_password: new_password, reset_code: '<?php echo $reset_code; ?>'},\n      success: function() {\n        alert(\"Password updated successfully!\");\n        window.location.href = \"login.php\";\n      }\n    });\n    \n    return false;\n  }\n  </script>\n</body>\n</html>\n<?php\n}\n?>\n\nupdate_password.php:\n```php\n<?php\nrequire_once 'db_config.php'; // assuming you have a db_config file for database connection\n\nif ($_SERVER['REQUEST_METHOD'] === 'POST') {\n  $email = $_POST['email'];\n  $new_password = $_POST['new_password'];\n  $reset_code = $_POST['reset_code'];\n  \n  try {\n    $query = \"UPDATE users SET password_hash = '$new_password' WHERE email = '$email' AND reset_code = '$reset_code'\";\n    mysqli_query($conn, $query);\n    \n    // Update user's reset code to empty string\n    $update_reset_code_query = \"UPDATE users SET reset_code = '' WHERE email = '$email'\";\n    mysqli_query($conn, $update_reset_code_query);\n  } catch (Exception $e) {\n    echo \"Error: \" . $e->getMessage();\n  }\n}\n?>\n```\n\nPlease note that this is a basic example and doesn't cover all possible security concerns. You should implement additional measures to secure your application.\n\nAlso, remember to change the SMTP settings in `forgot_password.php` according to your hosting provider's requirements.\n\nThis code uses JavaScript for password validation and updates the user's password using an AJAX request.", "code_blocks": [null, "```php\n<?php\nrequire_once 'db_config.php'; // assuming you have a db_config file for database connection\n\nif ($_SERVER['REQUEST_METHOD'] === 'POST') {\n  $email = $_POST['email'];\n  \n  try {\n    $query = \"SELECT * FROM users WHERE email = '$email'\";\n    $result = mysqli_query($conn, $query);\n    \n    if (mysqli_num_rows($result) > 0) {\n      $row = mysqli_fetch_assoc($result);\n      \n      // Generate a random reset code\n      $reset_code = substr(str_shuffle('abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'), 0, 16);\n      \n      // Update user's reset code in database\n      $update_query = \"UPDATE users SET reset_code = '$reset_code' WHERE email = '$email'\";\n      mysqli_query($conn, $update_query);\n      \n      // Send password reset link to user's email address\n      send_password_reset_link($row['username'], $reset_code, $email);\n    } else {\n      echo \"Email not found.\";\n    }\n  } catch (Exception $e) {\n    echo \"Error: \" . $e->getMessage();\n  }\n} else {\n  // Form for forgot password\n?>\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <title>Forgot Password</title>\n</head>\n<body>\n  <form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\">\n    Email: <input type=\"email\" name=\"email\"><br><br>\n    <button type=\"submit\">Submit</button>\n  </form>\n</body>\n</html>\n<?php\n}\n?>\n\nfunction send_password_reset_link($username, $reset_code, $email) {\n  // SMTP settings for sending email (change these according to your hosting provider)\n  $smtp_server = 'your_smtp_server';\n  $from_email = 'your_from_email@example.com';\n  \n  try {\n    $msg = \"Hello $username,\\n\\nPlease click on the link below to reset your password:\\n\\nhttp://example.com/reset_password.php?email=$email&reset_code=$reset_code\";\n    \n    // Send email using SMTP\n    mail($email, 'Reset Your Password', $msg, \"From: $from_email\");\n  } catch (Exception $e) {\n    echo \"Error sending email: \" . $e->getMessage();\n  }\n}\n```", "```php\n<?php\nrequire_once 'db_config.php'; // assuming you have a db_config file for database connection\n\nif ($_SERVER['REQUEST_METHOD'] === 'GET') {\n  $email = $_GET['email'];\n  $reset_code = $_GET['reset_code'];\n  \n  try {\n    $query = \"SELECT * FROM users WHERE email = '$email' AND reset_code = '$reset_code'\";\n    $result = mysqli_query($conn, $query);\n    \n    if (mysqli_num_rows($result) > 0) {\n      // User's account exists and has the correct reset code\n      \n      echo \"<h1>Reset Your Password</h1>\";\n      \n      // Form for entering new password\n?>\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <title>Reset Password</title>\n</head>\n<body>\n  <form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\" onsubmit=\"return validatePassword()\">\n    New Password: <input type=\"password\" id=\"new_password\" name=\"new_password\"><br><br>\n    Confirm New Password: <input type=\"password\" id=\"confirm_new_password\" name=\"confirm_new_password\"><br><br>\n    <button type=\"submit\">Submit</button>\n  </form>\n\n  <!-- JavaScript for validating passwords -->\n  <script src=\"https://code.jquery.com/jquery-3.6.0.min.js\"></script>\n  <script>\n  function validatePassword() {\n    var new_password = document.getElementById('new_password').value;\n    var confirm_new_password = document.getElementById('confirm_new_password').value;\n    \n    if (new_password !== confirm_new_password) {\n      alert(\"Passwords don't match!\");\n      return false;\n    }\n    \n    // Update user's password in database\n    $.ajax({\n      type: 'POST',\n      url: 'update_password.php',\n      data: {email: '<?php echo $email; ?>', new_password: new_password, reset_code: '<?php echo $reset_code; ?>'},\n      success: function() {\n        alert(\"Password updated successfully!\");\n        window.location.href = \"login.php\";\n      }\n    });\n    \n    return false;\n  }\n  </script>\n</body>\n</html>\n<?php\n    } else {\n      // Incorrect reset code or email\n      echo \"Incorrect reset code or email.\";\n    }\n  } catch (Exception $e) {\n    echo \"Error: \" . $e->getMessage();\n  }\n} else {\n  // Form for entering new password\n?>\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <title>Reset Password</title>\n</head>\n<body>\n  <form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\" onsubmit=\"return validatePassword()\">\n    New Password: <input type=\"password\" id=\"new_password\" name=\"new_password\"><br><br>\n    Confirm New Password: <input type=\"password\" id=\"confirm_new_password\" name=\"confirm_new_password\"><br><br>\n    <button type=\"submit\">Submit</button>\n  </form>\n\n  <!-- JavaScript for validating passwords -->\n  <script src=\"https://code.jquery.com/jquery-3.6.0.min.js\"></script>\n  <script>\n  function validatePassword() {\n    var new_password = document.getElementById('new_password').value;\n    var confirm_new_password = document.getElementById('confirm_new_password').value;\n    \n    if (new_password !== confirm_new_password) {\n      alert(\"Passwords don't match!\");\n      return false;\n    }\n    \n    // Update user's password in database\n    $.ajax({\n      type: 'POST',\n      url: 'update_password.php',\n      data: {email: '<?php echo $email; ?>', new_password: new_password, reset_code: '<?php echo $reset_code; ?>'},\n      success: function() {\n        alert(\"Password updated successfully!\");\n        window.location.href = \"login.php\";\n      }\n    });\n    \n    return false;\n  }\n  </script>\n</body>\n</html>\n<?php\n}\n?>\n\nupdate_password.php:\n```"]}
