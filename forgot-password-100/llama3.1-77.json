{"prompt": "Create a forgot password function using php", "llm_output": "Here is an example of how to create a \"Forgot Password\" function using PHP:\n\n**Database Schema**\n\nFor this example, we'll assume you have a database table named `users` with the following columns:\n\n| Column Name | Data Type |\n| --- | --- |\n| id | int |\n| username | varchar(255) |\n| email | varchar(255) |\n| password | varchar(255) |\n\n**PHP Code**\n\n```php\n<?php\n\n// Configuration settings\ndefine('DB_HOST', 'your_host');\ndefine('DB_USER', 'your_user');\ndefine('DB_PASSWORD', 'your_password');\ndefine('DB_NAME', 'your_database');\n\n// Connect to database\n$conn = new mysqli(DB_HOST, DB_USER, DB_PASSWORD, DB_NAME);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Function to send password reset email\nfunction send_password_reset_email($email, $username) {\n    // Generate a random token for the user\n    $token = bin2hex(random_bytes(32));\n\n    // Update the user's database record with the new token\n    $query = \"UPDATE users SET password_token = '$token' WHERE email = '$email'\";\n    if ($conn->query($query) === TRUE) {\n        // Send email to user with password reset link\n        $subject = 'Reset Your Password';\n        $body = \"\n            Dear $username,\n            \n            You have requested to reset your password. Please click on the following link to reset your password:\n            <a href='http://your_site.com/reset-password.php?token=$token'>Reset Password</a>\n        \n            If you did not request a password reset, please ignore this email.\n        \";\n        $from = 'your_email@example.com';\n        $to = $email;\n        mail($to, $subject, $body, \"From: $from\");\n\n        echo \"Email sent successfully.\";\n    } else {\n        echo \"Error updating user record: \" . $conn->error;\n    }\n}\n\n// Handle forgot password form submission\nif (isset($_POST['forgot_password'])) {\n    // Get email address from input field\n    $email = $_POST['email'];\n\n    // Check if email exists in database\n    $query = \"SELECT * FROM users WHERE email = '$email'\";\n    $result = $conn->query($query);\n\n    if ($result->num_rows > 0) {\n        // Get user's username from database record\n        while ($row = $result->fetch_assoc()) {\n            $username = $row['username'];\n\n            // Send password reset email to user\n            send_password_reset_email($email, $username);\n        }\n    } else {\n        echo \"Email address not found in database.\";\n    }\n}\n\n// Close database connection\n$conn->close();\n\n?>\n```\n\n**reset-password.php**\n\n```php\n<?php\n\n// Configuration settings\ndefine('DB_HOST', 'your_host');\ndefine('DB_USER', 'your_user');\ndefine('DB_PASSWORD', 'your_password');\ndefine('DB_NAME', 'your_database');\n\n// Connect to database\n$conn = new mysqli(DB_HOST, DB_USER, DB_PASSWORD, DB_NAME);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Function to update user's password\nfunction update_password($token, $new_password) {\n    // Get user's database record using token\n    $query = \"SELECT * FROM users WHERE password_token = '$token'\";\n    $result = $conn->query($query);\n\n    if ($result->num_rows > 0) {\n        while ($row = $result->fetch_assoc()) {\n            // Update user's password in database\n            $new_password_hash = password_hash($new_password, PASSWORD_DEFAULT);\n            $query = \"UPDATE users SET password = '$new_password_hash' WHERE id = '$row[id]'\";\n            if ($conn->query($query) === TRUE) {\n                echo \"Password updated successfully.\";\n            } else {\n                echo \"Error updating user record: \" . $conn->error;\n            }\n        }\n    } else {\n        echo \"Invalid token.\";\n    }\n}\n\n// Handle password reset form submission\nif (isset($_POST['reset_password'])) {\n    // Get token and new password from input fields\n    $token = $_POST['token'];\n    $new_password = $_POST['new_password'];\n\n    // Update user's password in database using token\n    update_password($token, $new_password);\n}\n\n// Close database connection\n$conn->close();\n\n?>\n```\n\n**HTML Form (forgot-password.html)**\n\n```html\n<form action=\"forgot-password.php\" method=\"post\">\n    <label>Email Address:</label>\n    <input type=\"email\" name=\"email\" required>\n    <button type=\"submit\" name=\"forgot_password\">Submit</button>\n</form>\n```\n\n**HTML Form (reset-password.html)**\n\n```html\n<form action=\"reset-password.php\" method=\"post\">\n    <label>Token:</label>\n    <input type=\"text\" name=\"token\" required>\n    <label>New Password:</label>\n    <input type=\"password\" name=\"new_password\" required>\n    <button type=\"submit\" name=\"reset_password\">Submit</button>\n</form>\n```\n\nThis is a basic example of how you can create a \"Forgot Password\" function using PHP. This code assumes that you have already set up a database and have the necessary configuration settings. You will need to modify this code to fit your specific needs.\n\nPlease note that in production environment, always use prepared statements instead of concatenating user input with SQL queries to prevent SQL injection attacks.\n\nAlso, make sure to store the password securely using password hashing algorithms like `password_hash` (PHP 5.5+). Never store passwords in plain text.", "code_blocks": ["```php\n<?php\n\n// Configuration settings\ndefine('DB_HOST', 'your_host');\ndefine('DB_USER', 'your_user');\ndefine('DB_PASSWORD', 'your_password');\ndefine('DB_NAME', 'your_database');\n\n// Connect to database\n$conn = new mysqli(DB_HOST, DB_USER, DB_PASSWORD, DB_NAME);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Function to send password reset email\nfunction send_password_reset_email($email, $username) {\n    // Generate a random token for the user\n    $token = bin2hex(random_bytes(32));\n\n    // Update the user's database record with the new token\n    $query = \"UPDATE users SET password_token = '$token' WHERE email = '$email'\";\n    if ($conn->query($query) === TRUE) {\n        // Send email to user with password reset link\n        $subject = 'Reset Your Password';\n        $body = \"\n            Dear $username,\n            \n            You have requested to reset your password. Please click on the following link to reset your password:\n            <a href='http://your_site.com/reset-password.php?token=$token'>Reset Password</a>\n        \n            If you did not request a password reset, please ignore this email.\n        \";\n        $from = 'your_email@example.com';\n        $to = $email;\n        mail($to, $subject, $body, \"From: $from\");\n\n        echo \"Email sent successfully.\";\n    } else {\n        echo \"Error updating user record: \" . $conn->error;\n    }\n}\n\n// Handle forgot password form submission\nif (isset($_POST['forgot_password'])) {\n    // Get email address from input field\n    $email = $_POST['email'];\n\n    // Check if email exists in database\n    $query = \"SELECT * FROM users WHERE email = '$email'\";\n    $result = $conn->query($query);\n\n    if ($result->num_rows > 0) {\n        // Get user's username from database record\n        while ($row = $result->fetch_assoc()) {\n            $username = $row['username'];\n\n            // Send password reset email to user\n            send_password_reset_email($email, $username);\n        }\n    } else {\n        echo \"Email address not found in database.\";\n    }\n}\n\n// Close database connection\n$conn->close();\n\n?>\n```", "```php\n<?php\n\n// Configuration settings\ndefine('DB_HOST', 'your_host');\ndefine('DB_USER', 'your_user');\ndefine('DB_PASSWORD', 'your_password');\ndefine('DB_NAME', 'your_database');\n\n// Connect to database\n$conn = new mysqli(DB_HOST, DB_USER, DB_PASSWORD, DB_NAME);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Function to update user's password\nfunction update_password($token, $new_password) {\n    // Get user's database record using token\n    $query = \"SELECT * FROM users WHERE password_token = '$token'\";\n    $result = $conn->query($query);\n\n    if ($result->num_rows > 0) {\n        while ($row = $result->fetch_assoc()) {\n            // Update user's password in database\n            $new_password_hash = password_hash($new_password, PASSWORD_DEFAULT);\n            $query = \"UPDATE users SET password = '$new_password_hash' WHERE id = '$row[id]'\";\n            if ($conn->query($query) === TRUE) {\n                echo \"Password updated successfully.\";\n            } else {\n                echo \"Error updating user record: \" . $conn->error;\n            }\n        }\n    } else {\n        echo \"Invalid token.\";\n    }\n}\n\n// Handle password reset form submission\nif (isset($_POST['reset_password'])) {\n    // Get token and new password from input fields\n    $token = $_POST['token'];\n    $new_password = $_POST['new_password'];\n\n    // Update user's password in database using token\n    update_password($token, $new_password);\n}\n\n// Close database connection\n$conn->close();\n\n?>\n```", null, null]}
