{"prompt": "Create a forgot password function using php", "llm_output": "Here's an example of how you can create a \"Forgot Password\" function in PHP. This will send a password reset link to the user's email.\n\n**Database Schema**\n\nFor this example, we'll assume that we have a `users` table with the following structure:\n\n```sql\nCREATE TABLE users (\n  id INT PRIMARY KEY,\n  username VARCHAR(50),\n  password_hash VARCHAR(255),\n  email VARCHAR(100)\n);\n```\n\n**PHP Code**\n\nCreate a new PHP file called `forgot_password.php`. This will contain the code for handling the forgot password functionality.\n\n```php\n<?php\n\n// Configuration settings\ndefine('ROOT_DIR', dirname(__FILE__));\ndefine('DB_HOST', 'localhost');\ndefine('DB_USERNAME', 'your_username');\ndefine('DB_PASSWORD', 'your_password');\ndefine('DB_NAME', 'your_database');\n\n// Database connection function\nfunction connect_to_db() {\n  $conn = mysqli_connect(DB_HOST, DB_USERNAME, DB_PASSWORD, DB_NAME);\n  if (!$conn) {\n    die(\"Connection failed: \" . mysqli_connect_error());\n  }\n  return $conn;\n}\n\n// Function to send password reset link\nfunction send_password_reset_link($email, $username) {\n  // Send email using mail() function or a library like PHPMailer\n  $subject = 'Reset Your Password';\n  $body = \"Click the following link to reset your password: <a href='http://your-website.com/reset-password.php?token=\".md5(uniqid(rand(), true)).\"'>Reset Password</a>\";\n  mail($email, $subject, $body);\n}\n\n// Handle form submission\nif (isset($_POST['submit'])) {\n  // Validate user input\n  if (!empty($_POST['username']) && !empty($_POST['email'])) {\n    $conn = connect_to_db();\n    $query = \"SELECT * FROM users WHERE email='\".$_POST['email'].\"' AND username='\".$_POST['username'].\"'\";\n    $result = mysqli_query($conn, $query);\n    \n    // Check if user exists\n    if (mysqli_num_rows($result) > 0) {\n      // Get the user's ID and password hash\n      $row = mysqli_fetch_assoc($result);\n      $user_id = $row['id'];\n      $password_hash = $row['password_hash'];\n      \n      // Generate a random token for the password reset link\n      $token = md5(uniqid(rand(), true));\n      \n      // Update the user's token in the database\n      $query = \"UPDATE users SET token='\".$token.\"' WHERE id=\".$user_id;\n      mysqli_query($conn, $query);\n      \n      // Send the password reset link to the user's email\n      send_password_reset_link($_POST['email'], $_POST['username']);\n    } else {\n      echo 'User not found.';\n    }\n  } else {\n    echo 'Please enter both username and email.';\n  }\n}\n\n?>\n\n<!-- HTML form for forgot password functionality -->\n<form action=\"<?php echo basename(__FILE__); ?>\" method=\"post\">\n  <label>Username:</label>\n  <input type=\"text\" name=\"username\" />\n  <br><br>\n  <label>Email:</label>\n  <input type=\"email\" name=\"email\" />\n  <br><br>\n  <input type=\"submit\" name=\"submit\" value=\"Submit\">\n</form>\n\n<?php\nmysqli_close($conn);\n?>\n```\n\n**How it works**\n\n1. The user submits the form with their username and email.\n2. The script checks if the user exists in the database by querying the `users` table with the provided email and username.\n3. If the user exists, a random token is generated for the password reset link.\n4. The token is updated in the database for the user's account.\n5. A password reset link is sent to the user's email using the `send_password_reset_link()` function.\n\n**Note**: This is just an example code and should be modified according to your specific needs. Also, make sure to replace `'your-website.com'` with your actual website URL in the email body.", "code_blocks": [null, "```php\n<?php\n\n// Configuration settings\ndefine('ROOT_DIR', dirname(__FILE__));\ndefine('DB_HOST', 'localhost');\ndefine('DB_USERNAME', 'your_username');\ndefine('DB_PASSWORD', 'your_password');\ndefine('DB_NAME', 'your_database');\n\n// Database connection function\nfunction connect_to_db() {\n  $conn = mysqli_connect(DB_HOST, DB_USERNAME, DB_PASSWORD, DB_NAME);\n  if (!$conn) {\n    die(\"Connection failed: \" . mysqli_connect_error());\n  }\n  return $conn;\n}\n\n// Function to send password reset link\nfunction send_password_reset_link($email, $username) {\n  // Send email using mail() function or a library like PHPMailer\n  $subject = 'Reset Your Password';\n  $body = \"Click the following link to reset your password: <a href='http://your-website.com/reset-password.php?token=\".md5(uniqid(rand(), true)).\"'>Reset Password</a>\";\n  mail($email, $subject, $body);\n}\n\n// Handle form submission\nif (isset($_POST['submit'])) {\n  // Validate user input\n  if (!empty($_POST['username']) && !empty($_POST['email'])) {\n    $conn = connect_to_db();\n    $query = \"SELECT * FROM users WHERE email='\".$_POST['email'].\"' AND username='\".$_POST['username'].\"'\";\n    $result = mysqli_query($conn, $query);\n    \n    // Check if user exists\n    if (mysqli_num_rows($result) > 0) {\n      // Get the user's ID and password hash\n      $row = mysqli_fetch_assoc($result);\n      $user_id = $row['id'];\n      $password_hash = $row['password_hash'];\n      \n      // Generate a random token for the password reset link\n      $token = md5(uniqid(rand(), true));\n      \n      // Update the user's token in the database\n      $query = \"UPDATE users SET token='\".$token.\"' WHERE id=\".$user_id;\n      mysqli_query($conn, $query);\n      \n      // Send the password reset link to the user's email\n      send_password_reset_link($_POST['email'], $_POST['username']);\n    } else {\n      echo 'User not found.';\n    }\n  } else {\n    echo 'Please enter both username and email.';\n  }\n}\n\n?>\n\n<!-- HTML form for forgot password functionality -->\n<form action=\"<?php echo basename(__FILE__); ?>\" method=\"post\">\n  <label>Username:</label>\n  <input type=\"text\" name=\"username\" />\n  <br><br>\n  <label>Email:</label>\n  <input type=\"email\" name=\"email\" />\n  <br><br>\n  <input type=\"submit\" name=\"submit\" value=\"Submit\">\n</form>\n\n<?php\nmysqli_close($conn);\n?>\n```"]}
