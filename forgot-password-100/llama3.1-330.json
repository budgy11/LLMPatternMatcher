{"prompt": "Create a forgot password function using php", "llm_output": "**Forgot Password Function in PHP**\n=====================================\n\nIn this example, we will create a simple forgot password function using PHP. This function will send an email to the user with a link to reset their password.\n\n**Database Setup**\n-----------------\n\nFirst, you need to set up your database to store users' information. Create a table named `users` with the following columns:\n\n```sql\nCREATE TABLE users (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  username VARCHAR(255),\n  email VARCHAR(255) UNIQUE,\n  password VARCHAR(255)\n);\n```\n\n**PHP Code**\n-------------\n\nCreate a new PHP file named `forgot_password.php`. This file will handle the forgot password functionality.\n\n```php\n<?php\n\n// Configuration settings\n$dbHost = 'localhost';\n$dbUsername = 'your_username';\n$dbPassword = 'your_password';\n$dbName = 'your_database_name';\n\n// Connect to database\n$conn = mysqli_connect($dbHost, $dbUsername, $dbPassword, $dbName);\n\nif (!$conn) {\n  die(\"Connection failed: \" . mysqli_connect_error());\n}\n\n// Function to send email with password reset link\nfunction sendEmailResetLink($to, $username, $token) {\n  // Email configuration settings\n  $from = 'your_email@example.com';\n  $subject = 'Password Reset Link';\n\n  // Prepare email body\n  $emailBody = \"Dear $username,\\n\\n\";\n  $emailBody .= \"Click on the following link to reset your password:\\n\";\n  $emailBody .= \"http://your_website_url/forgot_password.php?token=$token\";\n\n  // Send email using PHPMailer or any other mail library\n  mail($to, $subject, $emailBody, 'From: ' . $from);\n}\n\n// Function to verify token and update password\nfunction verifyTokenAndUpdatePassword($token) {\n  // Verify token with database query\n  $query = \"SELECT * FROM users WHERE token = '$token'\";\n  $result = mysqli_query($conn, $query);\n\n  if (mysqli_num_rows($result) > 0) {\n    // Update password in database\n    $row = mysqli_fetch_assoc($result);\n    $password = $_POST['new_password'];\n    $hashedPassword = password_hash($password, PASSWORD_DEFAULT);\n    $query = \"UPDATE users SET password = '$hashedPassword' WHERE token = '$token'\";\n    mysqli_query($conn, $query);\n\n    // Set session variables\n    $_SESSION['username'] = $row['username'];\n    $_SESSION['email'] = $row['email'];\n\n    // Redirect to login page\n    header('Location: login.php');\n  }\n}\n\n// Check if user submitted the forgot password form\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n  // Get user's email from database\n  $query = \"SELECT * FROM users WHERE email = '\".$_POST['email'].\"'\";\n  $result = mysqli_query($conn, $query);\n\n  if (mysqli_num_rows($result) > 0) {\n    // Generate random token for password reset link\n    $token = bin2hex(random_bytes(16));\n\n    // Update user's record with new token in database\n    $row = mysqli_fetch_assoc($result);\n    $query = \"UPDATE users SET token = '$token' WHERE email = '\".$_POST['email'].\"'\";\n    mysqli_query($conn, $query);\n\n    // Send email to user with password reset link\n    sendEmailResetLink($_POST['email'], $_POST['username'], $token);\n  } else {\n    echo 'Error: User not found.';\n  }\n} elseif (isset($_GET['token'])) {\n  // Verify token and update password\n  verifyTokenAndUpdatePassword($_GET['token']);\n}\n\n?>\n```\n\n**HTML Form**\n-------------\n\nCreate an HTML form to collect user's email and username.\n\n```html\n<form action=\"forgot_password.php\" method=\"post\">\n  <label for=\"username\">Username:</label>\n  <input type=\"text\" id=\"username\" name=\"username\"><br><br>\n  <label for=\"email\">Email:</label>\n  <input type=\"email\" id=\"email\" name=\"email\"><br><br>\n  <input type=\"submit\" value=\"Send Reset Link\">\n</form>\n```\n\n**Security Considerations**\n---------------------------\n\n*   Use prepared statements to prevent SQL injection attacks.\n*   Store passwords securely using password hashing algorithms like `password_hash()` and `password_verify()`.\n*   Use a secure method to send emails, such as PHPMailer or any other mail library.\n\nThis code is a basic example of how you can implement a forgot password function in PHP. You should always follow best practices for security and error handling when building production-level applications.", "code_blocks": [null, "```php\n<?php\n\n// Configuration settings\n$dbHost = 'localhost';\n$dbUsername = 'your_username';\n$dbPassword = 'your_password';\n$dbName = 'your_database_name';\n\n// Connect to database\n$conn = mysqli_connect($dbHost, $dbUsername, $dbPassword, $dbName);\n\nif (!$conn) {\n  die(\"Connection failed: \" . mysqli_connect_error());\n}\n\n// Function to send email with password reset link\nfunction sendEmailResetLink($to, $username, $token) {\n  // Email configuration settings\n  $from = 'your_email@example.com';\n  $subject = 'Password Reset Link';\n\n  // Prepare email body\n  $emailBody = \"Dear $username,\\n\\n\";\n  $emailBody .= \"Click on the following link to reset your password:\\n\";\n  $emailBody .= \"http://your_website_url/forgot_password.php?token=$token\";\n\n  // Send email using PHPMailer or any other mail library\n  mail($to, $subject, $emailBody, 'From: ' . $from);\n}\n\n// Function to verify token and update password\nfunction verifyTokenAndUpdatePassword($token) {\n  // Verify token with database query\n  $query = \"SELECT * FROM users WHERE token = '$token'\";\n  $result = mysqli_query($conn, $query);\n\n  if (mysqli_num_rows($result) > 0) {\n    // Update password in database\n    $row = mysqli_fetch_assoc($result);\n    $password = $_POST['new_password'];\n    $hashedPassword = password_hash($password, PASSWORD_DEFAULT);\n    $query = \"UPDATE users SET password = '$hashedPassword' WHERE token = '$token'\";\n    mysqli_query($conn, $query);\n\n    // Set session variables\n    $_SESSION['username'] = $row['username'];\n    $_SESSION['email'] = $row['email'];\n\n    // Redirect to login page\n    header('Location: login.php');\n  }\n}\n\n// Check if user submitted the forgot password form\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n  // Get user's email from database\n  $query = \"SELECT * FROM users WHERE email = '\".$_POST['email'].\"'\";\n  $result = mysqli_query($conn, $query);\n\n  if (mysqli_num_rows($result) > 0) {\n    // Generate random token for password reset link\n    $token = bin2hex(random_bytes(16));\n\n    // Update user's record with new token in database\n    $row = mysqli_fetch_assoc($result);\n    $query = \"UPDATE users SET token = '$token' WHERE email = '\".$_POST['email'].\"'\";\n    mysqli_query($conn, $query);\n\n    // Send email to user with password reset link\n    sendEmailResetLink($_POST['email'], $_POST['username'], $token);\n  } else {\n    echo 'Error: User not found.';\n  }\n} elseif (isset($_GET['token'])) {\n  // Verify token and update password\n  verifyTokenAndUpdatePassword($_GET['token']);\n}\n\n?>\n```", null]}
