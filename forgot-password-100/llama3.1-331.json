{"prompt": "Create a forgot password function using php", "llm_output": "Here is an example of a forgotten password function using PHP. This script will send an email to the user with a reset link that includes a unique token.\n\n**password_recover.php**\n\n```php\n<?php\n\n// Configuration settings\ndefine('EMAIL_SENDER', 'your_email@example.com');\ndefine('EMAIL_PASSWORD_RESET_LINK', 'http://example.com/reset_password.php');\n\n// Database connection\n$conn = mysqli_connect(\"localhost\", \"username\", \"password\", \"database\");\n\nif (mysqli_connect_error()) {\n    die(\"Connection failed: \" . mysqli_connect_error());\n}\n\nfunction sendEmail($email, $token) {\n    $subject = \"Reset Password\";\n    $message = \"Click the link below to reset your password:\\n\" . EMAIL_PASSWORD_RESET_LINK . \"?token=\" . $token;\n    $headers = \"From: \" . EMAIL_SENDER . \"\\r\\n\";\n    \n    mail($email, $subject, $message, $headers);\n}\n\n// Check if form has been submitted\nif (isset($_POST['recover_password'])) {\n    // Get the email address from the input field\n    $email = $_POST['email'];\n    \n    // Query to check if the user exists in the database\n    $sql = \"SELECT * FROM users WHERE email = '$email'\";\n    $result = mysqli_query($conn, $sql);\n    \n    if (mysqli_num_rows($result) > 0) {\n        // Get the token for this user\n        $token = md5(uniqid(rand(), true));\n        \n        // Insert the token into the database\n        $sql = \"UPDATE users SET password_token = '$token' WHERE email = '$email'\";\n        mysqli_query($conn, $sql);\n        \n        // Send an email to the user with a reset link\n        sendEmail($email, $token);\n        \n        echo \"A password recovery email has been sent to your inbox.\";\n    } else {\n        echo \"No account exists with this email address.\";\n    }\n}\n\n?>\n\n<form action=\"\" method=\"post\">\n    <input type=\"email\" name=\"email\" placeholder=\"Enter your email address\"><br>\n    <input type=\"submit\" name=\"recover_password\" value=\"Recover Password\">\n</form>\n```\n\n**reset_password.php**\n\n```php\n<?php\n\n// Configuration settings\ndefine('EMAIL_SENDER', 'your_email@example.com');\n\n// Database connection\n$conn = mysqli_connect(\"localhost\", \"username\", \"password\", \"database\");\n\nif (mysqli_connect_error()) {\n    die(\"Connection failed: \" . mysqli_connect_error());\n}\n\nfunction verifyToken($token) {\n    // Query to check if the token exists in the database\n    $sql = \"SELECT * FROM users WHERE password_token = '$token'\";\n    $result = mysqli_query($conn, $sql);\n    \n    if (mysqli_num_rows($result) > 0) {\n        return true;\n    } else {\n        return false;\n    }\n}\n\n// Check if form has been submitted\nif (isset($_POST['reset_password'])) {\n    // Get the token from the input field\n    $token = $_POST['token'];\n    \n    // Verify the token\n    if (!verifyToken($token)) {\n        echo \"Invalid token.\";\n    } else {\n        // Reset password code here...\n        \n        // Query to update the password in the database\n        $sql = \"UPDATE users SET password_token = NULL, password = '$new_password' WHERE password_token = '$token'\";\n        mysqli_query($conn, $sql);\n        \n        echo \"Your password has been successfully reset.\";\n    }\n}\n\n?>\n\n<form action=\"\" method=\"post\">\n    <input type=\"text\" name=\"token\" value=\"<?php echo $_GET['token']; ?>\" style=\"display: none\"><br>\n    <input type=\"password\" name=\"new_password\" placeholder=\"Enter your new password\"><br>\n    <input type=\"submit\" name=\"reset_password\" value=\"Reset Password\">\n</form>\n```\n\n**Note**: \n\n*   Make sure to replace `\"localhost\"`, `\"username\"`, `\"password\"`, and `\"database\"` with your actual database connection settings.\n*   Also, make sure the email sending part is working properly. This example uses a very basic `mail()` function which might not work on all servers (especially those that do not have a mail server installed).\n*   You should also hash and store passwords securely in your user table using a library like `password_hash()`.\n\nRemember to add security measures such as email verification and password reset token expiration to prevent abuse.", "code_blocks": ["```php\n<?php\n\n// Configuration settings\ndefine('EMAIL_SENDER', 'your_email@example.com');\ndefine('EMAIL_PASSWORD_RESET_LINK', 'http://example.com/reset_password.php');\n\n// Database connection\n$conn = mysqli_connect(\"localhost\", \"username\", \"password\", \"database\");\n\nif (mysqli_connect_error()) {\n    die(\"Connection failed: \" . mysqli_connect_error());\n}\n\nfunction sendEmail($email, $token) {\n    $subject = \"Reset Password\";\n    $message = \"Click the link below to reset your password:\\n\" . EMAIL_PASSWORD_RESET_LINK . \"?token=\" . $token;\n    $headers = \"From: \" . EMAIL_SENDER . \"\\r\\n\";\n    \n    mail($email, $subject, $message, $headers);\n}\n\n// Check if form has been submitted\nif (isset($_POST['recover_password'])) {\n    // Get the email address from the input field\n    $email = $_POST['email'];\n    \n    // Query to check if the user exists in the database\n    $sql = \"SELECT * FROM users WHERE email = '$email'\";\n    $result = mysqli_query($conn, $sql);\n    \n    if (mysqli_num_rows($result) > 0) {\n        // Get the token for this user\n        $token = md5(uniqid(rand(), true));\n        \n        // Insert the token into the database\n        $sql = \"UPDATE users SET password_token = '$token' WHERE email = '$email'\";\n        mysqli_query($conn, $sql);\n        \n        // Send an email to the user with a reset link\n        sendEmail($email, $token);\n        \n        echo \"A password recovery email has been sent to your inbox.\";\n    } else {\n        echo \"No account exists with this email address.\";\n    }\n}\n\n?>\n\n<form action=\"\" method=\"post\">\n    <input type=\"email\" name=\"email\" placeholder=\"Enter your email address\"><br>\n    <input type=\"submit\" name=\"recover_password\" value=\"Recover Password\">\n</form>\n```", "```php\n<?php\n\n// Configuration settings\ndefine('EMAIL_SENDER', 'your_email@example.com');\n\n// Database connection\n$conn = mysqli_connect(\"localhost\", \"username\", \"password\", \"database\");\n\nif (mysqli_connect_error()) {\n    die(\"Connection failed: \" . mysqli_connect_error());\n}\n\nfunction verifyToken($token) {\n    // Query to check if the token exists in the database\n    $sql = \"SELECT * FROM users WHERE password_token = '$token'\";\n    $result = mysqli_query($conn, $sql);\n    \n    if (mysqli_num_rows($result) > 0) {\n        return true;\n    } else {\n        return false;\n    }\n}\n\n// Check if form has been submitted\nif (isset($_POST['reset_password'])) {\n    // Get the token from the input field\n    $token = $_POST['token'];\n    \n    // Verify the token\n    if (!verifyToken($token)) {\n        echo \"Invalid token.\";\n    } else {\n        // Reset password code here...\n        \n        // Query to update the password in the database\n        $sql = \"UPDATE users SET password_token = NULL, password = '$new_password' WHERE password_token = '$token'\";\n        mysqli_query($conn, $sql);\n        \n        echo \"Your password has been successfully reset.\";\n    }\n}\n\n?>\n\n<form action=\"\" method=\"post\">\n    <input type=\"text\" name=\"token\" value=\"<?php echo $_GET['token']; ?>\" style=\"display: none\"><br>\n    <input type=\"password\" name=\"new_password\" placeholder=\"Enter your new password\"><br>\n    <input type=\"submit\" name=\"reset_password\" value=\"Reset Password\">\n</form>\n```"]}
