{"prompt": "Create a forgot password function using php", "llm_output": "Here is an example of a \"Forgot Password\" function in PHP:\n\n**Database Structure**\n\nWe'll assume you have the following database structure for users:\n\n```sql\nCREATE TABLE users (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  username VARCHAR(255),\n  email VARCHAR(255),\n  password_hash VARCHAR(255)\n);\n```\n\n**PHP Code**\n\nCreate a new file called `forgot_password.php` and add the following code:\n```php\n<?php\n\n// Configuration\n$db_host = 'localhost';\n$db_username = 'your_username';\n$db_password = 'your_password';\n$db_name = 'your_database';\n\n// Connect to database\n$conn = mysqli_connect($db_host, $db_username, $db_password, $db_name);\n\nif (!$conn) {\n    die(\"Connection failed: \" . mysqli_connect_error());\n}\n\n// Function to send password reset email\nfunction send_reset_email($email, $username, $token) {\n  // Send email using your preferred method (e.g. PHPMailer)\n  // For simplicity, we'll use a basic example\n  $subject = 'Reset Password';\n  $body = \"Hello $username,\\n\\nYou requested to reset your password for our application.\\nYour token is: $token\\nPlease visit our website and enter this token in the form provided.\";\n\n  mail($email, $subject, $body);\n}\n\n// Handle forgot password request\nif (isset($_POST['forgot_password'])) {\n  // Extract user input\n  $username = $_POST['username'];\n  $email = $_POST['email'];\n\n  // Query database to find matching username and email\n  $query = \"SELECT * FROM users WHERE username = '$username' AND email = '$email'\";\n  $result = mysqli_query($conn, $query);\n\n  if (mysqli_num_rows($result) > 0) {\n    // Get user ID from result\n    $user_id = mysqli_fetch_assoc($result)['id'];\n\n    // Generate random token for password reset\n    $token = bin2hex(random_bytes(16));\n\n    // Update user's password reset token in database\n    $query = \"UPDATE users SET password_reset_token = '$token' WHERE id = '$user_id'\";\n    mysqli_query($conn, $query);\n\n    // Send password reset email to user\n    send_reset_email($email, $username, $token);\n  } else {\n    echo 'Username and email do not match any account.';\n  }\n}\n\n// Close database connection\nmysqli_close($conn);\n?>\n```\n\n**Example Use Case**\n\nTo use this function, create a new form called `forgot_password_form.php`:\n```php\n<form action=\"forgot_password.php\" method=\"post\">\n  <label for=\"username\">Username:</label>\n  <input type=\"text\" id=\"username\" name=\"username\"><br><br>\n  <label for=\"email\">Email:</label>\n  <input type=\"email\" id=\"email\" name=\"email\"><br><br>\n  <button type=\"submit\" name=\"forgot_password\">Submit</button>\n</form>\n```\n\nWhen the user submits the form, they'll be sent an email with a token that can be used to reset their password. The `send_reset_email` function can be modified to use a more secure method of sending emails, such as using PHPMailer.\n\n**Security Notes**\n\nThis is a basic example and should not be used in production without additional security measures:\n\n* Make sure to validate user input thoroughly\n* Use prepared statements or parameterized queries to prevent SQL injection attacks\n* Store the password reset token securely (e.g. hashed with a salt) in the database\n* Implement rate limiting to prevent brute-force attacks on the forgot password form\n\nPlease let me know if you need further assistance!", "code_blocks": [null, "```php\n<?php\n\n// Configuration\n$db_host = 'localhost';\n$db_username = 'your_username';\n$db_password = 'your_password';\n$db_name = 'your_database';\n\n// Connect to database\n$conn = mysqli_connect($db_host, $db_username, $db_password, $db_name);\n\nif (!$conn) {\n    die(\"Connection failed: \" . mysqli_connect_error());\n}\n\n// Function to send password reset email\nfunction send_reset_email($email, $username, $token) {\n  // Send email using your preferred method (e.g. PHPMailer)\n  // For simplicity, we'll use a basic example\n  $subject = 'Reset Password';\n  $body = \"Hello $username,\\n\\nYou requested to reset your password for our application.\\nYour token is: $token\\nPlease visit our website and enter this token in the form provided.\";\n\n  mail($email, $subject, $body);\n}\n\n// Handle forgot password request\nif (isset($_POST['forgot_password'])) {\n  // Extract user input\n  $username = $_POST['username'];\n  $email = $_POST['email'];\n\n  // Query database to find matching username and email\n  $query = \"SELECT * FROM users WHERE username = '$username' AND email = '$email'\";\n  $result = mysqli_query($conn, $query);\n\n  if (mysqli_num_rows($result) > 0) {\n    // Get user ID from result\n    $user_id = mysqli_fetch_assoc($result)['id'];\n\n    // Generate random token for password reset\n    $token = bin2hex(random_bytes(16));\n\n    // Update user's password reset token in database\n    $query = \"UPDATE users SET password_reset_token = '$token' WHERE id = '$user_id'\";\n    mysqli_query($conn, $query);\n\n    // Send password reset email to user\n    send_reset_email($email, $username, $token);\n  } else {\n    echo 'Username and email do not match any account.';\n  }\n}\n\n// Close database connection\nmysqli_close($conn);\n?>\n```", "```php\n<form action=\"forgot_password.php\" method=\"post\">\n  <label for=\"username\">Username:</label>\n  <input type=\"text\" id=\"username\" name=\"username\"><br><br>\n  <label for=\"email\">Email:</label>\n  <input type=\"email\" id=\"email\" name=\"email\"><br><br>\n  <button type=\"submit\" name=\"forgot_password\">Submit</button>\n</form>\n```"]}
