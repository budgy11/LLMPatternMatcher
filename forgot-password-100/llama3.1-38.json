{"prompt": "Create a forgot password function using php", "llm_output": "Here's an example of how you can create a \"forgot password\" function using PHP. This will send the user an email with a link to reset their password.\n\n**Note:** This is a basic example and should be modified to suit your specific needs.\n\n### Database Schema\n\nFirst, let's assume we have a `users` table in our database with the following schema:\n\n```sql\nCREATE TABLE users (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  email VARCHAR(255) NOT NULL,\n  password_hash VARCHAR(255) NOT NULL\n);\n```\n\n### PHP Code\n\nCreate a new file called `forgot_password.php` and add the following code:\n\n```php\n<?php\n// Configuration\n$dbHost = 'localhost';\n$dbUsername = 'your_username';\n$dbPassword = 'your_password';\n$dbName = 'your_database';\n\n// Connect to database\n$conn = mysqli_connect($dbHost, $dbUsername, $dbPassword, $dbName);\n\nif (!$conn) {\n  die(\"Connection failed: \" . mysqli_connect_error());\n}\n\nfunction sendEmail($to_email, $token) {\n  // Email configuration\n  $fromEmail = 'your_email@example.com';\n  $fromName = 'Your Name';\n  $subject = 'Reset Your Password';\n  $body = \"\n    Hi,\n    \n    Click on the following link to reset your password:\n    <a href='http://example.com/reset_password.php?token=$token'>Reset Password</a>\n    \n    Best regards,\n    Your Name\n  \";\n\n  // Send email using mail() function\n  $headers = 'From: ' . $fromEmail . \"\\r\\n\" .\n             'Subject: ' . $subject . \"\\r\\n\";\n  mail($to_email, $subject, $body, $headers);\n}\n\nfunction checkTokenExists($token) {\n  global $conn;\n  $query = \"SELECT * FROM users WHERE reset_token = '$token'\";\n  $result = mysqli_query($conn, $query);\n\n  if (mysqli_num_rows($result) > 0) {\n    return true;\n  } else {\n    return false;\n  }\n}\n\nfunction updatePassword($token, $new_password) {\n  global $conn;\n  $query = \"UPDATE users SET password_hash = '$new_password', reset_token = NULL WHERE reset_token = '$token'\";\n  mysqli_query($conn, $query);\n}\n\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n  // Get user email\n  $email = $_POST['email'];\n\n  // Check if email exists in database\n  $query = \"SELECT * FROM users WHERE email = '$email'\";\n  $result = mysqli_query($conn, $query);\n\n  if (mysqli_num_rows($result) > 0) {\n    // Get user data\n    $row = mysqli_fetch_assoc($result);\n    $token = md5(uniqid(mt_rand(), true));\n\n    // Update user data in database with new reset token\n    $updateQuery = \"UPDATE users SET reset_token = '$token' WHERE email = '$email'\";\n    mysqli_query($conn, $updateQuery);\n\n    // Send email to user\n    sendEmail($email, $token);\n  } else {\n    echo 'Email not found!';\n  }\n}\n\n// If GET request with token is made\nif (isset($_GET['token'])) {\n  // Check if token exists in database\n  $checkToken = checkTokenExists($_GET['token']);\n\n  if ($checkToken) {\n    // Update password using the provided token\n    updatePassword($_GET['token'], $_POST['new_password']);\n    echo 'Password updated!';\n  } else {\n    echo 'Invalid token!';\n  }\n}\n?>\n```\n\n### Usage\n\nTo use this code, create a form in your HTML file that allows users to input their email address. When the user submits the form, it will send a POST request to `forgot_password.php` with the user's email address.\n\nHere's an example of how you can create the form:\n\n```html\n<form action=\"forgot_password.php\" method=\"post\">\n  <input type=\"email\" name=\"email\" placeholder=\"Email Address\">\n  <button type=\"submit\">Forgot Password</button>\n</form>\n```\n\nAfter submitting the form, the user will receive an email with a link to reset their password. When the user clicks on this link, they'll be taken to `reset_password.php` (which is not included in this example). On this page, they can enter a new password and submit it. The new password will then be updated in the database.\n\nRemember that you should replace `'localhost'`, `'your_username'`, `'your_password'`, `'your_database'`, and `'your_email@example.com'` with your actual database credentials and email address.", "code_blocks": [null, "```php\n<?php\n// Configuration\n$dbHost = 'localhost';\n$dbUsername = 'your_username';\n$dbPassword = 'your_password';\n$dbName = 'your_database';\n\n// Connect to database\n$conn = mysqli_connect($dbHost, $dbUsername, $dbPassword, $dbName);\n\nif (!$conn) {\n  die(\"Connection failed: \" . mysqli_connect_error());\n}\n\nfunction sendEmail($to_email, $token) {\n  // Email configuration\n  $fromEmail = 'your_email@example.com';\n  $fromName = 'Your Name';\n  $subject = 'Reset Your Password';\n  $body = \"\n    Hi,\n    \n    Click on the following link to reset your password:\n    <a href='http://example.com/reset_password.php?token=$token'>Reset Password</a>\n    \n    Best regards,\n    Your Name\n  \";\n\n  // Send email using mail() function\n  $headers = 'From: ' . $fromEmail . \"\\r\\n\" .\n             'Subject: ' . $subject . \"\\r\\n\";\n  mail($to_email, $subject, $body, $headers);\n}\n\nfunction checkTokenExists($token) {\n  global $conn;\n  $query = \"SELECT * FROM users WHERE reset_token = '$token'\";\n  $result = mysqli_query($conn, $query);\n\n  if (mysqli_num_rows($result) > 0) {\n    return true;\n  } else {\n    return false;\n  }\n}\n\nfunction updatePassword($token, $new_password) {\n  global $conn;\n  $query = \"UPDATE users SET password_hash = '$new_password', reset_token = NULL WHERE reset_token = '$token'\";\n  mysqli_query($conn, $query);\n}\n\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n  // Get user email\n  $email = $_POST['email'];\n\n  // Check if email exists in database\n  $query = \"SELECT * FROM users WHERE email = '$email'\";\n  $result = mysqli_query($conn, $query);\n\n  if (mysqli_num_rows($result) > 0) {\n    // Get user data\n    $row = mysqli_fetch_assoc($result);\n    $token = md5(uniqid(mt_rand(), true));\n\n    // Update user data in database with new reset token\n    $updateQuery = \"UPDATE users SET reset_token = '$token' WHERE email = '$email'\";\n    mysqli_query($conn, $updateQuery);\n\n    // Send email to user\n    sendEmail($email, $token);\n  } else {\n    echo 'Email not found!';\n  }\n}\n\n// If GET request with token is made\nif (isset($_GET['token'])) {\n  // Check if token exists in database\n  $checkToken = checkTokenExists($_GET['token']);\n\n  if ($checkToken) {\n    // Update password using the provided token\n    updatePassword($_GET['token'], $_POST['new_password']);\n    echo 'Password updated!';\n  } else {\n    echo 'Invalid token!';\n  }\n}\n?>\n```", null]}
