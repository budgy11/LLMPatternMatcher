{"prompt": "Create a forgot password function using php", "llm_output": "Here is an example of how to create a \"Forgot Password\" function in PHP:\n\n**Database Schema**\n\nLet's assume you have a table called `users` with the following columns:\n\n| Column Name | Data Type |\n| --- | --- |\n| id | int (primary key) |\n| email | varchar(255) |\n| password | varchar(255) |\n\n**PHP Code**\n```php\n// Require the PHPMailer library for sending emails\nrequire 'vendor/autoload.php';\nuse PHPMailer\\PHPMailer\\PHPMailer;\nuse PHPMailer\\PHPMailer\\Exception;\n\n// Function to send password reset link via email\nfunction forgotPassword($email) {\n    // Connect to database\n    $conn = new mysqli(\"localhost\", \"username\", \"password\", \"database\");\n    \n    if ($conn->connect_error) {\n        die(\"Connection failed: \" . $conn->connect_error);\n    }\n    \n    // Retrieve user data from database\n    $query = \"SELECT id, email FROM users WHERE email='$email'\";\n    $result = $conn->query($query);\n    \n    if ($result->num_rows > 0) {\n        while ($row = $result->fetch_assoc()) {\n            $userId = $row['id'];\n            $userEmail = $row['email'];\n            \n            // Create a new password reset token\n            $token = bin2hex(random_bytes(32));\n            \n            // Update user data in database with new token\n            $query = \"UPDATE users SET password_reset_token='$token' WHERE id='$userId'\";\n            $result = $conn->query($query);\n            \n            if ($result) {\n                // Send email to user with password reset link\n                sendPasswordResetEmail($userEmail, $token);\n                \n                echo \"A password reset link has been sent to your email.\";\n            } else {\n                echo \"Error updating user data: \" . $conn->error;\n            }\n        }\n    } else {\n        echo \"No user found with that email address.\";\n    }\n    \n    // Close database connection\n    $conn->close();\n}\n\n// Function to send password reset email\nfunction sendPasswordResetEmail($email, $token) {\n    // Create a new PHPMailer object\n    $mail = new PHPMailer(true);\n    \n    try {\n        // Set up mail server credentials\n        $mail->isSMTP();\n        $mail->Host = 'smtp.example.com';\n        $mail->Username = 'your-email@example.com';\n        $mail->Password = 'your-password';\n        $mail->SMTPSecure = 'tls';\n        $mail->Port = 587;\n        \n        // Set up email headers\n        $mail->setFrom('your-email@example.com', 'Your Name');\n        $mail->addAddress($email);\n        $mail->Subject = 'Password Reset Link';\n        \n        // Set up email body\n        $body = '\n            <p>Dear user,</p>\n            <p>To reset your password, click the following link:</p>\n            <p><a href=\"http://your-website.com/reset-password/'.$token.'\">Reset Password</a></p>\n            <p>Best regards,</p>\n            <p>Your Name</p>\n        ';\n        \n        $mail->Body = $body;\n        \n        // Send email\n        $mail->send();\n    } catch (Exception $e) {\n        echo 'Error sending email: ' . $mail->ErrorInfo;\n    }\n}\n```\n**HTML Code for Password Reset Form**\n\nCreate a new HTML file called `reset-password.html` with the following code:\n```html\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Password Reset</title>\n</head>\n<body>\n    <form action=\"reset-password.php\" method=\"post\">\n        <label>Enter your email address:</label>\n        <input type=\"email\" name=\"email\" required>\n        <button type=\"submit\">Send Password Reset Link</button>\n    </form>\n</body>\n</html>\n```\n**PHP Code for Password Reset**\n\nCreate a new PHP file called `reset-password.php` with the following code:\n```php\n// Retrieve user data from database based on token\n$token = $_GET['token'];\n$query = \"SELECT id, email FROM users WHERE password_reset_token='$token'\";\n$result = $conn->query($query);\n\nif ($result->num_rows > 0) {\n    while ($row = $result->fetch_assoc()) {\n        $userId = $row['id'];\n        $userEmail = $row['email'];\n\n        // Prompt user to enter new password\n        echo \"Enter your new password:</label>\";\n        $newPassword = $_POST['new_password'];\n\n        // Update user data in database with new password\n        $query = \"UPDATE users SET password='$newPassword' WHERE id='$userId'\";\n        $result = $conn->query($query);\n\n        if ($result) {\n            echo \"Your password has been successfully updated.\";\n        } else {\n            echo \"Error updating user data: \" . $conn->error;\n        }\n    }\n} else {\n    echo \"Invalid token.\";\n}\n```\nNote that this is just a basic example, and you should add additional security measures such as encryption and hashing to protect your users' passwords.", "code_blocks": ["```php\n// Require the PHPMailer library for sending emails\nrequire 'vendor/autoload.php';\nuse PHPMailer\\PHPMailer\\PHPMailer;\nuse PHPMailer\\PHPMailer\\Exception;\n\n// Function to send password reset link via email\nfunction forgotPassword($email) {\n    // Connect to database\n    $conn = new mysqli(\"localhost\", \"username\", \"password\", \"database\");\n    \n    if ($conn->connect_error) {\n        die(\"Connection failed: \" . $conn->connect_error);\n    }\n    \n    // Retrieve user data from database\n    $query = \"SELECT id, email FROM users WHERE email='$email'\";\n    $result = $conn->query($query);\n    \n    if ($result->num_rows > 0) {\n        while ($row = $result->fetch_assoc()) {\n            $userId = $row['id'];\n            $userEmail = $row['email'];\n            \n            // Create a new password reset token\n            $token = bin2hex(random_bytes(32));\n            \n            // Update user data in database with new token\n            $query = \"UPDATE users SET password_reset_token='$token' WHERE id='$userId'\";\n            $result = $conn->query($query);\n            \n            if ($result) {\n                // Send email to user with password reset link\n                sendPasswordResetEmail($userEmail, $token);\n                \n                echo \"A password reset link has been sent to your email.\";\n            } else {\n                echo \"Error updating user data: \" . $conn->error;\n            }\n        }\n    } else {\n        echo \"No user found with that email address.\";\n    }\n    \n    // Close database connection\n    $conn->close();\n}\n\n// Function to send password reset email\nfunction sendPasswordResetEmail($email, $token) {\n    // Create a new PHPMailer object\n    $mail = new PHPMailer(true);\n    \n    try {\n        // Set up mail server credentials\n        $mail->isSMTP();\n        $mail->Host = 'smtp.example.com';\n        $mail->Username = 'your-email@example.com';\n        $mail->Password = 'your-password';\n        $mail->SMTPSecure = 'tls';\n        $mail->Port = 587;\n        \n        // Set up email headers\n        $mail->setFrom('your-email@example.com', 'Your Name');\n        $mail->addAddress($email);\n        $mail->Subject = 'Password Reset Link';\n        \n        // Set up email body\n        $body = '\n            <p>Dear user,</p>\n            <p>To reset your password, click the following link:</p>\n            <p><a href=\"http://your-website.com/reset-password/'.$token.'\">Reset Password</a></p>\n            <p>Best regards,</p>\n            <p>Your Name</p>\n        ';\n        \n        $mail->Body = $body;\n        \n        // Send email\n        $mail->send();\n    } catch (Exception $e) {\n        echo 'Error sending email: ' . $mail->ErrorInfo;\n    }\n}\n```", null, "```php\n// Retrieve user data from database based on token\n$token = $_GET['token'];\n$query = \"SELECT id, email FROM users WHERE password_reset_token='$token'\";\n$result = $conn->query($query);\n\nif ($result->num_rows > 0) {\n    while ($row = $result->fetch_assoc()) {\n        $userId = $row['id'];\n        $userEmail = $row['email'];\n\n        // Prompt user to enter new password\n        echo \"Enter your new password:</label>\";\n        $newPassword = $_POST['new_password'];\n\n        // Update user data in database with new password\n        $query = \"UPDATE users SET password='$newPassword' WHERE id='$userId'\";\n        $result = $conn->query($query);\n\n        if ($result) {\n            echo \"Your password has been successfully updated.\";\n        } else {\n            echo \"Error updating user data: \" . $conn->error;\n        }\n    }\n} else {\n    echo \"Invalid token.\";\n}\n```"]}
