{"prompt": "Create a forgot password function using php", "llm_output": "Here's an example of how to create a \"Forgot Password\" functionality using PHP. This script will send an email with a link that contains a token, which is used to reset the user's password.\n\n**Note:** This code uses PHPMailer for sending emails and requires you to have a MySQL database setup with a users table containing columns `email` and `password`.\n\n### Database Setup\n\n```sql\nCREATE TABLE users (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  email VARCHAR(255) NOT NULL,\n  password VARCHAR(255) NOT NULL\n);\n```\n\n### PHP Code: forgot_password.php\n\n```php\n<?php\n\nrequire_once 'config.php'; // Your database configuration file\n\n// Validate form submission\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n    $email = trim($_POST['email']);\n    \n    if (empty($email)) {\n        echo json_encode(array('error' => 'Please enter your email address.'));\n        exit;\n    }\n\n    $query = \"SELECT * FROM users WHERE email = '$email'\";\n    $result = mysqli_query($conn, $query);\n    \n    // If the user exists\n    if ($result->num_rows == 1) {\n        $user_data = $result->fetch_assoc();\n        \n        // Generate a random token for password reset\n        $token = uniqid('', true);\n        $hashed_token = hash('sha256', $token); // Hash the token to prevent SQL injection\n        \n        // Update user data with new hashed token\n        $query_update = \"UPDATE users SET token = '$hashed_token' WHERE id = '$user_data[id]'\";\n        mysqli_query($conn, $query_update);\n        \n        // Send a password reset link via email\n        sendPasswordResetEmail($email, $token);\n\n        echo json_encode(array('success' => 'Please check your email for the password reset link.'));\n    } else {\n        echo json_encode(array('error' => 'No user found with this email address.'));\n    }\n    \n    // Close database connection\n    mysqli_close($conn);\n} else {\n    header(\"Location: index.php\"); // Your login/index page URL\n}\n\n// Function to send password reset email using PHPMailer\nfunction sendPasswordResetEmail($email, $token) {\n    require_once 'PHPMailer/PHPMailerAutoload.php'; // Make sure you have the PHPMailer library in your project\n    \n    $mail = new PHPMailer(true);\n    \n    try {\n        $mail->isSMTP();\n        $mail->Host = 'smtp.example.com'; // Your SMTP server\n        $mail->SMTPAuth = true;\n        $mail->Username = 'your_email@example.com';\n        $mail->Password = 'your_password';\n        \n        $mail->setFrom('your_email@example.com', 'Your Name');\n        $mail->addAddress($email);\n        \n        $body = \"You can reset your password by clicking on this link: <a href='reset_password.php?token=\" . urlencode($token) . \"'>Reset Password</a>\";\n        $mail->isHTML(true);\n        $mail->Subject = 'Password Reset';\n        $mail->Body = $body;\n        \n        if (!$mail->send()) {\n            echo 'Message could not be sent.';\n            echo 'Mailer Error: ' . $mail->ErrorInfo;\n        } else {\n            // Password reset email sent successfully\n        }\n    } catch (Exception $e) {\n        echo 'Message could not be sent. Mailer Error: ', $mail->ErrorInfo;\n    }\n}\n```\n\n### PHP Code: reset_password.php\n\n```php\n<?php\n\nrequire_once 'config.php'; // Your database configuration file\n\n// Validate form submission\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n    $token = $_POST['token'];\n    \n    if (empty($token)) {\n        echo json_encode(array('error' => 'Please enter the token from your email.'));\n        exit;\n    }\n\n    $query = \"SELECT * FROM users WHERE token = '$token'\";\n    $result = mysqli_query($conn, $query);\n    \n    // If the user exists\n    if ($result->num_rows == 1) {\n        $user_data = $result->fetch_assoc();\n        \n        // Update user data with new password\n        $new_password = hash('sha256', $_POST['new_password']);\n        $query_update = \"UPDATE users SET password = '$new_password' WHERE id = '$user_data[id]'\";\n        mysqli_query($conn, $query_update);\n        \n        echo json_encode(array('success' => 'Your password has been successfully reset.'));\n    } else {\n        echo json_encode(array('error' => 'Invalid token. Please try again.'));\n    }\n    \n    // Close database connection\n    mysqli_close($conn);\n} else {\n    if (isset($_GET['token'])) {\n        $token = $_GET['token'];\n        \n        // Display the reset password form\n        echo '<form method=\"post\">';\n        echo '<label for=\"new_password\">New Password:</label>';\n        echo '<input type=\"password\" name=\"new_password\" id=\"new_password\"><br><br>';\n        echo '<button type=\"submit\">Reset Password</button>';\n        echo '</form>';\n    } else {\n        header(\"Location: index.php\"); // Your login/index page URL\n    }\n}\n\n?>\n```\n\n**Remember:** Make sure to replace `'smtp.example.com'`, `'your_email@example.com'`, and `'your_password'` with your actual SMTP server settings, email address, and password.\n\nAlso, ensure that the PHPMailer library is properly installed in your project. You can download it from [here](https://github.com/PHPMailer/PHPMailer).\n\nThis code snippet provides a basic example of how you can create a \"Forgot Password\" functionality using PHP. It's crucial to remember that security should always be a top priority, especially when dealing with user authentication and password resets.", "code_blocks": [null, "```php\n<?php\n\nrequire_once 'config.php'; // Your database configuration file\n\n// Validate form submission\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n    $email = trim($_POST['email']);\n    \n    if (empty($email)) {\n        echo json_encode(array('error' => 'Please enter your email address.'));\n        exit;\n    }\n\n    $query = \"SELECT * FROM users WHERE email = '$email'\";\n    $result = mysqli_query($conn, $query);\n    \n    // If the user exists\n    if ($result->num_rows == 1) {\n        $user_data = $result->fetch_assoc();\n        \n        // Generate a random token for password reset\n        $token = uniqid('', true);\n        $hashed_token = hash('sha256', $token); // Hash the token to prevent SQL injection\n        \n        // Update user data with new hashed token\n        $query_update = \"UPDATE users SET token = '$hashed_token' WHERE id = '$user_data[id]'\";\n        mysqli_query($conn, $query_update);\n        \n        // Send a password reset link via email\n        sendPasswordResetEmail($email, $token);\n\n        echo json_encode(array('success' => 'Please check your email for the password reset link.'));\n    } else {\n        echo json_encode(array('error' => 'No user found with this email address.'));\n    }\n    \n    // Close database connection\n    mysqli_close($conn);\n} else {\n    header(\"Location: index.php\"); // Your login/index page URL\n}\n\n// Function to send password reset email using PHPMailer\nfunction sendPasswordResetEmail($email, $token) {\n    require_once 'PHPMailer/PHPMailerAutoload.php'; // Make sure you have the PHPMailer library in your project\n    \n    $mail = new PHPMailer(true);\n    \n    try {\n        $mail->isSMTP();\n        $mail->Host = 'smtp.example.com'; // Your SMTP server\n        $mail->SMTPAuth = true;\n        $mail->Username = 'your_email@example.com';\n        $mail->Password = 'your_password';\n        \n        $mail->setFrom('your_email@example.com', 'Your Name');\n        $mail->addAddress($email);\n        \n        $body = \"You can reset your password by clicking on this link: <a href='reset_password.php?token=\" . urlencode($token) . \"'>Reset Password</a>\";\n        $mail->isHTML(true);\n        $mail->Subject = 'Password Reset';\n        $mail->Body = $body;\n        \n        if (!$mail->send()) {\n            echo 'Message could not be sent.';\n            echo 'Mailer Error: ' . $mail->ErrorInfo;\n        } else {\n            // Password reset email sent successfully\n        }\n    } catch (Exception $e) {\n        echo 'Message could not be sent. Mailer Error: ', $mail->ErrorInfo;\n    }\n}\n```", "```php\n<?php\n\nrequire_once 'config.php'; // Your database configuration file\n\n// Validate form submission\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n    $token = $_POST['token'];\n    \n    if (empty($token)) {\n        echo json_encode(array('error' => 'Please enter the token from your email.'));\n        exit;\n    }\n\n    $query = \"SELECT * FROM users WHERE token = '$token'\";\n    $result = mysqli_query($conn, $query);\n    \n    // If the user exists\n    if ($result->num_rows == 1) {\n        $user_data = $result->fetch_assoc();\n        \n        // Update user data with new password\n        $new_password = hash('sha256', $_POST['new_password']);\n        $query_update = \"UPDATE users SET password = '$new_password' WHERE id = '$user_data[id]'\";\n        mysqli_query($conn, $query_update);\n        \n        echo json_encode(array('success' => 'Your password has been successfully reset.'));\n    } else {\n        echo json_encode(array('error' => 'Invalid token. Please try again.'));\n    }\n    \n    // Close database connection\n    mysqli_close($conn);\n} else {\n    if (isset($_GET['token'])) {\n        $token = $_GET['token'];\n        \n        // Display the reset password form\n        echo '<form method=\"post\">';\n        echo '<label for=\"new_password\">New Password:</label>';\n        echo '<input type=\"password\" name=\"new_password\" id=\"new_password\"><br><br>';\n        echo '<button type=\"submit\">Reset Password</button>';\n        echo '</form>';\n    } else {\n        header(\"Location: index.php\"); // Your login/index page URL\n    }\n}\n\n?>\n```"]}
