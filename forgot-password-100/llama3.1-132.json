{"prompt": "Create a forgot password function using php", "llm_output": "Here is an example of how to create a \"forgot password\" function in PHP:\n\n**Database Setup:**\n\nAssuming you have a database table named `users` with the following columns:\n```php\nCREATE TABLE users (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  email VARCHAR(255) NOT NULL UNIQUE,\n  password_hash VARCHAR(255) NOT NULL,\n  reset_token VARCHAR(255)\n);\n```\n**Forgot Password Form:**\n\nCreate a form to collect the user's email address:\n```html\n<form action=\"forgot_password.php\" method=\"post\">\n  <input type=\"email\" name=\"email\" placeholder=\"Enter your email address\">\n  <button type=\"submit\">Send Reset Link</button>\n</form>\n```\n**Forgot Password PHP Script:**\n```php\n<?php\n\nrequire_once 'db_connect.php'; // Include database connection script\n\n// Check if form has been submitted\nif (isset($_POST['email'])) {\n  $email = $_POST['email'];\n\n  // Query database to retrieve user's email address\n  $query = \"SELECT * FROM users WHERE email = '$email'\";\n  $result = mysqli_query($conn, $query);\n\n  // Check if user exists\n  if ($result->num_rows > 0) {\n    // Retrieve user data\n    $user_data = $result->fetch_assoc();\n\n    // Generate a reset token\n    $reset_token = bin2hex(random_bytes(32));\n\n    // Update database with new reset token\n    $query = \"UPDATE users SET reset_token = '$reset_token' WHERE email = '$email'\";\n    mysqli_query($conn, $query);\n\n    // Send email to user with reset link\n    send_reset_email($user_data['email'], $reset_token);\n  } else {\n    echo 'Email address not found.';\n  }\n}\n\nfunction send_reset_email($email, $reset_token) {\n  // Define SMTP settings (replace with your own)\n  $smtp_server = 'your_smtp_server';\n  $smtp_port = 587;\n  $from_email = 'your_from_email@example.com';\n\n  // Create email body\n  $subject = 'Reset Your Password';\n  $body = \"Dear User,\nTo reset your password, click on the following link:\n<a href='http://your_website.com/reset_password.php?token=$reset_token'>Reset Password</a>\nBest regards,\nYour Website\";\n\n  // Send email using PHPMailer (or any other library)\n  $mail = new PHPMailer();\n  $mail->isSMTP();\n  $mail->Host     = $smtp_server;\n  $mail->Port     = $smtp_port;\n  $mail->From     = $from_email;\n  $mail->addAddress($email);\n  $mail->Subject  = $subject;\n  $mail->Body     = $body;\n  $mail->AltBody  = '';\n  if (!$mail->send()) {\n    echo 'Error sending email: ' . $mail->ErrorInfo;\n  }\n}\n\n?>\n```\n**Reset Password PHP Script:**\n\nCreate a script to handle password reset:\n```php\n<?php\n\nrequire_once 'db_connect.php'; // Include database connection script\n\n// Check if form has been submitted\nif (isset($_POST['token'])) {\n  $reset_token = $_POST['token'];\n\n  // Query database to retrieve user's data\n  $query = \"SELECT * FROM users WHERE reset_token = '$reset_token'\";\n  $result = mysqli_query($conn, $query);\n\n  // Check if token is valid\n  if ($result->num_rows > 0) {\n    // Retrieve user data\n    $user_data = $result->fetch_assoc();\n\n    // Hash new password\n    $new_password_hash = password_hash($_POST['password'], PASSWORD_DEFAULT);\n\n    // Update database with new password and reset token (null)\n    $query = \"UPDATE users SET password_hash = '$new_password_hash', reset_token = NULL WHERE email = '$user_data[email]'\";\n    mysqli_query($conn, $query);\n  } else {\n    echo 'Invalid token.';\n  }\n}\n\n?>\n```\n**Security Notes:**\n\n* Always validate user input using PHP's built-in functions (e.g., `filter_var` for email validation).\n* Use prepared statements or parameterized queries to prevent SQL injection.\n* Store passwords securely using a library like `password_hash`.\n* Never store passwords in plain text.\n* Implement additional security measures, such as CAPTCHA and IP blocking.\n\nThis example demonstrates how to create a basic \"forgot password\" function. You can enhance it by implementing features like:\n\n* Password expiration\n* Maximum login attempts\n* Two-factor authentication (2FA)\n* Email verification\n\nRemember to adjust the database schema and PHP code according to your specific requirements.", "code_blocks": ["```php\nCREATE TABLE users (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  email VARCHAR(255) NOT NULL UNIQUE,\n  password_hash VARCHAR(255) NOT NULL,\n  reset_token VARCHAR(255)\n);\n```", null, "```php\n<?php\n\nrequire_once 'db_connect.php'; // Include database connection script\n\n// Check if form has been submitted\nif (isset($_POST['email'])) {\n  $email = $_POST['email'];\n\n  // Query database to retrieve user's email address\n  $query = \"SELECT * FROM users WHERE email = '$email'\";\n  $result = mysqli_query($conn, $query);\n\n  // Check if user exists\n  if ($result->num_rows > 0) {\n    // Retrieve user data\n    $user_data = $result->fetch_assoc();\n\n    // Generate a reset token\n    $reset_token = bin2hex(random_bytes(32));\n\n    // Update database with new reset token\n    $query = \"UPDATE users SET reset_token = '$reset_token' WHERE email = '$email'\";\n    mysqli_query($conn, $query);\n\n    // Send email to user with reset link\n    send_reset_email($user_data['email'], $reset_token);\n  } else {\n    echo 'Email address not found.';\n  }\n}\n\nfunction send_reset_email($email, $reset_token) {\n  // Define SMTP settings (replace with your own)\n  $smtp_server = 'your_smtp_server';\n  $smtp_port = 587;\n  $from_email = 'your_from_email@example.com';\n\n  // Create email body\n  $subject = 'Reset Your Password';\n  $body = \"Dear User,\nTo reset your password, click on the following link:\n<a href='http://your_website.com/reset_password.php?token=$reset_token'>Reset Password</a>\nBest regards,\nYour Website\";\n\n  // Send email using PHPMailer (or any other library)\n  $mail = new PHPMailer();\n  $mail->isSMTP();\n  $mail->Host     = $smtp_server;\n  $mail->Port     = $smtp_port;\n  $mail->From     = $from_email;\n  $mail->addAddress($email);\n  $mail->Subject  = $subject;\n  $mail->Body     = $body;\n  $mail->AltBody  = '';\n  if (!$mail->send()) {\n    echo 'Error sending email: ' . $mail->ErrorInfo;\n  }\n}\n\n?>\n```", "```php\n<?php\n\nrequire_once 'db_connect.php'; // Include database connection script\n\n// Check if form has been submitted\nif (isset($_POST['token'])) {\n  $reset_token = $_POST['token'];\n\n  // Query database to retrieve user's data\n  $query = \"SELECT * FROM users WHERE reset_token = '$reset_token'\";\n  $result = mysqli_query($conn, $query);\n\n  // Check if token is valid\n  if ($result->num_rows > 0) {\n    // Retrieve user data\n    $user_data = $result->fetch_assoc();\n\n    // Hash new password\n    $new_password_hash = password_hash($_POST['password'], PASSWORD_DEFAULT);\n\n    // Update database with new password and reset token (null)\n    $query = \"UPDATE users SET password_hash = '$new_password_hash', reset_token = NULL WHERE email = '$user_data[email]'\";\n    mysqli_query($conn, $query);\n  } else {\n    echo 'Invalid token.';\n  }\n}\n\n?>\n```"]}
