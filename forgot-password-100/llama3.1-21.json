{"prompt": "Create a forgot password function using php", "llm_output": "Here is an example of how to create a \"forgot password\" function in PHP:\n\n**Database Schema**\n\nFirst, let's assume we have the following database schema for our users table:\n```sql\nCREATE TABLE users (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  email VARCHAR(255) NOT NULL UNIQUE,\n  password_hash VARCHAR(255) NOT NULL,\n  reset_token VARCHAR(255)\n);\n```\n**PHP Function**\n\nHere is an example of a PHP function that handles the forgot password functionality:\n```php\nfunction forgot_password($email) {\n  // Check if email exists in database\n  $query = \"SELECT * FROM users WHERE email = '$email'\";\n  $result = mysqli_query($conn, $query);\n  \n  if (mysqli_num_rows($result) == 0) {\n    // Email not found\n    return array('error' => 'Email not found');\n  }\n  \n  // Generate a random reset token\n  $reset_token = bin2hex(random_bytes(16));\n  \n  // Update user's reset token in database\n  $query = \"UPDATE users SET reset_token = '$reset_token' WHERE email = '$email'\";\n  mysqli_query($conn, $query);\n  \n  // Send password reset email\n  send_reset_email($email, $reset_token);\n  \n  return array('success' => 'Email sent with password reset link');\n}\n\nfunction send_reset_email($email, $reset_token) {\n  // Set up email headers and body\n  $to = $email;\n  $subject = \"Reset your password\";\n  $body = \"Click this link to reset your password: <a href='http://example.com/reset-password?token=$reset_token'>Reset Password</a>\";\n  \n  // Send email using PHPMailer or a similar library\n  $mail = new PHPMailer();\n  $mail->isSMTP();\n  $mail->Host = 'smtp.example.com';\n  $mail->Port = 587;\n  $mail->SMTPAuth = true;\n  $mail->Username = 'your_email@example.com';\n  $mail->Password = 'your_password';\n  $mail->setFrom('your_email@example.com', 'Your Name');\n  $mail->addAddress($to);\n  $mail->Subject = $subject;\n  $mail->Body = $body;\n  $mail->send();\n}\n```\n**Usage**\n\nTo use this function, simply call it with the user's email address:\n```php\n$email = $_POST['email'];\n$result = forgot_password($email);\n\nif ($result['error']) {\n  echo 'Error: ' . $result['error'];\n} else {\n  echo 'Email sent with password reset link';\n}\n```\n**Security Notes**\n\n* Make sure to validate user input (e.g. email address) to prevent SQL injection attacks.\n* Use a secure method for generating the reset token, such as `random_bytes` or a cryptographically secure pseudorandom number generator.\n* Use HTTPS and a secure protocol for sending the password reset email.\n* Store the reset token in the database securely using a hashed format (e.g. SHA-256).\n* Implement rate limiting to prevent brute-force attacks on the forgot password function.\n\nNote that this is just an example, and you should adapt it to your specific use case and security requirements. Additionally, make sure to follow best practices for coding security, such as input validation and sanitization, authentication, and authorization.", "code_blocks": [null, "```php\nfunction forgot_password($email) {\n  // Check if email exists in database\n  $query = \"SELECT * FROM users WHERE email = '$email'\";\n  $result = mysqli_query($conn, $query);\n  \n  if (mysqli_num_rows($result) == 0) {\n    // Email not found\n    return array('error' => 'Email not found');\n  }\n  \n  // Generate a random reset token\n  $reset_token = bin2hex(random_bytes(16));\n  \n  // Update user's reset token in database\n  $query = \"UPDATE users SET reset_token = '$reset_token' WHERE email = '$email'\";\n  mysqli_query($conn, $query);\n  \n  // Send password reset email\n  send_reset_email($email, $reset_token);\n  \n  return array('success' => 'Email sent with password reset link');\n}\n\nfunction send_reset_email($email, $reset_token) {\n  // Set up email headers and body\n  $to = $email;\n  $subject = \"Reset your password\";\n  $body = \"Click this link to reset your password: <a href='http://example.com/reset-password?token=$reset_token'>Reset Password</a>\";\n  \n  // Send email using PHPMailer or a similar library\n  $mail = new PHPMailer();\n  $mail->isSMTP();\n  $mail->Host = 'smtp.example.com';\n  $mail->Port = 587;\n  $mail->SMTPAuth = true;\n  $mail->Username = 'your_email@example.com';\n  $mail->Password = 'your_password';\n  $mail->setFrom('your_email@example.com', 'Your Name');\n  $mail->addAddress($to);\n  $mail->Subject = $subject;\n  $mail->Body = $body;\n  $mail->send();\n}\n```", "```php\n$email = $_POST['email'];\n$result = forgot_password($email);\n\nif ($result['error']) {\n  echo 'Error: ' . $result['error'];\n} else {\n  echo 'Email sent with password reset link';\n}\n```"]}
