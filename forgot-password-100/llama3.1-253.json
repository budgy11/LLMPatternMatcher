{"prompt": "Create a forgot password function using php", "llm_output": "Here's an example of how to create a \"forgot password\" function in PHP. This script will send an email with a temporary password reset link.\n\n**Note:** Before you start, make sure you have the following setup:\n\n1. MySQL database (or any other RDBMS) with a table for users that has the following fields:\n\t* `id` (auto-incrementing primary key)\n\t* `username`\n\t* `email`\n\t* `password_hash` (using a library like `password_hash`)\n2. PHP mail function configured to send emails\n3. A hosting environment that allows external email sending\n\n**reset_password.php**\n```php\n<?php\n\nrequire_once 'db_config.php'; // database connection settings\nrequire_once 'functions.php'; // password hashing and checking functions\n\nif ($_SERVER['REQUEST_METHOD'] === 'POST') {\n    $username = $_POST['username'];\n    $email = $_POST['email'];\n\n    try {\n        // Get user data from database\n        $query = \"SELECT * FROM users WHERE username = '$username' AND email = '$email'\";\n        $stmt = $pdo->prepare($query);\n        $stmt->execute();\n        $user_data = $stmt->fetch();\n\n        if ($user_data) {\n            // Generate a temporary password reset link\n            $link = generate_reset_link($user_data['id']);\n\n            // Send an email with the link\n            send_email($email, 'Reset Your Password', $link);\n\n            echo \"Email sent successfully. Check your inbox for a link to reset your password.\";\n        } else {\n            echo \"Invalid username or email.\";\n        }\n    } catch (PDOException $e) {\n        echo \"An error occurred: \" . $e->getMessage();\n    }\n\n} else {\n    // Display the form\n?>\n\n<form action=\"\" method=\"post\">\n    <label>Username:</label>\n    <input type=\"text\" name=\"username\"><br><br>\n    <label>Email:</label>\n    <input type=\"email\" name=\"email\"><br><br>\n    <button type=\"submit\">Send Reset Link</button>\n</form>\n\n<?php\n}\n\nfunction generate_reset_link($user_id) {\n    // Generate a random token\n    $token = bin2hex(random_bytes(32));\n\n    // Store the token in the database\n    $query = \"UPDATE users SET reset_token = '$token' WHERE id = '$user_id'\";\n    $stmt = $pdo->prepare($query);\n    $stmt->execute();\n\n    // Return a link to the password reset page with the token as a parameter\n    return 'http://example.com/reset_password.php?token=' . urlencode($token);\n}\n\nfunction send_email($email, $subject, $link) {\n    // Send an email using PHP's mail function or an external library like SwiftMailer\n\n    $headers = \"From: example@example.com\\r\\n\";\n    $headers .= \"MIME-Version: 1.0\\r\\n\";\n    $headers .= \"Content-Type: text/html; charset=UTF-8\\r\\n\";\n\n    $body = \"<html><body>\n                <h1>$subject</h1>\n                Click the link below to reset your password:\n                <a href=\\\"$link\\\">Reset Password</a>\n              </body></html>\";\n\n    mail($email, $subject, $body, $headers);\n}\n```\n**reset_password_form.html**\n```html\n<form action=\"\" method=\"post\">\n    <label>Username:</label>\n    <input type=\"text\" name=\"username\"><br><br>\n    <label>Email:</label>\n    <input type=\"email\" name=\"email\"><br><br>\n    <button type=\"submit\">Send Reset Link</button>\n</form>\n```\nTo use this script, save the above PHP code in a file named `reset_password.php`, and create a new database table with the specified fields. Then, replace the placeholders (`example@example.com`) with your actual email address.\n\n**Security Note:** This is a basic example to illustrate the concept of password reset functionality. In a real-world application, you should take additional security measures such as:\n\n* Hashing and salting passwords\n* Validating user input data (e.g., using prepared statements)\n* Implementing rate limiting for password reset attempts\n* Using a secure email sending library or service\n\nAlso, make sure to test this script thoroughly in a development environment before deploying it to production.", "code_blocks": ["```php\n<?php\n\nrequire_once 'db_config.php'; // database connection settings\nrequire_once 'functions.php'; // password hashing and checking functions\n\nif ($_SERVER['REQUEST_METHOD'] === 'POST') {\n    $username = $_POST['username'];\n    $email = $_POST['email'];\n\n    try {\n        // Get user data from database\n        $query = \"SELECT * FROM users WHERE username = '$username' AND email = '$email'\";\n        $stmt = $pdo->prepare($query);\n        $stmt->execute();\n        $user_data = $stmt->fetch();\n\n        if ($user_data) {\n            // Generate a temporary password reset link\n            $link = generate_reset_link($user_data['id']);\n\n            // Send an email with the link\n            send_email($email, 'Reset Your Password', $link);\n\n            echo \"Email sent successfully. Check your inbox for a link to reset your password.\";\n        } else {\n            echo \"Invalid username or email.\";\n        }\n    } catch (PDOException $e) {\n        echo \"An error occurred: \" . $e->getMessage();\n    }\n\n} else {\n    // Display the form\n?>\n\n<form action=\"\" method=\"post\">\n    <label>Username:</label>\n    <input type=\"text\" name=\"username\"><br><br>\n    <label>Email:</label>\n    <input type=\"email\" name=\"email\"><br><br>\n    <button type=\"submit\">Send Reset Link</button>\n</form>\n\n<?php\n}\n\nfunction generate_reset_link($user_id) {\n    // Generate a random token\n    $token = bin2hex(random_bytes(32));\n\n    // Store the token in the database\n    $query = \"UPDATE users SET reset_token = '$token' WHERE id = '$user_id'\";\n    $stmt = $pdo->prepare($query);\n    $stmt->execute();\n\n    // Return a link to the password reset page with the token as a parameter\n    return 'http://example.com/reset_password.php?token=' . urlencode($token);\n}\n\nfunction send_email($email, $subject, $link) {\n    // Send an email using PHP's mail function or an external library like SwiftMailer\n\n    $headers = \"From: example@example.com\\r\\n\";\n    $headers .= \"MIME-Version: 1.0\\r\\n\";\n    $headers .= \"Content-Type: text/html; charset=UTF-8\\r\\n\";\n\n    $body = \"<html><body>\n                <h1>$subject</h1>\n                Click the link below to reset your password:\n                <a href=\\\"$link\\\">Reset Password</a>\n              </body></html>\";\n\n    mail($email, $subject, $body, $headers);\n}\n```", null]}
