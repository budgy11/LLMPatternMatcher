{"prompt": "Create a forgot password function using php", "llm_output": "**Forgot Password Function in PHP**\n====================================\n\nThis is an example of a simple forgot password function using PHP, MySQLi, and HTML. It will send a password reset email to the user's registered email address with a link to reset their password.\n\n**Database Schema**\n-----------------\n\nWe'll assume you have a `users` table with the following schema:\n\n```sql\nCREATE TABLE users (\n    id INT PRIMARY KEY AUTO_INCREMENT,\n    username VARCHAR(255),\n    email VARCHAR(255) UNIQUE,\n    password_hash VARCHAR(255)\n);\n```\n\n**PHP Code**\n------------\n\nCreate a new file called `forgot_password.php` and add the following code:\n```php\n<?php\nrequire_once 'config.php';\n\n// Check if the form has been submitted\nif (isset($_POST['submit'])) {\n    // Get user input\n    $email = trim($_POST['email']);\n\n    // Validate email address\n    if (!filter_var($email, FILTER_VALIDATE_EMAIL)) {\n        echo \"Invalid email address\";\n        return;\n    }\n\n    // Query the database to retrieve the user's ID\n    $query = \"SELECT id FROM users WHERE email = '$email'\";\n    $result = mysqli_query($conn, $query);\n\n    if (mysqli_num_rows($result) == 1) {\n        // Retrieve the user's ID and email address\n        $row = mysqli_fetch_assoc($result);\n        $userId = $row['id'];\n        $userEmail = $row['email'];\n\n        // Generate a password reset token\n        $token = bin2hex(random_bytes(32));\n\n        // Store the token in the database\n        $query = \"UPDATE users SET token = '$token' WHERE id = '$userId'\";\n        mysqli_query($conn, $query);\n\n        // Send an email with the password reset link\n        sendPasswordResetEmail($userEmail, $token);\n    } else {\n        echo \"No account found with this email address\";\n    }\n}\n\n// Function to send a password reset email\nfunction sendPasswordResetEmail($email, $token) {\n    // Get the user's name from the database (optional)\n    $query = \"SELECT username FROM users WHERE email = '$email'\";\n    $result = mysqli_query($conn, $query);\n    $row = mysqli_fetch_assoc($result);\n    $username = $row['username'];\n\n    // Email content\n    $subject = \"Password Reset Request\";\n    $body = \"\n        <p>Hello $username,</p>\n        <p>You have requested to reset your password. Please click on the following link to reset your password:</p>\n        <a href='https://example.com/reset-password.php?token=$token'>Reset Password</a>\n        <p>If you did not request a password reset, please ignore this email.</p>\n    \";\n\n    // Send the email using PHPMailer (or any other mail library)\n    $mail = new PHPMailer();\n    $mail->isSMTP();\n    $mail->Host = 'smtp.example.com';\n    $mail->Port = 587;\n    $mail->Username = 'your-email@example.com';\n    $mail->Password = 'your-password';\n    $mail->setFrom('your-email@example.com', 'Your Name');\n    $mail->addAddress($email);\n    $mail->Subject = $subject;\n    $mail->Body = $body;\n    if (!$mail->send()) {\n        echo \"Error sending email: \" . $mail->ErrorInfo;\n    }\n}\n?>\n```\n**HTML Form**\n-------------\n\nCreate a new file called `forgot_password_form.html` and add the following code:\n```html\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Forgot Password</title>\n</head>\n<body>\n    <h1>Forgot Password</h1>\n    <form action=\"forgot_password.php\" method=\"post\">\n        <label for=\"email\">Email:</label>\n        <input type=\"text\" id=\"email\" name=\"email\"><br><br>\n        <button type=\"submit\" name=\"submit\">Submit</button>\n    </form>\n</body>\n</html>\n```\n**Example Use Case**\n--------------------\n\n1. The user visits the `forgot_password_form.html` page and enters their email address in the form.\n2. When the user submits the form, the `forgot_password.php` script is executed, which validates the email address and checks if an account exists with that email address.\n3. If an account exists, a password reset token is generated and stored in the database.\n4. The script sends an email to the user's registered email address with a link to reset their password (e.g., `https://example.com/reset-password.php?token=$token`).\n5. When the user clicks on the link, they are taken to the password reset page, where they can enter a new password and confirm it.\n\nNote: This is a basic example and you should adapt it to your specific needs. Additionally, make sure to secure your database and email credentials.", "code_blocks": [null, "```php\n<?php\nrequire_once 'config.php';\n\n// Check if the form has been submitted\nif (isset($_POST['submit'])) {\n    // Get user input\n    $email = trim($_POST['email']);\n\n    // Validate email address\n    if (!filter_var($email, FILTER_VALIDATE_EMAIL)) {\n        echo \"Invalid email address\";\n        return;\n    }\n\n    // Query the database to retrieve the user's ID\n    $query = \"SELECT id FROM users WHERE email = '$email'\";\n    $result = mysqli_query($conn, $query);\n\n    if (mysqli_num_rows($result) == 1) {\n        // Retrieve the user's ID and email address\n        $row = mysqli_fetch_assoc($result);\n        $userId = $row['id'];\n        $userEmail = $row['email'];\n\n        // Generate a password reset token\n        $token = bin2hex(random_bytes(32));\n\n        // Store the token in the database\n        $query = \"UPDATE users SET token = '$token' WHERE id = '$userId'\";\n        mysqli_query($conn, $query);\n\n        // Send an email with the password reset link\n        sendPasswordResetEmail($userEmail, $token);\n    } else {\n        echo \"No account found with this email address\";\n    }\n}\n\n// Function to send a password reset email\nfunction sendPasswordResetEmail($email, $token) {\n    // Get the user's name from the database (optional)\n    $query = \"SELECT username FROM users WHERE email = '$email'\";\n    $result = mysqli_query($conn, $query);\n    $row = mysqli_fetch_assoc($result);\n    $username = $row['username'];\n\n    // Email content\n    $subject = \"Password Reset Request\";\n    $body = \"\n        <p>Hello $username,</p>\n        <p>You have requested to reset your password. Please click on the following link to reset your password:</p>\n        <a href='https://example.com/reset-password.php?token=$token'>Reset Password</a>\n        <p>If you did not request a password reset, please ignore this email.</p>\n    \";\n\n    // Send the email using PHPMailer (or any other mail library)\n    $mail = new PHPMailer();\n    $mail->isSMTP();\n    $mail->Host = 'smtp.example.com';\n    $mail->Port = 587;\n    $mail->Username = 'your-email@example.com';\n    $mail->Password = 'your-password';\n    $mail->setFrom('your-email@example.com', 'Your Name');\n    $mail->addAddress($email);\n    $mail->Subject = $subject;\n    $mail->Body = $body;\n    if (!$mail->send()) {\n        echo \"Error sending email: \" . $mail->ErrorInfo;\n    }\n}\n?>\n```", null]}
