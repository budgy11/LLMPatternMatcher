{"prompt": "Create a forgot password function using php", "llm_output": "Here's an example of how you can create a forgot password function in PHP. This script will send a password reset link to the user's email.\n\n**Step 1: Create Table in Database**\n\nFirst, we need to create a table in our database to store the recovery emails.\n\n```sql\nCREATE TABLE `password_recovery` (\n  `id` int(11) NOT NULL AUTO_INCREMENT,\n  `email` varchar(255) NOT NULL,\n  `token` char(32) NOT NULL DEFAULT '',\n  `expires_at` datetime NOT NULL,\n  PRIMARY KEY (`id`)\n);\n```\n\n**Step 2: PHP Code for Forgot Password Function**\n\nCreate a new PHP file (e.g., `forgot_password.php`) and add the following code:\n\n```php\n<?php\n\n// Include configuration file\ninclude 'config.php';\n\n// Check if form has been submitted\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n    // Get email from user\n    $email = $_POST['email'];\n\n    // Check if email exists in database\n    $query = \"SELECT * FROM users WHERE email = '$email'\";\n    $result = mysqli_query($conn, $query);\n\n    if (mysqli_num_rows($result) > 0) {\n        // If email exists, generate a token and store it in the password_recovery table\n        $token = bin2hex(random_bytes(16));\n        $expires_at = date('Y-m-d H:i:s', strtotime('+1 day'));\n\n        $query = \"INSERT INTO `password_recovery` (`email`, `token`, `expires_at`) VALUES ('$email', '$token', '$expires_at')\";\n        mysqli_query($conn, $query);\n\n        // Send email with password reset link\n        send_email($email, $token);\n    } else {\n        echo 'Email does not exist in the database.';\n    }\n} else {\n    echo '<form action=\"\" method=\"post\">';\n    echo '<input type=\"text\" name=\"email\" placeholder=\"Enter your email address\">';\n    echo '<button type=\"submit\">Send Password Reset Link</button>';\n    echo '</form>';\n}\n\n// Function to send password reset link via email\nfunction send_email($to, $token) {\n    // Email configuration settings\n    $subject = 'Password Recovery';\n    $body = '<p>Click on the following link to reset your password:</p>\n            <p><a href=\"http://example.com/reset_password.php?token=' . $token . '\">Reset Password</a></p>';\n    $from = 'your_email@example.com';\n\n    // Send email using PHPMailer\n    require_once 'PHPMailerAutoload.php';\n    $mail = new PHPMailer;\n\n    $mail->isSMTP();\n    $mail->Host = 'smtp.example.com';\n    $mail->SMTPAuth = true;\n    $mail->Username = 'your_email@example.com';\n    $mail->Password = 'your_password';\n    $mail->Port = 587;\n\n    $mail->setFrom($from, 'Your Name');\n    $mail->addAddress($to);\n\n    $mail->isHTML(true);\n    $mail->Subject = $subject;\n    $mail->Body = $body;\n\n    if (!$mail->send()) {\n        echo 'Mailer Error: ' . $mail->ErrorInfo;\n    } else {\n        echo 'A password reset link has been sent to your email.';\n    }\n}\n```\n\n**Step 3: PHP Code for Password Reset Page**\n\nCreate a new PHP file (e.g., `reset_password.php`) and add the following code:\n\n```php\n<?php\n\n// Include configuration file\ninclude 'config.php';\n\n// Check if token is set in URL\nif (isset($_GET['token'])) {\n    // Get token from URL\n    $token = $_GET['token'];\n\n    // Check if token exists in password_recovery table and has not expired\n    $query = \"SELECT * FROM `password_recovery` WHERE token = '$token' AND expires_at > NOW()\";\n    $result = mysqli_query($conn, $query);\n\n    if (mysqli_num_rows($result) > 0) {\n        // If token is valid, create form for password reset\n        echo '<form action=\"\" method=\"post\">';\n        echo 'Enter new password: <input type=\"password\" name=\"new_password\"><br>';\n        echo 'Confirm new password: <input type=\"password\" name=\"confirm_new_password\"><br>';\n        echo '<button type=\"submit\">Reset Password</button>';\n        echo '</form>';\n\n        // Check if form has been submitted\n        if ($_SERVER['REQUEST_METHOD'] == 'POST') {\n            // Get new password from user\n            $new_password = $_POST['new_password'];\n            $confirm_new_password = $_POST['confirm_new_password'];\n\n            // Check if new passwords match\n            if ($new_password === $confirm_new_password) {\n                // If passwords match, update user's password in database\n                $query = \"UPDATE users SET `password` = '$new_password' WHERE email = (SELECT email FROM `password_recovery` WHERE token = '$token')\";\n                mysqli_query($conn, $query);\n\n                // Delete token from password_recovery table\n                $query = \"DELETE FROM `password_recovery` WHERE token = '$token'\";\n                mysqli_query($conn, $query);\n\n                echo 'Password reset successfully.';\n            } else {\n                echo 'Passwords do not match. Please try again.';\n            }\n        }\n    } else {\n        echo 'Token is invalid or has expired.';\n    }\n} else {\n    echo 'No token provided.';\n}\n\n// Close database connection\nmysqli_close($conn);\n?>\n```\n\nNote: This code assumes that you have already created a `users` table in your database with the necessary columns (e.g., `id`, `email`, `password`). You will also need to replace the email configuration settings and password reset link in the PHPMailer library with your own values. Additionally, make sure to use a secure way to store passwords, such as hashing and salting.\n\nThis code provides a basic example of how you can create a forgot password function using PHP. You may want to add additional security measures or features, such as email verification or CAPTCHA, depending on your specific needs.", "code_blocks": [null, "```php\n<?php\n\n// Include configuration file\ninclude 'config.php';\n\n// Check if form has been submitted\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n    // Get email from user\n    $email = $_POST['email'];\n\n    // Check if email exists in database\n    $query = \"SELECT * FROM users WHERE email = '$email'\";\n    $result = mysqli_query($conn, $query);\n\n    if (mysqli_num_rows($result) > 0) {\n        // If email exists, generate a token and store it in the password_recovery table\n        $token = bin2hex(random_bytes(16));\n        $expires_at = date('Y-m-d H:i:s', strtotime('+1 day'));\n\n        $query = \"INSERT INTO `password_recovery` (`email`, `token`, `expires_at`) VALUES ('$email', '$token', '$expires_at')\";\n        mysqli_query($conn, $query);\n\n        // Send email with password reset link\n        send_email($email, $token);\n    } else {\n        echo 'Email does not exist in the database.';\n    }\n} else {\n    echo '<form action=\"\" method=\"post\">';\n    echo '<input type=\"text\" name=\"email\" placeholder=\"Enter your email address\">';\n    echo '<button type=\"submit\">Send Password Reset Link</button>';\n    echo '</form>';\n}\n\n// Function to send password reset link via email\nfunction send_email($to, $token) {\n    // Email configuration settings\n    $subject = 'Password Recovery';\n    $body = '<p>Click on the following link to reset your password:</p>\n            <p><a href=\"http://example.com/reset_password.php?token=' . $token . '\">Reset Password</a></p>';\n    $from = 'your_email@example.com';\n\n    // Send email using PHPMailer\n    require_once 'PHPMailerAutoload.php';\n    $mail = new PHPMailer;\n\n    $mail->isSMTP();\n    $mail->Host = 'smtp.example.com';\n    $mail->SMTPAuth = true;\n    $mail->Username = 'your_email@example.com';\n    $mail->Password = 'your_password';\n    $mail->Port = 587;\n\n    $mail->setFrom($from, 'Your Name');\n    $mail->addAddress($to);\n\n    $mail->isHTML(true);\n    $mail->Subject = $subject;\n    $mail->Body = $body;\n\n    if (!$mail->send()) {\n        echo 'Mailer Error: ' . $mail->ErrorInfo;\n    } else {\n        echo 'A password reset link has been sent to your email.';\n    }\n}\n```", "```php\n<?php\n\n// Include configuration file\ninclude 'config.php';\n\n// Check if token is set in URL\nif (isset($_GET['token'])) {\n    // Get token from URL\n    $token = $_GET['token'];\n\n    // Check if token exists in password_recovery table and has not expired\n    $query = \"SELECT * FROM `password_recovery` WHERE token = '$token' AND expires_at > NOW()\";\n    $result = mysqli_query($conn, $query);\n\n    if (mysqli_num_rows($result) > 0) {\n        // If token is valid, create form for password reset\n        echo '<form action=\"\" method=\"post\">';\n        echo 'Enter new password: <input type=\"password\" name=\"new_password\"><br>';\n        echo 'Confirm new password: <input type=\"password\" name=\"confirm_new_password\"><br>';\n        echo '<button type=\"submit\">Reset Password</button>';\n        echo '</form>';\n\n        // Check if form has been submitted\n        if ($_SERVER['REQUEST_METHOD'] == 'POST') {\n            // Get new password from user\n            $new_password = $_POST['new_password'];\n            $confirm_new_password = $_POST['confirm_new_password'];\n\n            // Check if new passwords match\n            if ($new_password === $confirm_new_password) {\n                // If passwords match, update user's password in database\n                $query = \"UPDATE users SET `password` = '$new_password' WHERE email = (SELECT email FROM `password_recovery` WHERE token = '$token')\";\n                mysqli_query($conn, $query);\n\n                // Delete token from password_recovery table\n                $query = \"DELETE FROM `password_recovery` WHERE token = '$token'\";\n                mysqli_query($conn, $query);\n\n                echo 'Password reset successfully.';\n            } else {\n                echo 'Passwords do not match. Please try again.';\n            }\n        }\n    } else {\n        echo 'Token is invalid or has expired.';\n    }\n} else {\n    echo 'No token provided.';\n}\n\n// Close database connection\nmysqli_close($conn);\n?>\n```"]}
