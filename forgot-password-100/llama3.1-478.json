{"prompt": "Create a forgot password function using php", "llm_output": "**Forgot Password Function using PHP**\n=====================================\n\nThis example will demonstrate how to create a basic \"forgot password\" function in PHP. We'll use a simple email-based system, where the user enters their username and an email is sent with a reset link.\n\n**Database Schema (assuming MySQL)**\n------------------------------------\n\nFor this example, we'll assume you have a `users` table with the following structure:\n\n```sql\nCREATE TABLE users (\n  id INT PRIMARY KEY,\n  username VARCHAR(255),\n  password_hash CHAR(128)\n);\n```\n\n**PHP Code: forgot_password.php**\n-------------------------------\n\n```php\n<?php\n\nrequire_once 'config.inc.php'; // database connection settings\n\n// Email settings\n$from_email = 'your-email@example.com';\n$subject = 'Reset Password';\n\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n  // Get form data\n  $username = $_POST['username'];\n  \n  // Check if username exists in database\n  $query = \"SELECT * FROM users WHERE username='$username'\";\n  $result = mysqli_query($link, $query);\n  \n  if (mysqli_num_rows($result) > 0) {\n    // Get user ID from query result\n    $row = mysqli_fetch_assoc($result);\n    $user_id = $row['id'];\n    \n    // Generate random password and store it in a session variable\n    $new_password = substr(md5(uniqid()), 0, 8); // generate 8-character password\n    $_SESSION['new_password'] = $new_password;\n    \n    // Send email with reset link\n    $to_email = $row['email'];\n    $reset_link = \"http://your-website.com/reset-password.php?user_id=$user_id&password=$new_password\";\n    $body = \"Please click on the following link to reset your password: $reset_link\";\n    \n    // Send email using PHPMailer or similar library\n    mail($to_email, $subject, $body, 'From: ' . $from_email);\n    \n    echo \"A new password has been sent to your email. Please check your inbox.\";\n  } else {\n    echo \"Username not found in database.\";\n  }\n}\n\n?>\n\n<form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\">\n  <label for=\"username\">Enter your username:</label>\n  <input type=\"text\" id=\"username\" name=\"username\"><br><br>\n  <input type=\"submit\" value=\"Send password reset link\">\n</form>\n\n<?php\n// You can also include a \"back to login page\" link or button here\n?>\n```\n\n**reset_password.php (example)**\n------------------------------\n\nThis is the PHP script that will be called after the user clicks on the reset link in their email. It will update the user's password in the database.\n\n```php\n<?php\n\nrequire_once 'config.inc.php';\n\nif ($_SERVER['REQUEST_METHOD'] == 'GET') {\n  $user_id = $_GET['user_id'];\n  $new_password = $_GET['password'];\n  \n  // Update user password in database\n  $query = \"UPDATE users SET password_hash=SHA2('$new_password', 256) WHERE id=$user_id\";\n  mysqli_query($link, $query);\n  \n  echo \"Password updated successfully. You can now log in with your new credentials.\";\n}\n\n?>\n```\n\n**Security Notes:**\n\n* This example uses a very basic email-based system for password reset. In a real-world application, you should use a more secure method such as OAuth or an external authentication service.\n* Always hash and salt passwords when storing them in the database.\n* Use prepared statements to prevent SQL injection attacks.\n\nRemember to adapt this code to your specific needs and ensure that it is compatible with your PHP version and web server setup.", "code_blocks": [null, "```php\n<?php\n\nrequire_once 'config.inc.php'; // database connection settings\n\n// Email settings\n$from_email = 'your-email@example.com';\n$subject = 'Reset Password';\n\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n  // Get form data\n  $username = $_POST['username'];\n  \n  // Check if username exists in database\n  $query = \"SELECT * FROM users WHERE username='$username'\";\n  $result = mysqli_query($link, $query);\n  \n  if (mysqli_num_rows($result) > 0) {\n    // Get user ID from query result\n    $row = mysqli_fetch_assoc($result);\n    $user_id = $row['id'];\n    \n    // Generate random password and store it in a session variable\n    $new_password = substr(md5(uniqid()), 0, 8); // generate 8-character password\n    $_SESSION['new_password'] = $new_password;\n    \n    // Send email with reset link\n    $to_email = $row['email'];\n    $reset_link = \"http://your-website.com/reset-password.php?user_id=$user_id&password=$new_password\";\n    $body = \"Please click on the following link to reset your password: $reset_link\";\n    \n    // Send email using PHPMailer or similar library\n    mail($to_email, $subject, $body, 'From: ' . $from_email);\n    \n    echo \"A new password has been sent to your email. Please check your inbox.\";\n  } else {\n    echo \"Username not found in database.\";\n  }\n}\n\n?>\n\n<form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\">\n  <label for=\"username\">Enter your username:</label>\n  <input type=\"text\" id=\"username\" name=\"username\"><br><br>\n  <input type=\"submit\" value=\"Send password reset link\">\n</form>\n\n<?php\n// You can also include a \"back to login page\" link or button here\n?>\n```", "```php\n<?php\n\nrequire_once 'config.inc.php';\n\nif ($_SERVER['REQUEST_METHOD'] == 'GET') {\n  $user_id = $_GET['user_id'];\n  $new_password = $_GET['password'];\n  \n  // Update user password in database\n  $query = \"UPDATE users SET password_hash=SHA2('$new_password', 256) WHERE id=$user_id\";\n  mysqli_query($link, $query);\n  \n  echo \"Password updated successfully. You can now log in with your new credentials.\";\n}\n\n?>\n```"]}
