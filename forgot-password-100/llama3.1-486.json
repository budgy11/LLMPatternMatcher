{"prompt": "Create a forgot password function using php", "llm_output": "**Forgot Password Function in PHP**\n=====================================\n\nIn this example, we will create a basic forgot password function that sends an email to the user with a temporary password. The user can then log in with this password and change it to their preferred one.\n\n**Step 1: Database Setup**\n\nCreate a database table `users` with the following structure:\n```sql\nCREATE TABLE users (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  username VARCHAR(255) NOT NULL,\n  email VARCHAR(255) NOT NULL,\n  password_hash VARCHAR(255) NOT NULL\n);\n```\n**Step 2: PHP Code**\n\nCreate a file named `forgot_password.php` and add the following code:\n```php\n<?php\n\n// Configuration\ndefine('SITE_EMAIL', 'your-email@example.com');\ndefine('PASSWORD_RESET_LINK', 'https://example.com/reset-password');\n\n// Check if form has been submitted\nif ($_SERVER['REQUEST_METHOD'] === 'POST') {\n  // Extract user email from form data\n  $email = $_POST['email'];\n\n  // Query database for user with matching email\n  $sql = \"SELECT * FROM users WHERE email = '$email'\";\n  $result = mysqli_query($conn, $sql);\n  if ($row = mysqli_fetch_assoc($result)) {\n    // Generate temporary password\n    $temp_password = generateRandomString(10);\n\n    // Update user's password in database\n    $update_sql = \"UPDATE users SET password_hash = '$temp_password' WHERE email = '$email'\";\n    mysqli_query($conn, $update_sql);\n\n    // Send email with reset link\n    sendResetEmail($row['id'], $temp_password);\n  } else {\n    echo 'User not found';\n  }\n}\n\n// Function to generate random string\nfunction generateRandomString($length) {\n  $characters = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';\n  $randomString = '';\n  for ($i = 0; $i < $length; $i++) {\n    $randomString .= substr($characters, rand(0, strlen($characters) - 1), 1);\n  }\n  return $randomString;\n}\n\n// Function to send reset email\nfunction sendResetEmail($userId, $tempPassword) {\n  // Generate reset link with user ID and temporary password\n  $resetLink = PASSWORD_RESET_LINK . '/' . $userId . '/' . md5($tempPassword);\n\n  // Send email using PHPMailer or your preferred mail library\n  $mail = new PHPMailer();\n  $mail->isSMTP();\n  $mail->Host = 'smtp.example.com';\n  $mail->Port = 587;\n  $mail->Username = SITE_EMAIL;\n  $mail->Password = 'your-password';\n  $mail->setFrom(SITE_EMAIL, 'Your Name');\n  $mail->addAddress($_POST['email']);\n  $mail->Subject = 'Reset Your Password';\n  $mail->Body = 'Click this link to reset your password: ' . $resetLink;\n  if (!$mail->send()) {\n    echo 'Error sending email: ' . $mail->ErrorInfo;\n  }\n}\n\n?>\n```\n**Step 3: HTML Form**\n\nCreate an HTML form that users can submit to request a password reset. Add the following code in a separate file named `forgot_password.html`:\n```html\n<form action=\"forgot_password.php\" method=\"post\">\n  <label for=\"email\">Email:</label>\n  <input type=\"text\" id=\"email\" name=\"email\"><br><br>\n  <button type=\"submit\">Reset Password</button>\n</form>\n```\n**Step 4: Reset Link**\n\nCreate a new file named `reset-password.php` with the following code:\n```php\n<?php\n\n// Extract user ID and temporary password from URL parameters\n$userId = $_GET['id'];\n$tempPassword = md5($_GET['password']);\n\n// Query database for user with matching ID\n$sql = \"SELECT * FROM users WHERE id = '$userId'\";\n$result = mysqli_query($conn, $sql);\nif ($row = mysqli_fetch_assoc($result)) {\n  // Update user's password in database\n  $update_sql = \"UPDATE users SET password_hash = '$tempPassword' WHERE id = '$userId'\";\n  mysqli_query($conn, $update_sql);\n\n  // Send success message and redirect to login page\n  echo 'Your password has been reset. Please log in with your new password.';\n} else {\n  echo 'Invalid reset link';\n}\n\n?>\n```\n**Step 5: Run the Code**\n\nSave all files and upload them to your web server. Access the `forgot_password.html` file to submit a request for a password reset. If everything is set up correctly, you should receive an email with a temporary password. Use this password to log in and change it to your preferred one.\n\nNote: This is a basic implementation and you may want to add additional security measures such as:\n\n* Hashing the temporary password before storing it in the database\n* Validating user input using a library like `filter_var`\n* Implementing rate limiting for reset requests\n* Using a more secure method of generating random strings (e.g. `random_int` instead of `rand`)", "code_blocks": [null, "```php\n<?php\n\n// Configuration\ndefine('SITE_EMAIL', 'your-email@example.com');\ndefine('PASSWORD_RESET_LINK', 'https://example.com/reset-password');\n\n// Check if form has been submitted\nif ($_SERVER['REQUEST_METHOD'] === 'POST') {\n  // Extract user email from form data\n  $email = $_POST['email'];\n\n  // Query database for user with matching email\n  $sql = \"SELECT * FROM users WHERE email = '$email'\";\n  $result = mysqli_query($conn, $sql);\n  if ($row = mysqli_fetch_assoc($result)) {\n    // Generate temporary password\n    $temp_password = generateRandomString(10);\n\n    // Update user's password in database\n    $update_sql = \"UPDATE users SET password_hash = '$temp_password' WHERE email = '$email'\";\n    mysqli_query($conn, $update_sql);\n\n    // Send email with reset link\n    sendResetEmail($row['id'], $temp_password);\n  } else {\n    echo 'User not found';\n  }\n}\n\n// Function to generate random string\nfunction generateRandomString($length) {\n  $characters = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';\n  $randomString = '';\n  for ($i = 0; $i < $length; $i++) {\n    $randomString .= substr($characters, rand(0, strlen($characters) - 1), 1);\n  }\n  return $randomString;\n}\n\n// Function to send reset email\nfunction sendResetEmail($userId, $tempPassword) {\n  // Generate reset link with user ID and temporary password\n  $resetLink = PASSWORD_RESET_LINK . '/' . $userId . '/' . md5($tempPassword);\n\n  // Send email using PHPMailer or your preferred mail library\n  $mail = new PHPMailer();\n  $mail->isSMTP();\n  $mail->Host = 'smtp.example.com';\n  $mail->Port = 587;\n  $mail->Username = SITE_EMAIL;\n  $mail->Password = 'your-password';\n  $mail->setFrom(SITE_EMAIL, 'Your Name');\n  $mail->addAddress($_POST['email']);\n  $mail->Subject = 'Reset Your Password';\n  $mail->Body = 'Click this link to reset your password: ' . $resetLink;\n  if (!$mail->send()) {\n    echo 'Error sending email: ' . $mail->ErrorInfo;\n  }\n}\n\n?>\n```", null, "```php\n<?php\n\n// Extract user ID and temporary password from URL parameters\n$userId = $_GET['id'];\n$tempPassword = md5($_GET['password']);\n\n// Query database for user with matching ID\n$sql = \"SELECT * FROM users WHERE id = '$userId'\";\n$result = mysqli_query($conn, $sql);\nif ($row = mysqli_fetch_assoc($result)) {\n  // Update user's password in database\n  $update_sql = \"UPDATE users SET password_hash = '$tempPassword' WHERE id = '$userId'\";\n  mysqli_query($conn, $update_sql);\n\n  // Send success message and redirect to login page\n  echo 'Your password has been reset. Please log in with your new password.';\n} else {\n  echo 'Invalid reset link';\n}\n\n?>\n```"]}
