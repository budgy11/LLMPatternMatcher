{"prompt": "Create a forgot password function using php", "llm_output": "Here is an example of a simple \"forgot password\" function using PHP, MySQL, and email:\n\n**Database Schema:**\n\nFirst, let's assume we have the following database schema:\n```sql\nCREATE TABLE users (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  username VARCHAR(255),\n  email VARCHAR(255) UNIQUE,\n  password_hash VARCHAR(255)\n);\n```\n**PHP Code:**\n```php\n<?php\n\n// Configuration\n$database = 'your_database_name';\n$username = 'your_username';\n$password = 'your_password';\n\n// Connect to database\n$conn = new mysqli($servername, $username, $password, $database);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Function to send password reset email\nfunction send_reset_email($email) {\n    // Generate a random password reset token\n    $token = bin2hex(random_bytes(16));\n\n    // Insert the token into the database\n    $sql = \"INSERT INTO password_resets (user_id, token) VALUES ((SELECT id FROM users WHERE email = '$email'), '$token')\";\n    if ($conn->query($sql) === TRUE) {\n        // Send the reset link via email\n        $reset_link = 'http://your-website.com/reset-password/' . $token;\n        $subject = 'Password Reset';\n        $message = 'Click this link to reset your password: ' . $reset_link;\n\n        mail($email, $subject, $message);\n    } else {\n        echo \"Error inserting token into database: \" . $conn->error;\n    }\n}\n\n// Function to handle forgotten password form submission\nfunction forgot_password() {\n    // Get the user's email from the form\n    $email = $_POST['email'];\n\n    // Check if the email is valid and exists in the database\n    $sql = \"SELECT * FROM users WHERE email = '$email'\";\n    $result = $conn->query($sql);\n\n    if ($result->num_rows > 0) {\n        // Send a password reset email\n        send_reset_email($email);\n    } else {\n        echo 'No account found with that email.';\n    }\n}\n\n// Handle forgotten password form submission\nif (isset($_POST['submit'])) {\n    forgot_password();\n}\n\n?>\n```\n**Explanation:**\n\n1. We first connect to our database using the `mysqli` extension.\n2. The `send_reset_email()` function generates a random password reset token, inserts it into the `password_resets` table, and sends an email with a link to reset the password.\n3. The `forgot_password()` function gets the user's email from the form submission, checks if the email exists in the database, and calls the `send_reset_email()` function to send a password reset email.\n\n**Security Notes:**\n\n* Make sure to hash your passwords using a secure algorithm like bcrypt or Argon2.\n* Use HTTPS (SSL/TLS) to encrypt all communication between the client and server.\n* Validate user input using PHP's built-in validation functions.\n* Store sensitive data (like database credentials) securely outside of your codebase.\n\n**Example Use Case:**\n\nTo use this script, simply create a new file called `forgot-password.php` and paste the above code into it. Then, include the following HTML form in the same file to allow users to submit their email address:\n```html\n<form action=\"forgot-password.php\" method=\"post\">\n    <input type=\"email\" name=\"email\" placeholder=\"Email address\">\n    <button type=\"submit\" name=\"submit\">Send Reset Link</button>\n</form>\n```\nWhen a user submits their email, the script will send a password reset link via email.", "code_blocks": [null, "```php\n<?php\n\n// Configuration\n$database = 'your_database_name';\n$username = 'your_username';\n$password = 'your_password';\n\n// Connect to database\n$conn = new mysqli($servername, $username, $password, $database);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Function to send password reset email\nfunction send_reset_email($email) {\n    // Generate a random password reset token\n    $token = bin2hex(random_bytes(16));\n\n    // Insert the token into the database\n    $sql = \"INSERT INTO password_resets (user_id, token) VALUES ((SELECT id FROM users WHERE email = '$email'), '$token')\";\n    if ($conn->query($sql) === TRUE) {\n        // Send the reset link via email\n        $reset_link = 'http://your-website.com/reset-password/' . $token;\n        $subject = 'Password Reset';\n        $message = 'Click this link to reset your password: ' . $reset_link;\n\n        mail($email, $subject, $message);\n    } else {\n        echo \"Error inserting token into database: \" . $conn->error;\n    }\n}\n\n// Function to handle forgotten password form submission\nfunction forgot_password() {\n    // Get the user's email from the form\n    $email = $_POST['email'];\n\n    // Check if the email is valid and exists in the database\n    $sql = \"SELECT * FROM users WHERE email = '$email'\";\n    $result = $conn->query($sql);\n\n    if ($result->num_rows > 0) {\n        // Send a password reset email\n        send_reset_email($email);\n    } else {\n        echo 'No account found with that email.';\n    }\n}\n\n// Handle forgotten password form submission\nif (isset($_POST['submit'])) {\n    forgot_password();\n}\n\n?>\n```", null]}
