{"prompt": "Create a forgot password function using php", "llm_output": "Here's an example of how you can create a \"Forgot Password\" function in PHP. This script will send an email with a link to reset the user's password.\n\n**Note:** Before running this code, make sure you have a MySQL database set up with the following table:\n\n```sql\nCREATE TABLE users (\n    id INT AUTO_INCREMENT PRIMARY KEY,\n    username VARCHAR(255),\n    email VARCHAR(255) NOT NULL,\n    password VARCHAR(255)\n);\n```\n\nAnd also make sure to replace `localhost` and `your_database_name` in the connection script below.\n\n**PHP Code:**\n\n```php\n<?php\n\n// Database Connection Script:\n$servername = \"localhost\";\n$username = \"root\";\n$password = \"\";\n$dbname = \"your_database_name\";\n\n$conn = new mysqli($servername, $username, $password, $dbname);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\nfunction forgot_password($email) {\n    global $conn;\n\n    // Check if email exists in the database\n    $sql = \"SELECT * FROM users WHERE email = '$email'\";\n    $result = $conn->query($sql);\n\n    if ($result->num_rows == 0) {\n        echo \"Email not found.\";\n        return;\n    }\n\n    // Generate a random token for password reset\n    $token = bin2hex(random_bytes(16));\n    // Store the token in the database with the user's id\n    $sql = \"UPDATE users SET token = '$token' WHERE email = '$email'\";\n    $conn->query($sql);\n\n    // Send an email to the user with a link to reset password\n    send_reset_password_email($email, $token);\n}\n\nfunction send_reset_password_email($email, $token) {\n    $to      = $email;\n    $subject = 'Reset Your Password';\n    $message  = 'Click on this link to reset your password: <a href=\"http://yourdomain.com/reset-password.php?token=' . $token . '\">Reset Password</a>';\n    $headers = 'From: your email address' . \"\\r\\n\" .\n        'Reply-To: your email address' . \"\\r\\n\" .\n        'X-Mailer: PHP/' . phpversion();\n    mail($to, $subject, $message, $headers);\n}\n\n// If the form has been submitted\nif (isset($_POST['forgot-password'])) {\n    // Get user input\n    $email = $_POST['email'];\n\n    // Call the forgot password function\n    forgot_password($email);\n\n    echo \"An email with a link to reset your password has been sent.\";\n} else {\n?>\n\n<!-- Forgot Password Form -->\n<form action=\"\" method=\"post\">\n    <label for=\"email\">Email:</label>\n    <input type=\"text\" id=\"email\" name=\"email\"><br><br>\n    <input type=\"submit\" value=\"Forgot Password\" name=\"forgot-password\">\n</form>\n\n<?php\n}\n?>\n```\n\n**Explanation:**\n\n*   The `forgot_password` function checks if the email exists in the database. If it does, a random token is generated and stored in the database with the user's id.\n*   An email is sent to the user with a link to reset their password. This link contains the token that was generated earlier.\n*   When the user clicks on this link, they are taken to the `reset-password.php` page where they can enter their new password.\n\n**Note:** Make sure to replace `http://yourdomain.com/reset-password.php` in the email with your actual domain name and path. Also, make sure that the reset password form is secure (i.e., it uses HTTPS).", "code_blocks": [null, "```php\n<?php\n\n// Database Connection Script:\n$servername = \"localhost\";\n$username = \"root\";\n$password = \"\";\n$dbname = \"your_database_name\";\n\n$conn = new mysqli($servername, $username, $password, $dbname);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\nfunction forgot_password($email) {\n    global $conn;\n\n    // Check if email exists in the database\n    $sql = \"SELECT * FROM users WHERE email = '$email'\";\n    $result = $conn->query($sql);\n\n    if ($result->num_rows == 0) {\n        echo \"Email not found.\";\n        return;\n    }\n\n    // Generate a random token for password reset\n    $token = bin2hex(random_bytes(16));\n    // Store the token in the database with the user's id\n    $sql = \"UPDATE users SET token = '$token' WHERE email = '$email'\";\n    $conn->query($sql);\n\n    // Send an email to the user with a link to reset password\n    send_reset_password_email($email, $token);\n}\n\nfunction send_reset_password_email($email, $token) {\n    $to      = $email;\n    $subject = 'Reset Your Password';\n    $message  = 'Click on this link to reset your password: <a href=\"http://yourdomain.com/reset-password.php?token=' . $token . '\">Reset Password</a>';\n    $headers = 'From: your email address' . \"\\r\\n\" .\n        'Reply-To: your email address' . \"\\r\\n\" .\n        'X-Mailer: PHP/' . phpversion();\n    mail($to, $subject, $message, $headers);\n}\n\n// If the form has been submitted\nif (isset($_POST['forgot-password'])) {\n    // Get user input\n    $email = $_POST['email'];\n\n    // Call the forgot password function\n    forgot_password($email);\n\n    echo \"An email with a link to reset your password has been sent.\";\n} else {\n?>\n\n<!-- Forgot Password Form -->\n<form action=\"\" method=\"post\">\n    <label for=\"email\">Email:</label>\n    <input type=\"text\" id=\"email\" name=\"email\"><br><br>\n    <input type=\"submit\" value=\"Forgot Password\" name=\"forgot-password\">\n</form>\n\n<?php\n}\n?>\n```"]}
