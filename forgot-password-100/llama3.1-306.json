{"prompt": "Create a forgot password function using php", "llm_output": "Here's an example of how you can create a \"Forgot Password\" function in PHP:\n\n**Database Schema:**\n\nAssuming you have a database table called `users` with the following columns:\n```sql\n+---------+--------------+---------------+\n| id      | email       | password_hash |\n+---------+--------------+---------------+\n```\n**PHP Code:**\n```php\n<?php\n\n// Configuration\n$db_host = 'localhost';\n$db_username = 'your_database_username';\n$db_password = 'your_database_password';\n$db_name = 'your_database_name';\n\n// Connect to database\n$conn = new mysqli($db_host, $db_username, $db_password, $db_name);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\nfunction forgot_password() {\n  if ($_SERVER[\"REQUEST_METHOD\"] == \"POST\") {\n    // Get form data\n    $email = $_POST['email'];\n\n    // Validate email\n    if (empty($email)) {\n      echo 'Error: Email cannot be empty!';\n      return;\n    }\n\n    // Check if user exists\n    $sql = \"SELECT * FROM users WHERE email = '$email'\";\n    $result = $conn->query($sql);\n\n    if ($result->num_rows > 0) {\n      // Get user data\n      while ($row = $result->fetch_assoc()) {\n        $user_id = $row['id'];\n      }\n\n      // Generate new password and store it in database\n      $new_password = bin2hex(random_bytes(16));\n      $sql = \"UPDATE users SET password_hash = SHA256('$new_password') WHERE id = '$user_id'\";\n      $conn->query($sql);\n\n      // Send reset email to user\n      $to = $email;\n      $subject = 'Reset Password';\n      $body = \"Your new password is: $new_password\";\n      mail($to, $subject, $body);\n      echo 'Password reset email sent!';\n    } else {\n      echo 'Error: Email not found in database.';\n    }\n  }\n}\n\n// Call forgot_password function\nforgot_password();\n\n?>\n```\n**HTML Form:**\n```html\n<form action=\"\" method=\"post\">\n  <label for=\"email\">Email:</label>\n  <input type=\"text\" id=\"email\" name=\"email\"><br><br>\n  <button type=\"submit\">Reset Password</button>\n</form>\n```\n**How it works:**\n\n1. The `forgot_password` function checks if the form has been submitted.\n2. If the form is submitted, it gets the email from the form data.\n3. It validates the email to make sure it's not empty.\n4. It queries the database to check if a user exists with the given email.\n5. If a user exists, it generates a new password using `bin2hex(random_bytes(16))`.\n6. It updates the user's password in the database using SHA256 encryption.\n7. Finally, it sends an email to the user with their new password.\n\n**Security Considerations:**\n\n* This code uses SHA256 encryption for storing passwords. Make sure to use a secure password hashing algorithm like bcrypt or Argon2 instead of SHA256.\n* This code does not handle exceptions well. You should add proper error handling and logging mechanisms to make it more robust.\n* This code assumes that the email address is unique for each user. If you have multiple users with the same email, this code will update all their passwords.\n\n**Note:** This is a basic example to demonstrate how to create a \"Forgot Password\" function in PHP. You should adapt and enhance it according to your specific requirements and security considerations.", "code_blocks": [null, "```php\n<?php\n\n// Configuration\n$db_host = 'localhost';\n$db_username = 'your_database_username';\n$db_password = 'your_database_password';\n$db_name = 'your_database_name';\n\n// Connect to database\n$conn = new mysqli($db_host, $db_username, $db_password, $db_name);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\nfunction forgot_password() {\n  if ($_SERVER[\"REQUEST_METHOD\"] == \"POST\") {\n    // Get form data\n    $email = $_POST['email'];\n\n    // Validate email\n    if (empty($email)) {\n      echo 'Error: Email cannot be empty!';\n      return;\n    }\n\n    // Check if user exists\n    $sql = \"SELECT * FROM users WHERE email = '$email'\";\n    $result = $conn->query($sql);\n\n    if ($result->num_rows > 0) {\n      // Get user data\n      while ($row = $result->fetch_assoc()) {\n        $user_id = $row['id'];\n      }\n\n      // Generate new password and store it in database\n      $new_password = bin2hex(random_bytes(16));\n      $sql = \"UPDATE users SET password_hash = SHA256('$new_password') WHERE id = '$user_id'\";\n      $conn->query($sql);\n\n      // Send reset email to user\n      $to = $email;\n      $subject = 'Reset Password';\n      $body = \"Your new password is: $new_password\";\n      mail($to, $subject, $body);\n      echo 'Password reset email sent!';\n    } else {\n      echo 'Error: Email not found in database.';\n    }\n  }\n}\n\n// Call forgot_password function\nforgot_password();\n\n?>\n```", null]}
