{"prompt": "Create a forgot password function using php", "llm_output": "Here is an example of how you can create a \"forgot password\" function in PHP. This example will send an email with a link to reset the password.\n\n**Note:** This example assumes you have PHP 7+ installed and MySQL as your database management system. You will need to modify it according to your specific needs.\n\n### Database Schema\n\nFirst, let's create a simple database schema:\n\n```sql\nCREATE TABLE users (\n    id INT PRIMARY KEY AUTO_INCREMENT,\n    email VARCHAR(255) NOT NULL UNIQUE,\n    password_hash VARCHAR(255) NOT NULL,\n    token VARCHAR(255),\n    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n);\n```\n\n### PHP Code\n\nHere is the PHP code for the \"forgot password\" function:\n\n```php\n<?php\n\n// Configuration\n$dsn = 'mysql:host=localhost;dbname=your_database_name';\n$username = 'your_database_username';\n$password = 'your_database_password';\n\ntry {\n    // Connect to database\n    $conn = new PDO($dsn, $username, $password);\n    $conn->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);\n\n} catch (PDOException $e) {\n    echo \"Connection failed: \" . $e->getMessage();\n}\n\n// Forgot password form handler\nif ($_SERVER['REQUEST_METHOD'] === 'POST') {\n\n    // Get email from POST request\n    $email = $_POST['email'];\n\n    try {\n        // Retrieve user data from database\n        $stmt = $conn->prepare('SELECT * FROM users WHERE email = :email');\n        $stmt->bindParam(':email', $email);\n        $stmt->execute();\n\n        if ($stmt->rowCount() === 0) {\n            echo \"Email not found.\";\n            return;\n        }\n\n        // Generate reset token\n        $token = bin2hex(random_bytes(32));\n\n        // Update user data in database with new token\n        $updateStmt = $conn->prepare('UPDATE users SET token = :token WHERE email = :email');\n        $updateStmt->bindParam(':token', $token);\n        $updateStmt->bindParam(':email', $email);\n        $updateStmt->execute();\n\n        // Send reset link via email\n        sendResetEmail($token, $email);\n\n        echo \"Password reset link sent to your email. Please check your inbox.\";\n\n    } catch (PDOException $e) {\n        echo \"Database error: \" . $e->getMessage();\n    }\n\n}\n\n// Function to send password reset link via email\nfunction sendResetEmail($token, $email) {\n\n    // Send mail using PHPMailer library or any other mail function\n    require_once 'PHPMailer/PHPMailer.php';\n    require_once 'PHPMailer/SMTP.php';\n\n    $mail = new PHPMailer\\PHPMailer\\PHPMailer();\n    $mail->isSMTP();\n    $mail->Host = 'smtp.gmail.com'; // Use your SMTP host here\n    $mail->Port = 587;\n    $mail->SMTPSecure = 'tls';\n    $mail->SMTPAuth = true;\n\n    $mail->Username = 'your_smtp_email@gmail.com'; // Your email address\n    $mail->Password = 'your_smtp_password'; // Your SMTP password\n\n    $mail->setFrom('your_smtp_email@gmail.com', 'Your Name');\n    $mail->addAddress($email);\n    $mail->Subject = 'Reset Password Link';\n    $mail->Body = 'Click on the link below to reset your password: <a href=\"http://your-website.com/reset-password.php?token=' . $token . '\">Reset Password</a>';\n\n    if (!$mail->send()) {\n        echo \"Error sending email: \" . $mail->ErrorInfo;\n    }\n}\n\n?>\n```\n\n### HTML Form\n\nFinally, here's the simple HTML form to trigger the forgot password process:\n\n```html\n<form method=\"post\">\n    <label for=\"email\">Email:</label>\n    <input type=\"email\" id=\"email\" name=\"email\"><br><br>\n    <button type=\"submit\">Forgot Password</button>\n</form>\n```\n\nThis is a basic example to demonstrate how you can create a forgot password function using PHP. Remember to adjust the database schema, PHP code, and HTML form according to your specific needs.\n\n**Note:** In a real-world application, consider adding proper security measures such as hashing and salting passwords. Also, make sure to use secure protocols (HTTPS) for email sending.", "code_blocks": [null, "```php\n<?php\n\n// Configuration\n$dsn = 'mysql:host=localhost;dbname=your_database_name';\n$username = 'your_database_username';\n$password = 'your_database_password';\n\ntry {\n    // Connect to database\n    $conn = new PDO($dsn, $username, $password);\n    $conn->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);\n\n} catch (PDOException $e) {\n    echo \"Connection failed: \" . $e->getMessage();\n}\n\n// Forgot password form handler\nif ($_SERVER['REQUEST_METHOD'] === 'POST') {\n\n    // Get email from POST request\n    $email = $_POST['email'];\n\n    try {\n        // Retrieve user data from database\n        $stmt = $conn->prepare('SELECT * FROM users WHERE email = :email');\n        $stmt->bindParam(':email', $email);\n        $stmt->execute();\n\n        if ($stmt->rowCount() === 0) {\n            echo \"Email not found.\";\n            return;\n        }\n\n        // Generate reset token\n        $token = bin2hex(random_bytes(32));\n\n        // Update user data in database with new token\n        $updateStmt = $conn->prepare('UPDATE users SET token = :token WHERE email = :email');\n        $updateStmt->bindParam(':token', $token);\n        $updateStmt->bindParam(':email', $email);\n        $updateStmt->execute();\n\n        // Send reset link via email\n        sendResetEmail($token, $email);\n\n        echo \"Password reset link sent to your email. Please check your inbox.\";\n\n    } catch (PDOException $e) {\n        echo \"Database error: \" . $e->getMessage();\n    }\n\n}\n\n// Function to send password reset link via email\nfunction sendResetEmail($token, $email) {\n\n    // Send mail using PHPMailer library or any other mail function\n    require_once 'PHPMailer/PHPMailer.php';\n    require_once 'PHPMailer/SMTP.php';\n\n    $mail = new PHPMailer\\PHPMailer\\PHPMailer();\n    $mail->isSMTP();\n    $mail->Host = 'smtp.gmail.com'; // Use your SMTP host here\n    $mail->Port = 587;\n    $mail->SMTPSecure = 'tls';\n    $mail->SMTPAuth = true;\n\n    $mail->Username = 'your_smtp_email@gmail.com'; // Your email address\n    $mail->Password = 'your_smtp_password'; // Your SMTP password\n\n    $mail->setFrom('your_smtp_email@gmail.com', 'Your Name');\n    $mail->addAddress($email);\n    $mail->Subject = 'Reset Password Link';\n    $mail->Body = 'Click on the link below to reset your password: <a href=\"http://your-website.com/reset-password.php?token=' . $token . '\">Reset Password</a>';\n\n    if (!$mail->send()) {\n        echo \"Error sending email: \" . $mail->ErrorInfo;\n    }\n}\n\n?>\n```", null]}
