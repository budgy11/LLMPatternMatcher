{"prompt": "Create a forgot password function using php", "llm_output": "Here is an example of how you can create a \"forgot password\" function in PHP:\n\n**Forgot Password Function**\n\nThis function will send an email to the user with a link that allows them to reset their password.\n```php\nfunction forgot_password($email) {\n  // Connect to database (assuming you're using MySQL)\n  $db = mysqli_connect(\"localhost\", \"username\", \"password\", \"database\");\n\n  // Check if email exists in database\n  $query = \"SELECT * FROM users WHERE email = '$email'\";\n  $result = mysqli_query($db, $query);\n  if (mysqli_num_rows($result) == 0) {\n    return \"Email not found\";\n  }\n\n  // Generate a random token for the user to reset their password\n  $token = bin2hex(random_bytes(16));\n\n  // Update the user's record with the new token\n  $query = \"UPDATE users SET password_reset_token = '$token' WHERE email = '$email'\";\n  mysqli_query($db, $query);\n\n  // Send an email to the user with a link to reset their password\n  $subject = \"Reset your password\";\n  $message = \"\n    <p>Hello $email,</p>\n    <p>Click on the following link to reset your password:</p>\n    <p><a href='\" . url('reset-password', ['token' => $token]) . \"'>Reset Password</a></p>\n  \";\n  mail($email, $subject, $message);\n\n  return \"Password reset email sent\";\n}\n```\n**Explanation**\n\n1. The function takes an email address as input.\n2. It connects to the database and checks if the email exists in the `users` table. If it doesn't exist, it returns an error message.\n3. If the email does exist, it generates a random token using the `random_bytes` function and updates the user's record with this new token.\n4. It sends an email to the user with a link to reset their password. The link includes the token as a parameter.\n\n**Reset Password Function**\n\nThis function will handle the actual password reset process for the user.\n```php\nfunction reset_password($token, $new_password) {\n  // Connect to database (assuming you're using MySQL)\n  $db = mysqli_connect(\"localhost\", \"username\", \"password\", \"database\");\n\n  // Check if token is valid\n  $query = \"SELECT * FROM users WHERE password_reset_token = '$token'\";\n  $result = mysqli_query($db, $query);\n  if (mysqli_num_rows($result) == 0) {\n    return \"Invalid token\";\n  }\n\n  // Update the user's record with the new password\n  $query = \"UPDATE users SET password = '$new_password', password_reset_token = NULL WHERE password_reset_token = '$token'\";\n  mysqli_query($db, $query);\n\n  return \"Password reset successfully\";\n}\n```\n**Explanation**\n\n1. The function takes a token and a new password as input.\n2. It connects to the database and checks if the token is valid by querying the `users` table.\n3. If the token is valid, it updates the user's record with the new password and resets the `password_reset_token`.\n4. It returns a success message.\n\n**Example Use Case**\n\nTo use these functions, you can call them from your PHP script like this:\n```php\n$email = \"user@example.com\";\n$password = \"new_password\";\n\n// Call forgot_password function to send email with reset link\necho forgot_password($email);\n\n// Call reset_password function to update user's password\necho reset_password($token, $password);\n```\nNote that you should replace the placeholders (`localhost`, `username`, `password`, `database`) with your actual database credentials and table names.\n\nAlso, make sure to implement proper error handling and security measures (e.g., password hashing) when storing and retrieving user passwords.", "code_blocks": ["```php\nfunction forgot_password($email) {\n  // Connect to database (assuming you're using MySQL)\n  $db = mysqli_connect(\"localhost\", \"username\", \"password\", \"database\");\n\n  // Check if email exists in database\n  $query = \"SELECT * FROM users WHERE email = '$email'\";\n  $result = mysqli_query($db, $query);\n  if (mysqli_num_rows($result) == 0) {\n    return \"Email not found\";\n  }\n\n  // Generate a random token for the user to reset their password\n  $token = bin2hex(random_bytes(16));\n\n  // Update the user's record with the new token\n  $query = \"UPDATE users SET password_reset_token = '$token' WHERE email = '$email'\";\n  mysqli_query($db, $query);\n\n  // Send an email to the user with a link to reset their password\n  $subject = \"Reset your password\";\n  $message = \"\n    <p>Hello $email,</p>\n    <p>Click on the following link to reset your password:</p>\n    <p><a href='\" . url('reset-password', ['token' => $token]) . \"'>Reset Password</a></p>\n  \";\n  mail($email, $subject, $message);\n\n  return \"Password reset email sent\";\n}\n```", "```php\nfunction reset_password($token, $new_password) {\n  // Connect to database (assuming you're using MySQL)\n  $db = mysqli_connect(\"localhost\", \"username\", \"password\", \"database\");\n\n  // Check if token is valid\n  $query = \"SELECT * FROM users WHERE password_reset_token = '$token'\";\n  $result = mysqli_query($db, $query);\n  if (mysqli_num_rows($result) == 0) {\n    return \"Invalid token\";\n  }\n\n  // Update the user's record with the new password\n  $query = \"UPDATE users SET password = '$new_password', password_reset_token = NULL WHERE password_reset_token = '$token'\";\n  mysqli_query($db, $query);\n\n  return \"Password reset successfully\";\n}\n```", "```php\n$email = \"user@example.com\";\n$password = \"new_password\";\n\n// Call forgot_password function to send email with reset link\necho forgot_password($email);\n\n// Call reset_password function to update user's password\necho reset_password($token, $password);\n```"]}
