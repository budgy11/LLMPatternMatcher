{"prompt": "Create a forgot password function using php", "llm_output": "Here is an example of how you can create a forgot password function in PHP:\n\n**Database Schema**\n\nFirst, let's assume we have a database table `users` with the following structure:\n```sql\nCREATE TABLE users (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  email VARCHAR(255) NOT NULL,\n  password VARCHAR(255) NOT NULL\n);\n```\n**Forgot Password Function**\n\nCreate a new PHP file called `forgot_password.php` and add the following code:\n```php\n<?php\n\n// Configuration\n$db_host = 'localhost';\n$db_username = 'root';\n$db_password = '';\n$db_name = 'mydatabase';\n\n// Connect to database\n$conn = mysqli_connect($db_host, $db_username, $db_password, $db_name);\n\nif (!$conn) {\n  die(\"Connection failed: \" . mysqli_connect_error());\n}\n\nfunction forgotPassword($email)\n{\n  // Check if email exists in the database\n  $query = \"SELECT * FROM users WHERE email='$email'\";\n  $result = mysqli_query($conn, $query);\n  if (mysqli_num_rows($result) > 0) {\n    // Email found, send password reset link\n    $token = bin2hex(random_bytes(32));\n    $query = \"UPDATE users SET token='$token' WHERE email='$email'\";\n    mysqli_query($conn, $query);\n\n    // Send email with password reset link\n    $subject = 'Reset your password';\n    $body = '<a href=\"' . $_SERVER['HTTP_HOST'] . '/reset_password.php?token=' . $token . '\">Click here to reset your password</a>';\n    mail($email, $subject, $body);\n\n    echo \"A password reset link has been sent to your email.\";\n  } else {\n    echo \"Email not found in the database.\";\n  }\n}\n\nif (isset($_POST['forgot_password'])) {\n  $email = $_POST['email'];\n  forgotPassword($email);\n} else {\n  // Display form\n?>\n\n<form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\">\n  <label>Email:</label>\n  <input type=\"text\" name=\"email\"><br><br>\n  <input type=\"submit\" name=\"forgot_password\" value=\"Send Password Reset Link\">\n</form>\n\n<?php } ?>\n```\n**Explanation**\n\nThis code creates a function `forgotPassword($email)` that takes an email address as input and checks if it exists in the database. If the email is found, it generates a random token, updates the user's record with the new token, and sends an email with a password reset link to the user.\n\nThe email contains a link to a `reset_password.php` page that will be created next, which will allow the user to enter their new password and have it updated in the database.\n\n**Next Step:**\n\nCreate a new PHP file called `reset_password.php` and add the following code:\n```php\n<?php\n\n// Configuration\n$db_host = 'localhost';\n$db_username = 'root';\n$db_password = '';\n$db_name = 'mydatabase';\n\n// Connect to database\n$conn = mysqli_connect($db_host, $db_username, $db_password, $db_name);\n\nif (!$conn) {\n  die(\"Connection failed: \" . mysqli_connect_error());\n}\n\nif (isset($_GET['token'])) {\n  // Get user ID from token\n  $query = \"SELECT * FROM users WHERE token='$_GET[token]'\";\n  $result = mysqli_query($conn, $query);\n  if (mysqli_num_rows($result) > 0) {\n    // Update password\n    $new_password = $_POST['new_password'];\n    $query = \"UPDATE users SET password='$new_password' WHERE id=(SELECT id FROM users WHERE token='$_GET[token]')\";\n    mysqli_query($conn, $query);\n\n    echo \"Your password has been updated.\";\n  } else {\n    echo \"Invalid token.\";\n  }\n}\n\n?>\n\n<form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\">\n  <label>New Password:</label>\n  <input type=\"password\" name=\"new_password\"><br><br>\n  <input type=\"submit\" value=\"Update Password\">\n</form>\n```\nThis code creates a form that allows the user to enter their new password and have it updated in the database. The `$_GET['token']` variable is used to retrieve the user's ID from the token stored in the database.\n\n**Security Notes:**\n\n* Always validate user input to prevent SQL injection attacks.\n* Use prepared statements or parameterized queries to prevent SQL injection attacks.\n* Never store passwords in plain text; use a secure password hashing algorithm like bcrypt, PBKDF2, or Argon2.\n* Always use HTTPS (SSL/TLS) to encrypt data transmitted between the client and server.", "code_blocks": [null, "```php\n<?php\n\n// Configuration\n$db_host = 'localhost';\n$db_username = 'root';\n$db_password = '';\n$db_name = 'mydatabase';\n\n// Connect to database\n$conn = mysqli_connect($db_host, $db_username, $db_password, $db_name);\n\nif (!$conn) {\n  die(\"Connection failed: \" . mysqli_connect_error());\n}\n\nfunction forgotPassword($email)\n{\n  // Check if email exists in the database\n  $query = \"SELECT * FROM users WHERE email='$email'\";\n  $result = mysqli_query($conn, $query);\n  if (mysqli_num_rows($result) > 0) {\n    // Email found, send password reset link\n    $token = bin2hex(random_bytes(32));\n    $query = \"UPDATE users SET token='$token' WHERE email='$email'\";\n    mysqli_query($conn, $query);\n\n    // Send email with password reset link\n    $subject = 'Reset your password';\n    $body = '<a href=\"' . $_SERVER['HTTP_HOST'] . '/reset_password.php?token=' . $token . '\">Click here to reset your password</a>';\n    mail($email, $subject, $body);\n\n    echo \"A password reset link has been sent to your email.\";\n  } else {\n    echo \"Email not found in the database.\";\n  }\n}\n\nif (isset($_POST['forgot_password'])) {\n  $email = $_POST['email'];\n  forgotPassword($email);\n} else {\n  // Display form\n?>\n\n<form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\">\n  <label>Email:</label>\n  <input type=\"text\" name=\"email\"><br><br>\n  <input type=\"submit\" name=\"forgot_password\" value=\"Send Password Reset Link\">\n</form>\n\n<?php } ?>\n```", "```php\n<?php\n\n// Configuration\n$db_host = 'localhost';\n$db_username = 'root';\n$db_password = '';\n$db_name = 'mydatabase';\n\n// Connect to database\n$conn = mysqli_connect($db_host, $db_username, $db_password, $db_name);\n\nif (!$conn) {\n  die(\"Connection failed: \" . mysqli_connect_error());\n}\n\nif (isset($_GET['token'])) {\n  // Get user ID from token\n  $query = \"SELECT * FROM users WHERE token='$_GET[token]'\";\n  $result = mysqli_query($conn, $query);\n  if (mysqli_num_rows($result) > 0) {\n    // Update password\n    $new_password = $_POST['new_password'];\n    $query = \"UPDATE users SET password='$new_password' WHERE id=(SELECT id FROM users WHERE token='$_GET[token]')\";\n    mysqli_query($conn, $query);\n\n    echo \"Your password has been updated.\";\n  } else {\n    echo \"Invalid token.\";\n  }\n}\n\n?>\n\n<form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\">\n  <label>New Password:</label>\n  <input type=\"password\" name=\"new_password\"><br><br>\n  <input type=\"submit\" value=\"Update Password\">\n</form>\n```"]}
