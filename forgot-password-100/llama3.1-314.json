{"prompt": "Create a forgot password function using php", "llm_output": "Here is an example of how to create a \"Forgot Password\" function using PHP:\n\n**Database Schema:**\n\nLet's assume we have a database table `users` with the following columns:\n\n| Column Name | Data Type |\n| --- | --- |\n| id | int (primary key) |\n| email | varchar(255) |\n| password | varchar(255) |\n\n**Forgot Password Function:**\n\nCreate a PHP file named `forgot_password.php`. This will handle the forgot password functionality.\n```php\n<?php\n\n// Configuration\ndefine('DB_HOST', 'localhost');\ndefine('DB_USER', 'root');\ndefine('DB_PASSWORD', '');\ndefine('DB_NAME', 'your_database');\n\n// Connect to database\n$conn = mysqli_connect(DB_HOST, DB_USER, DB_PASSWORD, DB_NAME);\n\nif (!$conn) {\n    die(\"Connection failed: \" . mysqli_connect_error());\n}\n\n// Check if email is set\nif (isset($_POST['email'])) {\n\n    // Sanitize input\n    $email = trim($_POST['email']);\n\n    // Query to check if user exists with given email\n    $query = \"SELECT * FROM users WHERE email = '$email'\";\n    $result = mysqli_query($conn, $query);\n\n    if (mysqli_num_rows($result) > 0) {\n\n        // Get user's ID and password reset token\n        $user_data = mysqli_fetch_assoc($result);\n        $password_reset_token = bin2hex(random_bytes(32));\n\n        // Update user data with new password reset token\n        $query_update = \"UPDATE users SET password_reset_token = '$password_reset_token' WHERE id = '\" . $user_data['id'] . \"'\";\n        mysqli_query($conn, $query_update);\n\n        // Send email to user with password reset link\n        send_password_reset_email($email, $password_reset_token);\n    } else {\n        echo \"Email not found.\";\n    }\n\n} else {\n    echo \"Please enter your email address.\";\n}\n\n// Close database connection\nmysqli_close($conn);\n\n// Function to send password reset email\nfunction send_password_reset_email($email, $token) {\n    // Send mail using PHPMailer or your preferred method\n    $subject = 'Password Reset';\n    $body = \"Click this link to reset your password: <a href='reset_password.php?token=\" . $token . \"'>Reset Password</a>\";\n    $headers = \"From: info@example.com\";\n\n    if (mail($email, $subject, $body, $headers)) {\n        echo \"Email sent.\";\n    } else {\n        echo \"Error sending email.\";\n    }\n}\n\n?>\n```\n**Explanation:**\n\n1. The script first connects to the database using the `mysqli` extension.\n2. It checks if an email is submitted in the form (using `isset($_POST['email'])`). If not, it displays a message asking for the email address.\n3. Once an email is provided, it queries the database to check if there's a user with that email address. If found, it generates a new password reset token using `bin2hex(random_bytes(32))`.\n4. The script updates the user data in the database with the new password reset token.\n5. Finally, it sends an email to the user containing a link to reset their password. The link includes the password reset token.\n\n**Example Use Case:**\n\nTo use this function, you'll need to create a form that collects the user's email address and submits it to `forgot_password.php`. For example:\n```html\n<form action=\"forgot_password.php\" method=\"post\">\n    <input type=\"email\" name=\"email\" placeholder=\"Enter your email address\">\n    <button type=\"submit\">Send Reset Link</button>\n</form>\n```\nWhen a user clicks the \"Send Reset Link\" button, they'll be redirected to `forgot_password.php`, which will process their request and send an email with a password reset link. The user can then click this link to reset their password on the `reset_password.php` page.\n\nNote: This is a basic implementation of a forgot password function using PHP. You should consider adding additional security measures, such as:\n\n* Using prepared statements or parameterized queries\n* Validating and sanitizing input data\n* Implementing CAPTCHA for spam protection\n* Storing password reset tokens securely (e.g., using a secure token storage system)\n* Considering two-factor authentication for added security", "code_blocks": ["```php\n<?php\n\n// Configuration\ndefine('DB_HOST', 'localhost');\ndefine('DB_USER', 'root');\ndefine('DB_PASSWORD', '');\ndefine('DB_NAME', 'your_database');\n\n// Connect to database\n$conn = mysqli_connect(DB_HOST, DB_USER, DB_PASSWORD, DB_NAME);\n\nif (!$conn) {\n    die(\"Connection failed: \" . mysqli_connect_error());\n}\n\n// Check if email is set\nif (isset($_POST['email'])) {\n\n    // Sanitize input\n    $email = trim($_POST['email']);\n\n    // Query to check if user exists with given email\n    $query = \"SELECT * FROM users WHERE email = '$email'\";\n    $result = mysqli_query($conn, $query);\n\n    if (mysqli_num_rows($result) > 0) {\n\n        // Get user's ID and password reset token\n        $user_data = mysqli_fetch_assoc($result);\n        $password_reset_token = bin2hex(random_bytes(32));\n\n        // Update user data with new password reset token\n        $query_update = \"UPDATE users SET password_reset_token = '$password_reset_token' WHERE id = '\" . $user_data['id'] . \"'\";\n        mysqli_query($conn, $query_update);\n\n        // Send email to user with password reset link\n        send_password_reset_email($email, $password_reset_token);\n    } else {\n        echo \"Email not found.\";\n    }\n\n} else {\n    echo \"Please enter your email address.\";\n}\n\n// Close database connection\nmysqli_close($conn);\n\n// Function to send password reset email\nfunction send_password_reset_email($email, $token) {\n    // Send mail using PHPMailer or your preferred method\n    $subject = 'Password Reset';\n    $body = \"Click this link to reset your password: <a href='reset_password.php?token=\" . $token . \"'>Reset Password</a>\";\n    $headers = \"From: info@example.com\";\n\n    if (mail($email, $subject, $body, $headers)) {\n        echo \"Email sent.\";\n    } else {\n        echo \"Error sending email.\";\n    }\n}\n\n?>\n```", null]}
