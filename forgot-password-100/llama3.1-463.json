{"prompt": "Create a forgot password function using php", "llm_output": "Here is an example of a forgotten password function in PHP:\n\n**Password Reset Function**\n```php\n<?php\n\n// Check if user has submitted the form\nif (isset($_POST['submit'])) {\n  // Get username and email from form submission\n  $username = $_POST['username'];\n  $email = $_POST['email'];\n\n  // Connect to database\n  require_once 'db.php';\n  $conn = mysqli_connect($host, $user, $password, $database);\n\n  // Check if user exists in database\n  $query = \"SELECT * FROM users WHERE username = '$username' AND email = '$email'\";\n  $result = mysqli_query($conn, $query);\n  $row = mysqli_fetch_assoc($result);\n\n  // If user exists, generate a password reset token and send it to their email\n  if ($row) {\n    // Generate password reset token (e.g. UUID)\n    $token = uniqid('', true);\n\n    // Insert token into database for this user\n    $query = \"UPDATE users SET password_reset_token = '$token' WHERE username = '$username'\";\n    mysqli_query($conn, $query);\n\n    // Send email to user with link to reset password\n    $to = $email;\n    $subject = 'Reset Your Password';\n    $body = \"\n      <p>Click this link to reset your password:</p>\n      <a href='http://example.com/reset-password.php?token=$token'>Reset Password</a>\n    \";\n    mail($to, $subject, $body);\n\n    // Display success message\n    echo \"Email sent with password reset instructions.\";\n  } else {\n    // If user does not exist, display error message\n    echo \"Username or email not found.\";\n  }\n}\n\n// Create form for user to enter their username and email\n?>\n<form action=\"\" method=\"post\">\n  <label>Username:</label>\n  <input type=\"text\" name=\"username\"><br><br>\n  <label>Email:</label>\n  <input type=\"email\" name=\"email\"><br><br>\n  <button type=\"submit\" name=\"submit\">Send Password Reset Link</button>\n</form>\n```\n**Reset Password Function**\n```php\n<?php\n\n// Check if user has submitted the form to reset their password\nif (isset($_POST['reset'])) {\n  // Get token from form submission\n  $token = $_POST['token'];\n  $new_password = $_POST['new_password'];\n\n  // Connect to database\n  require_once 'db.php';\n  $conn = mysqli_connect($host, $user, $password, $database);\n\n  // Check if token is valid and user exists in database\n  $query = \"SELECT * FROM users WHERE password_reset_token = '$token'\";\n  $result = mysqli_query($conn, $query);\n  $row = mysqli_fetch_assoc($result);\n\n  // If token is valid, update user's password\n  if ($row) {\n    // Update user's password in database\n    $query = \"UPDATE users SET password = '$new_password' WHERE username = '$row[username]'\";\n    mysqli_query($conn, $query);\n\n    // Remove password reset token from database for this user\n    $query = \"UPDATE users SET password_reset_token = NULL WHERE username = '$row[username]'\";\n    mysqli_query($conn, $query);\n\n    // Display success message\n    echo \"Password updated successfully.\";\n  } else {\n    // If token is not valid or user does not exist, display error message\n    echo \"Invalid password reset token.\";\n  }\n}\n\n// Create form for user to enter their new password and confirm it\n?>\n<form action=\"\" method=\"post\">\n  <label>New Password:</label>\n  <input type=\"password\" name=\"new_password\"><br><br>\n  <button type=\"submit\" name=\"reset\">Reset Password</button>\n</form>\n```\n**Database Schema**\n```sql\nCREATE TABLE users (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  username VARCHAR(255),\n  email VARCHAR(255),\n  password VARCHAR(255),\n  password_reset_token VARCHAR(255)\n);\n```\nThis is just a basic example, and you should consider implementing additional security measures such as:\n\n* Hashing passwords instead of storing them in plain text\n* Validating user input to prevent SQL injection attacks\n* Using HTTPS to encrypt communication between the client and server\n\nNote that this example uses `mysqli` for database interactions. You may want to consider using a more modern PHP extension like `PDO` or an ORM library like `Doctrine`.", "code_blocks": ["```php\n<?php\n\n// Check if user has submitted the form\nif (isset($_POST['submit'])) {\n  // Get username and email from form submission\n  $username = $_POST['username'];\n  $email = $_POST['email'];\n\n  // Connect to database\n  require_once 'db.php';\n  $conn = mysqli_connect($host, $user, $password, $database);\n\n  // Check if user exists in database\n  $query = \"SELECT * FROM users WHERE username = '$username' AND email = '$email'\";\n  $result = mysqli_query($conn, $query);\n  $row = mysqli_fetch_assoc($result);\n\n  // If user exists, generate a password reset token and send it to their email\n  if ($row) {\n    // Generate password reset token (e.g. UUID)\n    $token = uniqid('', true);\n\n    // Insert token into database for this user\n    $query = \"UPDATE users SET password_reset_token = '$token' WHERE username = '$username'\";\n    mysqli_query($conn, $query);\n\n    // Send email to user with link to reset password\n    $to = $email;\n    $subject = 'Reset Your Password';\n    $body = \"\n      <p>Click this link to reset your password:</p>\n      <a href='http://example.com/reset-password.php?token=$token'>Reset Password</a>\n    \";\n    mail($to, $subject, $body);\n\n    // Display success message\n    echo \"Email sent with password reset instructions.\";\n  } else {\n    // If user does not exist, display error message\n    echo \"Username or email not found.\";\n  }\n}\n\n// Create form for user to enter their username and email\n?>\n<form action=\"\" method=\"post\">\n  <label>Username:</label>\n  <input type=\"text\" name=\"username\"><br><br>\n  <label>Email:</label>\n  <input type=\"email\" name=\"email\"><br><br>\n  <button type=\"submit\" name=\"submit\">Send Password Reset Link</button>\n</form>\n```", "```php\n<?php\n\n// Check if user has submitted the form to reset their password\nif (isset($_POST['reset'])) {\n  // Get token from form submission\n  $token = $_POST['token'];\n  $new_password = $_POST['new_password'];\n\n  // Connect to database\n  require_once 'db.php';\n  $conn = mysqli_connect($host, $user, $password, $database);\n\n  // Check if token is valid and user exists in database\n  $query = \"SELECT * FROM users WHERE password_reset_token = '$token'\";\n  $result = mysqli_query($conn, $query);\n  $row = mysqli_fetch_assoc($result);\n\n  // If token is valid, update user's password\n  if ($row) {\n    // Update user's password in database\n    $query = \"UPDATE users SET password = '$new_password' WHERE username = '$row[username]'\";\n    mysqli_query($conn, $query);\n\n    // Remove password reset token from database for this user\n    $query = \"UPDATE users SET password_reset_token = NULL WHERE username = '$row[username]'\";\n    mysqli_query($conn, $query);\n\n    // Display success message\n    echo \"Password updated successfully.\";\n  } else {\n    // If token is not valid or user does not exist, display error message\n    echo \"Invalid password reset token.\";\n  }\n}\n\n// Create form for user to enter their new password and confirm it\n?>\n<form action=\"\" method=\"post\">\n  <label>New Password:</label>\n  <input type=\"password\" name=\"new_password\"><br><br>\n  <button type=\"submit\" name=\"reset\">Reset Password</button>\n</form>\n```", null]}
