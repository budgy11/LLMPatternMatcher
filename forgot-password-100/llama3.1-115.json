{"prompt": "Create a forgot password function using php", "llm_output": "Here is an example of how you can create a \"forgot password\" function in PHP:\n\n**Database Table**\n\nAssuming we have a database table `users` with the following structure:\n```sql\nCREATE TABLE users (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  username VARCHAR(255) NOT NULL,\n  email VARCHAR(255) NOT NULL,\n  password_hash VARCHAR(255) NOT NULL\n);\n```\n**Forgot Password Function**\n\nCreate a new PHP file, e.g. `forgot_password.php`, with the following code:\n```php\n<?php\n\n// Configuration settings\ndefine('DB_HOST', 'localhost');\ndefine('DB_USERNAME', 'your_username');\ndefine('DB_PASSWORD', 'your_password');\ndefine('DB_NAME', 'your_database_name');\n\n// Connect to database\n$conn = new mysqli(DB_HOST, DB_USERNAME, DB_PASSWORD, DB_NAME);\n\nif ($conn->connect_error) {\n  die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Define function to handle forgot password request\nfunction forgot_password($email) {\n  global $conn;\n\n  // Query database for user's email and username\n  $query = \"SELECT * FROM users WHERE email = '$email'\";\n  $result = $conn->query($query);\n\n  if ($result->num_rows > 0) {\n    // Get user data from result\n    $user_data = $result->fetch_assoc();\n\n    // Generate random password and hash it\n    $password = bin2hex(random_bytes(32));\n    $hashed_password = password_hash($password, PASSWORD_DEFAULT);\n\n    // Update user's password in database\n    $query = \"UPDATE users SET password_hash = '$hashed_password' WHERE email = '$email'\";\n    $result = $conn->query($query);\n\n    if ($result) {\n      // Send email with new password to user\n      send_reset_password_email($user_data['username'], $password);\n      return true;\n    } else {\n      echo \"Error updating password: \" . $conn->error;\n      return false;\n    }\n  } else {\n    echo \"User not found\";\n    return false;\n  }\n\n  return false;\n}\n\n// Define function to send email with new password\nfunction send_reset_password_email($username, $password) {\n  // Email settings (e.g. SMTP server, etc.)\n  $from = 'your_email@example.com';\n  $to = $_POST['email'];\n  $subject = \"Reset your password\";\n  $body = \"Dear $username, your new password is: $password\";\n\n  // Send email using mail() function\n  if (mail($to, $subject, $body, \"From: $from\")) {\n    echo \"Email sent successfully!\";\n  } else {\n    echo \"Error sending email: \" . mail_error();\n  }\n}\n\n// Handle forgot password request\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n  $email = $_POST['email'];\n  if (forgot_password($email)) {\n    echo \"Password reset successfully! Please check your email for new password.\";\n  } else {\n    echo \"Error resetting password\";\n  }\n}\n\n// Close database connection\n$conn->close();\n\n?>\n```\n**Usage**\n\nTo use this code, simply create a new form in your HTML file with an input field for the user's email address. When the form is submitted, it will call the `forgot_password` function, which will:\n\n1. Query the database to retrieve the user's data.\n2. Generate a random password and hash it using the `password_hash` function.\n3. Update the user's password in the database.\n4. Send an email with the new password to the user.\n\nNote: This is just an example code, you should adapt it to your specific needs and requirements. Additionally, make sure to replace the placeholders (e.g. `your_username`, `your_password`, etc.) with your actual database credentials and settings.", "code_blocks": [null, "```php\n<?php\n\n// Configuration settings\ndefine('DB_HOST', 'localhost');\ndefine('DB_USERNAME', 'your_username');\ndefine('DB_PASSWORD', 'your_password');\ndefine('DB_NAME', 'your_database_name');\n\n// Connect to database\n$conn = new mysqli(DB_HOST, DB_USERNAME, DB_PASSWORD, DB_NAME);\n\nif ($conn->connect_error) {\n  die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Define function to handle forgot password request\nfunction forgot_password($email) {\n  global $conn;\n\n  // Query database for user's email and username\n  $query = \"SELECT * FROM users WHERE email = '$email'\";\n  $result = $conn->query($query);\n\n  if ($result->num_rows > 0) {\n    // Get user data from result\n    $user_data = $result->fetch_assoc();\n\n    // Generate random password and hash it\n    $password = bin2hex(random_bytes(32));\n    $hashed_password = password_hash($password, PASSWORD_DEFAULT);\n\n    // Update user's password in database\n    $query = \"UPDATE users SET password_hash = '$hashed_password' WHERE email = '$email'\";\n    $result = $conn->query($query);\n\n    if ($result) {\n      // Send email with new password to user\n      send_reset_password_email($user_data['username'], $password);\n      return true;\n    } else {\n      echo \"Error updating password: \" . $conn->error;\n      return false;\n    }\n  } else {\n    echo \"User not found\";\n    return false;\n  }\n\n  return false;\n}\n\n// Define function to send email with new password\nfunction send_reset_password_email($username, $password) {\n  // Email settings (e.g. SMTP server, etc.)\n  $from = 'your_email@example.com';\n  $to = $_POST['email'];\n  $subject = \"Reset your password\";\n  $body = \"Dear $username, your new password is: $password\";\n\n  // Send email using mail() function\n  if (mail($to, $subject, $body, \"From: $from\")) {\n    echo \"Email sent successfully!\";\n  } else {\n    echo \"Error sending email: \" . mail_error();\n  }\n}\n\n// Handle forgot password request\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n  $email = $_POST['email'];\n  if (forgot_password($email)) {\n    echo \"Password reset successfully! Please check your email for new password.\";\n  } else {\n    echo \"Error resetting password\";\n  }\n}\n\n// Close database connection\n$conn->close();\n\n?>\n```"]}
