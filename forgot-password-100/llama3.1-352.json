{"prompt": "Create a forgot password function using php", "llm_output": "Here is an example of a forgotten password function using PHP:\n\n** Forgotten Password Function **\n\nThis script will send an email to the user with a link that allows them to reset their password.\n\n### Requirements\n\n* PHP 5.3 or higher\n* Email account (for sending emails)\n* MySQL database (for storing users and passwords)\n\n### Code\n\n** forgot_password.php **\n```php\n<?php\nrequire_once 'dbconnect.php';\n\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n    $email = $_POST['email'];\n\n    // Check if email is valid\n    if (!filter_var($email, FILTER_VALIDATE_EMAIL)) {\n        echo json_encode(array('error' => 'Invalid email address'));\n        exit;\n    }\n\n    // Query database for user\n    $query = \"SELECT * FROM users WHERE email = '$email'\";\n    $result = mysqli_query($conn, $query);\n\n    if (mysqli_num_rows($result) == 0) {\n        echo json_encode(array('error' => 'Email not found'));\n        exit;\n    }\n\n    // Get user ID\n    $row = mysqli_fetch_assoc($result);\n    $userId = $row['id'];\n\n    // Generate token for password reset\n    $token = bin2hex(random_bytes(32));\n\n    // Update database with new token\n    $query = \"UPDATE users SET token = '$token' WHERE id = '$userId'\";\n    mysqli_query($conn, $query);\n\n    // Send email to user\n    $subject = 'Reset your password';\n    $message = '\n        <p>Dear user,</p>\n        <p>You are receiving this email because we received a request to reset your password.</p>\n        <p>To reset your password, click on the following link:</p>\n        <a href=\"' . $_SERVER['HTTP_HOST'] . '/reset_password.php?token=' . $token . '\">Reset Password</a>\n        <p>Sincerely,</p>\n        <p>Your website admin</p>\n    ';\n    $headers = 'From: your_email@example.com' . \"\\r\\n\" .\n               'Content-Type: text/html; charset=utf-8';\n    mail($email, $subject, $message, $headers);\n\n    echo json_encode(array('success' => 'Password reset link sent to email'));\n} else {\n    ?>\n    <form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\">\n        <input type=\"text\" name=\"email\" placeholder=\"Email address\">\n        <button type=\"submit\">Send Password Reset Link</button>\n    </form>\n    <?php\n}\n?>\n```\n\n** reset_password.php **\n```php\n<?php\nrequire_once 'dbconnect.php';\n\n$token = $_GET['token'];\n\n// Check if token is valid\n$query = \"SELECT * FROM users WHERE token = '$token'\";\n$result = mysqli_query($conn, $query);\n\nif (mysqli_num_rows($result) == 0) {\n    echo json_encode(array('error' => 'Invalid token'));\n    exit;\n}\n\n// Get user ID\n$row = mysqli_fetch_assoc($result);\n$userId = $row['id'];\n\n// Generate new password\n$newPassword = bin2hex(random_bytes(32));\n\n// Update database with new password\n$query = \"UPDATE users SET password = '$newPassword' WHERE id = '$userId'\";\nmysqli_query($conn, $query);\n\necho json_encode(array('success' => 'Password reset successful'));\n?>\n```\n\n** dbconnect.php **\n```php\n<?php\n$conn = mysqli_connect(\"localhost\", \"username\", \"password\", \"database\");\nif (!$conn) {\n    die(\"Connection failed: \" . mysqli_error($conn));\n}\n?>\n```\nNote that this is a basic example and you should adjust it to fit your specific needs. You may also want to add additional security measures, such as hashing the user's password before storing it in the database.\n\n** Security Considerations **\n\n* Always validate user input (e.g. email address) to prevent SQL injection attacks.\n* Use prepared statements or parameterized queries to prevent SQL injection attacks.\n* Store passwords securely using a library like PHPass or PBKDF2.\n* Use HTTPS to encrypt data transmitted between the client and server.\n\nI hope this helps! Let me know if you have any questions.", "code_blocks": ["```php\n<?php\nrequire_once 'dbconnect.php';\n\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n    $email = $_POST['email'];\n\n    // Check if email is valid\n    if (!filter_var($email, FILTER_VALIDATE_EMAIL)) {\n        echo json_encode(array('error' => 'Invalid email address'));\n        exit;\n    }\n\n    // Query database for user\n    $query = \"SELECT * FROM users WHERE email = '$email'\";\n    $result = mysqli_query($conn, $query);\n\n    if (mysqli_num_rows($result) == 0) {\n        echo json_encode(array('error' => 'Email not found'));\n        exit;\n    }\n\n    // Get user ID\n    $row = mysqli_fetch_assoc($result);\n    $userId = $row['id'];\n\n    // Generate token for password reset\n    $token = bin2hex(random_bytes(32));\n\n    // Update database with new token\n    $query = \"UPDATE users SET token = '$token' WHERE id = '$userId'\";\n    mysqli_query($conn, $query);\n\n    // Send email to user\n    $subject = 'Reset your password';\n    $message = '\n        <p>Dear user,</p>\n        <p>You are receiving this email because we received a request to reset your password.</p>\n        <p>To reset your password, click on the following link:</p>\n        <a href=\"' . $_SERVER['HTTP_HOST'] . '/reset_password.php?token=' . $token . '\">Reset Password</a>\n        <p>Sincerely,</p>\n        <p>Your website admin</p>\n    ';\n    $headers = 'From: your_email@example.com' . \"\\r\\n\" .\n               'Content-Type: text/html; charset=utf-8';\n    mail($email, $subject, $message, $headers);\n\n    echo json_encode(array('success' => 'Password reset link sent to email'));\n} else {\n    ?>\n    <form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\">\n        <input type=\"text\" name=\"email\" placeholder=\"Email address\">\n        <button type=\"submit\">Send Password Reset Link</button>\n    </form>\n    <?php\n}\n?>\n```", "```php\n<?php\nrequire_once 'dbconnect.php';\n\n$token = $_GET['token'];\n\n// Check if token is valid\n$query = \"SELECT * FROM users WHERE token = '$token'\";\n$result = mysqli_query($conn, $query);\n\nif (mysqli_num_rows($result) == 0) {\n    echo json_encode(array('error' => 'Invalid token'));\n    exit;\n}\n\n// Get user ID\n$row = mysqli_fetch_assoc($result);\n$userId = $row['id'];\n\n// Generate new password\n$newPassword = bin2hex(random_bytes(32));\n\n// Update database with new password\n$query = \"UPDATE users SET password = '$newPassword' WHERE id = '$userId'\";\nmysqli_query($conn, $query);\n\necho json_encode(array('success' => 'Password reset successful'));\n?>\n```", "```php\n<?php\n$conn = mysqli_connect(\"localhost\", \"username\", \"password\", \"database\");\nif (!$conn) {\n    die(\"Connection failed: \" . mysqli_error($conn));\n}\n?>\n```"]}
