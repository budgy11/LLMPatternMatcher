{"prompt": "Create a forgot password function using php", "llm_output": "Here is an example of how you can create a \"Forgot Password\" function using PHP:\n\n**Database Table Structure**\n\nFirst, let's assume we have a database table called `users` with the following structure:\n```sql\nCREATE TABLE users (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  email VARCHAR(255) UNIQUE NOT NULL,\n  password_hash VARCHAR(255) NOT NULL\n);\n```\n**PHP Code**\n\nCreate a new file called `forgot_password.php` and add the following code:\n```php\n<?php\n\n// Configuration variables\ndefine('DB_HOST', 'localhost');\ndefine('DB_USERNAME', 'your_username');\ndefine('DB_PASSWORD', 'your_password');\ndefine('DB_NAME', 'your_database');\n\n// Database connection\n$conn = new mysqli(DB_HOST, DB_USERNAME, DB_PASSWORD, DB_NAME);\n\nif ($conn->connect_error) {\n  die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Function to send password reset email\nfunction sendPasswordResetEmail($email) {\n  // Generate a random token for the password reset\n  $token = bin2hex(random_bytes(32));\n  \n  // Insert the token into the database\n  $query = \"INSERT INTO password_resets (user_id, token) VALUES (?, ?)\";\n  $stmt = $conn->prepare($query);\n  $stmt->bind_param(\"is\", $_SESSION['user_id'], $token);\n  $stmt->execute();\n  \n  // Send the email with the reset link\n  $subject = \"Reset Your Password\";\n  $body = \"\n    <p>Hello!</p>\n    <p>To reset your password, click on this link:</p>\n    <a href='http://your-website.com/reset-password?token=$token'>Reset Password</a>\n  \";\n  \n  // Send the email using PHPMailer or any other mail library\n  $mail = new PHPMailer();\n  $mail->isSMTP();\n  $mail->Host = 'smtp.gmail.com';\n  $mail->Port = 587;\n  $mail->SMTPAuth = true;\n  $mail->Username = 'your-email@gmail.com';\n  $mail->Password = 'your-password';\n  $mail->setFrom('your-email@gmail.com', 'Your Name');\n  $mail->addAddress($email);\n  $mail->Subject = $subject;\n  $mail->Body = $body;\n  if (!$mail->send()) {\n    echo \"Mailer Error: \" . $mail->ErrorInfo;\n    exit();\n  }\n}\n\n// Handle the forgot password form submission\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n  // Get the email from the form\n  $email = $_POST['email'];\n  \n  // Check if the email exists in the database\n  $query = \"SELECT * FROM users WHERE email = ?\";\n  $stmt = $conn->prepare($query);\n  $stmt->bind_param(\"s\", $email);\n  $stmt->execute();\n  $result = $stmt->get_result();\n  \n  if ($result->num_rows > 0) {\n    // Send the password reset email\n    sendPasswordResetEmail($email);\n    echo \"A password reset link has been sent to your email.\";\n  } else {\n    echo \"Invalid email address.\";\n  }\n}\n\n?>\n```\n**HTML Form**\n\nCreate a new file called `forgot_password.html` and add the following code:\n```html\n<!DOCTYPE html>\n<html>\n<head>\n  <title>Forgot Password</title>\n</head>\n<body>\n  <h1>Forgotten your password?</h1>\n  <form action=\"forgot_password.php\" method=\"post\">\n    <label for=\"email\">Email:</label>\n    <input type=\"email\" id=\"email\" name=\"email\"><br><br>\n    <button type=\"submit\">Reset Password</button>\n  </form>\n</body>\n</html>\n```\n**How it works**\n\n1. The user submits the forgot password form with their email address.\n2. The PHP script checks if the email exists in the database and if so, generates a random token for the password reset.\n3. The token is inserted into the `password_resets` table along with the user's ID.\n4. An email is sent to the user with a link to reset their password. The link contains the token.\n5. When the user clicks on the link, they are taken to a page where they can enter their new password.\n\nNote: This is just an example code and you should modify it according to your needs and database structure. Also, make sure to secure your database credentials and other sensitive information.", "code_blocks": [null, "```php\n<?php\n\n// Configuration variables\ndefine('DB_HOST', 'localhost');\ndefine('DB_USERNAME', 'your_username');\ndefine('DB_PASSWORD', 'your_password');\ndefine('DB_NAME', 'your_database');\n\n// Database connection\n$conn = new mysqli(DB_HOST, DB_USERNAME, DB_PASSWORD, DB_NAME);\n\nif ($conn->connect_error) {\n  die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Function to send password reset email\nfunction sendPasswordResetEmail($email) {\n  // Generate a random token for the password reset\n  $token = bin2hex(random_bytes(32));\n  \n  // Insert the token into the database\n  $query = \"INSERT INTO password_resets (user_id, token) VALUES (?, ?)\";\n  $stmt = $conn->prepare($query);\n  $stmt->bind_param(\"is\", $_SESSION['user_id'], $token);\n  $stmt->execute();\n  \n  // Send the email with the reset link\n  $subject = \"Reset Your Password\";\n  $body = \"\n    <p>Hello!</p>\n    <p>To reset your password, click on this link:</p>\n    <a href='http://your-website.com/reset-password?token=$token'>Reset Password</a>\n  \";\n  \n  // Send the email using PHPMailer or any other mail library\n  $mail = new PHPMailer();\n  $mail->isSMTP();\n  $mail->Host = 'smtp.gmail.com';\n  $mail->Port = 587;\n  $mail->SMTPAuth = true;\n  $mail->Username = 'your-email@gmail.com';\n  $mail->Password = 'your-password';\n  $mail->setFrom('your-email@gmail.com', 'Your Name');\n  $mail->addAddress($email);\n  $mail->Subject = $subject;\n  $mail->Body = $body;\n  if (!$mail->send()) {\n    echo \"Mailer Error: \" . $mail->ErrorInfo;\n    exit();\n  }\n}\n\n// Handle the forgot password form submission\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n  // Get the email from the form\n  $email = $_POST['email'];\n  \n  // Check if the email exists in the database\n  $query = \"SELECT * FROM users WHERE email = ?\";\n  $stmt = $conn->prepare($query);\n  $stmt->bind_param(\"s\", $email);\n  $stmt->execute();\n  $result = $stmt->get_result();\n  \n  if ($result->num_rows > 0) {\n    // Send the password reset email\n    sendPasswordResetEmail($email);\n    echo \"A password reset link has been sent to your email.\";\n  } else {\n    echo \"Invalid email address.\";\n  }\n}\n\n?>\n```", null]}
