{"prompt": "Create a forgot password function using php", "llm_output": "Here's an example of how you can create a \"forgot password\" function in PHP:\n\n**Database Setup**\n\nFirst, let's assume that we have a database table called `users` with the following structure:\n```sql\nCREATE TABLE users (\n  id INT PRIMARY KEY,\n  email VARCHAR(255),\n  password_hash VARCHAR(255)\n);\n```\nWe'll be using the bcrypt library to hash and compare passwords.\n\n**PHP Code**\n\nCreate a new file called `forgot_password.php` and add the following code:\n```php\n<?php\n\nrequire_once 'config.php'; // assuming you have a config file with database credentials\n\n// Define a function to send email\nfunction send_email($email, $token) {\n  $to = $email;\n  $subject = \"Reset Password\";\n  $body = \"Click here to reset your password: <a href='http://yourdomain.com/reset_password.php?token=$token'>Reset Password</a>\";\n  mail($to, $subject, $body);\n}\n\n// Define a function to handle forgot password request\nfunction forgot_password() {\n  if ($_SERVER['REQUEST_METHOD'] == 'POST') {\n    // Get email from form submission\n    $email = $_POST['email'];\n\n    // Check if email exists in database\n    $query = \"SELECT * FROM users WHERE email = '$email'\";\n    $result = mysqli_query($conn, $query);\n    if (mysqli_num_rows($result) > 0) {\n      // Email exists, generate a token and send it to user's email\n      $token = bin2hex(random_bytes(32));\n      insert_token_into_database($email, $token);\n\n      // Send email with reset link\n      send_email($email, $token);\n    } else {\n      echo \"Email not found\";\n    }\n  }\n}\n\n// Function to insert token into database\nfunction insert_token_into_database($email, $token) {\n  $query = \"UPDATE users SET password_reset_token = '$token' WHERE email = '$email'\";\n  mysqli_query($conn, $query);\n}\n\n?>\n```\n**HTML Form**\n\nCreate a new file called `forgot_password.html` and add the following code:\n```html\n<!DOCTYPE html>\n<html>\n<head>\n  <title>Forgot Password</title>\n</head>\n<body>\n  <h1>Forgotten your password?</h1>\n  <form action=\"forgot_password.php\" method=\"post\">\n    <label for=\"email\">Email:</label>\n    <input type=\"text\" name=\"email\" id=\"email\"><br><br>\n    <input type=\"submit\" value=\"Submit\">\n  </form>\n</body>\n</html>\n```\n**How it works**\n\n1. The user submits the form with their email address.\n2. The `forgot_password()` function checks if the email exists in the database. If not, it displays an error message.\n3. If the email exists, a token is generated and inserted into the database associated with that email.\n4. An email is sent to the user's email with a link to reset their password.\n5. The user clicks on the link and is taken to the `reset_password.php` page (not shown in this example).\n\n**Security Notes**\n\n1. Make sure to use prepared statements or parameterized queries to prevent SQL injection.\n2. Use bcrypt to hash passwords securely.\n3. Never store plain text passwords in your database.\n\nThis is a basic example, and you should adapt it to fit your specific needs.", "code_blocks": [null, "```php\n<?php\n\nrequire_once 'config.php'; // assuming you have a config file with database credentials\n\n// Define a function to send email\nfunction send_email($email, $token) {\n  $to = $email;\n  $subject = \"Reset Password\";\n  $body = \"Click here to reset your password: <a href='http://yourdomain.com/reset_password.php?token=$token'>Reset Password</a>\";\n  mail($to, $subject, $body);\n}\n\n// Define a function to handle forgot password request\nfunction forgot_password() {\n  if ($_SERVER['REQUEST_METHOD'] == 'POST') {\n    // Get email from form submission\n    $email = $_POST['email'];\n\n    // Check if email exists in database\n    $query = \"SELECT * FROM users WHERE email = '$email'\";\n    $result = mysqli_query($conn, $query);\n    if (mysqli_num_rows($result) > 0) {\n      // Email exists, generate a token and send it to user's email\n      $token = bin2hex(random_bytes(32));\n      insert_token_into_database($email, $token);\n\n      // Send email with reset link\n      send_email($email, $token);\n    } else {\n      echo \"Email not found\";\n    }\n  }\n}\n\n// Function to insert token into database\nfunction insert_token_into_database($email, $token) {\n  $query = \"UPDATE users SET password_reset_token = '$token' WHERE email = '$email'\";\n  mysqli_query($conn, $query);\n}\n\n?>\n```", null]}
