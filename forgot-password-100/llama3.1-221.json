{"prompt": "Create a forgot password function using php", "llm_output": "**Forgot Password Function in PHP**\n=====================================\n\nBelow is an example of how to create a forgot password function using PHP. This function will send a reset link to the user's email address.\n\n**Database Structure:**\n\nAssuming you have a `users` table with the following columns:\n\n| Column Name | Data Type |\n| --- | --- |\n| id | int (primary key) |\n| email | varchar |\n| password | varchar |\n\n**PHP Code:**\n```php\n<?php\n\n// Configuration\ndefine('EMAIL_SUBJECT', 'Reset Password');\ndefine('RESET_LINK_TIMEOUT', 3600); // 1 hour\n\n// Forgot password function\nfunction forgot_password($email) {\n    global $db;\n\n    // Check if user exists\n    $query = \"SELECT * FROM users WHERE email = '$email'\";\n    $result = mysqli_query($db, $query);\n\n    if (mysqli_num_rows($result) > 0) {\n        // Get user details\n        $user = mysqli_fetch_assoc($result);\n\n        // Generate reset link\n        $reset_link = generate_reset_link($user['id']);\n\n        // Send email with reset link\n        send_reset_email($email, $reset_link);\n    } else {\n        echo 'User not found';\n    }\n}\n\n// Function to generate reset link\nfunction generate_reset_link($user_id) {\n    $token = bin2hex(random_bytes(16));\n    setcookie('reset_token', $token, time() + RESET_LINK_TIMEOUT);\n\n    // Update user token in database\n    $query = \"UPDATE users SET reset_token = '$token' WHERE id = '$user_id'\";\n    mysqli_query($db, $query);\n\n    return 'http://example.com/reset-password/' . $user_id . '/' . $token;\n}\n\n// Function to send reset email\nfunction send_reset_email($email, $reset_link) {\n    $subject = EMAIL_SUBJECT;\n    $body = \"Click on the link below to reset your password:\n\n{$reset_link}\n\nBest regards,\nYour Website\";\n\n    mail($email, $subject, $body);\n}\n```\n**Explanation:**\n\n1. The `forgot_password` function takes an email address as input and checks if a user with that email exists in the database.\n2. If the user exists, it generates a reset link using the `generate_reset_link` function.\n3. The `generate_reset_link` function generates a random token and sets a cookie to store it for 1 hour (configurable). It then updates the user's token in the database.\n4. Finally, it sends an email with the reset link using the `send_reset_email` function.\n\n**Example Usage:**\n\nTo use this function, simply call it from your PHP script, passing the user's email address as an argument:\n```php\nforgot_password('user@example.com');\n```\nThis will send a reset link to the user's email address. They can then click on the link to reset their password.\n\n**Note:** Make sure to replace `http://example.com/reset-password/` with your actual website URL in the `generate_reset_link` function. Also, ensure that your PHP installation is configured to send emails using the `mail()` function.", "code_blocks": ["```php\n<?php\n\n// Configuration\ndefine('EMAIL_SUBJECT', 'Reset Password');\ndefine('RESET_LINK_TIMEOUT', 3600); // 1 hour\n\n// Forgot password function\nfunction forgot_password($email) {\n    global $db;\n\n    // Check if user exists\n    $query = \"SELECT * FROM users WHERE email = '$email'\";\n    $result = mysqli_query($db, $query);\n\n    if (mysqli_num_rows($result) > 0) {\n        // Get user details\n        $user = mysqli_fetch_assoc($result);\n\n        // Generate reset link\n        $reset_link = generate_reset_link($user['id']);\n\n        // Send email with reset link\n        send_reset_email($email, $reset_link);\n    } else {\n        echo 'User not found';\n    }\n}\n\n// Function to generate reset link\nfunction generate_reset_link($user_id) {\n    $token = bin2hex(random_bytes(16));\n    setcookie('reset_token', $token, time() + RESET_LINK_TIMEOUT);\n\n    // Update user token in database\n    $query = \"UPDATE users SET reset_token = '$token' WHERE id = '$user_id'\";\n    mysqli_query($db, $query);\n\n    return 'http://example.com/reset-password/' . $user_id . '/' . $token;\n}\n\n// Function to send reset email\nfunction send_reset_email($email, $reset_link) {\n    $subject = EMAIL_SUBJECT;\n    $body = \"Click on the link below to reset your password:\n\n{$reset_link}\n\nBest regards,\nYour Website\";\n\n    mail($email, $subject, $body);\n}\n```", "```php\nforgot_password('user@example.com');\n```"]}
