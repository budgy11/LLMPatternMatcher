{"prompt": "Create a forgot password function using php", "llm_output": "Here's an example of how to create a \"Forgot Password\" functionality in PHP:\n\n**Database Structure**\n\nLet's assume we have a table called `users` with the following structure:\n```sql\nCREATE TABLE users (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  username VARCHAR(255) NOT NULL,\n  email VARCHAR(255) NOT NULL,\n  password_hash VARCHAR(255) NOT NULL\n);\n```\n**Forgot Password Form**\n\nCreate an HTML form that allows users to enter their username or email address:\n```html\n<form action=\"forgot-password.php\" method=\"post\">\n  <label>Username or Email:</label>\n  <input type=\"text\" name=\"username_or_email\" />\n  <button type=\"submit\">Send Reset Link</button>\n</form>\n```\n**Forgot Password PHP Code**\n\nCreate a file called `forgot-password.php` with the following code:\n```php\n<?php\n\n// Define database connection settings\n$servername = \"localhost\";\n$username = \"root\";\n$password = \"\";\n$dbname = \"your_database_name\";\n\n// Create connection\n$conn = new mysqli($servername, $username, $password, $dbname);\n\n// Check connection\nif ($conn->connect_error) {\n  die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Get input values\n$username_or_email = $_POST['username_or_email'];\n\n// SQL query to retrieve user ID\n$sql = \"SELECT id FROM users WHERE username = '$username_or_email' OR email = '$username_or_email'\";\n$result = $conn->query($sql);\n\nif ($result->num_rows > 0) {\n  // Get the user's ID\n  $user_id = $result->fetch_assoc()['id'];\n\n  // Generate a reset token\n  $reset_token = bin2hex(random_bytes(32));\n\n  // Insert the reset token into the database\n  $sql = \"INSERT INTO password_resets (user_id, reset_token) VALUES ('$user_id', '$reset_token')\";\n  $conn->query($sql);\n\n  // Send an email with a link to reset the password\n  send_reset_email($username_or_email, $reset_token);\n} else {\n  echo \"Username or email not found.\";\n}\n\n// Close database connection\n$conn->close();\n\nfunction send_reset_email($email, $token) {\n  // Your SMTP settings here (e.g. Gmail)\n  $smtp_host = \"smtp.gmail.com\";\n  $smtp_username = \"your_email@gmail.com\";\n  $smtp_password = \"your_email_password\";\n\n  $subject = \"Reset Password Link\";\n  $body = \"Click this link to reset your password: <a href='reset-password.php?token=$token'>Reset Password</a>\";\n\n  // Send the email\n  $headers = \"From: no-reply@yourdomain.com\\r\\n\";\n  $headers .= \"MIME-Version: 1.0\\r\\n\";\n  $headers .= \"Content-Type: text/html; charset=UTF-8\\r\\n\";\n\n  mail($email, $subject, $body, $headers);\n}\n\n?>\n```\n**Reset Password PHP Code**\n\nCreate a file called `reset-password.php` with the following code:\n```php\n<?php\n\n// Define database connection settings\n$servername = \"localhost\";\n$username = \"root\";\n$password = \"\";\n$dbname = \"your_database_name\";\n\n// Create connection\n$conn = new mysqli($servername, $username, $password, $dbname);\n\n// Check connection\nif ($conn->connect_error) {\n  die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Get input values\n$token = $_GET['token'];\n\n// SQL query to retrieve the user's ID\n$sql = \"SELECT id FROM password_resets WHERE reset_token = '$token'\";\n$result = $conn->query($sql);\n\nif ($result->num_rows > 0) {\n  // Get the user's ID\n  $user_id = $result->fetch_assoc()['id'];\n\n  // Create a new form to change the password\n  echo \"<form action='update-password.php' method='post'>\";\n  echo \"New Password: <input type='password' name='new_password'/>\";\n  echo \"<button type='submit'>Change Password</button>\";\n  echo \"</form>\";\n\n} else {\n  echo \"Invalid reset token.\";\n}\n\n// Close database connection\n$conn->close();\n\n?>\n```\n**Update Password PHP Code**\n\nCreate a file called `update-password.php` with the following code:\n```php\n<?php\n\n// Define database connection settings\n$servername = \"localhost\";\n$username = \"root\";\n$password = \"\";\n$dbname = \"your_database_name\";\n\n// Create connection\n$conn = new mysqli($servername, $username, $password, $dbname);\n\n// Check connection\nif ($conn->connect_error) {\n  die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Get input values\n$new_password = $_POST['new_password'];\n\n// SQL query to update the user's password\n$sql = \"UPDATE users SET password_hash = '$new_password' WHERE id = 'user_id'\";\n$conn->query($sql);\n\n// Close database connection\n$conn->close();\n\n?>\n```\nNote that this is a basic example and should not be used in production without proper security measures (e.g. hashing, salting, etc.).", "code_blocks": [null, null, "```php\n<?php\n\n// Define database connection settings\n$servername = \"localhost\";\n$username = \"root\";\n$password = \"\";\n$dbname = \"your_database_name\";\n\n// Create connection\n$conn = new mysqli($servername, $username, $password, $dbname);\n\n// Check connection\nif ($conn->connect_error) {\n  die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Get input values\n$username_or_email = $_POST['username_or_email'];\n\n// SQL query to retrieve user ID\n$sql = \"SELECT id FROM users WHERE username = '$username_or_email' OR email = '$username_or_email'\";\n$result = $conn->query($sql);\n\nif ($result->num_rows > 0) {\n  // Get the user's ID\n  $user_id = $result->fetch_assoc()['id'];\n\n  // Generate a reset token\n  $reset_token = bin2hex(random_bytes(32));\n\n  // Insert the reset token into the database\n  $sql = \"INSERT INTO password_resets (user_id, reset_token) VALUES ('$user_id', '$reset_token')\";\n  $conn->query($sql);\n\n  // Send an email with a link to reset the password\n  send_reset_email($username_or_email, $reset_token);\n} else {\n  echo \"Username or email not found.\";\n}\n\n// Close database connection\n$conn->close();\n\nfunction send_reset_email($email, $token) {\n  // Your SMTP settings here (e.g. Gmail)\n  $smtp_host = \"smtp.gmail.com\";\n  $smtp_username = \"your_email@gmail.com\";\n  $smtp_password = \"your_email_password\";\n\n  $subject = \"Reset Password Link\";\n  $body = \"Click this link to reset your password: <a href='reset-password.php?token=$token'>Reset Password</a>\";\n\n  // Send the email\n  $headers = \"From: no-reply@yourdomain.com\\r\\n\";\n  $headers .= \"MIME-Version: 1.0\\r\\n\";\n  $headers .= \"Content-Type: text/html; charset=UTF-8\\r\\n\";\n\n  mail($email, $subject, $body, $headers);\n}\n\n?>\n```", "```php\n<?php\n\n// Define database connection settings\n$servername = \"localhost\";\n$username = \"root\";\n$password = \"\";\n$dbname = \"your_database_name\";\n\n// Create connection\n$conn = new mysqli($servername, $username, $password, $dbname);\n\n// Check connection\nif ($conn->connect_error) {\n  die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Get input values\n$token = $_GET['token'];\n\n// SQL query to retrieve the user's ID\n$sql = \"SELECT id FROM password_resets WHERE reset_token = '$token'\";\n$result = $conn->query($sql);\n\nif ($result->num_rows > 0) {\n  // Get the user's ID\n  $user_id = $result->fetch_assoc()['id'];\n\n  // Create a new form to change the password\n  echo \"<form action='update-password.php' method='post'>\";\n  echo \"New Password: <input type='password' name='new_password'/>\";\n  echo \"<button type='submit'>Change Password</button>\";\n  echo \"</form>\";\n\n} else {\n  echo \"Invalid reset token.\";\n}\n\n// Close database connection\n$conn->close();\n\n?>\n```", "```php\n<?php\n\n// Define database connection settings\n$servername = \"localhost\";\n$username = \"root\";\n$password = \"\";\n$dbname = \"your_database_name\";\n\n// Create connection\n$conn = new mysqli($servername, $username, $password, $dbname);\n\n// Check connection\nif ($conn->connect_error) {\n  die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Get input values\n$new_password = $_POST['new_password'];\n\n// SQL query to update the user's password\n$sql = \"UPDATE users SET password_hash = '$new_password' WHERE id = 'user_id'\";\n$conn->query($sql);\n\n// Close database connection\n$conn->close();\n\n?>\n```"]}
