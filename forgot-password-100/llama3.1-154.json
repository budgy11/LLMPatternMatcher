{"prompt": "Create a forgot password function using php", "llm_output": "Here's an example of how you can implement a forgot password function in PHP:\n\n**Database Schema**\n\nLet's assume we have the following database schema for users:\n```sql\nCREATE TABLE users (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  email VARCHAR(255) UNIQUE NOT NULL,\n  password VARCHAR(255) NOT NULL\n);\n```\n**PHP Code**\n\nCreate a file called `forgot_password.php` with the following code:\n```php\n<?php\n\n// Configuration settings\ndefine('DB_HOST', 'your_database_host');\ndefine('DB_USERNAME', 'your_database_username');\ndefine('DB_PASSWORD', 'your_database_password');\ndefine('DB_NAME', 'your_database_name');\n\n// Connect to database\n$conn = new mysqli(DB_HOST, DB_USERNAME, DB_PASSWORD, DB_NAME);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Check if the user exists\n$email = $_POST['email'];\n\n$sql = \"SELECT * FROM users WHERE email = '$email'\";\n$result = $conn->query($sql);\n\nif (!$result) {\n    echo \"Error: \" . $conn->error;\n} else {\n    // If the user exists, send a password reset link to their email\n    if ($result->num_rows > 0) {\n        while ($row = $result->fetch_assoc()) {\n            $user_id = $row['id'];\n            $token = bin2hex(random_bytes(32));\n\n            // Insert token into database\n            $sql = \"INSERT INTO password_reset_tokens (user_id, token) VALUES ('$user_id', '$token')\";\n            $conn->query($sql);\n\n            // Send email with password reset link\n            $subject = \"Reset your password\";\n            $body = \"\n                <p>Dear user,</p>\n                <p>To reset your password, click on the following link:</p>\n                <a href='\" . $_SERVER['HTTP_HOST'] . \"/reset_password.php?token=\" . $token . \"'>Reset Password</a>\n                <p>Best regards,\n                [Your Name]</p>\";\n            mail($email, $subject, $body);\n        }\n    } else {\n        echo \"Email address not found.\";\n    }\n}\n\n// Close database connection\n$conn->close();\n\n?>\n```\n**reset_password.php**\n\nCreate a new file called `reset_password.php` with the following code:\n```php\n<?php\n\n// Configuration settings\ndefine('DB_HOST', 'your_database_host');\ndefine('DB_USERNAME', 'your_database_username');\ndefine('DB_PASSWORD', 'your_database_password');\ndefine('DB_NAME', 'your_database_name');\n\n// Connect to database\n$conn = new mysqli(DB_HOST, DB_USERNAME, DB_PASSWORD, DB_NAME);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Check if the user exists\n$token = $_GET['token'];\n\n$sql = \"SELECT * FROM password_reset_tokens WHERE token = '$token'\";\n$result = $conn->query($sql);\n\nif (!$result) {\n    echo \"Error: \" . $conn->error;\n} else {\n    // If the user exists, display a form to reset their password\n    if ($result->num_rows > 0) {\n        while ($row = $result->fetch_assoc()) {\n            $user_id = $row['id'];\n        }\n\n        echo \"\n            <form action='' method='post'>\n                <label for='password'>New Password:</label>\n                <input type='password' id='password' name='password'><br><br>\n                <label for='confirm_password'>Confirm New Password:</label>\n                <input type='password' id='confirm_password' name='confirm_password'><br><br>\n                <input type='hidden' name='token' value='$token'>\n                <button type='submit' name='submit'>Reset Password</button>\n            </form>\";\n\n        if ($_POST['submit']) {\n            // Update user's password\n            $password = $_POST['password'];\n            $confirm_password = $_POST['confirm_password'];\n\n            if ($password == $confirm_password) {\n                $sql = \"UPDATE users SET password = '$password' WHERE id = '$user_id'\";\n                $conn->query($sql);\n\n                // Delete password reset token\n                $sql = \"DELETE FROM password_reset_tokens WHERE token = '$token'\";\n                $conn->query($sql);\n            } else {\n                echo \"Passwords do not match.\";\n            }\n        }\n\n    } else {\n        echo \"Invalid token.\";\n    }\n}\n\n// Close database connection\n$conn->close();\n\n?>\n```\n**How it works**\n\n1. When a user clicks on the forgot password link, they are redirected to `forgot_password.php`.\n2. The script checks if the user's email address exists in the database.\n3. If the email address exists, a password reset token is generated and inserted into the database along with the user's ID.\n4. An email is sent to the user with a link to reset their password. The link contains the password reset token.\n5. When the user clicks on the link, they are redirected to `reset_password.php`.\n6. The script checks if the password reset token is valid by querying the database for the corresponding token.\n7. If the token is valid, the user is presented with a form to enter their new password and confirm it.\n8. Once the form is submitted, the user's password is updated in the database.\n\n**Security considerations**\n\n* Make sure to use a secure connection (HTTPS) when sending emails containing sensitive information like passwords.\n* Use a salted hash function to store passwords securely.\n* Implement a rate limit on password reset attempts to prevent brute-force attacks.\n* Regularly update your PHP version and library dependencies to ensure you have the latest security patches.", "code_blocks": [null, "```php\n<?php\n\n// Configuration settings\ndefine('DB_HOST', 'your_database_host');\ndefine('DB_USERNAME', 'your_database_username');\ndefine('DB_PASSWORD', 'your_database_password');\ndefine('DB_NAME', 'your_database_name');\n\n// Connect to database\n$conn = new mysqli(DB_HOST, DB_USERNAME, DB_PASSWORD, DB_NAME);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Check if the user exists\n$email = $_POST['email'];\n\n$sql = \"SELECT * FROM users WHERE email = '$email'\";\n$result = $conn->query($sql);\n\nif (!$result) {\n    echo \"Error: \" . $conn->error;\n} else {\n    // If the user exists, send a password reset link to their email\n    if ($result->num_rows > 0) {\n        while ($row = $result->fetch_assoc()) {\n            $user_id = $row['id'];\n            $token = bin2hex(random_bytes(32));\n\n            // Insert token into database\n            $sql = \"INSERT INTO password_reset_tokens (user_id, token) VALUES ('$user_id', '$token')\";\n            $conn->query($sql);\n\n            // Send email with password reset link\n            $subject = \"Reset your password\";\n            $body = \"\n                <p>Dear user,</p>\n                <p>To reset your password, click on the following link:</p>\n                <a href='\" . $_SERVER['HTTP_HOST'] . \"/reset_password.php?token=\" . $token . \"'>Reset Password</a>\n                <p>Best regards,\n                [Your Name]</p>\";\n            mail($email, $subject, $body);\n        }\n    } else {\n        echo \"Email address not found.\";\n    }\n}\n\n// Close database connection\n$conn->close();\n\n?>\n```", "```php\n<?php\n\n// Configuration settings\ndefine('DB_HOST', 'your_database_host');\ndefine('DB_USERNAME', 'your_database_username');\ndefine('DB_PASSWORD', 'your_database_password');\ndefine('DB_NAME', 'your_database_name');\n\n// Connect to database\n$conn = new mysqli(DB_HOST, DB_USERNAME, DB_PASSWORD, DB_NAME);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Check if the user exists\n$token = $_GET['token'];\n\n$sql = \"SELECT * FROM password_reset_tokens WHERE token = '$token'\";\n$result = $conn->query($sql);\n\nif (!$result) {\n    echo \"Error: \" . $conn->error;\n} else {\n    // If the user exists, display a form to reset their password\n    if ($result->num_rows > 0) {\n        while ($row = $result->fetch_assoc()) {\n            $user_id = $row['id'];\n        }\n\n        echo \"\n            <form action='' method='post'>\n                <label for='password'>New Password:</label>\n                <input type='password' id='password' name='password'><br><br>\n                <label for='confirm_password'>Confirm New Password:</label>\n                <input type='password' id='confirm_password' name='confirm_password'><br><br>\n                <input type='hidden' name='token' value='$token'>\n                <button type='submit' name='submit'>Reset Password</button>\n            </form>\";\n\n        if ($_POST['submit']) {\n            // Update user's password\n            $password = $_POST['password'];\n            $confirm_password = $_POST['confirm_password'];\n\n            if ($password == $confirm_password) {\n                $sql = \"UPDATE users SET password = '$password' WHERE id = '$user_id'\";\n                $conn->query($sql);\n\n                // Delete password reset token\n                $sql = \"DELETE FROM password_reset_tokens WHERE token = '$token'\";\n                $conn->query($sql);\n            } else {\n                echo \"Passwords do not match.\";\n            }\n        }\n\n    } else {\n        echo \"Invalid token.\";\n    }\n}\n\n// Close database connection\n$conn->close();\n\n?>\n```"]}
