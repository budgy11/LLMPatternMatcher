{"prompt": "Create a forgot password function using php", "llm_output": "Here is an example of how to create a \"forgot password\" function in PHP:\n\n**Database Table:**\nFirst, let's assume we have a database table called `users` with the following columns:\n```sql\nCREATE TABLE users (\n  id INT PRIMARY KEY,\n  email VARCHAR(255),\n  password_hash VARCHAR(255)\n);\n```\n**PHP Code:**\nCreate a new file called `forgot_password.php` and add the following code:\n```php\n<?php\n\n// Configuration\n$dsn = 'mysql:host=localhost;dbname=mydatabase';\n$username = 'myuser';\n$password = 'mypassword';\n\ntry {\n  // Connect to database\n  $pdo = new PDO($dsn, $username, $password);\n} catch (PDOException $e) {\n  echo 'Connection failed: ' . $e->getMessage();\n  exit;\n}\n\n// Check if user submitted the form\nif ($_SERVER['REQUEST_METHOD'] === 'POST') {\n  // Get email from form data\n  $email = $_POST['email'];\n\n  // Validate email\n  if (empty($email) || !filter_var($email, FILTER_VALIDATE_EMAIL)) {\n    echo 'Invalid email';\n    exit;\n  }\n\n  // Check if user exists in database\n  $stmt = $pdo->prepare('SELECT * FROM users WHERE email = :email');\n  $stmt->bindParam(':email', $email);\n  $stmt->execute();\n\n  if ($stmt->rowCount() > 0) {\n    // Get user ID\n    $userId = $stmt->fetchColumn(0);\n\n    // Generate new password and store it in session\n    $newPassword = substr(md5(uniqid()), 0, 8);\n    $_SESSION['new_password'] = $newPassword;\n\n    // Send email with new password to user\n    $to = $email;\n    $subject = 'Your new password';\n    $message = 'Hello,' . \"\\n\\n\" .\n      'Your new password is: ' . $newPassword . \"\\n\\n\" .\n      'Best regards, Your Website';\n\n    mail($to, $subject, $message);\n\n    echo 'New password sent to your email';\n  } else {\n    echo 'User not found';\n  }\n} else {\n  // Display form if user hasn't submitted it yet\n?>\n\n<form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\">\n  <label for=\"email\">Email:</label>\n  <input type=\"text\" id=\"email\" name=\"email\"><br><br>\n  <input type=\"submit\" value=\"Submit\">\n</form>\n\n<?php } ?>\n```\n**How it works:**\n\n1. The user submits the form with their email address.\n2. We validate the email address to make sure it's not empty and is a valid email format.\n3. We check if the user exists in the database by querying the `users` table with the provided email address.\n4. If the user exists, we generate a new password using MD5 and Uniqid functions.\n5. We store the new password in the session so that it can be used to log in later.\n6. We send an email to the user with their new password.\n\n**Note:**\n\n* Make sure to replace `mysql:host=localhost;dbname=mydatabase` with your actual database connection string.\n* Also, you should change `myuser` and `mypassword` to your actual database username and password.\n* This is a basic example and doesn't include any security measures such as email verification or password reset expiration. You should add these features depending on your requirements.\n\nPlease keep in mind that this is just an example code and you should adapt it according to your specific needs and security requirements.", "code_blocks": [null, "```php\n<?php\n\n// Configuration\n$dsn = 'mysql:host=localhost;dbname=mydatabase';\n$username = 'myuser';\n$password = 'mypassword';\n\ntry {\n  // Connect to database\n  $pdo = new PDO($dsn, $username, $password);\n} catch (PDOException $e) {\n  echo 'Connection failed: ' . $e->getMessage();\n  exit;\n}\n\n// Check if user submitted the form\nif ($_SERVER['REQUEST_METHOD'] === 'POST') {\n  // Get email from form data\n  $email = $_POST['email'];\n\n  // Validate email\n  if (empty($email) || !filter_var($email, FILTER_VALIDATE_EMAIL)) {\n    echo 'Invalid email';\n    exit;\n  }\n\n  // Check if user exists in database\n  $stmt = $pdo->prepare('SELECT * FROM users WHERE email = :email');\n  $stmt->bindParam(':email', $email);\n  $stmt->execute();\n\n  if ($stmt->rowCount() > 0) {\n    // Get user ID\n    $userId = $stmt->fetchColumn(0);\n\n    // Generate new password and store it in session\n    $newPassword = substr(md5(uniqid()), 0, 8);\n    $_SESSION['new_password'] = $newPassword;\n\n    // Send email with new password to user\n    $to = $email;\n    $subject = 'Your new password';\n    $message = 'Hello,' . \"\\n\\n\" .\n      'Your new password is: ' . $newPassword . \"\\n\\n\" .\n      'Best regards, Your Website';\n\n    mail($to, $subject, $message);\n\n    echo 'New password sent to your email';\n  } else {\n    echo 'User not found';\n  }\n} else {\n  // Display form if user hasn't submitted it yet\n?>\n\n<form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\">\n  <label for=\"email\">Email:</label>\n  <input type=\"text\" id=\"email\" name=\"email\"><br><br>\n  <input type=\"submit\" value=\"Submit\">\n</form>\n\n<?php } ?>\n```"]}
