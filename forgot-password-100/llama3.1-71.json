{"prompt": "Create a forgot password function using php", "llm_output": "Here is an example of how to create a forgot password functionality using PHP:\n\n**Database Schema**\n\nFirst, let's assume we have a database table called `users` with the following columns:\n```php\nCREATE TABLE users (\n  id INT PRIMARY KEY,\n  email VARCHAR(255) NOT NULL,\n  password_hash VARCHAR(255) NOT NULL\n);\n```\n**PHP Code**\n\nCreate a new PHP file called `forgot_password.php`. This file will contain the code to handle the forgot password functionality.\n```php\n<?php\n\n// Configuration\n$db_host = 'localhost';\n$db_username = 'your_username';\n$db_password = 'your_password';\n$db_name = 'your_database';\n\n// Connect to database\n$conn = new mysqli($db_host, $db_username, $db_password, $db_name);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Function to check if email exists in the database\nfunction check_email_exists($email) {\n  global $conn;\n  $query = \"SELECT * FROM users WHERE email = '$email'\";\n  $result = $conn->query($query);\n\n  if ($result->num_rows > 0) {\n    return true;\n  } else {\n    return false;\n  }\n}\n\n// Function to generate a password reset token\nfunction generate_token() {\n  return bin2hex(random_bytes(32));\n}\n\n// Handle forgot password request\nif (isset($_POST['forgot_password'])) {\n\n  // Get email from form input\n  $email = $_POST['email'];\n\n  // Check if email exists in the database\n  if (check_email_exists($email)) {\n\n    // Generate a password reset token\n    $token = generate_token();\n\n    // Update user's token in the database\n    $query = \"UPDATE users SET password_reset_token = '$token' WHERE email = '$email'\";\n    $conn->query($query);\n\n    // Send password reset email to user\n    $subject = 'Password Reset Request';\n    $body = 'Click on this link to reset your password: <a href=\"http://yourwebsite.com/reset_password.php?token=' . $token . '\">Reset Password</a>';\n    mail($email, $subject, $body);\n\n    echo \"Email sent with password reset link. Please check your inbox.\";\n  } else {\n    echo \"Email not found in the database.\";\n  }\n}\n\n// Close connection\n$conn->close();\n\n?>\n```\n**Explanation**\n\nThis code assumes that you have a form on your website that submits to `forgot_password.php` when the user clicks on the forgot password link. The form should contain an input field for the email address of the user who is requesting a password reset.\n\nWhen the form is submitted, the PHP code checks if the email exists in the database using the `check_email_exists` function. If the email exists, it generates a password reset token using the `generate_token` function and updates the user's token in the database.\n\nThe code then sends an email to the user with a link to reset their password. The link contains the password reset token as a query parameter.\n\n**Security Notes**\n\n* This is just a basic example of how to implement a forgot password functionality using PHP. In a production environment, you should use a more secure method to store and generate passwords.\n* Make sure to replace `your_username`, `your_password`, and `your_database` with your actual database credentials.\n* Use a secure way to send the password reset email, such as using an email library that supports encryption and authentication.\n\n**Reset Password Page**\n\nCreate another PHP file called `reset_password.php`. This file will contain the code to handle the password reset functionality.\n```php\n<?php\n\n// Configuration\n$db_host = 'localhost';\n$db_username = 'your_username';\n$db_password = 'your_password';\n$db_name = 'your_database';\n\n// Connect to database\n$conn = new mysqli($db_host, $db_username, $db_password, $db_name);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Function to update password in the database\nfunction update_password($token, $new_password) {\n  global $conn;\n  $query = \"UPDATE users SET password_hash = '$new_password', password_reset_token = NULL WHERE password_reset_token = '$token'\";\n  $conn->query($query);\n\n  if ($conn->affected_rows == 1) {\n    return true;\n  } else {\n    return false;\n  }\n}\n\n// Handle password reset request\nif (isset($_POST['reset_password'])) {\n\n  // Get token and new password from form input\n  $token = $_GET['token'];\n  $new_password = $_POST['new_password'];\n\n  // Check if token exists in the database\n  $query = \"SELECT * FROM users WHERE password_reset_token = '$token'\";\n  $result = $conn->query($query);\n\n  if ($result->num_rows > 0) {\n\n    // Update user's password in the database\n    if (update_password($token, password_hash($new_password, PASSWORD_DEFAULT))) {\n      echo \"Password updated successfully.\";\n    } else {\n      echo \"Error updating password.\";\n    }\n  } else {\n    echo \"Token not found in the database.\";\n  }\n}\n\n// Close connection\n$conn->close();\n\n?>\n```\n**Explanation**\n\nThis code assumes that you have a form on your website that submits to `reset_password.php` when the user clicks on the reset password link. The form should contain an input field for the new password of the user who is resetting their password.\n\nWhen the form is submitted, the PHP code checks if the token exists in the database using the `update_password` function. If the token exists, it updates the user's password in the database and resets the password reset token to null.\n\n**Security Notes**\n\n* This is just a basic example of how to implement a forgot password functionality using PHP. In a production environment, you should use a more secure method to store and generate passwords.\n* Make sure to replace `your_username`, `your_password`, and `your_database` with your actual database credentials.\n* Use a secure way to update the user's password in the database.\n\nI hope this helps! Let me know if you have any questions or need further clarification.", "code_blocks": ["```php\nCREATE TABLE users (\n  id INT PRIMARY KEY,\n  email VARCHAR(255) NOT NULL,\n  password_hash VARCHAR(255) NOT NULL\n);\n```", "```php\n<?php\n\n// Configuration\n$db_host = 'localhost';\n$db_username = 'your_username';\n$db_password = 'your_password';\n$db_name = 'your_database';\n\n// Connect to database\n$conn = new mysqli($db_host, $db_username, $db_password, $db_name);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Function to check if email exists in the database\nfunction check_email_exists($email) {\n  global $conn;\n  $query = \"SELECT * FROM users WHERE email = '$email'\";\n  $result = $conn->query($query);\n\n  if ($result->num_rows > 0) {\n    return true;\n  } else {\n    return false;\n  }\n}\n\n// Function to generate a password reset token\nfunction generate_token() {\n  return bin2hex(random_bytes(32));\n}\n\n// Handle forgot password request\nif (isset($_POST['forgot_password'])) {\n\n  // Get email from form input\n  $email = $_POST['email'];\n\n  // Check if email exists in the database\n  if (check_email_exists($email)) {\n\n    // Generate a password reset token\n    $token = generate_token();\n\n    // Update user's token in the database\n    $query = \"UPDATE users SET password_reset_token = '$token' WHERE email = '$email'\";\n    $conn->query($query);\n\n    // Send password reset email to user\n    $subject = 'Password Reset Request';\n    $body = 'Click on this link to reset your password: <a href=\"http://yourwebsite.com/reset_password.php?token=' . $token . '\">Reset Password</a>';\n    mail($email, $subject, $body);\n\n    echo \"Email sent with password reset link. Please check your inbox.\";\n  } else {\n    echo \"Email not found in the database.\";\n  }\n}\n\n// Close connection\n$conn->close();\n\n?>\n```", "```php\n<?php\n\n// Configuration\n$db_host = 'localhost';\n$db_username = 'your_username';\n$db_password = 'your_password';\n$db_name = 'your_database';\n\n// Connect to database\n$conn = new mysqli($db_host, $db_username, $db_password, $db_name);\n\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Function to update password in the database\nfunction update_password($token, $new_password) {\n  global $conn;\n  $query = \"UPDATE users SET password_hash = '$new_password', password_reset_token = NULL WHERE password_reset_token = '$token'\";\n  $conn->query($query);\n\n  if ($conn->affected_rows == 1) {\n    return true;\n  } else {\n    return false;\n  }\n}\n\n// Handle password reset request\nif (isset($_POST['reset_password'])) {\n\n  // Get token and new password from form input\n  $token = $_GET['token'];\n  $new_password = $_POST['new_password'];\n\n  // Check if token exists in the database\n  $query = \"SELECT * FROM users WHERE password_reset_token = '$token'\";\n  $result = $conn->query($query);\n\n  if ($result->num_rows > 0) {\n\n    // Update user's password in the database\n    if (update_password($token, password_hash($new_password, PASSWORD_DEFAULT))) {\n      echo \"Password updated successfully.\";\n    } else {\n      echo \"Error updating password.\";\n    }\n  } else {\n    echo \"Token not found in the database.\";\n  }\n}\n\n// Close connection\n$conn->close();\n\n?>\n```"]}
