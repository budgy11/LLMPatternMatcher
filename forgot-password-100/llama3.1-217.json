{"prompt": "Create a forgot password function using php", "llm_output": "Here is an example of a \"forgot password\" function in PHP that sends a password reset link to the user's email:\n\n**password_reset.php**\n```php\n<?php\n\n// Configuration\n$db_host = 'localhost';\n$db_username = 'your_username';\n$db_password = 'your_password';\n$db_name = 'your_database';\n\n// Connect to database\n$conn = new mysqli($db_host, $db_username, $db_password, $db_name);\n\n// Check connection\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Get email from form submission\n$email = $_POST['email'];\n\n// Query database for user\n$query = \"SELECT * FROM users WHERE email = '$email'\";\n$result = $conn->query($query);\n\nif ($result->num_rows > 0) {\n    // User exists, generate password reset link\n    while ($row = $result->fetch_assoc()) {\n        $user_id = $row['id'];\n        $username = $row['username'];\n\n        // Generate random token\n        $token = bin2hex(random_bytes(32));\n\n        // Update user's token in database\n        $update_query = \"UPDATE users SET token = '$token' WHERE id = '$user_id'\";\n        $conn->query($update_query);\n\n        // Send password reset email\n        $subject = 'Password Reset for ' . $username;\n        $message = \"\n            <html>\n                <body>\n                    <p>Hello $username,</p>\n                    <p>Click the link below to reset your password:</p>\n                    <a href='http://example.com/reset_password.php?token=$token'>$token</a>\n                </body>\n            </html>\n        \";\n        mail($email, $subject, $message);\n\n        echo \"Password reset email sent.\";\n    }\n} else {\n    echo \"User not found.\";\n}\n\n// Close database connection\n$conn->close();\n\n?>\n```\n**reset_password.php**\n```php\n<?php\n\n// Configuration\n$db_host = 'localhost';\n$db_username = 'your_username';\n$db_password = 'your_password';\n$db_name = 'your_database';\n\n// Connect to database\n$conn = new mysqli($db_host, $db_username, $db_password, $db_name);\n\n// Check connection\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Get token from URL\n$token = $_GET['token'];\n\n// Query database for user\n$query = \"SELECT * FROM users WHERE token = '$token'\";\n$result = $conn->query($query);\n\nif ($result->num_rows > 0) {\n    // User exists, allow password reset\n    while ($row = $result->fetch_assoc()) {\n        $user_id = $row['id'];\n        $username = $row['username'];\n\n        // Allow user to enter new password and confirm it\n        if (isset($_POST['new_password']) && $_POST['new_password'] == $_POST['confirm_password']) {\n            // Update user's password in database\n            $update_query = \"UPDATE users SET password = '$new_password' WHERE id = '$user_id'\";\n            $conn->query($update_query);\n\n            echo \"Password reset successful.\";\n        }\n    }\n} else {\n    echo \"Invalid token.\";\n}\n\n// Close database connection\n$conn->close();\n\n?>\n```\n**Note:** This is just an example and you should modify it to fit your specific needs. You may also want to consider using a more secure method of generating tokens, such as using a library like `random_compat`.\n\nAlso, make sure to update the configuration variables (`$db_host`, `$db_username`, etc.) with your own database credentials.\n\nThis code assumes that you have a `users` table in your database with columns for `id`, `username`, and `password`. It also assumes that you have a `token` column where the password reset link will be stored.\n\nWhen the user clicks on the password reset link, they will be taken to the `reset_password.php` page. There, they can enter their new password and confirm it by submitting the form. If the passwords match, the password is updated in the database.\n\nRemember to keep this code secure by using prepared statements or parameterized queries to prevent SQL injection attacks.", "code_blocks": ["```php\n<?php\n\n// Configuration\n$db_host = 'localhost';\n$db_username = 'your_username';\n$db_password = 'your_password';\n$db_name = 'your_database';\n\n// Connect to database\n$conn = new mysqli($db_host, $db_username, $db_password, $db_name);\n\n// Check connection\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Get email from form submission\n$email = $_POST['email'];\n\n// Query database for user\n$query = \"SELECT * FROM users WHERE email = '$email'\";\n$result = $conn->query($query);\n\nif ($result->num_rows > 0) {\n    // User exists, generate password reset link\n    while ($row = $result->fetch_assoc()) {\n        $user_id = $row['id'];\n        $username = $row['username'];\n\n        // Generate random token\n        $token = bin2hex(random_bytes(32));\n\n        // Update user's token in database\n        $update_query = \"UPDATE users SET token = '$token' WHERE id = '$user_id'\";\n        $conn->query($update_query);\n\n        // Send password reset email\n        $subject = 'Password Reset for ' . $username;\n        $message = \"\n            <html>\n                <body>\n                    <p>Hello $username,</p>\n                    <p>Click the link below to reset your password:</p>\n                    <a href='http://example.com/reset_password.php?token=$token'>$token</a>\n                </body>\n            </html>\n        \";\n        mail($email, $subject, $message);\n\n        echo \"Password reset email sent.\";\n    }\n} else {\n    echo \"User not found.\";\n}\n\n// Close database connection\n$conn->close();\n\n?>\n```", "```php\n<?php\n\n// Configuration\n$db_host = 'localhost';\n$db_username = 'your_username';\n$db_password = 'your_password';\n$db_name = 'your_database';\n\n// Connect to database\n$conn = new mysqli($db_host, $db_username, $db_password, $db_name);\n\n// Check connection\nif ($conn->connect_error) {\n    die(\"Connection failed: \" . $conn->connect_error);\n}\n\n// Get token from URL\n$token = $_GET['token'];\n\n// Query database for user\n$query = \"SELECT * FROM users WHERE token = '$token'\";\n$result = $conn->query($query);\n\nif ($result->num_rows > 0) {\n    // User exists, allow password reset\n    while ($row = $result->fetch_assoc()) {\n        $user_id = $row['id'];\n        $username = $row['username'];\n\n        // Allow user to enter new password and confirm it\n        if (isset($_POST['new_password']) && $_POST['new_password'] == $_POST['confirm_password']) {\n            // Update user's password in database\n            $update_query = \"UPDATE users SET password = '$new_password' WHERE id = '$user_id'\";\n            $conn->query($update_query);\n\n            echo \"Password reset successful.\";\n        }\n    }\n} else {\n    echo \"Invalid token.\";\n}\n\n// Close database connection\n$conn->close();\n\n?>\n```"]}
