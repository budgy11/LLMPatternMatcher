{"prompt": "Create a forgot password function using php", "llm_output": "Here is an example of how you can create a \"forgot password\" function using PHP:\n\n**Database Schema**\n\nLet's assume we have a database table named `users` with the following schema:\n```sql\nCREATE TABLE users (\n  id INT PRIMARY KEY,\n  username VARCHAR(255),\n  email VARCHAR(255),\n  password_hash VARCHAR(255)\n);\n```\n**PHP Code**\n```php\n// include the necessary libraries\nrequire_once 'db.php'; // assume we have a db connection library\n\n// function to send forgot password email\nfunction sendForgotPasswordEmail($email) {\n  // get user data from database\n  $query = \"SELECT * FROM users WHERE email = '$email'\";\n  $result = mysqli_query($conn, $query);\n\n  if ($result->num_rows > 0) {\n    $user = $result->fetch_assoc();\n\n    // generate new password and hash it\n    $newPassword = substr(md5(uniqid(mt_rand(), true)), 0, 8);\n    $hashedNewPassword = password_hash($newPassword, PASSWORD_DEFAULT);\n\n    // update user's password in database\n    $query = \"UPDATE users SET password_hash = '$hashedNewPassword' WHERE id = '$user[id]'\";\n    mysqli_query($conn, $query);\n\n    // send email with new password\n    $to = $email;\n    $subject = \"Reset your password\";\n    $body = \"Your new password is: $newPassword\";\n    mail($to, $subject, $body);\n  }\n}\n\n// function to handle forgot password request\nfunction forgotPassword() {\n  // get form data (username or email)\n  $usernameOrEmail = $_POST['username_or_email'];\n\n  if (!empty($usernameOrEmail)) {\n    // check if user exists in database\n    $query = \"SELECT * FROM users WHERE username = '$usernameOrEmail' OR email = '$usernameOrEmail'\";\n    $result = mysqli_query($conn, $query);\n\n    if ($result->num_rows > 0) {\n      // send forgot password email\n      sendForgotPasswordEmail($_POST['email']);\n      echo \"An email with new password has been sent to your email address.\";\n    } else {\n      echo \"No user found with this username or email.\";\n    }\n  } else {\n    echo \"Please enter your username or email.\";\n  }\n}\n```\n**HTML Form**\n```html\n<form action=\"forgot_password.php\" method=\"post\">\n  <label>Username or Email:</label>\n  <input type=\"text\" name=\"username_or_email\" required>\n  <br>\n  <label>Email:</label>\n  <input type=\"email\" name=\"email\" required>\n  <br>\n  <button type=\"submit\">Send Reset Password Link</button>\n</form>\n```\n**Usage**\n\n1. Create a new PHP file called `forgot_password.php` and add the above code.\n2. Create a form with the HTML code above and submit it to the same PHP file.\n3. The user will receive an email with their new password.\n\nNote: This is just a basic example, you should adapt it to your specific needs and security requirements. Also, make sure to use HTTPS (SSL/TLS) for the forgot password link to prevent eavesdropping attacks.\n\nRemember to replace `db.php` with your actual database connection library and adjust the SQL queries according to your schema.", "code_blocks": [null, "```php\n// include the necessary libraries\nrequire_once 'db.php'; // assume we have a db connection library\n\n// function to send forgot password email\nfunction sendForgotPasswordEmail($email) {\n  // get user data from database\n  $query = \"SELECT * FROM users WHERE email = '$email'\";\n  $result = mysqli_query($conn, $query);\n\n  if ($result->num_rows > 0) {\n    $user = $result->fetch_assoc();\n\n    // generate new password and hash it\n    $newPassword = substr(md5(uniqid(mt_rand(), true)), 0, 8);\n    $hashedNewPassword = password_hash($newPassword, PASSWORD_DEFAULT);\n\n    // update user's password in database\n    $query = \"UPDATE users SET password_hash = '$hashedNewPassword' WHERE id = '$user[id]'\";\n    mysqli_query($conn, $query);\n\n    // send email with new password\n    $to = $email;\n    $subject = \"Reset your password\";\n    $body = \"Your new password is: $newPassword\";\n    mail($to, $subject, $body);\n  }\n}\n\n// function to handle forgot password request\nfunction forgotPassword() {\n  // get form data (username or email)\n  $usernameOrEmail = $_POST['username_or_email'];\n\n  if (!empty($usernameOrEmail)) {\n    // check if user exists in database\n    $query = \"SELECT * FROM users WHERE username = '$usernameOrEmail' OR email = '$usernameOrEmail'\";\n    $result = mysqli_query($conn, $query);\n\n    if ($result->num_rows > 0) {\n      // send forgot password email\n      sendForgotPasswordEmail($_POST['email']);\n      echo \"An email with new password has been sent to your email address.\";\n    } else {\n      echo \"No user found with this username or email.\";\n    }\n  } else {\n    echo \"Please enter your username or email.\";\n  }\n}\n```", null]}
